<!--
@file src/components/system/table/Role.svelte
@component
**Role component for displaying different badges based on user roles.**

@example
<Role value={roles[0]?._id} />

### Props
- `value` {string}: The role ID to display

### features
- Dynamic role rendering based on user roles

-->

<script lang="ts">
	// Auth
	import { getAllRoles } from '@src/auth/permissions';
	import { roles as configRoles } from '@root/config/roles';
	import type { Role } from '@src/auth/auth';

	let roles = $state<Role[]>(getAllRoles() || configRoles);

	// Ensure roles is an array
	let { value } = $props<{ value: string }>();

	// Initialize roles from config if not loaded
	$effect(() => {
		const loadedRoles = getAllRoles();
		if (!loadedRoles || loadedRoles.length === 0) {
			roles = configRoles;
		} else {
			roles = loadedRoles;
		}
	});

	// Determine if the roles array is defined and has the required elements
	const roleClasses = (roleId: string) => {
		const role = roles.find((r) => r._id === roleId);
		if (!role) {
			const defaultRole = configRoles.find((r) => r._id === 'user');
			return defaultRole?.color || 'text-white';
		}
		return role.color || 'text-white';
	};

	const iconForRole = (roleId: string) => {
		const role = roles.find((r) => r._id === roleId);
		if (!role) {
			const defaultRole = configRoles.find((r) => r._id === 'user');
			return defaultRole?.icon || 'material-symbols:person';
		}
		return role.icon || 'material-symbols:person';
	};

	const roleName = (roleId: string) => {
		const role = roles.find((r) => r._id === roleId);
		if (!role) {
			const defaultRole = configRoles.find((r) => r._id === 'user');
			return defaultRole?.name || 'User';
		}
		return role.name || 'User';
	};
</script>

<span class="badge {roleClasses(value)}">
	{#if iconForRole(value)}
		<iconify-icon icon={iconForRole(value)} width="20"></iconify-icon> {roleName(value)}
	{:else}
		<span>{roleName(value)}</span>
	{/if}
</span>
