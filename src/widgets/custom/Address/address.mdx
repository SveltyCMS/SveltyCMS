---
path: '/widgets/custom/address'
title: 'Address Widget'
description: 'Comprehensive address input with Mapbox integration, geocoding, and structured data storage for SveltyCMS'
order: 304
icon: 'mdi:home-map-marker'
author: 'admin'
created: '2025-01-15'
updated: '2025-01-15'
tags:
  - widget
  - custom
  - address
  - location
  - map
  - geocoding
  - mapbox
  - geolocation
---

# Address Widget

<blockquote>
	**Address input widget** with optional Mapbox integration for interactive mapping, geocoding, and structured address data storage.
</blockquote>

## Overview

The **Address widget** provides a comprehensive solution for capturing structured address information. It combines form fields for street address, postal code, city, and country with an optional interactive Mapbox map for visual location selection and geocoding.

### Key Features

- ‚úÖ **Structured Data**: Stores complete address object with all components
- ‚úÖ **Mapbox Integration**: Optional interactive map with draggable markers
- ‚úÖ **Geocoding**: Convert addresses to coordinates and vice versa
- ‚úÖ **Country Selection**: Multilingual country dropdown with ISO codes
- ‚úÖ **Coordinate Capture**: Automatic latitude/longitude tracking
- ‚úÖ **Field Visibility**: Configurable hidden fields for flexible layouts
- ‚úÖ **Default Values**: Smart defaults from field configuration
- ‚úÖ **Validation**: Valibot schema ensures complete, valid addresses
- ‚úÖ **Non-Translatable**: Addresses are universal (not language-specific)
- ‚úÖ **Autocomplete**: HTML5 address autocomplete for better UX

---

## When to Use Address Widget

### ‚úÖ Use Address When:

- **Business Locations**: Store locations, branch offices, warehouses
- **Customer Data**: Shipping addresses, billing addresses
- **Event Management**: Venue addresses, meeting locations
- **Real Estate**: Property addresses with map visualization
- **Delivery Services**: Pickup and delivery address management
- **Directory Listings**: Business directories, location finders
- **Multi-Location Apps**: Apps with multiple physical locations
- **Mapping Applications**: Any app requiring address-to-coordinate conversion

### ‚ùå Don't Use Address When:

- **Simple Text**: Use Input widget for unstructured address text
- **Coordinates Only**: Use Number widgets for just lat/lng
- **Non-Physical Locations**: Virtual addresses, P.O. boxes without coordinates
- **Regions Only**: Use Select widget for country/state selection without full address

---

## Installation

### Prerequisites

For full functionality with interactive maps, you need a **Mapbox API token**:

1. Sign up at [mapbox.com](https://www.mapbox.com/)
2. Get your API token from the dashboard
3. Add to your environment configuration:

```typescript
// config/private.ts
export const privateEnv = {
	MAPBOX_API_TOKEN: 'pk.eyJ1IjoieW91cnVzZXJuYW1lIiwi...',
	USE_MAPBOX: true
};
```

**Note**: The widget works without Mapbox (form-only mode) but map features will be disabled.

---

## Basic Usage

### Simple Address Form

```typescript
import Address from '@src/widgets/custom/address';

export const businessesCollection = {
	name: 'Businesses',
	fields: [
		Address({
			label: 'Business Address',
			db_fieldName: 'address',
			required: true,
			defaultCountry: 'US',
			mapCenter: { lat: 40.7128, lng: -74.006 }, // New York
			zoom: 12
		})
	]
};
```

### Multiple Addresses

```typescript
import Address from '@src/widgets/custom/address';

export const customersCollection = {
	name: 'Customers',
	fields: [
		Address({
			label: 'Billing Address',
			db_fieldName: 'billingAddress',
			required: true,
			defaultCountry: 'US'
		}),

		Address({
			label: 'Shipping Address',
			db_fieldName: 'shippingAddress',
			required: false,
			defaultCountry: 'US',
			helper: 'Leave empty to use billing address'
		})
	]
};
```

### Real Estate Listings

```typescript
import Address from '@src/widgets/custom/address';
import Currency from '@src/widgets/custom/currency';

export const propertiesCollection = {
	name: 'Properties',
	fields: [
		Address({
			label: 'Property Location',
			db_fieldName: 'location',
			required: true,
			defaultCountry: 'US',
			mapCenter: { lat: 34.0522, lng: -118.2437 }, // Los Angeles
			zoom: 15, // Closer zoom for precise location
			hiddenFields: [] // Show all fields including coordinates
		}),

		Currency({
			label: 'Price',
			db_fieldName: 'price',
			currencyCode: 'USD',
			required: true
		})
	]
};
```

---

## Configuration Properties

| Property         | Type         | Required  | Default                   | Description                               |
| ---------------- | ------------ | --------- | ------------------------- | ----------------------------------------- |
| `label`          | `string`     | ‚úÖ Yes    | -                         | Display label for the field               |
| `db_fieldName`   | `string`     | ‚úÖ Yes    | -                         | Database field name                       |
| `required`       | `boolean`    | ‚ùå No     | `false`                   | Whether address is mandatory              |
| `defaultCountry` | `string`     | ‚ùå No     | `'DE'`                    | Default country (ISO 3166-1 alpha-2 code) |
| `mapCenter`      | `{lat, lng}` | ‚ùå No     | `{lat: 51.34, lng: 6.57}` | Default map center coordinates            |
| `zoom`           | `number`     | ‚ùå No     | `12`                      | Default map zoom level (1-20)             |
| `hiddenFields`   | `string[]`   | ‚ùå No     | `[]`                      | Fields to hide from UI                    |
| `width`          | `number`     | ‚ùå No     | `undefined`               | Field width in collection builder         |
| `translated`     | `boolean`    | üîí Locked | `false`                   | Always false (addresses are universal)    |

### Hidden Fields

You can hide specific fields from the UI:

```typescript
Address({
	label: 'Delivery Address',
	db_fieldName: 'deliveryAddress',
	hiddenFields: ['latitude', 'longitude', 'houseNumber']
	// Users won't see coordinate fields or house number
});
```

Available fields to hide:

- `'latitude'`
- `'longitude'`
- `'houseNumber'`
- `'name'` (location name)
- `'map'` (hide entire map)

---

## Data Structure

### Storage Format

Address data is stored as a **structured object** with all components:

```typescript
// MongoDB Document
{
  "_id": "business_123",
  "name": "Acme Corp",
  "address": {
    "street": "123 Main Street",
    "houseNumber": "123",
    "postalCode": "90210",
    "city": "Beverly Hills",
    "country": "US",              // ISO 3166-1 alpha-2
    "latitude": 34.0736,          // ‚úÖ Number type
    "longitude": -118.4004        // ‚úÖ Number type
  },
  "createdAt": ISODate("2025-01-15T10:00:00Z")
}
```

### AddressData Interface

```typescript
interface AddressData {
	street: string; // Street name
	houseNumber: string; // Building/house number
	postalCode: string; // ZIP/postal code
	city: string; // City name
	country: string; // ISO 3166-1 alpha-2 code (e.g., "US", "DE", "GB")
	latitude: number; // Decimal degrees (-90 to 90)
	longitude: number; // Decimal degrees (-180 to 180)
}
```

### Why Structured Objects?

**‚úÖ Structured Data Enables**:

- **Component Access**: Query by city, postal code, country individually
- **Geospatial Queries**: Find addresses within radius of coordinates
- **Address Formatting**: Display addresses in different formats per country
- **Validation**: Ensure all required components are present
- **Internationalization**: Handle different address formats globally

---

## Mapbox Integration

### Interactive Map Features

When Mapbox is enabled:

1. **Draggable Marker**: Click and drag to set exact location
2. **Geocoder Search**: Search for addresses and places
3. **Navigation Controls**: Zoom in/out, rotate, tilt
4. **Fullscreen Mode**: Expand map for better visualization
5. **Language Support**: Map labels in user's language
6. **Reverse Geocoding**: Automatically fill address fields from marker position

### Without Mapbox

If `USE_MAPBOX` is false or no API token:

- Form-only mode (no map displayed)
- Manual latitude/longitude input
- Manual address entry
- All validation still works

---

## Geospatial Queries

MongoDB supports powerful geospatial queries with address coordinates:

### Find Nearby Addresses

```typescript
// Create geospatial index
db.businesses.createIndex({
	'address.location': '2dsphere'
});

// Find businesses within 5km of a point
db.businesses.find({
	'address.location': {
		$near: {
			$geometry: {
				type: 'Point',
				coordinates: [-118.2437, 34.0522] // [lng, lat] order!
			},
			$maxDistance: 5000 // meters
		}
	}
});
```

### Find Within Polygon

```typescript
// Find addresses within city boundaries
db.businesses.find({
	'address.location': {
		$geoWithin: {
			$geometry: {
				type: 'Polygon',
				coordinates: [
					[
						[-118.5, 34.0],
						[-118.0, 34.0],
						[-118.0, 34.5],
						[-118.5, 34.5],
						[-118.5, 34.0]
					]
				]
			}
		}
	}
});
```

### Distance Calculation

```typescript
// Calculate distance between two addresses
db.businesses.aggregate([
	{
		$geoNear: {
			near: {
				type: 'Point',
				coordinates: [-118.2437, 34.0522]
			},
			distanceField: 'distance',
			spherical: true
		}
	},
	{ $sort: { distance: 1 } },
	{ $limit: 10 }
]);
```

---

## Address Formatting

Different countries have different address formats:

### US Format

```typescript
function formatAddressUS(address: AddressData): string {
	return `${address.houseNumber} ${address.street}
${address.city}, ${address.country} ${address.postalCode}`;
}
// Result:
// 123 Main Street
// Beverly Hills, US 90210
```

### German Format

```typescript
function formatAddressDE(address: AddressData): string {
	return `${address.street} ${address.houseNumber}
${address.postalCode} ${address.city}`;
}
// Result:
// Hauptstra√üe 123
// 10115 Berlin
```

### UK Format

```typescript
function formatAddressUK(address: AddressData): string {
	return `${address.houseNumber} ${address.street}
${address.city}
${address.postalCode}`;
}
// Result:
// 10 Downing Street
// London
// SW1A 2AA
```

---

## Advanced Examples

### Store Locator

```typescript
import Address from '@src/widgets/custom/address';
import List from '@src/widgets/core/list';

export const storesCollection = {
	name: 'Store Locations',
	fields: [
		Address({
			label: 'Store Address',
			db_fieldName: 'address',
			required: true,
			defaultCountry: 'US',
			zoom: 15
		}),

		List({
			label: 'Opening Hours',
			db_fieldName: 'hours',
			fields: [
				Select({
					label: 'Day',
					db_fieldName: 'day',
					options: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
				}),
				Input({ label: 'Open', db_fieldName: 'open', placeholder: '09:00' }),
				Input({ label: 'Close', db_fieldName: 'close', placeholder: '17:00' })
			]
		})
	]
};

// Query: Find nearest stores
async function findNearestStores(userLat: number, userLng: number, maxDistance: number) {
	return await db.stores
		.find({
			'address.location': {
				$near: {
					$geometry: {
						type: 'Point',
						coordinates: [userLng, userLat]
					},
					$maxDistance: maxDistance
				}
			}
		})
		.limit(5);
}
```

### Delivery Zones

```typescript
import Address from '@src/widgets/custom/address';
import Currency from '@src/widgets/custom/currency';

export const deliveryZonesCollection = {
	name: 'Delivery Zones',
	fields: [
		Address({
			label: 'Zone Center',
			db_fieldName: 'centerAddress',
			required: true
		}),

		Number({
			label: 'Radius (km)',
			db_fieldName: 'radiusKm',
			min: 1,
			max: 100,
			required: true
		}),

		Currency({
			label: 'Delivery Fee',
			db_fieldName: 'deliveryFee',
			currencyCode: 'USD',
			required: true
		})
	]
};

// Check if address is in delivery zone
function isInDeliveryZone(deliveryAddress: AddressData, zoneCenter: AddressData, radiusKm: number): boolean {
	const distance = calculateDistance(deliveryAddress.latitude, deliveryAddress.longitude, zoneCenter.latitude, zoneCenter.longitude);
	return distance <= radiusKm * 1000; // Convert km to meters
}
```

---

## Accessibility

### ARIA Support

```html
<form>
	<label for="street">Street</label>
	<input type="text" id="street" name="street" autocomplete="street-address" aria-required="true" />

	<label for="city">City</label>
	<input type="text" id="city" name="city" autocomplete="address-level2" aria-required="true" />

	<label for="country">Country</label>
	<select id="country" name="country" autocomplete="country" aria-required="true">
		<!-- Country options -->
	</select>
</form>
```

### HTML5 Autocomplete

The widget uses proper autocomplete attributes for browser autofill:

- `street-address` - Street address
- `postal-code` - ZIP/Postal code
- `address-level2` - City
- `country` - Country

---

## Best Practices

### ‚úÖ Do's

1. **Use Geospatial Indexes**

   ```typescript
   db.businesses.createIndex({
   	'address.location': '2dsphere'
   });
   ```

2. **Store Coordinates as Numbers**

   ```typescript
   // ‚úÖ Correct
   latitude: 34.0522; // Number
   longitude: -118.2437; // Number

   // ‚ùå Wrong
   latitude: '34.0522'; // String
   ```

3. **Use ISO Country Codes**
   ```typescript
   country: 'US'; // ‚úÖ ISO 3166-1 alpha-2
   country: 'DE'; // ‚úÖ Germany
   country: 'GB'; // ‚úÖ United Kingdom
   ```

### ‚ùå Don'ts

1. **Don't Store as Single String**

   ```typescript
   // ‚ùå Wrong
   address: "123 Main St, Beverly Hills, CA 90210"

   // ‚úÖ Correct
   address: {
     street: "Main Street",
     houseNumber: "123",
     city: "Beverly Hills",
     // ...
   }
   ```

2. **Don't Mix Coordinate Order**
   ```typescript
   // MongoDB/GeoJSON uses [longitude, latitude]
   coordinates: [-118.2437, 34.0522]; // ‚úÖ [lng, lat]
   coordinates: [34.0522, -118.2437]; // ‚ùå [lat, lng] WRONG!
   ```

---

## API Reference

```typescript
function Address(props: AddressProps): FieldInstance;

interface AddressProps {
	label: string;
	db_fieldName: string;
	required?: boolean;
	defaultCountry?: string; // ISO alpha-2 code
	mapCenter?: { lat: number; lng: number };
	zoom?: number; // 1-20
	hiddenFields?: Array<keyof AddressData>;
	width?: number;
}

interface AddressData {
	street: string;
	houseNumber: string;
	postalCode: string;
	city: string;
	country: string; // ISO 3166-1 alpha-2
	latitude: number; // -90 to 90
	longitude: number; // -180 to 180
}
```

---

## Related Widgets

- **[Input Widget](/widgets/core/input)** - For unstructured address text
- **[Number Widget](/widgets/custom/number)** - For standalone coordinates
- **[Select Widget](/widgets/core/select)** - For country/region selection

---

## Resources

- [Mapbox GL JS Documentation](https://docs.mapbox.com/mapbox-gl-js/)
- [ISO 3166-1 Country Codes](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)
- [MongoDB Geospatial Queries](https://www.mongodb.com/docs/manual/geospatial-queries/)
- [HTML Autocomplete Attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/autocomplete)

---

## Changelog

### Version 1.0.0 (2025-01-15)

- ‚úÖ Initial release with structured address storage
- ‚úÖ Optional Mapbox integration
- ‚úÖ Geospatial query support
- ‚úÖ Multilingual country selection
- ‚úÖ Full accessibility support

---

## License

The Address widget is part of SveltyCMS and is licensed under the Business Source License 1.1.
