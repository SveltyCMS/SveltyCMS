---
path: 'docs/tests/testing-strategy.mdx'
title: 'Testing Strategy: Unit, Integration & E2E'
description: 'Understanding the testing pyramid and when to use unit, integration, and E2E tests in SveltyCMS with the fastest tools available.'
order: 2
icon: 'mdi:layers-triple'
author: 'admin'
created: '2026-01-18'
updated: '2026-01-20'
tags:
  - 'testing'
  - 'strategy'
  - 'unit-tests'
  - 'integration-tests'
  - 'e2e-tests'
  - 'best-practices'
  - 'bun'
  - 'playwright'
---

# Testing Strategy: Unit, Integration & E2E

This guide explains our testing pyramid and why we use **Bun Test** and **Playwright** â€” the fastest testing tools available in 2026.

---

## Why Bun + Playwright?

> [!IMPORTANT]
> We chose **Bun Test** and **Playwright** because they are the **fastest testing tools available** for their respective domains.

### Speed Comparison (2026)

| Framework       | 241 Unit Tests   | Why We Don't Use It |
| --------------- | ---------------- | ------------------- |
| **Bun Test** âš¡ | **~0.5 seconds** | âœ… We use this      |
| Vitest          | ~2 seconds       | 4x slower           |
| Jest            | ~8 seconds       | 16x slower          |

| E2E Framework     | 20 Browser Tests | Why We Don't Use It        |
| ----------------- | ---------------- | -------------------------- |
| **Playwright** ğŸ­ | **~30 seconds**  | âœ… We use this             |
| Cypress           | ~60 seconds      | 2x slower, worse debugging |
| WebdriverIO       | ~90 seconds      | Complex setup              |

---

## The Testing Pyramid

```
         /\
        /E2E\      â† Few, Slow (Full user flows) - Playwright
       /------\
      /  INT  \    â† Moderate (API + Database) - Bun + fetch
     /----------\
    /   UNIT     \ â† Many, Fast (Pure logic) - Bun Test
   /--------------\
```

**Golden Rule:** More tests at the bottom, fewer at the top.

---

## 1. Unit Tests ğŸ§ª (Bun Test)

### What They Test

**Pure logic in isolation** â€” No database, no server, no external dependencies.

### SveltyCMS Examples

| Test File              | What It Tests            | Speed |
| ---------------------- | ------------------------ | ----- |
| `crypto.test.ts`       | Password hashing, tokens | ~10ms |
| `dateUtils.test.ts`    | Date formatting          | ~5ms  |
| `token-system.test.ts` | Token replacement        | ~15ms |
| `navigation.test.ts`   | Navigation manager       | ~8ms  |

### When to Use Unit Tests

âœ… Utility functions (date, string, crypto)
âœ… Business logic (validation, token replacement)
âœ… State management (stores)
âœ… Data transformations
âŒ Database operations
âŒ API endpoints

### Running Unit Tests

```bash
bun run test:unit                    # All unit tests (~0.5s)
bun test tests/bun/utils/            # Utility tests only
bun test tests/bun/stores/           # Store tests only
bun test --watch tests/bun/          # Watch mode
```

---

## 2. Integration Tests ğŸ”Œ (Bun + fetch)

### What They Test

**Multiple components working together** â€” Database + Server + API, but no browser.

### SveltyCMS Examples

| Test File             | What It Tests      | Requires      |
| --------------------- | ------------------ | ------------- |
| `user.test.ts`        | User API endpoints | Server + Auth |
| `collections.test.ts` | CRUD operations    | Server + DB   |
| `auth-2fa.test.ts`    | 2FA authentication | Server + TOTP |

### When to Use Integration Tests

âœ… API endpoints
âœ… Database operations
âœ… Authentication flows
âœ… File uploads
âŒ UI rendering
âŒ User interactions

### Running Integration Tests

```bash
bun run test:integration           # All integration tests
bun test tests/bun/api/            # API tests only
```

---

## 3. E2E Tests ğŸ­ (Playwright)

### What They Test

**Complete user flows in a real browser** â€” Everything: UI + Server + Database + Browser.

### SveltyCMS Examples

| Test File                   | What It Tests | Browser Actions      |
| --------------------------- | ------------- | -------------------- |
| `setup-wizard.spec.ts`      | Initial setup | Fill forms, navigate |
| `login.spec.ts`             | Login/logout  | Enter credentials    |
| `role-based-access.spec.ts` | RBAC          | Permission checks    |

### Role-Based E2E Testing

We use **pre-authenticated fixtures** for fast role testing:

```typescript
import { test, expect } from './fixtures/auth.fixtures';

test('admin can access settings', async ({ adminPage }) => {
	await adminPage.goto('/settings');
	await expect(adminPage).toHaveURL('/settings');
});

test('editor cannot access users', async ({ editorPage }) => {
	await editorPage.goto('/users');
	await expect(editorPage).toHaveURL(/403|access-denied/);
});
```

### Available Role Fixtures

| Fixture      | User               | Access Level              |
| ------------ | ------------------ | ------------------------- |
| `adminPage`  | admin@example.com  | Full access               |
| `devPage`    | dev@example.com    | Admin panel, no user mgmt |
| `editorPage` | editor@example.com | Content only              |
| `viewerPage` | viewer@example.com | Read only                 |

### When to Use E2E Tests

âœ… Critical user journeys (login, setup)
âœ… Multi-step workflows
âœ… UI interactions (forms, modals)
âœ… Role-based access control
âŒ Every edge case (too slow)
âŒ Pure logic (use unit tests)

### Running E2E Tests

```bash
bun run test:e2e                    # All E2E tests
bun x playwright test tests/playwright/login.spec.ts
bun x playwright test --ui          # Interactive UI
```

---

## 4-Stage Test Pipeline

Our tests run in a specific order to maximize efficiency:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 1: UNIT TESTS (No server)           âš¡ ~0.5s         â”‚
â”‚ â””â”€ bun run test:unit                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STAGE 2: FRESH SETUP (E2E)                                  â”‚
â”‚ â”œâ”€ Clean config/private.ts                                  â”‚
â”‚ â”œâ”€ Run Setup Wizard â†’ Creates Admin                         â”‚
â”‚ â””â”€ Seed users (dev, editor, viewer)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STAGE 3: SIGNED-OUT TESTS                                   â”‚
â”‚ â”œâ”€ Login page functionality                                 â”‚
â”‚ â””â”€ Signup with invite token                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STAGE 4: SIGNED-IN TESTS (RBAC)                             â”‚
â”‚ â”œâ”€ Admin: Full access tests                                 â”‚
â”‚ â”œâ”€ Dev: Limited admin access                                â”‚
â”‚ â”œâ”€ Editor: Content-only access                              â”‚
â”‚ â””â”€ Viewer: Read-only access                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Debugging Failed Tests

### Playwright Artifacts on Failure

When a Playwright test fails, you automatically get:

| Artifact       | What It Shows                        |
| -------------- | ------------------------------------ |
| **Screenshot** | Visual state at exact failure moment |
| **Video**      | Full recording of the test           |
| **Trace**      | Timeline with network, DOM, actions  |

### Viewing a Trace

```bash
npx playwright show-trace test-results/your-test/trace.zip
```

---

## The 70-20-10 Rule

| Layer       | Percentage | Purpose                         |
| ----------- | ---------- | ------------------------------- |
| Unit        | 70%        | Fast feedback, precise failures |
| Integration | 20%        | Confidence in connections       |
| E2E         | 10%        | Critical user flows             |

---

## Summary

| Ask Yourself               | Test Type   | Tool        |
| -------------------------- | ----------- | ----------- |
| "Am I testing logic?"      | Unit Test   | Bun Test    |
| "Am I testing API/DB?"     | Integration | Bun + fetch |
| "Am I testing user flows?" | E2E Test    | Playwright  |

---

## Related Documentation

- [Test Status Report](./test-status.mdx) â€” Current pass rates
- [API Test Coverage](./api-test-coverage.mdx) â€” API endpoint coverage
- [E2E Testing Guide](./e2e-testing-guide.mdx) â€” Playwright best practices
- [Database Tests](./database-tests.mdx) â€” MongoDB/MariaDB testing
