---
path: 'docs/tests/testing-strategy.mdx'
title: 'Testing Strategy: Unit, Integration & E2E'
description: 'Understanding the testing pyramid and when to use unit, integration, and E2E tests in SveltyCMS.'
order: 2
icon: 'mdi:layers-triple'
author: 'admin'
created: '2026-01-18'
updated: '2026-01-18'
tags:
  - 'testing'
  - 'strategy'
  - 'unit-tests'
  - 'integration-tests'
  - 'e2e-tests'
  - 'best-practices'
---

# Testing Strategy: Unit, Integration & E2E

This guide explains the testing pyramid and how each test type contributes to SveltyCMS quality.

---

## The Testing Pyramid

```
        /\
       /E2E\      â† Few, Slow (Full user flows)
      /------\
     /  INT  \    â† Moderate (API + Database)
    /----------\
   /   UNIT     \ â† Many, Fast (Pure logic)
  /--------------\
```

**Golden Rule:** More tests at the bottom, fewer at the top.

---

## 1. Unit Tests ðŸ§ª

### What They Test

**Pure logic in isolation** â€” No database, no server, no external dependencies.

### SveltyCMS Examples

| Test File               | What It Tests            | Example                                |
| ----------------------- | ------------------------ | -------------------------------------- |
| `crypto.test.ts`        | Password hashing, tokens | `hashPassword()`, `verifyPassword()`   |
| `dateUtils.test.ts`     | Date formatting          | `formatDisplayDate()`, ISO conversions |
| `errorHandling.test.ts` | AppError class           | Error wrapping, message extraction     |
| `token-system.test.ts`  | Token replacement        | `{{entry.title}}` â†’ actual value       |

### When to Use Unit Tests

âœ… Utility functions (date, string, crypto)  
âœ… Business logic (validation, token replacement)  
âœ… State management (stores)  
âœ… Data transformations  
âŒ Database operations  
âŒ API endpoints

### Running Unit Tests

```bash
bun run test:unit                    # All unit tests (~245 tests, ~2s)
bun test tests/bun/utils/            # Utility tests only
bun test tests/bun/services/         # Service tests only
```

---

## 2. Integration Tests ðŸ”Œ

### What They Test

**Multiple components working together** â€” Database + Server + API, but no browser.

### SveltyCMS Examples

| Test File                 | What It Tests      | Requires      |
| ------------------------- | ------------------ | ------------- |
| `setup.test.ts`           | Setup wizard API   | Server + DB   |
| `mongodb-adapter.test.ts` | Database CRUD      | MongoDB       |
| `user.test.ts`            | User API endpoints | Server + Auth |
| `auth-2fa.test.ts`        | 2FA authentication | Server + TOTP |

### When to Use Integration Tests

âœ… API endpoints  
âœ… Database operations  
âœ… Authentication flows  
âœ… File uploads  
âŒ UI rendering  
âŒ User interactions

### Running Integration Tests

```bash
bun run test:integration           # All integration tests
bun test tests/bun/api/            # API tests only
bun test tests/bun/databases/      # Database tests only
```

---

## 3. E2E Tests ðŸŽ­

### What They Test

**Complete user flows in a real browser** â€” Everything: UI + Server + Database + Browser.

### SveltyCMS Examples

| Test File                   | What It Tests | Browser Actions                     |
| --------------------------- | ------------- | ----------------------------------- |
| `setup-wizard.spec.ts`      | Initial setup | Fill forms, navigate steps          |
| `user.spec.ts`              | Login/logout  | Enter credentials, verify dashboard |
| `role-based-access.spec.ts` | RBAC          | Test permissions across roles       |

### When to Use E2E Tests

âœ… Critical user journeys (login, setup)  
âœ… Multi-step workflows  
âœ… UI interactions (forms, modals)  
âŒ Every edge case (too slow)  
âŒ Pure logic (use unit tests)

### Running E2E Tests

```bash
bun run test:e2e                    # All E2E tests
bun x playwright test tests/playwright/setup-wizard.spec.ts
```

---

## Nx Workspace-Specific Testing

SveltyCMS uses an Nx monorepo. Tests can be run by workspace:

### Shared Library Tests

```bash
bun run test:unit                   # Shared utils, services, stores
```

### Setup App Tests

```bash
bun test tests/bun/api/setup*.ts    # Setup API tests
bun x playwright test tests/playwright/setup-wizard.spec.ts
```

### CMS App Tests

```bash
bun test tests/bun/api --ignore '**/setup*.ts'  # CMS API tests
bun x playwright test tests/playwright --ignore '**/setup*.ts'
```

---

## The 70-20-10 Rule

| Layer       | Percentage | Purpose                         |
| ----------- | ---------- | ------------------------------- |
| Unit        | 70%        | Fast feedback, precise failures |
| Integration | 20%        | Confidence in connections       |
| E2E         | 10%        | Critical user flows             |

---

## Best Practices

### 1. Test Isolation

```typescript
// âœ… GOOD: Each test is independent
beforeEach(async () => {
	await cleanupTestDatabase();
});
```

### 2. Unique Test Data

```typescript
// âœ… GOOD: Unique identifiers prevent conflicts
const email = `test-${Date.now()}@example.com`;
```

### 3. Fail Fast

```typescript
// âœ… GOOD: Skip if prerequisites missing
if (!isCryptoAvailable()) {
	console.warn('Skipping crypto tests');
	return;
}
```

---

## Summary

| Ask Yourself                    | Test Type        |
| ------------------------------- | ---------------- |
| "Am I testing logic?"           | Unit Test        |
| "Am I testing integration?"     | Integration Test |
| "Am I testing user experience?" | E2E Test         |

---

## Related Documentation

- [Test Status Report](./test-status.mdx) â€” Current pass rates
- [API Test Coverage](./api-test-coverage.mdx) â€” API endpoint coverage
- [E2E Testing Guide](./e2e-testing-guide.mdx) â€” Playwright best practices
- [Database Tests](./database-tests.mdx) â€” MongoDB/MariaDB testing
