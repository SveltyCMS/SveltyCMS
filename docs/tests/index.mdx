---
path: 'docs/tests/index.mdx'
title: 'Testing Documentation'
description: 'Complete testing guide for SveltyCMS using the fastest available tools: Bun Test for unit/integration and Playwright for E2E testing.'
order: 1
icon: 'mdi:test-tube'
author: 'admin'
created: '2025-11-08'
updated: '2026-01-20'
tags:
  - 'testing'
  - 'documentation'
  - 'quality-assurance'
  - 'ci-cd'
  - 'bun'
  - 'playwright'
---

# SveltyCMS Testing Documentation

**Last Updated:** January 20, 2026
**Total Tests:** ~300+ (Unit: 241, Integration: ~40, E2E: ~20)
**Pass Rate:** 100% for unit tests

> [!TIP]
> **Why Bun + Playwright?** We use the **fastest testing tools available in 2026**:
>
> - **Bun Test**: ~10x faster than Jest/Vitest for unit tests
> - **Playwright**: Industry-leading E2E with best debugging tools

---

## Quick Start

```bash
# Run unit tests (fast, no server needed)
bun run test:unit          # ~2 seconds, 241 tests

# Run E2E tests (requires server)
bun run test:e2e           # ~60 seconds, full browser tests

# Run everything
bun run test:all
```

---

## Why These Tools? (2026 SOTA)

| Aspect          | Our Choice        | Alternative  | Speed Comparison                |
| --------------- | ----------------- | ------------ | ------------------------------- |
| **Unit Tests**  | **Bun Test** âš¡   | Jest, Vitest | Bun is ~10x faster              |
| **E2E Tests**   | **Playwright** ðŸŽ­ | Cypress      | Playwright has better debugging |
| **Integration** | **Bun + fetch**   | Supertest    | Native, no overhead             |

### Bun Test Advantages

```typescript
// Native TypeScript - no transpilation
import { describe, it, expect } from 'bun:test';

// Built-in mocking
import { mock } from 'bun:test';
const mockFn = mock(() => 'mocked');

// Sub-second execution for 241 tests
```

### Playwright Advantages

- **Trace on Failure**: Full timeline, network, DOM snapshots
- **Video Recording**: Auto-record failed tests
- **Screenshot Capture**: Instant visual debugging
- **Cross-browser**: Chromium, Firefox, WebKit
- **Auth State Caching**: Login once, reuse everywhere

---

## 4-Stage Testing Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 1: UNIT TESTS            âš¡ ~2 seconds                            â”‚
â”‚ â”œâ”€ No server, no database                                               â”‚
â”‚ â”œâ”€ Pure logic: utils, stores, validators                                â”‚
â”‚ â””â”€ bun run test:unit                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STAGE 2: FRESH SETUP           ðŸ”§ Setup Wizard E2E                      â”‚
â”‚ â”œâ”€ Clean state (no config/private.ts)                                   â”‚
â”‚ â”œâ”€ Run Setup Wizard â†’ Creates DB + Admin                                â”‚
â”‚ â””â”€ Seed test users (dev, editor, viewer)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STAGE 3: SIGNED-OUT TESTS      ðŸ”“ Public endpoints                      â”‚
â”‚ â”œâ”€ Login page functionality                                             â”‚
â”‚ â”œâ”€ Signup with invite token (blocked without)                           â”‚
â”‚ â””â”€ Public API endpoints                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STAGE 4: SIGNED-IN TESTS       ðŸ” Role-based (RBAC)                     â”‚
â”‚ â”œâ”€ Admin: Full access tests                                             â”‚
â”‚ â”œâ”€ Dev: Limited admin panel access                                      â”‚
â”‚ â”œâ”€ Editor: Content-only access                                          â”‚
â”‚ â””â”€ Viewer: Read-only access                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Test User Fixtures

All test users are automatically created by `scripts/seed-test-db.ts`:

| Role       | Email              | Password           | Permissions               |
| ---------- | ------------------ | ------------------ | ------------------------- |
| **Admin**  | admin@example.com  | Admin123!          | Full access               |
| **Dev**    | dev@example.com    | DevPassword123!    | Admin panel, no user mgmt |
| **Editor** | editor@example.com | EditorPassword123! | Content only              |
| **Viewer** | viewer@example.com | ViewerPassword123! | Read only                 |

---

## Role-Based E2E Testing

Playwright fixtures provide pre-authenticated pages for each role:

```typescript
// tests/playwright/admin.spec.ts
import { test, expect } from './fixtures/auth.fixtures';

test('admin can access settings', async ({ adminPage }) => {
	await adminPage.goto('/settings');
	await expect(adminPage).toHaveURL('/settings');
});

test('editor cannot access user management', async ({ editorPage }) => {
	await editorPage.goto('/users');
	await expect(editorPage).toHaveURL(/access-denied|403/);
});

test('dev can access admin panel', async ({ devPage }) => {
	await devPage.goto('/admin');
	await expect(devPage).toHaveURL('/admin');
});
```

### Available Fixtures

| Fixture        | Description                              |
| -------------- | ---------------------------------------- |
| `adminPage`    | Pre-authenticated admin browser page     |
| `devPage`      | Pre-authenticated dev browser page       |
| `editorPage`   | Pre-authenticated editor browser page    |
| `viewerPage`   | Pre-authenticated viewer browser page    |
| `adminContext` | Admin browser context (for advanced use) |

---

## Debugging Failed Tests

### Playwright Artifacts on Failure

When a test fails, you automatically get:

| Artifact       | Location                           | Purpose                  |
| -------------- | ---------------------------------- | ------------------------ |
| **Screenshot** | `test-results/*/test-failed-*.png` | Visual state at failure  |
| **Video**      | `test-results/*/video.webm`        | Full recording           |
| **Trace**      | `test-results/*/trace.zip`         | Timeline + network + DOM |

### Viewing the Trace

```bash
# Open trace viewer (interactive timeline)
npx playwright show-trace test-results/your-test-chromium/trace.zip
```

The trace includes:

- Every action with timestamps
- Network requests/responses
- DOM snapshots
- Console logs

---

## Test Organization

```
tests/
â”œâ”€â”€ bun/                        # Bun unit & integration tests
â”‚   â”œâ”€â”€ setup.ts               # Global test setup (mocks)
â”‚   â”œâ”€â”€ helpers/               # Test utilities
â”‚   â”‚   â”œâ”€â”€ auth.ts           # Login helpers
â”‚   â”‚   â”œâ”€â”€ server.ts         # Server helpers
â”‚   â”‚   â””â”€â”€ testSetup.ts      # Fixtures & cleanup
â”‚   â”œâ”€â”€ api/                   # API integration tests
â”‚   â”œâ”€â”€ services/              # Service unit tests
â”‚   â”œâ”€â”€ stores/                # Store unit tests
â”‚   â”œâ”€â”€ utils/                 # Utility unit tests
â”‚   â””â”€â”€ widgets/               # Widget unit tests
â”‚
â”œâ”€â”€ playwright/                 # Playwright E2E tests
â”‚   â”œâ”€â”€ global-setup.ts        # Runs ONCE before all tests
â”‚   â”œâ”€â”€ fixtures/              # Auth fixtures
â”‚   â”‚   â””â”€â”€ auth.fixtures.ts  # Role-based page fixtures
â”‚   â”œâ”€â”€ .auth/                 # Cached auth states (gitignored)
â”‚   â”œâ”€â”€ setup-wizard.spec.ts   # Fresh setup tests
â”‚   â”œâ”€â”€ login.spec.ts          # Auth flow tests
â”‚   â””â”€â”€ role-based-access.spec.ts  # RBAC tests
â”‚
â””â”€â”€ scripts/
    â””â”€â”€ seed-test-db.ts        # Seeds test users
```

---

## Running Tests

### Unit Tests (No Server)

```bash
# All unit tests (~2 seconds)
bun run test:unit

# Specific test file
bun test tests/bun/utils/crypto.test.ts

# Watch mode (re-run on changes)
bun test --watch tests/bun/services/
```

### Integration Tests (Requires Server)

```bash
# Automated (starts server, runs tests)
bun run test:integration

# Manual
bun run dev                    # Terminal 1
bun test tests/bun/api/        # Terminal 2
```

### E2E Tests (Requires Server + Browser)

```bash
# Automated (recommended)
bun run test:e2e

# Specific test file
bun x playwright test tests/playwright/login.spec.ts

# With UI (interactive)
bun x playwright test --ui
```

---

## CI/CD Pipeline

All tests run automatically in GitHub Actions:

```yaml
# .github/workflows/ci.yml
jobs:
  unit-tests: # âš¡ ~10s - No dependencies
  integration-mongo: # ðŸƒ ~2min - MongoDB container
  integration-maria: # ðŸ¬ ~2min - MariaDB container
  e2e-mongo: # ðŸŽ­ ~5min - Full browser + MongoDB
  e2e-maria: # ðŸŽ­ ~5min - Full browser + MariaDB
```

### Multi-Database Testing

| Database   | Unit | Integration | E2E        |
| ---------- | ---- | ----------- | ---------- |
| MongoDB    | âœ…   | âœ…          | âœ…         |
| MariaDB    | âœ…   | âœ…          | âœ…         |
| PostgreSQL | âœ…   | ðŸš§ Planned  | ðŸš§ Planned |

---

## Best Practices

### 1. Test Isolation

```typescript
// Each test is independent
beforeEach(async () => {
	await cleanupTestDatabase();
});
```

### 2. Unique Test Data

```typescript
// Prevent conflicts between parallel tests
const email = `test-${Date.now()}@example.com`;
```

### 3. Use Role Fixtures

```typescript
// Don't login manually - use fixtures
test('admin test', async ({ adminPage }) => {
	// Already authenticated!
});
```

### 4. Fast Feedback Loop

```bash
# Run only affected tests during development
bun test --watch tests/bun/your-feature/
```

---

## Related Documentation

- [Testing Strategy](./testing-strategy.mdx) â€” Unit vs Integration vs E2E
- [Test Status Report](./test-status.mdx) â€” Current pass rates
- [API Test Coverage](./api-test-coverage.mdx) â€” Endpoint coverage
- [E2E Testing Guide](./e2e-testing-guide.mdx) â€” Playwright best practices
- [Database Tests](./database-tests.mdx) â€” Multi-database testing
