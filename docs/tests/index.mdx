---
path: 'docs/tests/index.mdx'
title: 'Testing Documentation'
description: 'Complete testing guide for SveltyCMS including Bun unit tests, Playwright E2E tests, GitHub Actions automation, and local testing workflows.'
order: 1
icon: 'mdi:test-tube'
author: 'admin'
created: '2025-11-08'
updated: '2026-01-18'
tags:
  - 'testing'
  - 'documentation'
  - 'quality-assurance'
  - 'ci-cd'
  - 'bun'
  - 'playwright'
---

# SveltyCMS Testing Documentation

**Last Updated:** January 18, 2026
**Total Tests:** ~295 (Unit: 245, Integration: ~40, E2E: ~10)
**Pass Rate:** ~100% for unit tests

## Quick Links

- ðŸ“š **[Testing Strategy](./testing-strategy.mdx)** â€” When to use unit, integration, and E2E tests
- ðŸ“Š **[Test Status](./test-status.mdx)** â€” Current pass rates and known issues
- ðŸ”Œ **[API Coverage](./api-test-coverage.mdx)** â€” API endpoint test coverage

## Documentation Organization

Testing docs are organized by purpose:

| Category                | Files                                                                          |
| ----------------------- | ------------------------------------------------------------------------------ |
| **Strategy & Overview** | `testing-strategy.mdx`, `index.mdx`                                            |
| **Coverage Reports**    | `api-test-coverage.mdx`, `hook-test-coverage.mdx`, `utility-test-coverage.mdx` |
| **Guides**              | `e2e-testing-guide.mdx`, `database-tests.mdx`, `git-workflow.mdx`              |

---

## Test Frameworks Overview

SveltyCMS uses two complementary test frameworks to ensure comprehensive quality coverage:

### ðŸ§ª Bun Test - Unit & Integration Tests

- **Purpose**: Fast, lightweight testing for business logic, services, and API endpoints
- **Location**: `tests/bun/`
- **Test Count**: ~575 tests
- **Execution Time**: ~2-15 seconds

**What It Tests**:

- âœ… Services (auth, security, caching)
- âœ… Utilities (validation, formatting, crypto)
- âœ… Stores (system state, UI state, loading)
- âœ… Widgets (validation, rendering, security)
- âœ… Middleware Hooks (all 11 hooks)
- âœ… API Endpoints (integration tests)
- âœ… Database Operations (MongoDB currently)

**Why Bun?**

- 100x faster than Jest/Mocha
- Native TypeScript support (no transpilation)
- Built-in mocking
- Perfect for headless CMS architecture

### ðŸŽ­ Playwright - End-to-End Tests

- **Purpose**: Browser automation for critical user journeys
- **Location**: `tests/playwright/`
- **Test Count**: ~40 tests
- **Execution Time**: ~30-60 seconds

**What It Tests**:

- âœ… Setup Wizard flow
- âœ… Login/Authentication
- âœ… Content CRUD operations
- âœ… Admin dashboard
- âœ… User management

**Why Playwright?**

- Cross-browser testing (Chromium, Firefox, WebKit)
- Reliable auto-waiting
- Screenshot/video recording on failure
- Parallel execution

---

## GitHub Actions Automation

All tests run automatically in CI/CD via GitHub Actions:

**Workflow**: `.github/workflows/ci.yml`

```yaml
jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - Run Bun unit tests (~350 tests)
      - Execution time: ~2 seconds

  integration-tests:
    runs-on: ubuntu-latest
    services:
      mongodb: # MongoDB service container
    steps:
      - Clean config directory
      - Start dev server
      - Seed test database
      - Run Bun integration tests (~225 tests)
      - Execution time: ~15 seconds

  integration-tests-mariadb:
    runs-on: ubuntu-latest
    services:
      mariadb: # MariaDB 11 service container
    steps:
      - Clean config directory
      - Start dev server
      - Run Drizzle ORM integration tests
      - Execution time: ~15 seconds

  e2e-tests:
    runs-on: ubuntu-latest
    services:
      mongodb:
    steps:
      - Clean config directory
      - Install Playwright browsers
      - Start dev server
      - Seed test database
      - Run Playwright E2E tests (~40 tests)
      - Execution time: ~60 seconds

  e2e-tests-mariadb:
    runs-on: ubuntu-latest
    services:
      mariadb: # MariaDB 11 service container
    steps:
      - Clean config directory
      - Install Playwright browsers
      - Start dev server
      - Run Playwright E2E tests with Drizzle ORM
      - Execution time: ~60 seconds
```

> [!IMPORTANT]
> **Security Note**: All GitHub workflows use **pinned commit SHAs** for actions and enforce **frozen lockfiles** (`bun install --frozen-lockfile`) to protect against supply chain attacks. Do not change these to version tags without verifying the commit SHA.

**When Tests Run**:

- **On Pull Request**: All tests must pass before merge
- **On Push to main/next**: Full test suite + release checks
- **Manual Trigger**: Via `workflow_dispatch`

### Multi-Database Testing (Active)

> [!NOTE]
> **Currently Running**: Tests execute in parallel against multiple databases
>
> **Supported Databases**:
>
> - âœ… **MongoDB** - Native adapter (integration + E2E)
> - âœ… **MariaDB** - Drizzle ORM (integration + E2E)
> - ðŸš§ **PostgreSQL** - Drizzle ORM (planned)
> - ðŸš§ **MySQL** - Drizzle ORM (planned)
>
> This ensures SveltyCMS works correctly with all supported databases.

---

## Local Testing (Before Committing)

### Quick Start

```bash
# Run ALL tests (unit + integration + E2E)
bun run test:all

# Run specific test types
bun run test:unit          # Fast (~2s) - No server needed
bun run test:integration   # Medium (~15s) - Requires server
bun run test:e2e           # Slow (~60s) - Requires server + browser
```

> [!IMPORTANT]
> **Test Config Isolation**: Local tests **ALWAYS** use `config/private.test.ts`. The system will throw a fatal error if it detects an attempt to load the live `config/private.ts` while `NODE_ENV=test`, protecting your local development database.

### Unit Tests Only (Fastest)

```bash
# All unit tests
bun run test:unit

# Specific test files
bun test tests/bun/services/SecurityResponseService.test.ts
bun test tests/bun/stores/system.test.ts
bun test tests/bun/widgets/richText.test.ts

# Watch mode (re-run on file changes)
bun test --watch tests/bun/services/
```

### Integration Tests (Requires Server)

```bash
# Terminal 1: Start dev server
bun run dev

# Terminal 2: Run integration tests
bun test tests/bun/api/
bun test tests/bun/hooks/
bun test tests/bun/databases/
```

Or use the automated script:

```bash
# Automatically starts server, waits for ready, runs tests
bun run test:integration
```

### E2E Tests (Requires Server + Browser)

```bash
# Automated (recommended)
bun run test:e2e  # Starts server, seeds DB, runs Playwright

# Manual
# Terminal 1: Start server
bun run dev

# Terminal 2: Seed database
bun run scripts/seed-test-db.ts

# Terminal 3: Run Playwright
bun x playwright test tests/playwright/
```

### Smart Testing (Local Development)

```bash
# Intelligent test runner
bun run scripts/test-smart.ts
```

This script:

1. Checks if server is running (starts if needed)
2. Detects if system is configured
3. Runs appropriate tests (setup tests OR full suite)
4. Cleans up after itself

---

## Test Status & Coverage

**Current Status (November 21, 2025)**

| Category          | Passing | Failing | Skipped | Total   |
| ----------------- | ------- | ------- | ------- | ------- |
| Unit Tests        | 350     | 0       | 0       | 350     |
| Integration Tests | 53      | 172     | 40      | 265     |
| E2E Tests         | TBD     | TBD     | TBD     | ~40     |
| **TOTAL**         | **403** | **172** | **40**  | **615** |

**Recently Fixed âœ…**

- `tests/bun/hooks/authorization.test.ts` (22 tests) - Fixed mock database adapter
- `tests/bun/hooks/theme.test.ts` (40 tests) - Fixed mockResolve signature
- `tests/bun/hooks/firewall.test.ts` (27 tests) - Fixed logger import

**Known Issues âš ï¸**

- **172 failing tests** in API integration and Setup middleware
- **Root cause**: Server connection timeouts in test environment
- **Fix in progress**: Improving test environment setup

[See Test Status Report](/docs/tests/test-status) for detailed breakdown.

---

## Documentation Index

### Core Testing Guides

- [Test Status Report](/docs/tests/test-status) - Current pass/fail rates, known issues
- [E2E Testing Guide](/docs/tests/e2e) - Playwright setup and best practices
- [Git Workflow & CI/CD](/docs/tests/git-workflow) - GitHub Actions automation

### Coverage Reports

- [API Test Coverage](/docs/tests/api-coverage) - REST API endpoint testing (460+ tests)
- [Hook Test Coverage](/docs/tests/hook-coverage) - Middleware hooks (11 hooks, 485+ tests)
- [Store Test Coverage](/docs/tests/store-coverage) - Svelte stores (system, UI, loading)
- [Widget Test Coverage](/docs/tests/widget-coverage) - Widget validation and security
- [Utility Test Coverage](/docs/tests/utility-coverage) - Helper functions and utilities

### Specific Test Documentation

- [API Test Summary](/docs/tests/api-summary) - Quick API test overview
- [User API Tests](/docs/tests/user-api-tests) - User management endpoint tests
- [Database Tests](/docs/tests/database-tests) - Database adapter testing

---

## Why Bun for Testing SveltyCMS?

SveltyCMS is an agnostic headless SvelteKit CMS - it works with multiple databases and focuses on API-first architecture. Bun is the perfect testing framework for this use case:

### ðŸš€ Speed & Performance

**Lightning-Fast Execution**

- Up to 100x faster than Jest/Mocha
- Our 76-test utility suite completes in ~1.5 seconds
- Full API test suite (460+ tests) completes in ~15-20 seconds
- Instant feedback during development

**Why Speed Matters for a Headless CMS:**

- Rapid iteration on API endpoints
- Quick validation of database operations
- Immediate feedback on widget validation and security
- Faster CI/CD pipelines = faster releases

### ðŸŽ¯ Perfect Match for Headless CMS Architecture

**Database Agnostic Testing**

- SveltyCMS supports MongoDB, PostgreSQL, MySQL, MariaDB
- Bun's speed allows testing against multiple database adapters without painful wait times
- Future: Matrix testing across all databases in parallel

**Headless CMS Requirements**

- REST API testing (460+ endpoint tests)
- GraphQL API validation
- Widget system testing (security, validation, rendering)
- Multi-tenant isolation testing
- Cache layer verification (Redis operations)
- Authentication & authorization flows

### Native TypeScript Support

- Zero configuration - Bun runs `.ts` files directly
- No transpilation overhead
- Perfect for SvelteKit's TypeScript-first approach
- Type-safe test code matches production code

### âš¡ Built-in Features

```typescript
// Just import and go - no jest.config.js, no babel setup
import { describe, it, expect, mock } from 'bun:test';

// Native mocking
const mockFn = mock(() => 'mocked value');

// Async/await support
it('should handle async operations', async () => {
	const result = await fetchData();
	expect(result).toBeDefined();
});
```

---

## Test Organization

### Directory Structure

```
tests/
â”œâ”€â”€ bun/                    # Bun unit & integration tests
â”‚   â”œâ”€â”€ setup.ts           # Global test setup
â”‚   â”œâ”€â”€ mocks/             # Mock implementations
â”‚   â”œâ”€â”€ api/               # API integration tests
â”‚   â”œâ”€â”€ databases/         # Database adapter tests
â”‚   â”œâ”€â”€ hooks/             # Middleware hook tests
â”‚   â”œâ”€â”€ services/          # Service layer tests
â”‚   â”œâ”€â”€ stores/            # Svelte store tests
â”‚   â”œâ”€â”€ utils/             # Utility function tests
â”‚   â””â”€â”€ widgets/           # Widget validation tests
â”‚
â”œâ”€â”€ playwright/            # Playwright E2E tests
â”‚   â”œâ”€â”€ setup-wizard.spec.ts
â”‚   â”œâ”€â”€ login.spec.ts
â”‚   â””â”€â”€ helpers/           # Test helpers
â”‚
â””â”€â”€ scripts/               # Test automation scripts
    â”œâ”€â”€ seed-test-db.ts    # Database seeding for tests
    â””â”€â”€ test-smart.ts      # Intelligent test runner
```

### Test File Naming Convention

- **Unit Tests**: `*.test.ts` (e.g., `SecurityResponseService.test.ts`)
- **Integration Tests**: `*.test.ts` in `api/`, `hooks/`, `databases/`
- **E2E Tests**: `*.spec.ts` (e.g., `login.spec.ts`)

---

## Best Practices

### For Developers

1. **Run tests locally before committing**
   ```bash
   bun run test:unit  # Quick sanity check
   ```
2. **Write tests for new features**
   - Unit tests for business logic
   - Integration tests for API endpoints
   - E2E tests for critical user flows (if needed)
3. **Use watch mode during development**
   ```bash
   bun test --watch tests/bun/services/MyNewService.test.ts
   ```
4. **Check CI before merging**
   - All tests must pass in GitHub Actions
   - Review test failures in PR checks

### For Test Writers

1. **Follow existing patterns**
   - See [Hook Test Coverage](/docs/tests/hook-coverage) for examples
2. **Use descriptive test names**
   ```typescript
   it('should return 401 for unauthenticated API requests', async () => {
   	// Test implementation
   });
   ```
3. **Mock external dependencies**
   ```typescript
   import { mock } from 'bun:test';
   const mockDb = mock(() => ({ users: [] }));
   ```
4. **Test edge cases**
   - Empty inputs
   - Invalid data
   - Error conditions

---

## Troubleshooting

### Common Issues

**"Server did not start in time"**

- Check if port 5173 is already in use
- Run `bun run dev` manually to see errors
- Increase timeout in `scripts/seed-test-db.ts`

**"Cannot find module '@src/...'"**

- Ensure `bunfig.toml` has correct path aliases
- Run `bun install` to refresh dependencies

**"Test timeout"**

- Integration tests need running server
- Use `bun run test:integration` (auto-starts server)
- Or start server manually in separate terminal

**"Database connection failed"**

- Ensure MongoDB is running (for integration/E2E tests)
- Check `DB_HOST`, `DB_PORT`, `DB_NAME` env vars
- Run `bun run scripts/seed-test-db.ts` manually to debug

---

## Contributing

**When adding new tests:**

1. **Choose the right test type**:
   - Unit test: Pure functions, no external dependencies
   - Integration test: API endpoints, database operations
   - E2E test: Critical user journeys only
2. **Update documentation**:
   - Add test count to relevant coverage report
   - Update this index if adding new test category
3. **Verify in CI**:
   - Push to PR and check GitHub Actions
   - All tests must pass before merge

---

## Related Documentation

- [Architecture Overview](/docs/architecture)
- [API Documentation](/docs/api)
- [Contributing Guide](/docs/contributing)
- [Development Setup](/docs/development)
