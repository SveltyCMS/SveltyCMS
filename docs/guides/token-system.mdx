path: 'docs/guides/token-system.mdx'
title: 'Enterprise Token System'
description: 'Comprehensive guide to the SveltyCMS dynamic token engine, builder UI, modifier system, and automation use cases.'
order: 10
icon: 'mdi:code-braces'
author: 'admin'
created: '2025-11-23'
updated: '2025-11-24'
tags:

'tokens'

'templating'

'dynamic-content'

'personalization'

'automation'

Enterprise Token System

The SveltyCMS Token System acts as a dynamic bridge between your raw content and your published output. It allows you to define content logic (e.g., "This title should always be the entry name + site name") rather than static text.

This document serves as both an Architecture Reference for developers and an Automation Guide for content editors.

1. System Architecture

The system follows a "Save Raw, Render Dynamic" philosophy. This decoupling ensures your content is future-proof; changing a global setting updates every piece of content instantly without database migrations.

Data Flow Diagram

graph TD
subgraph Editor["Content Editor (SvelteKit)"]
Input[Input Field] -->|Focus| Picker[Token Picker UI]
Picker -->|Select| Token["{{entry.title}}"]
Token -->|Insert| Input
Input -->|Save| DB[(Database)]
end

    subgraph Engine["Token Engine (Server)"]
        Request[API Request] -->|Fetch| DB
        DB -->|Raw Data| Resolution[Resolution Service]
        Resolution -->|Lookup| Registry{Token Registry}
        Registry -->|Entry Data| Context
        Registry -->|Site Config| Context
        Registry -->|User Info| Context
        Resolution -->|Apply| Modifiers[Modifiers (upper, slug)]
    end

    subgraph Output["Final Response"]
        Resolution -->|Rendered String| JSON[API Response]
        JSON --> Frontend[Headless Frontend]
    end

    style Editor fill:#f9f,stroke:#333,stroke-width:2px
    style Engine fill:#bbf,stroke:#333,stroke-width:2px

Core Components

Registry (src/services/token/engine.ts): The brain that discovers available data points. It uses O(1) Map lookups for performance and scans Schema, Config, and User sessions.

UI (src/components/TokenPicker.svelte): A floating, draggable interface that appears when editing token-aware fields.

Interceptors (src/hooks.server.ts): Middleware that automatically resolves tokens in API responses before they reach the client.

2. Collection Automation Use Cases

Tokens are most powerful when used to automate repetitive content tasks. Here are standard patterns for Collection configuration.

Use Case A: Automated SEO Meta Titles

Instead of manually writing SEO titles for every blog post, use tokens to enforce a standard format.

Field: meta_title

Token Pattern: {{entry.title}} | {{site.SITE_NAME}}

Result: If your post is "Hello World" and site is "Svelty", the API returns: Hello World | Svelty.

Benefit: If you rebrand to "SuperCMS", all SEO titles update instantly.

Use Case B: URL Slug Generation

Ensure URLs are always valid, lowercase, and URL-friendly.

Field: slug

Token Pattern: {{entry.title | slug}}

Result: Input "My Cool Post!" becomes my-cool-post.

Benefit: Eliminates human error in URL creation.

Use Case C: Dynamic Email Templates

Personalize automated emails sent by the system (e.g., welcome emails or order confirmations).

Field: email_body

Token Pattern:

Hello {{user.name | default:'Valued Customer'}},

Thank you for your order!
Date: {{system.now | date('YYYY-MM-DD')}}

Result: "Hello Alice, Thank you for your order! Date: 2025-11-24"

3. User Guide: The Token Builder

The system features a visual Token Builder UI that allows you to find, configure, and format data without writing code.

Step 1: Activation

Click the token icon { } inside any supported input field. The Token Window will appear.

Step 2: Selection

Browse tokens by category (User, Site, Entry, System) or use the search bar.

Step 3: Configuration (Builder Mode)

Once you select a token, the UI enters Builder Mode. Here you can add Modifiers to transform the data.

Add Modifiers: Click buttons like + UPPERCASE or + DATE.

Configure Arguments: Set options like date formats (YYYY-MM-DD) or truncation length.

Live Preview: See the exact code (e.g., {{system.now | date('YYYY')}}) before inserting.

4. Modifier Reference

Modifiers transform data using the pipe | syntax.

Text & Formatting

Modifier

Description

Example Input

Result

upper

Uppercase

hello

HELLO

capitalize

Capitalize first letter

hello world

Hello world

slug

URL-friendly slug

Hello World!

hello-world

truncate(len, suffix)

Shorten text

Long text...

Long...

Logic & Control

Modifier

Description

Syntax

default(val)

Fallback if empty

`{{title

if(trueVal, falseVal)

Conditional logic

`{{price

eq(val) / ne(val)

Equals / Not Equals

`{{role

gt(val) / lt(val)

Greater/Less than

`{{views

Date & Math

Modifier

Description

Example

date(format)

Formats ISO dates

`{{now

add(n) / subtract(n)

Math operations

`{{price

5. Developer Guide

Security Features

Allow-listing: The engine explicitly blocks access to sensitive User fields (like password, hash, salt). Only safe fields (email, name, role) are exposed.

Recursion Protection: The engine detects infinite loops (e.g., Token A -> Token B -> Token A) and halts execution after a configurable depth (default: 10).

Escaping: Users can type \{{token}} to display the literal code without triggering replacement.

Adding Custom Tokens

Inject custom tokens (e.g., from an external API) via the registry configuration in src/services/token/engine.ts.

TokenRegistry.getTokens(schema, user, {
customTokens: [{
token: 'weather.current',
name: 'Current Temp',
category: 'system',
type: 'number',
resolve: async () => await fetchWeather() // Async supported!
}]
});
