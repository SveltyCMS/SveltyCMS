---
path: 'docs/api/Media_API.mdx'
title: 'Media API Reference'
description: 'Complete API reference for uploading, managing, and serving media files in SveltyCMS with support for local and cloud storage.'
order: 5
icon: 'mdi:image-multiple'
author: 'admin'
created: '2025-10-05'
updated: '2025-11-06'
tags:
  - 'api'
  - 'media'
  - 'upload'
  - 'files'
  - 'images'
  - 'cloud-storage'
  - 's3'
  - 'r2'
  - 'cloudinary'
---

# Media API Reference

## Overview

The Media API provides a robust and type-safe system for managing media files (images, videos, documents) in SveltyCMS. All operations are handled by the `MediaService`, which uses a database-agnostic adapter and supports multi-tenancy.

**Storage Support:**
- **Local Storage**: Files stored on the server filesystem.
- **Cloud Storage**: S3, Cloudflare R2, or Cloudinary.

**Base Path:** `/api/media`

## MediaItem Data Structure

When a file is uploaded, it is stored as a `MediaItem` document in the database. This provides rich metadata and versioning.

```typescript
interface MediaItem {
  _id: string;          // Unique database ID
  filename: string;       // Original filename
  hash: string;           // SHA-256 hash of the file content
  path: string;           // Relative storage path (e.g., "global/original/image-hash.jpg")
  url: string;            // Publicly accessible URL
  mimeType: string;       // File MIME type
  size: number;           // File size in bytes
  createdBy: string;      // ID of the user who uploaded the file
  createdAt: string;      // ISODateString of creation time
  updatedAt: string;      // ISODateString of last update time
  thumbnails: {           // Auto-generated for images (except SVG)
    [key: string]: {
      url: string;
      width: number;
      height: number;
    };
  };
  metadata: {             // Additional metadata
    originalFilename: string;
    uploadedBy: string;
    uploadTimestamp: string;
    [key: string]: any;
  };
  access: MediaAccess[];  // Access control rules
}
```

## Storage Architecture

SveltyCMS supports multiple storage backends configured via system settings.

### Storage Types

- `local` - Files stored on the server filesystem (default).
- `s3` - Amazon S3 or other S3-compatible services.
- `r2` - Cloudflare R2 (which is S3-compatible).
- `cloudinary` - Cloudinary media platform.

### Configuration Explained

#### Local Storage (Default)

```javascript
// System Settings
{
  "MEDIA_STORAGE_TYPE": "local",
  "MEDIA_FOLDER": "./mediaFolder" // Filesystem path relative to the project root
}
```

#### S3-Compatible Storage (S3 & R2)

For S3-compatible storage, a bucket name is required. The `MEDIA_FOLDER` acts as a prefix (subfolder) within the bucket.

```javascript
// System Settings
{
  "MEDIA_STORAGE_TYPE": "s3", // or "r2"
  "MEDIA_BUCKET_NAME": "your-s3-bucket-name",      // **Required**: The name of your S3 bucket.
  "MEDIA_FOLDER": "cms-media",                   // Optional: A prefix to organize files within the bucket.
  "MEDIA_CLOUD_REGION": "us-east-1",
  "MEDIA_CLOUD_ENDPOINT": "https://s3.amazonaws.com", // Optional for AWS S3, required for other providers.
  "MEDIA_CLOUD_PUBLIC_URL": "https://cdn.example.com" // The public URL of your bucket/CDN.
}
```

#### Cloudinary

```javascript
// System Settings
{
  "MEDIA_STORAGE_TYPE": "cloudinary",
  "MEDIA_FOLDER": "cms-media" // A folder name within your Cloudinary account.
}

// Environment Variables (required)
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret
```

## Authentication

All media endpoints require an authenticated session via a cookie.

```http
Cookie: session=your-session-id
```

## Endpoints

### 1. Upload a File

Uploads one or more files. The files are processed by `MediaService` and saved as `MediaItem` documents.

#### Request

```http
POST /api/media/process
```

**Headers:**
```http
Content-Type: multipart/form-data
```

**Body (multipart/form-data):**
- `files` (File): One or more files to upload.
- `folder` (string, optional): A virtual folder path to associate the media with.
- `alt` (string, optional): Alt text for images.

**Permissions Required:** `media:write` or authenticated user.

#### Response (Success 200)

A `MediaItem` object for each successfully uploaded file.

```json
{
  "success": true,
  "files": [
    {
      "_id": "db_id_string",
      "filename": "photo.jpg",
      "hash": "a1b2c3d4e5f6",
      "path": "global/original/photo-a1b2c3d4e5f6.jpg",
      "url": "https://cdn.example.com/global/original/photo-a1b2c3d4e5f6.jpg",
      "mimeType": "image/jpeg",
      "size": 123456,
      "createdBy": "user_id_string",
      "createdAt": "2025-11-06T10:00:00.000Z",
      "updatedAt": "2025-11-06T10:00:00.000Z",
      "thumbnails": {
        "small": { "url": "...", "width": 400, "height": 300 },
        "medium": { "url": "...", "width": 800, "height": 600 }
      },
      "metadata": {
        "originalFilename": "photo.jpg",
        "uploadedBy": "user_id_string",
        "uploadTimestamp": "2025-11-06T10:00:00.000Z"
      }
    }
  ],
  "message": "Files uploaded successfully"
}
```

---

### 2. List Media Files

Retrieves a paginated list of `MediaItem` documents.

#### Request

```http
GET /api/media
```

**Query Parameters:**
- `limit` (number, optional): Max files per page (default: 20).
- `page` (number, optional): Page number to retrieve (default: 1).
- `folder` (string, optional): Filter by virtual folder path.
- `type` (string, optional): Filter by MIME type (e.g., `image/jpeg`).

**Permissions Required:** `media:read` or authenticated user.

#### Response (Success 200)

```json
{
  "success": true,
  "media": [
    // Array of MediaItem objects
  ],
  "total": 42
}
```

---

### 3. Get Media File Details

Retrieves a single `MediaItem` by its ID.

#### Request

```http
GET /api/media/[id]
```

**Permissions Required:** `media:read` or authenticated user.

#### Response (Success 200)

A single `MediaItem` object.

```json
{
  "success": true,
  "data": {
    // A MediaItem object
  }
}
```

---

### 4. Update Media File Metadata

Updates the metadata of a `MediaItem`. This does not change the file itself.

#### Request

```http
PATCH /api/media/[id]
```

**Body (JSON):**
```json
{
  "filename": "A Better Name.jpg",
  "metadata": {
    "alt": "A descriptive alt text.",
    "tags": ["nature", "mountain"]
  }
}
```

**Permissions Required:** `media:update` or file owner.

#### Response (Success 200)

```json
{
  "success": true,
  "message": "Media file updated successfully"
}
```

---

### 5. Delete a Media File

Permanently deletes a media file from both the database and the storage provider (local or cloud).

#### Request

```http
DELETE /api/media/[id]
```

**Permissions Required:** `media:delete` or admin.

#### Response (Success 200)

```json
{
  "success": true,
  "message": "Media deleted successfully"
}
```
