---
path: 'docs/architecture/initialization-workflow.mdx'
title: 'SveltyCMS Complete Workflow Guide'
description: 'Comprehensive guide covering installation, initialization, testing, and CI/CD workflows for SveltyCMS'
order: 10
icon: 'mdi:workflow'
author: 'admin'
created: '2025-10-14'
updated: '2025-10-25'
tags:
  - 'architecture'
  - 'initialization'
  - 'setup'
  - 'workflow'
  - 'collections'
  - 'installation'
  - 'testing'
  - 'ci-cd'
---

# SveltyCMS Complete Workflow Guide

This comprehensive guide covers the entire SveltyCMS lifecycle: installation, first-time setup, server restart workflows, testing strategies, and automated CI/CD deployment. The system is designed to be intelligent, avoiding unnecessary recompilation while maintaining UUID consistency for collections.

> **ğŸ“š This unified guide replaces:** `installation.mdx`, `testing.mdx`, and `TESTING_GUIDE.md.old`

---

## Table of Contents

### Part I: Installation & Setup

1. [Prerequisites](#prerequisites)
2. [Quick Installation](#quick-installation)
3. [Manual Installation](#manual-installation)
4. [First-Time Setup Flow](#first-time-setup-flow)
5. [Post-Installation Configuration](#post-installation-configuration)

### Part II: System Architecture

6. [Visual Overview](#visual-overview)
7. [Server Restart Flow](#server-restart-flow)
8. [Collection UUID Management](#collection-uuid-management)
9. [Key Components](#key-components)
10. [State Machine](#state-machine)

### Part III: Testing & CI/CD

11. [Testing Overview](#testing-overview)
12. [Unit Testing with Bun](#unit-testing-with-bun)
13. [E2E Testing with Playwright](#e2e-testing-with-playwright)
14. [GitHub Actions CI/CD](#github-actions-cicd)
15. [Automated Setup Scripts](#automated-setup-scripts)

### Part IV: Troubleshooting & Reference

16. [Known Issues](#known-issues)
17. [Troubleshooting](#troubleshooting)
18. [Best Practices](#best-practices)
19. [Quick Reference](#quick-reference)

---

# Part I: Installation & Setup

## Prerequisites

Before installing SveltyCMS, ensure you have the following installed:

### Required Software

#### 1. Node.js (v20.10.0 or higher recommended)

- **Download:** [https://nodejs.org/](https://nodejs.org/)
- **Check version:** `node --version`
- **Why:** Runtime environment for JavaScript

#### 2. Package Manager

Choose one of the following:

- **Bun** (recommended for speed)
  ```bash
  curl -fsSL https://bun.sh/install | bash
  ```
- **npm** (comes with Node.js)
  ```bash
  npm --version
  ```
- **Yarn**
  ```bash
  npm install -g yarn
  ```
- **pnpm**
  ```bash
  npm install -g pnpm
  ```

#### 3. Git

- **Download:** [https://git-scm.com/](https://git-scm.com/)
- **Check version:** `git --version`
- **Why:** Version control and repository cloning

#### 4. Database

**MongoDB** (recommended for first install)

- **MongoDB Atlas** (cloud): [https://www.mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)
- **Local MongoDB**: [https://www.mongodb.com/try/download/community](https://www.mongodb.com/try/download/community)
- **Connection string format:**
  - Local: `mongodb://localhost:27017/sveltycms`
  - Atlas: `mongodb+srv://username:password@cluster.mongodb.net/dbname`

**MariaDB/MySQL** (alternative)

- **Download:** [https://mariadb.org/download/](https://mariadb.org/download/)
- **Connection format:** `host:port` (e.g., `localhost:3306`)

---

## Quick Installation

The fastest way to get started with SveltyCMS.

### Step 1: Clone Repository

```bash
git clone https://github.com/SveltyCMS/SveltyCMS.git
cd SveltyCMS
```

### Step 2: Install Dependencies

Choose your package manager:

<details open>
<summary><b>Bun (fastest)</b></summary>

```bash
bun install
bun run dev
```

</details>

<details>
<summary><b>npm</b></summary>

```bash
npm install
npm run dev
```

</details>

<details>
<summary><b>Yarn</b></summary>

```bash
yarn install
yarn dev
```

</details>

<details>
<summary><b>pnpm</b></summary>

```bash
pnpm install
pnpm dev
```

</details>

### Step 3: Setup Wizard

The setup wizard launches automatically on first run at `http://localhost:5173/setup`:

1. **Database Configuration**
   - Choose: MongoDB, MariaDB, or PostgreSQL
   - Enter connection details
   - Test connection automatically

2. **Database Driver Installation**
   - Automatically installs required drivers
   - Detects your package manager
   - Handles dependencies

3. **System Language Selection**
   - Choose default language
   - Configures internationalization

4. **Initial Data Seeding**
   - Seeds system settings (53 keys)
   - Creates default theme
   - Sets up base configuration

5. **Admin User Creation**
   - Set admin email
   - Create secure password
   - Generate session secrets

6. **Completion**
   - Builds and starts development server
   - Opens CMS dashboard automatically
   - No server restart required! âœ¨

---

## Manual Installation

For advanced users who need more control over the installation process.

### Step 1: Clone and Install

```bash
git clone https://github.com/SveltyCMS/SveltyCMS.git
cd SveltyCMS
bun install  # or npm/yarn/pnpm
```

### Step 2: Install Database Driver

Install the driver for your chosen database:

```bash
# MongoDB
bun add mongoose

# MariaDB/MySQL
bun add mariadb

# PostgreSQL (when available)
bun add pg
```

### Step 3: Create Environment File

Create `config/private.ts` in the project root:

```typescript
import { createPrivateConfig } from '../src/utils/config';

export const privateEnv = createPrivateConfig({
	// Database Configuration
	DB_TYPE: 'mongodb',
	DB_HOST: 'localhost',
	DB_PORT: 27017,
	DB_NAME: 'sveltycms',
	DB_USER: 'admin',
	DB_PASSWORD: 'your_secure_password',

	// Security (generate with: openssl rand -hex 32)
	JWT_SECRET_KEY: 'your_generated_secret_here',
	ENCRYPTION_KEY: 'your_encryption_key_here',

	// Multi-Tenancy (optional)
	MULTI_TENANT: false
});
```

**Generate Secure Secrets:**

```bash
# Using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Using OpenSSL
openssl rand -base64 32
```

### Step 4: Test Database Connection

Start the development server and test the connection:

```bash
bun run dev
```

Visit `http://localhost:5173/setup` or use the API directly:

```bash
curl -X POST http://localhost:5173/api/setup/test-database \
  -H "Content-Type: application/json" \
  -d '{
    "type": "mongodb",
    "host": "localhost",
    "port": 27017,
    "name": "sveltycms",
    "user": "admin",
    "password": "your_password"
  }'
```

### Step 5: Seed Initial Data

Run the seed script or use the API:

```bash
# Using seed script (recommended for CI/CD)
bun run scripts/seed-cms.js

# Or through the setup wizard at /setup
```

### Step 6: Create Admin User

```bash
# Using create-admin script (recommended for CI/CD)
bun run scripts/create-admin.js

# Or through the setup wizard at /setup
```

---

## Post-Installation Configuration

After completing installation, configure your SveltyCMS instance:

### 1. Login to Admin Panel

Visit `http://localhost:5173/admin` (or your custom URL) and login with your admin credentials.

### 2. Configure System Settings

Navigate to **Settings** and configure:

- **Site Information**: Name, description, URL
- **Default Language**: Choose primary language
- **Theme Preferences**: Light/dark mode, accent colors
- **Email Settings**: SMTP configuration for notifications
- **Cache Settings**: Enable/disable caching, Redis configuration

### 3. Create Collections

Navigate to **Collections** to:

- Create content collections (Posts, Pages, etc.)
- Define field schemas
- Set up relationships between collections
- Configure permissions

### 4. Set Up Users

Navigate to **Users** to:

- Create additional user accounts
- Assign roles (admin, editor, viewer)
- Configure permissions
- Manage user sessions

### 5. Install Widgets

Navigate to **Widgets** to:

- Browse available widgets
- Install additional functionality
- Activate required widgets
- Configure widget settings

---

## Development & Production

### Development Server

Start the development server with hot module reload:

```bash
# Using Bun (recommended)
bun run dev

# Using npm
npm run dev

# Using Yarn
yarn dev

# Using pnpm
pnpm dev
```

The server will start at:

- **Frontend:** `http://localhost:5173`
- **Admin Panel:** `http://localhost:5173/admin`
- **API:** `http://localhost:5173/api`
- **GraphQL:** `http://localhost:5173/api/graphql`

### Production Build

Build for production:

```bash
# Build
bun run build

# Preview production build
bun run preview
```

### Deployment Options

#### Vercel

```bash
npm install -g vercel
vercel --prod
```

#### Netlify

```bash
npm install -g netlify-cli
netlify deploy --prod
```

#### Docker

```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["node", "build"]
```

```bash
docker build -t sveltycms .
docker run -p 3000:3000 --env-file .env sveltycms
```

#### Traditional Server (PM2)

```bash
npm install -g pm2
npm run build
pm2 start build/index.js --name sveltycms
pm2 save
pm2 startup
```

### Production Environment Variables

Ensure these are set in production:

```bash
NODE_ENV=production
SITE_URL=https://your-domain.com
PUBLIC_URL=https://your-domain.com

# Use strong secrets!
JWT_SECRET_KEY=<generate-with-openssl-rand-base64-32>
ENCRYPTION_KEY=<generate-with-openssl-rand-base64-32>
```

---

## Directory Structure

After installation, your project structure:

```
SveltyCMS/
â”œâ”€â”€ build/                      # Production build output
â”œâ”€â”€ config/                     # Configuration files
â”‚   â”œâ”€â”€ private.ts             # Database credentials (auto-generated)
â”‚   â”œâ”€â”€ roles.ts               # Role definitions
â”‚   â””â”€â”€ collections/           # Collection schemas (user-created)
â”œâ”€â”€ compiledCollections/        # Compiled collections (auto-generated)
â”‚   â”œâ”€â”€ Collections/
â”‚   â””â”€â”€ Menu/
â”œâ”€â”€ docs/                       # Documentation
â”œâ”€â”€ scripts/                    # Automation scripts
â”‚   â”œâ”€â”€ seed-cms.js            # Database seeding script
â”‚   â””â”€â”€ create-admin.js        # Admin user creation script
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/                # SvelteKit routes
â”‚   â”‚   â”œâ”€â”€ admin/            # Admin panel
â”‚   â”‚   â”œâ”€â”€ api/              # API endpoints
â”‚   â”‚   â””â”€â”€ setup/            # Setup wizard
â”‚   â”œâ”€â”€ databases/             # Database adapters
â”‚   â”œâ”€â”€ widgets/               # Widget system
â”‚   â”œâ”€â”€ components/            # Svelte components
â”‚   â”œâ”€â”€ stores/                # Svelte stores
â”‚   â””â”€â”€ utils/                 # Utility functions
â”œâ”€â”€ static/                     # Static assets
â”œâ”€â”€ tests/                      # Test files
â”‚   â”œâ”€â”€ bun/                   # Unit tests
â”‚   â””â”€â”€ playwright/            # E2E tests
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/             # GitHub Actions
â”‚       â”œâ”€â”€ playwright.yml     # Test workflow
â”‚       â””â”€â”€ auto-release.yaml  # Release workflow
â”œâ”€â”€ package.json
â”œâ”€â”€ svelte.config.js
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ playwright.config.ts
â”œâ”€â”€ bunfig.toml
â””â”€â”€ tsconfig.json
```

---

---

# Part II: System Architecture

## Visual Overview

### Complete System Lifecycle

```mermaid
graph TB
    subgraph "First-Time Setup"
        A1[Fresh Install] -->|No private.ts| A2[Vite: Setup Mode]
        A2 --> A3[Create Blank Config]
        A3 --> A4[Open /setup Wizard]
        A4 --> A5[User: Enter DB Config]
        A5 --> A6[API: test-database]
        A6 -->|âœ“ Valid| A7[User: Select Language]
        A7 --> A8[API: seed]
        A8 --> A9[Write Credentials]
        A8 --> A10[Seed Settings/Themes]
        A8 --> A11[Create Collections]
        A11 --> A12[User: Admin Form]
        A12 --> A13[API: complete]
        A13 --> A14[Create Admin + Session]
        A13 --> A15[Init Global System]
        A13 --> A16[ContentManager Init]
        A16 --> A17[READY State]
    end

    subgraph "Server Restart"
        B1[Server Start] -->|private.ts exists| B2[Vite: Normal Mode]
        B2 --> B3[Scan Compiled Collections]
        B3 --> B4{For Each Collection}
        B4 --> B5{Hash Changed?}
        B5 -->|No| B6[Skip - Preserve UUID]
        B5 -->|Yes| B7[Recompile - Keep UUID]
        B6 --> B8[First Request]
        B7 --> B8
        B8 --> B9[handleSystemState]
        B9 --> B10[dbInitPromise]
        B10 --> B11[Connect Database]
        B11 --> B12[Load Settings]
        B12 --> B13[Init Services]
        B13 --> B14[READY State]
    end

    A17 -.->|Restart Server| B1

    style A1 fill:#f0f0f0,stroke:#333,stroke-width:3px
    style A4 fill:#e0e0e0,stroke:#333,stroke-width:2px
    style A8 fill:#e0e0e0,stroke:#333,stroke-width:2px
    style A13 fill:#e0e0e0,stroke:#333,stroke-width:2px
    style A17 fill:#d0d0d0,stroke:#333,stroke-width:4px
    style B1 fill:#f0f0f0,stroke:#333,stroke-width:3px
    style B7 fill:#e0e0e0,stroke:#333,stroke-width:2px
    style B14 fill:#d0d0d0,stroke:#333,stroke-width:4px
```

### First-Time Setup Architecture

```mermaid
graph TB
    A[Vite Startup] -->|No private.ts| B[setupWizardPlugin]
    B --> C[Create Blank private.ts]
    B --> D[Compile Collections]
    B --> E[Open /setup in Browser]

    E --> F[User: DB Config]
    F --> G[API: test-database]
    G -->|Success| H[User: System Language]

    H --> I[API: seed]
    I --> J[Write private.ts]
    I --> K[Seed Settings]
    I --> L[Seed Themes]
    I --> M[Seed Collections]

    M --> N[User: Admin Form]
    N --> O[API: complete]
    O --> P[Create Admin User]
    O --> Q[Initialize Global System]
    O --> R[Initialize ContentManager]
    O --> S[Set Session Cookie]

    S --> T[Redirect to CMS]

    style A fill:#f0f0f0,stroke:#333,stroke-width:3px
    style E fill:#e0e0e0,stroke:#333,stroke-width:2px
    style I fill:#e0e0e0,stroke:#333,stroke-width:2px
    style O fill:#e0e0e0,stroke:#333,stroke-width:2px
    style T fill:#d0d0d0,stroke:#333,stroke-width:4px
```

### Server Restart Architecture

```mermaid
graph TB
    A[Vite Startup] -->|private.ts exists| B[cmsWatcherPlugin]
    B --> C[Scan Compiled Collections]
    C --> D{For Each Collection}

    D --> E{Hash Changed?}
    E -->|No| F[Skip Compilation]
    E -->|Yes| G[Recompile]

    F --> H[Preserve UUID]
    G --> H

    H --> I[First HTTP Request]
    I --> J[handleSystemState]
    J --> K[dbInitPromise]
    K --> L[Load private.ts]
    K --> M[Connect to Database]
    K --> N[Load Settings]
    K --> O[Initialize Services]

    O --> P[READY State]
    P --> Q[ContentManager Auto-Init]
    Q --> R[Register Collections]

    style A fill:#f0f0f0,stroke:#333,stroke-width:3px
    style B fill:#e0e0e0,stroke:#333,stroke-width:2px
    style G fill:#e0e0e0,stroke:#333,stroke-width:2px
    style H fill:#d0d0d0,stroke:#333,stroke-width:3px
    style P fill:#d0d0d0,stroke:#333,stroke-width:4px
```

---

## First-Time Setup Flow

### Phase 1: Vite Startup (Build Time)

**File: `vite.config.ts`**

```mermaid
sequenceDiagram
    participant Vite
    participant FS as Filesystem
    participant Browser

    Note over Vite: Startup Check
    Vite->>FS: Check config/private.ts exists?
    FS-->>Vite: âŒ Not found

    Note over Vite: Setup Mode Activated
    Vite->>FS: Create blank private.ts
    Vite->>FS: Create placeholder collections
    Vite->>FS: Compile any existing collections

    Note over Vite: Open Setup Wizard
    Vite->>Browser: Open http://localhost:5173/setup

    Note over Browser: User sees setup wizard
```

**Created `config/private.ts`:**

```typescript
export const privateEnv = createPrivateConfig({
	DB_TYPE: 'mongodb',
	DB_HOST: '', // â† Empty values
	DB_PORT: 27017,
	DB_NAME: '', // â† Empty values
	DB_USER: '',
	DB_PASSWORD: '',
	JWT_SECRET_KEY: '', // â† Empty
	ENCRYPTION_KEY: '', // â† Empty
	MULTI_TENANT: false
});
```

### Phase 2: Server Hooks (Runtime)

**File: `src/hooks.server.ts`**

> **ğŸ“š For detailed middleware architecture, see [Server Hooks & Middleware](./server-hooks.mdx)**

```mermaid
flowchart TB
    A[Incoming Request] --> B{handleSystemState}
    B -->|System: IDLE| C{handleSetup}

    C -->|Check Config| D{private.ts valid?}
    D -->|No DB creds| E[isSetupComplete = false]

    E --> F{Path check}
    F -->|/setup or /api/setup| G[Allow Request]
    F -->|Other paths| H[Redirect to /setup]

    C -->|Check Database| I{hasAdminUsers?}
    I -->|No| E
    I -->|Yes| J[Allow Request - Setup Complete]

    style E fill:#d0d0d0,stroke:#333,stroke-width:3px
    style G fill:#e0e0e0,stroke:#333,stroke-width:2px
    style J fill:#e0e0e0,stroke:#333,stroke-width:2px
```

### Phase 3: Setup GUI Interaction

**File: `src/routes/setup/+page.svelte`**

```mermaid
stateDiagram-v2
    [*] --> DatabaseConfig: Step 1
    DatabaseConfig --> DatabaseTest: User fills DB form
    DatabaseTest --> SystemLanguage: Test passed âœ“
    SystemLanguage --> SeedData: Language selected
    SeedData --> AdminUser: Database seeded âœ“
    AdminUser --> Complete: Admin form submitted
    Complete --> [*]: Redirect to CMS

    DatabaseTest --> DatabaseConfig: Test failed âœ—

    note right of DatabaseTest
        POST /api/setup/test-database
        - Validates connection
        - Installs drivers if needed
    end note

    note right of SeedData
        POST /api/setup/seed
        - Writes private.ts
        - Seeds settings/themes
        - Creates collections
    end note

    note right of Complete
        POST /api/setup/complete
        - Creates admin user
        - Initializes system
        - Sets session cookie
    end note
```

User completes setup wizard:

```
Step 1: Database Configuration
  â†“
Step 2: Database Test â†’ /api/setup/test-database
  â†“
Step 3: System Language Selection
  â†“
Step 4: Seed Data â†’ /api/setup/seed
  â†“
Step 5: Admin User Creation â†’ /api/setup/complete
```

---

### Phase 4: Database Test

**Endpoint: `/api/setup/test-database/+server.ts`**

```mermaid
sequenceDiagram
    participant Client as Browser
    participant API as /api/setup/test-database
    participant PM as Package Manager
    participant Mongoose
    participant DB as MongoDB

    Client->>API: POST {host, port, name, user, pass}

    Note over API: Check Driver
    API->>Mongoose: Try import mongoose

    alt Driver Missing
        API->>PM: Detect package manager (bun/npm/pnpm/yarn)
        API->>PM: Install mongoose
        PM-->>API: Installation complete
    end

    Note over API: Build Connection
    API->>API: buildConnectionString()

    Note over API: Test Connection
    API->>DB: Connect with 15s timeout

    alt Success
        DB-->>API: Connected âœ“
        API->>DB: Authenticate
        DB-->>API: Auth OK âœ“
        API->>DB: Get database stats
        DB-->>API: {collections: 0, dataSize: 0}
        API-->>Client: {success: true, details: {...}}
    else Failure
        DB-->>API: Connection error
        API-->>Client: {success: false, error: "..."}
    end
```

```typescript
POST /api/setup/test-database
Body: {
  type: "mongodb",
  host: "localhost",
  port: 27017,
  name: "sveltycms",
  user: "admin",
  password: "secret123"
}
```

**Process:**

1. Detects package manager (bun/npm/pnpm/yarn)
2. Installs MongoDB driver if missing (`mongoose`)
3. Builds connection string
4. Tests connection with 15s timeout
5. Returns detailed validation results

**Response:**

```json
{
	"success": true,
	"message": "Connection successful",
	"details": {
		"authenticated": true,
		"dbStats": { "collections": 0, "dataSize": 0 },
		"warnings": []
	}
}
```

---

### Phase 5: Seed Database

**Endpoint: `/api/setup/seed/+server.ts`**

Called when user clicks "Next" after successful DB test.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Write config/private.ts                         â”‚
â”‚    - Writes DB credentials from test step          â”‚
â”‚    - Generates JWT_SECRET_KEY (32 bytes base64)    â”‚
â”‚    - Generates ENCRYPTION_KEY (32 bytes base64)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Initialize database adapter (setup mode)        â”‚
â”‚    - getSetupDatabaseAdapter(dbConfig)             â”‚
â”‚    - Creates MongoDBAdapter                        â”‚
â”‚    - Connects to database                          â”‚
â”‚    - Calls setupAuthModels()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Seed default data (seed.ts)                     â”‚
â”‚    A. seedSettings(adapter)                        â”‚
â”‚       - Creates system_settings collection         â”‚
â”‚       - Seeds defaultPublicSettings (53 keys)      â”‚
â”‚       - Seeds defaultPrivateSettings (23 keys)     â”‚
â”‚    B. seedDefaultTheme(adapter)                    â”‚
â”‚       - Creates system_themes collection           â”‚
â”‚       - Seeds SveltyCMSTheme                       â”‚
â”‚    C. seedCollectionsForSetup(adapter) âš ï¸          â”‚
â”‚       - Scans compiledCollections folder           â”‚
â”‚       - Creates collection models in MongoDB       â”‚
â”‚       - Returns firstCollection info               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Function: `seedCollectionsForSetup()`**

```typescript
// File: src/routes/api/setup/seed.ts

export async function seedCollectionsForSetup(dbAdapter) {
	// 1. Scan filesystem for compiled collections
	const { scanCompiledCollections } = await import('@src/content/collectionScanner');
	const collections = await scanCompiledCollections();

	// 2. Register each collection as a model
	for (const schema of collections) {
		await dbAdapter.collection.createModel(schema);
		// âš ï¸ Creates MongoDB collection: collection_<uuid>
	}

	// 3. Return first collection for fast redirect
	return { firstCollection: { name: 'Posts', path: '/Collections/Posts' } };
}
```

**Database Collections Created:**

```
system_settings          â† Public/private settings
system_themes            â† Theme configurations
system_content_structure â† Navigation/hierarchy (empty for now)
collection_<uuid_1>      â† First collection (e.g., Posts)
collection_<uuid_2>      â† Second collection (e.g., Names)
```

âš ï¸ **KNOWN ISSUE:** Only one `collection_<uuid>` table gets created instead of one per collection. This may be due to async race conditions in the `createModel()` method.

---

### Phase 6: Complete Setup

**Endpoint: `/api/setup/complete/+server.ts`**

Called when user submits admin user form.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Parse private.ts from filesystem                 â”‚
â”‚    - Bypasses Vite's import cache                  â”‚
â”‚    - Uses regex to extract config values           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Create setup database adapter                   â”‚
â”‚    - getSetupDatabaseAdapter(dbConfig)             â”‚
â”‚    - Creates Auth instance                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Create admin user + session (single transaction)â”‚
â”‚    - setupAuth.createUserAndSession({              â”‚
â”‚        username, email, password,                  â”‚
â”‚        role: 'admin', isRegistered: true           â”‚
â”‚      })                                            â”‚
â”‚    - Inserts into auth_users collection           â”‚
â”‚    - Creates session in auth_sessions collection  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Initialize global system (db.ts)               â”‚
â”‚    - initializeWithFreshConfig()                   â”‚
â”‚    - Reloads private.ts from filesystem            â”‚
â”‚    - Connects global dbAdapter                     â”‚
â”‚    - Loads settings from database                  â”‚
â”‚    - Initializes ThemeManager                      â”‚
â”‚    - Initializes MediaFolder                       â”‚
â”‚    - State: IDLE â†’ INITIALIZING â†’ READY           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Initialize ContentManager                       â”‚
â”‚    - contentManager.initialize(undefined, true)    â”‚
â”‚    - Loads collections from database               â”‚
â”‚    - Builds content structure cache                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Invalidate caches                               â”‚
â”‚    - invalidateSettingsCache()                     â”‚
â”‚    - invalidateSetupCache()                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Send welcome email (optional, non-fatal)       â”‚
â”‚    - POST /api/sendMail                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Set session cookie                              â”‚
â”‚    - Creates httpOnly session cookie               â”‚
â”‚    - Sets theme cookies                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Return redirect path                            â”‚
â”‚    - Uses firstCollection from seed step (fast!)  â”‚
â”‚    - Redirects to /{lang}/{firstCollection.path}  â”‚
â”‚    - NO SERVER RESTART REQUIRED! âœ¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Response:**

```json
{
	"success": true,
	"message": "Setup complete! Welcome to SveltyCMS! ğŸ‰",
	"redirectPath": "/en/Collections/Posts",
	"loggedIn": true,
	"requiresHardReload": false,
	"requiresServerRestart": false
}
```

---

## Server Restart Flow

### Phase 1: Vite Startup (Build Time)

**File: `vite.config.ts`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Vite starts                                      â”‚
â”‚    - Checks if config/private.ts exists            â”‚
â”‚    - isSetupComplete() â†’ true (config exists +     â”‚
â”‚      has valid DB credentials)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. cmsWatcherPlugin() activates                     â”‚
â”‚    - Initializes collection structure              â”‚
â”‚    - Compiles collections intelligently            â”‚
â”‚    - Sets up file watchers                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 2: Intelligent Collection Compilation

**File: `src/utils/compilation/compile.ts`**

The compilation system uses **content hashing** and **UUID preservation** to avoid unnecessary recompilation:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Scan existing compiled collections              â”‚
â”‚    - Builds map: path â†’ { jsPath, uuid, hash }    â”‚
â”‚    - Extracts UUID and hash from JS files          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Scan source collections (config/collections)    â”‚
â”‚    - Gets list of .ts files                        â”‚
â”‚    - Calculates content hash for each              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Smart recompilation decision                    â”‚
â”‚    For each collection:                            â”‚
â”‚    IF hash matches existing compiled file          â”‚
â”‚      â†’ SKIP (no changes detected)                  â”‚
â”‚      â†’ PRESERVE existing UUID                      â”‚
â”‚    ELSE                                            â”‚
â”‚      â†’ RECOMPILE                                   â”‚
â”‚      â†’ PRESERVE existing UUID (if found)           â”‚
â”‚      â†’ GENERATE new UUID (if new file)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. AST transformation                              â”‚
â”‚    - Converts TypeScript to JavaScript             â”‚
â”‚    - Adds .js extensions to imports                â”‚
â”‚    - Injects _id (UUID) into schema                â”‚
â”‚    - Injects __HASH__ comment                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Cleanup orphaned files                          â”‚
â”‚    - Removes .js files without .ts source          â”‚
â”‚    - Removes empty directories                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Example Compiled Collection:**

```javascript
// compiledCollections/Collections/Posts.js
// __HASH__:a7f3e9c2d8b1f4a6e3c9d2b8f1a4e6c3

export const schema = {
	_id: '550e8400-e29b-41d4-a716-446655440000', // â† UUID preserved!
	name: 'Posts',
	icon: 'bi:file-text',
	fields: [
		{ label: 'Title', db_fieldName: 'title', widget: 'text' },
		{ label: 'Content', db_fieldName: 'content', widget: 'richtext' }
	]
};
```

### Phase 3: Server Initialization

**File: `src/hooks.server.ts` + `src/databases/db.ts`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleSystemState                                   â”‚
â”‚  - System state: IDLE                              â”‚
â”‚  - First request triggers: await dbInitPromise     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ initializeOnRequest() (db.ts)                       â”‚
â”‚  1. Load private config (privateEnv)               â”‚
â”‚  2. Connect to database                            â”‚
â”‚  3. Load adapters (MongoDBAdapter)                 â”‚
â”‚  4. Setup auth models                              â”‚
â”‚  5. Load settings from database                    â”‚
â”‚  6. Initialize default theme                       â”‚
â”‚  7. Initialize theme manager                       â”‚
â”‚  8. Initialize media folder                        â”‚
â”‚  9. Initialize virtual folders                     â”‚
â”‚  State: IDLE â†’ INITIALIZING â†’ READY               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ContentManager auto-initializes on first access    â”‚
â”‚  - Scans compiledCollections                       â”‚
â”‚  - Registers collection models in database         â”‚
â”‚  - Builds content structure cache                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Collection UUID Management

### UUID Assignment Strategy

**The Problem:**
Collections need stable, persistent IDs for:

- Database table names (`collection_<uuid>`)
- Content references (foreign keys)
- API routes
- Permissions/roles

**The Solution:**
UUIDs are assigned **once** at compilation and **preserved** across restarts.

### UUID Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. New Collection Created                          â”‚
â”‚    config/collections/Posts.ts                     â”‚
â”‚    export const schema = { name: "Posts", ... }    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. First Compilation                               â”‚
â”‚    - Generates new UUID                            â”‚
â”‚    - Injects into schema._id                       â”‚
â”‚    - Saves to compiledCollections/Collections/     â”‚
â”‚      Posts.js                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Collection Modified                             â”‚
â”‚    config/collections/Posts.ts changed             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Smart Recompilation                             â”‚
â”‚    - Detects hash change                           â”‚
â”‚    - PRESERVES existing UUID from compiled file    â”‚
â”‚    - Recompiles with same UUID                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Server Restart                                  â”‚
â”‚    - Reads compiled collections                    â”‚
â”‚    - UUIDs remain stable                           â”‚
â”‚    - Database tables remain consistent             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UUID Extraction Logic

**File: `src/utils/compilation/compile.ts`**

```typescript
// Extract UUID from compiled JS file
function extractUUIDFromJs(content: string): string | null {
	const match = content.match(/_id:\s*["']([^"']+)["']/);
	return match ? match[1] : null;
}

// Extract hash from compiled JS file
function extractHashFromJs(content: string): string | null {
	const match = content.match(/__HASH__:(\w+)/);
	return match ? match[1] : null;
}
```

**AST Transformation:**

```typescript
// Injects UUID into schema during compilation
const schemaUuidTransformer =
	(uuid: string): ts.TransformerFactory<ts.SourceFile> =>
	(context) =>
	(sourceFile) => {
		// Finds: export const schema = { ... }
		// Injects: _id: "uuid-here"
		// Result: export const schema = { _id: "uuid-here", ... }
	};
```

---

## Key Components

### 1. Configuration Files

| File                          | Purpose                                  | Created When                                 |
| ----------------------------- | ---------------------------------------- | -------------------------------------------- |
| `config/private.ts`           | Database credentials, security keys      | Vite startup (empty) â†’ Seed step (populated) |
| `config/collections/*.ts`     | Collection definitions (TypeScript)      | User-created                                 |
| `compiledCollections/**/*.js` | Compiled collections (JavaScript + UUID) | Build time                                   |

### 2. API Endpoints

| Endpoint                   | Purpose                                | Called When           |
| -------------------------- | -------------------------------------- | --------------------- |
| `/api/setup/test-database` | Validates DB connection                | Setup wizard (Step 2) |
| `/api/setup/seed`          | Seeds settings, themes, collections    | Setup wizard (Step 4) |
| `/api/setup/complete`      | Creates admin user, initializes system | Setup wizard (Step 5) |

### 3. Hooks & Middleware

| Hook                   | Purpose                            | Order |
| ---------------------- | ---------------------------------- | ----- |
| `handleSystemState`    | Blocks requests if system FAILED   | 1st   |
| `handleSetup`          | Redirects to /setup if incomplete  | 2nd   |
| `handleAuthentication` | Validates session, identifies user | 6th   |

### 4. Core Services

| Service           | Purpose                      | File                              |
| ----------------- | ---------------------------- | --------------------------------- |
| `dbAdapter`       | Database abstraction layer   | `src/databases/db.ts`             |
| `ContentManager`  | Collection management        | `src/content/ContentManager.ts`   |
| `Auth`            | Authentication/authorization | `src/databases/auth/index.ts`     |
| `SettingsService` | Settings cache management    | `src/services/settingsService.ts` |

---

## State Machine

### System States

```
IDLE â†’ INITIALIZING â†’ READY â†’ DEGRADED â†’ FAILED
  â†‘                      â†“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         (reinit)
```

| State            | Description                           | Allowed Routes                    |
| ---------------- | ------------------------------------- | --------------------------------- |
| **IDLE**         | No valid config or not initialized    | `/setup`, `/api/setup`, `/static` |
| **INITIALIZING** | Loading config, connecting to DB      | `/api/system/health`              |
| **READY**        | Fully operational                     | All routes                        |
| **DEGRADED**     | Some services failed, but operational | All routes (with warnings)        |
| **FAILED**       | Critical failure, unusable            | None (503 errors)                 |

### Transition Triggers

```typescript
// File: src/stores/system.ts

export function transitionTo(newState: SystemState, reason?: string) {
	const oldState = state.overallState;
	state.overallState = newState;
	state.performanceMetrics.stateTransitions.push({
		from: oldState,
		to: newState,
		timestamp: Date.now(),
		reason
	});
}
```

---

## Known Issues

### Issue #1: Collection UUID Tables

**Problem:**
During `seedCollectionsForSetup()`, only one `collection_<uuid>` table gets created in MongoDB instead of one per collection.

**Expected Behavior:**

```
collection_550e8400-e29b-41d4-a716-446655440000  (Posts)
collection_7c9e6679-7425-40de-944b-e07fc1f90ae7  (Names)
collection_a8098c1a-f86e-11da-bd1a-00112444be1e  (WidgetTest)
```

**Actual Behavior:**

```
collection_550e8400-e29b-41d4-a716-446655440000  (Only one table)
```

**Root Cause (Suspected):**

1. **Race Condition:** Multiple `createModel()` calls execute in parallel without proper locking
2. **Mongoose Model Registry:** Mongoose may be caching models by name, causing conflicts
3. **MongoDB Collection Creation:** MongoDB creates collections lazily on first insert, but the model registration may be conflicting

**Location:**

```typescript
// File: src/routes/api/setup/seed.ts

for (const schema of collections) {
	await dbAdapter.collection.createModel(schema);
	// âš ï¸ Potential race condition here
}
```

**Suggested Fix:**

```typescript
// Add mutex or serial execution
const results = [];
for (const schema of collections) {
	const result = await dbAdapter.collection.createModel(schema);
	results.push(result);
	// Add small delay to avoid race conditions
	await new Promise((resolve) => setTimeout(resolve, 100));
}
```

**Alternative Fix (Better):**

```typescript
// Use batch operation with proper transaction
await dbAdapter.collection.createModels(collections);
// Implement atomic batch creation in MongoCollectionMethods
```

### Issue #2: Vite Cache Invalidation

**Problem:**
After `writePrivateConfig()` creates/updates `config/private.ts`, Vite's import cache may serve the old version.

**Current Workaround:**

- `/api/setup/complete` reads private.ts directly from filesystem using `fs.readFile()`
- Bypasses Vite's import cache with regex parsing
- `initializeWithFreshConfig()` forces fresh import with dynamic import

**Better Solution:**

- Implement proper Vite HMR invalidation for config files
- Use Vite's `server.moduleGraph.invalidateModule()` API

---

## Flow Diagrams

### First-Time Setup (Complete Flow)

```mermaid
sequenceDiagram
    participant V as Vite
    participant H as Hooks
    participant U as User (Browser)
    participant API as Setup API
    participant DB as Database
    participant CM as ContentManager

    V->>V: Check private.ts (missing)
    V->>V: Create blank private.ts
    V->>V: Compile collections
    V->>U: Open /setup in browser

    U->>API: POST /api/setup/test-database
    API->>DB: Test connection
    DB-->>API: Success
    API-->>U: Connection valid

    U->>API: POST /api/setup/seed
    API->>API: Write private.ts (with credentials)
    API->>DB: Seed settings
    API->>DB: Seed themes
    API->>DB: Seed collections (create models)
    API-->>U: Seed complete + firstCollection

    U->>API: POST /api/setup/complete
    API->>DB: Create admin user + session
    API->>API: initializeWithFreshConfig()
    API->>CM: Initialize ContentManager
    API->>API: Invalidate caches
    API-->>U: Setup complete + redirect + session cookie

    U->>H: GET /en/Collections/Posts
    H->>H: handleSetup: isSetupComplete() â†’ true
    H->>CM: Load collection
    CM-->>U: Render collection view
```

### Server Restart (Smart Compilation)

```mermaid
sequenceDiagram
    participant V as Vite
    participant FS as Filesystem
    participant CM as Compilation
    participant DB as Database

    V->>V: Check private.ts (exists + valid)
    V->>CM: Trigger intelligent compilation

    CM->>FS: Scan compiledCollections/
    FS-->>CM: {path â†’ {jsPath, uuid, hash}}

    CM->>FS: Scan config/collections/
    FS-->>CM: List of .ts files

    loop For each collection
        CM->>CM: Calculate content hash
        alt Hash matches
            CM->>CM: SKIP (no changes)
        else Hash differs
            CM->>CM: RECOMPILE
            CM->>CM: PRESERVE UUID
            CM->>FS: Write updated .js file
        end
    end

    CM->>V: Compilation complete
    V->>DB: Initialize database connection
    V->>CM: Initialize ContentManager
    CM->>DB: Register collection models
```

---

## Best Practices

### For Developers

1. **Never manually edit compiled collections** (`compiledCollections/`)
   - Always edit source files (`config/collections/`)
   - Let the compilation system handle UUID preservation

2. **Don't delete compiled collections during development**
   - UUIDs would be regenerated, breaking database references
   - Use `git clean` carefully

3. **Use content hashing for change detection**
   - The system automatically detects changes via SHA-256 hash
   - No manual intervention needed

### For System Administrators

1. **Backup compiled collections before migrations**

   ```bash
   tar -czf compiledCollections.backup.tar.gz compiledCollections/
   ```

2. **Database migrations preserve UUIDs**
   - Collection IDs are stored in `_id` field
   - Never modify `_id` in database or compiled files

3. **Setup completion is atomic**
   - If setup fails, system reverts to setup mode
   - No partial state left behind

---

# Part III: Testing & CI/CD

## Testing Overview

SveltyCMS uses a comprehensive testing strategy to ensure code quality across all environments.

### Testing Layers

- âœ… **E2E Tests (Playwright)** - Full user workflows, browser automation
- âœ… **Integration Tests** - API endpoints, database operations
- âœ… **Unit Tests (Bun)** - Components, utilities, functions
- âœ… **CI/CD Automation** - GitHub Actions for testing and releases

### Test Coverage

- âœ… Authentication flows (Email, OAuth, 2FA)
- âœ… User management (CRUD, permissions, roles)
- âœ… Collection management (Builder, CRUD, relationships)
- âœ… All 95+ API endpoints tested
- âœ… UI components and stores
- âœ… Database operations

---

## Unit Testing with Bun

### Running Bun Tests

```bash
# Run all tests
bun test

# Run specific test
bun test tests/bun/api/auth.test.ts

# Watch mode
bun test --watch

# With coverage
bun test --coverage
```

### Test Structure

```
tests/bun/
â”œâ”€â”€ api/                # API endpoint tests
â”œâ”€â”€ auth/               # Authentication tests
â”œâ”€â”€ widgets/            # Widget tests
â”œâ”€â”€ mocks/
â”‚   â””â”€â”€ setup.ts       # Preload file (mocks SvelteKit)
â””â”€â”€ *.test.ts          # Various unit tests
```

### Writing Tests

```typescript
import { describe, it, expect } from 'bun:test';

describe('ContentService', () => {
	it('should create content', async () => {
		const content = await service.create({
			title: 'Test Post'
		});
		expect(content.title).toBe('Test Post');
	});
});
```

---

## E2E Testing with Playwright

### Running Playwright Tests

```bash
# Run all tests
npx playwright test

# Specific test
npx playwright test signupfirstuser.spec.ts

# Debug mode
npx playwright test --debug

# UI mode
npx playwright test --ui
```

### Test Files

```
tests/playwright/
â”œâ”€â”€ signupfirstuser.spec.ts
â”œâ”€â”€ oauth-signup-firstuser.spec.ts
â”œâ”€â”€ login.spec.ts
â”œâ”€â”€ user-crud.spec.ts
â”œâ”€â”€ collection-builder.spec.ts
â””â”€â”€ permission-change.spec.ts
```

---

## GitHub Actions CI/CD

### Workflow: Playwright Tests

**File:** `.github/workflows/playwright.yml`

Runs comprehensive tests on every push and PR:

```yaml
name: Playwright and Bun Tests

on:
  push:
    branches: [main, next]
  pull_request:
    branches: [main]
  workflow_call: {} # Can be called by auto-release

jobs:
  test:
    strategy:
      matrix:
        mode: [dev, preview] # Test both modes

    steps:
      # Start MongoDB service container
      - uses: supercharge/mongodb-github-action@1.10.0
        with:
          mongodb-version: latest
          mongodb-username: admin
          mongodb-password: admin

      # Seed database BEFORE starting server
      - run: bun run scripts/seed-cms.js
        env:
          MONGO_HOST: localhost
          MONGO_PORT: 27017
          MONGO_DB: SveltyCMS

      # Create admin user BEFORE starting server
      - run: bun run scripts/create-admin.js
        env:
          ADMIN_USER: admin
          ADMIN_EMAIL: admin@example.com
          ADMIN_PASS: Admin123!

      # Start server (dev or preview)
      - run: bunx vite dev --port 5173 &
        if: matrix.mode == 'dev'

      # Run tests
      - run: bunx playwright test
```

### Workflow: Auto-Release

**File:** `.github/workflows/auto-release.yaml`

Automatically releases new versions after tests pass:

```yaml
name: Semantic Release

on:
  push:
    branches: [main] # Only release from main

jobs:
  test:
    uses: ./.github/workflows/playwright.yml # Run tests first

  release:
    needs: [test] # Only release if tests pass
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Full history for semantic-release

      - run: bunx semantic-release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### CI/CD Features

âœ… **MongoDB Service** - Isolated database for testing  
âœ… **Matrix Testing** - Tests both dev and preview modes  
âœ… **Automated Setup** - Seeds DB + creates admin automatically  
âœ… **Test Gating** - Releases only if tests pass  
âœ… **Semantic Versioning** - Automatic version bumps based on commits  
âœ… **Artifact Upload** - Test reports and videos on failure

---

## Automated Setup Scripts

For CI/CD environments, SveltyCMS provides scripts that replicate the setup wizard.

### Script: Seed Database

**File:** `scripts/seed-cms.js`

Mimics `/api/setup/seed` endpoint:

```javascript
import { writePrivateConfig } from '../src/routes/api/setup/writePrivateConfig.js';
import { initSystemFromSetup } from '../src/routes/api/setup/seed.js';
import { getSetupDatabaseAdapter } from '../src/routes/api/setup/utils.js';

async function main() {
	const dbConfig = {
		type: 'mongodb',
		host: process.env.MONGO_HOST || 'localhost',
		port: parseInt(process.env.MONGO_PORT || '27017'),
		name: process.env.MONGO_DB || 'SveltyCMS',
		user: process.env.MONGO_USER || '',
		password: process.env.MONGO_PASS || ''
	};

	// Write config/private.ts
	await writePrivateConfig(dbConfig);

	// Connect and seed
	const { dbAdapter } = await getSetupDatabaseAdapter(dbConfig);
	await initSystemFromSetup(dbAdapter);

	await dbAdapter.disconnect();
}

main().catch((err) => {
	console.error('âŒ Seeding failed:', err);
	process.exit(1);
});
```

**Usage:**

```bash
# Local
bun run scripts/seed-cms.js

# CI/CD with environment variables
MONGO_HOST=localhost MONGO_PORT=27017 bun run scripts/seed-cms.js
```

### Script: Create Admin User

**File:** `scripts/create-admin.js`

Mimics `/api/setup/complete` endpoint:

```javascript
import { Auth } from '../src/databases/auth/index.js';
import { getSetupDatabaseAdapter } from '../src/routes/api/setup/utils.js';

async function main() {
	const dbConfig = {
		/* same as seed-cms.js */
	};
	const admin = {
		username: process.env.ADMIN_USER || 'admin',
		email: process.env.ADMIN_EMAIL || 'admin@example.com',
		password: process.env.ADMIN_PASS || 'Admin123!'
	};

	const { dbAdapter } = await getSetupDatabaseAdapter(dbConfig);
	const auth = new Auth(dbAdapter);

	try {
		await auth.createUser({
			...admin,
			role: 'admin',
			isActive: true
		});
		console.log('âœ… Admin user created!');
	} catch (error) {
		if (error.message?.includes('duplicate')) {
			console.log('â„¹ï¸  Admin user already exists');
		} else {
			throw error;
		}
	}

	await dbAdapter.disconnect();
}

main().catch((err) => {
	console.error('âŒ Admin creation failed:', err);
	process.exit(1);
});
```

**Usage:**

```bash
# Local
bun run scripts/create-admin.js

# CI/CD with custom credentials
ADMIN_USER=admin \
ADMIN_EMAIL=admin@example.com \
ADMIN_PASS=SecurePass123! \
bun run scripts/create-admin.js
```

### Script Benefits

âœ… **No UI required** - Perfect for CI/CD  
âœ… **Idempotent** - Safe to run multiple times  
âœ… **Environment-driven** - Uses environment variables  
âœ… **Reuses setup logic** - Imports from actual setup endpoints  
âœ… **Error handling** - Graceful failure with exit codes

---

# Part IV: Troubleshooting & Reference

## Troubleshooting

### Setup wizard loops infinitely

**Cause:** `isSetupCompleteAsync()` returns false due to missing users

**Fix:**

```bash
# Check if admin users exist
mongo sveltycms --eval "db.auth_users.find().pretty()"

# If empty, complete setup wizard again
# or manually create admin user via MongoDB shell
```

### Collections not appearing after setup

**Cause:** `seedCollectionsForSetup()` failed silently

**Fix:**

```bash
# Check logs for collection seeding errors
tail -f logs/app.log | grep "seedCollections"

# Manually trigger collection initialization
# Restart server with DEBUG=true
```

### UUID changed after recompilation

**Cause:** Compiled collection was deleted or corrupted

**Fix:**

```bash
# Restore from backup
tar -xzf compiledCollections.backup.tar.gz

# Or manually restore UUID in MongoDB
mongo sveltycms --eval 'db.system_content_structure.find({name: "Posts"})'
# Copy _id, then update compiled file
```

---

## Summary

This comprehensive guide covers the complete SveltyCMS lifecycle:

âœ… **Installation** - Quick and manual installation methods  
âœ… **First-Time Setup** - Wizard-based and automated setup flows  
âœ… **Server Restart** - Intelligent recompilation and UUID preservation  
âœ… **Collection Management** - UUID assignment and lifecycle  
âœ… **Testing** - Unit tests (Bun) and E2E tests (Playwright)  
âœ… **CI/CD** - Automated testing and semantic releases  
âœ… **Troubleshooting** - Common issues and solutions

### Key Highlights

ğŸš€ **Zero-Restart Setup** - System becomes operational without server restart  
ğŸ”‘ **UUID Preservation** - Collections maintain stable IDs across restarts  
âš¡ **Smart Compilation** - Only recompiles changed collections using content hashing  
ğŸ§ª **Comprehensive Testing** - 95+ API endpoints, full user workflows  
ğŸ¤– **Automated CI/CD** - GitHub Actions for testing and releases  
ğŸ“ **Automated Scripts** - `seed-cms.js` and `create-admin.js` for CI/CD

âš ï¸ **Known Issue:** Collection UUID table creation may have race conditions during `seedCollectionsForSetup()`

The system is production-ready and fully automated for both local development and CI/CD environments.

---

## Related Documentation

### Architecture

- [Collection Store Data Flow](/docs/architecture/collection-store-dataflow.mdx) - How data flows through the collection store
- [State Management](/docs/architecture/state-management.mdx) - System state machine details
- [Cache System](/docs/architecture/cache-system.mdx) - Caching strategy and TTLs

### API References

- [Setup API](/docs/api/Setup_API.mdx) - Complete setup API reference
- [Collection API](/docs/api/Collection_API.mdx) - Collection CRUD operations
- [Authentication API](/docs/api/Authentication_2FA_API.mdx) - User authentication

### Database

- [Core Infrastructure](/docs/database/Core_Infrastructure.mdx) - Database adapter system
- [MongoDB Methods](/docs/database/MongoDB_Methods.mdx) - MongoDB-specific implementation

### Guides

- [Complete Workflow Guide](/docs/architecture/initialization-workflow.mdx) - This document (installation, setup, testing, CI/CD)
- [Troubleshooting](/docs/troubleshooting.mdx) - Common issues and solutions

---

## Quick Reference

### Key Files

| File                               | Purpose                    | When Modified                   |
| ---------------------------------- | -------------------------- | ------------------------------- |
| `vite.config.ts`                   | Build-time setup detection | Rarely                          |
| `src/hooks.server.ts`              | Runtime request gatekeeper | When adding middleware          |
| `src/databases/db.ts`              | Database initialization    | When adding adapters            |
| `src/content/ContentManager.ts`    | Collection management      | When changing collection logic  |
| `src/utils/compilation/compile.ts` | Smart compilation          | When changing collection format |

### Key Concepts

- **Setup Mode**: System state when no admin users exist
- **UUID Preservation**: Collections keep the same ID across restarts
- **Smart Compilation**: Only recompiles changed collections using content hashing
- **Zero-Restart Setup**: System becomes operational without server restart
- **State Machine**: IDLE â†’ INITIALIZING â†’ READY â†’ DEGRADED â†’ FAILED

### Performance Benchmarks

| Operation          | Expected Time     | Notes                           |
| ------------------ | ----------------- | ------------------------------- |
| Vite Startup       | 2-5 seconds       | Includes TypeScript compilation |
| Database Test      | 1-3 seconds       | May include driver installation |
| Seed Database      | 3-8 seconds       | Depends on collection count     |
| Complete Setup     | 4-6 seconds       | Includes full system init       |
| **Total Setup**    | **10-25 seconds** | Excluding user input            |
| Collection Compile | 50-200ms per file | With UUID preservation          |
| Server Restart     | 3-5 seconds       | To READY state                  |
