---
path: '/widgets/custom/currency'
title: 'Currency Widget'
description: 'Currency input widget with locale-aware formatting, numeric storage, and calculation support for SveltyCMS'
order: 301
icon: 'mdi:currency-usd'
author: 'admin'
created: '2025-01-15'
updated: '2025-01-15'
tags:
  - widget
  - custom
  - currency
  - number
  - money
  - finance
  - locale
  - internationalization
---

# Currency Widget

<blockquote>
	**Currency input widget** that stores precise numeric values while displaying and accepting localized, formatted currency strings with proper
	symbols and thousand separators.
</blockquote>

## Overview

The **Currency widget** is a specialized numeric input designed specifically for monetary values. It provides a sophisticated balance between user experience (localized display with currency symbols) and data integrity (storing clean numeric values). Unlike the generic Number widget, Currency is optimized for financial data with features like automatic currency symbol display, locale-aware formatting, and decimal precision control.

### Key Features

- ✅ **Numeric Storage**: Stores currency as actual `number` type (not string) enabling direct calculations
- ✅ **Locale-Aware Formatting**: Uses `Intl.NumberFormat` to display currency according to user's locale
- ✅ **Bidirectional Conversion**: Seamlessly converts between localized display and numeric storage
- ✅ **Multi-Currency Support**: Configurable ISO 4217 currency codes (EUR, USD, GBP, JPY, etc.)
- ✅ **Auto-formatting**: Reformats input to canonical currency format on blur
- ✅ **Mobile Optimized**: Uses `inputmode="decimal"` to trigger numeric keyboard
- ✅ **Database Aggregation**: Supports numeric filtering (`price > 100`), sorting, and sum/average calculations
- ✅ **Non-Translatable**: Currency values are universal (automatically sets `translated: false`)
- ✅ **Min/Max Validation**: Configurable value range constraints
- ✅ **Decimal Precision**: Proper handling of currency decimal places (2 for USD/EUR, 0 for JPY)

---

## When to Use Currency Widget

### ✅ Use Currency When:

- **Financial Data**: Prices, costs, revenues, budgets, salaries
- **E-commerce**: Product prices, discounts, tax amounts, totals
- **Accounting**: Invoices, expenses, payments, balances
- **Subscriptions**: Monthly fees, annual pricing, tier costs
- **Donations**: Campaign goals, contribution amounts
- **Multi-Currency Apps**: Applications supporting multiple currencies
- **Reports**: Financial dashboards requiring sum/average calculations
- **Calculations**: Any scenario requiring arithmetic operations on monetary values

### ❌ Don't Use Currency When:

- **Non-Monetary Numbers**: Use `Number` widget for quantities, ratings, scores
- **Phone Numbers**: Use `PhoneNumber` widget (phones are strings, not numbers)
- **IDs/Codes**: Use `Input` widget (numeric IDs should be strings)
- **Percentages**: Use `Number` widget with suffix="%" instead
- **Dates**: Use `Date` or `DateTime` widget
- **Custom Formatting**: If you need non-standard currency display, consider custom widget

---

## Installation

The Currency widget is included in SveltyCMS by default as a custom widget. No additional installation required.

```typescript
// Already available in your collection definitions
import Currency from '@src/widgets/custom/currency';
```

---

## Basic Usage

### Simple Product Price

```typescript
import Currency from '@src/widgets/custom/currency';

export const productsCollection = {
	name: 'Products',
	fields: [
		Currency({
			label: 'Price',
			db_fieldName: 'price',
			currencyCode: 'EUR',
			required: true,
			minValue: 0.01,
			maxValue: 999999.99,
			placeholder: '€0.00'
		})
	]
};
```

**User Experience**:

- User sees: `€0.00` (placeholder)
- User types: `1234.56`
- Display shows: `1.234,56 €` (German locale)
- Database stores: `1234.56` (number type)

### Multi-Currency E-commerce

```typescript
import Currency from '@src/widgets/custom/currency';
import Select from '@src/widgets/core/select';

export const productsCollection = {
	name: 'Products',
	fields: [
		Select({
			label: 'Currency',
			db_fieldName: 'currency',
			options: [
				{ value: 'EUR', label: 'Euro (€)' },
				{ value: 'USD', label: 'US Dollar ($)' },
				{ value: 'GBP', label: 'British Pound (£)' },
				{ value: 'JPY', label: 'Japanese Yen (¥)' }
			],
			default: 'EUR',
			required: true
		}),

		Currency({
			label: 'Price',
			db_fieldName: 'price',
			currencyCode: 'EUR', // Will be overridden by currency selector
			required: true,
			minValue: 0
		}),

		Currency({
			label: 'Discount',
			db_fieldName: 'discount',
			currencyCode: 'EUR',
			required: false,
			minValue: 0,
			default: 0
		})
	]
};
```

### Subscription Pricing

```typescript
import Currency from '@src/widgets/custom/currency';

export const subscriptionPlansCollection = {
	name: 'Subscription Plans',
	fields: [
		Currency({
			label: 'Monthly Price',
			db_fieldName: 'monthlyPrice',
			currencyCode: 'USD',
			required: true,
			minValue: 0,
			placeholder: '$0.00'
		}),

		Currency({
			label: 'Annual Price',
			db_fieldName: 'annualPrice',
			currencyCode: 'USD',
			required: true,
			minValue: 0,
			placeholder: '$0.00'
		}),

		Currency({
			label: 'Setup Fee',
			db_fieldName: 'setupFee',
			currencyCode: 'USD',
			required: false,
			minValue: 0,
			default: 0
		})
	]
};
```

---

## Configuration Properties

The Currency widget extends the base field properties with currency-specific configuration:

| Property       | Type      | Required  | Default        | Description                                       |
| -------------- | --------- | --------- | -------------- | ------------------------------------------------- |
| `label`        | `string`  | ✅ Yes    | -              | Display label for the field                       |
| `db_fieldName` | `string`  | ✅ Yes    | -              | Database field name (snake_case recommended)      |
| `currencyCode` | `string`  | ❌ No     | `'EUR'`        | ISO 4217 currency code (EUR, USD, GBP, JPY, etc.) |
| `required`     | `boolean` | ❌ No     | `false`        | Whether the field is mandatory                    |
| `minValue`     | `number`  | ❌ No     | `undefined`    | Minimum allowed value                             |
| `maxValue`     | `number`  | ❌ No     | `undefined`    | Maximum allowed value                             |
| `placeholder`  | `string`  | ❌ No     | Formatted zero | Placeholder text shown in empty input             |
| `default`      | `number`  | ❌ No     | `undefined`    | Default value for new entries                     |
| `width`        | `number`  | ❌ No     | `undefined`    | Field width in collection builder                 |
| `translated`   | `boolean` | 🔒 Locked | `false`        | Always false (currency values are universal)      |

### ISO 4217 Currency Codes

Common currency codes supported:

| Code  | Currency          | Symbol | Decimals | Example Display |
| ----- | ----------------- | ------ | -------- | --------------- |
| `EUR` | Euro              | €      | 2        | €1.234,56       |
| `USD` | US Dollar         | $      | 2        | $1,234.56       |
| `GBP` | British Pound     | £      | 2        | £1,234.56       |
| `JPY` | Japanese Yen      | ¥      | 0        | ¥1,235          |
| `CHF` | Swiss Franc       | CHF    | 2        | CHF 1'234.56    |
| `CAD` | Canadian Dollar   | CA$    | 2        | CA$1,234.56     |
| `AUD` | Australian Dollar | A$     | 2        | A$1,234.56      |
| `CNY` | Chinese Yuan      | ¥      | 2        | ¥1,234.56       |
| `INR` | Indian Rupee      | ₹      | 2        | ₹1,234.56       |
| `BRL` | Brazilian Real    | R$     | 2        | R$ 1.234,56     |

[Full list of ISO 4217 codes](https://en.wikipedia.org/wiki/ISO_4217)

---

## Validation

The Currency widget uses Valibot for robust validation:

### Automatic Validation

```typescript
Currency({
	label: 'Product Price',
	db_fieldName: 'price',
	currencyCode: 'EUR',
	required: true, // Must have a value
	minValue: 0.01, // Minimum €0.01
	maxValue: 9999.99 // Maximum €9,999.99
});

// Validation rules generated automatically:
// - Must be a number (not string, null, undefined)
// - If required: must exist
// - If minValue set: value >= minValue
// - If maxValue set: value <= maxValue
```

### Validation Messages

| Scenario                    | Error Message                       |
| --------------------------- | ----------------------------------- |
| Empty required field        | "This field is required"            |
| Not a number                | "Value must be a number"            |
| Below minimum               | "Value must be at least {minValue}" |
| Above maximum               | "Value must not exceed {maxValue}"  |
| Invalid format during input | Auto-corrects on blur               |

### Custom Validation

```typescript
import Currency from '@src/widgets/custom/currency';
import { pipe, custom } from 'valibot';

// Add custom business logic validation
Currency({
	label: 'Discount',
	db_fieldName: 'discount',
	currencyCode: 'USD',
	minValue: 0,
	maxValue: 100,
	// Custom validation in collection schema
	validate: pipe(
		custom((value) => {
			// Discount must be less than original price
			return value < originalPrice;
		}, 'Discount cannot exceed original price')
	)
});
```

---

## Data Structure

### Storage Format

Currency values are stored as **pure numbers** in the database:

```typescript
// MongoDB Document
{
  "_id": "prod_123",
  "name": "Premium Widget",
  "price": 1234.56,          // ✅ Number type (not string!)
  "discount": 123.45,
  "currency": "EUR",
  "createdAt": ISODate("2025-01-15T10:00:00Z")
}
```

### Why Numbers, Not Strings?

**✅ Numbers Enable**:

- Direct arithmetic: `price - discount = finalPrice`
- Database aggregations: `db.products.aggregate([{ $group: { _id: null, total: { $sum: "$price" } } }])`
- Sorting: `db.products.find().sort({ price: 1 })`
- Filtering: `db.products.find({ price: { $gte: 100, $lte: 500 } })`
- Indexing: Numeric indexes for fast queries

**❌ Strings Require**:

- Parsing before calculations: `parseFloat(price.replace(/[^0-9.-]/g, ''))`
- No aggregation support
- String-based sorting: `"100" > "99"` is false!
- Complex queries with conversions
- Cannot use numeric indexes

### JavaScript Number Limitations

JavaScript numbers are 64-bit IEEE 754 floats:

```typescript
// Safe integer range: -(2^53 - 1) to (2^53 - 1)
Number.MAX_SAFE_INTEGER; // 9,007,199,254,740,991
Number.MIN_SAFE_INTEGER; // -9,007,199,254,740,991

// For currency:
// ✅ Safe: Most real-world currency values
const price = 999999999.99; // ~$1 billion - safe

// ⚠️ Be careful with:
const hugeAmount = 9999999999999.99; // May lose precision

// ✅ Solution for extreme values:
// Use a decimal library like decimal.js or big.js
import Decimal from 'decimal.js';
const precise = new Decimal('9999999999999.99');
```

### Decimal Precision

Different currencies have different decimal places:

```typescript
// 2 decimal places (most currencies)
EUR: 1234.56; // €1,234.56
USD: 1234.56; // $1,234.56
GBP: 1234.56; // £1,234.56

// 0 decimal places
JPY: 1235; // ¥1,235 (no cents in yen)
KRW: 1235; // ₩1,235 (no decimals in won)

// 3 decimal places (some middle eastern currencies)
BHD: 123.456; // BD 123.456 (Bahraini Dinar)
KWD: 123.456; // KD 123.456 (Kuwaiti Dinar)

// Intl.NumberFormat handles this automatically!
```

---

## Locale-Aware Formatting

The Currency widget uses `Intl.NumberFormat` for automatic locale-specific formatting:

### How It Works

```typescript
// User's locale from publicEnv.LOCALE or browser
const userLocale = 'de-DE';
const currencyCode = 'EUR';

// Create formatter
const formatter = new Intl.NumberFormat(userLocale, {
	style: 'currency',
	currency: currencyCode
});

// Display
const storedValue = 1234.56;
const displayValue = formatter.format(storedValue);
// de-DE: "1.234,56 €"
// en-US: "€1,234.56"
// fr-FR: "1 234,56 €"
```

### Locale Examples

Same value (`1234.56`) displayed in different locales:

| Locale  | Currency | Display        |
| ------- | -------- | -------------- |
| `en-US` | USD      | $1,234.56      |
| `en-GB` | GBP      | £1,234.56      |
| `de-DE` | EUR      | 1.234,56 €     |
| `fr-FR` | EUR      | 1 234,56 €     |
| `it-IT` | EUR      | 1.234,56 €     |
| `es-ES` | EUR      | 1234,56 €      |
| `ja-JP` | JPY      | ¥1,235         |
| `zh-CN` | CNY      | ¥1,234.56      |
| `ar-SA` | SAR      | ١٬٢٣٤٫٥٦ ر.س.‏ |
| `he-IL` | ILS      | ‏1,234.56 ₪    |

### Parsing Localized Input

The widget handles bidirectional conversion:

```typescript
// User types in German locale: "1.234,56"
// Widget parses:
// 1. Identifies group separator: "." (German)
// 2. Identifies decimal separator: "," (German)
// 3. Removes group separators: "1234,56"
// 4. Replaces decimal with standard: "1234.56"
// 5. Parses to number: 1234.56
// 6. Stores: 1234.56 (clean number)

// On blur, reformats to: "1.234,56 €"
```

### Setting User Locale

```typescript
// In your environment configuration
// src/stores/globalSettings.ts
export const publicEnv = writable({
	LOCALE: 'de-DE', // German (Germany)
	// OR detect from browser:
	LOCALE: navigator.language || 'en-US'
});

// Currency widget automatically uses this locale
```

---

## Database Operations

### Aggregations

Currency's numeric storage enables powerful MongoDB aggregations:

```typescript
// Sum all product prices
db.products.aggregate([
	{
		$group: {
			_id: null,
			totalValue: { $sum: '$price' },
			avgPrice: { $avg: '$price' },
			minPrice: { $min: '$price' },
			maxPrice: { $max: '$price' },
			count: { $sum: 1 }
		}
	}
]);

// Revenue by category
db.products.aggregate([
	{
		$group: {
			_id: '$category',
			revenue: { $sum: '$price' }
		}
	},
	{ $sort: { revenue: -1 } }
]);

// Price range distribution
db.products.aggregate([
	{
		$bucket: {
			groupBy: '$price',
			boundaries: [0, 50, 100, 500, 1000, 5000],
			default: 'Other',
			output: {
				count: { $sum: 1 },
				products: { $push: '$name' }
			}
		}
	}
]);
```

### Filtering

```typescript
// Products between $100 and $500
db.products.find({
	price: { $gte: 100, $lte: 500 }
});

// Products over $1000 with discount
db.products.find({
	price: { $gt: 1000 },
	discount: { $gt: 0 }
});

// Calculate final price
db.products.aggregate([
	{
		$addFields: {
			finalPrice: {
				$subtract: ['$price', '$discount']
			}
		}
	},
	{
		$match: {
			finalPrice: { $lte: 500 }
		}
	}
]);
```

### Sorting

```typescript
// Cheapest first
db.products.find().sort({ price: 1 });

// Most expensive first
db.products.find().sort({ price: -1 });

// By category, then price
db.products.find().sort({ category: 1, price: 1 });
```

### Indexing

```typescript
// Create index for faster price queries
db.products.createIndex({ price: 1 });

// Compound index for category + price
db.products.createIndex({ category: 1, price: 1 });

// Text search + price filter
db.products.createIndex({ name: 'text', price: 1 });

// Query with index
db.products.find({ price: { $gte: 100 } }).hint({ price: 1 });
```

---

## Advanced Examples

### Dynamic Currency Conversion

```typescript
import Currency from '@src/widgets/custom/currency';
import Number from '@src/widgets/custom/number';

export const productsCollection = {
	name: 'Products',
	fields: [
		// Base price in EUR
		Currency({
			label: 'Price (EUR)',
			db_fieldName: 'priceEur',
			currencyCode: 'EUR',
			required: true
		}),

		// Exchange rate
		Number({
			label: 'USD Exchange Rate',
			db_fieldName: 'usdExchangeRate',
			min: 0,
			step: 0.0001,
			default: 1.1,
			helper: 'EUR to USD rate'
		}),

		// Calculated USD price (server-side)
		Currency({
			label: 'Price (USD)',
			db_fieldName: 'priceUsd',
			currencyCode: 'USD',
			readonly: true,
			helper: 'Auto-calculated from EUR price'
		})
	]
};

// Server-side calculation before save
async function beforeSave(data: any) {
	data.priceUsd = data.priceEur * data.usdExchangeRate;
	return data;
}
```

### Tiered Pricing

```typescript
import Currency from '@src/widgets/custom/currency';
import Number from '@src/widgets/custom/number';

export const productsCollection = {
	name: 'Products',
	fields: [
		Currency({
			label: 'Base Price',
			db_fieldName: 'basePrice',
			currencyCode: 'USD',
			required: true,
			minValue: 0.01
		}),

		Number({
			label: 'Quantity Tier 1 (1-10)',
			db_fieldName: 'tier1Qty',
			min: 1,
			max: 10,
			default: 10,
			readonly: true
		}),

		Currency({
			label: 'Tier 1 Price',
			db_fieldName: 'tier1Price',
			currencyCode: 'USD',
			required: true,
			helper: 'Full price'
		}),

		Number({
			label: 'Quantity Tier 2 (11-50)',
			db_fieldName: 'tier2Qty',
			min: 11,
			max: 50,
			default: 50,
			readonly: true
		}),

		Currency({
			label: 'Tier 2 Price',
			db_fieldName: 'tier2Price',
			currencyCode: 'USD',
			required: true,
			helper: '10% discount'
		}),

		Number({
			label: 'Quantity Tier 3 (51+)',
			db_fieldName: 'tier3Qty',
			min: 51,
			readonly: true
		}),

		Currency({
			label: 'Tier 3 Price',
			db_fieldName: 'tier3Price',
			currencyCode: 'USD',
			required: true,
			helper: '20% discount'
		})
	]
};
```

### Tax Calculation

```typescript
import Currency from '@src/widgets/custom/currency';
import Number from '@src/widgets/custom/number';

export const invoicesCollection = {
	name: 'Invoices',
	fields: [
		Currency({
			label: 'Subtotal',
			db_fieldName: 'subtotal',
			currencyCode: 'EUR',
			required: true
		}),

		Number({
			label: 'Tax Rate (%)',
			db_fieldName: 'taxRate',
			min: 0,
			max: 100,
			step: 0.01,
			default: 19, // German VAT
			suffix: '%'
		}),

		Currency({
			label: 'Tax Amount',
			db_fieldName: 'taxAmount',
			currencyCode: 'EUR',
			readonly: true,
			helper: 'Auto-calculated'
		}),

		Currency({
			label: 'Total',
			db_fieldName: 'total',
			currencyCode: 'EUR',
			readonly: true,
			helper: 'Subtotal + Tax'
		})
	]
};

// Calculation logic
function calculateInvoice(subtotal: number, taxRate: number) {
	const taxAmount = subtotal * (taxRate / 100);
	const total = subtotal + taxAmount;
	return { taxAmount, total };
}
```

### Discount System

```typescript
import Currency from '@src/widgets/custom/currency';
import Number from '@src/widgets/custom/number';
import Select from '@src/widgets/core/select';

export const productsCollection = {
	name: 'Products',
	fields: [
		Currency({
			label: 'Original Price',
			db_fieldName: 'originalPrice',
			currencyCode: 'USD',
			required: true
		}),

		Select({
			label: 'Discount Type',
			db_fieldName: 'discountType',
			options: [
				{ value: 'none', label: 'No Discount' },
				{ value: 'percentage', label: 'Percentage Off' },
				{ value: 'fixed', label: 'Fixed Amount' }
			],
			default: 'none'
		}),

		Number({
			label: 'Discount Percentage',
			db_fieldName: 'discountPercent',
			min: 0,
			max: 100,
			step: 1,
			suffix: '%',
			showIf: (data) => data.discountType === 'percentage'
		}),

		Currency({
			label: 'Discount Amount',
			db_fieldName: 'discountAmount',
			currencyCode: 'USD',
			minValue: 0,
			showIf: (data) => data.discountType === 'fixed'
		}),

		Currency({
			label: 'Final Price',
			db_fieldName: 'finalPrice',
			currencyCode: 'USD',
			readonly: true,
			helper: 'After discount'
		})
	]
};
```

---

## Mobile Experience

### Numeric Keyboard

The Currency widget uses `inputmode="decimal"` to trigger the numeric keyboard on mobile devices:

```html
<input type="text" inputmode="decimal" ... />
```

**Mobile Keyboards**:

- **iOS**: Numeric keyboard with decimal point
- **Android**: Numeric keyboard with comma or period (locale-aware)
- **Desktop**: Regular keyboard (allows numbers, decimal separators, backspace, arrows)

### Touch Interaction

- **Large touch targets**: Input height optimized for finger tapping
- **Auto-focus on required**: Required fields auto-focus when empty
- **Haptic feedback**: Native input feedback on supported devices
- **Swipe to clear**: Standard mobile gesture support

---

## Accessibility

The Currency widget is fully accessible:

### ARIA Attributes

```html
<input
	type="text"
	inputmode="decimal"
	id="price"
	name="price"
	aria-label="Product Price"
	aria-required="true"
	aria-invalid="false"
	aria-describedby="price-error"
/>
```

### Screen Reader Support

- **Field label**: "Product Price, required, currency input"
- **Value announcement**: "One thousand two hundred thirty-four dollars and fifty-six cents"
- **Error announcement**: "Error: Value must be at least $10"
- **Hint announcement**: "Enter price in US dollars"

### Keyboard Navigation

- **Tab**: Move to next field
- **Shift+Tab**: Move to previous field
- **Arrow keys**: Move cursor within input
- **Home/End**: Jump to start/end of input
- **Backspace/Delete**: Remove characters
- **Esc**: Clear validation error (if any)

### High Contrast Mode

The widget respects system high contrast settings:

- Clear border visibility
- Distinct error state colors
- Readable text contrast

---

## Comparison with Other Widgets

### Currency vs Number

| Feature      | Currency                                 | Number                             |
| ------------ | ---------------------------------------- | ---------------------------------- |
| **Purpose**  | Monetary values                          | Generic numeric values             |
| **Display**  | Formatted with symbol (€1,234.56)        | Plain number or with prefix/suffix |
| **Storage**  | Number type                              | Number type                        |
| **Locale**   | Automatic currency formatting            | Manual locale formatting           |
| **Use Case** | Prices, costs, revenues                  | Quantities, ratings, scores        |
| **Symbol**   | Currency-specific (€, $, £)              | Custom prefix/suffix               |
| **Decimals** | Currency-specific (2 for USD, 0 for JPY) | Configurable step                  |
| **Keyboard** | `inputmode="decimal"`                    | `inputmode="decimal"`              |

**When to choose**:

- **Currency**: Financial data requiring currency symbols and locale-specific formatting
- **Number**: Quantities, IDs, scores, ratings, or custom-suffixed numbers (e.g., "100 kg")

### Currency vs Input (Text)

| Feature          | Currency               | Input                |
| ---------------- | ---------------------- | -------------------- |
| **Storage**      | Number type            | String type          |
| **Validation**   | Numeric validation     | Text validation      |
| **Calculations** | Direct arithmetic      | Requires parsing     |
| **Sorting**      | Numeric sorting        | String sorting       |
| **Aggregation**  | Sum, average, min, max | Text operations only |
| **Display**      | Auto-formatted         | Raw text             |

**Why not store currency as text**:

```typescript
// ❌ BAD: String storage
price: '€1,234.56';
// Problems:
// - Cannot calculate: price * 1.19 (needs parsing)
// - Cannot sort: "€9.99" > "€100.00" (string comparison)
// - Cannot aggregate: SUM(price) (not numeric)
// - Different locales break: "1.234,56 €" vs "$1,234.56"

// ✅ GOOD: Number storage
price: 1234.56;
// Benefits:
// - Direct calculation: price * 1.19
// - Correct sorting: 9.99 < 100.00
// - Database aggregation: SUM(price)
// - Display formatting per user locale
```

---

## Best Practices

### ✅ Do's

1. **Use Number Storage**

   ```typescript
   // ✅ Store as number
   Currency({ db_fieldName: 'price', currencyCode: 'EUR' });
   // Stores: 1234.56
   ```

2. **Set Appropriate Ranges**

   ```typescript
   // ✅ Prevent negative prices
   Currency({
   	db_fieldName: 'price',
   	minValue: 0.01, // Minimum 1 cent
   	maxValue: 999999.99
   });
   ```

3. **Use Correct Currency Codes**

   ```typescript
   // ✅ ISO 4217 standard
   currencyCode: 'EUR'; // Euro
   currencyCode: 'USD'; // US Dollar
   currencyCode: 'GBP'; // British Pound
   ```

4. **Provide Context**

   ```typescript
   // ✅ Help users understand the field
   Currency({
   	label: 'Monthly Subscription',
   	placeholder: '$0.00',
   	helper: 'Billed monthly, cancel anytime'
   });
   ```

5. **Enable Calculations**
   ```typescript
   // ✅ Numeric type allows direct math
   const finalPrice = product.price - product.discount;
   const tax = product.price * 0.19;
   const total = product.price + tax;
   ```

### ❌ Don'ts

1. **Don't Store as String**

   ```typescript
   // ❌ WRONG: String storage
   Input({ db_fieldName: 'price', inputType: 'text' });
   // Stores: "€1,234.56" or "$1,234.56"
   // Problems: Can't calculate, sort, or aggregate
   ```

2. **Don't Use for Non-Currency**

   ```typescript
   // ❌ WRONG: Using currency for quantity
   Currency({ label: 'Quantity', currencyCode: 'USD' });
   // User sees: "$5.00" (confusing!)

   // ✅ CORRECT: Use Number widget
   Number({ label: 'Quantity', min: 1, suffix: ' items' });
   ```

3. **Don't Hard-code Locale**

   ```typescript
   // ❌ WRONG: Hard-coded format
   const formatted = `€${price.toFixed(2)}`;
   // Always shows: "€1234.56" (US format with € symbol)

   // ✅ CORRECT: Let widget handle formatting
   Currency({ currencyCode: 'EUR' });
   // Shows: "1.234,56 €" (German), "€1,234.56" (US), "1 234,56 €" (French)
   ```

4. **Don't Mix Currency and Formatting**

   ```typescript
   // ❌ WRONG: Storing formatted value
   const product = {
   	price: '€1.234,56', // ❌ String with formatting
   	currency: 'EUR'
   };

   // ✅ CORRECT: Store clean number
   const product = {
   	price: 1234.56, // ✅ Clean number
   	currency: 'EUR' // Currency code separate
   };
   ```

5. **Don't Forget Validation**

   ```typescript
   // ❌ WRONG: No validation
   Currency({ db_fieldName: 'discount' });
   // User could enter negative or huge values

   // ✅ CORRECT: Set reasonable limits
   Currency({
   	db_fieldName: 'discount',
   	minValue: 0,
   	maxValue: 1000,
   	required: false
   });
   ```

---

## Performance Considerations

### Formatting Performance

```typescript
// ✅ Efficient: Formatter created once
const formatter = new Intl.NumberFormat('de-DE', {
	style: 'currency',
	currency: 'EUR'
});

// Use multiple times
products.forEach((p) => {
	p.displayPrice = formatter.format(p.price);
});

// ❌ Inefficient: Creating formatter every time
products.forEach((p) => {
	const fmt = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' });
	p.displayPrice = fmt.format(p.price);
});
```

### Large Lists

```typescript
// ✅ Virtual scrolling for large lists
import { VirtualList } from '@components/VirtualList';

{#each virtualizedProducts as product}
  <div>
    {formatter.format(product.price)}
  </div>
{/each}

// ❌ Rendering thousands of formatted values at once
{#each allProducts as product}
  <div>
    {new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(product.price)}
  </div>
{/each}
```

### Database Indexing

```typescript
// ✅ Index frequently queried fields
db.products.createIndex({ price: 1 });
db.products.createIndex({ price: 1, category: 1 });

// ✅ Use indexed queries
db.products
	.find({ price: { $gte: 100, $lte: 500 } })
	.hint({ price: 1 }) // Use price index
	.sort({ price: 1 });
```

---

## Troubleshooting

### Issue: Decimal Separator Wrong

**Problem**: User sees comma but expects period (or vice versa)

**Solution**: Check user locale setting

```typescript
// In globalSettings.ts
export const publicEnv = writable({
	LOCALE: 'en-US', // Period as decimal: 1,234.56
	// OR
	LOCALE: 'de-DE' // Comma as decimal: 1.234,56
});
```

### Issue: Currency Symbol Wrong

**Problem**: Shows € but should show $

**Solution**: Check currency code in field definition

```typescript
// Wrong currency code
Currency({ currencyCode: 'EUR' }); // Shows €

// Correct currency code
Currency({ currencyCode: 'USD' }); // Shows $
```

### Issue: Value Not Saving

**Problem**: Currency value not persisting to database

**Solution 1**: Check field is not readonly

```typescript
Currency({
	db_fieldName: 'price',
	readonly: false // ✅ Editable
});
```

**Solution 2**: Check validation rules

```typescript
Currency({
	db_fieldName: 'price',
	required: true, // Must have value
	minValue: 0.01, // Must be positive
	maxValue: 999999.99 // Must be reasonable
});
```

### Issue: Calculation Errors

**Problem**: Math operations give wrong results

**Solution**: JavaScript floating-point precision

```typescript
// ❌ Floating-point issue
const price = 0.1 + 0.2; // 0.30000000000000004

// ✅ Solution 1: Round to cents
const price = Math.round((0.1 + 0.2) * 100) / 100; // 0.30

// ✅ Solution 2: Use decimal library
import Decimal from 'decimal.js';
const price = new Decimal(0.1).plus(0.2).toNumber(); // 0.3

// ✅ Solution 3: Work in cents
const priceInCents = 10 + 20; // 30 cents
const priceInDollars = priceInCents / 100; // $0.30
```

### Issue: Formatting Not Working

**Problem**: Currency displays as plain number

**Solution**: Check Intl.NumberFormat support

```typescript
// Check browser support
if (typeof Intl === 'undefined' || !Intl.NumberFormat) {
	console.error('Intl.NumberFormat not supported');
	// Fallback formatting
}

// Modern browsers: All support Intl.NumberFormat
// IE11: Requires polyfill
```

### Issue: Mobile Keyboard Wrong

**Problem**: Mobile shows full keyboard instead of numeric

**Solution**: Check inputmode attribute

```html
<!-- ✅ Correct -->
<input type="text" inputmode="decimal" />

<!-- ❌ Wrong -->
<input type="text" />
```

---

## Migration Guide

### From String to Number Storage

If you previously stored currency as strings, migrate to number storage:

```typescript
// Step 1: Create migration script
async function migrateCurrencyFields() {
	const products = await db.products.find({
		price: { $type: 'string' } // Find string prices
	});

	for (const product of products) {
		// Parse string to number
		const numericPrice = parseFloat(product.price.replace(/[^0-9.-]/g, ''));

		// Update to number
		await db.products.updateOne({ _id: product._id }, { $set: { price: numericPrice } });
	}
}

// Step 2: Update field definition
// Before:
Input({ db_fieldName: 'price', inputType: 'text' });

// After:
Currency({ db_fieldName: 'price', currencyCode: 'EUR' });

// Step 3: Run migration
await migrateCurrencyFields();
```

### From Input to Currency Widget

```typescript
// Before: Generic input
Input({
	label: 'Price',
	db_fieldName: 'price',
	inputType: 'number'
});

// After: Currency widget
Currency({
	label: 'Price',
	db_fieldName: 'price',
	currencyCode: 'EUR',
	minValue: 0,
	required: true
});

// No data migration needed if already storing numbers
```

---

## API Reference

### Widget Function

```typescript
function Currency(props: CurrencyProps): FieldInstance;
```

### CurrencyProps Interface

```typescript
interface CurrencyProps {
	label: string;
	db_fieldName: string;
	currencyCode?: string;
	required?: boolean;
	minValue?: number;
	maxValue?: number;
	placeholder?: string;
	default?: number;
	width?: number;
	helper?: string;
	readonly?: boolean;
	showIf?: (data: any) => boolean;
}
```

### Data Type

```typescript
type CurrencyValue = number | null | undefined;

// ✅ Valid values
const price: CurrencyValue = 1234.56;
const discount: CurrencyValue = 0;
const optional: CurrencyValue = null;

// ❌ Invalid values
const wrong: CurrencyValue = '1234.56'; // ❌ String
const wrong2: CurrencyValue = '€1,234.56'; // ❌ Formatted string
```

---

## Related Widgets

- **[Number Widget](/widgets/custom/number)** - Generic numeric input for quantities, ratings, and scores
- **[Input Widget](/widgets/core/input)** - Text input for IDs, codes, and non-numeric data
- **[Select Widget](/widgets/core/select)** - Dropdown for currency code selection
- **[PhoneNumber Widget](/widgets/custom/phoneNumber)** - Specialized for phone numbers (stored as strings)

---

## Resources

### Standards

- [ISO 4217 Currency Codes](https://en.wikipedia.org/wiki/ISO_4217)
- [Intl.NumberFormat Documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat)
- [IEEE 754 Floating Point](https://en.wikipedia.org/wiki/IEEE_754)

### Libraries

- [decimal.js](https://github.com/MikeMcl/decimal.js/) - Arbitrary-precision decimal arithmetic
- [big.js](https://github.com/MikeMcl/big.js/) - Small, fast library for decimal math
- [currency.js](https://github.com/scurker/currency.js) - Currency formatting library

### Tools

- [Currency Converter API](https://exchangerate.host/) - Real-time exchange rates
- [Locale Explorer](https://www.localeplanet.com/) - Locale-specific formatting examples

---

## Changelog

### Version 1.0.0 (2025-01-15)

- ✅ Initial release with numeric storage
- ✅ Locale-aware formatting with Intl.NumberFormat
- ✅ Multi-currency support (ISO 4217)
- ✅ Mobile-optimized with inputmode="decimal"
- ✅ Database aggregation support
- ✅ Full accessibility with ARIA
- ✅ Comprehensive documentation

---

## Contributing

Found a bug or have a feature request? Please open an issue on our [GitHub repository](https://github.com/SveltyCMS/SveltyCMS).

---

## License

The Currency widget is part of SveltyCMS and is licensed under the MIT License.
