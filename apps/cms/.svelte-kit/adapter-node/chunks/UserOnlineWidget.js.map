{"version":3,"file":"UserOnlineWidget.js","sources":["../../../../../../shared/features/src/dashboard/widgets/UserOnlineWidget.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/dashboard/widgets/UserOnlineWidget.svelte\n@component\n**Dashboard widget for displaying online users with online time tracking**\n\n@example\n<UserOnlineWidget label=\"Online Users\" />\n\n### Props\n- `label`: The label for the widget (default: 'Online Users')\n\nFeatures:\n- Display currently logged-in users\n- Show online duration for each user\n- Sorted by longest online time first\n- Real-time avatar display with fallback placeholders\n- Responsive layout with hover effects\n- Theme-aware rendering (light/dark mode support)\n- Real-time data updates\n-->\n<script lang=\"ts\" module>\n\texport const widgetMeta = {\n\t\tname: 'Online Users',\n\t\ticon: 'mdi:account-multiple-outline',\n\t\tdefaultSize: { w: 1, h: 2 }\n\t};\n</script>\n\n<script lang=\"ts\">\n\timport BaseWidget from '../BaseWidget.svelte';\n\timport type { WidgetSize } from '@cms-types';\n\n\tinterface OnlineUser {\n\t\tid: string;\n\t\tname: string;\n\t\tavatarUrl?: string;\n\t\tonlineTime: string;\n\t\tonlineMinutes: number;\n\t}\n\n\ttype FetchedData = { onlineUsers: OnlineUser[] } | undefined;\n\n\tlet searchTerm = $state('');\n\n\tconst {\n\t\tlabel = 'Online Users',\n\t\ttheme = 'light' as 'light' | 'dark',\n\t\ticon = 'mdi:account-multiple-outline',\n\t\twidgetId = undefined,\n\t\tsize = { w: 1, h: 1 },\n\t\tonSizeChange = (_newSize: WidgetSize) => {},\n\t\tonRemove = () => {}\n\t}: {\n\t\tlabel?: string;\n\t\ttheme?: 'light' | 'dark';\n\t\ticon?: string;\n\t\twidgetId?: string;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tonRemove?: () => void;\n\t} = $props();\n\n\tfunction getPlaceholderAvatar(name: string) {\n\t\tconst initials = name\n\t\t\t.split(' ')\n\t\t\t.map((n) => n[0])\n\t\t\t.join('')\n\t\t\t.substring(0, 2)\n\t\t\t.toUpperCase();\n\t\treturn `https://placehold.co/40x40/6366f1/e0e7ff?text=${initials}`;\n\t}\n\n\tfunction filterUsers(users: OnlineUser[], search: string): OnlineUser[] {\n\t\tif (!search.trim()) return users;\n\t\tconst searchLower = search.toLowerCase();\n\t\treturn users.filter((user) => user.name.toLowerCase().includes(searchLower));\n\t}\n</script>\n\n<BaseWidget\n\t{label}\n\t{theme}\n\tendpoint=\"/api/dashboard/online_user\"\n\tpollInterval={60000}\n\t{icon}\n\t{widgetId}\n\t{size}\n\t{onSizeChange}\n\tonCloseRequest={onRemove}\n>\n\t{#snippet children({ data: fetchedData }: { data: FetchedData })}\n\t\t{#if fetchedData?.onlineUsers}\n\t\t\t{@const filteredUsers = filterUsers(fetchedData.onlineUsers, searchTerm)}\n\t\t\t<div class=\"flex h-full flex-col space-y-2\">\n\t\t\t\t<!-- Header with count -->\n\t\t\t\t<div class=\"text-center text-sm\">\n\t\t\t\t\t<span class=\"font-bold text-primary-500\">{fetchedData.onlineUsers.length}</span>\n\t\t\t\t\tUser(s) currently online.\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Search input (always show if there are users) -->\n\t\t\t\t{#if fetchedData.onlineUsers.length > 0}\n\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tplaceholder=\"Search users...\"\n\t\t\t\t\t\t\tbind:value={searchTerm}\n\t\t\t\t\t\t\tclass=\"w-full rounded-md border border-surface-300 bg-surface-50 px-3 py-1.5 text-xs placeholder-surface-400 focus:border-primary-400 focus:outline-none focus:ring-1 focus:ring-primary-400 dark:border-surface-600 dark:bg-surface-700 dark:text-surface-200 dark:placeholder-surface-500\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:magnify\" class=\"absolute right-2 top-1/2 -translate-y-1/2 text-surface-400 dark:text-surface-500\" width=\"14\"\n\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- User list -->\n\t\t\t\t<div class=\"grow space-y-1 overflow-y-auto\" style=\"max-height: 180px;\">\n\t\t\t\t\t{#if filteredUsers.length > 0}\n\t\t\t\t\t\t{#each filteredUsers as user (user.id)}\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between gap-2 rounded-lg p-2 hover:bg-surface-50 dark:hover:bg-surface-700\">\n\t\t\t\t\t\t\t\t<div class=\"flex min-w-0 flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\tsrc={user.avatarUrl || getPlaceholderAvatar(user.name)}\n\t\t\t\t\t\t\t\t\t\talt=\"{user.name}'s avatar\"\n\t\t\t\t\t\t\t\t\t\tclass=\"h-7 w-7 shrink-0 rounded-full bg-surface-200 dark:bg-surface-700\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span class=\"truncate text-sm font-medium text-surface-800 dark:text-surface-200\">{user.name}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class=\"shrink-0 text-xs text-surface-500 dark:text-surface-50\">\n\t\t\t\t\t\t\t\t\t{user.onlineTime || 'N/A'}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{:else if searchTerm}\n\t\t\t\t\t\t<div class=\"flex h-full items-center justify-center text-sm text-surface-500\">\n\t\t\t\t\t\t\tNo users found matching \"{searchTerm}\".\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"flex h-full items-center justify-center text-sm text-surface-500\">No users are currently active.</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"flex h-full items-center justify-center text-sm text-surface-500\">Loading online users...</div>\n\t\t{/if}\n\t{/snippet}\n</BaseWidget>\n"],"names":["$$renderer","$.attr","$.stringify","$.escape"],"mappings":";;MAqBc,aAAU;AAAA,EACtB,MAAM;AAAA,EACN,MAAM;AAAA,EACN,eAAe,GAAG,GAAG,GAAG,EAAC;;;wCAI3B;AAcK,QAAA,aAAoB;;MAGvB,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,WAAW;AAAA,MACX,SAAS,GAAG,GAAG,GAAG,EAAC;AAAA,MACnB,eAAY,CAAI,aAAyB;AAAA,MAAC;AAAA,MAC1C,iBAAiB;AAAA,MAAC;AAAA;aAWV,qBAAqB,MAAc;YACrC,WAAW,KACf,MAAM,GAAG,EACT,IAAG,CAAE,MAAM,EAAE,CAAC,CAAA,EACd,KAAK,EAAE,EACP,UAAU,GAAG,CAAC,EACd,YAAW;8DAC2C,QAAQ;AAAA,IACjE;AAES,aAAA,YAAY,OAAqB,QAA8B;WAClE,OAAO,KAAI,EAAA,QAAW;YACrB,cAAc,OAAO,YAAW;AAC/B,aAAA,MAAM,OAAM,CAAE,SAAS,KAAK,KAAK,YAAW,EAAG,SAAS,WAAW,CAAA;AAAA,IAC3E;;UAcU,oBAAQA,aAAA,EAAG,MAAM,YAAW,GAAA;AAChC,YAAA,aAAa,aAAW;;AACpB,gBAAA,gBAAgB,YAAY,YAAY,aAAa,UAAU;gKAI3B,YAAY,YAAY,MAAM,CAAA,0CAAA;AAKpE,cAAA,YAAY,YAAY,SAAS,GAAC;;oHAKxB,UAAU,CAAA,4bAAA;AAAA;;;;cAUnB,cAAc,SAAS,GAAC;;;iDACrB,aAAa;;kBAAI,OAAI,WAAA,OAAA;wNAInB,KAAK,aAAa,qBAAqB,KAAK,IAAI,CAAA,CAAA,GAAAC,KAAA,OAAA,GAAAC,UAC/C,KAAK,IAAI,CAAA,WAAA,CAAA,iKAAAC,YAGmE,KAAK,IAAI,mGAG3F,KAAK,cAAc,KAAK,CAAA,eAAA;AAAA;;;;;;;;;;;;;;;;;;QAhDhC;AAAA,QACA;AAAA;sBAEa;AAAA,QACb;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,wBACe;AAAA,QAEN;AAAA;;EAbH,CAAA;;"}