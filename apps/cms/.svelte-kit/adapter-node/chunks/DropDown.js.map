{"version":3,"file":"DropDown.js","sources":["../../../../src/widgets/core/RichText/components/DropDown.svelte"],"sourcesContent":["<!--\n@file: /src/components/Dropdown.svelte\n@component\n**An improved dropdown component that displays the currently selected item and properly handles icons**\n\n### Props\n- `items`: Array of selectable items\n- `label`: Optional label for the dropdown\n- `icon`: Optional icon for the dropdown button\n- `class`: Custom class for the dropdown container\n- `show`: Whether to show the dropdown\n- `active`: Currently active dropdown ID\n\n### Features\n- Click to edit\n- Enter to save\n- Escape to cancel\n-->\n\n<script lang=\"ts\">\n\timport { onMount, tick } from 'svelte';\n\timport { twMerge } from 'tailwind-merge';\n\n\t// Define props using Svelte 5 runes\n\tlet {\n\t\titems = [], // Array of selectable items\n\t\tlabel = '', // Optional label for the dropdown\n\t\ticon = undefined, // Optional icon for the dropdown button\n\t\tclass: className = '', // Custom class for the dropdown container\n\t\tshow = true, // Whether to show the dropdown\n\t\tactive = $bindable('') // Currently active dropdown ID\n\t} = $props();\n\n\tlet expanded = $state(false);\n\tlet dropdownRef: HTMLDivElement | undefined = $state();\n\tlet buttonRef: HTMLButtonElement | undefined = $state();\n\tconst dropdownId = $state(`dropdown-${Math.random().toString(36).substring(2, 9)}`);\n\tconst listboxId = $derived(`${dropdownId}-menu`);\n\tlet focusedIndex = $state(-1); // roving focus index when expanded\n\tconst itemRefs: Array<HTMLButtonElement | null> = [];\n\tlet _refresh = $state(0); // force re-render when selection changes\n\n\t// Action to capture each item's button element reference\n\tfunction captureItem(node: HTMLButtonElement, index: number) {\n\t\titemRefs[index] = node;\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\t// Clean up reference on removal\n\t\t\t\tif (itemRefs[index] === node) itemRefs[index] = null;\n\t\t\t}\n\t\t};\n\t}\n\n\t// Get active item based on items with active: true\n\tfunction getActiveItem() {\n\t\treturn items.find((item) => item.active && item.active());\n\t}\n\n\t// Toggle dropdown expansion\n\tfunction open(expandToIndex: number | null = null) {\n\t\tif (expanded) return;\n\t\t// close other dropdowns\n\t\tif (active !== dropdownId && active !== '') active = '';\n\t\texpanded = true;\n\t\tactive = dropdownId;\n\t\t// set initial focus index\n\t\tconst activeItem = getActiveItem();\n\t\tlet idx = expandToIndex ?? (activeItem ? items.findIndex((i) => i === activeItem) : 0);\n\t\tif (idx < 0) idx = 0;\n\t\tfocusedIndex = idx;\n\t\ttick().then(() => itemRefs[focusedIndex]?.focus());\n\t}\n\n\tfunction close(focusButton = true) {\n\t\tif (!expanded) return;\n\t\texpanded = false;\n\t\tactive = '';\n\t\tfocusedIndex = -1;\n\t\tif (focusButton) buttonRef?.focus();\n\t}\n\n\tfunction toggleExpanded(e: Event) {\n\t\te.stopPropagation();\n\t\texpanded ? close(true) : open();\n\t}\n\n\t// Handle item selection\n\tfunction selectItem(item: any, e: Event) {\n\t\te.stopPropagation();\n\t\tif (item.onClick) item.onClick();\n\t\t_refresh++; // trigger recompute of button label/icon\n\t\tclose(true);\n\t}\n\n\t// Effect to handle closing when active changes\n\t$effect(() => {\n\t\tif (active !== dropdownId) {\n\t\t\texpanded = false;\n\t\t}\n\t});\n\n\t// Add global click event listener to close dropdown when clicking outside\n\tonMount(() => {\n\t\tconst handleClickOutside = (event: MouseEvent) => {\n\t\t\tif (dropdownRef && !dropdownRef.contains(event.target as Node) && expanded) {\n\t\t\t\tclose(false);\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener('click', handleClickOutside);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('click', handleClickOutside);\n\t\t};\n\t});\n\n\t// Button label/icon reflect active item or fallback to provided label/icon\n\tfunction getButtonText() {\n\t\tconst ai = getActiveItem();\n\t\treturn (ai && (ai.name || ai.title)) || label;\n\t}\n\n\tfunction getButtonIcon() {\n\t\tconst ai = getActiveItem();\n\t\t// If we have an active item with icon use it, else fallback to provided icon\n\t\treturn ai?.icon || icon;\n\t}\n</script>\n\n<div class={twMerge('relative', className)} class:hidden={!show} bind:this={dropdownRef}>\n\t<button\n\t\tbind:this={buttonRef}\n\t\tonclick={toggleExpanded}\n\t\tonkeydown={(e) => {\n\t\t\tif (e.key === 'ArrowDown') {\n\t\t\t\topen(0);\n\t\t\t\te.preventDefault();\n\t\t\t} else if (e.key === 'ArrowUp') {\n\t\t\t\topen(items.length - 1);\n\t\t\t\te.preventDefault();\n\t\t\t} else if (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\topen();\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t}}\n\t\tclass=\"preset-filled-tertiary-500 btn flex w-fit items-center gap-1 rounded dark:preset-outlined-primary-500\"\n\t\taria-haspopup=\"true\"\n\t\taria-expanded={expanded}\n\t\taria-controls={listboxId}\n\t\tid={`${dropdownId}-button`}\n\t\taria-label={label || undefined}\n\t>\n\t\t{#if getButtonIcon()}\n\t\t\t<iconify-icon\n\t\t\t\ticon={getButtonIcon()}\n\t\t\t\twidth=\"18\"\n\t\t\t\tclass={getActiveItem() ? 'text-tertiary-50 dark:text-tertiary-300' : 'text-surface-800 dark:text-surface-200'}\n\t\t\t></iconify-icon>\n\t\t{/if}\n\t\t<span class=\"hidden text-sm sm:inline\" class:text-tertiary-50={!!getActiveItem()} class:text-surface-800={!getActiveItem()}\n\t\t\t>{getButtonText()}</span\n\t\t>\n\t</button>\n\n\t{#if expanded}\n\t\t<div\n\t\t\tid={listboxId}\n\t\t\tclass=\"absolute z-20 mt-1 w-fit min-w-full overflow-auto rounded-md border border-surface-400/30 bg-surface-50/95 shadow-lg backdrop-blur-sm focus:outline-none dark:border-surface-300/20 dark:bg-surface-800/90\"\n\t\t\trole=\"menu\"\n\t\t\ttabindex=\"-1\"\n\t\t\taria-labelledby={`${dropdownId}-button`}\n\t\t\tonkeydown={(e) => {\n\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\tclose(true);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst max = items.length - 1;\n\t\t\t\tif (e.key === 'ArrowDown') {\n\t\t\t\t\tfocusedIndex = focusedIndex < max ? focusedIndex + 1 : 0;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.key === 'ArrowUp') {\n\t\t\t\t\tfocusedIndex = focusedIndex > 0 ? focusedIndex - 1 : max;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.key === 'Home') {\n\t\t\t\t\tfocusedIndex = 0;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.key === 'End') {\n\t\t\t\t\tfocusedIndex = max;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t{#each items as item, i}\n\t\t\t\t<button\n\t\t\t\t\tuse:captureItem={i}\n\t\t\t\t\tonclick={(e) => selectItem(item, e)}\n\t\t\t\t\tonkeydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\t\t\tselectItem(item, e);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"flex w-full items-center gap-2 px-3 py-2 text-left text-surface-700 hover:bg-surface-200/70 focus:bg-tertiary-500/20 focus:outline-none dark:text-white dark:hover:bg-surface-600/60 dark:focus:bg-tertiary-400/25\"\n\t\t\t\t\tclass:active={item.active && item.active()}\n\t\t\t\t\trole=\"menuitem\"\n\t\t\t\t\ttabindex={i === focusedIndex ? 0 : -1}\n\t\t\t\t\taria-current={item.active && item.active() ? 'true' : undefined}\n\t\t\t\t>\n\t\t\t\t\t{#if item.active && item.active()}\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:check\" width=\"16\" class=\"text-tertiary-600 dark:text-tertiary-400\"></iconify-icon>\n\t\t\t\t\t{:else if item.icon}\n\t\t\t\t\t\t<iconify-icon icon={item.icon} width=\"18\"></iconify-icon>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<span class=\"whitespace-nowrap text-sm\">{item.name || item.title || ''}</span>\n\t\t\t\t</button>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\tbutton.active {\n\t\tcolor: rgb(0, 255, 123);\n\t}\n</style>\n"],"names":["$$renderer","$.attr_class","$.clsx","$.attr"],"mappings":";;;wCAmBA;;MAME,QAAK,CAAA;AAAA;AAAA,MACL,QAAQ;AAAA;AAAA,MACR,OAAO;AAAA;AAAA,MACP,OAAO,YAAY;AAAA;AAAA,MACnB,OAAO;AAAA;AAAA,MACP,SAAmB;AAAA;AAAA;AAGhB,QAAA,WAAkB;AAGhB,UAAA,aAAU,YAAsB,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,UAAU,GAAG,CAAC,CAAA;AACzE,UAAA,eAAwB,UAAU;AAiB/B,aAAA,gBAAgB;aACjB,MAAM,KAAI,CAAE,SAAS,KAAK,UAAU,KAAK,QAAM;AAAA,IACvD;AA6DS,aAAA,gBAAgB;AAClB,YAAA,KAAK,cAAa;aAChB,OAAO,GAAG,QAAQ,GAAG,UAAW;AAAA,IACzC;AAES,aAAA,gBAAgB;AAClB,YAAA,KAAK,cAAa;aAEjB,IAAI,QAAQ;AAAA,IACpB;AAGW,IAAAA,YAAA,KAAA,OAAAC,WAAAC,KAAA,QAAQ,YAAY,SAAS,yBAAkB,KAAI,CAAA,CAAA,8IAAAC,KAAA,iBAkB9C,QAAQ,CAAA,GAAAA,KAAA,iBACR,SAAS,CAAA,GAAAA,KAAA,MAAA,GACjB,UAAU,SAAA,CAAA,GAAAA,KAAA,cACL,SAAS,MAAS,CAAA,GAAA;QAEzB,cAAa,GAAA;;AAEV,MAAAH,YAAA,KAAA,gBAAAG,KAAA,QAAA,cAAa,gCAEZ,cAAa,IAAK,4CAA4C,wCAAwC,CAAA,CAAA,kBAAA;AAAA;;;;4BAG9C,cAAa;AAAA,2BAA6B,cAAa;AAAA,sBACrH,cAAa,CAAA,CAAA,mBAAA;;;;;;EAjCV,CAAA;;"}