{"version":3,"file":"Input10.js","sources":["../../../../src/widgets/custom/Currency/Input.svelte"],"sourcesContent":["<!--\n@file src/widgets/custom/Currency/Input.svelte\n@component\n**Currency Widget Input Component**\n\nProvides localized currency input with real-time formatting and parsing capabilities.\nPart of the Three Pillars Architecture for WSidget system.\n\n@example\n<CurrencyInput bind:value={amount} field={{ currencyCode: \"EUR\", required: true }} />\nUser types \"1234.56\" → displays \"1.234,56 €\" → stores 1234.56 as number \n\n### Props\n- `field: FieldType` - Widget field definition with currency code and validation\n- `value: number | null | undefined` - Numeric currency value (bindable)\n- `error?: string | null` - Validation error message for display\n\n### Features\n- **Bi-directional Formatting**: Converts between localized display and numeric storage\n- **Real-time Parsing**: Parses localized input (e.g., \"1.234,56\") to clean numbers\n- **Auto-formatting on Blur**: Reformats input to canonical currency display\n- **Locale-aware Parsing**: Handles different decimal/thousand separators by region\n- **Mobile Optimized**: Uses `inputmode=\"decimal\"` for numeric keyboards\n- **Multi-Currency Support**: Configurable currency codes with proper symbols\n- **Error State Handling**: Visual error indication with accessible messaging\n- **Placeholder Intelligence**: Shows formatted zero as input placeholder\n- **Data Integrity**: Stores clean numeric values regardless of display format\n-->\n\n<script lang=\"ts\">\n\timport { app } from '@shared/stores/store.svelte';\n\timport type { FieldType } from './';\n\timport { tokenTarget } from '@shared/services/token/tokenTarget';\n\n\tlet { field, value, error }: { field: FieldType; value: number | null | undefined; error?: string | null } = $props();\n\n\t// Get the user's current UI language.\n\tconst lang = $derived(app.systemLanguage);\n\n\t// Create a memoized number formatter for the specified currency.\n\tconst formatter = $derived(\n\t\tnew Intl.NumberFormat(lang as string, {\n\t\t\tstyle: 'currency',\n\t\t\tcurrency: (field.currencyCode as string) || 'EUR'\n\t\t})\n\t);\n\n\t// Local state for the displayed, formatted string.\n\tlet formattedValue = $state('');\n\n\t// Effect 1: When the parent `value` (number) changes, update the local formatted string.\n\t$effect(() => {\n\t\t// Only update if the number is valid and different from what the input already represents.\n\t\tconst currentNumericValue = parseLocalizedNumber(formattedValue, lang);\n\t\tif (typeof value === 'number' && value !== currentNumericValue) {\n\t\t\tformattedValue = formatter.format(value);\n\t\t} else if (value === null || value === undefined) {\n\t\t\tformattedValue = '';\n\t\t}\n\t});\n\n\t// This function is called when the user types in the input.\n\tfunction handleInput(event: Event & { currentTarget: HTMLInputElement }) {\n\t\tconst inputString = event.currentTarget.value;\n\t\t// Parse the localized string back into a number.\n\t\tconst numericValue = parseLocalizedNumber(inputString, lang);\n\t\t// Update the parent's `value` with the clean number.\n\t\tvalue = isNaN(numericValue) ? null : numericValue;\n\t}\n\n\t// This function is called when the user leaves the input field.\n\tfunction handleBlur() {\n\t\t// Re-format the input to a clean, canonical currency format.\n\t\tif (typeof value === 'number') {\n\t\t\tformattedValue = formatter.format(value);\n\t\t}\n\t}\n\n\t// A helper function to parse a localized number string (e.g., \"1.234,56\") into a JS number.\n\tfunction parseLocalizedNumber(str: string, locale: string): number {\n\t\tconst parts = new Intl.NumberFormat(locale).formatToParts(1234.5);\n\t\tconst group = parts.find((p) => p.type === 'group')?.value || ',';\n\t\tconst decimal = parts.find((p) => p.type === 'decimal')?.value || '.';\n\t\tconst cleaned = str.replace(new RegExp(`\\\\${group}`, 'g'), '').replace(decimal, '.');\n\t\treturn parseFloat(cleaned.replace(/[^\\d.-]/g, ''));\n\t}\n</script>\n\n<div class=\"input-container relative mb-4\">\n\t<div class=\"preset-filled-surface-500 btn-group flex w-full rounded\" role=\"group\">\n\t\t{#if field?.prefix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.prefix} prefix`}>\n\t\t\t\t{field?.prefix}\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"relative w-full flex-1\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tbind:value={formattedValue}\n\t\t\t\toninput={handleInput}\n\t\t\t\tonblur={handleBlur}\n\t\t\t\tuse:tokenTarget={{\n\t\t\t\t\tname: field.db_fieldName,\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tcollection: (field as any).collection\n\t\t\t\t}}\n\t\t\t\tname={field?.db_fieldName}\n\t\t\t\tid={field?.db_fieldName}\n\t\t\t\tplaceholder={typeof field?.placeholder === 'string' && field.placeholder !== '' ? field.placeholder : String(field?.db_fieldName ?? '')}\n\t\t\t\trequired={field?.required as boolean | undefined}\n\t\t\t\treadonly={field?.readonly as boolean | undefined}\n\t\t\t\tdisabled={field?.disabled as boolean | undefined}\n\t\t\t\tclass=\"input w-full rounded-none text-black dark:text-primary-500\"\n\t\t\t\tclass:!border-error-500={!!error}\n\t\t\t\tclass:!ring-1={!!error}\n\t\t\t\tclass:!ring-error-500={!!error}\n\t\t\t\taria-invalid={!!error}\n\t\t\t\taria-describedby={error ? `${field.db_fieldName}-error` : undefined}\n\t\t\t\taria-required={field?.required}\n\t\t\t\tdata-testid=\"currency-input\"\n\t\t\t/>\n\t\t</div>\n\n\t\t{#if field?.suffix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.suffix} suffix`}>\n\t\t\t\t{field?.suffix}\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n\n\t<!-- Validation indicator -->\n\t{#if error}\n\t\t<p id={`${field.db_fieldName}-error`} class=\"absolute bottom-0 left-0 w-full text-center text-xs text-error-500\" role=\"alert\" aria-live=\"polite\">\n\t\t\t{error}\n\t\t</p>\n\t{/if}\n</div>\n"],"names":["$$renderer","$.attr","$.escape","$.attr_class"],"mappings":";;;wCA6BA;UAKO,OAAO,OAAO,MAAK,IAAA;UAGnB,OAAgB,IAAI;QAIrB,KAAK,aAAa,MAAI,EACzB,OAAO,YACP,UAAW,MAAM,gBAA2B,MAAI,CAAA;AAK9C,QAAA,iBAAwB;;AA0CtB,QAAA,OAAO,QAAM;;AACkC,MAAAA,YAAA,KAAA,sCAAAC,KAAA,cAAA,GAAA,MAAM,MAAM,SAAA,CAAA,IAAAC,YAC7D,OAAO,MAAM,CAAA,WAAA;AAAA;;;AAOF,IAAAF,YAAA,KAAA,kEAAAC,KAAA,SAAA,cAAc,iBAQpB,OAAO,YAAY,CAAA,GAAAA,KAAA,MACrB,OAAO,YAAY,CAAA,GAAAA,KAAA,eAAA,OACH,OAAO,gBAAgB,YAAY,MAAM,gBAAgB,KAAK,MAAM,cAAc,OAAO,OAAO,gBAAgB,EAAE,CAAA,CAAA,GAAAA,KAAA,YAC5H,OAAO,mCACP,OAAO,UAAQ,IAAA,CAAA,GAAAA,KAAA,YACf,OAAO,UAAQ,IAAA,CAAA,GAAAE,WAAA,8DAAA,QAAA;AAAA,6BAEE;AAAA,mBACV;AAAA,2BACQ;AAAA,gCACT,KAAK,CAAA,GAAAF,KAAA,oBACH,QAAK,GAAM,MAAM,YAAY,WAAW,MAAS,CAAA,GAAAA,KAAA,iBACpD,OAAO,QAAQ,CAAA,wCAAA;AAK3B,QAAA,OAAO,QAAM;;AACkC,MAAAD,YAAA,KAAA,sCAAAC,KAAA,cAAA,GAAA,MAAM,MAAM,SAAA,CAAA,IAAAC,YAC7D,OAAO,MAAM,CAAA,WAAA;AAAA;;;;QAMZ,OAAK;;0CACC,MAAM,YAAY,QAAA,CAAA,+GAAAA,YAC1B,KAAK,CAAA,MAAA;AAAA;;;;EAhDD,CAAA;;"}