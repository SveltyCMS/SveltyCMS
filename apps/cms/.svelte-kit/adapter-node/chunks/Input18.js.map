{"version":3,"file":"Input18.js","sources":["../../../../src/widgets/core/RichText/extensions/ImageResize.ts","../../../../src/widgets/core/RichText/extensions/TextStyle.ts","../../../../src/widgets/core/RichText/Input.svelte"],"sourcesContent":["/**\n@file src/widgets/core/RichText/extensions/ImageResize.ts\n@description - RichText TipTap widget image extension\n\nFeatures:\n- Image Resizing\n- Image Float\n- Image Description\n*/\nimport { Image as ImageExtension } from '@tiptap/extension-image';\n\ndeclare module '@tiptap/core' {\n\tinterface Commands<ReturnType> {\n\t\timageResize: {\n\t\t\tsetImageDescription: (description: string) => ReturnType;\n\t\t\tsetImageFloat: (size: 'left' | 'right' | 'unset') => ReturnType;\n\t\t\tsetImage: (options: { src: string; alt?: string; title?: string; id?: string; storage_image?: string }) => ReturnType;\n\t\t};\n\t}\n}\n\nconst DESCRIPTION_STYLE =\n\t'text-align: center;position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, .5); color: #fff; padding: 5px; font-size: 16px;';\n\nconst ImageResize = ImageExtension.extend({\n\taddOptions() {\n\t\treturn {\n\t\t\tinline: false,\n\t\t\tHTMLAttributes: {},\n\t\t\tresize: false,\n\t\t\t...this.parent?.(),\n\t\t\tid: null,\n\t\t\tmedia_image: null,\n\t\t\tallowBase64: true,\n\t\t\tsizes: ['25%', '50%', '75%', '100%']\n\t\t};\n\t},\n\n\taddCommands() {\n\t\treturn {\n\t\t\t...this.parent?.(),\n\t\t\tsetImageFloat:\n\t\t\t\t(side: 'left' | 'right' | 'unset') =>\n\t\t\t\t({ commands }) =>\n\t\t\t\t\tcommands.updateAttributes(this.name, { float: side }),\n\t\t\tsetImageDescription:\n\t\t\t\t(description: string) =>\n\t\t\t\t({ commands }) =>\n\t\t\t\t\tcommands.updateAttributes(this.name, { description })\n\t\t};\n\t},\n\n\taddAttributes() {\n\t\treturn {\n\t\t\tid: {\n\t\t\t\tdefault: null\n\t\t\t},\n\t\t\tstorage_image: {\n\t\t\t\tdefault: null,\n\t\t\t\tparseHTML: (element) => (element.querySelector('img') as HTMLElement).getAttribute('storage_image')\n\t\t\t},\n\t\t\tsrc: {\n\t\t\t\tdefault: null,\n\t\t\t\tparseHTML: (element) => (element.querySelector('img') as HTMLElement).getAttribute('src')\n\t\t\t},\n\t\t\talt: {\n\t\t\t\tdefault: null,\n\t\t\t\tparseHTML: (element) => (element.querySelector('img') as HTMLElement).getAttribute('alt')\n\t\t\t},\n\t\t\tfloat: {\n\t\t\t\tdefault: 'unset',\n\t\t\t\tparseHTML: (element) => (element as HTMLElement).style.float\n\t\t\t},\n\t\t\tw: {\n\t\t\t\tdefault: '200px',\n\t\t\t\tparseHTML: (element) => (element as HTMLElement).style.width\n\t\t\t},\n\t\t\th: {\n\t\t\t\tdefault: null,\n\t\t\t\tparseHTML: (element) => (element as HTMLElement).style.height\n\t\t\t},\n\t\t\tmargin: {\n\t\t\t\tdefault: 'unset',\n\t\t\t\tparseHTML: (element) => (element as HTMLElement).style.margin\n\t\t\t},\n\t\t\ttextAlign: {\n\t\t\t\tdefault: 'unset',\n\t\t\t\tparseHTML: (element) => (element as HTMLElement).style.textAlign\n\t\t\t},\n\t\t\tdefault: {\n\t\t\t\tdefault: false\n\t\t\t},\n\t\t\tdescription: {\n\t\t\t\tdefault: '',\n\t\t\t\tparseHTML: (element) => {\n\t\t\t\t\treturn (element.querySelector('.description') as HTMLElement)?.innerText || '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tdefault: null,\n\t\t\t\tparseHTML: (element) => {\n\t\t\t\t\treturn element.style.cssText;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t},\n\n\trenderHTML({ HTMLAttributes }) {\n\t\tconst { float, w, h, margin, textAlign, description, ...rest } = HTMLAttributes;\n\t\treturn [\n\t\t\t'div',\n\t\t\t{\n\t\t\t\tstyle: `text-align: ${textAlign};float: ${float};width: ${w};height: ${h}; margin: ${margin}; position: relative;`\n\t\t\t},\n\t\t\t['img', this.options.HTMLAttributes, rest],\n\t\t\tdescription\n\t\t\t\t? [\n\t\t\t\t\t\t'div',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclass: 'description',\n\t\t\t\t\t\t\tstyle: DESCRIPTION_STYLE\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdescription\n\t\t\t\t\t]\n\t\t\t\t: ''\n\t\t];\n\t},\n\n\tparseHTML() {\n\t\treturn [\n\t\t\t{\n\t\t\t\ttag: 'div[style*=\"float\"]',\n\t\t\t\tgetAttrs: (node) => {\n\t\t\t\t\tif ((node as HTMLElement).querySelector('img')) {\n\t\t\t\t\t\treturn {};\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttag: 'img[src]',\n\t\t\t\tgetAttrs: (node) => {\n\t\t\t\t\tif ((node as HTMLElement).closest('div[style*=\"float\"]')) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t},\n\n\taddNodeView() {\n\t\treturn ({ editor, node, getPos }) => {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\tconst nodeAttrs = (node as any).attrs as Record<string, unknown>;\n\t\t\tnodeAttrs._ = null;\n\n\t\t\tconst container = document.createElement('div');\n\t\t\tcontainer.style.position = 'relative';\n\t\t\tcontainer.style.display = 'inline-block';\n\t\t\t// SECURITY: Whitelist allowed float values to prevent CSS injection\n\t\t\tconst safeFloat = ['left', 'right', 'unset', 'none'].includes(nodeAttrs.float as string) ? (nodeAttrs.float as string) : 'unset';\n\t\t\tcontainer.style.float = safeFloat;\n\t\t\tcontainer.style.lineHeight = '0';\n\n\t\t\tconst resizer = document.createElement('div');\n\t\t\tresizer.style.position = 'relative';\n\t\t\t// SECURITY: Validate dimensions to prevent CSS injection\n\t\t\t// Only allow numeric values with px/% units\n\t\t\tconst safeWidth = String(nodeAttrs.w || '200px').match(/^\\d+(%|px)$/) ? String(nodeAttrs.w) : '200px';\n\t\t\tconst safeHeight = nodeAttrs.h && String(nodeAttrs.h).match(/^\\d+(%|px)$/) ? String(nodeAttrs.h) : 'auto';\n\t\t\tresizer.style.width = safeWidth;\n\t\t\tresizer.style.height = safeHeight;\n\t\t\tresizer.style.display = 'inline-block';\n\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.setAttribute('src', nodeAttrs.src as string);\n\t\t\timg.setAttribute('alt', nodeAttrs.alt as string);\n\t\t\timg.style.width = '100%';\n\t\t\timg.style.height = '100%';\n\t\t\timg.style.cursor = 'pointer';\n\n\t\t\tresizer.appendChild(img);\n\t\t\tcontainer.appendChild(resizer);\n\n\t\t\tif (nodeAttrs.description) {\n\t\t\t\tconst desc = document.createElement('div');\n\t\t\t\t// SECURITY: textContent auto-escapes HTML (safe)\n\t\t\t\t// Never use innerHTML here - would allow XSS via image description\n\t\t\t\tdesc.textContent = nodeAttrs.description as string;\n\t\t\t\tdesc.style.cssText = DESCRIPTION_STYLE;\n\t\t\t\tcontainer.appendChild(desc);\n\t\t\t}\n\n\t\t\tconst knob1 = document.createElement('div');\n\t\t\tconst knob2 = document.createElement('div');\n\t\t\tknob1.style.cssText = 'cursor: ew-resize;width: 15px; height: 100%;  position: absolute; top:0;left:0;transform:translateX(-50%)';\n\t\t\tknob2.style.cssText = 'cursor: ew-resize;width: 15px; height: 100%;  position: absolute; top:0;right:0;transform:translateX(50%)';\n\n\t\t\tresizer.appendChild(knob1);\n\t\t\tresizer.appendChild(knob2);\n\n\t\t\tknob1.onpointerdown = (e) => knobDrag(e, knob1, 'left', resizer, nodeAttrs);\n\t\t\tknob2.onpointerdown = (e) => knobDrag(e, knob2, 'right', resizer, nodeAttrs);\n\n\t\t\tlet isDragging = false;\n\n\t\t\tconst onDrag = (e: MouseEvent) => {\n\t\t\t\tif (!isDragging) return;\n\t\t\t\tconst newWidth = e.clientX - resizer.getBoundingClientRect().left;\n\t\t\t\tresizer.style.width = `${newWidth}px`;\n\t\t\t\tpreserveAspectRatio(resizer, nodeAttrs, `${newWidth}px`, e.shiftKey);\n\t\t\t};\n\n\t\t\tconst onStopDrag = () => {\n\t\t\t\tisDragging = false;\n\t\t\t\tdocument.removeEventListener('mousemove', onDrag);\n\t\t\t\tdocument.removeEventListener('mouseup', onStopDrag);\n\t\t\t\tif (typeof getPos === 'function') {\n\t\t\t\t\tconst pos = getPos();\n\t\t\t\t\tif (pos !== undefined) {\n\t\t\t\t\t\teditor.view.dispatch(\n\t\t\t\t\t\t\teditor.view.state.tr.setNodeMarkup(pos, undefined, {\n\t\t\t\t\t\t\t\t...nodeAttrs,\n\t\t\t\t\t\t\t\tw: resizer.style.width,\n\t\t\t\t\t\t\t\th: resizer.style.height\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\timg.onmousedown = (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tisDragging = true;\n\t\t\t\tdocument.addEventListener('mousemove', onDrag);\n\t\t\t\tdocument.addEventListener('mouseup', onStopDrag);\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\tdom: container\n\t\t\t};\n\t\t};\n\t}\n});\n\nfunction preserveAspectRatio(resizer: HTMLDivElement, nodeAttrs: Record<string, unknown>, width: string, preserveRatio = true) {\n\tif (!preserveRatio) return;\n\n\tconst img = resizer.querySelector('img');\n\tif (!img) return;\n\n\tconst naturalWidth = img.naturalWidth;\n\tconst naturalHeight = img.naturalHeight;\n\n\tif (naturalWidth && naturalHeight) {\n\t\tconst ratio = naturalHeight / naturalWidth;\n\t\tconst numWidth = parseInt(width);\n\t\tconst newHeight = Math.round(numWidth * ratio);\n\n\t\tnodeAttrs.h = resizer.style.height = `${newHeight}px`;\n\t}\n}\n\nfunction knobDrag(\n\te: PointerEvent,\n\tknob: HTMLDivElement,\n\tside: 'left' | 'right' | 'top' | 'bottom',\n\tresizer: HTMLDivElement,\n\tnodeAttrs: Record<string, unknown>\n) {\n\te.preventDefault();\n\te.stopPropagation();\n\n\t// Check if shift key is pressed to preserve aspect ratio\n\tconst shouldPreserveAspectRatio = e.shiftKey;\n\n\tknob.setPointerCapture(e.pointerId);\n\tknob.onpointermove = (e) => {\n\t\tif (side == 'left' || side == 'right') {\n\t\t\tconst currentWidth = parseInt(resizer.style.width, 10);\n\t\t\tconst dx = side === 'left' ? e.movementX * -1 : e.movementX;\n\t\t\tconst newWidth = currentWidth + dx;\n\t\t\tresizer.style.width = `${newWidth}px`;\n\t\t\tnodeAttrs.w = `${newWidth}px`;\n\t\t\tpreserveAspectRatio(resizer, nodeAttrs, `${newWidth}px`, shouldPreserveAspectRatio);\n\t\t} else {\n\t\t\tconst currentHeight = parseInt(resizer.style.height, 10);\n\t\t\tconst dy = side === 'top' ? e.movementY * -1 : e.movementY;\n\t\t\tconst newHeight = currentHeight + dy;\n\t\t\tresizer.style.height = `${newHeight}px`;\n\t\t\tnodeAttrs.h = `${newHeight}px`;\n\t\t}\n\t};\n\n\tknob.onpointerup = () => {\n\t\tknob.onpointermove = null;\n\t\tknob.onpointerup = null;\n\t};\n}\n\nexport { ImageResize as default, ImageResize };\n","/**\n@file src/widgets/core/RichText/extensions/TextStyle.ts\n@description - RichText TipTap widget text style extension with fixed font size handling\n*/\n\n// TipTap v3 exports TextStyle as a named export (no default)\nimport { TextStyle } from '@tiptap/extension-text-style';\n\ndeclare module '@tiptap/core' {\n\tinterface Commands<ReturnType> {\n\t\tfontSize: {\n\t\t\t// Set the font size\n\t\t\tsetFontSize: (size: string) => ReturnType;\n\t\t\t// Unset the font size\n\t\t\tunsetFontSize: () => ReturnType;\n\t\t};\n\t}\n}\n\nexport default TextStyle.extend({\n\taddAttributes() {\n\t\treturn {\n\t\t\t...this.parent?.(),\n\t\t\tfontSize: {\n\t\t\t\tdefault: null,\n\t\t\t\tparseHTML: (element) => {\n\t\t\t\t\tconst fontSize = element.style.fontSize;\n\t\t\t\t\tif (!fontSize) return null;\n\t\t\t\t\treturn fontSize.replace(/px$/, '');\n\t\t\t\t},\n\t\t\t\trenderHTML: (attributes) => {\n\t\t\t\t\tif (!attributes.fontSize) {\n\t\t\t\t\t\treturn {};\n\t\t\t\t\t}\n\n\t\t\t\t\tconst size = attributes.fontSize;\n\t\t\t\t\tconst fontSize = /^\\d+$/.test(String(size)) ? `${size}px` : size;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstyle: `font-size: ${fontSize}`\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t},\n\n\taddCommands() {\n\t\treturn {\n\t\t\t...this.parent?.(),\n\t\t\tsetFontSize:\n\t\t\t\t(fontSize: string) =>\n\t\t\t\t({ chain }) => {\n\t\t\t\t\t// SECURITY: Sanitize font-size to prevent CSS injection\n\t\t\t\t\t// Only allow numeric values with px/em/rem/% units\n\t\t\t\t\tconst size = String(fontSize);\n\t\t\t\t\tconst sanitized = size.match(/^\\d+(\\.\\d+)?(px|em|rem|%)$/) ? size : '16px';\n\t\t\t\t\treturn chain().focus().setMark(this.name, { fontSize: sanitized }).run();\n\t\t\t\t},\n\t\t\tunsetFontSize:\n\t\t\t\t() =>\n\t\t\t\t({ chain }) => {\n\t\t\t\t\treturn chain().focus().setMark(this.name, { fontSize: null }).removeEmptyTextStyle().run();\n\t\t\t\t}\n\t\t};\n\t}\n});\n","<!--\n@file src/widgets/core/RichText/Input.svelte\n@component SveltyCMS – Enterprise RichText Editor (2025 Edition)\n-->\n\n<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { slide } from 'svelte/transition';\n\timport { quintOut } from 'svelte/easing';\n\timport { createEditor } from './tiptap';\n\timport type { Editor } from '@tiptap/core';\n\timport type { FieldType } from './';\n\timport type { RichTextData } from './types';\n\timport { app } from '@shared/stores/store.svelte';\n\n\timport { showModal } from '@shared/utils/modalUtils';\n\timport type { MediaFile } from '../MediaUpload/types';\n\timport { tokenTarget } from '@shared/services/token/tokenTarget';\n\n\tlet {\n\t\tfield,\n\t\tvalue = $bindable(),\n\t\terror\n\t}: {\n\t\tfield: FieldType;\n\t\tvalue: Record<string, RichTextData> | null | undefined;\n\t\terror?: string | null;\n\t} = $props();\n\n\tconst lang = $derived(field.translated ? app.contentLanguage : 'default');\n\n\t$effect(() => {\n\t\tif (!value) value = {};\n\t\tif (!value[lang]) value[lang] = { title: '', content: '' };\n\t});\n\n\tlet editor: Editor | null = $state(null);\n\tlet element: HTMLDivElement;\n\n\tlet isScrolled = $state(false);\n\tlet showSlashMenu = $state(false);\n\tlet showSource = $state(false); // Source View Toggle\n\tlet activeDropdown = $state<string | null>(null);\n\tlet colorInput: HTMLInputElement;\n\n\t// Table Picker State\n\tlet hoverRows = $state(0);\n\tlet hoverCols = $state(0);\n\n\tfunction toggleDropdown(label: string, event: MouseEvent) {\n\t\tevent.stopPropagation();\n\t\tactiveDropdown = activeDropdown === label ? null : label;\n\t}\n\n\tfunction closeDropdowns() {\n\t\tactiveDropdown = null;\n\t}\n\n\tfunction handleColorChange(e: Event) {\n\t\tconst color = (e.target as HTMLInputElement).value;\n\t\teditor?.chain().focus().setColor(color).run();\n\t}\n\n\t// New Feature Functions\n\tfunction openMediaLibrary() {\n\t\tshowModal({\n\t\t\tcomponent: 'mediaLibraryModal',\n\t\t\tresponse: (files: MediaFile[] | undefined) => {\n\t\t\t\tif (files && files.length > 0) {\n\t\t\t\t\t// Insert the first selected image\n\t\t\t\t\tconst file = files[0];\n\t\t\t\t\teditor?.chain().focus().setImage({ src: file.url, alt: file.name }).run();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function pasteUnformatted() {\n\t\ttry {\n\t\t\tconst text = await navigator.clipboard.readText();\n\t\t\teditor?.chain().focus().insertContent(text).run();\n\t\t} catch (err) {\n\t\t\tconsole.error('Failed to read clipboard:', err);\n\t\t\talert('Could not access clipboard. Please check permissions.');\n\t\t}\n\t}\n\n\tfunction setVideo() {\n\t\tconst url = prompt('Enter YouTube URL');\n\t\tif (url) {\n\t\t\teditor?.chain().focus().setYoutubeVideo({ src: url }).run();\n\t\t}\n\t}\n\n\t// Toolbar types\n\ttype ToolbarButton = {\n\t\ttype?: 'button';\n\t\ticon: string;\n\t\tlabel: string;\n\t\tshortcut?: string;\n\t\tcmd: () => void;\n\t\tactive?: () => boolean;\n\t};\n\n\ttype ToolbarDropdown = {\n\t\ttype: 'dropdown';\n\t\tlabel: string;\n\t\ticon?: string;\n\t\titems?: { label: string; cmd: () => void; active: () => boolean }[];\n\t};\n\n\ttype ToolbarItem = ToolbarButton | ToolbarDropdown;\n\n\ttype ToolbarGroup = {\n\t\tcondition?: () => boolean;\n\t\tbuttons: ToolbarItem[];\n\t};\n\n\t// Toolbar config – using official Material Design Icons (mdi)\n\tconst toolbarGroups: ToolbarGroup[] = [\n\t\t{\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'arrow-u-left-top',\n\t\t\t\t\tlabel: 'Undo',\n\t\t\t\t\tshortcut: 'Ctrl+Z',\n\t\t\t\t\tcmd: () => editor?.chain().focus().undo().run(),\n\t\t\t\t\tactive: () => false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'arrow-u-right-top',\n\t\t\t\t\tlabel: 'Redo',\n\t\t\t\t\tshortcut: 'Ctrl+Shift+Z',\n\t\t\t\t\tcmd: () => editor?.chain().focus().redo().run(),\n\t\t\t\t\tactive: () => false\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-bold',\n\t\t\t\t\tlabel: 'Bold',\n\t\t\t\t\tshortcut: 'Ctrl+B',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleBold().run(),\n\t\t\t\t\tactive: () => editor?.isActive('bold') ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-italic',\n\t\t\t\t\tlabel: 'Italic',\n\t\t\t\t\tshortcut: 'Ctrl+I',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleItalic().run(),\n\t\t\t\t\tactive: () => editor?.isActive('italic') ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-underlined',\n\t\t\t\t\tlabel: 'Underline',\n\t\t\t\t\tshortcut: 'Ctrl+U',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleUnderline().run(),\n\t\t\t\t\tactive: () => editor?.isActive('underline') ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-strikethrough-variant',\n\t\t\t\t\tlabel: 'Strikethrough',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleStrike().run(),\n\t\t\t\t\tactive: () => editor?.isActive('strike') ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-clear',\n\t\t\t\t\tlabel: 'Clear Formatting',\n\t\t\t\t\tcmd: () => editor?.chain().focus().unsetAllMarks().run(),\n\t\t\t\t\tactive: () => false\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'dropdown',\n\t\t\t\t\tlabel: 'Color',\n\t\t\t\t\ticon: 'palette',\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Default',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().unsetColor().run(),\n\t\t\t\t\t\t\tactive: () => !editor?.getAttributes('textStyle').color\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Custom...',\n\t\t\t\t\t\t\tcmd: () => colorInput?.click(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('textStyle', { color: /.*/ }) ?? false\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'dropdown',\n\t\t\t\t\tlabel: 'Font',\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Default',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().unsetFontFamily().run(),\n\t\t\t\t\t\t\tactive: () => !editor?.getAttributes('textStyle').fontFamily\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Inter',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().setFontFamily('Inter').run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('textStyle', { fontFamily: 'Inter' }) ?? false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Comic Sans',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().setFontFamily('Comic Sans MS, Comic Sans').run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('textStyle', { fontFamily: 'Comic Sans MS, Comic Sans' }) ?? false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Serif',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().setFontFamily('serif').run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('textStyle', { fontFamily: 'serif' }) ?? false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Monospace',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().setFontFamily('monospace').run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('textStyle', { fontFamily: 'monospace' }) ?? false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Cursive',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().setFontFamily('cursive').run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('textStyle', { fontFamily: 'cursive' }) ?? false\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'dropdown',\n\t\t\t\t\tlabel: 'Text',\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{ label: 'Paragraph', cmd: () => editor?.chain().focus().setParagraph().run(), active: () => editor?.isActive('paragraph') ?? false },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Heading 1',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().toggleHeading({ level: 1 }).run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('heading', { level: 1 }) ?? false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Heading 2',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().toggleHeading({ level: 2 }).run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('heading', { level: 2 }) ?? false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Heading 3',\n\t\t\t\t\t\t\tcmd: () => editor?.chain().focus().toggleHeading({ level: 3 }).run(),\n\t\t\t\t\t\t\tactive: () => editor?.isActive('heading', { level: 3 }) ?? false\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-list-bulleted',\n\t\t\t\t\tlabel: 'Bullet List',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleBulletList().run(),\n\t\t\t\t\tactive: () => editor?.isActive('bulletList') ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-list-numbered',\n\t\t\t\t\tlabel: 'Numbered List',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleOrderedList().run(),\n\t\t\t\t\tactive: () => editor?.isActive('orderedList') ?? false\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'link',\n\t\t\t\t\tlabel: 'Link',\n\t\t\t\t\tcmd: () =>\n\t\t\t\t\t\teditor\n\t\t\t\t\t\t\t?.chain()\n\t\t\t\t\t\t\t.focus()\n\t\t\t\t\t\t\t.setLink({ href: prompt('Enter URL') || '' })\n\t\t\t\t\t\t\t.run()\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'image',\n\t\t\t\t\tlabel: 'Image',\n\t\t\t\t\tcmd: openMediaLibrary\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'youtube',\n\t\t\t\t\tlabel: 'Video',\n\t\t\t\t\tcmd: setVideo\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'dropdown',\n\t\t\t\t\ticon: 'table',\n\t\t\t\t\tlabel: 'Table'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'code-tags',\n\t\t\t\t\tlabel: 'Code Block',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleCodeBlock().run(),\n\t\t\t\t\tactive: () => editor?.isActive('codeBlock') ?? false\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-align-left',\n\t\t\t\t\tlabel: 'Align Left',\n\t\t\t\t\tcmd: () => editor?.chain().focus().setTextAlign('left').run(),\n\t\t\t\t\tactive: () => editor?.isActive({ textAlign: 'left' }) ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-align-center',\n\t\t\t\t\tlabel: 'Align Center',\n\t\t\t\t\tcmd: () => editor?.chain().focus().setTextAlign('center').run(),\n\t\t\t\t\tactive: () => editor?.isActive({ textAlign: 'center' }) ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-align-right',\n\t\t\t\t\tlabel: 'Align Right',\n\t\t\t\t\tcmd: () => editor?.chain().focus().setTextAlign('right').run(),\n\t\t\t\t\tactive: () => editor?.isActive({ textAlign: 'right' }) ?? false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'format-quote-close',\n\t\t\t\t\tlabel: 'Blockquote',\n\t\t\t\t\tcmd: () => editor?.chain().focus().toggleBlockquote().run(),\n\t\t\t\t\tactive: () => editor?.isActive('blockquote') ?? false\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tcondition: () => !!field.aiEnabled,\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'sparkles',\n\t\t\t\t\tlabel: 'AI Command',\n\t\t\t\t\tshortcut: '/',\n\t\t\t\t\tcmd: () => {\n\t\t\t\t\t\tshowSlashMenu = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'content-paste',\n\t\t\t\t\tlabel: 'Paste Plain Text',\n\t\t\t\t\tcmd: pasteUnformatted\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\ticon: 'xml',\n\t\t\t\t\tlabel: 'Source View',\n\t\t\t\t\tcmd: () => (showSource = !showSource),\n\t\t\t\t\tactive: () => showSource\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t];\n\n\tfunction handleScroll() {\n\t\tisScrolled = window.scrollY > 120;\n\t}\n\n\tonMount(() => {\n\t\tconst initialContent = value?.[lang]?.content || '';\n\t\teditor = createEditor(element, initialContent, lang, { aiEnabled: !!field.aiEnabled });\n\n\t\teditor.on('update', () => {\n\t\t\tif (!editor) return;\n\t\t\tvalue = {\n\t\t\t\t...value,\n\t\t\t\t[lang]: {\n\t\t\t\t\ttitle: value?.[lang]?.title || '',\n\t\t\t\t\tcontent: editor.isEmpty ? '' : editor.getHTML()\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\twindow.addEventListener('scroll', handleScroll);\n\t\twindow.addEventListener('click', closeDropdowns);\n\t});\n\n\tonDestroy(() => {\n\t\teditor?.destroy();\n\t\twindow.removeEventListener('scroll', handleScroll);\n\t\twindow.removeEventListener('click', closeDropdowns);\n\t});\n\n\t$effect(() => {\n\t\tconst content = value?.[lang]?.content || '';\n\t\tif (editor && editor.getHTML() !== content) {\n\t\t\teditor.commands.setContent(content, { emitUpdate: false });\n\t\t}\n\t});\n</script>\n\n<div\n\tclass=\"my-2 relative overflow-hidden rounded border {error\n\t\t? 'border-red-500 ring-2 ring-red-500 ring-opacity-50'\n\t\t: 'border-surface-200 dark:text-surface-50'} bg-white dark:bg-surface-900 shadow-xl\"\n>\n\t<!-- Toolbar -->\n\t<div\n\t\tclass=\"border-b border-surface-200 dark:border-surface-800 bg-surface-50/95 dark:bg-surface-800/95 backdrop-blur-sm px-2 transition-all duration-300 {isScrolled\n\t\t\t? 'fixed inset-x-0 top-0 z-50 shadow-lg'\n\t\t\t: ''}\"\n\t>\n\t\t<div class=\"w-full flex max-w-none flex-wrap items-center gap-1\">\n\t\t\t{#each toolbarGroups as group}\n\t\t\t\t{#if !group.condition || group.condition()}\n\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t{#each group.buttons as btn}\n\t\t\t\t\t\t\t{#if btn.type === 'dropdown'}\n\t\t\t\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"flex items-center gap-1 rounded px-2 py-1.5 text-sm font-medium hover:bg-surface-200 dark:hover:bg-white/20 transition {activeDropdown ===\n\t\t\t\t\t\t\t\t\t\tbtn.label\n\t\t\t\t\t\t\t\t\t\t\t? 'bg-surface-200 dark:bg-white/20'\n\t\t\t\t\t\t\t\t\t\t\t: ''} text-surface-900 dark:text-white\"\n\t\t\t\t\t\t\t\t\t\tonclick={(e) => toggleDropdown(btn.label, e)}\n\t\t\t\t\t\t\t\t\t\ttitle={btn.label}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{#if btn.icon}\n\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:{btn.icon}\" width=\"20\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{#if !btn.icon || btn.label !== 'Table'}\n\t\t\t\t\t\t\t\t\t\t\t<span class={btn.icon ? 'hidden sm:inline' : ''}>{btn.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:chevron-down\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t{#if activeDropdown === btn.label}\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"absolute top-full left-0 mt-1 min-w-[180px] rounded-lg border border-surface-200 bg-white p-1 shadow-lg dark:text-surface-50 dark:bg-surface-900 z-50 ring-1 ring-black/5\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#if btn.label === 'Table'}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"p-2 w-48\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mb-2 text-xs font-medium text-surface-500 dark:text-surface-50 text-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{hoverRows || 1} x {hoverCols || 1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"grid grid-cols-5 gap-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonmouseleave={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thoverRows = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thoverCols = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trole=\"grid\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#each Array(5) as _, r}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#each Array(5) as _, c}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-8 h-8 rounded-sm border transition-colors {r < hoverRows && c < hoverCols\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-blue-100 border-blue-500 dark:bg-blue-500/30 dark:border-blue-400'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-surface-50 border-surface-200 dark:bg-surface-800 dark:text-surface-50'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonmouseover={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thoverRows = r + 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thoverCols = c + 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonfocus={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thoverRows = r + 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thoverCols = c + 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teditor\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.chain()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.focus()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.insertTable({ rows: r + 1, cols: c + 1, withHeaderRow: true })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.run();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcloseDropdowns();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"{r + 1} by {c + 1} table\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{:else if btn.items}\n\t\t\t\t\t\t\t\t\t\t\t\t{#each btn.items as item}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"flex w-full items-center gap-2 rounded px-2 py-1.5 text-left text-sm hover:bg-surface-100 dark:hover:bg-white/20 {item.active()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-surface-700 dark:text-surface-300'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\titem.cmd();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcloseDropdowns();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"rounded-lg p-2 hover:bg-surface-100 dark:hover:bg-white/10 transition-all {btn.active?.()\n\t\t\t\t\t\t\t\t\t\t? 'bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500'\n\t\t\t\t\t\t\t\t\t\t: 'text-surface-900 dark:text-white'}\"\n\t\t\t\t\t\t\t\t\taria-label={btn.label}\n\t\t\t\t\t\t\t\t\ttitle={btn.shortcut ? `${btn.label} (${btn.shortcut})` : btn.label}\n\t\t\t\t\t\t\t\t\tonclick={btn.cmd}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:{btn.icon}\" width=\"20\"></iconify-icon>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t<div class=\"h-5 w-px bg-surface-300 dark:bg-surface-700 mx-1\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n\n\t<!-- Editor -->\n\t<div\n\t\tbind:this={element}\n\t\tclass=\"prose dark:prose-invert max-w-none px-6 py-4 min-h-96 focus:outline-none leading-relaxed caret-blue-600 dark:caret-blue-400 {showSource\n\t\t\t? 'hidden'\n\t\t\t: ''}\"\n\t>\n\t\t<!-- Tiptap content -->\n\t</div>\n\n\t<!-- Token Picker Proxy Input -->\n\t<!--\n\t\tThis hidden input receives the focus when the external \"Insert Token\" button is clicked.\n\t\tIt triggers the use:tokenTarget action to open the picker.\n\t\tThe onInsert handler then redirects the inserted token to the actual Tiptap editor.\n\t\tThis prevents the Token Picker from opening whenever the user just clicks into the editor to type.\n\t-->\n\t<input\n\t\ttype=\"text\"\n\t\tid={field.db_fieldName}\n\t\tclass=\"sr-only\"\n\t\taria-hidden=\"true\"\n\t\ttabindex=\"-1\"\n\t\tuse:tokenTarget={{\n\t\t\tname: field.db_fieldName,\n\t\t\tlabel: field.label,\n\t\t\tcollection: (field as any).collection,\n\t\t\tonInsert: (token: string) => {\n\t\t\t\t// Insert token into the Tiptap editor at current cursor position\n\t\t\t\teditor?.chain().focus().insertContent(token).run();\n\t\t\t}\n\t\t}}\n\t/>\n\n\t{#if showSource}\n\t\t<textarea\n\t\t\tclass=\"w-full min-h-96 p-4 font-mono text-sm bg-surface-50 dark:bg-surface-900 text-surface-900 dark:text-gray-200 border-none resize-y outline-none\"\n\t\t\tvalue={editor?.getHTML() || ''}\n\t\t\toninput={(e) => {\n\t\t\t\tconst content = (e.target as HTMLTextAreaElement).value;\n\t\t\t\teditor?.commands.setContent(content, { emitUpdate: true });\n\t\t\t}}\n\t\t></textarea>\n\t{/if}\n\n\t<style>\n\t\t:global(.ProseMirror) {\n\t\t\toutline: none;\n\t\t}\n\t\t:global(.ProseMirror p.is-editor-empty:first-child::before) {\n\t\t\tcolor: #adb5bd;\n\t\t\tcontent: attr(data-placeholder);\n\t\t\tfloat: left;\n\t\t\theight: 0;\n\t\t\tpointer-events: none;\n\t\t}\n\t\t:global(.ProseMirror table) {\n\t\t\tborder-collapse: collapse;\n\t\t\tmargin: 0;\n\t\t\toverflow: hidden;\n\t\t\ttable-layout: fixed;\n\t\t\twidth: 100%;\n\t\t}\n\t\t:global(.ProseMirror td),\n\t\t:global(.ProseMirror th) {\n\t\t\tborder: 1px solid #ced4da;\n\t\t\tbox-sizing: border-box;\n\t\t\tmin-width: 1em;\n\t\t\tpadding: 6px 8px;\n\t\t\tposition: relative;\n\t\t\tvertical-align: top;\n\t\t}\n\t\t:global(.ProseMirror th) {\n\t\t\tbackground-color: #f1f3f5;\n\t\t\tfont-weight: bold;\n\t\t\ttext-align: left;\n\t\t}\n\t\t/* Dark mode table styles */\n\t\t:global(.dark .ProseMirror td),\n\t\t:global(.dark .ProseMirror th) {\n\t\t\tborder-color: #3f3f46; /* surface-700 */\n\t\t}\n\t\t:global(.dark .ProseMirror th) {\n\t\t\tbackground-color: #27272a; /* surface-800 */\n\t\t}\n\t</style>\n\n\t<!-- Error -->\n\t{#if error}\n\t\t<div class=\"border-t border-red-200 bg-red-50 dark:border-red-900 dark:bg-red-900/20 px-8 py-4 text-sm text-red-700 dark:text-red-300\">\n\t\t\t{error}\n\t\t</div>\n\t{/if}\n\n\t<!-- Slash Menu Modal -->\n\t{#if showSlashMenu}\n\t\t<div\n\t\t\ttransition:slide={{ duration: 200, easing: quintOut }}\n\t\t\trole=\"button\"\n\t\t\ttabindex=\"0\"\n\t\t\tclass=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\"\n\t\t\tonclick={(e) => {\n\t\t\t\tif (e.target === e.currentTarget) showSlashMenu = false;\n\t\t\t}}\n\t\t\tonkeydown={(e) => {\n\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\tshowSlashMenu = false;\n\t\t\t\t}\n\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\tif (e.target === e.currentTarget) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tshowSlashMenu = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t<div class=\"w-full max-w-lg rounded-2xl border border-surface-300 dark:text-surface-50 bg-white dark:bg-surface-900 p-6 shadow-2xl\">\n\t\t\t\t<h3 class=\"mb-5 text-xl font-semibold text-surface-900 dark:text-white\">Command Menu</h3>\n\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full items-center gap-4 rounded-xl px-5 py-4 hover:bg-surface-100 dark:hover:bg-surface-700 transition\"\n\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\teditor?.chain().focus().setHardBreak().run();\n\t\t\t\t\t\t\tshowSlashMenu = false;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:arrow-down-bold\" width=\"22\" class=\"text-surface-600 dark:text-surface-50\"></iconify-icon>\n\t\t\t\t\t\t<div class=\"text-left\">\n\t\t\t\t\t\t\t<div class=\"font-medium text-surface-900 dark:text-white\">Hard Break</div>\n\t\t\t\t\t\t\t<div class=\"text-sm text-surface-500 dark:text-surface-50\">Insert line break</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t\t{#if field.aiEnabled}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"flex w-full items-center gap-4 rounded-xl px-5 py-4 hover:bg-surface-100 dark:hover:bg-surface-700 transition\"\n\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\teditor?.chain().focus().insertContent('/ai ');\n\t\t\t\t\t\t\t\tshowSlashMenu = false;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:sparkles\" width=\"22\" class=\"text-purple-600\"></iconify-icon>\n\t\t\t\t\t\t\t<div class=\"text-left\">\n\t\t\t\t\t\t\t\t<div class=\"font-medium text-surface-900 dark:text-white\">Ask AI</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm text-surface-500 dark:text-surface-50\">Generate or rewrite with AI</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<input bind:this={colorInput} type=\"color\" class=\"hidden\" onchange={handleColorChange} />\n</div>\n"],"names":["ImageExtension","e","$$renderer","$.attr_class","$.stringify","$.ensure_array_like","$.attr","$.escape"],"mappings":"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"}