{"version":3,"file":"PerformanceWidget.js","sources":["../../../../../../shared/features/src/dashboard/widgets/PerformanceWidget.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/dashboard/widgets/PerformanceWidget.svelte\n@description Performance monitoring widget for dashboard using BaseWidget\nDisplays real-time system metrics integrated with the dashboard grid system\n-->\n\n<script lang=\"ts\" module>\n\texport const widgetMeta = {\n\t\tname: 'Performance Monitor',\n\t\ticon: 'mdi:chart-line',\n\t\tdescription: 'Track system performance metrics',\n\t\tdefaultSize: { w: 1, h: 2 }\n\t};\n</script>\n\n<script lang=\"ts\">\n\timport BaseWidget from '../BaseWidget.svelte';\n\timport type { WidgetSize } from '@cms-types';\n\n\tinterface HealthMetrics {\n\t\trequests: { total: number; errors: number };\n\t\tauth: { validations: number; failures: number };\n\t\tcache: { hits: number; misses: number };\n\t\tsessions: { active: number; rotations: number };\n\t\tlastReset: number;\n\t\tsystem?: {\n\t\t\tmemory: { used: number; total: number; external: number; rss: number };\n\t\t\tuptime: number;\n\t\t\tnodeVersion: string;\n\t\t};\n\t}\n\n\tconst {\n\t\tlabel = 'Performance Monitor',\n\t\ttheme = 'light',\n\t\ticon = 'mdi:chart-line',\n\t\twidgetId = undefined,\n\t\tsize = { w: 1, h: 1 } as WidgetSize,\n\t\tonSizeChange = (_newSize: WidgetSize) => {},\n\t\tonRemove = () => {}\n\t}: {\n\t\tlabel?: string;\n\t\ttheme?: 'light' | 'dark';\n\t\ticon?: string;\n\t\twidgetId?: string;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tonRemove?: () => void;\n\t} = $props();\n\n\t// Performance indicator color based on metrics\n\tfunction getPerformanceColor(errorRate: number): string {\n\t\tif (errorRate > 5) return 'text-error-500';\n\t\tif (errorRate > 2) return 'text-warning-500';\n\t\treturn 'text-success-500';\n\t}\n\n\tfunction formatUptime(seconds: number): string {\n\t\tif (seconds < 60) return `${seconds}s`;\n\t\tif (seconds < 3600) return `${Math.floor(seconds / 60)}m`;\n\t\tif (seconds < 86400) return `${Math.floor(seconds / 3600)}h`;\n\t\treturn `${Math.floor(seconds / 86400)}d`;\n\t}\n\n\tfunction formatMemory(mb: number): string {\n\t\tif (mb < 1024) return `${mb}MB`;\n\t\treturn `${(mb / 1024).toFixed(1)}GB`;\n\t}\n</script>\n\n<BaseWidget\n\t{label}\n\t{theme}\n\tendpoint=\"/api/dashboard/metrics?detailed=true\"\n\tpollInterval={10000}\n\t{icon}\n\t{widgetId}\n\t{size}\n\t{onSizeChange}\n\tonCloseRequest={onRemove}\n>\n\t{#snippet children({ data })}\n\t\t{@const metrics = data as HealthMetrics | null}\n\n\t\t{#if !metrics}\n\t\t\t<div class=\"flex h-full items-center justify-center text-surface-500\">\n\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:chart-line\" width=\"48\" class=\"mb-2 opacity-50\"></iconify-icon>\n\t\t\t\t\t<p>Loading metrics...</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t{@const errorRate = metrics.requests.total > 0 ? (metrics.requests.errors / metrics.requests.total) * 100 : 0}\n\t\t\t{@const authSuccessRate =\n\t\t\t\tmetrics.auth.validations > 0 ? ((metrics.auth.validations - metrics.auth.failures) / metrics.auth.validations) * 100 : 100}\n\t\t\t{@const cacheHitRate =\n\t\t\t\tmetrics.cache.hits + metrics.cache.misses > 0 ? (metrics.cache.hits / (metrics.cache.hits + metrics.cache.misses)) * 100 : 0}\n\n\t\t\t<div class=\"flex h-full flex-col space-y-3 text-sm\">\n\t\t\t\t<!-- Performance Overview -->\n\t\t\t\t<h3 class=\"text-center text-xs font-semibold\">Performance Overview:</h3>\n\n\t\t\t\t<div class=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Error Rate</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold {getPerformanceColor(errorRate)}\">{errorRate.toFixed(2)}%</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Cache Hit</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold text-primary-500\">{cacheHitRate.toFixed(1)}%</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Auth Success</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold text-success-500\">{authSuccessRate.toFixed(1)}%</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Sessions</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold text-tertiary-500\">{metrics.sessions.active}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- System Metrics (if available) -->\n\t\t\t\t{#if metrics.system}\n\t\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t\t<h3 class=\"text-center text-xs font-semibold\">System:</h3>\n\n\t\t\t\t\t\t<div class=\"grid grid-cols-2 gap-2 text-xs\">\n\t\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Memory:</span>\n\t\t\t\t\t\t\t\t<span class=\"font-mono\">{formatMemory(metrics.system.memory.used)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Uptime:</span>\n\t\t\t\t\t\t\t\t<span class=\"font-mono\">{formatUptime(metrics.system.uptime)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Request Metrics -->\n\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t<h3 class=\"text-center text-xs font-semibold\">Requests:</h3>\n\n\t\t\t\t\t<div class=\"grid grid-cols-2 gap-2 text-xs\">\n\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Total:</span>\n\t\t\t\t\t\t\t<span class=\"font-mono\">{metrics.requests.total}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Errors:</span>\n\t\t\t\t\t\t\t<span class=\"font-mono text-error-500\">{metrics.requests.errors}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t{/snippet}\n</BaseWidget>\n"],"names":["$.escape","$$renderer"],"mappings":";;MAOc,aAAU;AAAA,EACtB,MAAM;AAAA,EACN,MAAM;AAAA,EACN,aAAa;AAAA,EACb,eAAe,GAAG,GAAG,GAAG,EAAC;;;wCAI3B;;MAkBE,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,WAAW;AAAA,MACX,SAAS,GAAG,GAAG,GAAG,EAAC;AAAA,MACnB,eAAY,CAAI,aAAyB;AAAA,MAAC;AAAA,MAC1C,iBAAiB;AAAA,MAAC;AAAA;aAYV,oBAAoB,WAA2B;UACnD,YAAY,EAAC,QAAS;UACtB,YAAY,EAAC,QAAS;aACnB;AAAA,IACR;aAES,aAAa,SAAyB;UAC1C,UAAU,GAAE,QAAA,GAAY,OAAO;UAC/B,UAAU,KAAI,QAAA,GAAY,KAAK,MAAM,UAAU,EAAE,CAAA;UACjD,UAAU,MAAK,QAAA,GAAY,KAAK,MAAM,UAAU,IAAI,CAAA;AAC9C,aAAA,GAAA,KAAK,MAAM,UAAU,KAAK,CAAA;AAAA,IACrC;aAES,aAAa,IAAoB;UACrC,KAAK,KAAI,QAAA,GAAY,EAAE;AAChB,aAAA,IAAA,KAAK,MAAM,QAAQ,CAAC,CAAA;AAAA,IAChC;;AAcU,UAAA,WAAA,wBAAW,QAAI;AAChB,cAAA,UAAU;aAEZ,SAAO;;;;;AAQJ,gBAAA,YAAY,QAAQ,SAAS,QAAQ,IAAK,QAAQ,SAAS,SAAS,QAAQ,SAAS,QAAS,MAAM;AACpG,gBAAA,kBACP,QAAQ,KAAK,cAAc,KAAM,QAAQ,KAAK,cAAc,QAAQ,KAAK,YAAY,QAAQ,KAAK,cAAe,MAAM;AAChH,gBAAA,eACP,QAAQ,MAAM,OAAO,QAAQ,MAAM,SAAS,IAAK,QAAQ,MAAM,QAAQ,QAAQ,MAAM,OAAO,QAAQ,MAAM,UAAW,MAAM;ubAUxF,oBAAoB,SAAS,CAAA,CAAA,EAAA,CAAA,IAAAA,YAAK,UAAU,QAAQ,CAAC,CAAA,CAAA,iRAAAA,YAOnC,aAAa,QAAQ,CAAC,CAAA,CAAA,oRAAAA,YAOtB,gBAAgB,QAAQ,CAAC,CAAA,CAAA,iRAAAA,YAOxB,QAAQ,SAAS,MAAM,CAAA,4BAAA;AAMxE,cAAA,QAAQ,QAAM;;AAOU,YAAAC,YAAA,KAAA,8PAAAD,YAAA,aAAa,QAAQ,OAAO,OAAO,IAAI,CAAA,CAAA,8IAAAA,YAIvC,aAAa,QAAQ,OAAO,MAAM,CAAA,CAAA,2BAAA;AAAA;;;+SAanC,QAAQ,SAAS,KAAK,0KAIP,QAAQ,SAAS,MAAM,CAAA,iCAAA;AAAA;;;;QA1FpE;AAAA,QACA;AAAA;sBAEa;AAAA,QACb;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,wBACe;AAAA,QAEN;AAAA;;EAbH,CAAA;;"}