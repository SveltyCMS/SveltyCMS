{"version":3,"file":"errorHandling.js","sources":["../../../../../../shared/utils/src/errorHandling.ts"],"sourcesContent":["/**\n * @file src/utils/errorHandling.ts\n * @description Robust error handling utilities for Svelte 5 applications.\n */\n\n/**\n * A custom error class for application-specific errors.\n * It includes an HTTP status code, optional original error, and additional details.\n */\nexport class AppError extends Error {\n\tpublic readonly status: number;\n\tpublic readonly originalError?: unknown;\n\tpublic readonly details?: Record<string, unknown>;\n\n\tconstructor(message: string, status = 500, originalError?: unknown, details?: Record<string, unknown>) {\n\t\tsuper(message);\n\t\tthis.name = 'AppError';\n\t\tthis.status = status;\n\t\tthis.originalError = originalError;\n\t\tthis.details = details;\n\n\t\t// Preserve the stack trace of the original error if available\n\t\tif (originalError instanceof Error) {\n\t\t\tthis.stack = originalError.stack;\n\t\t}\n\t}\n}\n\n/**\n * Type guard to check if an error is an instance of AppError.\n */\nexport function isAppError(error: unknown): error is AppError {\n\treturn error instanceof AppError;\n}\n\n/**\n * Type guard for SvelteKit's HttpError.\n */\nexport interface HttpError {\n\tstatus: number;\n\tbody?: { message?: string };\n}\n\nexport function isHttpError(error: unknown): error is HttpError {\n\treturn typeof error === 'object' && error !== null && 'status' in error && typeof (error as any).status === 'number';\n}\n\n/**\n * Safely extracts an error message from an unknown error type.\n * @param error The error to process.\n * @returns A string representing the error message.\n */\nexport function getErrorMessage(error: unknown): string {\n\tif (error instanceof Error) {\n\t\treturn error.message;\n\t}\n\tif (typeof error === 'string') {\n\t\treturn error;\n\t}\n\tif (isHttpError(error) && error.body?.message) {\n\t\treturn error.body.message;\n\t}\n\tif (error && typeof error === 'object' && 'message' in error && typeof (error as any).message === 'string') {\n\t\treturn (error as any).message;\n\t}\n\ttry {\n\t\tconst stringified = JSON.stringify(error);\n\t\tif (stringified !== '{}') {\n\t\t\treturn stringified;\n\t\t}\n\t} catch {\n\t\t// Fallback if stringify fails (e.g., circular references)\n\t}\n\treturn String(error);\n}\n\n/**\n * Wraps an unknown error in an AppError, normalizing it for consistent handling.\n * This is especially useful in `catch` blocks.\n *\n * @param error The error to wrap.\n * @param defaultMessage A default message if the error has no discernible message.\n * @param defaultStatus The HTTP status code to use if the error doesn't have one.\n * @returns An instance of AppError.\n */\nexport function wrapError(error: unknown, defaultMessage = 'An unexpected error occurred.', defaultStatus = 500): AppError {\n\tif (error instanceof AppError) {\n\t\treturn error;\n\t}\n\n\tconst message = getErrorMessage(error) || defaultMessage;\n\tconst status = isHttpError(error) ? error.status : defaultStatus;\n\n\treturn new AppError(message, status, error);\n}\n"],"names":[],"mappings":"AA2CO,SAAS,YAAY,OAAoC;AAC/D,SAAO,OAAO,UAAU,YAAY,UAAU,QAAQ,YAAY,SAAS,OAAQ,MAAc,WAAW;AAC7G;AAOO,SAAS,gBAAgB,OAAwB;AACvD,MAAI,iBAAiB,OAAO;AAC3B,WAAO,MAAM;AAAA,EACd;AACA,MAAI,OAAO,UAAU,UAAU;AAC9B,WAAO;AAAA,EACR;AACA,MAAI,YAAY,KAAK,KAAK,MAAM,MAAM,SAAS;AAC9C,WAAO,MAAM,KAAK;AAAA,EACnB;AACA,MAAI,SAAS,OAAO,UAAU,YAAY,aAAa,SAAS,OAAQ,MAAc,YAAY,UAAU;AAC3G,WAAQ,MAAc;AAAA,EACvB;AACA,MAAI;AACH,UAAM,cAAc,KAAK,UAAU,KAAK;AACxC,QAAI,gBAAgB,MAAM;AACzB,aAAO;AAAA,IACR;AAAA,EACD,QAAQ;AAAA,EAER;AACA,SAAO,OAAO,KAAK;AACpB;"}