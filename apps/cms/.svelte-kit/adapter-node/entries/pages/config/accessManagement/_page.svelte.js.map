{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../src/routes/config/components/Roles.svelte","../../../../../../../src/routes/config/components/Permissions.svelte","../../../../../../../src/routes/config/components/AdminRole.svelte","../../../../../../../src/routes/config/components/WebsiteTokens.svelte","../../../../../../../src/routes/config/accessManagement/+page.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/config/accessManagement/Roles.svelte\n@component\n**This component manages roles within the application's access management system**\n\n@xample\n<Roles />\n\n### Props\n- `roleData`: An object containing role data, including the current admin role and available roles.\n\nIt provides the following functionality:\n- Load and display roles and their associated permissions.\n- Allow users to create, edit, and delete roles through a modal interface.\n- Allow bulk deletion of selected roles.\n- Display a skeleton.dev modal for creating or editing roles with an intuitive UI for selecting associated permissions.\n-->\n\n<script lang=\"ts\">\n\t// Store\n\n\t// Auth\n\timport type { Role } from '@shared/database/auth/types';\n\t// Components\n\timport RoleModal from './RoleModal.svelte';\n\t// Skeleton\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { toaster } from '@shared/stores/store.svelte';\n\t// Svelte DND-actions\n\timport { dndzone } from 'svelte-dnd-action';\n\timport { v4 as uuidv4 } from 'uuid';\n\n\tconst flipDurationMs = 100;\n\n\tconst { roleData, setRoleData, updateModifiedCount } = $props();\n\n\t// Reactive state\n\tlet roles: Role[] = $state([]);\n\tlet selectedPermissions: string[] = $state([]);\n\tlet selectedRoles = $state(new Set());\n\tconst error = $state<string | null>(null);\n\tconst modifiedRoles = $state(new Set());\n\t// Define DndItem type for dndzone compatibility\n\ttype DndItem = Role & { id: string };\n\tlet items: DndItem[] = $state([]);\n\n\t// Modal state\n\tlet isEditMode = $state(false);\n\tlet currentRoleId: string | null = $state(null);\n\tlet currentGroupName = $state('');\n\n\t// Initialize data when component mounts (run once)\n\t$effect(() => {\n\t\t// Only initialize if data hasn't been loaded yet\n\t\tif (roles.length === 0 && roleData.length > 0) {\n\t\t\tconst rolesWithId = roleData.map((role: Role) => ({ ...role, id: role._id }));\n\t\t\troles = rolesWithId;\n\t\t\titems = rolesWithId;\n\t\t}\n\t});\n\n\tconst openModal = (role: Role | null = null, groupName = '') => {\n\t\tisEditMode = !!role;\n\t\tcurrentRoleId = role ? role._id : null;\n\t\tcurrentGroupName = groupName || '';\n\t\tselectedPermissions = role?.permissions || [];\n\n\t\tmodalState.trigger(RoleModal as any, {\n\t\t\tisEditMode,\n\t\t\tcurrentRoleId,\n\t\t\troleName: role?.name || '',\n\t\t\troleDescription: role?.description || '',\n\t\t\tcurrentGroupName,\n\t\t\tselectedPermissions,\n\t\t\tresponse: (formData: any) => {\n\t\t\t\tif (formData) {\n\t\t\t\t\tsaveRole(formData);\n\t\t\t\t}\n\t\t\t},\n\t\t\ttitle: isEditMode ? 'Edit Role' : 'Create Role'\n\t\t});\n\t};\n\n\tconst saveRole = async (role: {\n\t\troleName: string;\n\t\troleDescription: string;\n\t\tcurrentGroupName: string;\n\t\tselectedPermissions: string[];\n\t\tcurrentRoleId: string | null;\n\t}) => {\n\t\tconst { roleName, roleDescription, currentGroupName, selectedPermissions, currentRoleId } = role;\n\t\tif (!roleName) return;\n\n\t\tconst roleId = currentRoleId ?? uuidv4().replace(/-/g, '');\n\t\tconst newRole = {\n\t\t\t_id: roleId,\n\t\t\tid: roleId, // Add id for dndzone\n\t\t\tname: roleName,\n\t\t\tdescription: roleDescription,\n\t\t\tgroupName: currentGroupName,\n\t\t\tpermissions: selectedPermissions\n\t\t};\n\n\t\tif (!isEditMode) {\n\t\t\titems = [...items, newRole];\n\t\t\tmodifiedRoles.add(roleId);\n\t\t\ttoaster.info({ description: 'Role added. Click \"Save\" at the top to apply changes.' });\n\t\t} else if (currentRoleId) {\n\t\t\tconst index = items.findIndex((cur: { _id: string }) => cur._id === currentRoleId);\n\t\t\titems[index] = newRole;\n\t\t\titems = [...items];\n\t\t\tmodifiedRoles.add(currentRoleId);\n\t\t\ttoaster.info({ description: 'Role updated. Click \"Save\" at the top to apply changes.' });\n\t\t}\n\n\t\troles = items;\n\t\t// Remove id property when sending data to parent\n\t\tconst cleanedItems = items.map(({ id, ...item }: { id: string; [key: string]: any }) => item);\n\t\tsetRoleData(cleanedItems);\n\n\t\tif (updateModifiedCount) {\n\t\t\tupdateModifiedCount(modifiedRoles.size);\n\t\t}\n\t};\n\n\tconst deleteSelectedRoles = async () => {\n\t\tfor (const roleId of selectedRoles) {\n\t\t\tconst index = items.findIndex((cur: { _id: string }) => cur._id === roleId);\n\t\t\titems.splice(index, 1);\n\t\t\tmodifiedRoles.add(roleId);\n\t\t}\n\t\titems = [...items];\n\t\troles = items;\n\t\tselectedRoles = new Set();\n\t\ttoaster.info({ description: 'Roles deleted. Click \"Save\" at the top to apply changes.' });\n\n\t\t// Remove id property when sending data to parent\n\t\tconst cleanedItems = items.map(({ id, ...item }: { id: string; [key: string]: any }) => item);\n\t\tsetRoleData(cleanedItems);\n\n\t\t// Notify the parent about the number of changes\n\t\tif (updateModifiedCount) {\n\t\t\tupdateModifiedCount(modifiedRoles.size);\n\t\t}\n\t};\n\n\tconst toggleRoleSelection = (roleId: string) => {\n\t\tconst newSelection = new Set(selectedRoles);\n\t\tif (newSelection.has(roleId)) {\n\t\t\tnewSelection.delete(roleId);\n\t\t} else {\n\t\t\tnewSelection.add(roleId);\n\t\t}\n\t\tselectedRoles = newSelection;\n\t};\n\n\t// DndItem type already defined above\n\n\tfunction handleSort(e: CustomEvent) {\n\t\titems = [...e.detail.items];\n\t\troles = items;\n\t\t// Find the item that was moved by id\n\t\tconst movedItem = e.detail.items.find((item: DndItem) => item.id === e.detail.info.id);\n\t\tif (movedItem) {\n\t\t\tmodifiedRoles.add(movedItem._id);\n\t\t}\n\n\t\t// Remove id property when sending data to parent\n\t\tconst cleanedItems = items.map(({ id, ...item }: { id: string; [key: string]: any }) => item);\n\t\tsetRoleData(cleanedItems);\n\n\t\t// Notify the parent about the number of changes\n\t\tif (updateModifiedCount) {\n\t\t\tupdateModifiedCount(modifiedRoles.size);\n\t\t}\n\t}\n\n\tfunction handleFinalize(e: CustomEvent) {\n\t\titems = [...e.detail.items];\n\t\troles = items;\n\t\t// Find the item that was moved by id\n\t\tconst movedItem = e.detail.items.find((item: DndItem) => item.id === e.detail.info.id);\n\t\tif (movedItem) {\n\t\t\tmodifiedRoles.add(movedItem._id);\n\t\t}\n\n\t\t// Remove id property when sending data to parent\n\t\tconst cleanedItems = items.map(({ id, ...item }: { id: string; [key: string]: any }) => item);\n\t\tsetRoleData(cleanedItems);\n\n\t\t// Notify the parent about the number of changes\n\t\tif (updateModifiedCount) {\n\t\t\tupdateModifiedCount(modifiedRoles.size);\n\t\t}\n\t}\n</script>\n\n{#if error}\n\t<p class=\"error\">{error}</p>\n{:else}\n\t<h3 class=\"mb-2 text-center text-xl font-bold\">Roles Management:</h3>\n\n\t<p class=\"mb-4 justify-center text-center text-sm text-gray-500 dark:text-gray-400\">\n\t\tManage user roles and their access permissions. You can create, edit, or delete roles and assign specific permissions to them.\n\t</p>\n\n\t<div class=\"wrapper my-4\">\n\t\t<div class=\"mb-4 flex items-center justify-between\">\n\t\t\t<!-- Create -->\n\t\t\t<button onclick={() => openModal(null, '')} class=\"preset-filled-primary-500 btn\">Create Role</button>\n\t\t\t<!-- Delete -->\n\t\t\t<button onclick={deleteSelectedRoles} class=\"preset-filled-error-500 btn\" disabled={selectedRoles.size === 0}>\n\t\t\t\tDelete Roles ({selectedRoles.size})\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"role mt-4 flex-1 overflow-auto\">\n\t\t\t{#if roles.length === 0}\n\t\t\t\t<p>No roles defined yet.</p>\n\t\t\t{:else}\n\t\t\t\t<div class=\"rounded-8\">\n\t\t\t\t\t<section\n\t\t\t\t\t\tclass=\"list-none space-y-2\"\n\t\t\t\t\t\tuse:dndzone={{ items: items, flipDurationMs, type: 'column' }}\n\t\t\t\t\t\tonconsider={handleSort}\n\t\t\t\t\t\tonfinalize={handleFinalize}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#each items as role (role.id)}\n\t\t\t\t\t\t\t<div class=\"animate-flip flex items-center justify-between rounded border p-2 hover:bg-surface-500 md:flex-row\">\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<!-- Drag Icon -->\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:drag\" width=\"18\" class=\"cursor-move text-gray-500 dark:text-gray-300\"></iconify-icon>\n\n\t\t\t\t\t\t\t\t\t{#if !role.isAdmin}\n\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" checked={selectedRoles.has(role._id)} onchange={() => toggleRoleSelection(role._id)} class=\"mr-2\" />\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<!-- Role Name with Tooltip -->\n\t\t\t\t\t\t\t\t\t<span class=\"flex items-center text-xl font-semibold text-tertiary-500 dark:text-primary-500\">\n\t\t\t\t\t\t\t\t\t\t{role.name}\n\n\t\t\t\t\t\t\t\t\t\t{#if role.description}\n\t\t\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\t\t\ticon=\"material-symbols:info\"\n\t\t\t\t\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"ml-1 text-tertiary-500 dark:text-primary-500\"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle={role.description}\n\t\t\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<!-- Description for larger screens -->\n\t\t\t\t\t\t\t\t<p class=\"mt-2 hidden text-sm text-gray-600 dark:text-gray-400 md:ml-4 md:mt-0 md:block\">\n\t\t\t\t\t\t\t\t\t{role.description}\n\t\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t\t<!-- Edit Button: changes layout depending on screen size -->\n\t\t\t\t\t\t\t\t<button onclick={() => openModal(role)} aria-label=\"Edit role\" class=\"preset-filled-secondary-500 btn\">\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:pencil\" class=\"text-white\" width=\"18\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t<span class=\"hidden md:block\">Edit</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</section>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n{/if}\n\n<style>\n\t.role {\n\t\theight: calc(100vh - 350px);\n\t}\n</style>\n","<!--\n@file src/routes/(app)/config/assessManagement/Permissions.svelte\n@component\n**This component manages permissions in the access management system. It provides functionality to display existing permissions, search and filter permissions, modify permission settings, bulk delete selected permissions, and handle advanced permission conditions.**\n\n@example\n<Permissions />\n\n### Props\n- `roleData`: An object containing role data, including the current admin role and available roles.\n\nIt provides the following functionality:\n- Display existing permissions\n- Search and filter permissions\n- Modify permission settings, including role assignments\n- Bulk delete selected permissions\n- Handle advanced permission conditions\n-->\n\n<script lang=\"ts\">\n\t// Stores\n\timport { page } from '$app/state';\n\n\t// Auth\n\timport type { Permission, Role } from '@shared/database/auth/types';\n\timport { PermissionType } from '@shared/database/auth/types';\n\n\tinterface Props {\n\t\t// Props passed from +page.svelte\n\t\troleData: any;\n\t\tsetRoleData: any;\n\t\tupdateModifiedCount: any;\n\t}\n\n\tconst { roleData, setRoleData, updateModifiedCount }: Props = $props();\n\n\t// Reactive state\n\tlet permissionsList: Permission[] = $state([]);\n\tlet roles: Role[] = $state([]);\n\tconst error = $state(null);\n\tlet searchTerm = $state('');\n\tconst modifiedPermissions = $state(new Set());\n\n\t// Sorting state\n\ttype SortKey = 'name' | 'action' | 'type';\n\tlet sortBy = $state('name');\n\tlet sortOrder = $state(0);\n\n\t// Function to get groups of permissions\n\tconst getGroups = (filteredPermissions: Permission[]) => {\n\t\tconst groups: string[] = [];\n\t\tfilteredPermissions.forEach((cur) => {\n\t\t\tlet group = '';\n\t\t\tif (cur.type === PermissionType.COLLECTION) {\n\t\t\t\tgroup = 'Collection Entries';\n\t\t\t} else if (cur.type === PermissionType.USER) {\n\t\t\t\tgroup = 'User Management';\n\t\t\t} else if (cur.type === PermissionType.CONFIGURATION) {\n\t\t\t\tgroup = 'Configuration';\n\t\t\t} else if (cur.type === PermissionType.SYSTEM) {\n\t\t\t\t// Group system permissions by their prefix\n\t\t\t\tconst prefix = cur._id.split(':')[0];\n\t\t\t\tif (prefix === 'system') {\n\t\t\t\t\tgroup = 'System';\n\t\t\t\t} else if (prefix === 'api') {\n\t\t\t\t\tgroup = 'API Access';\n\t\t\t\t} else if (prefix === 'content') {\n\t\t\t\t\tgroup = 'Content Management';\n\t\t\t\t} else if (prefix === 'media') {\n\t\t\t\t\tgroup = 'Media Management';\n\t\t\t\t} else if (prefix === 'config') {\n\t\t\t\t\tgroup = 'Configuration';\n\t\t\t\t} else if (prefix === 'admin') {\n\t\t\t\t\tgroup = 'Admin';\n\t\t\t\t} else {\n\t\t\t\t\tgroup = 'System';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (group && !groups.includes(group)) {\n\t\t\t\tgroups.push(group);\n\t\t\t}\n\t\t});\n\t\treturn groups;\n\t};\n\n\t// Handle column header click for sorting\n\tconst handleSort = (column: SortKey) => {\n\t\tif (sortBy === column) {\n\t\t\t// Cycle through: ascending (1) -> descending (-1) -> unsorted (0)\n\t\t\tsortOrder = sortOrder === 1 ? -1 : sortOrder === -1 ? 0 : 1;\n\t\t\tif (sortOrder === 0) sortBy = 'name'; // Reset to default when unsorted\n\t\t} else {\n\t\t\tsortBy = column;\n\t\t\tsortOrder = 1; // Start with ascending\n\t\t}\n\t};\n\n\t// Sort permissions based on current sort settings\n\tconst sortPermissions = (permissions: Permission[]): Permission[] => {\n\t\tif (sortOrder === 0) return permissions;\n\n\t\treturn [...permissions].sort((a, b) => {\n\t\t\tlet aVal: string | number = '';\n\t\t\tlet bVal: string | number = '';\n\n\t\t\tif (sortBy === 'name') {\n\t\t\t\taVal = a.name.toLowerCase();\n\t\t\t\tbVal = b.name.toLowerCase();\n\t\t\t} else if (sortBy === 'action') {\n\t\t\t\taVal = a.action.toLowerCase();\n\t\t\t\tbVal = b.action.toLowerCase();\n\t\t\t} else if (sortBy === 'type') {\n\t\t\t\taVal = a.type.toLowerCase();\n\t\t\t\tbVal = b.type.toLowerCase();\n\t\t\t}\n\n\t\t\tif (aVal < bVal) return sortOrder === 1 ? -1 : 1;\n\t\t\tif (aVal > bVal) return sortOrder === 1 ? 1 : -1;\n\t\t\treturn 0;\n\t\t});\n\t};\n\n\t// Derived reactive values\n\tconst filteredPermissions = $derived(\n\t\tpermissionsList.filter((permission) => permission._id?.toLowerCase().includes(searchTerm.toLowerCase()) ?? false)\n\t);\n\tconst groups = $derived(getGroups(filteredPermissions));\n\tconst adminRole = $derived(roles.find((role) => role.isAdmin));\n\tconst nonAdminRolesCount = $derived(roles.filter((role) => !role.isAdmin).length);\n\n\t// Initialize data when component mounts (run once)\n\t$effect(() => {\n\t\t// Only initialize if data hasn't been loaded yet\n\t\tif (permissionsList.length === 0 && page.data.permissions.length > 0) {\n\t\t\troles = roleData;\n\t\t\tpermissionsList = page.data.permissions;\n\t\t}\n\t});\n\n\t// Function to filter permissions by group (with sorting applied)\n\tconst filterGroups = (permissions: Permission[], group: string): Permission[] => {\n\t\tlet filtered: Permission[] = [];\n\n\t\tif (group === 'Collection Entries') {\n\t\t\tfiltered = permissions.filter((cur) => cur.type === PermissionType.COLLECTION);\n\t\t} else if (group === 'User Management') {\n\t\t\tfiltered = permissions.filter((cur) => cur.type === PermissionType.USER);\n\t\t} else if (group === 'Configuration') {\n\t\t\tfiltered = permissions.filter(\n\t\t\t\t(cur) => cur.type === PermissionType.CONFIGURATION || (cur.type === PermissionType.SYSTEM && cur._id.startsWith('config:'))\n\t\t\t);\n\t\t} else if (group === 'System') {\n\t\t\tfiltered = permissions.filter((cur) => cur.type === PermissionType.SYSTEM && cur._id.startsWith('system:'));\n\t\t} else if (group === 'API Access') {\n\t\t\tfiltered = permissions.filter((cur) => cur.type === PermissionType.SYSTEM && cur._id.startsWith('api:'));\n\t\t} else if (group === 'Content Management') {\n\t\t\tfiltered = permissions.filter((cur) => cur.type === PermissionType.SYSTEM && cur._id.startsWith('content:'));\n\t\t} else if (group === 'Media Management') {\n\t\t\tfiltered = permissions.filter((cur) => cur.type === PermissionType.SYSTEM && cur._id.startsWith('media:'));\n\t\t} else if (group === 'Admin') {\n\t\t\tfiltered = permissions.filter((cur) => cur.type === PermissionType.SYSTEM && cur._id.startsWith('admin:'));\n\t\t} else {\n\t\t\tfiltered = permissions.filter((cur) => cur._id.split(':')[0] === group.toLowerCase());\n\t\t}\n\n\t\t// Apply sorting to the filtered group\n\t\treturn sortPermissions(filtered);\n\t};\n\n\t// Toggle role assignment for a permission\n\tconst toggleRole = (permission: string, roleId: string) => {\n\t\tconst updatedRoles = roles.map((role) => {\n\t\t\tif (role._id === roleId) {\n\t\t\t\tconst permissions = [...role.permissions];\n\t\t\t\tconst pIndex = permissions.findIndex((cur) => cur === permission);\n\t\t\t\tif (pIndex === -1) {\n\t\t\t\t\tpermissions.push(permission);\n\t\t\t\t} else {\n\t\t\t\t\tpermissions.splice(pIndex, 1);\n\t\t\t\t}\n\t\t\t\treturn { ...role, permissions };\n\t\t\t}\n\t\t\treturn role;\n\t\t});\n\n\t\t// Track modified permissions\n\t\tmodifiedPermissions.add(permission);\n\n\t\t// Update role data and notify parent component\n\t\troles = updatedRoles;\n\t\tsetRoleData(updatedRoles);\n\t\tupdateModifiedCount(modifiedPermissions.size);\n\t};\n</script>\n\n{#if error}\n\t<p class=\"error\">{error}</p>\n{:else}\n\t<h3 class=\"mb-2 text-center text-xl font-bold\">Permission Management:</h3>\n\t<p class=\"mb-4 justify-center text-center text-sm text-gray-500 dark:text-gray-400\">\n\t\tSelect the roles for each permission and click 'Save' to apply your changes.\n\t</p>\n\n\t<div class=\"sticky top-0 z-10 mb-4 flex items-center justify-between\">\n\t\t<input type=\"text\" bind:value={searchTerm} placeholder=\"Search Permissions...\" class=\"input mr-4 grow\" aria-label=\"Search permissions\" />\n\t</div>\n\n\t{#if filteredPermissions.length === 0}\n\t\t<p class=\"text-tertiary-500 dark:text-primary-500\">\n\t\t\t{searchTerm ? 'No permissions match your search.' : 'No permissions defined yet.'}\n\t\t</p>\n\t{:else}\n\t\t<!-- Admin Notice -->\n\t\t{#if adminRole}\n\t\t\t<p class=\"mb-2 w-full overflow-auto text-nowrap text-center\">\n\t\t\t\t*\n\t\t\t\t<span class=\"text-tertiary-500 dark:text-primary-500\">{adminRole.name}</span>\n\t\t\t\tRole has all permissions\n\t\t\t</p>\n\t\t{/if}\n\t\t<div class=\"permission overflow-auto\">\n\t\t\t<table class=\"compact w-full table-auto border\">\n\t\t\t\t<!-- Header -->\n\t\t\t\t<thead class=\"sticky top-0 border bg-surface-800\">\n\t\t\t\t\t<tr class=\"divide-x text-tertiary-500 dark:text-primary-500\">\n\t\t\t\t\t\t<th\n\t\t\t\t\t\t\tclass=\"cursor-pointer select-none py-2 {sortBy === 'name' ? 'font-semibold text-primary-500 dark:text-secondary-400' : ''}\"\n\t\t\t\t\t\t\tonclick={() => handleSort('name')}\n\t\t\t\t\t\t\ttitle=\"Click to sort by permission name\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-center\">\n\t\t\t\t\t\t\t\tType\n\t\t\t\t\t\t\t\t{#if sortBy === 'name' && sortOrder !== 0}\n\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\ticon={sortOrder === 1 ? 'material-symbols:arrow-upward-rounded' : 'material-symbols:arrow-downward-rounded'}\n\t\t\t\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\t\t\t\tclass=\"ml-1\"\n\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</th>\n\t\t\t\t\t\t<th\n\t\t\t\t\t\t\tclass=\"cursor-pointer select-none py-2 {sortBy === 'action' ? 'font-semibold text-primary-500 dark:text-secondary-400' : ''}\"\n\t\t\t\t\t\t\tonclick={() => handleSort('action')}\n\t\t\t\t\t\t\ttitle=\"Click to sort by action\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-center\">\n\t\t\t\t\t\t\t\tAction\n\t\t\t\t\t\t\t\t{#if sortBy === 'action' && sortOrder !== 0}\n\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\ticon={sortOrder === 1 ? 'material-symbols:arrow-upward-rounded' : 'material-symbols:arrow-downward-rounded'}\n\t\t\t\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\t\t\t\tclass=\"ml-1\"\n\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</th>\n\n\t\t\t\t\t\t<!-- List only non-admin roles -->\n\t\t\t\t\t\t{#each roles as role}\n\t\t\t\t\t\t\t{#if !role.isAdmin}\n\t\t\t\t\t\t\t\t<th class=\"py-2\">{role.name}</th>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t<!-- Permission Groups -->\n\t\t\t\t\t{#each groups as group}\n\t\t\t\t\t\t{#if filterGroups(filteredPermissions, group).length > 0}\n\t\t\t\t\t\t\t<!-- Group Name -->\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td\n\t\t\t\t\t\t\t\t\tcolspan={nonAdminRolesCount + 2}\n\t\t\t\t\t\t\t\t\tclass=\"border-b bg-surface-500 px-1 py-2 font-semibold text-tertiary-500 dark:text-primary-500 lg:text-left\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{group}:\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<!-- Permissions within the Group -->\n\t\t\t\t\t\t\t{#each filterGroups(filteredPermissions, group) as permission}\n\t\t\t\t\t\t\t\t<tr class=\"divide-x border-b text-center hover:bg-surface-50 dark:hover:bg-surface-600\">\n\t\t\t\t\t\t\t\t\t<!-- Type -->\n\t\t\t\t\t\t\t\t\t<td class=\"px-1 py-1 md:text-left\">{permission.name}</td>\n\t\t\t\t\t\t\t\t\t<!-- Action -->\n\t\t\t\t\t\t\t\t\t<td class=\"px-1 py-1\">{permission.action}</td>\n\t\t\t\t\t\t\t\t\t<!-- Roles -->\n\t\t\t\t\t\t\t\t\t{#each roles as role}\n\t\t\t\t\t\t\t\t\t\t{#if !role.isAdmin}\n\t\t\t\t\t\t\t\t\t\t\t<td class=\"px-1 py-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={role.permissions.includes(permission._id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonchange={() => toggleRole(permission._id, role._id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"form-checkbox\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/each}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t{/if}\n{/if}\n\n<style>\n\t.permission {\n\t\theight: calc(100vh - 400px);\n\t}\n</style>\n","<!--\n@file src/routes/(app)/config/adminRoleManagement/AdminRole.svelte\n@component\n**This component manages the selection and updating of the administrator role within the application**\n\n@example\n<AdminRole bind:roleData={roleData} />\n\n### Props\n- `roleData`: An object containing role data, including the current admin role and available roles.\n\nIt provides functionality to:\n- Load and display available roles, excluding the current administrator role.\n- Allow users to select a new role for the administrator using a dropdown menu.\n- Display the current and selected administrator roles.\n- Show \"Save Changes\" and \"Cancel\" buttons when a new role is selected, and handle the save or cancel operation.\n- Provide feedback to the user through notifications after saving changes.\n-->\n\n<script lang=\"ts\">\n\timport { tick } from 'svelte';\n\n\t// Types\n\timport type { Role } from '@shared/database/auth/types';\n\n\t// Components\n\timport { showToast } from '@shared/utils/toast';\n\n\tconst { roleData, setRoleData } = $props();\n\n\t// Reactive state\n\tconst error = $state(null);\n\tlet currentAdminRole: string | null = $state(null);\n\tlet currentAdminName: string | null = $state(null);\n\tlet isSaving = $state(false);\n\tlet notification: string | null = $state(null); // Explicitly type as string | null\n\tlet selectedAdminRole: string | null = $state(null);\n\n\t// Derived state for computed values\n\tconst availableRoles = $derived(roleData.filter((role: Role) => role._id !== currentAdminRole));\n\tconst hasChanges = $derived(selectedAdminRole !== currentAdminRole);\n\n\t// Initialize component data (run once)\n\t$effect(() => {\n\t\t// Only initialize if data hasn't been loaded yet\n\t\tif (!currentAdminRole && roleData.length > 0) {\n\t\t\tconst currentAdmin = roleData.find((role: Role) => role.isAdmin === true);\n\t\t\tif (currentAdmin) {\n\t\t\t\tcurrentAdminRole = currentAdmin._id;\n\t\t\t\tcurrentAdminName = currentAdmin.name;\n\t\t\t\tselectedAdminRole = currentAdmin._id;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Handle role change\n\tconst handleRoleChange = (event: Event) => {\n\t\tconst selectedRoleId = (event.target as HTMLSelectElement).value;\n\t\tselectedAdminRole = selectedRoleId;\n\t};\n\n\t// Function to save the new admin role\n\tconst saveAdminRole = async () => {\n\t\ttry {\n\t\t\tisSaving = true;\n\t\t\tnotification = null;\n\n\t\t\t// Ensure DOM updates before save process begins\n\t\t\tawait tick();\n\n\t\t\tcurrentAdminRole = selectedAdminRole;\n\t\t\ttry {\n\t\t\t\tconst result = roleData.map((cur: Role) => {\n\t\t\t\t\tif (cur._id === selectedAdminRole) {\n\t\t\t\t\t\tcurrentAdminName = cur.name;\n\t\t\t\t\t\treturn { ...cur, isAdmin: true };\n\t\t\t\t\t}\n\t\t\t\t\tif (cur.isAdmin === true) {\n\t\t\t\t\t\treturn { ...cur, isAdmin: false };\n\t\t\t\t\t}\n\t\t\t\t\treturn cur;\n\t\t\t\t});\n\t\t\t\tsetRoleData(result);\n\t\t\t} catch (error) {\n\t\t\t\tshowToast('Network error occurred while updating config file', 'error');\n\t\t\t}\n\t\t\tnotification = 'Admin role changed. Click \"Save\" at the top to apply changes.';\n\t\t} catch (err) {\n\t\t\tnotification = `Failed to save admin role: ${err instanceof Error ? err.message : String(err)}`;\n\t\t} finally {\n\t\t\tisSaving = false;\n\t\t}\n\t};\n\n\t// Function to cancel changes and reset the selected role to the current admin role\n\tconst cancelChanges = () => {\n\t\tselectedAdminRole = currentAdminRole;\n\t};\n</script>\n\n{#if error}\n\t<p class=\"error\">{error}</p>\n{:else}\n\t<h3 class=\"mb-2 text-center text-xl font-bold\">Admin Role Management:</h3>\n\t<p class=\"mb-4 justify-center text-center text-sm text-gray-500 dark:text-gray-400\">\n\t\tPlease select a new role for the administrator from the dropdown below. Your changes will take effect after you click \"Save Changes\".\n\t</p>\n\t<div class=\"wrapper my-4\">\n\t\t<!-- Display current admin role-->\n\t\t<p class=\"my-4 text-center lg:text-left\">\n\t\t\tCurrent Admin Role: <span class=\"ml-2 text-tertiary-500 dark:text-primary-500\">{currentAdminName}</span>\n\t\t</p>\n\n\t\t<!-- Dropdown to select admin role -->\n\t\t<label for=\"adminRole\" class=\"block text-sm text-surface-300\">Select new Administrator Role:</label>\n\t\t<select id=\"adminRole\" class=\"input\" onchange={handleRoleChange} bind:value={selectedAdminRole}>\n\t\t\t{#each availableRoles as role}\n\t\t\t\t<option value={role._id}>{role.name}</option>\n\t\t\t{/each}\n\t\t</select>\n\n\t\t<!-- Save and Cancel Buttons -->\n\t\t{#if hasChanges}\n\t\t\t<!-- Display new admin role-->\n\t\t\t<p class=\"mt-4 text-center lg:text-left\">\n\t\t\t\tSelected Admin Role ID: <span class=\"ml-2 text-tertiary-500 dark:text-primary-500\">{selectedAdminRole}</span>\n\t\t\t</p>\n\t\t\t<div class=\"mt-4 flex justify-between\">\n\t\t\t\t<!-- cancel -->\n\t\t\t\t<button onclick={cancelChanges} class=\"variant-filled-secondary btn\"> Cancel </button>\n\n\t\t\t\t<!-- Save -->\n\t\t\t\t<button onclick={saveAdminRole} class=\"preset-filled-tertiary-500 btn\" disabled={isSaving}>\n\t\t\t\t\t{#if isSaving}\n\t\t\t\t\t\tSaving...\n\t\t\t\t\t{:else}\n\t\t\t\t\t\tSave Changes\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<!-- Notification Message -->\n\t\t{#if notification}\n\t\t\t<p class=\"mt-4 text-green-600\">{notification}</p>\n\t\t{/if}\n\t</div>\n{/if}\n","<!--\n@file src/routes/(app)/config/accessManagement/WebsiteTokens.svelte\n@component\n**This component manages website tokens within the application's access management system**\n\n@xample\n<WebsiteTokens />\n\n### Features\n- Load and display website tokens and their associated permissions.\n- Allow users to create, edit, and delete website tokens through a modal interface.\n- Allow bulk deletion of selected website tokens.\n- Display a skeleton.dev modal for creating or editing website tokens with an intuitive UI for selecting associated permissions.\n-->\n\n<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport TablePagination from '@cms/components/system/table/TablePagination.svelte';\n\timport TableFilter from '@cms/components/system/table/TableFilter.svelte';\n\t// import { clipboard } from '@skeletonlabs/skeleton-svelte';\n\timport { dndzone } from 'svelte-dnd-action';\n\timport { flip } from 'svelte/animate';\n\timport type { WebsiteToken } from '@shared/database/schemas';\n\timport type { User } from '@shared/database/auth/types';\n\timport { globalLoadingStore, loadingOperations } from '@shared/stores/loadingStore.svelte';\n\n\tinterface TableHeader {\n\t\tlabel: string;\n\t\tkey: string;\n\t\tvisible: boolean;\n\t\tid: string;\n\t}\n\n\tlet tokens: WebsiteToken[] = $state([]);\n\tlet users: User[] = $state([]);\n\tconst userMap = $derived(new Map(users.map((u) => [u._id, u.username || u.email])));\n\tlet newTokenName = $state('');\n\n\t// Filter state\n\tlet globalSearchValue = $state('');\n\tlet searchShow = $state(false);\n\tlet filterShow = $state(false);\n\tlet columnShow = $state(false);\n\tlet density = $state('normal');\n\tlet filters: Record<string, string | undefined> = $state({});\n\n\t// Sorting and Pagination\n\tlet sorting = $state({ sortedBy: 'createdAt', isSorted: -1 }); // Sort by createdAt desc by default\n\tlet currentPage = $state(1);\n\tlet rowsPerPage = $state(10);\n\tlet totalItems = $state(0);\n\tconst pagesCount = $derived(Math.ceil(totalItems / rowsPerPage) || 1);\n\n\tconst tableHeaders = [\n\t\t{ label: 'Name', key: 'name' },\n\t\t{ label: 'Token', key: 'token' },\n\t\t{ label: 'Created At', key: 'createdAt' },\n\t\t{ label: 'Created By', key: 'createdBy' }\n\t];\n\n\t// Column visibility\n\tlet displayTableHeaders = $state(tableHeaders.map((h) => ({ ...h, visible: true, id: `header-${h.key}` })));\n\tlet selectAllColumns = $state(true);\n\n\tfunction handleDndConsider(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t}\n\n\tfunction handleDndFinalize(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t}\n\n\tfunction handleCheckboxChange() {\n\t\tconst allColumnsVisible = displayTableHeaders.every((header) => header.visible);\n\t\tdisplayTableHeaders = displayTableHeaders.map((header) => ({\n\t\t\t...header,\n\t\t\tvisible: !allColumnsVisible\n\t\t}));\n\t\tselectAllColumns = !allColumnsVisible;\n\t}\n\n\tfunction handleInputChange(value: string, headerKey: string) {\n\t\tif (value) {\n\t\t\tfilters = { ...filters, [headerKey]: value };\n\t\t} else {\n\t\t\tconst newFilters = { ...filters };\n\t\t\tdelete newFilters[headerKey];\n\t\t\tfilters = newFilters;\n\t\t}\n\t}\n\n\tonMount(async () => {\n\t\tawait Promise.all([fetchTokens(), fetchUsers()]);\n\t});\n\n\tasync function fetchUsers() {\n\t\t// Capture current state of 'users' into a local variable (or object reference if updated within async block)\n\t\tconst usersRef = { value: users };\n\t\ttry {\n\t\t\tconst response = await fetch('/api/admin/users');\n\t\t\tif (response.ok) {\n\t\t\t\tconst result = await response.json();\n\t\t\t\tusersRef.value = result.data; // Update the referenced value\n\t\t\t} else {\n\t\t\t\ttoaster.error({ description: 'Failed to fetch users' });\n\t\t\t}\n\t\t} catch (error) {\n\t\t\ttoaster.error({ description: 'An error occurred while fetching users' });\n\t\t}\n\t\t// Assign back to the $state variable after async operation\n\t\tusers = usersRef.value;\n\t}\n\n\tasync function fetchTokens() {\n\t\t// Capture current state values into local variables for the async block\n\t\tconst currentPageVal = currentPage;\n\t\tconst rowsPerPageVal = rowsPerPage;\n\t\tconst sortingVal = sorting;\n\t\tconst globalSearchValueVal = globalSearchValue;\n\t\tconst filtersVal = filters;\n\t\tconst tokensRef = { value: tokens }; // Use an object to hold the reference for tokens\n\t\tconst totalItemsRef = { value: totalItems }; // Use an object to hold the reference for totalItems\n\n\t\tawait globalLoadingStore.withLoading(\n\t\t\tloadingOperations.tokenGeneration,\n\t\t\tasync () => {\n\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\tparams.set('page', String(currentPageVal));\n\t\t\t\tparams.set('limit', String(rowsPerPageVal));\n\t\t\t\tparams.set('sort', sortingVal.sortedBy);\n\t\t\t\tif (sortingVal.isSorted !== 0) {\n\t\t\t\t\tparams.set('order', sortingVal.isSorted === 1 ? 'asc' : 'desc');\n\t\t\t\t}\n\n\t\t\t\tif (globalSearchValueVal) {\n\t\t\t\t\tparams.set('search', globalSearchValueVal);\n\t\t\t\t}\n\n\t\t\t\tfor (const [key, value] of Object.entries(filtersVal)) {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tparams.set(key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch(`/api/website-tokens?${params.toString()}`);\n\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\tconst result = await response.json();\n\t\t\t\t\t\ttokensRef.value = result.data; // Assign to the ref's value\n\t\t\t\t\t\ttotalItemsRef.value = result.pagination.totalItems; // Assign to the ref's value\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoaster.error({ description: 'Failed to fetch tokens' });\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\ttoaster.error({ description: 'An error occurred while fetching tokens' });\n\t\t\t\t}\n\t\t\t},\n\t\t\t'Fetching website tokens'\n\t\t);\n\t\t// Assign back to the $state variables after async operation\n\t\ttokens = tokensRef.value;\n\t\ttotalItems = totalItemsRef.value;\n\t}\n\tasync function generateToken() {\n\t\tconst currentNewTokenName = newTokenName; // Capture current state\n\t\tif (!currentNewTokenName) {\n\t\t\ttoaster.error({ description: 'Please enter a name for the token.' });\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch('/api/website-tokens', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ name: currentNewTokenName })\n\t\t\t});\n\n\t\t\tif (response.ok) {\n\t\t\t\tawait fetchTokens(); // Refetch to get the new token and update pagination\n\t\t\t\ttoaster.success({ description: `Token generated for ${currentNewTokenName}` });\n\t\t\t\tnewTokenName = ''; // Clear input\n\t\t\t} else {\n\t\t\t\tif (response.status === 409) {\n\t\t\t\t\ttoaster.error({ description: 'A token with this name already exists' });\n\t\t\t\t} else {\n\t\t\t\t\ttoaster.error({ description: 'Failed to generate token' });\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\ttoaster.error({ description: 'An error occurred while generating the token' });\n\t\t}\n\t}\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\n\tasync function deleteToken(id: string, name: string) {\n\t\tshowConfirm({\n\t\t\ttitle: 'Delete Token',\n\t\t\tbody: `Are you sure you want to delete the token \"${name}\"? This action cannot be undone.`,\n\t\t\tonConfirm: async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch(`/api/website-tokens/${id}`, {\n\t\t\t\t\t\tmethod: 'DELETE'\n\t\t\t\t\t});\n\n\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\tawait fetchTokens(); // Refetch to update the list\n\t\t\t\t\t\ttoaster.success({ description: 'Token deleted.' });\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoaster.error({ description: 'Failed to delete token' });\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\ttoaster.error({ description: 'An error occurred while deleting the token' });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t$effect(() => {\n\t\tif (totalItems <= 1) return;\n\t\tvoid currentPage;\n\t\tvoid rowsPerPage;\n\t\tvoid sorting;\n\t\tfetchTokens();\n\t});\n</script>\n\n<div class=\"p-4\">\n\t<h3 class=\"mb-2 text-center text-xl font-bold\">Website Access Tokens</h3>\n\t<p class=\"mb-4 justify-center text-center text-sm text-gray-500 dark:text-gray-400\">\n\t\tManage API tokens for external websites to access your content.\n\t</p>\n\n\t<div class=\"card mb-4\">\n\t\t<div class=\"p-4\">\n\t\t\t<h4 class=\"h4 mb-2 font-bold text-tertiary-500 dark:text-primary-500\">Generate New Website Token</h4>\n\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t<input type=\"text\" class=\"input\" placeholder=\"Token Name\" bind:value={newTokenName} />\n\t\t\t\t<button class=\"preset-filled-primary-500 btn\" onclick={generateToken}>Generate</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"card\">\n\t\t<div class=\"p-4\">\n\t\t\t<div class=\"my-4 flex flex-wrap items-center justify-between gap-1\">\n\t\t\t\t<h4 class=\"h4 font-bold text-tertiary-500 dark:text-primary-500\">Existing Tokens</h4>\n\t\t\t\t<div class=\"order-3 sm:order-2\">\n\t\t\t\t\t<TableFilter {globalSearchValue} {searchShow} {filterShow} {columnShow} {density} />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if columnShow}\n\t\t\t\t<div class=\"rounded-b-0 flex flex-col justify-center rounded-t-md border-b bg-surface-300 text-center dark:bg-surface-700\">\n\t\t\t\t\t<div class=\"text-white dark:text-primary-500\">Drag and drop to reorder columns</div>\n\t\t\t\t\t<div class=\"my-2 flex w-full items-center justify-center gap-1\">\n\t\t\t\t\t\t<label class=\"mr-2\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" bind:checked={selectAllColumns} onchange={handleCheckboxChange} />\n\t\t\t\t\t\t\tAll\n\t\t\t\t\t\t</label>\n\n\t\t\t\t\t\t<section\n\t\t\t\t\t\t\tuse:dndzone={{ items: displayTableHeaders, flipDurationMs: 300 }}\n\t\t\t\t\t\t\tonconsider={handleDndConsider}\n\t\t\t\t\t\t\tonfinalize={handleDndFinalize}\n\t\t\t\t\t\t\tclass=\"flex flex-wrap justify-center gap-1 rounded-md p-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#each displayTableHeaders as header: TableHeader (header.id)}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"chip {header.visible\n\t\t\t\t\t\t\t\t\t\t? 'preset-filled-secondary-500'\n\t\t\t\t\t\t\t\t\t\t: 'preset-ghost-secondary-500'} w-100 mr-2 flex items-center justify-center\"\n\t\t\t\t\t\t\t\t\tanimate:flip={{ duration: 300 }}\n\t\t\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\t\t\tdisplayTableHeaders = displayTableHeaders.map((h: TableHeader) => (h.id === header.id ? { ...h, visible: !h.visible } : h));\n\t\t\t\t\t\t\t\t\t\tselectAllColumns = displayTableHeaders.every((h: TableHeader) => h.visible);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if header.visible}\n\t\t\t\t\t\t\t\t\t\t<span><iconify-icon icon=\"fa:check\"></iconify-icon></span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<span class=\"ml-2 capitalize\">{header.label}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t\t<div class=\"table-container\">\n\t\t\t\t<table class=\"table\">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t{#if filterShow}\n\t\t\t\t\t\t\t<tr class=\"divide-x divide-preset-400\">\n\t\t\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t\t\t{#each displayTableHeaders.filter((header: TableHeader) => header.visible) as header (header.id)}\n\t\t\t\t\t\t\t\t\t<th>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"input\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder={`Filter by ${header.label}...`}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => handleInputChange(e.currentTarget.value, header.key)}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t<tr class=\"divide-x divide-preset-400 border-b border-black dark:border-white\">\n\t\t\t\t\t\t\t{#each displayTableHeaders.filter((h: TableHeader) => h.visible) as header: TableHeader}\n\t\t\t\t\t\t\t\t<th\n\t\t\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\t\t\tsorting = {\n\t\t\t\t\t\t\t\t\t\t\tsortedBy: header.key,\n\t\t\t\t\t\t\t\t\t\t\tisSorted: sorting.sortedBy === header.key ? (sorting.isSorted === 1 ? -1 : sorting.isSorted === -1 ? 0 : 1) : 1\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"text-terriary-500 flex items-center justify-center text-center dark:text-primary-500\">\n\t\t\t\t\t\t\t\t\t\t{header.label}\n\t\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\t\ticon=\"material-symbols:arrow-upward-rounded\"\n\t\t\t\t\t\t\t\t\t\t\twidth=\"22\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"origin-center duration-300 ease-in-out\"\n\t\t\t\t\t\t\t\t\t\t\tclass:up={sorting.isSorted === 1 && sorting.sortedBy === header.key}\n\t\t\t\t\t\t\t\t\t\t\tclass:invisible={sorting.isSorted === 0 || sorting.sortedBy !== header.key}\n\t\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t<th class=\"text-terriary-500 text-center dark:text-primary-500\">Action</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t{#each tokens as token (token._id)}\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t{#each displayTableHeaders.filter((h: TableHeader) => h.visible) as header: TableHeader}\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t{#if header.key === 'token'}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<code>{token.token}</code>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait navigator.clipboard.writeText(token.token);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.success({ description: 'Token copied to clipboard' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"preset-outline-surface-500 btn-icon btn-icon-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Copy token to clipboard\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:clipboard-outline\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'createdAt'}\n\t\t\t\t\t\t\t\t\t\t\t{new Date(token.createdAt).toLocaleDateString()}\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'createdBy'}\n\t\t\t\t\t\t\t\t\t\t\t{userMap.get(token.createdBy) || token.createdBy}\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t{token[header.key as keyof WebsiteToken]}\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button class=\"preset-filled-error-500 btn-sm\" onclick={() => deleteToken(token._id, token.name)}>Delete</button>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t\t<div class=\"flex justify-center\">\n\t\t\t\t<div class=\"mt-2 flex flex-col items-center justify-center px-2 md:flex-row md:justify-between md:p-4\">\n\t\t\t\t\t<TablePagination\n\t\t\t\t\t\tbind:currentPage\n\t\t\t\t\t\tbind:rowsPerPage\n\t\t\t\t\t\t{pagesCount}\n\t\t\t\t\t\t{totalItems}\n\t\t\t\t\t\tonUpdatePage={(page: number) => (currentPage = page)}\n\t\t\t\t\t\tonUpdateRowsPerPage={(rows: number) => {\n\t\t\t\t\t\t\trowsPerPage = rows;\n\t\t\t\t\t\t\tcurrentPage = 1;\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n","<!--\n@file src/routes/(app)/config/AccessManagement/+page.svelte\n@component \n**This page manages the Access Management system, including roles and permissions**\n\n@example\n<AccessManagement />\n\n### Props\n- `roleData`: An object containing role data, including the current admin role and available roles.\n\n### Features\n- Navigate between permissions, roles, and admin role management tabs\n- View and manage system permissions\n- Assign roles and permissions to users\n-->\n\n<script lang=\"ts\">\n\timport { page } from '$app/state';\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { logger } from '@shared/utils/logger';\n\timport { Tabs } from '@skeletonlabs/skeleton-svelte';\n\timport { globalLoadingStore, loadingOperations } from '@shared/stores/loadingStore.svelte';\n\n\t// Components\n\timport PageTitle from '@cms/components/PageTitle.svelte';\n\n\t// Auth components for tabs (assuming they are optimized internally)\n\timport Roles from '../components/Roles.svelte';\n\timport Permissions from '../components/Permissions.svelte';\n\timport AdminRole from '../components/AdminRole.svelte';\n\timport WebsiteTokens from '../components/WebsiteTokens.svelte';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Use $state for local component state\n\tlet currentTab = $state('0'); // Initial tab set to string '0' for Tabs component\n\n\t// Use $state for page data that needs to be mutable\n\tlet rolesData = $state(page.data.roles); // Renamed from `roles` to `rolesData` for clarity with internal `roles` in sub-components\n\n\t// Track the number of modified permissions/roles for the \"Save\" button\n\tlet modifiedCount = $state(0);\n\tlet hasModifiedChanges = $state(false);\n\n\t// Function to update the roles data from child components\n\tconst setRoleData = (data: any) => {\n\t\trolesData = data;\n\t\thasModifiedChanges = true; // Any change from children marks the page as modified\n\t};\n\n\t// Function to update the count of modified items (e.g., permissions, roles)\n\tconst updateModifiedCount = (count: number) => {\n\t\tmodifiedCount = count;\n\t\thasModifiedChanges = count > 0;\n\t};\n\n\tconst saveAllChanges = async () => {\n\t\tawait globalLoadingStore.withLoading(\n\t\t\tloadingOperations.configSave,\n\t\t\tasync () => {\n\t\t\t\ttry {\n\t\t\t\t\t// Send the `rolesData` (which includes modifications from children) to the API\n\t\t\t\t\tconst response = await fetch('/api/permission/update', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbody: JSON.stringify({ roles: rolesData })\n\t\t\t\t\t});\n\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\ttoaster.success({ description: 'Configuration updated successfully!' });\n\t\t\t\t\t\thasModifiedChanges = false;\n\t\t\t\t\t\tmodifiedCount = 0;\n\t\t\t\t\t} else if (response.status === 304) {\n\t\t\t\t\t\ttoaster.info({ description: 'No changes detected, configuration not updated.' });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst responseText = await response.text();\n\t\t\t\t\t\ttoaster.error({ description: `Error updating configuration: ${responseText}` });\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.error('Network error during save:', error);\n\t\t\t\t\ttoaster.error({ description: 'Network error occurred while updating configuration.' });\n\t\t\t\t}\n\t\t\t},\n\t\t\t'Saving access control configuration'\n\t\t);\n\t};\n\n\tconst resetChanges = async () => {\n\t\t// A more robust reset would re-fetch the initial data from the server or\n\t\t// store a deep copy of the original data. For simplicity here, we assume\n\t\t// `page.data.roles` holds the original state if we just reset `rolesData`.\n\t\trolesData = page.data.roles; // Reset to initial loaded state\n\t\thasModifiedChanges = false;\n\t\tmodifiedCount = 0;\n\t\ttoaster.info({ description: 'Changes have been reset.' });\n\t};\n</script>\n\n<div class=\"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between\">\n\t<PageTitle name=\"Access Management\" icon=\"mdi:account-key\" showBackButton={true} backUrl=\"/config\" />\n\n\t<div class=\"mt-2 flex items-center justify-center gap-4 lg:mt-0 lg:justify-end\">\n\t\t<button\n\t\t\tonclick={saveAllChanges}\n\t\t\taria-label=\"Save all changes\"\n\t\t\tclass=\"preset-filled-tertiary-500 btn\"\n\t\t\tdisabled={!hasModifiedChanges || globalLoadingStore.isLoading}\n\t\t>\n\t\t\t{#if globalLoadingStore.isLoadingReason(loadingOperations.configSave)}\n\t\t\t\tSaving...\n\t\t\t{:else}\n\t\t\t\tSave ({modifiedCount})\n\t\t\t{/if}\n\t\t</button>\n\n\t\t<button\n\t\t\tonclick={resetChanges}\n\t\t\taria-label=\"Reset changes\"\n\t\t\tclass=\"preset-filled-secondary-500 btn\"\n\t\t\tdisabled={!hasModifiedChanges || globalLoadingStore.isLoading}\n\t\t>\n\t\t\tReset\n\t\t</button>\n\t</div>\n</div>\n\n<div class=\"mb-6 text-center sm:text-left\">\n\t<p class=\"text-center text-tertiary-500 dark:text-primary-500\">\n\t\tHere you can create and manage user roles and permissions. Each role defines a set of permissions that determine what actions users with that role\n\t\tcan perform in the system.\n\t</p>\n</div>\n\n<div class=\"flex flex-col\">\n\t<Tabs value={currentTab} onValueChange={(e) => (currentTab = e.value)} class=\"grow\">\n\t\t<Tabs.List class=\"flex justify-around text-tertiary-500 dark:text-primary-500 border-b border-surface-200-800\">\n\t\t\t<Tabs.Trigger value=\"0\" class=\"flex-1\">\n\t\t\t\t<div class=\"flex items-center justify-center gap-1 py-4\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:shield-lock-outline\" width=\"28\" class=\"text-black dark:text-white\"></iconify-icon>\n\t\t\t\t\t<span class={currentTab === '0' ? 'text-secondary-500 dark:text-tertiary-500 font-bold' : ''}>{m.system_permission()}</span>\n\t\t\t\t</div>\n\t\t\t</Tabs.Trigger>\n\t\t\t<Tabs.Trigger value=\"1\" class=\"flex-1\">\n\t\t\t\t<div class=\"flex items-center justify-center gap-1 py-4\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:account-group\" width=\"28\" class=\"text-black dark:text-white\"></iconify-icon>\n\t\t\t\t\t<span class={currentTab === '1' ? 'text-secondary-500 dark:text-tertiary-500 font-bold' : ''}>{m.system_roles()}</span>\n\t\t\t\t</div>\n\t\t\t</Tabs.Trigger>\n\t\t\t<Tabs.Trigger value=\"2\" class=\"flex-1\">\n\t\t\t\t<div class=\"flex items-center justify-center gap-1 py-4\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:account-cog\" width=\"28\" class=\"text-black dark:text-white\"></iconify-icon>\n\t\t\t\t\t<span class={currentTab === '2' ? 'text-secondary-500 dark:text-tertiary-500 font-bold' : ''}>Admin</span>\n\t\t\t\t</div>\n\t\t\t</Tabs.Trigger>\n\t\t\t<Tabs.Trigger value=\"3\" class=\"flex-1\">\n\t\t\t\t<div class=\"flex items-center justify-center gap-1 py-4\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:web\" width=\"28\" class=\"text-black dark:text-white\"></iconify-icon>\n\t\t\t\t\t<span class={currentTab === '3' ? 'text-secondary-500 dark:text-tertiary-500 font-bold' : ''}>Website Tokens</span>\n\t\t\t\t</div>\n\t\t\t</Tabs.Trigger>\n\t\t</Tabs.List>\n\n\t\t<Tabs.Content value=\"0\">\n\t\t\t<div class=\"p-4\">\n\t\t\t\t<Permissions roleData={rolesData} {setRoleData} {updateModifiedCount} />\n\t\t\t</div>\n\t\t</Tabs.Content>\n\t\t<Tabs.Content value=\"1\">\n\t\t\t<div class=\"p-4\">\n\t\t\t\t<Roles roleData={rolesData} {setRoleData} {updateModifiedCount} />\n\t\t\t</div>\n\t\t</Tabs.Content>\n\t\t<Tabs.Content value=\"2\">\n\t\t\t<div class=\"p-4\">\n\t\t\t\t<AdminRole roleData={rolesData} {setRoleData} />\n\t\t\t</div>\n\t\t</Tabs.Content>\n\t\t<Tabs.Content value=\"3\">\n\t\t\t<div class=\"p-4\">\n\t\t\t\t<WebsiteTokens />\n\t\t\t</div>\n\t\t</Tabs.Content>\n\t</Tabs>\n</div>\n"],"names":["$$renderer","$.attr","$.escape","filteredPermissions","groups","$.attr_class","$.stringify","$.ensure_array_like","page","$.clsx","m.system_permission","m.system_roles"],"mappings":"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"}