{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../src/routes/config/collectionbuilder/NestedContent/TreeViewNode.svelte","../../../../../../../src/routes/config/collectionbuilder/NestedContent/TreeViewBoard.svelte","../../../../../../../src/routes/config/collectionbuilder/+page.svelte"],"sourcesContent":["<!-- \n@files src/routes/(app)/config/collectionbuilder/NestedContent/TreeViewNode.svelte\n@component\n**Enhanced TreeView Node with improved design and drag & drop support**\n\nFeatures:\t\n- Modern card-like design with depth shadows\n- Smooth animations and transitions\n- Clear visual hierarchy between categories and collections\n- Action buttons with hover states\n- Drag handle with visual feedback\n-->\n\n<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport type { TreeViewItem } from '@shared/utils/treeViewAdapter';\n\timport { screen } from '@shared/stores/screenSizeStore.svelte';\n\t// Tree View\n\n\tinterface Props {\n\t\titem: TreeViewItem & { hasChildren?: boolean };\n\t\tisOpen?: boolean;\n\t\ttoggle?: () => void;\n\t\tonEditCategory: (item: TreeViewItem) => void;\n\t\tonDelete?: (item: TreeViewItem) => void;\n\t\tonDuplicate?: (item: TreeViewItem) => void;\n\t}\n\n\tlet { item, isOpen, toggle, onEditCategory, onDelete, onDuplicate }: Props = $props();\n\n\t// Computed properties\n\tconst name = $derived(item.name || 'Untitled');\n\tconst icon = $derived(item.icon || (item.nodeType === 'category' ? 'bi:folder' : 'bi:collection'));\n\tconst isCategory = $derived(item.nodeType === 'category');\n\n\t// Enhanced styling with better visual hierarchy\n\tconst containerClass = $derived(\n\t\tisCategory\n\t\t\t? 'group w-full min-h-[48px] p-2 sm:p-3 rounded bg-gradient-to-r from-tertiary-500/10 to-tertiary-600/5 border-2 border-tertiary-500/30 flex items-center gap-2 sm:gap-3 mb-2 cursor-pointer hover:border-tertiary-500 hover:shadow-lg hover:from-tertiary-500/20 hover:to-tertiary-600/10 transition-all duration-300 ease-out min-w-0 overflow-hidden'\n\t\t\t: 'group w-full min-h-[48px] p-2 sm:p-3 rounded bg-gradient-to-r from-surface-100 to-surface-50 dark:from-surface-700 dark:to-surface-800 border-2 border-l-4 border-surface-500/40 border-l-surface-500 flex items-center gap-2 sm:gap-3 mb-2 cursor-pointer hover:border-surface-500 hover:shadow-lg hover:translate-x-1 transition-all duration-300 ease-out min-w-0 overflow-hidden'\n\t);\n\n\tconst iconClass = $derived(\n\t\tisCategory\n\t\t\t? 'text-tertiary-500 group-hover:text-tertiary-600 transition-colors duration-200'\n\t\t\t: 'text-error-500 group-hover:text-error-600 transition-colors duration-200'\n\t);\n\n\tfunction handleClick(e: MouseEvent) {\n\t\tif ((e.target as HTMLElement).closest('button')) return;\n\t\ttoggle?.();\n\t}\n</script>\n\n<div\n\tclass={containerClass}\n\tonclick={handleClick}\n\tonkeydown={(e) => e.key === 'Enter' && handleClick(e as unknown as MouseEvent)}\n\trole=\"button\"\n\ttabindex=\"0\"\n>\n\t<!-- Expand/Collapse Toggle -->\n\t{#if item.hasChildren || isCategory}\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"btn-icon preset-tonal hover:preset-filled transition-all duration-200 hover:scale-110\"\n\t\t\tonclick={(e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tconsole.log('Toggle clicked', { toggle, isOpen });\n\t\t\t\ttoggle?.();\n\t\t\t}}\n\t\t\taria-label={isOpen ? 'Collapse' : 'Expand'}\n\t\t>\n\t\t\t<iconify-icon icon={isOpen ? 'bi:chevron-down' : 'bi:chevron-right'} width=\"20\" class=\"transition-transform duration-200\"></iconify-icon>\n\t\t</button>\n\t{:else}\n\t\t<div class=\"w-10\"></div>\n\t{/if}\n\n\t<!-- Icon with Animation -->\n\t<div class=\"relative\">\n\t\t<iconify-icon {icon} width=\"24\" class={iconClass}></iconify-icon>\n\t\t{#if isCategory}\n\t\t\t<div class=\"absolute -top-1 -right-1 w-2 h-2 bg-tertiary-500 rounded-full animate-pulse\"></div>\n\t\t{/if}\n\t</div>\n\n\t<!-- Name & Badge Section -->\n\t<div class=\"flex flex-col gap-1 min-w-0 shrink\">\n\t\t<div class=\"flex items-center gap-1 sm:gap-2 flex-wrap\">\n\t\t\t<span class=\"font-bold text-sm sm:text-base leading-none truncate\">{name}</span>\n\t\t\t{#if isCategory}\n\t\t\t\t<span\n\t\t\t\t\tclass=\"badge font-semibold bg-tertiary-500 text-white text-[9px] sm:text-[10px] px-1.5 sm:px-2.5 py-0.5 sm:py-1 rounded-sm uppercase shadow-sm\"\n\t\t\t\t>\n\t\t\t\t\tCategory\n\t\t\t\t</span>\n\t\t\t{:else}\n\t\t\t\t<span\n\t\t\t\t\tclass=\"badge font-semibold bg-surface-500 text-white text-[9px] sm:text-[10px] px-1.5 sm:px-2.5 py-0.5 sm:py-1 rounded-sm uppercase shadow-sm\"\n\t\t\t\t>\n\t\t\t\t\tCollection\n\t\t\t\t</span>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\n\t<!-- Description with Tooltip - hidden on mobile -->\n\t{#if screen.isDesktop}\n\t\t<div class=\"flex-1 px-4 min-w-0 flex justify-start\">\n\t\t\t{#if item.description}\n\t\t\t\t<div class=\"relative group/desc\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"italic text-sm opacity-70 truncate w-full max-w-[500px] text-left hover:opacity-100 transition-opacity duration-200\"\n\t\t\t\t\t\ttitle={item.description}\n\t\t\t\t\t>\n\t\t\t\t\t\t{item.description}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n\n\t<!-- Slug Badge -->\n\t{#if item.slug}\n\t\t<span class=\"badge bg-surface-200 dark:bg-surface-700 text-surface-900 dark:text-surface-100 px-3 py-1 rounded-sm font-mono text-xs shadow-sm\">\n\t\t\t/{item.slug}\n\t\t</span>\n\t{/if}\n\n\t<!-- Action Buttons with Enhanced Design -->\n\t<div class=\"flex gap-1 sm:gap-2 ml-auto shrink-0 transition-opacity duration-200\">\n\t\t<!-- Edit Button -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"btn-icon preset-tonal hover:preset-filled rounded transition-all duration-200 hover:scale-110\"\n\t\t\tonclick={(e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tif (isCategory) {\n\t\t\t\t\tonEditCategory(item);\n\t\t\t\t} else {\n\t\t\t\t\tgoto(`/config/collectionbuilder/edit/${item.id}`);\n\t\t\t\t}\n\t\t\t}}\n\t\t\ttitle=\"Edit\"\n\t\t>\n\t\t\t<iconify-icon icon=\"mdi:pencil-outline\" width=\"18\" class=\"text-primary-500\"></iconify-icon>\n\t\t</button>\n\n\t\t<!-- Duplicate Button -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"btn-icon preset-tonal hover:preset-filled rounded transition-all duration-200 hover:scale-110\"\n\t\t\tonclick={(e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tonDuplicate?.(item);\n\t\t\t}}\n\t\t\ttitle=\"Duplicate\"\n\t\t>\n\t\t\t<iconify-icon icon=\"mdi:content-copy\" width=\"18\" class=\"text-tertiary-500\"></iconify-icon>\n\t\t</button>\n\n\t\t<!-- Delete Button -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"btn-icon preset-tonal hover:preset-filled rounded transition-all duration-200 hover:scale-110\"\n\t\t\tonclick={(e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tonDelete?.(item);\n\t\t\t}}\n\t\t\ttitle=\"Delete\"\n\t\t>\n\t\t\t<iconify-icon icon=\"lucide:trash-2\" width=\"18\" class=\"text-error-500\"></iconify-icon>\n\t\t</button>\n\n\t\t<!-- Drag Handle with Enhanced Visual -->\n\t\t<div\n\t\t\tclass=\"btn-icon preset-tonal rounded cursor-grab active:cursor-grabbing opacity-60 hover:opacity-100 flex items-center justify-center ml-2 hover:bg-surface-300 dark:hover:bg-surface-600 transition-all duration-200 hover:scale-110\"\n\t\t\taria-hidden=\"true\"\n\t\t\ttitle=\"Drag to reorder\"\n\t\t>\n\t\t\t<iconify-icon icon=\"mdi:drag-vertical\" width=\"22\"></iconify-icon>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t/* Enhance focus states for accessibility */\n\tdiv[role='button']:focus-visible {\n\t\toutline: 3px solid rgb(var(--color-primary-500));\n\t\toutline-offset: 4px;\n\t\tborder-radius: 0.5rem;\n\t}\n\n\t/* Smooth badge animations */\n\t.badge {\n\t\ttransition: all 0.2s ease;\n\t}\n\n\t.group:hover .badge {\n\t\ttransform: translateY(-1px);\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n\t}\n\n\t/* Icon pulse animation for categories */\n\t@keyframes pulse {\n\t\t0%,\n\t\t100% {\n\t\t\topacity: 1;\n\t\t}\n\t\t50% {\n\t\t\topacity: 0.5;\n\t\t}\n\t}\n\n\t/* Action button enhancements */\n\tbutton.btn-icon {\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t}\n\n\tbutton.btn-icon::before {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tinset: 0;\n\t\tbackground: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);\n\t\topacity: 0;\n\t\ttransition: opacity 0.3s ease;\n\t}\n\n\tbutton.btn-icon:hover::before {\n\t\topacity: 1;\n\t}\n\n\t/* Description tooltip enhancement */\n\t.group\\/desc:hover span {\n\t\tz-index: 10;\n\t\tposition: relative;\n\t}\n</style>\n","<!--\n@files src/routes/(app)/config/collectionbuilder/NestedContent/TreeViewBoard.svelte\n@component\n**Board component for managing nested collections using svelte-dnd-action**\n\n### Props\n- `contentNodes` {ContentNode[]} - Array of content nodes representing collections and categories\n- `onNodeUpdate` {Function} - Callback function to handle updates to the content node\n- `onEditCategory` {Function} - Callback function to handle editing of categories\n- `onDeleteNode` {Function} - Callback function to handle node deletion\n- `onDuplicateNode` {Function} - Callback function to handle node duplication\n\n### Features:\n- Drag and drop reordering of collections using svelte-dnd-action\n- Support for nested categories with cross-level drag\n- Search/Filter functionality\n- Expand/Collapse all\n- Enhanced visual feedback for drag & drop\n-->\n<script lang=\"ts\">\n\t// Component\n\timport TreeViewNode from './TreeViewNode.svelte';\n\n\t// DB / Types\n\timport type { ContentNode } from '@shared/database/dbInterface';\n\n\t// Drag and Drop\n\timport { dndzone, TRIGGERS } from 'svelte-dnd-action';\n\timport { flip } from 'svelte/animate';\n\n\t// Adapter\n\timport { toTreeViewData, toFlatContentNodes, recalculatePaths, type TreeViewItem } from '@shared/utils/treeViewAdapter';\n\n\tinterface Props {\n\t\tcontentNodes: ContentNode[];\n\t\tonNodeUpdate: (updatedNodes: ContentNode[]) => void;\n\t\tonEditCategory: (category: Partial<ContentNode>) => void;\n\t\tonDeleteNode?: (node: Partial<ContentNode>) => void;\n\t\tonDuplicateNode?: (node: Partial<ContentNode>) => void;\n\t}\n\n\tlet { contentNodes = [], onNodeUpdate, onEditCategory, onDeleteNode, onDuplicateNode }: Props = $props();\n\n\t// Search state\n\tlet searchText = $state('');\n\n\t// Local state for the tree data - flat structure for dnd-action\n\tlet treeData = $state<TreeViewItem[]>([]);\n\tlet initialized = false;\n\n\t// Expanded nodes tracking\n\tlet expandedNodes = $state<Set<string>>(new Set());\n\n\t// Drag state for visual feedback\n\tlet isDragging = $state(false);\n\n\t$effect(() => {\n\t\tif (contentNodes.length > 0 && (!initialized || treeData.length === 0)) {\n\t\t\ttreeData = toTreeViewData(contentNodes);\n\t\t\tinitialized = true;\n\t\t\t// Auto-expand root level nodes\n\t\t\ttreeData.forEach((item) => {\n\t\t\t\tif (!item.parent) {\n\t\t\t\t\texpandedNodes.add(item.id);\n\t\t\t\t}\n\t\t\t});\n\t\t\texpandedNodes = new Set(expandedNodes);\n\t\t}\n\t});\n\n\t// Filter items based on search\n\tconst filteredItems = $derived.by(() => {\n\t\tif (!searchText.trim()) return treeData;\n\t\tconst searchLower = searchText.toLowerCase();\n\t\treturn treeData.filter((item) => item.name.toLowerCase().includes(searchLower));\n\t});\n\n\t// Build hierarchical structure for rendering\n\ttype EnhancedTreeViewItem = TreeViewItem & { children: EnhancedTreeViewItem[]; level: number };\n\n\tconst hierarchicalData = $derived.by(() => {\n\t\tconst items = filteredItems;\n\t\tconst itemMap = new Map<string, EnhancedTreeViewItem>();\n\n\t\t// First pass: create enhanced items with children arrays\n\t\titems.forEach((item) => {\n\t\t\titemMap.set(item.id, { ...item, children: [], level: 0 });\n\t\t});\n\n\t\t// Second pass: build hierarchy\n\t\tconst roots: EnhancedTreeViewItem[] = [];\n\t\titems.forEach((item) => {\n\t\t\tconst enhanced = itemMap.get(item.id);\n\t\t\tif (!enhanced) return; // Safety check\n\n\t\t\tif (item.parent && itemMap.has(item.parent)) {\n\t\t\t\tconst parent = itemMap.get(item.parent);\n\t\t\t\tif (parent) {\n\t\t\t\t\tparent.children.push(enhanced);\n\t\t\t\t\tenhanced.level = parent.level + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\troots.push(enhanced);\n\t\t\t}\n\t\t});\n\n\t\treturn roots;\n\t});\n\n\t// Get root level items for top-level dnd zone\n\tconst rootItems = $derived(hierarchicalData);\n\n\t// Expand all nodes\n\tfunction expandAll(): void {\n\t\texpandedNodes = new Set(treeData.map((item) => item.id));\n\t}\n\n\t// Collapse all nodes\n\tfunction collapseAll(): void {\n\t\texpandedNodes = new Set();\n\t}\n\n\t// Clear the search\n\tfunction clearSearch(): void {\n\t\tsearchText = '';\n\t}\n\n\t// Toggle node expansion\n\tfunction toggleNode(id: string) {\n\t\tif (expandedNodes.has(id)) {\n\t\t\texpandedNodes.delete(id);\n\t\t} else {\n\t\t\texpandedNodes.add(id);\n\t\t}\n\t\texpandedNodes = new Set(expandedNodes);\n\t}\n\n\t// Handle drag and drop at root level\n\tfunction handleRootDndConsider(e: CustomEvent) {\n\t\tconst { items, info } = e.detail;\n\t\tif (info.trigger === TRIGGERS.DRAG_STARTED) {\n\t\t\tisDragging = true;\n\t\t}\n\t\tupdateRootItems(items);\n\t}\n\n\tfunction handleRootDndFinalize(e: CustomEvent) {\n\t\tconst { items } = e.detail;\n\t\tisDragging = false;\n\n\t\t// Update items with null parent (root level)\n\t\tconst updatedItems = items.map((item: EnhancedTreeViewItem) => ({\n\t\t\t...item,\n\t\t\tparent: null\n\t\t}));\n\n\t\tupdateRootItems(updatedItems);\n\t\tsaveTreeData();\n\t}\n\n\tfunction updateRootItems(newItems: EnhancedTreeViewItem[]) {\n\t\t// Get IDs of items now at root level\n\t\tconst newRootIds = new Set(newItems.map((item) => item.id));\n\n\t\t// For each item that moved TO root, we need to keep its descendants\n\t\t// For items that moved AWAY from root, they'll be handled by the nested zone\n\n\t\t// Start with items that are NOT in the new root list AND not descendants of moved items\n\t\tconst itemsToKeep: TreeViewItem[] = [];\n\t\tconst processedIds = new Set<string>();\n\n\t\t// First, add all new root items with updated parent\n\t\tnewItems.forEach((item, index) => {\n\t\t\titemsToKeep.push({\n\t\t\t\t...stripEnhanced(item),\n\t\t\t\tparent: null,\n\t\t\t\torder: index\n\t\t\t});\n\t\t\tprocessedIds.add(item.id);\n\n\t\t\t// Also add all descendants of this item (they keep their relative parent refs)\n\t\t\tconst descendants = getAllDescendants(item.id, treeData);\n\t\t\tdescendants.forEach((desc) => {\n\t\t\t\tif (!processedIds.has(desc.id)) {\n\t\t\t\t\titemsToKeep.push(desc);\n\t\t\t\t\tprocessedIds.add(desc.id);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Add remaining items that weren't processed (items still in nested zones)\n\t\ttreeData.forEach((item) => {\n\t\t\tif (!processedIds.has(item.id) && !newRootIds.has(item.id)) {\n\t\t\t\t// Check if this item's parent is still valid\n\t\t\t\tconst parentStillExists = itemsToKeep.some((i) => i.id === item.parent);\n\t\t\t\tif (parentStillExists || item.parent === null) {\n\t\t\t\t\titemsToKeep.push(item);\n\t\t\t\t\tprocessedIds.add(item.id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\ttreeData = recalculatePaths(itemsToKeep);\n\t}\n\n\t// Handle drag and drop at nested level\n\tfunction handleNestedDndConsider(e: CustomEvent, parentId: string) {\n\t\tconst { items, info } = e.detail;\n\t\tif (info.trigger === TRIGGERS.DRAG_STARTED) {\n\t\t\tisDragging = true;\n\t\t}\n\t\tupdateItemsAtLevel(items, parentId);\n\t}\n\n\tfunction handleNestedDndFinalize(e: CustomEvent, parentId: string) {\n\t\tconst { items } = e.detail;\n\t\tisDragging = false;\n\t\tupdateItemsAtLevel(items, parentId);\n\t\tsaveTreeData();\n\t}\n\n\tfunction updateItemsAtLevel(newItems: EnhancedTreeViewItem[], parentId: string) {\n\t\t// Get IDs of items now at this level\n\t\tconst newChildIds = new Set(newItems.map((item) => item.id));\n\n\t\tconst itemsToKeep: TreeViewItem[] = [];\n\t\tconst processedIds = new Set<string>();\n\n\t\t// Add items at this level with updated parent reference\n\t\tnewItems.forEach((item, index) => {\n\t\t\titemsToKeep.push({\n\t\t\t\t...stripEnhanced(item),\n\t\t\t\tparent: parentId,\n\t\t\t\torder: index\n\t\t\t});\n\t\t\tprocessedIds.add(item.id);\n\n\t\t\t// Also add all descendants of this item (they keep their relative parent refs)\n\t\t\tconst descendants = getAllDescendants(item.id, treeData);\n\t\t\tdescendants.forEach((desc) => {\n\t\t\t\tif (!processedIds.has(desc.id)) {\n\t\t\t\t\titemsToKeep.push(desc);\n\t\t\t\t\tprocessedIds.add(desc.id);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Add all other items that weren't affected\n\t\ttreeData.forEach((item) => {\n\t\t\tif (!processedIds.has(item.id) && !newChildIds.has(item.id) && item.parent !== parentId) {\n\t\t\t\titemsToKeep.push(item);\n\t\t\t\tprocessedIds.add(item.id);\n\t\t\t}\n\t\t});\n\n\t\t// Also add items that are still children of this parent but not in newItems\n\t\t// (they were removed from this zone, handled elsewhere)\n\n\t\ttreeData = recalculatePaths(itemsToKeep);\n\t}\n\n\t// Helper: Get all descendants of an item\n\tfunction getAllDescendants(itemId: string, items: TreeViewItem[]): TreeViewItem[] {\n\t\tconst descendants: TreeViewItem[] = [];\n\t\tconst directChildren = items.filter((item) => item.parent === itemId);\n\n\t\tdirectChildren.forEach((child) => {\n\t\t\tdescendants.push(child);\n\t\t\tdescendants.push(...getAllDescendants(child.id, items));\n\t\t});\n\n\t\treturn descendants;\n\t}\n\n\t// Helper: Strip enhanced properties from item\n\tfunction stripEnhanced(item: EnhancedTreeViewItem): TreeViewItem {\n\t\tconst { children, level, ...base } = item;\n\t\treturn base;\n\t}\n\n\tfunction saveTreeData() {\n\t\t// Convert back to ContentNodes and notify parent\n\t\tconst contentNodes = toFlatContentNodes(treeData);\n\n\t\t// Defer update to prevent synchronous state update loop\n\t\tsetTimeout(() => {\n\t\t\tonNodeUpdate(contentNodes);\n\t\t}, 50);\n\t}\n\n\t// Helper to convert EnhancedTreeViewItem to Partial<ContentNode> for callbacks\n\tfunction toPartialContentNode(item: TreeViewItem | EnhancedTreeViewItem): Partial<ContentNode> {\n\t\t// Extract only the properties needed for ContentNode\n\t\tconst { children, level, parent, path, ...contentNodeProps } = item as any;\n\t\treturn {\n\t\t\t...contentNodeProps,\n\t\t\t_id: item._id || item.id,\n\t\t\tparentId: parent\n\t\t};\n\t}\n\n\t// Flip animation duration\n\tconst flipDurationMs = 300;\n</script>\n\n<!-- Toolbar -->\n<div class=\"mb-4 flex flex-wrap items-center gap-2\">\n\t<!-- Search Input -->\n\t<div class=\"relative flex-1 min-w-[200px]\">\n\t\t<iconify-icon icon=\"mdi:magnify\" width=\"18\" class=\"absolute left-3 top-1/2 -translate-y-1/2 opacity-50\"></iconify-icon>\n\t\t<input type=\"text\" placeholder=\"Search collections...\" bind:value={searchText} class=\"input w-full h-12 pl-10 pr-8 rounded shadow-sm\" />\n\t\t{#if searchText}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tonclick={clearSearch}\n\t\t\t\tclass=\"absolute right-2 top-1/2 -translate-y-1/2 btn-icon preset-tonal hover:preset-filled transition-all\"\n\t\t\t\taria-label=\"Clear search\"\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"mdi:close\" width=\"16\"></iconify-icon>\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n\n\t<!-- Expand/Collapse Buttons -->\n\t<div class=\"flex gap-2\">\n\t\t<button type=\"button\" onclick={expandAll} class=\"btn preset-tonal hover:preset-filled transition-all shadow-sm\" title=\"Expand All\">\n\t\t\t<iconify-icon icon=\"mdi:unfold-more-horizontal\" width=\"18\"></iconify-icon>\n\t\t\t<span class=\"hidden sm:inline ml-1\">Expand All</span>\n\t\t</button>\n\t\t<button type=\"button\" onclick={collapseAll} class=\"btn preset-tonal hover:preset-filled transition-all shadow-sm\" title=\"Collapse All\">\n\t\t\t<iconify-icon icon=\"mdi:unfold-less-horizontal\" width=\"18\"></iconify-icon>\n\t\t\t<span class=\"hidden sm:inline ml-1\">Collapse All</span>\n\t\t</button>\n\t</div>\n</div>\n\n<!-- Tree View with Drag and Drop -->\n<div class=\"collection-builder-tree relative w-full h-auto overflow-y-auto rounded p-2\">\n\t{#if hierarchicalData.length === 0}\n\t\t<div class=\"text-center p-8 text-surface-500\">\n\t\t\t{#if searchText}\n\t\t\t\t<iconify-icon icon=\"mdi:magnify-close\" width=\"48\" class=\"opacity-50 mb-2\"></iconify-icon>\n\t\t\t\t<p>No results found for \"{searchText}\"</p>\n\t\t\t{:else}\n\t\t\t\t<iconify-icon icon=\"mdi:folder-open-outline\" width=\"48\" class=\"opacity-50 mb-2\"></iconify-icon>\n\t\t\t\t<p>No categories or collections yet</p>\n\t\t\t{/if}\n\t\t</div>\n\t{:else}\n\t\t<!-- Root Level DnD Zone -->\n\t\t<div\n\t\t\tclass=\"root-dnd-zone\"\n\t\t\tuse:dndzone={{\n\t\t\t\titems: rootItems,\n\t\t\t\tflipDurationMs,\n\t\t\t\ttype: 'tree-items',\n\t\t\t\tdropFromOthersDisabled: false,\n\t\t\t\tdropTargetStyle: {}\n\t\t\t}}\n\t\t\tonconsider={handleRootDndConsider}\n\t\t\tonfinalize={handleRootDndFinalize}\n\t\t>\n\t\t\t{#each rootItems as item (item.id)}\n\t\t\t\t<div class=\"tree-node-wrapper\" animate:flip={{ duration: flipDurationMs }}>\n\t\t\t\t\t{@render treeNode(item, 0)}\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n\n\t<!-- Drop to Root Zone (visible during drag) -->\n\t{#if isDragging}\n\t\t<div class=\"drop-to-root-zone\">\n\t\t\t<iconify-icon icon=\"mdi:arrow-up\" width=\"20\"></iconify-icon>\n\t\t\t<span>Drop here to move to root level</span>\n\t\t</div>\n\t{/if}\n</div>\n\n<!-- Recursive Tree Node Renderer -->\n{#snippet treeNode(item: EnhancedTreeViewItem, level: number)}\n\t<div class=\"tree-node-container\" style=\"margin-left: {level * 0.75}rem\">\n\t\t<!-- Render the node -->\n\t\t<TreeViewNode\n\t\t\titem={{ ...item, hasChildren: item.children && item.children.length > 0 }}\n\t\t\tisOpen={expandedNodes.has(item.id)}\n\t\t\ttoggle={() => toggleNode(item.id)}\n\t\t\tonEditCategory={() => onEditCategory(toPartialContentNode(item))}\n\t\t\tonDelete={() => onDeleteNode?.(toPartialContentNode(item))}\n\t\t\tonDuplicate={() => onDuplicateNode?.(toPartialContentNode(item))}\n\t\t/>\n\n\t\t<!-- Render children if expanded and has children -->\n\t\t{#if expandedNodes.has(item.id) && item.children && item.children.length > 0}\n\t\t\t<div\n\t\t\t\tclass=\"tree-children\"\n\t\t\t\tuse:dndzone={{\n\t\t\t\t\titems: item.children,\n\t\t\t\t\tflipDurationMs,\n\t\t\t\t\ttype: 'tree-items',\n\t\t\t\t\tdropFromOthersDisabled: false,\n\t\t\t\t\tdropTargetStyle: {}\n\t\t\t\t}}\n\t\t\t\tonconsider={(e) => handleNestedDndConsider(e, item.id)}\n\t\t\t\tonfinalize={(e) => handleNestedDndFinalize(e, item.id)}\n\t\t\t>\n\t\t\t\t{#each item.children as child (child.id)}\n\t\t\t\t\t<div class=\"tree-node-wrapper\" animate:flip={{ duration: flipDurationMs }}>\n\t\t\t\t\t\t{@render treeNode(child, level + 1)}\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{:else if expandedNodes.has(item.id) && item.nodeType === 'category'}\n\t\t\t<!-- Empty drop zone for categories with no children -->\n\t\t\t<div\n\t\t\t\tclass=\"tree-children empty-drop-zone\"\n\t\t\t\tuse:dndzone={{\n\t\t\t\t\titems: [],\n\t\t\t\t\tflipDurationMs,\n\t\t\t\t\ttype: 'tree-items',\n\t\t\t\t\tdropFromOthersDisabled: false,\n\t\t\t\t\tdropTargetStyle: {}\n\t\t\t\t}}\n\t\t\t\tonconsider={(e) => handleNestedDndConsider(e, item.id)}\n\t\t\t\tonfinalize={(e) => handleNestedDndFinalize(e, item.id)}\n\t\t\t>\n\t\t\t\t<span class=\"empty-hint\">Drop items here</span>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n{/snippet}\n\n<style>\n\t/* Base Tree Styling */\n\t.collection-builder-tree {\n\t\tbackground: transparent;\n\t\tcolor: inherit;\n\t\tfont-family: inherit;\n\t\tpadding: 0.5rem;\n\t\tmin-height: 200px;\n\t}\n\n\t/* Root DnD Zone */\n\t.root-dnd-zone {\n\t\tmin-height: 100px;\n\t}\n\n\t/* Tree Node Wrapper for animations */\n\t.tree-node-wrapper {\n\t\tmargin-bottom: 0.5rem;\n\t}\n\n\t/* Tree Node Container */\n\t.tree-node-container {\n\t\ttransition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n\t\tposition: relative;\n\t}\n\n\t/* Tree Children Container */\n\t.tree-children {\n\t\tpadding-left: 0.5rem;\n\t\tborder-left: 2px solid rgb(var(--color-surface-300));\n\t\tmargin-left: 0.5rem;\n\t\tmargin-top: 0.5rem;\n\t\tmin-height: 40px;\n\t\ttransition: all 0.2s ease;\n\t}\n\n\t.tree-children.empty-drop-zone {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tborder: 2px dashed rgb(var(--color-surface-300));\n\t\tborder-left: 2px solid rgb(var(--color-surface-300));\n\t\tborder-radius: 4px;\n\t\tbackground: rgb(var(--color-surface-50) / 0.3);\n\t}\n\n\t.empty-hint {\n\t\tcolor: rgb(var(--color-surface-500));\n\t\tfont-size: 0.85rem;\n\t\tfont-style: italic;\n\t}\n\n\t/* Drop to Root Zone */\n\t.drop-to-root-zone {\n\t\tmargin-top: 1rem;\n\t\tpadding: 1rem;\n\t\tborder: 2px dashed rgb(var(--color-primary-500));\n\t\tborder-radius: 8px;\n\t\tbackground: rgb(var(--color-primary-500) / 0.1);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 0.5rem;\n\t\tcolor: rgb(var(--color-primary-500));\n\t\tfont-weight: 500;\n\t\tanimation: pulse-border 1.5s ease-in-out infinite;\n\t}\n\n\t@keyframes pulse-border {\n\t\t0%,\n\t\t100% {\n\t\t\tborder-color: rgb(var(--color-primary-500));\n\t\t}\n\t\t50% {\n\t\t\tborder-color: rgb(var(--color-primary-300));\n\t\t}\n\t}\n\n\t/* Dragging State - Applied by svelte-dnd-action */\n\t:global(.tree-node-wrapper[aria-grabbed='true']) {\n\t\topacity: 0.5;\n\t\ttransform: scale(0.98);\n\t}\n\n\t/* Drop target visual feedback */\n\t:global(.tree-children:has([aria-grabbed='true'])) {\n\t\tbackground: rgb(var(--color-primary-500) / 0.05);\n\t\tborder-left-color: rgb(var(--color-primary-500));\n\t}\n\n\t/* Hover Effects */\n\t.tree-node-container:hover {\n\t\ttransform: translateX(2px);\n\t}\n\n\t/* Smooth Scrollbar */\n\t.collection-builder-tree {\n\t\tscrollbar-width: thin;\n\t\tscrollbar-color: rgb(var(--color-surface-400)) transparent;\n\t}\n\n\t.collection-builder-tree::-webkit-scrollbar {\n\t\twidth: 8px;\n\t}\n\n\t.collection-builder-tree::-webkit-scrollbar-track {\n\t\tbackground: transparent;\n\t}\n\n\t.collection-builder-tree::-webkit-scrollbar-thumb {\n\t\tbackground: rgb(var(--color-surface-400));\n\t\tborder-radius: 4px;\n\t}\n\n\t.collection-builder-tree::-webkit-scrollbar-thumb:hover {\n\t\tbackground: rgb(var(--color-surface-500));\n\t}\n</style>\n","<!--\n @file src/routes/(app)/config/collection/+page.svelte\n @component\n **This component sets up and displays the collection page with nested category support**\n\n### Props:\n - `collection` {object} - Collection object\n\n ### Features:\n - Collection Name\n - Collection Icon\n - Collection Description\n - Collection Status\n - Collection Slug\n - Collection Description\n - Collection Permissions\n - Collection Fields\n - Collection Categories\n-->\n\n<script lang=\"ts\">\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/state';\n\t// Simple ID generator (no need for crypto UUID)\n\tfunction generateId(): string {\n\t\treturn Math.random().toString(36).substring(2, 15) + Date.now().toString(36);\n\t}\n\n\t// Logger\n\timport { logger } from '@shared/utils/logger';\n\n\t// Stores\n\timport { setCollectionValue, setMode, setContentStructure, contentStructure } from '@shared/stores/collectionStore.svelte';\n\timport { setRouteContext, ui } from '@shared/stores/UIStore.svelte';\n\timport { screen } from '@shared/stores/screenSizeStore.svelte';\n\n\t// Components\n\timport PageTitle from '@cms/components/PageTitle.svelte';\n\timport TreeViewBoard from './NestedContent/TreeViewBoard.svelte';\n\timport ModalCategory from './NestedContent/ModalCategory.svelte';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Skeleton\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport type { ContentNode, DatabaseId } from '@shared/database/dbInterface';\n\timport type { ISODateString } from '@cms-types';\n\n\tinterface NodeOperation {\n\t\ttype: 'create' | 'update' | 'move' | 'rename';\n\t\tnode: ContentNode;\n\t}\n\n\tinterface CategoryModalResponse {\n\t\tnewCategoryName: string;\n\t\tnewCategoryIcon: string;\n\t}\n\n\tinterface ApiResponse {\n\t\terror?: string;\n\t\tsuccess?: boolean;\n\t\tcontentStructure?: ContentNode[];\n\t\t[key: string]: any; // Allows for success, contentStructure, message\n\t}\n\n\tinterface CollectionBuilderProps {\n\t\tdata: { contentStructure: ContentNode[] };\n\t}\n\n\tconst { data }: CollectionBuilderProps = $props();\n\n\t// `currentConfig` holds the live, mutable state of the content structure for the UI.\n\t// It's initialized from `data.contentStructure` and updated by DnD operations.\n\tlet currentConfig: ContentNode[] = $state([]);\n\t// `nodesToSave` stores operations (create, update, move, rename) that need to be persisted to the backend.\n\tlet nodesToSave: Record<string, NodeOperation> = $state({});\n\n\t$effect(() => {\n\t\tif (data.contentStructure) {\n\t\t\tcurrentConfig = data.contentStructure;\n\t\t}\n\t});\n\n\t// State for UI feedback\n\tlet isLoading = $state(false);\n\tlet apiError: string | null = $state(null);\n\n\t/**\n\t * Opens the modal for adding or editing a category.\n\t * @param existingCategory Optional Partial<DndItem> if editing an existing category.\n\t */\n\tfunction modalAddCategory(existingCategory?: Partial<ContentNode>): void {\n\t\tmodalState.trigger(\n\t\t\tModalCategory as any,\n\t\t\t{\n\t\t\t\texistingCategory: existingCategory as ContentNode | undefined,\n\t\t\t\ttitle: existingCategory ? 'Edit Category' : 'Add New Category',\n\t\t\t\tbody: existingCategory ? 'Modify Category Details' : 'Enter Unique Name and an Icon for your new category column'\n\t\t\t},\n\t\t\tasync (response: CategoryModalResponse | boolean) => {\n\t\t\t\tif (!response || typeof response === 'boolean') return;\n\n\t\t\t\ttry {\n\t\t\t\t\tif (existingCategory && existingCategory._id) {\n\t\t\t\t\t\tupdateExistingCategory(existingCategory as ContentNode, response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddNewCategory(response);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.error('Error handling category modal response:', error);\n\t\t\t\t\ttoaster.error({ description: 'Error updating categories' });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * Updates an existing category in `currentConfig` and marks it for saving.\n\t * @param existingCategory The original category node.\n\t * @param response The new data from the modal.\n\t */\n\tfunction updateExistingCategory(existingCategory: ContentNode, response: CategoryModalResponse): void {\n\t\tconst updatedCategory: ContentNode = {\n\t\t\t...existingCategory,\n\t\t\tname: response.newCategoryName,\n\t\t\ticon: response.newCategoryIcon,\n\t\t\tupdatedAt: new Date().toISOString() as ISODateString\n\t\t};\n\n\t\t// Update currentConfig immutably to trigger Svelte's reactivity\n\t\tcurrentConfig = currentConfig.map((node) => (node._id === updatedCategory._id ? updatedCategory : node));\n\n\t\t// Prepare operation for saving\n\t\tif (existingCategory.name !== updatedCategory.name) {\n\t\t\tnodesToSave[updatedCategory._id] = {\n\t\t\t\ttype: 'rename', // 'rename' specifically implies name change\n\t\t\t\tnode: updatedCategory\n\t\t\t};\n\t\t} else {\n\t\t\tnodesToSave[updatedCategory._id] = {\n\t\t\t\ttype: 'update', // 'update' for icon or other property changes\n\t\t\t\tnode: updatedCategory\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Adds a new category to `currentConfig` and marks it for saving.\n\t * @param response The data for the new category from the modal.\n\t */\n\tfunction addNewCategory(response: CategoryModalResponse): void {\n\t\tconst newCategoryId = generateId() as DatabaseId;\n\n\t\tconst newCategory: ContentNode = {\n\t\t\t_id: newCategoryId,\n\t\t\tname: response.newCategoryName,\n\t\t\ticon: response.newCategoryIcon,\n\t\t\torder: currentConfig.length, // Assign an initial order (can be refined later by DnD)\n\t\t\ttranslations: [], // Initialize empty, assuming structure doesn't manage translations directly\n\t\t\tupdatedAt: new Date().toISOString() as ISODateString,\n\t\t\tcreatedAt: new Date().toISOString() as ISODateString,\n\t\t\tparentId: undefined, // New categories are top-level by default\n\t\t\tnodeType: 'category'\n\t\t};\n\n\t\tcurrentConfig = [...currentConfig, newCategory]; // Add to current config\n\t\tnodesToSave[newCategory._id] = {\n\t\t\ttype: 'create',\n\t\t\tnode: newCategory\n\t\t};\n\t}\n\n\t/**\n\t * Callback from Board.svelte when nodes are reordered or moved between parents.\n\t * This updates the `currentConfig` and stages nodes for saving.\n\t * @param updatedNodes The complete, flattened list of ContentNodes after a DnD operation, with updated `parentId` and `order`.\n\t */\n\tfunction handleNodeUpdate(updatedNodes: ContentNode[]) {\n\t\tconsole.debug('Page: handleNodeUpdate received', updatedNodes);\n\t\t// Update the local `currentConfig` to reflect the UI state\n\t\tcurrentConfig = updatedNodes;\n\n\t\t// Mark all updated nodes as 'move' operations for saving.\n\t\t// The `contentManager` should handle 'move' operations by updating `parentId` and `order`.\n\t\tupdatedNodes.forEach((node) => {\n\t\t\tnodesToSave[node._id] = {\n\t\t\t\ttype: 'move',\n\t\t\t\tnode: node\n\t\t\t};\n\t\t});\n\t\tconsole.debug('Nodes to save (after move):', nodesToSave);\n\t}\n\n\t// Handles saving all pending changes (`nodesToSave`) to the backend.\n\tasync function handleSave() {\n\t\tconst items = Object.values(nodesToSave);\n\t\tif (items.length === 0) {\n\t\t\ttoaster.info({ description: 'No changes to save.' });\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tisLoading = true;\n\t\t\tconst response = await fetch('/api/content-structure', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\taction: 'updateContentStructure',\n\t\t\t\t\titems\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tconst result: ApiResponse = await response.json();\n\n\t\t\tif (response.ok && result.success) {\n\t\t\t\ttoaster.success({ description: 'Categories and Collections updated successfully' });\n\t\t\t\t// Clear pending saves after successful API call\n\t\t\t\tnodesToSave = {};\n\t\t\t\t// Re-sync `currentConfig` with the *actual* structure returned by the server\n\t\t\t\t// This is crucial for consistency, especially after complex reorders.\n\t\t\t\tif (result.contentStructure) {\n\t\t\t\t\tsetContentStructure(result.contentStructure);\n\t\t\t\t\tcurrentConfig = result.contentStructure;\n\t\t\t\t}\n\t\t\t\tconsole.debug('API save successful. New contentStructure:', result.contentStructure);\n\t\t\t} else {\n\t\t\t\t// Revert currentConfig to the last known good state if save fails\n\t\t\t\tcurrentConfig = contentStructure.value; // Revert to the state from the store\n\t\t\t\tthrow new Error(result.error || 'Failed to update categories');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error('Error saving categories:', error);\n\t\t\ttoaster.error({ description: error instanceof Error ? error.message : 'Failed to save categories' });\n\t\t\tapiError = error instanceof Error ? error.message : 'Unknown error occurred';\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\tfunction handleAddCollectionClick(): void {\n\t\tsetMode('create');\n\t\tsetCollectionValue({\n\t\t\tname: 'new',\n\t\t\ticon: '',\n\t\t\tdescription: '',\n\t\t\tstatus: 'unpublished',\n\t\t\tslug: '',\n\t\t\tfields: []\n\t\t});\n\t\tgoto('/config/collectionbuilder/new');\n\t}\n\n\t$effect(() => {\n\t\tif (!ui.routeContext.isCollectionBuilder) {\n\t\t\tsetRouteContext({ isCollectionBuilder: true });\n\t\t}\n\t\treturn () => {\n\t\t\tif (!page.url.pathname.includes('/config/collectionbuilder')) {\n\t\t\t\tsetRouteContext({ isCollectionBuilder: false });\n\t\t\t}\n\t\t};\n\t});\n</script>\n\n<PageTitle name={m.collection_pagetitle()} icon=\"fluent-mdl2:build-definition\" showBackButton={true} backUrl=\"/config\">\n\t<!-- Desktop action buttons - hidden on mobile/tablet -->\n\t{#snippet children()}\n\t\t{#if screen.isDesktop}\n\t\t\t<!-- Add Category Button -->\n\t\t\t<button\n\t\t\t\tonclick={() => modalAddCategory()}\n\t\t\t\ttype=\"button\"\n\t\t\t\taria-label=\"Add New Category\"\n\t\t\t\tclass=\"preset-filled-tertiary-500 btn flex w-auto min-w-[140px] items-center justify-center gap-1\"\n\t\t\t\tdisabled={isLoading}\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"bi:collection\" width=\"18\" class=\"text-white\"></iconify-icon>\n\t\t\t\t<span>{m.collection_addcategory()}</span>\n\t\t\t</button>\n\n\t\t\t<!-- Add Collection Button -->\n\t\t\t<button\n\t\t\t\tonclick={handleAddCollectionClick}\n\t\t\t\ttype=\"button\"\n\t\t\t\taria-label=\"Add New Collection\"\n\t\t\t\tclass=\"preset-filled-surface-500 btn flex w-auto min-w-[140px] items-center justify-center gap-1 rounded font-bold\"\n\t\t\t\tdisabled={isLoading}\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"material-symbols:category\" width=\"18\"></iconify-icon>\n\t\t\t\t<span>{m.collection_add()}</span>\n\t\t\t</button>\n\n\t\t\t<!-- Save Button -->\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tonclick={handleSave}\n\t\t\t\taria-label=\"Save\"\n\t\t\t\tclass=\"preset-filled-primary-500 btn flex w-auto min-w-[140px] items-center justify-center gap-1\"\n\t\t\t\tdisabled={isLoading}\n\t\t\t>\n\t\t\t\t{#if isLoading}\n\t\t\t\t\t<iconify-icon icon=\"eos-icons:loading\" width=\"24\" class=\"animate-spin text-white\"></iconify-icon>\n\t\t\t\t{:else}\n\t\t\t\t\t<iconify-icon icon=\"material-symbols:save\" width=\"24\" class=\"text-white\"></iconify-icon>\n\t\t\t\t{/if}\n\t\t\t\t<span>{m.button_save()}</span>\n\t\t\t</button>\n\t\t{/if}\n\t{/snippet}\n</PageTitle>\n\n<!-- Mobile/Tablet action buttons (shown below title, horizontal row, equal width) -->\n{#if !screen.isDesktop}\n\t<div class=\"flex gap-2 mb-2 px-2\">\n\t\t<button\n\t\t\tonclick={() => modalAddCategory()}\n\t\t\ttype=\"button\"\n\t\t\taria-label=\"Add New Category\"\n\t\t\tclass=\"preset-filled-tertiary-500 btn flex flex-1 items-center justify-center gap-1\"\n\t\t\tdisabled={isLoading}\n\t\t>\n\t\t\t<iconify-icon icon=\"bi:collection\" width=\"18\" class=\"text-white\"></iconify-icon>\n\t\t\t<span>{m.collection_addcategory()}</span>\n\t\t</button>\n\n\t\t<button\n\t\t\tonclick={handleAddCollectionClick}\n\t\t\ttype=\"button\"\n\t\t\taria-label=\"Add New Collection\"\n\t\t\tclass=\"preset-filled-surface-500 btn flex flex-1 items-center justify-center gap-1 rounded font-bold\"\n\t\t\tdisabled={isLoading}\n\t\t>\n\t\t\t<iconify-icon icon=\"material-symbols:category\" width=\"18\"></iconify-icon>\n\t\t\t<span>{m.collection_add()}</span>\n\t\t</button>\n\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonclick={handleSave}\n\t\t\taria-label=\"Save\"\n\t\t\tclass=\"preset-filled-primary-500 btn flex flex-1 items-center justify-center gap-1\"\n\t\t\tdisabled={isLoading}\n\t\t>\n\t\t\t{#if isLoading}\n\t\t\t\t<iconify-icon icon=\"eos-icons:loading\" width=\"24\" class=\"animate-spin text-white\"></iconify-icon>\n\t\t\t{:else}\n\t\t\t\t<iconify-icon icon=\"material-symbols:save\" width=\"24\" class=\"text-white\"></iconify-icon>\n\t\t\t{/if}\n\t\t\t<span>{m.button_save()}</span>\n\t\t</button>\n\t</div>\n{/if}\n\n{#if apiError}\n\t<div class=\"mb-4 rounded bg-error-500/10 p-4 text-error-500\" role=\"alert\">\n\t\t{apiError}\n\t</div>\n{/if}\n\n<div class=\"max-h-[calc(100vh-65px)] overflow-auto\">\n\t<div class=\"wrapper mb-2\">\n\t\t<p class=\"mb-4 text-center dark:text-primary-500\">\n\t\t\t{m.collection_description()}\n\t\t</p>\n\n\t\t<TreeViewBoard contentNodes={currentConfig ?? []} onNodeUpdate={handleNodeUpdate} onEditCategory={modalAddCategory} />\n\t</div>\n</div>\n"],"names":["$$renderer","$.attr","$.escape","$.attr_style","$.stringify","$.ensure_array_like","m.collection_addcategory","m.collection_add","m.button_save","m.collection_pagetitle","m.collection_description"],"mappings":"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"}