{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/modules/root-context.js","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/circle-range.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/circle-track.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/circle.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/label.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/range.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/root-context.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/root-provider.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/modules/provider.svelte.js","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/root.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/track.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/anatomy/value-text.svelte","../../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/progress/modules/anatomy.js","../../../../../../../../../shared/utils/src/entryActionsMessages.ts","../../../../../../../../../shared/utils/src/entryActions.ts","../../../../../../../../../shared/utils/src/navigationUtils.ts","../../../../../../../../../shared/components/src/system/table/Status.svelte","../../../../../../../../../shared/components/src/collectionDisplay/EntryList_MultiButton.svelte","../../../../../../../../../shared/components/src/collectionDisplay/TranslationStatus.svelte","../../../../../../../../../shared/components/src/collectionDisplay/EntryList.svelte","../../../../../../../../../shared/components/src/collectionDisplay/WidgetLoader.svelte","../../../../../../../../../shared/components/src/collectionDisplay/Fields.svelte","../../../../../../../src/routes/[language]/[...collection]/+page.svelte"],"sourcesContent":["import { createContext } from '../../../internal/create-context.js';\nexport const RootContext = createContext();\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface ProgressCircleRangeProps extends PropsWithElement<'circle'>, HTMLAttributes<'circle', 'children'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressCircleRangeProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { element, ...rest } = $derived(props);\n\n\tconst attributes = $derived(\n\t\tmergeProps(\n\t\t\tprogress().getCircleRangeProps(),\n\t\t\t{\n\t\t\t\t'stroke-linecap': 'round',\n\t\t\t},\n\t\t\trest,\n\t\t),\n\t);\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<circle {...attributes} />\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface ProgressCircleTrackProps extends PropsWithElement<'circle'>, HTMLAttributes<'circle', 'children'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressCircleTrackProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { element, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(progress().getCircleTrackProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<circle {...attributes} />\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface ProgressCircleProps extends PropsWithElement<'svg'>, HTMLAttributes<'svg'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressCircleProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(progress().getCircleProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<svg {...attributes}>\n\t\t{@render children?.()}\n\t</svg>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface ProgressLabelProps extends PropsWithElement<'div'>, HTMLAttributes<'div'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressLabelProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(progress().getLabelProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface ProgressRangeProps extends PropsWithElement<'div'>, HTMLAttributes<'div'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressRangeProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(progress().getRangeProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { useProgress } from '../modules/provider.svelte';\n\timport type { Snippet } from 'svelte';\n\n\texport interface ProgressRootContextProps {\n\t\tchildren: Snippet<[ReturnType<typeof useProgress>]>;\n\t}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\n\tconst props: ProgressRootContextProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { children } = $derived(props);\n</script>\n\n{@render children(progress)}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport type { useProgress } from '../modules/provider.svelte';\n\n\texport interface ProgressRootProviderProps extends PropsWithElement<'div'>, HTMLAttributes<'div', 'id' | 'dir'> {\n\t\tvalue: ReturnType<typeof useProgress>;\n\t}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressRootProviderProps = $props();\n\n\tconst { element, children, value: avatar, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(avatar().getRootProps(), rest));\n\n\tRootContext.provide(() => avatar());\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","import { connect, machine } from '@zag-js/progress';\nimport { normalizeProps, useMachine } from '@zag-js/svelte';\nexport function useProgress(props) {\n    const service = useMachine(machine, props);\n    const progress = $derived(connect(service, normalizeProps));\n    return () => progress;\n}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport type { Props } from '@zag-js/progress';\n\n\texport interface ProgressRootProps extends Omit<Props, 'id'>, PropsWithElement<'div'>, HTMLAttributes<'div', 'id' | 'dir'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { useProgress } from '../modules/provider.svelte';\n\timport { RootContext } from '../modules/root-context.js';\n\timport { splitProps } from '@zag-js/progress';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressRootProps = $props();\n\n\tconst [progressProps, componentProps] = $derived(splitProps(props));\n\tconst { element, children, ...rest } = $derived(componentProps);\n\n\tconst id = $props.id();\n\tconst avatar = useProgress(() => ({\n\t\t...progressProps,\n\t\tid: id,\n\t}));\n\n\tconst attributes = $derived(mergeProps(avatar().getRootProps(), rest));\n\n\tRootContext.provide(() => avatar());\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface ProgressTrackProps extends PropsWithElement<'div'>, HTMLAttributes<'div'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressTrackProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(progress().getTrackProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface ProgressValueTextProps extends PropsWithElement<'span'>, HTMLAttributes<'span'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: ProgressValueTextProps = $props();\n\n\tconst progress = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(progress().getValueTextProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<span {...attributes}>\n\t\t{#if children}\n\t\t\t{@render children?.()}\n\t\t{:else}\n\t\t\t{progress().percentAsString}\n\t\t{/if}\n\t</span>\n{/if}\n","import CircleRange from '../anatomy/circle-range.svelte';\nimport CircleTrack from '../anatomy/circle-track.svelte';\nimport Circle from '../anatomy/circle.svelte';\nimport Label from '../anatomy/label.svelte';\nimport Range from '../anatomy/range.svelte';\nimport RootContext from '../anatomy/root-context.svelte';\nimport RootProvider from '../anatomy/root-provider.svelte';\nimport Root from '../anatomy/root.svelte';\nimport Track from '../anatomy/track.svelte';\nimport ValueText from '../anatomy/value-text.svelte';\nexport const Progress = Object.assign(Root, {\n    Provider: RootProvider,\n    Context: RootContext,\n    Label: Label,\n    ValueText: ValueText,\n    Track: Track,\n    Range: Range,\n    Circle: Circle,\n    CircleTrack: CircleTrack,\n    CircleRange: CircleRange,\n});\n","/**\n * @file src/utils/entryActionsMessages.ts\n * @description Centralized messages for entry actions to improve localization\n */\n\nimport * as m from '@shared/paraglide/messages';\n\nexport const entryMessages = {\n\t// Status update messages\n\tentriesArchived: (count: number) => m.entries_archived?.({ count }) || `${count} ${count === 1 ? 'entry' : 'entries'} archived successfully`,\n\n\tentriesPublished: (count: number) => m.entries_published?.({ count }) || `${count} ${count === 1 ? 'entry' : 'entries'} published successfully`,\n\n\tentriesUnpublished: (count: number) =>\n\t\tm.entries_unpublished?.({ count }) || `${count} ${count === 1 ? 'entry' : 'entries'} unpublished successfully`,\n\n\tentriesSetToTest: (count: number) => m.entries_set_to_test?.({ count }) || `${count} ${count === 1 ? 'entry' : 'entries'} set to test successfully`,\n\n\tentriesDeleted: (count: number) => m.entries_deleted?.({ count }) || `${count} ${count === 1 ? 'entry' : 'entries'} deleted successfully`,\n\n\tentriesScheduled: (count: number) => m.entries_scheduled?.({ count }) || `${count} ${count === 1 ? 'entry' : 'entries'} scheduled successfully`,\n\n\tentriesCloned: (count: number) => m.entries_cloned?.({ count }) || `${count} ${count === 1 ? 'entry' : 'entries'} cloned successfully`,\n\n\tentriesUpdated: (count: number, status: string) =>\n\t\tm.entries_updated?.({ count, status }) || `${count} ${count === 1 ? 'entry' : 'entries'} updated to ${status}`,\n\n\t// Error messages\n\tupdateFailed: (operation: string) => m.update_failed?.({ operation }) || `Failed to ${operation} entries`,\n\n\tdeleteFailed: (operation: string) => m.delete_failed?.({ operation }) || `Failed to ${operation} entries`,\n\n\tnoEntriesSelected: () => m.no_entries_selected?.() || 'No entries selected',\n\n\tnoCollectionFound: () => m.no_collection_found?.() || 'Collection not found',\n\n\t// Single entry messages\n\tentryArchived: () => m.entry_archived?.() || 'Entry archived successfully',\n\n\tentryDeleted: () => m.entry_deleted_success?.() || 'Entry deleted successfully',\n\n\tentrySaved: () => m.entry_saved?.() || 'Entry saved successfully',\n\n\tentryStatusUpdated: (status: string) => m.entry_status_updated?.({ status }) || `Entry status updated to ${status}`,\n\n\tentryScheduled: (date: string) => m.entry_scheduled?.({ date }) || `Entry scheduled for ${date}`,\n\n\tentryCloned: () => m.entry_cloned_success?.() || 'Entry cloned successfully',\n\n\t// Admin permissions\n\tonlyAdminsCanDelete: () => m.only_admins_can_delete?.() || 'Only administrators can delete archived entries',\n\n\tstatusReservedForSystem: (status: string) => m.status_reserved_for_system?.({ status }) || `${status} status is reserved for system operations`,\n\n\t// Unsaved changes\n\tunsavedChangesTitle: () => m.unsaved_changes_title?.() || 'Unsaved Changes',\n\n\tunsavedChangesBody: () => m.unsaved_changes_body?.() || 'You have unsaved changes. Do you want to save them as a draft before leaving?',\n\n\tsaveAsDraftAndLeave: () => m.save_as_draft_and_leave?.() || 'Save as Draft and Leave',\n\n\tstayAndContinueEditing: () => m.stay_and_continue_editing?.() || 'Stay and Continue Editing',\n\n\tchangesSavedAsDraft: () => m.changes_saved_as_draft?.() || 'Changes saved as draft',\n\n\terrorSavingDraft: (error: string) => m.error_saving_draft?.({ error }) || `Error saving draft: ${error}`,\n\n\t// Scheduling\n\tnoEntryForScheduling: () => m.no_entry_for_scheduling?.() || 'No entry selected for scheduling',\n\n\tentryScheduledStatus: () => m.entry_scheduled_status?.() || 'Entry status changed to scheduled',\n\n\terrorScheduling: (error: string) => m.error_scheduling?.({ error }) || `Error scheduling entry: ${error}`,\n\n\t// Common actions\n\tconfirm: () => m.button_confirm?.() || 'Confirm',\n\n\tcancel: () => m.button_cancel?.() || 'Cancel',\n\n\tdelete: () => m.button_delete?.() || 'Delete',\n\n\tarchive: () => m.button_archive?.() || 'Archive',\n\n\tpublish: () => m.entrylist_multibutton_publish?.() || 'Publish',\n\n\tunpublish: () => m.entrylist_multibutton_unpublish?.() || 'Unpublish',\n\n\tschedule: () => m.entrylist_multibutton_schedule?.() || 'Schedule',\n\n\tclone: () => m.entrylist_multibutton_clone?.() || 'Clone',\n\n\ttest: () => m.button_test?.() || 'Test'\n};\n","/**\n * @file src/utils/entryActions.ts\n * @description Centralized functions for performing actions on collection entries.\n */\n\nimport type { StatusType } from '@cms-types/content';\nimport { StatusTypes } from '@cms-types/content';\nimport { publicEnv } from '@shared/stores/globalSettings.svelte';\n\n// ParaglideJS\nimport * as m from '@shared/paraglide/messages';\nimport { collection, collectionValue, setCollectionValue, setMode } from '@shared/stores/collectionStore.svelte';\nimport { toaster } from '@shared/stores/store.svelte';\nimport { logger } from './logger';\nimport {\n\tbatchDeleteEntries,\n\tbatchUpdateEntries,\n\tcreateClones,\n\tcreateEntry,\n\tdeleteEntry,\n\tinvalidateCollectionCache,\n\tupdateEntry,\n\tupdateEntryStatus\n} from './apiClient';\nimport { entryMessages } from './entryActionsMessages';\nimport { showConfirm, showScheduleModal, showCloneModal } from '@shared/utils/modalUtils';\n// Helper function to update entry status\nasync function updateStatus(collectionId: string, entryId: string, status: string) {\n\tconst result = await updateEntryStatus(collectionId, entryId, status);\n\tif (!result.success) {\n\t\tthrow new Error(result.error || 'Failed to update status');\n\t}\n\treturn result;\n}\n\n// Sets the status for one or more entries\nexport async function setEntriesStatus(entryIds: string[], status: StatusType, onSuccess: () => void, payload: Record<string, unknown> = {}) {\n\tif (!entryIds.length) return;\n\tconst collId = collection.value?._id;\n\tif (!collId) return;\n\n\tconst result = await batchUpdateEntries(collId, { ids: entryIds, status, ...payload });\n\tif (result.success) {\n\t\t// Use centralized messaging\n\t\tconst count = entryIds.length;\n\t\tlet message: string;\n\n\t\tswitch (status) {\n\t\t\tcase StatusTypes.archive:\n\t\t\t\tmessage = entryMessages.entriesArchived(count);\n\t\t\t\tbreak;\n\t\t\tcase StatusTypes.publish:\n\t\t\t\tmessage = entryMessages.entriesPublished(count);\n\t\t\t\tbreak;\n\t\t\tcase StatusTypes.unpublish:\n\t\t\t\tmessage = entryMessages.entriesUnpublished(count);\n\t\t\t\tbreak;\n\t\t\tcase StatusTypes.draft:\n\t\t\t\tmessage = entryMessages.entriesUpdated(count, StatusTypes.draft);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tmessage = entryMessages.entriesUpdated(count, status);\n\t\t}\n\n\t\ttoaster.success({ description: message });\n\t\tonSuccess();\n\t} else {\n\t\ttoaster.error({ description: result.error || entryMessages.updateFailed('update') });\n\t}\n} // Deletes or archives one or more entries with improved batch delete\nexport async function deleteEntries(entryIds: string[], isPermanentDelete: boolean, onSuccess: () => void) {\n\tif (!entryIds.length) return;\n\tconst collId = collection.value?._id;\n\tif (!collId) return;\n\n\tconst isArchiving = publicEnv.USE_ARCHIVE_ON_DELETE && !isPermanentDelete;\n\n\ttry {\n\t\tif (isArchiving) {\n\t\t\t// Archive entries by updating their status to 'archive'\n\t\t\tconst result = await batchUpdateEntries(collId, { ids: entryIds, status: StatusTypes.archive });\n\t\t\tif (result.success) {\n\t\t\t\ttoaster.success({ description: entryMessages.entriesArchived(entryIds.length) });\n\t\t\t\tonSuccess();\n\t\t\t} else {\n\t\t\t\ttoaster.error({ description: result.error || entryMessages.updateFailed(StatusTypes.archive) });\n\t\t\t}\n\t\t} else {\n\t\t\t// Use batch delete API if available, fallback to individual deletes\n\t\t\ttry {\n\t\t\t\tconst result = await batchDeleteEntries(collId, entryIds);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoaster.success({ description: entryMessages.entriesDeleted(entryIds.length) });\n\t\t\t\t\tonSuccess();\n\t\t\t\t} else {\n\t\t\t\t\t// Fallback to individual deletes if batch delete fails\n\t\t\t\t\tthrow new Error('Batch delete not supported, falling back to individual deletes');\n\t\t\t\t}\n\t\t\t} catch (batchError) {\n\t\t\t\t// Fallback: delete entries one by one\n\t\t\t\tlogger.warn('Batch delete failed, using individual deletes:', batchError);\n\t\t\t\tawait Promise.all(entryIds.map((entryId) => deleteEntry(collId, entryId)));\n\t\t\t\ttoaster.success({ description: entryMessages.entriesDeleted(entryIds.length) });\n\t\t\t\tonSuccess();\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\ttoaster.error({ description: entryMessages.deleteFailed(isArchiving ? StatusTypes.archive : StatusTypes.delete) + `: ${(e as Error).message}` });\n\t}\n}\n\n// Clones one or more entries\nexport async function cloneEntries(rawEntries: Record<string, unknown>[], onSuccess: () => void) {\n\tif (!rawEntries.length) return;\n\tconst collId = collection.value?._id;\n\tif (!collId) return;\n\n\tconst entriesToClone = rawEntries.map((entry) => {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\t\tconst { _id, createdAt, updatedAt, ...rest } = entry;\n\t\treturn { ...rest, clonedFrom: _id };\n\t});\n\n\tconst result = await createClones(collId, entriesToClone);\n\tif (result.success) {\n\t\ttoaster.success({ description: 'Entries cloned' });\n\t\tonSuccess();\n\t} else {\n\t\ttoaster.error({ description: result.error || 'Failed to clone entries' });\n\t}\n}\n\n// Saves a new or existing entry\nexport async function saveEntry(entryData: Record<string, unknown>, publish: boolean = false): Promise<boolean> {\n\tconst collId = collection.value?._id;\n\tif (!collId) {\n\t\ttoaster.warning({ description: 'Collection not found' });\n\t\treturn false;\n\t}\n\n\tconst entryId = entryData._id as string | undefined;\n\n\t// Preserve user's chosen status unless explicitly publishing\n\tconst payload = { ...entryData };\n\tif (publish) {\n\t\tpayload.status = StatusTypes.publish;\n\t} else if (!payload.status) {\n\t\t// Use collection's default status if no status is specified (new entries)\n\t\tpayload.status = collection.value?.status || StatusTypes.draft;\n\t}\n\t// Otherwise preserve the existing status from entryData\n\n\tconst result = entryId ? await updateEntry(collId, entryId, payload) : await createEntry(collId, payload);\n\n\tif (result.success) {\n\t\ttoaster.success({ description: 'Entry saved' });\n\t\tif (result.data) {\n\t\t\tsetCollectionValue(result.data as Record<string, unknown>);\n\t\t}\n\t\t// setMode('view'); // Handled by caller to ensure proper navigation flow\n\t\tinvalidateCollectionCache(collId);\n\n\t\t// Trigger SvelteKit SSR reload - Handled by caller via goto(..., { invalidateAll: true })\n\t\t// await invalidateAll();\n\n\t\t// Clear client-side cache in EntryList component\n\t\tif (typeof document !== 'undefined') {\n\t\t\tdocument.dispatchEvent(\n\t\t\t\tnew CustomEvent('clearEntryListCache', {\n\t\t\t\t\tdetail: { reason: 'entry-saved', collectionId: collId }\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\treturn true;\n\t} else {\n\t\ttoaster.error({ description: result.error || 'Failed to save entry' });\n\t\treturn false;\n\t}\n}\n\n// Deletes the currently active entry after confirmation\nexport async function deleteCurrentEntry(isAdmin: boolean = false) {\n\tconst entry = collectionValue.value;\n\tconst coll = collection.value;\n\tif (!entry?._id || !coll?._id) {\n\t\ttoaster.warning({ description: m.delete_entry_no_selection_error() });\n\t\treturn;\n\t}\n\n\t// Type assertions after null check\n\tconst collectionId = coll._id as string;\n\tconst entryId = entry._id as string;\n\n\tconst entryStatus: StatusType = (entry.status as StatusType) || StatusTypes.draft;\n\tconst isArchived = entryStatus === StatusTypes.archive;\n\tconst useArchiving = publicEnv.USE_ARCHIVE_ON_DELETE;\n\n\t// Determine what options to show based on rules\n\tif (!useArchiving) {\n\t\t// USE_ARCHIVE_ON_DELETE: false - Always delete directly\n\t\tshowDeleteConfirmationModal(collectionId, entryId, StatusTypes.delete);\n\t} else if (isArchived) {\n\t\t// Archived entry - only admins can permanently delete\n\t\tif (isAdmin) {\n\t\t\tshowDeleteConfirmationModal(collectionId, entryId, StatusTypes.delete);\n\t\t} else {\n\t\t\ttoaster.warning({ description: 'Only administrators can delete archived entries.' });\n\t\t}\n\t} else {\n\t\t// Active entry (draft, clone, publish, unpublish, test)\n\t\tif (isAdmin) {\n\t\t\t// Admin can choose: show both options in one modal\n\t\t\tshowAdminChoiceModal(collectionId, entryId);\n\t\t} else {\n\t\t\t// Non-admin can only archive\n\t\t\tshowDeleteConfirmationModal(collectionId, entryId, StatusTypes.archive);\n\t\t}\n\t}\n}\n\n// Helper function to show admin choice modal (Archive or Delete options)\nfunction showAdminChoiceModal(collectionId: string, entryId: string) {\n\t// First show archive option with Cancel leading to delete option\n\tshowConfirm({\n\t\ttitle: 'Archive Entry',\n\t\tbody: `\n\t\t\t<div class=\"space-y-3\">\n\t\t\t\t<p>Do you want to <strong class=\"text-warning-600\">archive</strong> this entry?</p>\n\t\t\t\t<p class=\"text-sm text-surface-600 dark:text-surface-50\">Archived entries are hidden from view but kept in the database and can be restored later.</p>\n\t\t\t</div>\n\t\t`,\n\t\tconfirmText: 'Archive',\n\t\tcancelText: 'Show Delete Option',\n\t\tonConfirm: () => showDeleteConfirmationModal(collectionId, entryId, StatusTypes.archive),\n\t\tonCancel: () =>\n\t\t\tshowConfirm({\n\t\t\t\ttitle: 'Delete Entry Permanently',\n\t\t\t\tbody: `\n\t\t\t\t\t<div class=\"space-y-3\">\n\t\t\t\t\t\t<p>Do you want to <strong class=\"text-error-600\">permanently delete</strong> this entry?</p>\n\t\t\t\t\t\t<p class=\"text-sm text-surface-600 dark:text-surface-50\">This will completely remove the entry from the database. This action cannot be undone.</p>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tconfirmText: 'Delete Permanently',\n\t\t\t\tonConfirm: () => showDeleteConfirmationModal(collectionId, entryId, StatusTypes.delete)\n\t\t\t})\n\t});\n}\n\n// Helper function to show final confirmation modal\nfunction showDeleteConfirmationModal(collectionId: string, entryId: string, action: typeof StatusTypes.archive | typeof StatusTypes.delete) {\n\tconst isArchive = action === StatusTypes.archive;\n\tshowConfirm({\n\t\ttitle: `Please Confirm <span class=\"text-error-500 font-bold\">${isArchive ? 'Archiving' : 'Deletion'}</span>`,\n\t\tbody: isArchive\n\t\t\t? `Are you sure you want to <span class=\"text-warning-500 font-semibold\">archive</span> this entry? Archived items can be restored later.`\n\t\t\t: `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> this entry? This action will remove the entry from the system.`,\n\t\tconfirmText: isArchive ? 'Archive' : 'Delete',\n\t\tcancelText: m.button_cancel(),\n\t\tonConfirm: async () => {\n\t\t\ttry {\n\t\t\t\tif (isArchive) {\n\t\t\t\t\tawait updateStatus(collectionId, entryId, StatusTypes.archive);\n\t\t\t\t\tsetCollectionValue({ ...collectionValue.value, status: StatusTypes.archive });\n\t\t\t\t\ttoaster.success({ description: 'Entry archived successfully.' });\n\t\t\t\t} else {\n\t\t\t\t\tawait deleteEntry(collectionId, entryId);\n\t\t\t\t\ttoaster.success({ description: m.entry_deleted_success() });\n\t\t\t\t}\n\t\t\t\tsetMode('view');\n\t\t\t\tsetCollectionValue({});\n\t\t\t\tinvalidateCollectionCache(collectionId);\n\t\t\t} catch (e) {\n\t\t\t\ttoaster.error({ description: m.delete_entry_error({ error: (e as Error).message }) });\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport async function permanentlyDeleteEntry(entryId: string) {\n\tconst coll = collection.value;\n\tif (!coll?._id) {\n\t\ttoaster.warning({ description: m.clone_entry_no_selection_error() });\n\t\treturn;\n\t}\n\n\tconst collectionId = coll._id as string;\n\n\tshowConfirm({\n\t\ttitle: 'Confirm Permanent Deletion',\n\t\tbody: 'This will permanently delete the archived entry from the database. This action cannot be undone.',\n\t\tconfirmText: 'Permanently Delete',\n\t\tonConfirm: async () => {\n\t\t\ttry {\n\t\t\t\tawait deleteEntry(collectionId, entryId);\n\t\t\t\ttoaster.success({ description: 'Entry permanently deleted.' });\n\t\t\t\tinvalidateCollectionCache(collectionId);\n\t\t\t\tsetMode('view');\n\t\t\t} catch (e) {\n\t\t\t\ttoaster.error({ description: `Error permanently deleting entry: ${(e as Error).message}` });\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport async function setEntryStatus(newStatus: StatusType) {\n\tconst entry = collectionValue.value;\n\tconst coll = collection.value;\n\tif (!entry?._id || !coll?._id) {\n\t\ttoaster.warning({ description: m.set_status_no_selection_error() });\n\t\treturn;\n\t}\n\n\tconst collectionId = coll._id as string;\n\tconst entryId = entry._id as string;\n\n\tif (newStatus === 'draft' || newStatus === StatusTypes.archive) {\n\t\ttoaster.error({ description: `${newStatus} status is reserved for system operations.` });\n\t\treturn;\n\t}\n\ttry {\n\t\tawait updateStatus(collectionId, entryId, newStatus);\n\t\tsetCollectionValue({ ...collectionValue.value, status: newStatus });\n\t\ttoaster.success({ description: m.entry_status_updated({ status: newStatus }) });\n\t} catch (e) {\n\t\ttoaster.error({ description: m.set_status_error({ error: (e as Error).message }) });\n\t}\n}\n\n// Schedule entry for future publication with improved date picker integration\nexport async function scheduleCurrentEntry(scheduledDate?: Date) {\n\tconst entry = collectionValue.value;\n\tconst coll = collection.value;\n\n\tif (!entry?._id || !coll?._id) {\n\t\ttoaster.warning({ description: entryMessages.noEntryForScheduling() });\n\t\treturn;\n\t}\n\n\tconst collectionId = coll._id as string;\n\tconst entryId = entry._id as string;\n\n\tif (scheduledDate) {\n\t\t// If date is provided, directly schedule\n\t\ttry {\n\t\t\t// 'scheduled' is not a valid StatusType, use 'publish' or 'draft' as needed\n\t\t\tawait updateStatus(collectionId, entryId, StatusTypes.publish);\n\t\t\tsetCollectionValue({\n\t\t\t\t...collectionValue.value,\n\t\t\t\tstatus: StatusTypes.publish,\n\t\t\t\tscheduledDate: scheduledDate.toISOString()\n\t\t\t});\n\t\t\ttoaster.success({ description: entryMessages.entryScheduled(scheduledDate.toLocaleDateString()) });\n\t\t} catch (e) {\n\t\t\ttoaster.error({ description: entryMessages.errorScheduling((e as Error).message) });\n\t\t}\n\t} else {\n\t\t// Show the schedule modal via helper\n\t\tshowScheduleModal({\n\t\t\tinitialAction: StatusTypes.publish,\n\t\t\tonSchedule: async (date: Date, action: string) => {\n\t\t\t\ttry {\n\t\t\t\t\tawait updateStatus(collectionId, entryId, StatusTypes.publish);\n\t\t\t\t\tsetCollectionValue({\n\t\t\t\t\t\t...collectionValue.value,\n\t\t\t\t\t\tstatus: StatusTypes.publish,\n\t\t\t\t\t\tscheduledDate: date.toISOString(),\n\t\t\t\t\t\tscheduledAction: action\n\t\t\t\t\t});\n\t\t\t\t\ttoaster.success({ description: entryMessages.entryScheduled(date.toLocaleDateString()) });\n\t\t\t\t} catch (e) {\n\t\t\t\t\ttoaster.error({ description: entryMessages.errorScheduling((e as Error).message) });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\n// Clones the currently active entry with improved modal\nexport async function cloneCurrentEntry() {\n\tconst entry = collectionValue.value;\n\tconst coll = collection.value;\n\tif (!entry || !coll?._id) {\n\t\ttoaster.warning({ description: m.clone_entry_no_selection_error() });\n\t\treturn;\n\t}\n\n\tconst collectionId = coll._id as string;\n\n\tshowCloneModal({\n\t\tcount: 1,\n\t\tonConfirm: async () => {\n\t\t\ttry {\n\t\t\t\t// Create a deep copy of the entry with all its data\n\t\t\t\tconst clonedPayload = JSON.parse(JSON.stringify(entry));\n\n\t\t\t\t// Remove unique identifiers and timestamps\n\t\t\t\tdelete clonedPayload._id;\n\t\t\t\tdelete clonedPayload.createdAt;\n\t\t\t\tdelete clonedPayload.updatedAt;\n\n\t\t\t\t// Set clone status and reference to original\n\t\t\t\tclonedPayload.status = StatusTypes.draft;\n\t\t\t\tclonedPayload.clonedFrom = entry._id;\n\n\t\t\t\tlogger.debug('Cloning entry with payload:', clonedPayload);\n\n\t\t\t\tconst result = await createEntry(collectionId, clonedPayload);\n\t\t\t\tif (result.success) {\n\t\t\t\t\ttoaster.success({ description: entryMessages.entryCloned() });\n\t\t\t\t\tinvalidateCollectionCache(collectionId);\n\t\t\t\t\tsetMode('view');\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(result.error || 'Failed to create clone');\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\ttoaster.error({ description: m.clone_entry_error({ error: (e as Error).message }) });\n\t\t\t}\n\t\t}\n\t});\n}\n\n// Auto-draft functionality for unsaved changes\nlet hasUnsavedChanges = false;\n\n// Initialize editing mode\nexport function startEditing() {\n\thasUnsavedChanges = false;\n}\n\n// Mark that changes have been made\nexport function markAsChanged() {\n\thasUnsavedChanges = true;\n}\n\n// Check if there are unsaved changes\nexport function getHasUnsavedChanges(): boolean {\n\treturn hasUnsavedChanges;\n}\n\n// Save current data as draft when user tries to leave\nexport async function saveDraftAndLeave(): Promise<boolean> {\n\tconst entry = collectionValue.value;\n\tconst coll = collection.value;\n\n\tif (!hasUnsavedChanges || !entry || !coll?._id) {\n\t\treturn true; // Allow navigation if no unsaved changes\n\t}\n\n\tconst collectionId = coll._id as string;\n\n\treturn new Promise((resolve) => {\n\t\tshowConfirm({\n\t\t\ttitle: 'Unsaved Changes',\n\t\t\tbody: 'You have unsaved changes. Do you want to save them as a draft before leaving?',\n\t\t\tconfirmText: 'Save as Draft and Leave',\n\t\t\tcancelText: 'Stay and Continue Editing',\n\t\t\tonConfirm: async () => {\n\t\t\t\t// Save as draft and allow navigation\n\t\t\t\ttry {\n\t\t\t\t\tconst draftData = { ...entry };\n\n\t\t\t\t\tif (entry._id) {\n\t\t\t\t\t\t// Update existing entry with draft status\n\t\t\t\t\t\tconst entryId = entry._id as string;\n\t\t\t\t\t\tconst result = await updateEntry(collectionId, entryId, draftData);\n\t\t\t\t\t\tif (!result.success) {\n\t\t\t\t\t\t\tthrow new Error(result.error || 'Failed to update entry');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tawait updateStatus(collectionId, entryId, StatusTypes.draft);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Create new entry with draft status\n\t\t\t\t\t\tdraftData.status = StatusTypes.draft;\n\t\t\t\t\t\tconst result = await createEntry(collectionId, draftData);\n\t\t\t\t\t\tif (!result.success) {\n\t\t\t\t\t\t\tthrow new Error(result.error || 'Failed to create entry');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttoaster.warning({ description: 'Changes saved as draft.' });\n\n\t\t\t\t\tinvalidateCollectionCache(collectionId);\n\t\t\t\t\thasUnsavedChanges = false;\n\t\t\t\t\tresolve(true); // Allow navigation\n\t\t\t\t} catch (e) {\n\t\t\t\t\ttoaster.error({ description: `Error saving draft: ${(e as Error).message}` });\n\t\t\t\t\tresolve(false); // Prevent navigation due to error\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCancel: () => {\n\t\t\t\t// User chose to stay and continue editing\n\t\t\t\tresolve(false); // Prevent navigation\n\t\t\t}\n\t\t});\n\t});\n}\n\n// Reset the unsaved changes state\nexport function resetUnsavedChanges() {\n\thasUnsavedChanges = false;\n}\n","/**\n * @file src/utils/navigationUtils.ts\n * @description  GUI-first navigation via uuids/mode for SveltyCMS using SvelteKit's built-in systems\n */\n\nconst browser = typeof window !== 'undefined';\nimport { preloadData } from '$app/navigation';\nimport { logger } from './logger';\nimport type { ModeType } from '@shared/stores/collectionStore.svelte';\n\n// ============================================================================\n// PRELOADING\n// ============================================================================\n\nconst preloadTimers = new Map<string, number>();\nexport const PRELOAD_DELAY = 200; // Configurable delay to prevent aggressive prefetching\n\nexport function preloadEntry(entryId: string, currentPath: string, delay: number = PRELOAD_DELAY): void {\n\tconst existingTimer = preloadTimers.get(entryId);\n\tif (existingTimer) clearTimeout(existingTimer);\n\n\tconst timer = setTimeout(async () => {\n\t\ttry {\n\t\t\tconst url = new URL(currentPath, window.location.origin);\n\t\t\turl.searchParams.set('edit', entryId);\n\t\t\tawait preloadData(url.pathname + url.search);\n\t\t\tlogger.debug(`[Preload] Entry ${entryId.substring(0, 8)}`);\n\t\t} catch (error) {\n\t\t\tlogger.warn(`[Preload ERROR]`, error);\n\t\t} finally {\n\t\t\tpreloadTimers.delete(entryId);\n\t\t}\n\t}, delay);\n\n\tpreloadTimers.set(entryId, timer as unknown as number);\n}\n\nexport function cancelPreload(entryId: string): void {\n\tconst timer = preloadTimers.get(entryId);\n\tif (timer) {\n\t\tclearTimeout(timer);\n\t\tpreloadTimers.delete(entryId);\n\t}\n}\n\n// ============================================================================\n// URL REFLECTION\n// ============================================================================\n\nexport function reflectModeInURL(mode: ModeType, entryId?: string, options: { replaceState?: boolean } = {}): void {\n\tif (!browser) return;\n\n\tconst url = new URL(window.location.href);\n\turl.searchParams.delete('edit');\n\turl.searchParams.delete('create');\n\n\tif (mode === 'edit' && entryId) {\n\t\turl.searchParams.set('edit', entryId);\n\t} else if (mode === 'create') {\n\t\turl.searchParams.set('create', 'true');\n\t}\n\n\tconst method = options.replaceState ? 'replaceState' : 'pushState';\n\twindow.history[method]({}, '', url.toString());\n\tlogger.debug(`[URL] ${mode}${entryId ? ` (${entryId.substring(0, 8)})` : ''}`);\n}\n\n// ============================================================================\n// URL PARSING\n// ============================================================================\n\nexport interface ParsedURL {\n\tmode: ModeType;\n\tentryId?: string;\n\tlanguage: string;\n\tcollectionPath: string;\n}\n\nexport function parseURLToMode(url: URL): ParsedURL {\n\tconst editParam = url.searchParams.get('edit');\n\tconst createParam = url.searchParams.get('create');\n\n\tlet mode: ModeType = 'view';\n\tlet entryId: string | undefined;\n\n\tif (editParam) {\n\t\tmode = 'edit';\n\t\tentryId = editParam;\n\t} else if (createParam === 'true') {\n\t\tmode = 'create';\n\t}\n\n\tconst pathParts = url.pathname.split('/').filter(Boolean);\n\treturn {\n\t\tmode,\n\t\tentryId,\n\t\tlanguage: pathParts[0] || 'en',\n\t\tcollectionPath: pathParts.slice(1).join('/')\n\t};\n}\n\n// ============================================================================\n// CACHE INVALIDATION\n// ============================================================================\n\nexport function invalidateCollectionEntries(collectionId: string): void {\n\t// SvelteKit will refetch on next navigation\n\tlogger.debug(`[Cache] Collection ${collectionId} - will refetch on next load`);\n}\n\nexport const navigationUtils = {\n\tpreloadEntry,\n\tcancelPreload,\n\treflectModeInURL,\n\tparseURLToMode,\n\tinvalidateCollectionEntries\n};\n\nexport default navigationUtils;\n","<!-- \n@file src/components/system/table/Status.svelte\n@component\n**Status component for table displaying different badges for different statuses**\n\nValues form StatusTypes\n\n@example\n<Status value=\"publish\" />\n\n### Props\n- `value` {string}: The status value to display\n\n### Features:\n- Displays different badges for different statuses\n- Uses icons and colors to represent each status visually\n-->\n\n<script lang=\"ts\">\n\t// Import StatusTypes for centralized status management\n\timport { StatusTypes } from '@cms-types/content';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\tconst { value } = $props(); // The status value to display\n</script>\n\n<!-- Display different badges for different statuses -->\n<div\n\tclass=\"flex w-fit min-w-24 items-center justify-center gap-2 rounded px-3 py-1.5 text-center text-white\n\t\t{value === StatusTypes.publish\n\t\t? 'gradient-primary'\n\t\t: value === StatusTypes.unpublish\n\t\t\t? 'gradient-yellow'\n\t\t\t: value === StatusTypes.schedule\n\t\t\t\t? 'gradient-pink'\n\t\t\t\t: value === StatusTypes.delete\n\t\t\t\t\t? 'bg-surface-500 text-white'\n\t\t\t\t\t: value === StatusTypes.clone\n\t\t\t\t\t\t? 'gradient-secondary'\n\t\t\t\t\t\t: value === StatusTypes.draft\n\t\t\t\t\t\t\t? 'preset-outlined-surface-500 text-surface-900-50-token'\n\t\t\t\t\t\t\t: value === StatusTypes.archive\n\t\t\t\t\t\t\t\t? 'bg-surface-600 text-white'\n\t\t\t\t\t\t\t\t: 'badge'}\"\n\ttitle={`Status: ${value}`}\n>\n\t{#if value === StatusTypes.publish}\n\t\t<iconify-icon icon=\"bi:hand-thumbs-up-fill\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.entrylist_multibutton_publish()}</p>\n\t{:else if value === StatusTypes.unpublish}\n\t\t<iconify-icon icon=\"bi:pause-circle\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.entrylist_multibutton_unpublish()}</p>\n\t{:else if value === StatusTypes.schedule}\n\t\t<iconify-icon icon=\"bi:clock\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.entrylist_multibutton_schedule()}</p>\n\t{:else if value === 'deleted'}\n\t\t<iconify-icon icon=\"bi:trash3-fill\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.button_delete()}</p>\n\t{:else if value === StatusTypes.delete}\n\t\t<iconify-icon icon=\"bi:trash3-fill\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.button_delete()}</p>\n\t{:else if value === StatusTypes.clone}\n\t\t<iconify-icon icon=\"bi:clipboard-data-fill\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.entrylist_multibutton_clone()}</p>\n\t{:else if value === StatusTypes.draft}\n\t\t<iconify-icon icon=\"bi:pencil-square\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.entrylist_multibutton_draft()}</p>\n\t{:else if value === StatusTypes.archive}\n\t\t<iconify-icon icon=\"bi:archive-fill\" width=\"16\"></iconify-icon>\n\t\t<p class=\"hidden sm:block text-xs font-bold uppercase\">{m.button_archive()}</p>\n\t{:else}\n\t\t<p class=\"px-2\">{value}</p>\n\t{/if}\n</div>\n","<!--\n@file src/components/collectionDisplay/EntryList_MultiButton.svelte\n@component\n**Enterprise-Grade MultiButton with Action Queue, Progress Tracking, and Undo Support**\n\n### Features:\n- **Action Queue System**: Real-time progress tracking for batch operations\n- **Undo/Redo Support**: 5-minute window for reversible actions\n- **Smart Confirmation**: Auto-confirms small batches, always confirms dangerous ops\n- **Connection-Aware**: Limits batch size on slow networks (2G/3G)\n- **Keyboard Shortcuts**: Alt+N (create), Alt+P (publish), Alt+U (unpublish), Alt+D (draft), Alt+Del (delete)\n- **Optimistic UI**: Instant feedback before server response\n- **Premium Styling**: Vibrant gradients, smooth transitions, and animated feedback\n\n### Props\n- `isCollectionEmpty` (Boolean): If true, displays only the Create button as `rounded-full`.\n- `hasSelections` (Boolean): If true, enables bulk actions.\n- `selectedCount` (Number): Number of items currently selected.\n- `selectedItems` (Array): Raw entry data of selected items for status analysis.\n- `showDeleted` (Boolean, bindable): Toggles between active and archived views.\n- `create`, `publish`, `unpublish`, `draft`, `schedule`, `clone`, `delete`: Action callbacks.\n-->\n\n<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { scale } from 'svelte/transition';\n\timport { quintOut } from 'svelte/easing';\n\timport { StatusTypes } from '@cms-types/content';\n\timport { storeListboxValue } from '@shared/stores/store.svelte';\n\timport * as m from '@shared/paraglide/messages';\n\timport { logger } from '@shared/utils/logger';\n\timport { showToast } from '@shared/utils/toast';\n\n\t// --- Types ---\n\ttype ActionType = 'create' | 'publish' | 'unpublish' | 'draft' | 'schedule' | 'clone' | 'delete';\n\ttype DangerLevel = 'low' | 'medium' | 'high';\n\n\tinterface ActionConfig {\n\t\ttype: ActionType;\n\t\tlabel: string;\n\t\tgradient: string;\n\t\ticon: string;\n\t\ttextColor: string;\n\t\tshortcut?: string;\n\t\tshortcutKey?: string;\n\t\trequiresSelection: boolean;\n\t\tdangerLevel: DangerLevel;\n\t}\n\n\t// --- Props ---\n\tinterface Props {\n\t\tisCollectionEmpty?: boolean;\n\t\thasSelections?: boolean;\n\t\tselectedCount?: number;\n\t\tselectedItems?: any[];\n\t\tshowDeleted?: boolean;\n\t\tcreate: () => void;\n\t\tpublish: () => Promise<void> | void;\n\t\tunpublish: () => Promise<void> | void;\n\t\tdraft: () => Promise<void> | void;\n\t\tschedule: (date: string, action: string) => void;\n\t\tclone: () => Promise<void> | void;\n\t\tdelete: (permanent: boolean) => Promise<void> | void;\n\t}\n\n\tlet {\n\t\tisCollectionEmpty = false,\n\t\thasSelections = false,\n\t\tselectedCount = 0,\n\t\tselectedItems = [],\n\t\tshowDeleted = $bindable(false),\n\t\tpublish,\n\t\tunpublish,\n\t\tdraft,\n\t\tschedule,\n\t\tdelete: deleteAction,\n\t\tclone,\n\t\tcreate\n\t}: Props = $props();\n\n\t// --- Action Configurations ---\n\tconst ACTION_CONFIGS: ActionConfig[] = [\n\t\t{\n\t\t\ttype: 'create',\n\t\t\tlabel: m.entrylist_multibutton_create(),\n\t\t\tgradient: 'gradient-tertiary',\n\t\t\ticon: 'ic:round-plus',\n\t\t\ttextColor: 'text-white',\n\t\t\tshortcut: 'Alt+N',\n\t\t\tshortcutKey: 'n',\n\t\t\trequiresSelection: false,\n\t\t\tdangerLevel: 'low'\n\t\t},\n\t\t{\n\t\t\ttype: 'publish',\n\t\t\tlabel: m.entrylist_multibutton_publish(),\n\t\t\tgradient: 'gradient-primary',\n\t\t\ticon: 'bi:hand-thumbs-up-fill',\n\t\t\ttextColor: 'text-white',\n\t\t\tshortcut: 'Alt+P',\n\t\t\tshortcutKey: 'p',\n\t\t\trequiresSelection: true,\n\t\t\tdangerLevel: 'medium'\n\t\t},\n\t\t{\n\t\t\ttype: 'unpublish',\n\t\t\tlabel: m.entrylist_multibutton_unpublish(),\n\t\t\tgradient: 'gradient-warning',\n\t\t\ticon: 'bi:pause-circle',\n\t\t\ttextColor: 'text-black',\n\t\t\tshortcut: 'Alt+U',\n\t\t\tshortcutKey: 'u',\n\t\t\trequiresSelection: true,\n\t\t\tdangerLevel: 'medium'\n\t\t},\n\t\t{\n\t\t\ttype: 'draft',\n\t\t\tlabel: 'Draft',\n\t\t\tgradient: 'gradient-secondary',\n\t\t\ticon: 'ic:baseline-edit-note',\n\t\t\ttextColor: 'text-white',\n\t\t\tshortcut: 'Alt+D',\n\t\t\tshortcutKey: 'd',\n\t\t\trequiresSelection: true,\n\t\t\tdangerLevel: 'low'\n\t\t},\n\t\t{\n\t\t\ttype: 'schedule',\n\t\t\tlabel: m.entrylist_multibutton_schedule(),\n\t\t\tgradient: 'gradient-tertiary',\n\t\t\ticon: 'ic:round-schedule',\n\t\t\ttextColor: 'text-white',\n\t\t\trequiresSelection: true,\n\t\t\tdangerLevel: 'low'\n\t\t},\n\t\t{\n\t\t\ttype: 'clone',\n\t\t\tlabel: m.entrylist_multibutton_clone(),\n\t\t\tgradient: 'gradient-secondary',\n\t\t\ticon: 'ic:round-content-copy',\n\t\t\ttextColor: 'text-white',\n\t\t\trequiresSelection: true,\n\t\t\tdangerLevel: 'low'\n\t\t},\n\t\t{\n\t\t\ttype: 'delete',\n\t\t\tlabel: m.button_delete(),\n\t\t\tgradient: 'gradient-error',\n\t\t\ticon: 'ic:round-delete-forever',\n\t\t\ttextColor: 'text-white',\n\t\t\tshortcut: 'Alt+Del',\n\t\t\tshortcutKey: 'Delete',\n\t\t\trequiresSelection: true,\n\t\t\tdangerLevel: 'high'\n\t\t}\n\t];\n\n\t// --- State ---\n\tlet isDropdownOpen = $state(false);\n\tlet manualActionSet = $state(false);\n\tlet dropdownRef = $state<HTMLElement | null>(null);\n\tlet hoveredAction = $state<ActionType | null>(null);\n\tlet isProcessing = $state(false);\n\n\t// Dropdown keyboard navigation\n\tlet focusedIndex = $state(0);\n\tlet menuItemRefs = $state<HTMLButtonElement[]>([]);\n\n\t// Connection Awareness\n\tlet isSlowConnection = $state(false);\n\tconst batchSizeLimit = $derived(isSlowConnection ? 10 : 50);\n\n\t// --- Derived State ---\n\tconst currentAction = $derived((storeListboxValue.value as ActionType) || 'create');\n\n\tconst currentConfig = $derived.by(() => {\n\t\tconst config = ACTION_CONFIGS.find((c) => c.type === currentAction);\n\t\treturn config || ACTION_CONFIGS[0]; // Fallback to create\n\t});\n\n\t// Aggregate stats for smart filtering\n\tconst stats = $derived.by(() => {\n\t\tconst items = selectedItems || [];\n\t\tconst published = items.filter((i: any) => i.status === StatusTypes.publish).length;\n\t\tconst drafts = items.filter((i: any) => (i.status || i.raw_status) === StatusTypes.draft).length;\n\t\treturn { published, drafts, total: items.length };\n\t});\n\n\t// Dynamic label with selection count\n\tconst dynamicLabel = $derived.by(() => {\n\t\tif (isProcessing) {\n\t\t\treturn `${m.button_loading()}...`;\n\t\t}\n\t\tif (selectedCount < 2 || currentAction === 'create') {\n\t\t\treturn currentConfig.label;\n\t\t}\n\t\treturn `Bulk ${currentConfig.label} (${selectedCount})`;\n\t});\n\n\t// Available dropdown actions (filtered)\n\tconst availableActions = $derived.by(() => {\n\t\treturn ACTION_CONFIGS.filter((config) => {\n\t\t\t// Don't show current action in dropdown\n\t\t\tif (config.type === currentAction) return false;\n\t\t\t// Always hide create from dropdown\n\t\t\tif (config.type === 'create') return false;\n\n\t\t\t// Hide redundant actions based on selection\n\t\t\tif (hasSelections) {\n\t\t\t\tif (config.type === 'publish' && stats.published === selectedCount) return false;\n\t\t\t\tif (config.type === 'unpublish' && stats.drafts === selectedCount && stats.published === 0) return false;\n\t\t\t\tif (config.type === 'draft' && stats.drafts === selectedCount) return false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t});\n\n\t// --- Effects ---\n\n\t// Smart action selection based on selection state\n\t$effect(() => {\n\t\tif (isCollectionEmpty) {\n\t\t\tstoreListboxValue.set('create');\n\t\t\tmanualActionSet = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (manualActionSet) return;\n\n\t\tif (!hasSelections) {\n\t\t\tif (currentAction !== 'create') storeListboxValue.set('create');\n\t\t\treturn;\n\t\t}\n\n\t\t// Selection logic: prioritize Unpublish if only published items are selected\n\t\tif (stats.published > 0 && stats.published === selectedCount) {\n\t\t\tif (currentAction !== 'unpublish') storeListboxValue.set('unpublish');\n\t\t} else {\n\t\t\t// Mixed or Drafts: prioritize Publish\n\t\t\tif (currentAction !== 'publish') storeListboxValue.set('publish');\n\t\t}\n\t});\n\n\t// Connection awareness\n\t$effect(() => {\n\t\tif (typeof navigator !== 'undefined' && 'connection' in navigator) {\n\t\t\tconst conn = (navigator as any).connection;\n\t\t\tif (conn) {\n\t\t\t\tconst checkConnection = () => {\n\t\t\t\t\tisSlowConnection = conn.saveData || conn.effectiveType === 'slow-2g' || conn.effectiveType === '2g';\n\t\t\t\t};\n\t\t\t\tcheckConnection();\n\t\t\t\tconn.addEventListener('change', checkConnection);\n\t\t\t\treturn () => conn.removeEventListener('change', checkConnection);\n\t\t\t}\n\t\t}\n\t});\n\n\t// Click outside handler\n\t$effect(() => {\n\t\tif (!isDropdownOpen) return;\n\n\t\tconst handleClickOutside = (event: MouseEvent) => {\n\t\t\tconst target = event.target as HTMLElement;\n\t\t\tif (dropdownRef && !dropdownRef.contains(target)) {\n\t\t\t\tisDropdownOpen = false;\n\t\t\t}\n\t\t};\n\n\t\tconst timer = setTimeout(() => {\n\t\t\tdocument.addEventListener('click', handleClickOutside);\n\t\t}, 10);\n\n\t\treturn () => {\n\t\t\tclearTimeout(timer);\n\t\t\tdocument.removeEventListener('click', handleClickOutside);\n\t\t};\n\t});\n\n\t// --- Keyboard Shortcuts ---\n\tfunction handleKeyDown(e: KeyboardEvent) {\n\t\t// Dropdown navigation when open\n\t\tif (isDropdownOpen) {\n\t\t\tswitch (e.key) {\n\t\t\t\tcase 'Escape':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tisDropdownOpen = false;\n\t\t\t\t\treturn;\n\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfocusedIndex = Math.min(focusedIndex + 1, availableActions.length - 1);\n\t\t\t\t\tmenuItemRefs[focusedIndex]?.focus();\n\t\t\t\t\treturn;\n\t\t\t\tcase 'ArrowUp':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfocusedIndex = Math.max(focusedIndex - 1, 0);\n\t\t\t\t\tmenuItemRefs[focusedIndex]?.focus();\n\t\t\t\t\treturn;\n\t\t\t\tcase 'Home':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfocusedIndex = 0;\n\t\t\t\t\tmenuItemRefs[0]?.focus();\n\t\t\t\t\treturn;\n\t\t\t\tcase 'End':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfocusedIndex = availableActions.length - 1;\n\t\t\t\t\tmenuItemRefs[focusedIndex]?.focus();\n\t\t\t\t\treturn;\n\t\t\t\tcase 'Enter':\n\t\t\t\tcase ' ':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconst action = availableActions[focusedIndex];\n\t\t\t\t\tif (action && !(action.requiresSelection && !hasSelections)) {\n\t\t\t\t\t\thandleAction(action.type);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Global shortcuts with Alt key\n\t\tif (!e.altKey) return;\n\n\t\tconst matchedConfig = ACTION_CONFIGS.find((config) => {\n\t\t\tif (!config.shortcutKey) return false;\n\t\t\treturn e.key.toLowerCase() === config.shortcutKey.toLowerCase() || e.key === config.shortcutKey;\n\t\t});\n\n\t\tif (matchedConfig) {\n\t\t\te.preventDefault();\n\t\t\tif (matchedConfig.requiresSelection && !hasSelections) {\n\t\t\t\tlogger.debug(`[MultiButton] Keyboard shortcut ${matchedConfig.shortcut} requires selection`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\thandleAction(matchedConfig.type);\n\t\t}\n\t}\n\n\tonMount(() => {\n\t\twindow.addEventListener('keydown', handleKeyDown);\n\t});\n\n\tonDestroy(() => {\n\t\twindow.removeEventListener('keydown', handleKeyDown);\n\t});\n\n\t// --- Action Handlers ---\n\tasync function handleAction(action: ActionType) {\n\t\tisDropdownOpen = false;\n\n\t\t// Validate batch size\n\t\tif (selectedCount > batchSizeLimit && isSlowConnection) {\n\t\t\tconst limitMsg = m.entrylist_multibutton_limit_warning\n\t\t\t\t? m.entrylist_multibutton_limit_warning({ count: batchSizeLimit })\n\t\t\t\t: 'Slow connection: Batch size limited';\n\t\t\tshowToast(limitMsg, 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\t// IMMEDIATE EXECUTION - No Queue, No Undo\n\t\tawait executeAction(action);\n\t}\n\n\tasync function executeAction(action: ActionType) {\n\t\tisProcessing = true;\n\t\ttry {\n\t\t\tswitch (action) {\n\t\t\t\tcase 'create':\n\t\t\t\t\tcreate();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'publish':\n\t\t\t\t\tawait publish();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'unpublish':\n\t\t\t\t\tawait unpublish();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'draft':\n\t\t\t\t\tawait draft();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'clone':\n\t\t\t\t\tawait clone();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\t// Delete usually has its own confirmation in parent if triggering via deleteAction?\n\t\t\t\t\t// If not, we should probably confirm. But user said \"only DELETE need a confirmation modal\".\n\t\t\t\t\t// Assuming deleteAction triggers the modal logic or actual delete.\n\t\t\t\t\tawait deleteAction(showDeleted);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'schedule':\n\t\t\t\t\tconst now = new Date().toISOString();\n\t\t\t\t\tschedule(now, 'publish');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconst errMsg = (error as Error).message;\n\t\t\tshowToast(errMsg, 'error');\n\t\t\tlogger.error(`[MultiButton] Action ${action} failed:`, error);\n\t\t} finally {\n\t\t\tisProcessing = false;\n\t\t}\n\t}\n\n\tfunction toggleDropdown(e: MouseEvent) {\n\t\te.stopPropagation();\n\t\tisDropdownOpen = !isDropdownOpen;\n\t}\n\n\tfunction handleOptionClick(event: Event, actionType: ActionType) {\n\t\tevent.preventDefault();\n\t\tstoreListboxValue.set(actionType);\n\t\tmanualActionSet = true;\n\t\tisDropdownOpen = false;\n\t}\n\n\tfunction handleMainButtonClick() {\n\t\thandleAction(currentAction);\n\t}\n</script>\n\n<!-- Multi-button group -->\n<div class=\"relative flex items-center\" bind:this={dropdownRef}>\n\t<div class=\"flex items-center gap-0\">\n\t\t<!-- Archive Toggle -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonclick={() => (showDeleted = !showDeleted)}\n\t\t\tclass=\"mt-1 btn rounded-full mr-2 transition-all duration-200 active:scale-90 {!showDeleted\n\t\t\t\t? 'preset-outlined-surface-500 '\n\t\t\t\t: 'preset-filled-error-500 text-white ring-2 ring-error-500 animate-pulse'}\"\n\t\t\ttitle={showDeleted ? m.entrylist_multibutton_show_active() : m.entrylist_multibutton_show_archived()}\n\t\t\taria-label={showDeleted ? m.entrylist_multibutton_viewing_archived() : m.entrylist_multibutton_viewing_active()}\n\t\t\taria-pressed={showDeleted}\n\t\t>\n\t\t\t<iconify-icon icon={showDeleted ? 'ic:round-archive' : 'ic:round-unarchive'} width=\"24\"></iconify-icon>\n\t\t</button>\n\n\t\t<!-- svelte-ignore a11y_click_events_have_key_events -->\n\t\t<!-- svelte-ignore a11y_no_static_element_interactions -->\n\t\t<div\n\t\t\tclass=\"group/main relative flex items-center shadow-xl overflow-visible transition-all duration-200 {!hasSelections\n\t\t\t\t? 'active:scale-95 cursor-pointer'\n\t\t\t\t: ''} rounded-l-full rounded-r-md border border-white/20\"\n\t\t\tonclick={!hasSelections ? handleMainButtonClick : undefined}\n\t\t>\n\t\t\t<!-- Main Contextual Button -->\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tonclick={hasSelections ? handleMainButtonClick : undefined}\n\t\t\t\tdisabled={isProcessing}\n\t\t\t\tclass=\"h-[40px] min-w-[60px] md:min-w-[140px] rtl:rotate-180 font-bold transition-all duration-200\n\t\t\t\t\t{hasSelections ? 'active:scale-95' : 'pointer-events-none'} \n\t\t\t\t\t{currentConfig.gradient} {currentConfig.textColor} \n\t\t\t\t\trounded-l-full rounded-r-none px-6 flex items-center gap-2 border-r border-white\n\t\t\t\t\tdisabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\taria-label={dynamicLabel}\n\t\t\t\taria-busy={isProcessing}\n\t\t\t>\n\t\t\t\t{#if isProcessing}\n\t\t\t\t\t<iconify-icon icon=\"svg-spinners:ring-resize\" width=\"24\" class=\"animate-spin\"></iconify-icon>\n\t\t\t\t{:else}\n\t\t\t\t\t<iconify-icon icon={currentConfig.icon} width=\"24\"></iconify-icon>\n\t\t\t\t{/if}\n\t\t\t\t<span class=\"hidden md:inline-block\">{dynamicLabel}</span>\n\t\t\t</button>\n\n\t\t\t<!-- Selection Badge -->\n\t\t\t{#if hasSelections && selectedCount > 0}\n\t\t\t\t<span\n\t\t\t\t\tclass=\"absolute left-0.5 top-3 flex h-5 w-5 items-center justify-center rounded-full bg-surface-500 text-xs font-bold text-white animate-pulse shadow-lg\"\n\t\t\t\t\ttransition:scale={{ duration: 200, easing: quintOut }}\n\t\t\t\t>\n\t\t\t\t\t{selectedCount}\n\t\t\t\t</span>\n\t\t\t{/if}\n\n\t\t\t<!-- Dropdown Toggle -->\n\t\t\t{#if !isCollectionEmpty}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonclick={hasSelections ? toggleDropdown : undefined}\n\t\t\t\t\tdisabled={!hasSelections || isProcessing}\n\t\t\t\t\tclass=\"h-[40px] w-[32px] border-l border-white/20 transition-all duration-200 text-white flex items-center justify-center shadow-inner\n\t\t\t\t\t\t{hasSelections && !isProcessing\n\t\t\t\t\t\t? 'bg-surface-500 hover:bg-surface-400 active:scale-95 cursor-pointer'\n\t\t\t\t\t\t: currentConfig.gradient + ' pointer-events-none opacity-90'}\"\n\t\t\t\t\taria-haspopup=\"menu\"\n\t\t\t\t\taria-expanded={isDropdownOpen}\n\t\t\t\t\taria-label={m.entrylist_multibutton_toggle_menu()}\n\t\t\t\t>\n\t\t\t\t\t{#if hasSelections}\n\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\ticon=\"ic:round-keyboard-arrow-down\"\n\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\tclass=\"transition-transform duration-200 {isDropdownOpen ? 'rotate-180' : ''}\"\n\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t{/if}\n\n\t\t\t<!-- Dropdown Menu -->\n\t\t\t{#if isDropdownOpen}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute right-0 top-full z-50 mt-2 w-64 overflow-hidden rounded-xl bg-surface-800 shadow-2xl ring-1 ring-black/20 backdrop-blur-md\"\n\t\t\t\t\trole=\"menu\"\n\t\t\t\t\taria-label={m.entrylist_multibutton_available_actions()}\n\t\t\t\t\ttransition:scale={{ duration: 150, easing: quintOut, start: 0.95, opacity: 0 }}\n\t\t\t\t>\n\t\t\t\t\t<ul class=\"flex flex-col\">\n\t\t\t\t\t\t{#each availableActions as config (config.type)}\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\tclass=\"border-b border-black/10 last:border-0 relative\"\n\t\t\t\t\t\t\t\trole=\"none\"\n\t\t\t\t\t\t\t\tonmouseenter={() => (hoveredAction = config.type)}\n\t\t\t\t\t\t\t\tonmouseleave={() => (hoveredAction = null)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonclick={(e) => handleOptionClick(e, config.type)}\n\t\t\t\t\t\t\t\t\trole=\"menuitem\"\n\t\t\t\t\t\t\t\t\tclass=\"group/item relative flex w-full items-center gap-3 px-4 py-3 text-left text-white transition-all duration-200\"\n\t\t\t\t\t\t\t\t\taria-label=\"{config.label} {config.shortcut ? `(${config.shortcut})` : ''}\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<!-- Hover Gradient Overlay -->\n\t\t\t\t\t\t\t\t\t<div class=\"absolute inset-0 {config.gradient} opacity-0 transition-opacity duration-200 group-hover/item:opacity-100\"></div>\n\n\t\t\t\t\t\t\t\t\t<!-- Icon -->\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"relative z-10 flex h-8 w-8 items-center justify-center rounded-full bg-surface-700 transition-transform group-hover/item:scale-110\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<iconify-icon icon={config.icon} width=\"18\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<!-- Label & Shortcut -->\n\t\t\t\t\t\t\t\t\t<div class=\"relative z-10 flex-1\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"font-semibold\">{config.label}</div>\n\t\t\t\t\t\t\t\t\t\t{#if config.shortcut}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-surface-400\">{config.shortcut}</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<!-- Hover Indicator -->\n\t\t\t\t\t\t\t\t\t{#if hoveredAction === config.type}\n\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:chevron-right\" width=\"18\" class=\"relative z-10 text-white\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<!-- Danger Badge -->\n\t\t\t\t\t\t\t\t\t{#if config.dangerLevel === 'high'}\n\t\t\t\t\t\t\t\t\t\t<span class=\"relative z-10 rounded bg-error-500/30 px-1.5 py-0.5 text-xs font-bold text-error-300\"></span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.menu-dropdown {\n\t\tanimation: slideDown 0.2s ease-out;\n\t}\n\n\t@keyframes slideDown {\n\t\tfrom {\n\t\t\topacity: 0;\n\t\t\ttransform: translateY(-10px);\n\t\t}\n\t\tto {\n\t\t\topacity: 1;\n\t\t\ttransform: translateY(0);\n\t\t}\n\t}\n</style>\n","<!--\n@file src/components/TranslationStatus.svelte\n@component\n**Translation status component for displaying translation progress per language.**\n\nFIXES:\n1. Multi-field support - tracks all translatable fields in a collection\n2. Widget-aware - properly handles widgets with multiple inputs (like SEO)\n3. Field-level granularity - individual field progress tracking\n\n@example\n<TranslationStatus />\n-->\n\n<script lang=\"ts\">\n\timport { logger } from '@shared/utils/logger';\n\timport { untrack } from 'svelte';\n\timport { SvelteSet } from 'svelte/reactivity';\n\timport { publicEnv } from '@shared/stores/globalSettings.svelte';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/state';\n\timport { collection, collectionValue, mode } from '@shared/stores/collectionStore.svelte';\n\timport { contentLanguage, translationProgress } from '@shared/stores/store.svelte';\n\timport { getFieldName } from '@shared/utils/utils';\n\timport { getLanguageName } from '@shared/utils/languageUtils';\n\n\t// SkeletonUI\n\timport { Progress, Menu, Portal } from '@skeletonlabs/skeleton-svelte';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\timport type { Locale } from '@shared/paraglide/runtime';\n\n\t// State\n\tlet isInitialized = $state(false);\n\tlet completionTotals = $state({ total: 0, translated: 0 });\n\n\t// Derived values\n\tconst availableLanguages = $derived.by(() => {\n\t\tconst languages = publicEnv?.AVAILABLE_CONTENT_LANGUAGES;\n\t\tif (!languages || !Array.isArray(languages)) {\n\t\t\treturn ['en'] as Locale[];\n\t\t}\n\t\treturn languages as Locale[];\n\t});\n\n\tconst currentLanguage = $derived(contentLanguage.value);\n\tconst currentMode = $derived(mode.value);\n\tconst isViewMode = $derived(currentMode === 'view');\n\n\t// Logic: In View Mode, only show *other* languages (switcher style). In Edit Mode, show all (status style).\n\tconst dropdownLanguages = $derived.by(() => {\n\t\tif (isViewMode) {\n\t\t\treturn availableLanguages.filter((l) => l !== currentLanguage);\n\t\t}\n\t\treturn availableLanguages;\n\t});\n\n\tconst overallPercentage = $derived.by(() => {\n\t\tconst { total, translated } = completionTotals;\n\t\treturn total > 0 ? Math.round((translated / total) * 100) : 0;\n\t});\n\n\tconst showProgress = $derived(translationProgress.value?.show || completionTotals.total > 0);\n\n\t// Calculate language-specific progress\n\tconst languageProgress = $derived.by(() => {\n\t\tconst progress: Record<string, number> = {};\n\t\tconst currentProgress = translationProgress.value;\n\n\t\tfor (const lang of availableLanguages) {\n\t\t\tconst langProgress = currentProgress?.[lang as Locale];\n\t\t\tif (langProgress && langProgress.total.size > 0) {\n\t\t\t\tprogress[lang] = Math.round((langProgress.translated.size / langProgress.total.size) * 100);\n\t\t\t} else {\n\t\t\t\tprogress[lang] = 0;\n\t\t\t}\n\t\t}\n\n\t\treturn progress;\n\t});\n\n\t// Helper functions\n\tfunction getProgressColor(value: number): string {\n\t\tif (value >= 80) return 'bg-primary-500';\n\t\tif (value >= 40) return 'bg-warning-500';\n\t\treturn 'bg-error-500';\n\t}\n\n\tfunction getTextColor(value: number): string {\n\t\treturn getProgressColor(value).replace('bg-', 'text-');\n\t}\n\n\t/**\n\t * FIXED: Multi-field translation detection\n\t * Handles complex widgets like SEO with nested language objects\n\t */\n\tfunction isFieldTranslated(value: unknown): boolean {\n\t\tif (value === null || value === undefined) return false;\n\n\t\t// Handle string values (simple fields)\n\t\tif (typeof value === 'string') return value.trim() !== '';\n\n\t\t// Handle object values (complex widgets like SEO)\n\t\t// For complex widgets, value might be an object with language keys\n\t\tif (typeof value === 'object' && !Array.isArray(value)) {\n\t\t\tconst obj = value as Record<string, any>;\n\n\t\t\t// Check if this is a language-keyed object (SEO widget pattern)\n\t\t\t// Look for language codes as keys (en, de, fr, etc.)\n\t\t\tconst hasLanguageKeys = availableLanguages.some((lang) => lang in obj);\n\n\t\t\tif (hasLanguageKeys) {\n\t\t\t\t// For language-keyed objects, check if the current language has content\n\t\t\t\tconst langData = obj[currentLanguage as string];\n\t\t\t\tif (!langData) return false;\n\n\t\t\t\t// Check if any required field in the language data has content\n\t\t\t\t// For SEO: check title and description\n\t\t\t\tif ('title' in langData && typeof langData.title === 'string') {\n\t\t\t\t\treturn langData.title.trim() !== '';\n\t\t\t\t}\n\t\t\t\tif ('description' in langData && typeof langData.description === 'string') {\n\t\t\t\t\treturn langData.description.trim() !== '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// For other objects, check if they have any meaningful content\n\t\t\treturn Object.values(obj).some((v) => {\n\t\t\t\tif (typeof v === 'string') return v.trim() !== '';\n\t\t\t\tif (typeof v === 'number') return true;\n\t\t\t\tif (Array.isArray(v)) return v.length > 0;\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\t// Handle arrays and other types\n\t\tif (Array.isArray(value)) return value.length > 0;\n\t\treturn Boolean(value);\n\t}\n\n\t/**\n\t * FIXED: Widget-aware field name generation\n\t * Handles both simple and complex (multi-input) widgets\n\t */\n\t// Updated to handle both generic widgets with simple values and multi-field widgets\n\tfunction getTranslatableFieldPath(collectionName: string, field: any): string[] {\n\t\tconst baseName = `${collectionName}.${getFieldName(field)}`;\n\t\t// Check if widget has a custom path definition (Generic Architecture)\n\t\tif (field.widget?.getTranslatablePaths) {\n\t\t\treturn field.widget.getTranslatablePaths(baseName);\n\t\t}\n\n\t\t// Fallback for simple widgets\n\t\treturn [baseName];\n\t}\n\n\t// Initialize translation progress\n\tfunction initializeTranslationProgress(currentCollection: { fields: unknown[]; name?: unknown; _id?: string }): void {\n\t\tconst newProgress: typeof translationProgress.value = { show: false };\n\n\t\tfor (const lang of availableLanguages) {\n\t\t\tnewProgress[lang] = {\n\t\t\t\ttotal: new SvelteSet<string>(),\n\t\t\t\ttranslated: new SvelteSet<string>()\n\t\t\t};\n\t\t}\n\n\t\tlet hasTranslatableFields = false;\n\n\t\t// Iterate through all fields\n\t\tfor (const field of currentCollection.fields as { translated?: boolean; label: string; widget?: any }[]) {\n\t\t\tif (field.translated) {\n\t\t\t\thasTranslatableFields = true;\n\n\t\t\t\t// Get all trackable paths for this field\n\t\t\t\tconst fieldPaths = getTranslatableFieldPath(currentCollection.name as string, field);\n\n\t\t\t\t// Add each path to all languages\n\t\t\t\tfor (const lang of availableLanguages) {\n\t\t\t\t\tfieldPaths.forEach((path) => {\n\t\t\t\t\t\tnewProgress[lang]?.total.add(path);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tnewProgress.show = hasTranslatableFields;\n\t\ttranslationProgress.value = newProgress;\n\t}\n\n\t/**\n\t * FIXED: Multi-field progress tracking\n\t * Properly handles complex widgets with nested language data\n\t */\n\tfunction updateTranslationProgressFromFields(\n\t\tcurrentCollection: { fields: unknown[]; name?: unknown },\n\t\tcurrentCollectionValue: Record<string, any>\n\t): void {\n\t\tconst newProgress = { ...translationProgress.value };\n\t\tlet hasUpdates = false;\n\n\t\tfor (const lang of availableLanguages) {\n\t\t\tconst originalLangProgress = newProgress[lang];\n\t\t\tif (!originalLangProgress) continue;\n\n\t\t\tconst newTranslatedSet = new SvelteSet(originalLangProgress.translated);\n\t\t\tlet langHasUpdates = false;\n\n\t\t\tfor (const field of currentCollection.fields as { translated?: boolean; label: string; widget?: any }[]) {\n\t\t\t\tif (field.translated) {\n\t\t\t\t\tconst dbFieldName = getFieldName(field, false);\n\t\t\t\t\tconst fieldValue = currentCollectionValue[dbFieldName];\n\n\t\t\t\t\t// Get all trackable paths for this field\n\t\t\t\t\tconst fieldPaths = getTranslatableFieldPath(currentCollection.name as string, field);\n\n\t\t\t\t\t// Check translation status for each path\n\t\t\t\t\tfieldPaths.forEach((fullPath) => {\n\t\t\t\t\t\t// Extract sub-field name if present (e.g., \"title\" from \"seo.title\")\n\t\t\t\t\t\tconst pathParts = fullPath.split('.');\n\t\t\t\t\t\tconst subFieldName = pathParts.length > 2 ? pathParts[pathParts.length - 1] : null;\n\n\t\t\t\t\t\tlet valueToCheck: unknown;\n\n\t\t\t\t\t\tif (subFieldName && fieldValue && typeof fieldValue === 'object') {\n\t\t\t\t\t\t\t// For complex widgets, check the language-specific sub-field\n\t\t\t\t\t\t\tconst langData = (fieldValue as Record<string, any>)[lang];\n\t\t\t\t\t\t\tvalueToCheck = langData?.[subFieldName];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// For simple widgets, check the language-specific value\n\t\t\t\t\t\t\tif (fieldValue && typeof fieldValue === 'object' && !Array.isArray(fieldValue)) {\n\t\t\t\t\t\t\t\tvalueToCheck = (fieldValue as Record<string, any>)[lang];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalueToCheck = fieldValue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst isTranslated = isFieldTranslated(valueToCheck);\n\t\t\t\t\t\tconst wasTranslated = originalLangProgress.translated.has(fullPath);\n\n\t\t\t\t\t\tif (isTranslated && !wasTranslated) {\n\t\t\t\t\t\t\tnewTranslatedSet.add(fullPath);\n\t\t\t\t\t\t\tlangHasUpdates = true;\n\t\t\t\t\t\t} else if (!isTranslated && wasTranslated) {\n\t\t\t\t\t\t\tnewTranslatedSet.delete(fullPath);\n\t\t\t\t\t\t\tlangHasUpdates = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (langHasUpdates) {\n\t\t\t\tnewProgress[lang] = {\n\t\t\t\t\t...originalLangProgress,\n\t\t\t\t\ttranslated: newTranslatedSet\n\t\t\t\t};\n\t\t\t\thasUpdates = true;\n\t\t\t}\n\t\t}\n\n\t\tif (hasUpdates) {\n\t\t\ttranslationProgress.value = newProgress;\n\t\t\tcalculateCompletionTotals();\n\t\t}\n\t}\n\n\t// Calculate overall completion totals\n\tfunction calculateCompletionTotals(): void {\n\t\tconst progress = translationProgress.value;\n\t\tlet total = 0;\n\t\tlet translated = 0;\n\n\t\tfor (const lang of availableLanguages) {\n\t\t\tconst langProgress = progress[lang as Locale];\n\t\t\tif (!langProgress) continue;\n\t\t\ttranslated += langProgress.translated.size;\n\t\t\ttotal += langProgress.total.size;\n\t\t}\n\n\t\tcompletionTotals = { total, translated };\n\t}\n\n\t// Dropdown positioning handled by Skeleton Menu\n\n\tfunction handleLanguageChange(selectedLanguage: Locale): void {\n\t\tlogger.debug('[TranslationStatus] Language change:', contentLanguage.value, '', selectedLanguage);\n\t\tcontentLanguage.set(selectedLanguage);\n\n\t\t// Handle View Mode Navigation (previously handleViewModeLanguageChange)\n\t\tif (isViewMode) {\n\t\t\tconst currentCollectionId = collection.value?._id;\n\t\t\tconst currentSearch = page.url.search;\n\n\t\t\tif (currentCollectionId) {\n\t\t\t\tconst newPath = `/${selectedLanguage}/${currentCollectionId}${currentSearch}`;\n\t\t\t\tgoto(newPath, { replaceState: false, invalidateAll: true });\n\t\t\t} else {\n\t\t\t\tconst currentPath = page.url.pathname;\n\t\t\t\tconst pathParts = currentPath.split('/').filter(Boolean);\n\t\t\t\tif (pathParts.length > 0) {\n\t\t\t\t\tpathParts[0] = selectedLanguage;\n\t\t\t\t\tconst newPath = '/' + pathParts.join('/') + currentSearch;\n\t\t\t\t\tgoto(newPath, { replaceState: false, invalidateAll: true });\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof window !== 'undefined') {\n\t\t\tconst currentPath = window.location.pathname;\n\t\t\tconst pathParts = currentPath.split('/').filter(Boolean);\n\n\t\t\tif (pathParts.length > 0) {\n\t\t\t\tpathParts[0] = selectedLanguage;\n\t\t\t\tconst newPath = '/' + pathParts.join('/') + window.location.search;\n\t\t\t\twindow.history.replaceState({}, '', newPath);\n\t\t\t\tlogger.debug('[TranslationStatus] Updated URL to:', newPath);\n\t\t\t}\n\n\t\t\tconst customEvent = new CustomEvent('languageChanged', {\n\t\t\t\tdetail: { language: selectedLanguage },\n\t\t\t\tbubbles: true\n\t\t\t});\n\t\t\twindow.dispatchEvent(customEvent);\n\t\t\tlogger.debug('[TranslationStatus] Dispatched languageChanged event');\n\t\t}\n\t}\n\n\t// Effects\n\tlet lastEntryId = $state<string | undefined>(undefined);\n\tlet lastCollectionId = $state<string | undefined>(undefined);\n\n\t$effect(() => {\n\t\tconst currentCollection = collection.value;\n\t\tconst currentEntry = collectionValue.value as { _id?: string } | undefined;\n\t\tconst entryId = currentEntry?._id;\n\t\tconst collectionId = currentCollection?._id;\n\n\t\tconst collectionChanged = collectionId !== lastCollectionId;\n\t\tconst entryChanged = entryId !== lastEntryId;\n\n\t\tif (currentCollection?.fields && (collectionChanged || entryChanged)) {\n\t\t\tlogger.debug('[TranslationStatus] Initializing translation progress', {\n\t\t\t\tcollectionId,\n\t\t\t\tentryId,\n\t\t\t\tcollectionChanged,\n\t\t\t\tentryChanged,\n\t\t\t\tmode: entryId ? 'edit' : 'create'\n\t\t\t});\n\n\t\t\tuntrack(() => {\n\t\t\t\tisInitialized = false;\n\t\t\t\tinitializeTranslationProgress(currentCollection);\n\n\t\t\t\tif (entryId && currentEntry && Object.keys(currentEntry).length > 0) {\n\t\t\t\t\tupdateTranslationProgressFromFields(currentCollection, currentEntry);\n\t\t\t\t} else {\n\t\t\t\t\tcalculateCompletionTotals();\n\t\t\t\t}\n\n\t\t\t\tisInitialized = true;\n\t\t\t\tlastEntryId = entryId;\n\t\t\t\tlastCollectionId = collectionId;\n\t\t\t});\n\t\t}\n\t});\n\n\tlet lastCollectionValueStr = $state<string>('');\n\t$effect(() => {\n\t\tconst currentCollection = collection.value;\n\t\tconst currentCollectionValue = collectionValue.value as Record<string, any>;\n\n\t\tif (currentCollection?.fields && currentCollectionValue && Object.keys(currentCollectionValue).length > 0 && isInitialized) {\n\t\t\tconst currentStr = JSON.stringify(currentCollectionValue);\n\t\t\tif (currentStr !== lastCollectionValueStr) {\n\t\t\t\tlogger.debug('[TranslationStatus] Collection value changed, updating progress');\n\t\t\t\tupdateTranslationProgressFromFields(currentCollection, currentCollectionValue);\n\t\t\t\tlastCollectionValueStr = currentStr;\n\t\t\t}\n\t\t}\n\t});\n</script>\n\n<div class=\"translation-status-container relative mt-1 inline-block text-left\">\n\t<Menu>\n\t\t<Menu.Trigger\n\t\t\tclass=\"btn preset-outlined-surface-500 rounded-full flex w-full items-center gap-1 p-1.5 transition-all duration-200 hover:scale-105\"\n\t\t\taria-label=\"Toggle language menu\"\n\t\t>\n\t\t\t<span class=\"font-medium md:hidden\">{currentLanguage.toUpperCase()}</span>\n\t\t\t<span class=\"font-medium hidden md:inline\">{getLanguageName(currentLanguage)}</span>\n\t\t\t<iconify-icon icon=\"mdi:chevron-down\" class=\"h-5 w-5 transition-transform duration-200\" aria-hidden=\"true\"></iconify-icon>\n\t\t</Menu.Trigger>\n\n\t\t<Portal>\n\t\t\t<Menu.Positioner>\n\t\t\t\t<Menu.Content\n\t\t\t\t\tclass=\"card p-2 shadow-xl preset-filled-surface-100-900 z-9999 border border-surface-200 dark:border-surface-500 {showProgress &&\n\t\t\t\t\t!isViewMode\n\t\t\t\t\t\t? 'w-72'\n\t\t\t\t\t\t: 'w-56'}\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"px-3 py-2 text-xs font-bold text-tertiary-500 dark:text-primary-500 uppercase tracking-wider text-center border-b border-surface-200 dark:border-surface-50 mb-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{m.applayout_contentlanguage()}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#each dropdownLanguages as lang (lang)}\n\t\t\t\t\t\t{@const percentage = languageProgress[lang] || 0}\n\t\t\t\t\t\t{@const isActive = currentLanguage === lang}\n\n\t\t\t\t\t\t<Menu.Item value={lang} onclick={() => handleLanguageChange(lang as Locale)} class={isActive ? 'bg-primary-500/20' : ''}>\n\t\t\t\t\t\t\t<div class=\"flex w-full items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t<!-- Left: Language Name (Desktop) / Short Code (Mobile) -->\n\t\t\t\t\t\t\t\t<span class=\"font-medium transition-colors duration-200 {isActive ? 'text-primary-700 dark:text-primary-300' : ''}\">\n\t\t\t\t\t\t\t\t\t<span class=\"md:hidden\">{lang.toUpperCase()}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"hidden md:inline\">{getLanguageName(lang)}</span>\n\t\t\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t\t\t<!-- Right: Code, Status, Progress -->\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t{#if !isViewMode && showProgress && translationProgress.value?.[lang as Locale]}\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex w-32 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Progress class=\"transition-all duration-300\" value={percentage} aria-hidden=\"true\" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"min-w-8 text-right text-sm font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t\t{percentage}%\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<!-- View Mode: Show Code on Right -->\n\t\t\t\t\t\t\t\t\t\t<span class=\"hidden text-xs font-normal text-tertiary-500 dark:text-primary-500 md:inline\">{lang.toUpperCase()}</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if isActive}\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-xs\" aria-label=\"Current language\"></span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Menu.Item>\n\t\t\t\t\t{/each}\n\n\t\t\t\t\t{#if !isViewMode && showProgress}\n\t\t\t\t\t\t<Menu.Separator />\n\t\t\t\t\t\t<div class=\"px-4 py-2\">\n\t\t\t\t\t\t\t<div class=\"mb-1 text-center text-xs font-medium text-tertiary-500 dark:text-primary-500\">\n\t\t\t\t\t\t\t\t{m.translationsstatus_completed()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between gap-3\">\n\t\t\t\t\t\t\t\t{#if overallPercentage}\n\t\t\t\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t\t\t\t<Progress class=\"transition-all duration-300\" value={overallPercentage} aria-hidden=\"true\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t<span class=\"min-w-10 text-right text-sm font-bold {getTextColor(overallPercentage)}\">\n\t\t\t\t\t\t\t\t\t{overallPercentage}%\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</Menu.Content>\n\t\t\t</Menu.Positioner>\n\t\t</Portal>\n\t</Menu>\n\n\t<div class=\"mt-0.5 transition-all duration-300\">\n\t\t<!-- External progress bar removed to prevent header overflow -->\n\t</div>\n</div>\n","<!--\n@file src/components/collectionDisplay/EntryList.svelte\n@component\n**EntryList component to display collections data in a tabular format.**\n\n### Features:\n- **Search & Filter**: Real-time server-side search and field-level filtering.\n- **Pagination**: Configurable rows per page and page navigation.\n- **Selection**: Multi-select entries for bulk actions.\n- **Sorting**: Clickable headers for server-side sorting.\n- **Preloading**: Hover-based predictive data preloading for faster navigation.\n- **Smart Actions**: Integrated with `EntryList_MultiButton` for context-aware operations.\n\n### Props\n- `entries` (Array): The raw collection entry data from the server.\n- `pagination` (Object): Pagination metadata (currentPage, pageSize, totalItems, pagesCount).\n- `contentLanguage` (String): The language for displaying translatable field data.\n- `breadcrumb` (Array, optional): Breadcrumb navigation paths.\n- `collectionStats` (Object, optional): Stats like count and last modified.\n\n### Keyboard Shortcuts\n- `Alt + N`: Create new entry\n- `Alt + P`: Publish selected\n- `Alt + U`: Unpublish selected\n- `Alt + D`: Move selected to Draft\n- `Alt + Del`: Delete selected\n-->\n\n<script module lang=\"ts\">\n\texport type SortOrder = 0 | 1 | -1; // Strict type for sort order\n</script>\n\n<script lang=\"ts\">\n\timport { logger } from '@shared/utils/logger';\n\timport { goto, invalidateAll } from '$app/navigation';\n\timport { page } from '$app/state';\n\timport { browser } from '$app/environment';\n\timport { untrack } from 'svelte';\n\n\t// Utils\n\timport { batchDeleteEntries, deleteEntry, invalidateCollectionCache, updateEntryStatus } from '@shared/utils/apiClient';\n\timport { formatDisplayDate } from '@shared/utils/dateUtils';\n\timport { cloneEntries, setEntriesStatus } from '@shared/utils/entryActions';\n\timport { debounce, getFieldName, meta_data } from '@shared/utils/utils';\n\timport { preloadEntry, reflectModeInURL } from '@shared/utils/navigationUtils';\n\timport { showToast } from '@shared/utils/toast';\n\n\t// Config\n\timport { publicEnv } from '@shared/stores/globalSettings.svelte';\n\n\t// Types\n\timport type { PaginationSettings, TableHeader } from '@cms-types/content';\n\timport type { StatusType } from '@cms-types/content';\n\timport { StatusTypes } from '@cms-types/content';\n\n\t// Stores\n\timport { collection, collectionValue, mode, setCollectionValue, setMode, setModifyEntry, statusMap } from '@shared/stores/collectionStore.svelte';\n\timport { screen } from '@shared/stores/screenSizeStore.svelte';\n\timport { app } from '@shared/stores/store.svelte';\n\timport { ui } from '@shared/stores/UIStore.svelte';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Components\n\timport FloatingInput from '@cms/components/system/inputs/floatingInput.svelte';\n\timport Status from '@cms/components/system/table/Status.svelte';\n\timport TableFilter from '@cms/components/system/table/TableFilter.svelte';\n\timport TableIcons from '@cms/components/system/table/TableIcons.svelte';\n\timport TablePagination from '@cms/components/system/table/TablePagination.svelte';\n\timport EntryListMultiButton from './EntryList_MultiButton.svelte';\n\timport TranslationStatus from './TranslationStatus.svelte';\n\n\t// Skeleton\n\timport { showDeleteConfirm, showStatusChangeConfirm } from '@shared/utils/modalUtils';\n\n\t// Svelte-dnd-action\n\timport { dndzone } from 'svelte-dnd-action';\n\timport { flip } from 'svelte/animate';\n\n\t// =================================================================\n\t// 1. RECEIVE DATA AS PROPS (From +page.server.ts)\n\t// =================================================================\n\timport type { EntryListProps } from '@cms-types/content';\n\n\t// =================================================================\n\t// 1. RECEIVE DATA AS PROPS (From +page.server.ts)\n\t// =================================================================\n\tconst {\n\t\tentries: serverEntries = [],\n\t\tpagination: serverPagination = { currentPage: 1, pageSize: 10, totalItems: 0, pagesCount: 1 },\n\t\tcontentLanguage: propContentLanguage,\n\t\tbreadcrumb = [],\n\t\tcollectionStats = null\n\t}: EntryListProps & {\n\t\tbreadcrumb?: Array<{ name: string; path: string }>;\n\t\tcollectionStats?: { _id: string; name: string; count: number; lastModified: string } | null;\n\t} = $props();\n\n\t// =================================================================\n\t// 2. USE SERVER DATA (Simple $derived - No Client-Side State)\n\t// =================================================================\n\tconst tableData = $derived(serverEntries);\n\tconst pagesCount = $derived(serverPagination.pagesCount);\n\tconst totalItems = $derived(serverPagination.totalItems);\n\n\t// =================================================================\n\t// 3. URL-BASED NAVIGATION (Replaces All Client-Side Fetching)\n\t// =================================================================\n\tfunction updateURL(updates: Record<string, string | number | null>) {\n\t\tconst newUrl = new URL(page.url);\n\t\tObject.entries(updates).forEach(([key, value]) => {\n\t\t\tif (value === null || value === '') {\n\t\t\t\tnewUrl.searchParams.delete(key);\n\t\t\t} else {\n\t\t\t\tnewUrl.searchParams.set(key, String(value));\n\t\t\t}\n\t\t});\n\t\tgoto(newUrl, { keepFocus: true, noScroll: true });\n\t}\n\n\tfunction onUpdatePage(newPage: number) {\n\t\tentryListPaginationSettings.currentPage = newPage;\n\t\tupdateURL({ page: newPage });\n\t}\n\n\tfunction onUpdateRowsPerPage(rows: number) {\n\t\tentryListPaginationSettings.rowsPerPage = rows;\n\t\tentryListPaginationSettings.currentPage = 1;\n\t\tupdateURL({ page: 1, pageSize: rows });\n\t}\n\n\tfunction onSortChange(fieldName: string) {\n\t\tconst newSorted = { ...entryListPaginationSettings.sorting };\n\t\tif (newSorted.sortedBy === fieldName) {\n\t\t\tnewSorted.isSorted = newSorted.isSorted === 1 ? -1 : ((newSorted.isSorted === -1 ? 0 : 1) as SortOrder);\n\t\t\tif (newSorted.isSorted === 0) newSorted.sortedBy = '';\n\t\t} else {\n\t\t\tnewSorted.sortedBy = fieldName;\n\t\t\tnewSorted.isSorted = 1;\n\t\t}\n\t\tentryListPaginationSettings.sorting = newSorted;\n\t\tupdateURL({\n\t\t\tsort: newSorted.sortedBy || null,\n\t\t\torder: newSorted.isSorted === 1 ? 'asc' : newSorted.isSorted === -1 ? 'desc' : null\n\t\t});\n\t}\n\n\tconst filterDebounce = debounce(500);\n\n\tfunction onFilterChange(filterName: string, value: string) {\n\t\tfilterDebounce(() => {\n\t\t\tconst newFilters = { ...entryListPaginationSettings.filters };\n\t\t\tif (value) {\n\t\t\t\tnewFilters[filterName] = value;\n\t\t\t} else {\n\t\t\t\tdelete newFilters[filterName];\n\t\t\t}\n\t\t\tentryListPaginationSettings.filters = newFilters;\n\n\t\t\t// Build filter URL params\n\t\t\tconst filterUpdates: Record<string, string | null> = {};\n\t\t\tObject.entries(newFilters).forEach(([key, val]) => {\n\t\t\t\tfilterUpdates[`filter_${key}`] = val || null;\n\t\t\t});\n\t\t\tfilterUpdates.page = '1'; // Reset to page 1 on filter change\n\t\t\tupdateURL(filterUpdates);\n\t\t});\n\t}\n\n\tasync function onActionSuccess() {\n\t\t// Clear selections\n\t\tObject.keys(selectedMap).forEach((key) => delete selectedMap[key]);\n\t\tSelectAll = false;\n\t\t// Tell SvelteKit to re-run the server load function\n\t\tawait invalidateAll();\n\t}\n\n\t// =================================================================\n\t// 4. KEEP REMAINING UI STATE & LOGIC (Selection, Display, etc.)\n\t// =================================================================\n\n\tlet SelectAll: boolean = $state(false);\n\tconst selectedMap: Record<string, boolean> = $state({});\n\n\t// =================================================================\n\t// 5. HOVER PRELOADING FOR EDIT MODE (Enterprise UX Optimization)\n\t// =================================================================\n\tlet hoverPreloadTimeout: ReturnType<typeof setTimeout> | null = null;\n\tconst preloadedEntries = new Map();\n\n\tconst PRELOAD_CACHE_TTL = 30000; // ms - keep preloaded data for 30 seconds\n\n\t// Phase 2: Connection-aware preloading\n\tlet isSlowConnection = $state(false);\n\tlet isPreloadEnabled = $state(true);\n\n\t// Phase 2: Predictive preloading - track hover patterns\n\tconst hoverPatterns = new Map(); // entryId -> hover count\n\tconst predictivePreloadQueue: string[] = [];\n\n\t// Detect connection speed\n\t$effect(() => {\n\t\tif (browser && 'connection' in navigator) {\n\t\t\tconst conn = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection;\n\t\t\tif (conn) {\n\t\t\t\tconst checkConnection = () => {\n\t\t\t\t\tconst effectiveType = conn.effectiveType;\n\t\t\t\t\tconst saveData = conn.saveData;\n\t\t\t\t\tisSlowConnection = saveData || effectiveType === 'slow-2g' || effectiveType === '2g';\n\t\t\t\t\tisPreloadEnabled = !isSlowConnection;\n\t\t\t\t};\n\t\t\t\tcheckConnection();\n\t\t\t\tconn.addEventListener('change', checkConnection);\n\t\t\t\treturn () => conn.removeEventListener('change', checkConnection);\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction handleRowHoverStart(entryId: string) {\n\t\t// Phase 2: Respect connection awareness\n\t\tif (!isPreloadEnabled) {\n\t\t\tlogger.debug('[Preload] Disabled on slow connection');\n\t\t\treturn;\n\t\t}\n\n\t\t//  Use SvelteKit's preloadData\n\t\tpreloadEntry(entryId, page.url.pathname);\n\n\t\t// Phase 2: Track hover patterns for predictive preloading\n\t\tconst currentCount = hoverPatterns.get(entryId) || 0;\n\t\thoverPatterns.set(entryId, currentCount + 1);\n\n\t\t// Phase 2: Predictive preloading - queue frequently hovered entries\n\t\tif (currentCount >= 2) {\n\t\t\tpredictivePreloadQueue.push(entryId);\n\t\t}\n\t}\n\n\tfunction handleRowHoverEnd() {\n\t\t// Cancel pending preload if user moves mouse away quickly\n\t\tif (hoverPreloadTimeout) {\n\t\t\tclearTimeout(hoverPreloadTimeout);\n\t\t\thoverPreloadTimeout = null;\n\t\t}\n\t}\n\n\t// Phase 2: Batch preloading during idle time\n\tasync function batchPreloadVisibleEntries() {\n\t\tif (!isPreloadEnabled || !browser) return;\n\n\t\t// Use requestIdleCallback for background loading\n\t\tif ('requestIdleCallback' in window) {\n\t\t\t(window as any).requestIdleCallback(\n\t\t\t\tasync (deadline: any) => {\n\t\t\t\t\tlet i = 0;\n\t\t\t\t\tconst entriesToPreload = tableData.slice(0, 5); // First 5 visible entries\n\n\t\t\t\t\twhile (i < entriesToPreload.length && deadline.timeRemaining() > 0) {\n\t\t\t\t\t\tconst entry = entriesToPreload[i];\n\t\t\t\t\t\tconst cached = preloadedEntries.get(entry._id);\n\n\t\t\t\t\t\tif (!cached || Date.now() - cached.timestamp > PRELOAD_CACHE_TTL) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst preloadUrl = new URL(page.url);\n\t\t\t\t\t\t\t\tpreloadUrl.searchParams.set('edit', entry._id);\n\n\t\t\t\t\t\t\t\t// Use new warm-cache endpoint for batch preloading\n\t\t\t\t\t\t\t\tawait fetch('/api/collections/warm-cache', {\n\t\t\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\tcollectionId: currentCollection?._id,\n\t\t\t\t\t\t\t\t\t\tentryIds: [entry._id] // We could batch this further if we refactor the loop\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Keep existing preload for edit page data if needed, or rely on warm cache\n\t\t\t\t\t\t\t\t/* await fetch(preloadUrl.toString(), {\n\t\t\t\t\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\t\t\t\t\theaders: { 'X-Preload': 'true', 'X-Batch-Preload': 'true' }\n\t\t\t\t\t\t\t\t}); */\n\n\t\t\t\t\t\t\t\tpreloadedEntries.set(entry._id, {\n\t\t\t\t\t\t\t\t\tdata: null,\n\t\t\t\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t\t\t\t\thoverCount: 0\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tlogger.debug(`[Batch Preload] Entry ${entry._id.substring(0, 8)} preloaded during idle`);\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\tlogger.warn('[Batch Preload] Failed:', error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{ timeout: 2000 }\n\t\t\t);\n\t\t}\n\t}\n\n\t// Trigger batch preload when data changes\n\t$effect(() => {\n\t\tif (tableData.length > 0 && currentMode === 'view') {\n\t\t\t// Delay to avoid interfering with initial page load\n\t\t\tsetTimeout(() => batchPreloadVisibleEntries(), 2000);\n\t\t}\n\t});\n\n\t// Cleanup preload cache periodically\n\t$effect(() => {\n\t\tconst cleanupInterval = setInterval(() => {\n\t\t\tconst now = Date.now();\n\t\t\tfor (const [entryId, cached] of preloadedEntries.entries()) {\n\t\t\t\tif (now - cached.timestamp > PRELOAD_CACHE_TTL) {\n\t\t\t\t\tpreloadedEntries.delete(entryId);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 10000); // Cleanup every 10 seconds\n\n\t\treturn () => clearInterval(cleanupInterval);\n\t});\n\n\t// DND Logic for Headers\n\tfunction handleDndConsider(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t}\n\n\tfunction handleDndFinalize(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t\tentryListPaginationSettings.displayTableHeaders = displayTableHeaders;\n\t}\n\n\t// Pagination\n\tconst defaultPaginationSettings = (collectionId: string | null): PaginationSettings => ({\n\t\tcollectionId: collectionId,\n\t\tdensity: 'normal',\n\t\tsorting: { sortedBy: '', isSorted: 0 as SortOrder },\n\t\tcurrentPage: 1,\n\t\trowsPerPage: 10,\n\t\tfilters: {}, // Will be populated by an effect based on tableHeaders\n\t\tdisplayTableHeaders: []\n\t});\n\tlet entryListPaginationSettings = $state(defaultPaginationSettings(collection.value?._id ?? null));\n\n\t// Load settings from localStorage\n\t$effect(() => {\n\t\tif (browser && collection.value?._id) {\n\t\t\tconst key = `entryListPaginationSettings_${collection.value._id}`;\n\t\t\tconst saved = localStorage.getItem(key);\n\t\t\tif (saved) {\n\t\t\t\ttry {\n\t\t\t\t\tconst parsed = JSON.parse(saved);\n\t\t\t\t\t// Ensure we don't overwrite with stale data structure, merge carefully if needed\n\t\t\t\t\t// For now, assume saved state is valid but ensure collectionId matches\n\t\t\t\t\tif (parsed.collectionId === collection.value._id) {\n\t\t\t\t\t\t// We need to match the Shape of PaginationSettings\n\t\t\t\t\t\tentryListPaginationSettings = {\n\t\t\t\t\t\t\t...defaultPaginationSettings(collection.value._id),\n\t\t\t\t\t\t\t...parsed\n\t\t\t\t\t\t\t// Ensure displayTableHeaders are re-verified against current schema later by existing effects\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Failed to load entry list settings', e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t// Save settings to localStorage\n\t$effect(() => {\n\t\tif (browser && collection.value?._id && entryListPaginationSettings) {\n\t\t\tconst key = `entryListPaginationSettings_${collection.value._id}`;\n\t\t\t// Debounce save slightly or just save? $effect runs after render.\n\t\t\t// Use untrack? No, we want to track entryListPaginationSettings.\n\t\t\tconst stringified = JSON.stringify(entryListPaginationSettings);\n\t\t\tlocalStorage.setItem(key, stringified);\n\t\t}\n\t});\n\n\t// Simplified stable state management\n\tlet showDeleted = $state(false); // Controls whether to view active or archived entries\n\tlet globalSearchValue = $state('');\n\tlet expand = $state(false);\n\tlet filterShow = $state(false);\n\tlet columnShow = $state(false);\n\tconst currentStates = $derived.by(() => ({\n\t\tlanguage: app.contentLanguage,\n\t\tsystemLanguage: app.systemLanguage,\n\t\tmode: mode.value,\n\t\tcollection: collection.value,\n\t\tscreenSize: screen.size\n\t}));\n\n\t// Initialize globalSearchValue from URL parameter on mount/navigation\n\t$effect(() => {\n\t\tconst urlSearch = page.url.searchParams.get('search') || '';\n\t\tif (urlSearch !== globalSearchValue) {\n\t\t\tglobalSearchValue = urlSearch;\n\t\t}\n\t});\n\n\t// Reactive effect to update URL when globalSearchValue changes (user typing)\n\t$effect(() => {\n\t\tconst searchValue = globalSearchValue;\n\t\tconst currentUrlSearch = page.url.searchParams.get('search') || '';\n\n\t\t// Skip if values match (avoid loop) or initial empty state\n\t\tif (searchValue === currentUrlSearch) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Use untrack to prevent infinite loops from URL changes\n\t\tuntrack(() => {\n\t\t\tfilterDebounce(() => {\n\t\t\t\tupdateURL({\n\t\t\t\t\tsearch: searchValue || null,\n\t\t\t\t\tpage: searchValue ? 1 : null // Reset to page 1 when searching, preserve page when clearing\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\t// Sync filters from URL parameters\n\t$effect(() => {\n\t\tconst searchParams = page.url.searchParams;\n\t\tuntrack(() => {\n\t\t\tconst newFilters = { ...entryListPaginationSettings.filters };\n\t\t\tlet hasChanges = false;\n\t\t\tlet hasActiveUrlFilters = false;\n\n\t\t\t// Check all filter_ params in URL\n\t\t\tfor (const [key, value] of searchParams.entries()) {\n\t\t\t\tif (key.startsWith('filter_')) {\n\t\t\t\t\tconst filterName = key.replace('filter_', '');\n\t\t\t\t\tif (newFilters[filterName] !== value) {\n\t\t\t\t\t\tnewFilters[filterName] = value;\n\t\t\t\t\t\thasChanges = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (value) hasActiveUrlFilters = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Apply changes if any\n\t\t\tif (hasChanges) {\n\t\t\t\tentryListPaginationSettings.filters = newFilters;\n\t\t\t}\n\n\t\t\t// Auto-open filter row if filters are present in URL\n\t\t\tif (hasActiveUrlFilters && !filterShow) {\n\t\t\t\tfilterShow = true;\n\t\t\t}\n\t\t});\n\t});\n\n\t// Destructure for easier access\n\tconst currentLanguage = $derived(propContentLanguage || currentStates.language);\n\tconst currentMode = $derived(currentStates.mode);\n\tconst currentCollection = $derived(currentStates.collection);\n\n\t// Optimized table headers with better caching\n\tconst tableHeaders = $derived.by((): TableHeader[] => {\n\t\tif (!currentCollection?.fields) return [];\n\n\t\tconst cacheKey = `${currentCollection._id}-${currentCollection.fields.length}`;\n\n\t\tconst schemaHeaders: TableHeader[] = currentCollection.fields.map(\n\t\t\t(field: any): TableHeader => ({\n\t\t\t\tid: `${cacheKey}-${getFieldName(field)}`,\n\t\t\t\tlabel: field.label,\n\t\t\t\tname: getFieldName(field),\n\t\t\t\tvisible: true\n\t\t\t})\n\t\t);\n\n\t\tconst systemHeaders: TableHeader[] = [\n\t\t\t{ id: `${cacheKey}-createdAt`, label: 'createdAt', name: 'createdAt', visible: true },\n\t\t\t{ id: `${cacheKey}-updatedAt`, label: 'updatedAt', name: 'updatedAt', visible: true },\n\t\t\t{ id: `${cacheKey}-status`, label: 'status', name: 'status', visible: true }\n\t\t];\n\n\t\treturn [...schemaHeaders, ...systemHeaders];\n\t});\n\n\t// Effect to initialize/update the filters object in paginationSettings when tableHeaders change\n\t$effect(() => {\n\t\tif (tableHeaders.length > 0) {\n\t\t\tconst newFilters: Record<string, string> = { ...entryListPaginationSettings.filters };\n\t\t\tlet filtersChanged = false;\n\t\t\tfor (const th of tableHeaders) {\n\t\t\t\tif (!(th.name in newFilters)) {\n\t\t\t\t\tnewFilters[th.name] = '';\n\t\t\t\t\tfiltersChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (filtersChanged) {\n\t\t\t\tentryListPaginationSettings.filters = newFilters;\n\t\t\t}\n\t\t} else {\n\t\t\tif (Object.keys(entryListPaginationSettings.filters).length > 0) {\n\t\t\t\tentryListPaginationSettings.filters = {};\n\t\t\t}\n\t\t}\n\t});\n\n\t// displayTableHeaders are the actual headers shown, considering user's order/visibility preferences from localStorage\n\tlet displayTableHeaders: TableHeader[] = $state([]);\n\n\t$effect(() => {\n\t\t// Sync displayTableHeaders with settings or defaults from tableHeaders\n\t\tconst currentCollId = currentCollection?._id;\n\t\tconst settings = entryListPaginationSettings;\n\n\t\tif (tableHeaders.length > 0) {\n\t\t\tif (settings.collectionId === currentCollId && Array.isArray(settings.displayTableHeaders) && settings.displayTableHeaders.length > 0) {\n\t\t\t\tconst schemaHeaderMap = new Map(tableHeaders.map((th) => [th.name, th]));\n\t\t\t\tconst reconciledHeaders: TableHeader[] = [];\n\t\t\t\tconst addedNames = new Set();\n\n\t\t\t\tfor (const savedHeader of settings.displayTableHeaders) {\n\t\t\t\t\tconst schemaHeader = schemaHeaderMap.get(savedHeader.name);\n\t\t\t\t\tif (schemaHeader) {\n\t\t\t\t\t\treconciledHeaders.push({\n\t\t\t\t\t\t\t...schemaHeader,\n\t\t\t\t\t\t\tid: savedHeader.id || schemaHeader.id,\n\t\t\t\t\t\t\tvisible: typeof savedHeader.visible === 'boolean' ? savedHeader.visible : schemaHeader.visible\n\t\t\t\t\t\t});\n\t\t\t\t\t\taddedNames.add(savedHeader.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const schemaHeader of tableHeaders) {\n\t\t\t\t\tif (!addedNames.has(schemaHeader.name)) {\n\t\t\t\t\t\treconciledHeaders.push({ ...schemaHeader, visible: true });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdisplayTableHeaders = reconciledHeaders;\n\t\t\t} else {\n\t\t\t\tdisplayTableHeaders = tableHeaders.map((h) => ({ ...h, visible: true }));\n\t\t\t}\n\t\t} else {\n\t\t\tdisplayTableHeaders = [];\n\t\t}\n\t});\n\n\tconst visibleTableHeaders = $derived(displayTableHeaders.filter((header) => header.visible));\n\n\tlet selectAllColumns = $state(true);\n\t$effect(() => {\n\t\tselectAllColumns = displayTableHeaders.length > 0 ? displayTableHeaders.every((h) => h.visible) : false;\n\t});\n\n\tconst cellPaddingClass = $derived(\n\t\tentryListPaginationSettings.density === 'compact'\n\t\t\t? '!p-1'\n\t\t\t: entryListPaginationSettings.density === 'comfortable'\n\t\t\t\t? '!p-3' // Comfortable\n\t\t\t\t: '!p-2' // Normal\n\t);\n\n\t$effect(() => {\n\t\tif (currentMode === 'view') {\n\t\t\tuntrack(() => {\n\t\t\t\tmeta_data.clear();\n\t\t\t\tconst currentValue = collectionValue;\n\t\t\t\tif (currentValue && Object.keys(currentValue).length > 0) {\n\t\t\t\t\tsetCollectionValue({});\n\t\t\t\t}\n\t\t\t\tconst currentCollId = collection.value?._id;\n\t\t\t\tif (currentCollId) {\n\t\t\t\t\tinvalidateCollectionCache(currentCollId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (currentMode === 'edit') {\n\t\t\tuntrack(() => {\n\t\t\t\tObject.keys(selectedMap).forEach((key) => delete selectedMap[key]);\n\t\t\t\tSelectAll = false;\n\t\t\t});\n\t\t}\n\t});\n\n\tfunction process_selectAllRows(selectAllState: boolean) {\n\t\tif (!Array.isArray(tableData)) return;\n\n\t\tuntrack(() => {\n\t\t\tif (selectAllState) {\n\t\t\t\ttableData.forEach((_entry, index) => {\n\t\t\t\t\tselectedMap[index.toString()] = true;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tObject.keys(selectedMap).forEach((key) => delete selectedMap[key]);\n\t\t\t}\n\t\t});\n\t}\n\n\t$effect(() => {\n\t\tprocess_selectAllRows(SelectAll);\n\t});\n\n\tconst hasSelections = $derived.by(() => {\n\t\treturn Object.values(selectedMap).some((isSelected) => isSelected);\n\t});\n\n\tconst hasActiveFilters = $derived(Object.values(entryListPaginationSettings.filters).some((f) => !!f) || !!globalSearchValue);\n\n\tsetModifyEntry(async (status?: keyof typeof statusMap): Promise<void> => {\n\t\tconst selectedIds = getSelectedIds();\n\t\tif (!selectedIds.length) {\n\t\t\tshowToast('No entries selected', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tshowStatusChangeConfirm({\n\t\t\tstatus: String(status ?? ''),\n\t\t\tcount: selectedIds.length,\n\t\t\tonConfirm: async () => {\n\t\t\t\tawait setEntriesStatus(selectedIds, status as StatusType, onActionSuccess);\n\t\t\t}\n\t\t});\n\t});\n\n\tconst pathSegments = $derived(page.url.pathname.split('/').filter(Boolean));\n\tconst categoryName = $derived.by(() => {\n\t\tif (breadcrumb && breadcrumb.length > 0) {\n\t\t\treturn breadcrumb.map((b: { name: string; path: string }) => b.name).join(' > ');\n\t\t}\n\t\tconst segments = pathSegments?.slice() ?? [];\n\t\tif (segments.length > 0) {\n\t\t\tsegments.shift();\n\t\t}\n\t\treturn segments.slice(0, -1).join('>') || '';\n\t});\n\n\tconst getSelectedIds = () =>\n\t\tObject.entries(selectedMap)\n\t\t\t.filter(([, isSelected]) => isSelected)\n\t\t\t.map(([index]) => tableData[Number(index)]._id);\n\n\tconst getSelectedRawEntries = () =>\n\t\tObject.entries(selectedMap)\n\t\t\t.filter(([, isSelected]) => isSelected)\n\t\t\t.map(([index]) => tableData[Number(index)])\n\t\t\t.filter(Boolean);\n\n\tconst onCreate = async () => {\n\t\tconst newEntry: Record<string, any> = {};\n\t\tif (currentCollection?.fields) {\n\t\t\tfor (const field of currentCollection.fields) {\n\t\t\t\tif (typeof field === 'object' && field !== null && 'label' in field && 'type' in field) {\n\t\t\t\t\tconst fieldName = getFieldName(field as any, false);\n\t\t\t\t\tnewEntry[fieldName] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (collection.value?.status) {\n\t\t\tnewEntry.status = collection.value.status;\n\t\t}\n\n\t\t//  GUI-FIRST PATTERN: Instant mode switch (no data loading needed for create)\n\t\t// 1. Update stores INSTANTLY (no navigation wait)\n\t\tsetMode('create');\n\t\tsetCollectionValue(newEntry);\n\n\t\t// 2. Reflect in URL (passive, no reload)\n\t\treflectModeInURL('create');\n\n\t\t// 3. Toggle UI\n\t\tawait Promise.resolve();\n\t\tui.forceUpdate();\n\n\t\tlogger.debug('[Create] INSTANT - New entry mode');\n\t};\n\n\tconst onPublish = () => setEntriesStatus(getSelectedIds(), StatusTypes.publish, onActionSuccess);\n\tconst onUnpublish = () => setEntriesStatus(getSelectedIds(), StatusTypes.unpublish, onActionSuccess);\n\tconst onDraft = () => setEntriesStatus(getSelectedIds(), StatusTypes.draft, onActionSuccess);\n\tconst onDelete = (isPermanent = false) => {\n\t\tconst selectedIds = getSelectedIds();\n\t\tif (!selectedIds.length) {\n\t\t\tshowToast('No entries selected', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tconst useArchiving = publicEnv?.USE_ARCHIVE_ON_DELETE ?? false;\n\t\tconst isForArchived = showDeleted || isPermanent;\n\t\tconst willDelete = !useArchiving || isForArchived;\n\t\tconst actionVerb = willDelete ? 'delete' : 'archive';\n\n\t\tshowDeleteConfirm({\n\t\t\tisArchive: !willDelete,\n\t\t\tcount: selectedIds.length,\n\t\t\tonConfirm: async () => {\n\t\t\t\ttry {\n\t\t\t\t\tif (willDelete) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst collId = collection.value?._id;\n\t\t\t\t\t\t\tif (collId) {\n\t\t\t\t\t\t\t\tconst result = await batchDeleteEntries(collId, selectedIds);\n\t\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\t\tshowToast(`${selectedIds.length} ${selectedIds.length === 1 ? 'entry' : 'entries'} deleted successfully`, 'success');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthrow new Error('Batch delete failed');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (batchError) {\n\t\t\t\t\t\t\tlogger.warn('Batch delete failed, using individual deletes:', batchError);\n\t\t\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\t\t\tselectedIds.map((entryId) => {\n\t\t\t\t\t\t\t\t\tconst collId = collection.value?._id;\n\t\t\t\t\t\t\t\t\tif (collId) {\n\t\t\t\t\t\t\t\t\t\treturn deleteEntry(collId, entryId);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tshowToast(`${selectedIds.length} ${selectedIds.length === 1 ? 'entry' : 'entries'} deleted successfully`, 'success');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait setEntriesStatus(selectedIds, StatusTypes.archive, () => {});\n\t\t\t\t\t}\n\t\t\t\t\tonActionSuccess();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tshowToast(`Failed to ${actionVerb} entries: ${(error as Error).message}`, 'error');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\tconst onClone = () => cloneEntries(getSelectedRawEntries(), onActionSuccess);\n\n\tconst onSchedule = (date: string) => {\n\t\tconst payload = { _scheduled: new Date(date).getTime() };\n\t\tsetEntriesStatus(getSelectedIds(), StatusTypes.draft, onActionSuccess, payload);\n\t};\n\n\tfunction handleColumnVisibilityToggle(headerToToggle: TableHeader) {\n\t\tdisplayTableHeaders = displayTableHeaders.map((h) => (h.id === headerToToggle.id ? { ...h, visible: !h.visible } : h));\n\t}\n\n\tfunction handleSelectAllColumnsToggle() {\n\t\tconst newVisibility = selectAllColumns;\n\t\tdisplayTableHeaders = displayTableHeaders.map((h) => ({ ...h, visible: newVisibility }));\n\t}\n\n\tfunction resetViewSettings() {\n\t\tconst currentCollId = currentCollection?._id;\n\t\tif (browser && currentCollId) {\n\t\t\tlocalStorage.removeItem(`entryListPaginationSettings_${currentCollId}`);\n\t\t}\n\t\tentryListPaginationSettings = defaultPaginationSettings(currentCollId ?? null);\n\t}\n</script>\n\n<!--Table -->\n{#if !currentCollection}\n\t<div class=\"dark:bg-error-950 flex h-64 flex-col items-center justify-center rounded-lg border border-error-500 bg-error-50 p-8\">\n\t\t<svg class=\"mb-4 h-16 w-16 text-error-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t<path\n\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\tstroke-width=\"2\"\n\t\t\t\td=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n\t\t\t/>\n\t\t</svg>\n\t\t<h3 class=\"mb-2 text-xl font-bold text-error-600 dark:text-error-400\">Collection Not Found</h3>\n\t\t<p class=\"text-center text-error-600 dark:text-error-400\">\n\t\t\tThe requested collection could not be loaded. Please check the collection name and try again.\n\t\t</p>\n\t</div>\n{:else}\n\t<!-- Header -->\n\t<div class=\"mb-2 flex justify-between dark:text-white\">\n\t\t<!-- Row 1 for Mobile -->\n\t\t<div class=\"flex items-center justify-between\">\n\t\t\t<!-- Hamburger -->\n\t\t\t{#if ui.state.leftSidebar === 'hidden'}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonkeydown={() => {}}\n\t\t\t\t\tonclick={() => ui.toggle('leftSidebar', screen.isDesktop ? 'full' : 'collapsed')}\n\t\t\t\t\taria-label=\"Open Sidebar\"\n\t\t\t\t\tclass=\"preset-outlined-surface-500 btn-icon mt-1\"\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon=\"mingcute:menu-fill\" width=\"24\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t{/if}\n\n\t\t\t<!-- Collection type with icon -->\n\t\t\t<div class=\"mr-1 flex flex-col {!ui.state.leftSidebar ? 'ml-2' : 'ml-1 sm:ml-2'}\">\n\t\t\t\t{#if categoryName}\n\t\t\t\t\t<div class=\"mb-2 text-xs capitalize text-surface-500 dark:text-surface-300 rtl:text-left\">\n\t\t\t\t\t\t{categoryName}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t\t<div class=\"-mt-2 flex justify-start text-sm font-bold uppercase dark:text-white md:text-2xl lg:text-xl\">\n\t\t\t\t\t{#if currentCollection?.icon}\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<iconify-icon icon={currentCollection.icon} width=\"24\" class=\"mr-1 text-error-500 sm:mr-2\"></iconify-icon>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t\t{#if currentCollection?.name}\n\t\t\t\t\t\t<div class=\"flex max-w-[85px] whitespace-normal leading-3 sm:mr-2 sm:max-w-none md:mt-0 md:leading-none xs:mt-1\">\n\t\t\t\t\t\t\t{currentCollection.name}\n\t\t\t\t\t\t\t{#if collectionStats}\n\t\t\t\t\t\t\t\t<span class=\"ml-2 text-xs font-normal text-surface-500\">({collectionStats.count})</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"flex items-center justify-between gap-1\">\n\t\t\t<!-- Expand/Collapse -->\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tonkeydown={() => {}}\n\t\t\t\tonclick={() => (expand = !expand)}\n\t\t\t\tclass=\"preset-outlined-surface-500 btn-icon p-1 sm:hidden\"\n\t\t\t\taria-label=\"Expand/Collapse Filters\"\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"material-symbols:filter-list-rounded\" width=\"30\"> </iconify-icon>\n\t\t\t</button>\n\n\t\t\t<!-- Translation Content Language - Mobile -->\n\t\t\t<div class=\"mt-1 sm:hidden\">\n\t\t\t\t<TranslationStatus />\n\t\t\t</div>\n\n\t\t\t<!-- Table Filter with Translation Content Language - Desktop -->\n\t\t\t<div class=\"relative mt-1 hidden items-center justify-center gap-2 sm:flex\">\n\t\t\t\t<TableFilter bind:globalSearchValue bind:filterShow bind:columnShow bind:density={entryListPaginationSettings.density} />\n\t\t\t\t<TranslationStatus />\n\t\t\t</div>\n\n\t\t\t<!-- MultiButton -->\n\t\t\t<div class=\" flex w-full items-center justify-end sm:mt-0 sm:w-auto\">\n\t\t\t\t<EntryListMultiButton\n\t\t\t\t\tisCollectionEmpty={tableData?.length === 0}\n\t\t\t\t\t{hasSelections}\n\t\t\t\t\tselectedCount={Object.values(selectedMap).filter(Boolean).length}\n\t\t\t\t\tselectedItems={getSelectedRawEntries()}\n\t\t\t\t\tbind:showDeleted\n\t\t\t\t\tpublish={onPublish}\n\t\t\t\t\tunpublish={onUnpublish}\n\t\t\t\t\tschedule={onSchedule}\n\t\t\t\t\tdelete={onDelete}\n\t\t\t\t\tdraft={onDraft}\n\t\t\t\t\tclone={onClone}\n\t\t\t\t\tcreate={onCreate}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<!-- Table  Start-->\n\t{#if expand}\n\t\t<div class=\"mb-2 flex items-center justify-center sm:hidden\">\n\t\t\t<TableFilter bind:globalSearchValue bind:filterShow bind:columnShow bind:density={entryListPaginationSettings.density} />\n\t\t</div>\n\t{/if}\n\n\t{#if columnShow}\n\t\t<!-- Column order -->\n\t\t<div class=\"rounded-b-0 flex flex-col justify-center rounded-t-md border-b bg-secondary-100 p-2 text-center dark:bg-surface-700\">\n\t\t\t<div class=\"text-sm dark:text-primary-500\">\n\t\t\t\t{m.entrylist_dnd()}\n\t\t\t</div>\n\t\t\t<!-- Select All Columns -->\n\t\t\t<div class=\"my-2 flex w-full flex-col items-center justify-center gap-2 sm:flex-row sm:gap-4\">\n\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t<label class=\"flex items-center\">\n\t\t\t\t\t\t<input type=\"checkbox\" bind:checked={selectAllColumns} onchange={handleSelectAllColumnsToggle} class=\"mr-1\" />\n\t\t\t\t\t\t{m.entrylist_all()}\n\t\t\t\t\t</label>\n\n\t\t\t\t\t<button class=\"bg-surface-400 btn text-white\" onclick={resetViewSettings}>\n\t\t\t\t\t\t<iconify-icon icon=\"material-symbols-light:device-reset\" width=\"20\" class=\"mr-1 text-white\"></iconify-icon>\n\t\t\t\t\t\tReset View\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<section\n\t\t\t\t\tuse:dndzone={{ items: displayTableHeaders, flipDurationMs: 300, type: 'columns', dropTargetStyle: { outline: 'none' } }}\n\t\t\t\t\tonconsider={handleDndConsider}\n\t\t\t\t\tonfinalize={handleDndFinalize}\n\t\t\t\t\tclass=\"flex w-full flex-wrap justify-center gap-2 p-2 border-2 border-dashed border-secondary-500/50 rounded transition-all hover:border-secondary-500\"\n\t\t\t\t>\n\t\t\t\t\t{#each displayTableHeaders as header (header.id)}\n\t\t\t\t\t\t<div animate:flip={{ duration: 300 }}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"chip {header.visible\n\t\t\t\t\t\t\t\t\t? 'dark:preset-filled-primary-500 preset-filled-tertiary-500'\n\t\t\t\t\t\t\t\t\t: 'ring ring-surface-500 bg-transparent text-secondary-500'} flex items-center justify-center text-xs cursor-move\"\n\t\t\t\t\t\t\t\tonclick={() => handleColumnVisibilityToggle(header)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#if header.visible}<iconify-icon icon=\"fa:check\" class=\"mr-1\"></iconify-icon>{/if}\n\t\t\t\t\t\t\t\t<span class=\"capitalize\">{header.label}</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t{#if tableData.length > 0 || hasActiveFilters}\n\t\t<div class=\"table-container max-h-[calc(100dvh)] overflow-auto\">\n\t\t\t<table class=\"table table-interactive table-hover\">\n\t\t\t\t<!-- Table Header -->\n\t\t\t\t<thead class=\"sticky top-0 z-10 bg-secondary-100 text-tertiary-500 dark:bg-surface-900 dark:text-primary-500\">\n\t\t\t\t\t{#if filterShow && visibleTableHeaders.length > 0}\n\t\t\t\t\t\t<tr class=\"divide-x divide-surface-400 dark:divide-surface-600\">\n\t\t\t\t\t\t\t<th>\n\t\t\t\t\t\t\t\t<!-- Clear All Filters Button -->\n\t\t\t\t\t\t\t\t{#if Object.values(entryListPaginationSettings.filters).some((f) => f !== '')}\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\t\t\t\tconst clearedFilters: Record<string, string> = {};\n\t\t\t\t\t\t\t\t\t\t\tconst urlUpdates: Record<string, string | null> = {};\n\n\t\t\t\t\t\t\t\t\t\t\tObject.keys(entryListPaginationSettings.filters).forEach((key) => {\n\t\t\t\t\t\t\t\t\t\t\t\tclearedFilters[key] = '';\n\t\t\t\t\t\t\t\t\t\t\t\turlUpdates[`filter_${key}`] = null;\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\tentryListPaginationSettings.filters = clearedFilters;\n\t\t\t\t\t\t\t\t\t\t\turlUpdates.page = '1';\n\t\t\t\t\t\t\t\t\t\t\tupdateURL(urlUpdates);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\taria-label=\"Clear All Filters\"\n\t\t\t\t\t\t\t\t\t\tclass=\"preset-outlined-surface-500 btn-icon\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"material-symbols:close\" width=\"18\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<!-- Filter -->\n\t\t\t\t\t\t\t{#each visibleTableHeaders as header (header.id)}\n\t\t\t\t\t\t\t\t<th\n\t\t\t\t\t\t\t\t\t><div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<FloatingInput\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\ticon=\"material-symbols:search-rounded\"\n\t\t\t\t\t\t\t\t\t\t\tlabel={`Filter ${(header as TableHeader).label}`}\n\t\t\t\t\t\t\t\t\t\t\tname={(header as TableHeader).name}\n\t\t\t\t\t\t\t\t\t\t\tvalue={entryListPaginationSettings.filters[(header as TableHeader).name] || ''}\n\t\t\t\t\t\t\t\t\t\t\tonInput={(value: string) => onFilterChange((header as TableHeader).name, value)}\n\t\t\t\t\t\t\t\t\t\t\tinputClass=\"text-xs dark:text-primary-500\"\n\t\t\t\t\t\t\t\t\t\t\ttextColor=\"\"\n\t\t\t\t\t\t\t\t\t\t\tlabelClass=\"dark:text-white\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<tr class=\"divide-x divide-surface-400 border-b border-black dark:border-white\">\n\t\t\t\t\t\t<TableIcons\n\t\t\t\t\t\t\tcellClass={`w-10 ${hasSelections ? 'bg-primary-500/10 dark:bg-secondary-500/20' : ''}`}\n\t\t\t\t\t\t\tchecked={SelectAll}\n\t\t\t\t\t\t\tonCheck={(checked: boolean) => {\n\t\t\t\t\t\t\t\tSelectAll = checked;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{#each visibleTableHeaders as header (header.id)}\n\t\t\t\t\t\t\t<th\n\t\t\t\t\t\t\t\tclass=\"cursor-pointer text-center text-xs sm:text-sm {cellPaddingClass} {(header as TableHeader).name ===\n\t\t\t\t\t\t\t\tentryListPaginationSettings.sorting.sortedBy\n\t\t\t\t\t\t\t\t\t? 'font-semibold text-primary-500 dark:text-secondary-400'\n\t\t\t\t\t\t\t\t\t: 'text-tertiary-500 dark:text-primary-500'}\"\n\t\t\t\t\t\t\t\tonclick={() => onSortChange((header as TableHeader).name)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center\">\n\t\t\t\t\t\t\t\t\t{(header as TableHeader).label}\n\t\t\t\t\t\t\t\t\t{#if (header as TableHeader).name === entryListPaginationSettings.sorting.sortedBy && entryListPaginationSettings.sorting.isSorted !== 0}\n\t\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\t\ticon={entryListPaginationSettings.sorting.isSorted === 1\n\t\t\t\t\t\t\t\t\t\t\t\t? 'material-symbols:arrow-upward-rounded'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'material-symbols:arrow-downward-rounded'}\n\t\t\t\t\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"ml-1 origin-center\"\n\t\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t{#if tableData.length > 0}\n\t\t\t\t\t\t{#each tableData as entry, index (entry._id)}\n\t\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\t\tclass=\"divide-x divide-surface-400 dark:divide-surface-700 {selectedMap[index] ? 'bg-primary-500/5 dark:bg-secondary-500/10' : ''}\"\n\t\t\t\t\t\t\t\tonmouseenter={() => handleRowHoverStart(entry._id)}\n\t\t\t\t\t\t\t\tonmouseleave={handleRowHoverEnd}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TableIcons\n\t\t\t\t\t\t\t\t\tcellClass={`w-10 text-center ${selectedMap[index] ? 'bg-primary-500/10 dark:bg-secondary-500/20' : ''}`}\n\t\t\t\t\t\t\t\t\tchecked={selectedMap[index]}\n\t\t\t\t\t\t\t\t\tonCheck={(isChecked: boolean) => {\n\t\t\t\t\t\t\t\t\t\tselectedMap[index] = isChecked;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{#if visibleTableHeaders}\n\t\t\t\t\t\t\t\t\t{#each visibleTableHeaders as header (header.id)}\n\t\t\t\t\t\t\t\t\t\t<td\n\t\t\t\t\t\t\t\t\t\t\tclass=\"text-center {cellPaddingClass} text-xs font-bold sm:text-sm {(header as TableHeader).name !== 'status'\n\t\t\t\t\t\t\t\t\t\t\t\t? 'cursor-pointer transition-colors duration-200 hover:bg-primary-500/10 dark:hover:bg-secondary-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'cursor-pointer transition-colors duration-200 hover:bg-warning-500/10 dark:hover:bg-warning-500/20'}\"\n\t\t\t\t\t\t\t\t\t\t\ttitle={(header as TableHeader).name !== 'status' ? 'Click to edit this entry' : 'Click to change status'}\n\t\t\t\t\t\t\t\t\t\t\tonclick={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\tif ((header as TableHeader).name === 'status') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Handle single entry status change with modal (same style as multibutton)\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst currentStatus = entry.status || entry.raw_status || 'draft';\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet nextStatus;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Define status progression logic using StatusTypes\n\t\t\t\t\t\t\t\t\t\t\t\t\tswitch (currentStatus) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase StatusTypes.draft:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextStatus = StatusTypes.publish;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase StatusTypes.publish:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextStatus = StatusTypes.unpublish;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase StatusTypes.unpublish:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextStatus = StatusTypes.publish;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase StatusTypes.schedule:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextStatus = StatusTypes.publish;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnextStatus = StatusTypes.publish;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Create modal with same styling as multibutton modals\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowStatusChangeConfirm({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: String(nextStatus),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonConfirm: async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst collId = collection.value?._id;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!collId) return;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst result = await updateEntryStatus(collId, entry._id, String(nextStatus));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowToast(`Entry status updated to ${nextStatus}`, 'success');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonActionSuccess();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowToast(result.error || 'Failed to update entry status', 'error');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.error('Error updating entry status:', error);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowToast('An error occurred while updating entry status', 'error');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// GUI-FIRST PATTERN: Navigate to edit mode (loads full multilingual data)\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst originalEntry = tableData.find((e: any) => e._id === entry._id);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (originalEntry) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Navigate to edit mode - this triggers SSR to load full multilingual data\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// List view has language-projected data, edit mode needs all languages\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst newUrl = `${page.url.pathname}?edit=${originalEntry._id}`;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgoto(newUrl);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlogger.debug(`[Edit] Loading full data for entry ${originalEntry._id}`);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#if (header as TableHeader).name === 'status'}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex w-full items-center justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Status value={entry.status || entry.raw_status || 'draft'} />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{:else if (header as TableHeader).name === 'createdAt' || (header as TableHeader).name === 'updatedAt'}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"font-semibold\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatDisplayDate(entry[(header as TableHeader).name], 'en', { year: 'numeric', month: 'short', day: 'numeric' })}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-surface-500 dark:text-surface-200\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatDisplayDate(entry[(header as TableHeader).name], 'en', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour: '2-digit',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminute: '2-digit',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsecond: '2-digit',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thour12: false\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{:else if typeof entry[(header as TableHeader).name] === 'object' && entry[(header as TableHeader).name] !== null}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const fieldData = entry[(header as TableHeader).name]}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const translatedValue = fieldData[currentLanguage] || Object.values(fieldData)[0] || '-'}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const debugInfo = `Field: ${(header as TableHeader).name}, Lang: ${currentLanguage}, Data: ${JSON.stringify(fieldData)}, Value: ${translatedValue}`}\n\t\t\t\t\t\t\t\t\t\t\t\t{#if (header as TableHeader).name === 'last_name'}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span title={debugInfo}>{@html translatedValue}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{@html translatedValue}\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t{@html entry[(header as TableHeader).name] || '-'}\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan={visibleTableHeaders.length + 1} class=\"p-4 text-center text-surface-500 dark:text-surface-50\"> No results found. </td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/if}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t\t<!-- Pagination -->\n\t\t<div\n\t\t\tclass=\"sticky bottom-0 left-0 right-0 z-10 mt-1 flex flex-col items-center justify-center border-t border-surface-300 bg-secondary-100 dark:text-surface-50 dark:bg-surface-800 md:flex-row md:justify-between md:p-4\"\n\t\t>\n\t\t\t<TablePagination\n\t\t\t\tcurrentPage={serverPagination.currentPage}\n\t\t\t\trowsPerPage={serverPagination.pageSize}\n\t\t\t\t{pagesCount}\n\t\t\t\t{totalItems}\n\t\t\t\t{onUpdatePage}\n\t\t\t\t{onUpdateRowsPerPage}\n\t\t\t/>\n\t\t</div>\n\t{:else}\n\t\t<div class=\"py-10 text-center text-tertiary-500 dark:text-primary-500\">\n\t\t\t<iconify-icon icon=\"bi:exclamation-circle-fill\" height=\"44\" class=\"mb-2\"></iconify-icon>\n\t\t\t<p class=\"text-lg\">\n\t\t\t\t{currentCollection?.name ? m.EntryList_no_collection({ name: currentCollection.name }) : 'No collection selected or collection is empty.'}\n\t\t\t</p>\n\t\t</div>\n\t{/if}\n{/if}\n\n<style>\n\tdiv::-webkit-scrollbar-thumb {\n\t\tborder-radius: 50px;\n\t\tbackground-color: #0ec423;\n\t}\n\tdiv::-webkit-scrollbar {\n\t\twidth: 10px;\n\t}\n</style>\n","<!--\n@file src/components/collectionDisplay/WidgetLoader.svelte\n@component WidgetLoader - Async widget component loader with code-splitting\n\n@description\nThis component enables dynamic, asynchronous loading of widget components,\nsupporting code-splitting for better performance. It loads widgets on-demand\nrather than bundling all widgets upfront.\n\n@example\n<WidgetLoader\n  loader={widgetLoader}\n  field={field}\n  bind:value={entryValue}\n  tenantId={tenantId}\n/>\n\n\n### Features\n- Async component loading with Suspense-like behavior\n- Code-splitting support via import.meta.glob\n- Error boundary with fallback UI\n- Loading state management\n- TypeScript support\n-->\n\n<script lang=\"ts\">\n\timport type { FieldInstance } from '@cms-types/content';\n\timport { onMount } from 'svelte';\n\timport { logger } from '@shared/utils/logger';\n\n\tinterface Props {\n\t\tloader: () => Promise<{ default: any }>;\n\t\tfield: FieldInstance;\n\t\tWidgetData?: Record<string, any>;\n\t\tvalue?: any;\n\t\ttenantId?: string;\n\t}\n\n\tlet { loader, field, WidgetData = {}, value = $bindable(), tenantId }: Props = $props();\n\n\t// Component state\n\tlet component: any = $state(null);\n\tlet loading = $state(true);\n\tlet error = $state<Error | null>(null);\n\n\t// Load the widget component asynchronously\n\tasync function loadComponent() {\n\t\ttry {\n\t\t\tloading = true;\n\t\t\terror = null;\n\n\t\t\tconst module = await loader();\n\t\t\tcomponent = module.default;\n\n\t\t\tlogger.debug('[WidgetLoader] Component loaded:', {\n\t\t\t\twidget: field.widget?.Name || 'unknown',\n\t\t\t\tfield: field.label\n\t\t\t});\n\t\t} catch (err) {\n\t\t\terror = err instanceof Error ? err : new Error(String(err));\n\t\t\tlogger.error('[WidgetLoader] Failed to load component:', {\n\t\t\t\twidget: field.widget?.Name || 'unknown',\n\t\t\t\tfield: field.label,\n\t\t\t\terror: error.message\n\t\t\t});\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\t// Load on mount\n\tonMount(() => {\n\t\tloadComponent();\n\t});\n</script>\n\n{#if loading}\n\t<!-- Loading skeleton -->\n\t<div class=\"widget-loader-skeleton animate-pulse\">\n\t\t<div class=\"mb-2 h-4 w-1/3 rounded bg-surface-300 dark:bg-surface-600\"></div>\n\t\t<div class=\"h-10 w-full rounded bg-surface-200 dark:bg-surface-700\"></div>\n\t</div>\n{:else if error}\n\t<!-- Error fallback -->\n\t<div class=\"widget-loader-error rounded-lg border border-error-500 bg-error-50 p-4 dark:bg-error-900/20\">\n\t\t<div class=\"mb-2 flex items-center gap-2\">\n\t\t\t<iconify-icon icon=\"mdi:alert-circle\" class=\"text-error-500\" width=\"20\"></iconify-icon>\n\t\t\t<span class=\"font-semibold text-error-700 dark:text-error-400\">Widget Load Error</span>\n\t\t</div>\n\t\t<p class=\"text-sm text-error-600 dark:text-error-300\">\n\t\t\tFailed to load widget: <strong>{field.widget?.Name || 'Unknown'}</strong>\n\t\t</p>\n\t\t<p class=\"mt-1 text-xs text-error-500 dark:text-error-400\">{error.message}</p>\n\t\t<button class=\"preset-outlined-error-500 btn-sm mt-3\" onclick={() => loadComponent()}>\n\t\t\t<iconify-icon icon=\"mdi:refresh\" width=\"16\" class=\"mr-1\"></iconify-icon>\n\t\t\tRetry\n\t\t</button>\n\t</div>\n{:else if component}\n\t<!-- Loaded component -->\n\t{@const Component = component}\n\t<Component {field} bind:value {WidgetData} {tenantId} />\n{:else}\n\t<!-- Unexpected state -->\n\t<div class=\"widget-loader-empty rounded border border-warning-500 bg-warning-50 p-3 dark:bg-warning-900/20\">\n\t\t<p class=\"text-sm text-warning-700 dark:text-warning-300\">Widget component not available</p>\n\t</div>\n{/if}\n\n<style>\n\t.widget-loader-skeleton {\n\t\tmin-height: 60px;\n\t}\n\n\t@keyframes pulse {\n\t\t0%,\n\t\t100% {\n\t\t\topacity: 1;\n\t\t}\n\t\t50% {\n\t\t\topacity: 0.5;\n\t\t}\n\t}\n\n\t.animate-pulse {\n\t\tanimation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n\t}\n</style>\n","<!--\n@file src/components/collectionDisplay/Fields.svelte\n@component\n**Fields is a core component that renders collection fields for data entry and provides revision history.**\n\n### Features:\n- **Widget Rendering**: Automatically loads and renders appropriate widgets for each field.\n- **Reactivity**: Binds form data to the `collectionValue` store with real-time sync.\n- **Revision History**: Displays entry revisions with compare and revert functionality.\n- **Validation**: Performs field-level validation based on schema constraints.\n- **Translation Aware**: Manages multilingual data input through widget-integrated language context.\n\n### Props\n- `fields` (Array): The array of field instances from the collection schema.\n- `revisions` (Array): Historical snapshot data for the current entry.\n- `contentLanguage` (String): The language for data entry (GUI remains in systemLanguage).\n\n### Keyboard Shortcuts\n- `Alt + S`: Save currently edited entry (if focused)\n-->\n<script lang=\"ts\">\n\timport { untrack } from 'svelte';\n\timport { getFieldName } from '@shared/utils/utils';\n\timport { logger } from '@shared/utils/logger';\n\n\t// Auth & Page data\n\timport { page } from '$app/state';\n\tconst user = $derived(page.data?.user);\n\tconst tenantId = $derived(page.data?.tenantId);\n\n\t// Stores\n\timport { collection, collectionValue, setCollectionValue } from '@shared/stores/collectionStore.svelte';\n\timport { translationProgress, contentLanguage, dataChangeStore, validationStore } from '@shared/stores/store.svelte';\n\timport { publicEnv } from '@shared/stores/globalSettings.svelte';\n\timport type { Locale } from '@shared/paraglide/runtime';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Skeleton\n\timport { Tabs } from '@skeletonlabs/skeleton-svelte';\n\t// import { CodeBlock, Tab, TabGroup, clipboard } from '@skeletonlabs/skeleton-svelte';\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\n\timport { widgetFunctions as widgetFunctionsStore } from '@shared/stores/widgetStore.svelte';\n\n\t// --- PERFORMANCE FIX: DYNAMIC WIDGET IMPORTS ---\n\t// Lazy-load widgets for code-splitting (eager: false is default)\n\t// Returns loader functions instead of eager-loaded components\n\tconst modules: Record<string, () => Promise<{ default: any }>> = import.meta.glob('/src/widgets/**/*.svelte') as Record<\n\t\tstring,\n\t\t() => Promise<{ default: any }>\n\t>;\n\n\t// Import async widget loader component\n\timport WidgetLoader from './WidgetLoader.svelte';\n\timport { activeInputStore } from '@shared/stores/activeInputStore.svelte';\n\n\t// Token Picker\n\t// Token Picker\n\n\tfunction openTokenPicker(field: any, e: MouseEvent) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\t// Fallback: Try to find the input by ID (using db_fieldName as ID)\n\t\tconst id = field.db_fieldName;\n\t\tconst el = document.getElementById(id) as HTMLInputElement | HTMLTextAreaElement;\n\t\tif (el) {\n\t\t\tel.focus();\n\t\t\tactiveInputStore.set({ element: el, field }); // Explicitly open picker on button click\n\t\t} else {\n\t\t\tconsole.warn('Could not find input for field', field);\n\t\t}\n\t}\n\t// --- END PERFORMANCE FIX ---\n\n\tlet widgetFunctions = $state<Record<string, any>>({});\n\t$effect(() => {\n\t\tconst unsubscribe = widgetFunctionsStore.subscribe((value) => {\n\t\t\twidgetFunctions = value;\n\t\t});\n\t\treturn unsubscribe;\n\t});\n\n\t// --- 1. RECEIVE DATA AS PROPS ---\n\tlet {\n\t\tfields,\n\t\trevisions = []\n\t\t// contentLanguage prop received but not directly used - widgets access contentLanguage store\n\t} = $props<{\n\t\tfields?: NonNullable<(typeof collection)['value']>['fields'];\n\t\trevisions?: any[];\n\t\tcontentLanguage?: string; // Passed for documentation, widgets use store directly\n\t}>();\n\n\t// --- 2. SIMPLIFIED STATE ---\n\tlet localTabSet = $state('0');\n\tlet apiUrl = $state('');\n\n\t// This is form state, not fetched data, so it remains.\n\tlet currentCollectionValue = $state<Record<string, any>>({});\n\n\t// Revisions State (now simpler)\n\tlet selectedRevisionId = $state('');\n\n\t// Track the last entry ID to detect when switching entries\n\tlet lastEntryId = $state<string | undefined>(undefined);\n\n\t// Track current content language for reactivity\n\tlet currentContentLanguage = $state<Locale>(contentLanguage.value as Locale);\n\n\t// React to contentLanguage store changes and update local state\n\t// This ensures widgets remount with the correct language\n\t$effect(() => {\n\t\tconst newLang = contentLanguage.value as Locale;\n\t\tif (currentContentLanguage !== newLang) {\n\t\t\tlogger.debug('Language changed:', currentContentLanguage, '', newLang);\n\t\t\tlogger.debug('Current collectionValue keys:', Object.keys(currentCollectionValue));\n\t\t\t// Update immediately to trigger {#key} block\n\t\t\tcurrentContentLanguage = newLang;\n\t\t\tlogger.debug('Updated currentContentLanguage to:', currentContentLanguage);\n\t\t}\n\t});\n\n\t// --- 3. DERIVED STATE FROM PROPS ---\n\tlet selectedRevision = $derived(revisions.find((r: any) => r._id === selectedRevisionId) || null);\n\n\t// --- 4. SIMPLIFIED LOGIC ---\n\tlet derivedFields = $derived(fields || []);\n\n\t// Get translation progress\n\tlet currentTranslationProgress = $derived(translationProgress.value);\n\n\t// Track changes to translation progress for debugging\n\t$effect(() => {\n\t\tlogger.debug('Translation progress updated:', {\n\t\t\tshowProgress: translationProgress.value?.show,\n\t\t\tlanguages: Object.keys(translationProgress.value || {}).filter((k) => k !== 'show')\n\t\t});\n\t});\n\n\t// Get available languages\n\tlet availableLanguages = $derived.by<Locale[]>(() => {\n\t\t// Wait for publicEnv to be initialized\n\t\tconst languages = publicEnv?.AVAILABLE_CONTENT_LANGUAGES;\n\t\tif (!languages || !Array.isArray(languages)) {\n\t\t\treturn ['en'] as Locale[];\n\t\t}\n\t\treturn languages as Locale[];\n\t});\n\n\t// Helper to get field translation percentage across all languages\n\tfunction getFieldTranslationPercentage(field: any): number {\n\t\tif (!field.translated) return 100; // Not a translatable field\n\n\t\tconst fieldName = `${collection.value?.name}.${getFieldName(field)}`;\n\t\tconst allLangs = availableLanguages; // Use the new derived state\n\n\t\t// Avoid division by zero if no languages are configured\n\t\tif (allLangs.length === 0) return 100;\n\n\t\tlet translatedCount = 0;\n\n\t\t// Count how many languages have this field translated\n\t\tfor (const lang of allLangs) {\n\t\t\tconst langProgress = currentTranslationProgress?.[lang as Locale];\n\t\t\tif (langProgress && langProgress.translated.has(fieldName)) {\n\t\t\t\ttranslatedCount++;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate the overall percentage for this field\n\t\treturn Math.round((translatedCount / allLangs.length) * 100);\n\t}\n\n\t// Helper to get text color based on translation status\n\tfunction getTranslationTextColor(percentage: number): string {\n\t\tif (percentage === 100) return 'text-tertiary-500 dark:text-primary-500';\n\t\treturn 'text-error-500';\n\t}\n\n\tfunction ensureFieldProperties(field: any) {\n\t\tif (!field) return null;\n\t\treturn {\n\t\t\t...field,\n\t\t\tdb_fieldName: field.db_fieldName || getFieldName(field, true),\n\t\t\twidget: field.widget || { Name: field.type || 'Input' },\n\t\t\tpermissions: field.permissions || {}\n\t\t};\n\t}\n\n\tlet filteredFields = $derived(\n\t\tderivedFields\n\t\t\t.map(ensureFieldProperties)\n\t\t\t.filter(Boolean)\n\t\t\t.filter((field: any) => {\n\t\t\t\tif (!field.permissions || page.data?.isAdmin || !user?.role) return true;\n\t\t\t\tconst rolePermissions = field.permissions[user.role];\n\t\t\t\treturn !rolePermissions || rolePermissions.read !== false;\n\t\t\t})\n\t);\n\n\t// Sync local form state with global store\n\t// When collectionValue changes (new entry loaded), update local state\n\t// When local state changes (user editing), update global state\n\t$effect(() => {\n\t\tconst global = collectionValue.value as Record<string, unknown> | undefined;\n\t\tconst globalId = (global as any)?._id;\n\n\t\t// When a new entry is loaded (different ID), pull from global -> local\n\t\tif (globalId && globalId !== lastEntryId) {\n\t\t\tlogger.debug('Loading entry data:', globalId);\n\t\t\tcurrentCollectionValue = { ...global } as any;\n\t\t\tlastEntryId = globalId;\n\t\t\t// Set initial snapshot for change tracking\n\t\t\tdataChangeStore.setInitialSnapshot(global as Record<string, any>);\n\t\t\treturn;\n\t\t}\n\n\t\t// If creating new entry (no ID), initialize with global state\n\t\tif (!globalId && !lastEntryId && global && Object.keys(global).length > 0) {\n\t\t\tlogger.debug('Initializing new entry');\n\t\t\tcurrentCollectionValue = { ...global } as any;\n\t\t\t// Set initial snapshot for change tracking\n\t\t\tdataChangeStore.setInitialSnapshot(global as Record<string, any>);\n\t\t\treturn;\n\t\t}\n\n\t\t// Otherwise, push local changes to global (user is editing)\n\t\t// Use untrack to read currentCollectionValue without creating a dependency loop\n\t\tconst local = untrack(() => currentCollectionValue) as Record<string, unknown> | undefined;\n\t\tif (local && Object.keys(local).length > 0) {\n\t\t\tconst currentDataStr = JSON.stringify(local);\n\t\t\tconst globalDataStr = JSON.stringify(global ?? {});\n\t\t\tif (currentDataStr !== globalDataStr) {\n\t\t\t\tlogger.debug('Pushing local changes to global store');\n\t\t\t\tuntrack(() => setCollectionValue({ ...local }));\n\t\t\t\t// Track changes for save button state\n\t\t\t\tdataChangeStore.compareWithCurrent(local as Record<string, any>);\n\t\t\t}\n\t\t}\n\t});\n\n\t// Separate effect to detect changes in currentCollectionValue and sync to store\n\t// This is needed because the widget bind:value updates currentCollectionValue\n\tlet lastLocalValueStr = $state<string>('');\n\t$effect(() => {\n\t\t// React to currentCollectionValue changes (from widget inputs)\n\t\tconst localStr = JSON.stringify(currentCollectionValue);\n\n\t\t// Skip if this is the initial load or empty\n\t\tif (!currentCollectionValue || Object.keys(currentCollectionValue).length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Only update if value actually changed\n\t\tif (localStr !== lastLocalValueStr) {\n\t\t\tlogger.debug('currentCollectionValue changed, syncing to store');\n\t\t\tlastLocalValueStr = localStr;\n\n\t\t\t// Update the global store (using untrack to avoid creating dependency)\n\t\t\tconst global = untrack(() => collectionValue.value);\n\t\t\tconst globalStr = JSON.stringify(global ?? {});\n\n\t\t\tif (localStr !== globalStr) {\n\t\t\t\tuntrack(() => setCollectionValue({ ...currentCollectionValue }));\n\t\t\t\t// Track changes for save button state\n\t\t\t\tdataChangeStore.compareWithCurrent(currentCollectionValue as Record<string, any>);\n\t\t\t}\n\t\t}\n\t});\n\n\t// --- 5. REFACTORED REVISION LOGIC ---\n\tfunction handleRevert() {\n\t\tif (!selectedRevision?.data) return;\n\t\tshowConfirm({\n\t\t\ttitle: 'Confirm Revert',\n\t\t\tbody: 'Are you sure you want to revert to this version? Any unsaved changes will be lost.',\n\t\t\tconfirmText: 'Revert',\n\t\t\tonConfirm: () => {\n\t\t\t\tconst revertData = { ...selectedRevision.data, _id: (collectionValue as any).value?._id };\n\t\t\t\tsetCollectionValue(revertData);\n\t\t\t\tcurrentCollectionValue = revertData; // also update local state\n\t\t\t\ttoaster.info({ description: 'Content reverted. Please save your changes.' });\n\t\t\t\tlocalTabSet = '0';\n\t\t\t}\n\t\t});\n\t}\n\n\t// --- 6. VALIDATION LOGIC ---\n\t// Reactively validate fields whenever values change\n\t$effect(() => {\n\t\tconst values = currentCollectionValue; // React to value changes\n\n\t\t// Iterate over fields to validate them\n\t\tfilteredFields.forEach((field: any) => {\n\t\t\tif (field.required) {\n\t\t\t\tconst fieldName = getFieldName(field, false);\n\t\t\t\tconst value = values[fieldName];\n\n\t\t\t\t// Check for empty values\n\t\t\t\t// Handle various types: string, array, null, undefined\n\t\t\t\tconst isEmpty =\n\t\t\t\t\tvalue === null || value === undefined || (typeof value === 'string' && value.trim() === '') || (Array.isArray(value) && value.length === 0);\n\n\t\t\t\tif (isEmpty) {\n\t\t\t\t\t// Only set error if it's not already set to avoid loop (though store handles this)\n\t\t\t\t\tif (!validationStore.hasError(fieldName)) {\n\t\t\t\t\t\tvalidationStore.setError(fieldName, `${field.label || fieldName} is required`);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (validationStore.hasError(fieldName)) {\n\t\t\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\t$effect(() => {\n\t\tif ((collectionValue as any).value?._id) {\n\t\t\tapiUrl = `${location.origin}/api/collection/${collection.value?._id}/${(collectionValue as any).value._id}`;\n\t\t}\n\t});\n</script>\n\n<Tabs value={localTabSet} onValueChange={(e) => (localTabSet = e.value)} class=\"flex flex-1 flex-col items-center\">\n\t<Tabs.List\n\t\tclass=\"flex justify-between md:justify-around rounded-tl-container rounded-tr-container border-b border-tertiary-500 dark:border-primary-500 w-full\"\n\t>\n\t\t<Tabs.Trigger value=\"0\" class=\"flex-1\">\n\t\t\t<div class=\"flex items-center justify-center gap-2 py-2\">\n\t\t\t\t<iconify-icon icon=\"mdi:pen\" width=\"20\" class=\"text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t\t{m.button_edit()}\n\t\t\t</div>\n\t\t</Tabs.Trigger>\n\n\t\t{#if collection.value?.revision}\n\t\t\t<Tabs.Trigger value=\"1\" class=\"flex-1\">\n\t\t\t\t<div class=\"flex items-center justify-center gap-2 py-2\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:history\" width=\"20\" class=\"text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t\t\t{m.applayout_version()} <span class=\"preset-filled-secondary-500 badge\">{revisions.length}</span>\n\t\t\t\t</div>\n\t\t\t</Tabs.Trigger>\n\t\t{/if}\n\n\t\t{#if collection.value?.livePreview}\n\t\t\t<Tabs.Trigger value=\"2\" class=\"flex-1\">\n\t\t\t\t<div class=\"flex items-center justify-center gap-2 py-2\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:eye-outline\" width=\"20\" class=\"text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t\t\t{m.Fields_preview()}\n\t\t\t\t</div>\n\t\t\t</Tabs.Trigger>\n\t\t{/if}\n\n\t\t{#if user?.isAdmin}\n\t\t\t<Tabs.Trigger value=\"3\" class=\"flex-1\">\n\t\t\t\t<div class=\"flex items-center justify-center gap-2 py-2\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:api\" width=\"20\" class=\"text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t\t\tAPI\n\t\t\t\t</div>\n\t\t\t</Tabs.Trigger>\n\t\t{/if}\n\t</Tabs.List>\n\n\t<Tabs.Content value=\"0\" class=\"w-full\">\n\t\t<div class=\"mb-2 text-center text-xs text-error-500\">{m.form_required()}</div>\n\t\t<div class=\"rounded-md border bg-white px-4 py-6 drop-shadow-2xl dark:border-surface-500 dark:bg-surface-900\">\n\t\t\t<div class=\"flex flex-wrap items-center justify-center gap-1 overflow-auto\">\n\t\t\t\t{#each filteredFields as rawField (rawField.db_fieldName || rawField.id || rawField.label || rawField.name)}\n\t\t\t\t\t{#if rawField.widget}\n\t\t\t\t\t\t{@const field = ensureFieldProperties(rawField)}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"mx-auto text-center {!field?.width ? 'w-full ' : 'max-md:w-full!'}\"\n\t\t\t\t\t\t\tstyle={'min-width:min(300px,100%);' + (field.width ? `width:calc(${Math.floor(100 / field?.width)}% - 0.5rem)` : '')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between gap-2 px-[5px] text-start field-label\">\n\t\t\t\t\t\t\t\t<!-- Field label -->\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<p class=\"inline-block font-semibold capitalize\">\n\t\t\t\t\t\t\t\t\t\t{field.label || field.db_fieldName}\n\t\t\t\t\t\t\t\t\t\t{#if field.required}<span class=\"text-error-500\">*</span>{/if}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tonclick={(e) => openTokenPicker(field, e)}\n\t\t\t\t\t\t\t\t\t\tclass=\"\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Insert Token\"\n\t\t\t\t\t\t\t\t\t\taria-label=\"Insert token into {field.label}\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:code-braces\" width=\"16\" class=\"font-bold text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<!-- Translation status -->\n\t\t\t\t\t\t\t\t\t{#if field.translated}\n\t\t\t\t\t\t\t\t\t\t{@const percentage = getFieldTranslationPercentage(field)}\n\t\t\t\t\t\t\t\t\t\t{@const textColor = getTranslationTextColor(percentage)}\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"bi:translate\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium text-tertiary-500 dark:text-primary-500\">{currentContentLanguage.toUpperCase()}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium {textColor}\">({percentage}%)</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<!-- Icon for field type -->\n\t\t\t\t\t\t\t\t\t{#if field.icon}\n\t\t\t\t\t\t\t\t\t\t<iconify-icon icon={field.icon} width=\"20\" class=\"text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if field.widget}\n\t\t\t\t\t\t\t\t{@const widgetName = field.widget.Name}\n\n\t\t\t\t\t\t\t\t<!-- --- PERFORMANCE FIX: ROBUST WIDGET FINDER --- -->\n\t\t\t\t\t\t\t\t{@const loadedWidget = (() => {\n\t\t\t\t\t\t\t\t\t// 1. Try exact path from widget store (fastest)\n\t\t\t\t\t\t\t\t\tconst storePath = widgetFunctions[widgetName]?.componentPath;\n\t\t\t\t\t\t\t\t\tif (storePath && storePath in modules) return modules[storePath];\n\n\t\t\t\t\t\t\t\t\t// 2. Try casing variations from store\n\t\t\t\t\t\t\t\t\tconst camelPath = widgetFunctions[widgetName.charAt(0).toLowerCase() + widgetName.slice(1)]?.componentPath;\n\t\t\t\t\t\t\t\t\tif (camelPath && camelPath in modules) return modules[camelPath];\n\n\t\t\t\t\t\t\t\t\tconst lowerPath = widgetFunctions[widgetName.toLowerCase()]?.componentPath;\n\t\t\t\t\t\t\t\t\tif (lowerPath && lowerPath in modules) return modules[lowerPath];\n\n\t\t\t\t\t\t\t\t\t// 3. Robust Search in modules (fallback)\n\t\t\t\t\t\t\t\t\tconst normalized = widgetName.toLowerCase();\n\t\t\t\t\t\t\t\t\tfor (const path in modules) {\n\t\t\t\t\t\t\t\t\t\tconst lowerPath = path.toLowerCase();\n\t\t\t\t\t\t\t\t\t\tconst parts = lowerPath.split('/');\n\t\t\t\t\t\t\t\t\t\tconst fileName = parts.pop();\n\t\t\t\t\t\t\t\t\t\tconst folderName = parts.pop();\n\n\t\t\t\t\t\t\t\t\t\t// A. Match 3-Pillar Structure: /WidgetName/Input.svelte\n\t\t\t\t\t\t\t\t\t\t// IMPORTANT: Enforce folder name matches widget name to avoid matching other widgets' Input.svelte\n\t\t\t\t\t\t\t\t\t\tif (folderName === normalized && fileName === 'input.svelte') return modules[path];\n\n\t\t\t\t\t\t\t\t\t\t// B. Match 3-Pillar Index: /WidgetName/index.svelte\n\t\t\t\t\t\t\t\t\t\tif (folderName === normalized && fileName === 'index.svelte') return modules[path];\n\n\t\t\t\t\t\t\t\t\t\t// C. Match Single File: /WidgetName.svelte\n\t\t\t\t\t\t\t\t\t\t// EXCEPTION: Do not loosely match \"Input.svelte\" as it causes collisions with standard 3-pillar components\n\t\t\t\t\t\t\t\t\t\tif (fileName === `${normalized}.svelte` && normalized !== 'input') return modules[path];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t\t\t{#if loadedWidget}\n\t\t\t\t\t\t\t\t\t{@const fieldName = getFieldName(field, false)}\n\t\t\t\t\t\t\t\t\t{#key currentContentLanguage}\n\t\t\t\t\t\t\t\t\t\t<!-- Widget remounts when currentContentLanguage changes -->\n\t\t\t\t\t\t\t\t\t\t<WidgetLoader loader={loadedWidget} {field} WidgetData={{}} bind:value={currentCollectionValue[fieldName]} {tenantId} />\n\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<p class=\"text-error-500\">{m.Fields_no_widgets_found({ name: widgetName })}</p>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t<!-- --- END PERFORMANCE FIX --- -->\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t</div>\n\t</Tabs.Content>\n\t<Tabs.Content value=\"1\" class=\"w-full\">\n\t\t<div class=\"p-4\">\n\t\t\t{#if revisions.length === 0}\n\t\t\t\t<p class=\"p-4 text-center text-surface-500\">No revision history found for this entry.</p>\n\t\t\t{:else}\n\t\t\t\t<div class=\"mb-4 flex items-center justify-between gap-4\">\n\t\t\t\t\t<select class=\"select grow\" bind:value={selectedRevisionId}>\n\t\t\t\t\t\t<option value=\"\" disabled>-- Select a revision to compare --</option>\n\t\t\t\t\t\t{#each revisions as revision (revision._id)}\n\t\t\t\t\t\t\t<option value={revision._id}>\n\t\t\t\t\t\t\t\t{new Date(revision.revision_at).toLocaleString()} by {revision.revision_by.substring(0, 8)}...\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</select>\n\t\t\t\t\t<button class=\"preset-filled-primary-500 btn\" onclick={handleRevert} disabled={!selectedRevision?.data}>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:restore\" class=\"mr-1\"></iconify-icon> Revert\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"rounded-lg border p-4 dark:text-surface-50\">\n\t\t\t\t\t<h3 class=\"mb-3 text-lg font-bold\">Changes from Selected Revision</h3>\n\t\t\t\t\t{#if selectedRevision}\n\t\t\t\t\t\t{@const diffObject = selectedRevision?.diff || null}\n\t\t\t\t\t\t{#if diffObject && Object.keys(diffObject).length > 0}\n\t\t\t\t\t\t\t<div class=\"space-y-3 font-mono text-sm\">\n\t\t\t\t\t\t\t\t{#each Object.entries(diffObject) as [key, change]}\n\t\t\t\t\t\t\t\t\t{@const ch = change as any}\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<strong class=\"font-bold text-surface-600 dark:text-surface-300\">{key}:</strong>\n\t\t\t\t\t\t\t\t\t\t{#if ch.status === 'modified'}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-1 rounded border border-error-500/30 bg-error-500/10 p-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-error-700 dark:text-error-300\">- {JSON.stringify(ch.old)}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-1 rounded border border-success-500/30 bg-success-500/10 p-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-success-700 dark:text-success-300\">+ {JSON.stringify(ch.new)}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if ch.status === 'added'}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-1 rounded border border-success-500/30 bg-success-500/10 p-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-success-700 dark:text-success-300\">+ {JSON.stringify(ch.value)}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if ch.status === 'deleted'}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-1 rounded border border-error-500/30 bg-error-500/10 p-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-error-700 dark:text-error-300\">- {JSON.stringify(ch.value)}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if selectedRevisionId}\n\t\t\t\t\t\t\t<p class=\"text-center text-surface-500\">No differences found.</p>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<p class=\"text-center text-surface-500\">Select a revision to see what's changed.</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<p class=\"text-center text-surface-500\">Select a revision to see what's changed.</p>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</Tabs.Content>\n\t<Tabs.Content value=\"2\" class=\"w-full\">\n\t\t{@const hostProd = publicEnv?.HOST_PROD || 'https://localhost:5173'}\n\t\t{@const entryId = (collectionValue as any).value?._id || 'draft'}\n\t\t{@const previewUrl = `${hostProd}?preview=${entryId}`}\n\t\t<div class=\"flex h-[600px] flex-col p-4\">\n\t\t\t<div class=\"mb-4 flex items-center justify-between gap-4\">\n\t\t\t\t<div class=\"flex flex-1 items-center gap-2\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:open-in-new\" width=\"20\" class=\"text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t\t\t<input type=\"text\" class=\"input grow text-sm\" readonly value={previewUrl} />\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"preset-outline-surface-500 btn-sm\"\n\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\tnavigator.clipboard.writeText(previewUrl);\n\t\t\t\t\t\t\ttoaster.success({ description: 'Preview URL Copied' });\n\t\t\t\t\t\t}}\n\t\t\t\t\t\taria-label=\"Copy preview URL\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:content-copy\" width=\"16\"></iconify-icon>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<a href={previewUrl} target=\"_blank\" rel=\"noopener noreferrer\" class=\"preset-filled-primary-500 btn-sm\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:open-in-new\" width=\"16\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t\tOpen\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex-1 overflow-hidden rounded-lg border border-surface-300 dark:text-surface-50\">\n\t\t\t\t<iframe src={previewUrl} title=\"Live Preview\" class=\"h-full w-full\" sandbox=\"allow-same-origin allow-scripts allow-forms allow-popups\"\n\t\t\t\t></iframe>\n\t\t\t</div>\n\n\t\t\t<div class=\"mt-2 text-center text-xs text-surface-500\">\n\t\t\t\tPreview URL: {hostProd}?preview={entryId}\n\t\t\t</div>\n\t\t</div>\n\t</Tabs.Content>\n\t<Tabs.Content value=\"3\" class=\"w-full\">\n\t\t<div class=\"space-y-4 p-4\">\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<input type=\"text\" class=\"input grow\" readonly value={apiUrl} />\n\t\t\t\t<button\n\t\t\t\t\tclass=\"preset-outline-surface-500 btn\"\n\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\tnavigator.clipboard.writeText(apiUrl);\n\t\t\t\t\t\ttoaster.success({ description: 'API URL Copied' });\n\t\t\t\t\t}}>Copy</button\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"card p-4 overflow-x-auto bg-surface-800 text-white font-mono text-sm max-h-[500px]\">\n\t\t\t\t<pre>{JSON.stringify((collectionValue as any).value, null, 2)}</pre>\n\t\t\t</div>\n\t\t</div>\n\t</Tabs.Content>\n</Tabs>\n","<!--\n@file src/routes/(app)/[language]/[...collection]/+page.svelte\n@component\n**This component acts as a layout and data router for the collection view.**\n\n## Navigation Architecture (GUI-First Pattern):\n\n### PRIMARY: GUI Actions (90% of navigation)\n1. User hovers button  Preload data to cache\n2. User clicks button  Check cache  setMode()  URL reflects change\n3. FAST: No goto(), no SSR reload, instant mode switching\n\n### SECONDARY: URL Changes (10% - manual edits)\n1. User manually edits URL  Detect change in $effect\n2. Parse URL  Translate to UUID  setMode()  Load if not cached\n3. SLOWER: Required SSR reload only when user types URL directly\n\n## Features:\n- Receives all page data (schema, entries, pagination) from the server-side `load` function.\n- Passes server-loaded data as props to the `EntryList` or `Fields` components.\n- URL-to-mode translation for manual URL edits (browser address bar changes).\n- Auto-saves unsaved changes as draft when navigating away to prevent data loss.\n\n-->\n<script lang=\"ts\">\n\timport { logger } from '@shared/utils/logger';\n\timport { beforeNavigate, invalidateAll, replaceState } from '$app/navigation';\n\timport { page } from '$app/state';\n\timport { untrack, onMount } from 'svelte';\n\timport { collections } from '@shared/stores/collectionStore.svelte';\n\timport { app, validationStore } from '@shared/stores/store.svelte';\n\timport { parseURLToMode } from '@shared/utils/navigationUtils';\n\timport { getFieldName } from '@shared/utils/utils';\n\timport EntryList from '@cms/components/collectionDisplay/EntryList.svelte';\n\timport Fields from '@cms/components/collectionDisplay/Fields.svelte';\n\timport { showToast } from '@shared/utils/toast';\n\timport type { Schema } from '@cms-types';\n\n\tinterface PageData {\n\t\tcollectionSchema: Schema;\n\t\tentries: any[];\n\t\tpagination: {\n\t\t\ttotalItems: number;\n\t\t\tpagesCount: number;\n\t\t\tcurrentPage: number;\n\t\t\tpageSize: number;\n\t\t};\n\t\trevisions: any[];\n\t\tcontentLanguage: string;\n\t}\n\n\tconst { data }: { data: PageData } = $props();\n\n\t// Use $derived for reactivity from server-loaded data\n\tconst collectionSchema = $derived(data?.collectionSchema);\n\tconst entries = $derived(data?.entries || []);\n\tconst pagination = $derived(data?.pagination || { currentPage: 1, pageSize: 10, totalItems: 0, pagesCount: 1 });\n\tconst revisions = $derived(data?.revisions || []);\n\tconst serverContentLanguage = $derived(data?.contentLanguage);\n\n\t// Debug: Monitor data prop changes\n\t$effect(() => {\n\t\tlogger.debug('[+page.svelte] Data changed:', {\n\t\t\tschemaId: data?.collectionSchema?._id,\n\t\t\tschemaName: data?.collectionSchema?.name,\n\t\t\tentriesCount: data?.entries?.length,\n\t\t\tstoreId: collections.active?._id,\n\t\t\tstoreName: collections.active?.name\n\t\t});\n\t});\n\n\t// Track initial collectionValue to detect changes\n\tlet initialCollectionValue = $state('');\n\tlet userClickedCancel = $state(false);\n\tlet isSavingDraft = $state(false);\n\n\t// Track when we last received server data to avoid overwriting client-side language changes\n\tlet lastServerLanguage: string | undefined = $state(undefined);\n\n\t// Track if we've initialized validation for the current create session\n\tlet validationInitialized = $state(false);\n\n\t// Initialize validation IMMEDIATELY for create mode using $effect.pre()\n\t// This runs synchronously BEFORE DOM updates, ensuring button state is correct on first render\n\t$effect.pre(() => {\n\t\tconst createParam = page.url.searchParams.get('create');\n\n\t\tif (createParam === 'true' && collectionSchema && !validationInitialized) {\n\t\t\t// Clear all errors first to start fresh\n\t\t\tvalidationStore.clearAllErrors();\n\n\t\t\t// Initialize validation for all required fields\n\t\t\tconst fields = collectionSchema.fields || [];\n\t\t\tlet errorCount = 0;\n\t\t\tfor (const field of fields) {\n\t\t\t\tconst fieldDef = field as any;\n\t\t\t\tif (fieldDef.required) {\n\t\t\t\t\tconst fieldName = getFieldName(fieldDef, false);\n\t\t\t\t\tvalidationStore.setError(fieldName, `${fieldDef.label || fieldName} is required`);\n\t\t\t\t\terrorCount++;\n\t\t\t\t\tconsole.log(' [Validation Init] Set error for required field:', fieldName);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvalidationInitialized = true;\n\t\t\tconsole.log(' [Validation Init] Initialized', errorCount, 'required field errors, isValid:', validationStore.isValid);\n\t\t} else if (createParam !== 'true') {\n\t\t\t// Reset flag when leaving create mode\n\t\t\tif (validationInitialized) {\n\t\t\t\tconsole.log(' [Validation Init] Resetting validation flag');\n\t\t\t\tvalidationInitialized = false;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Sync contentLanguage store with server data\n\t// IMPORTANT: Server language (URL) takes precedence over cookie/store\n\t// This MUST run immediately when data changes to ensure widgets get correct language\n\t// BUT: Only sync when we receive NEW server data (not on client-side URL changes)\n\t$effect(() => {\n\t\tif (serverContentLanguage) {\n\t\t\t// Only sync if server language actually changed (indicates new server load)\n\t\t\tif (serverContentLanguage !== lastServerLanguage) {\n\t\t\t\tconst currentStoreLanguage = app.contentLanguage;\n\t\t\t\tif (currentStoreLanguage !== serverContentLanguage) {\n\t\t\t\t\tlogger.debug('[+page.svelte] Syncing contentLanguage from server:', currentStoreLanguage, '', serverContentLanguage);\n\t\t\t\t\t// Set without untrack to ensure all reactive subscribers are notified\n\t\t\t\t\tapp.contentLanguage = serverContentLanguage as any;\n\t\t\t\t\tlogger.debug('[+page.svelte] ContentLanguage store now:', app.contentLanguage);\n\t\t\t\t}\n\t\t\t\tlastServerLanguage = serverContentLanguage;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Initial collection store sync - ensures store has correct schema on first load\n\t// CRITICAL: Always sync when collectionSchema changes to keep store in sync with server data\n\t$effect(() => {\n\t\tif (collectionSchema) {\n\t\t\tconst currentStoreId = collections.active?._id;\n\t\t\tconst schemaId = collectionSchema._id;\n\t\t\t// Only update if different to avoid unnecessary re-renders\n\t\t\tif (currentStoreId !== schemaId) {\n\t\t\t\tlogger.debug('[+page.svelte] Syncing collection store:', currentStoreId, '', schemaId, collectionSchema.name);\n\t\t\t\tcollections.setCollection(collectionSchema);\n\t\t\t}\n\t\t}\n\t});\n\n\tlet isMounted = $state(false);\n\n\tonMount(() => {\n\t\tisMounted = true;\n\t});\n\n\t$effect(() => {\n\t\tif (isMounted && typeof window !== 'undefined') {\n\t\t\tconst currentPath = page.url.pathname;\n\t\t\tconst collectionIdFromPath = currentPath.split('/').pop() || '';\n\t\t\tconst isUUID = /^[a-f0-9]{32}$/i.test(collectionIdFromPath);\n\n\t\t\t// Only replace URL if:\n\t\t\t// 1. The URL contains a UUID\n\t\t\t// 2. We have a collection schema with a path\n\t\t\t// 3. The collection schema ID matches the UUID in the URL (ensures data is loaded for correct collection)\n\t\t\tif (isUUID && collectionSchema?.path && collectionSchema._id === collectionIdFromPath) {\n\t\t\t\tconst newPath = `/${serverContentLanguage}${collectionSchema.path}${page.url.search}`;\n\t\t\t\tif (newPath !== currentPath) {\n\t\t\t\t\tlogger.debug(`[URL Update] Replacing UUID path with pretty path: ${newPath}`);\n\t\t\t\t\t// Use SvelteKit's replaceState to avoid interfering with navigation state\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\treplaceState(newPath, {});\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t// ============================================================================\n\t// URL-TO-MODE TRANSLATION & INITIAL LOAD DETECTION\n\t// ============================================================================\n\t// Handles both:\n\t// 1. Initial page load with ?edit=id in URL\n\t// 2. Manual URL changes (user types in address bar)\n\t// 3. Language changes in edit mode (URL language prefix changes but ?edit=id stays same)\n\t// 4. Collection changes (navigation between different collections)\n\n\tlet lastUrlString: string = $state('');\n\tlet lastEditParam: string | null = $state(null);\n\tlet hasInitiallyLoaded = $state(false);\n\tlet lastCollectionId: string | null = $state(null);\n\n\t// Track collection changes - when navigating to a different collection, reset state\n\t$effect(() => {\n\t\tconst currentCollectionId = collectionSchema?._id as string | undefined;\n\t\tif (currentCollectionId && currentCollectionId !== lastCollectionId) {\n\t\t\tlogger.debug('[Collection Change] Detected collection switch:', lastCollectionId, '', currentCollectionId);\n\t\t\tlogger.debug('[Collection Change] New entries count:', entries.length, 'pagination:', pagination);\n\n\t\t\t// CRITICAL: Sync collection store with server data\n\t\t\t// This ensures collections.active is updated when navigating between collections\n\t\t\tif (collectionSchema) {\n\t\t\t\tcollections.setCollection(collectionSchema);\n\t\t\t\tlogger.debug('[Collection Change] Store synced with server data:', collectionSchema.name);\n\t\t\t}\n\n\t\t\t// Reset state tracking for the new collection\n\t\t\thasInitiallyLoaded = false;\n\t\t\tlastEditParam = null;\n\t\t\tlastUrlString = '';\n\t\t\t// Update tracking\n\t\t\tlastCollectionId = currentCollectionId;\n\t\t\t// Set mode to view for new collection (unless URL says otherwise)\n\t\t\tconst editParam = page.url.searchParams.get('edit');\n\t\t\tconst createParam = page.url.searchParams.get('create');\n\t\t\tif (!editParam && !createParam) {\n\t\t\t\tcollections.setMode('view');\n\t\t\t}\n\t\t}\n\t});\n\n\t$effect(() => {\n\t\tconst currentUrl = page.url.toString();\n\t\tconst editParam = page.url.searchParams.get('edit');\n\t\tconst createParam = page.url.searchParams.get('create');\n\n\t\t// CASE 1: Initial page load with ?edit=id\n\t\tif (!hasInitiallyLoaded && editParam && entries && entries.length === 1) {\n\t\t\thasInitiallyLoaded = true;\n\t\t\tlastEditParam = editParam;\n\t\t\tconst entryData = entries[0];\n\t\t\tlogger.debug('[Initial Load] Edit mode detected, loading entry:', entryData._id);\n\n\t\t\tcollections.setMode('edit');\n\t\t\tcollections.setCollectionValue(entryData);\n\t\t\tinitialCollectionValue = JSON.stringify(entryData);\n\t\t\tlastUrlString = currentUrl;\n\t\t\treturn; // Exit early to avoid triggering URL change logic\n\t\t}\n\n\t\t// CASE 1b: Initial page load with ?create=true\n\t\tif (!hasInitiallyLoaded && createParam === 'true') {\n\t\t\thasInitiallyLoaded = true;\n\t\t\tlastUrlString = currentUrl;\n\n\t\t\tcollections.setMode('create');\n\t\t\tconst newEntry: Record<string, any | null> = {};\n\t\t\tconst fields = collections.active?.fields || [];\n\n\t\t\t// Initialize empty entry\n\t\t\tfor (const field of fields) {\n\t\t\t\tconst fieldName = getFieldName(field as any, false);\n\t\t\t\tnewEntry[fieldName] = null;\n\t\t\t}\n\t\t\tcollections.setCollectionValue(newEntry);\n\n\t\t\t//  Validation is now handled by $effect.pre() above\n\t\t\t// No need to duplicate validation logic here\n\n\t\t\t// Initialize change tracking\n\t\t\tinitialCollectionValue = JSON.stringify(newEntry);\n\n\t\t\tlogger.debug('[Initial Load] Create mode detected, entry initialized');\n\t\t\treturn; // Exit early to avoid triggering URL change logic\n\t\t}\n\n\t\t// CASE 2: URL changed (manual navigation)\n\t\tif (currentUrl !== lastUrlString && hasInitiallyLoaded) {\n\t\t\t// Check if only language changed (URL language prefix) but params stayed the same\n\t\t\tconst editParamChanged = editParam !== lastEditParam;\n\t\t\tconst wasInCreateMode = lastUrlString.includes('create=true');\n\t\t\tconst isInCreateMode = createParam === 'true';\n\n\t\t\t// If we're in edit/create mode and only URL language changed, ignore the URL change\n\t\t\t// This happens when user changes language in TranslationStatus dropdown\n\t\t\tif ((collections.mode === 'edit' || collections.mode === 'create') && editParam === lastEditParam && isInCreateMode === wasInCreateMode) {\n\t\t\t\tlogger.debug('[URL Change] Language prefix changed, but staying in', collections.mode, 'mode (no reload needed)');\n\t\t\t\tlastUrlString = currentUrl;\n\t\t\t\treturn; // Don't reload data, just update URL tracking\n\t\t\t}\n\n\t\t\tlastUrlString = currentUrl;\n\t\t\tlastEditParam = editParam;\n\t\t\tconst parsed = parseURLToMode(page.url);\n\n\t\t\tlogger.debug(`[URL Change] ${collections.mode}  ${parsed.mode}`, {\n\t\t\t\tentryId: parsed.entryId,\n\t\t\t\thasEntries: entries.length,\n\t\t\t\teditParamChanged\n\t\t\t});\n\n\t\t\t// Edit mode from URL change\n\t\t\tif (parsed.mode === 'edit' && parsed.entryId && editParamChanged) {\n\t\t\t\tif (entries && entries.length === 1) {\n\t\t\t\t\t// Data already loaded by server\n\t\t\t\t\tconst entryData = entries[0];\n\t\t\t\t\tcollections.setMode('edit');\n\t\t\t\t\tcollections.setCollectionValue(entryData);\n\t\t\t\t\tinitialCollectionValue = JSON.stringify(entryData);\n\t\t\t\t} else {\n\t\t\t\t\t// Need to reload data\n\t\t\t\t\tinvalidateAll().then(() => {\n\t\t\t\t\t\tcollections.setMode('edit');\n\t\t\t\t\t\tlogger.debug(`[URL Change] Reloaded entry ${parsed.entryId}`);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (parsed.mode === 'view' && collections.mode === 'edit') {\n\t\t\t\t// Exiting edit mode\n\t\t\t\tcollections.setMode('view');\n\t\t\t} else if (parsed.mode === 'create') {\n\t\t\t\t// Create mode (URL change while already loaded)\n\t\t\t\tcollections.setMode('create');\n\t\t\t\tconst newEntry: Record<string, any | null> = {};\n\t\t\t\tconst fields = collections.active?.fields || [];\n\n\t\t\t\t// Initialize empty entry with null values\n\t\t\t\tfor (const field of fields) {\n\t\t\t\t\tconst fieldName = getFieldName(field as any, false);\n\t\t\t\t\tnewEntry[fieldName] = null;\n\t\t\t\t}\n\t\t\t\tcollections.setCollectionValue(newEntry);\n\n\t\t\t\t//  FIX: Perform initial validation for required fields\n\t\t\t\tvalidationStore.clearAllErrors();\n\n\t\t\t\t// Initialize change tracking\n\t\t\t\tinitialCollectionValue = JSON.stringify(newEntry);\n\n\t\t\t\tfor (const field of fields) {\n\t\t\t\t\tconst fieldDef = field as any;\n\t\t\t\t\tif (fieldDef.required) {\n\t\t\t\t\t\tconst fieldName = getFieldName(fieldDef, false);\n\t\t\t\t\t\tconst value = newEntry[fieldName];\n\n\t\t\t\t\t\t// Validate required field\n\t\t\t\t\t\tif (value === null || value === undefined || value === '') {\n\t\t\t\t\t\t\tvalidationStore.setError(fieldName, `${fieldDef.label || fieldName} is required`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('[URL Change] Create mode validation initialized');\n\t\t\t} else if (collections.mode !== parsed.mode) {\n\t\t\t\t// Other mode changes\n\t\t\t\tcollections.setMode(parsed.mode);\n\t\t\t}\n\t\t}\n\n\t\t// CASE 3: Mark as loaded after first render (for view mode)\n\t\tif (!hasInitiallyLoaded && !editParam) {\n\t\t\thasInitiallyLoaded = true;\n\t\t\tlastEditParam = editParam;\n\t\t\tlastUrlString = currentUrl;\n\t\t}\n\t});\n\n\t// Sync collection schema from server data\n\t$effect(() => {\n\t\tif (collectionSchema) {\n\t\t\tcollections.setCollection(collectionSchema);\n\t\t}\n\t});\n\n\t// Track initial state when entering edit mode\n\t// This runs AFTER collections.activeValue is set, but doesn't trigger when collections.activeValue changes\n\t$effect(() => {\n\t\tconst currentMode = collections.mode;\n\t\tif (currentMode === 'edit' || currentMode === 'create') {\n\t\t\t// Use untrack to read collections.activeValue without creating a dependency\n\t\t\tconst currentValue = untrack(() => collections.activeValue);\n\t\t\tif (currentValue) {\n\t\t\t\tinitialCollectionValue = JSON.stringify(currentValue);\n\t\t\t\tuserClickedCancel = false; // Reset cancel flag\n\t\t\t}\n\t\t}\n\t});\n\n\t// Auto-save draft function\n\tasync function autoSaveDraft(): Promise<boolean> {\n\t\tif (isSavingDraft) return false;\n\n\t\tisSavingDraft = true;\n\t\ttry {\n\t\t\tconst entryData = collections.activeValue as any;\n\t\t\tconst collectionId = collections.active?._id;\n\t\t\tconst tenantId = page.data?.tenantId;\n\n\t\t\tif (!collectionId || !entryData) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Use collection's default status or current entry status\n\t\t\t// FORCE 'draft' status for auto-saves to bypass validation for required fields\n\t\t\tconst draftData = {\n\t\t\t\t...entryData,\n\t\t\t\tstatus: 'draft',\n\t\t\t\tupdatedAt: new Date().toISOString()\n\t\t\t};\n\n\t\t\t// Determine if creating new or updating existing\n\t\t\tconst isNewEntry = !entryData._id;\n\t\t\tconst endpoint = isNewEntry ? `/api/collections/${collectionId}` : `/api/collections/${collectionId}/${entryData._id}`;\n\n\t\t\tconst method = isNewEntry ? 'POST' : 'PUT';\n\n\t\t\tconst response = await fetch(endpoint, {\n\t\t\t\tmethod,\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tdata: draftData,\n\t\t\t\t\ttenantId\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tif (response.ok) {\n\t\t\t\tconst result = await response.json();\n\n\t\t\t\t// Update collectionValue with the saved draft (including _id for new entries)\n\t\t\t\tif (isNewEntry && result.data?._id) {\n\t\t\t\t\tcollections.activeValue = { ...draftData, _id: result.data._id };\n\t\t\t\t}\n\n\t\t\t\tlogger.debug('[Auto-save] Draft saved successfully');\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tlogger.error('[Auto-save] Failed to save draft:', response.statusText);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error('[Auto-save] Error saving draft:', error);\n\t\t\treturn false;\n\t\t} finally {\n\t\t\tisSavingDraft = false;\n\t\t}\n\t}\n\n\t// Listen for cancel and save events\n\t$effect(() => {\n\t\tconst handleCancelClick = () => {\n\t\t\tuserClickedCancel = true;\n\t\t\tlogger.debug('[Auto-save] Cancel clicked - no draft will be saved');\n\t\t};\n\n\t\tconst handleEntrySaved = () => {\n\t\t\t// Update baseline to match current value, preventing unsaved changes detection\n\t\t\tif (collections.activeValue) {\n\t\t\t\tinitialCollectionValue = JSON.stringify(collections.activeValue);\n\t\t\t\tlogger.debug('[Auto-save] Entry saved manually - baseline updated');\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener('cancelEdit' as any, handleCancelClick as EventListener);\n\t\tdocument.addEventListener('entrySaved' as any, handleEntrySaved as EventListener);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('cancelEdit' as any, handleCancelClick as EventListener);\n\t\t\tdocument.removeEventListener('entrySaved' as any, handleEntrySaved as EventListener);\n\t\t};\n\t});\n\n\t// Navigation guard: auto-save draft if changes exist\n\tbeforeNavigate(async ({ cancel }) => {\n\t\t// Skip if user clicked cancel button\n\t\tif (userClickedCancel) {\n\t\t\tlogger.debug('[Auto-save] Skipping auto-save due to cancel');\n\t\t\tuserClickedCancel = false;\n\t\t\treturn;\n\t\t}\n\n\t\t// Only check if we're in edit/create mode and have unsaved changes\n\t\tif (['edit', 'create'].includes(collections.mode) && collections.activeValue) {\n\t\t\tconst currentValue = JSON.stringify(collections.activeValue);\n\t\t\tconst hasUnsavedChanges = currentValue !== initialCollectionValue;\n\n\t\t\tif (hasUnsavedChanges && !isSavingDraft) {\n\t\t\t\tlogger.debug('[Auto-save] Detected unsaved changes, auto-saving as draft...');\n\n\t\t\t\t// Cancel navigation temporarily\n\t\t\t\tcancel();\n\n\t\t\t\t// Auto-save as draft\n\t\t\t\tconst saved = await autoSaveDraft();\n\n\t\t\t\tif (saved) {\n\t\t\t\t\tshowToast('Changes auto-saved as draft', 'success');\n\t\t\t\t\t// Update initial value to prevent re-saving\n\t\t\t\t\tinitialCollectionValue = JSON.stringify(collections.activeValue);\n\t\t\t\t\t// Allow navigation to continue\n\t\t\t\t\tcollections.setMode('view');\n\t\t\t\t} else {\n\t\t\t\t\tshowToast('Failed to auto-save. Please save manually.', 'error');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n</script>\n\n<svelte:head>\n\t<title>{collectionSchema?.name ?? 'Collection'} - SveltyCMS</title>\n</svelte:head>\n\n<div class=\"content h-full\">\n\t<!-- Auto-save indicator -->\n\t{#if isSavingDraft}\n\t\t<div class=\"fixed right-4 top-20 z-50 flex items-center gap-2 rounded-lg bg-warning-500 px-4 py-2 text-white shadow-lg\">\n\t\t\t<div class=\"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent\"></div>\n\t\t\t<span class=\"text-sm font-medium\">Auto-saving draft...</span>\n\t\t</div>\n\t{/if}\n\n\t{#if !collections.active}\n\t\t<!-- Collection data should be available from SSR, if not show error -->\n\t\t<div class=\"dark:bg-error-950 flex h-64 flex-col items-center justify-center rounded-lg border border-error-500 bg-error-50 p-8\">\n\t\t\t<svg class=\"mb-4 h-16 w-16 text-error-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t<path\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\td=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t\t<h3 class=\"mb-2 text-xl font-bold text-error-600 dark:text-error-400\">Collection Not Loaded</h3>\n\t\t\t<p class=\"text-center text-error-600 dark:text-error-400\">Unable to load collection schema. Please refresh the page.</p>\n\t\t</div>\n\t{:else if collections.mode === 'view' || collections.mode === 'modify'}\n\t\t<!-- Key block forces EntryList to remount when collection changes -->\n\t\t{#key collectionSchema?._id}\n\t\t\t<EntryList {entries} {pagination} contentLanguage={serverContentLanguage} />\n\t\t{/key}\n\t{:else if ['edit', 'create'].includes(collections.mode)}\n\t\t<div id=\"fields_container\" class=\"fields max-h-[calc(100vh-100px)] overflow-y-auto overflow-x-visible max-md:max-h-[calc(100vh-120px)]\">\n\t\t\t<!-- Pass the server-loaded data directly as props -->\n\t\t\t<Fields fields={collections.active.fields} {revisions} contentLanguage={serverContentLanguage} />\n\t\t</div>\n\t{/if}\n</div>\n"],"names":["attributes","$$renderer","$.props_id","$.escape","RootProvider","RootContext","ValueText","CircleTrack","CircleRange","m.entries_archived","m.entries_published","m.entries_unpublished","m.entries_set_to_test","m.entries_deleted","m.entries_scheduled","m.entries_cloned","m.entries_updated","m.update_failed","m.delete_failed","m.no_entries_selected","m.no_collection_found","m.entry_archived","m.entry_deleted_success","m.entry_saved","m.entry_status_updated","m.entry_scheduled","m.entry_cloned_success","m.only_admins_can_delete","m.status_reserved_for_system","m.unsaved_changes_title","m.unsaved_changes_body","m.save_as_draft_and_leave","m.stay_and_continue_editing","m.changes_saved_as_draft","m.error_saving_draft","m.no_entry_for_scheduling","m.entry_scheduled_status","m.error_scheduling","m.button_confirm","m.button_cancel","m.button_delete","m.button_archive","m.entrylist_multibutton_publish","m.entrylist_multibutton_unpublish","m.entrylist_multibutton_schedule","m.entrylist_multibutton_clone","m.button_test","mode","m.entrylist_multibutton_draft","m.entrylist_multibutton_create","m.button_loading","$.attr_class","$.stringify","m.entrylist_multibutton_show_active","m.entrylist_multibutton_show_archived","$.attr","m.entrylist_multibutton_viewing_archived","m.entrylist_multibutton_viewing_active","m.entrylist_multibutton_toggle_menu","m.entrylist_multibutton_available_actions","m.applayout_contentlanguage","m.translationsstatus_completed","m.entrylist_dnd","m.entrylist_all","$.html","m.EntryList_no_collection","m.button_edit","m.applayout_version","m.Fields_preview","m.form_required","$.attr_style","lowerPath","m.Fields_no_widgets_found"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12]}