{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../src/routes/login/oauth/+page.svelte"],"sourcesContent":["<!-- \n@cms/routes/login/oauth/+page.svelte\n@description OAuth login page \n-->\n\n<script lang=\"ts\">\n\timport type { PageData } from './$types';\n\n\t// Components\n\timport SveltyCMSLogoFull from '@cms/components/system/icons/SveltyCMS_LogoFull.svelte';\n\timport FloatingInput from '@cms/components/system/inputs/floatingInput.svelte';\n\n\t// Stores\n\timport { globalLoadingStore, loadingOperations } from '@shared/stores/loadingStore.svelte';\n\n\t//ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\tinterface Props {\n\t\tdata: PageData;\n\t}\n\n\tconst { data }: Props = $props();\n\n\tlet token = $state('');\n\tlet formError = $state('');\n\tlet isFormValid = $state(false);\n\n\t// Update form validation when token changes\n\t$effect(() => {\n\t\tisFormValid = !data.requiresToken || (token.length >= 16 && token.length <= 48);\n\t});\n\n\t// Handle form submission\n\tasync function handleSubmit(event: SubmitEvent) {\n\t\tevent.preventDefault();\n\t\tif (data.requiresToken && !isFormValid) {\n\t\t\tformError = 'Invalid token length';\n\t\t\treturn;\n\t\t}\n\n\t\tformError = '';\n\n\t\tawait globalLoadingStore\n\t\t\t.withLoading(\n\t\t\t\tloadingOperations.authentication,\n\t\t\t\tasync () => {\n\t\t\t\t\tconst form = event.target as HTMLFormElement;\n\t\t\t\t\tconst formData = new FormData(form);\n\t\t\t\t\tconst response = await fetch(form.action, {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tbody: formData\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tthrow new Error('OAuth authentication failed');\n\t\t\t\t\t}\n\t\t\t\t\t// Redirect will be handled by the server\n\t\t\t\t},\n\t\t\t\t'OAuth.handleSubmit'\n\t\t\t)\n\t\t\t.catch((error) => {\n\t\t\t\tformError = error instanceof Error ? error.message : 'Authentication failed';\n\t\t\t});\n\t}\n\n\t// Handle cancel button\n\tfunction handleCancel() {\n\t\twindow.history.back();\n\t}\n</script>\n\n<div class=\"grid h-full w-full place-items-center bg-[#242728]\">\n\t<form class=\"card m-2 flex flex-col items-center gap-2 rounded border p-2 sm:p-6\" method=\"post\" action=\"?/OAuth\" onsubmit={handleSubmit}>\n\t\t<!-- CSS Logo -->\n\t\t<SveltyCMSLogoFull />\n\n\t\t{#if data.requiresToken}\n\t\t\t<!-- Token Input Form -->\n\t\t\t<label>\n\t\t\t\t<h2 class=\"mb-2 text-center text-xl font-bold text-primary-500\">\n\t\t\t\t\t{m.oauth_entertoken()}\n\t\t\t\t</h2>\n\t\t\t\t<FloatingInput\n\t\t\t\t\tid=\"token\"\n\t\t\t\t\tname=\"token\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\trequired\n\t\t\t\t\tbind:value={token}\n\t\t\t\t\tlabel={m.registration_token?.() || m.signup_registrationtoken?.()}\n\t\t\t\t\ticon=\"mdi:key-chain\"\n\t\t\t\t\ticonColor=\"white\"\n\t\t\t\t\ttextColor=\"white\"\n\t\t\t\t\tpasswordIconColor=\"white\"\n\t\t\t\t\tinputClass=\"text-white\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tminlength={16}\n\t\t\t\t\tmaxlength={48}\n\t\t\t\t/>\n\t\t\t</label>\n\t\t{/if}\n\n\t\t<!-- Error Message -->\n\t\t{#if formError}\n\t\t\t<p id=\"error-message\" class=\"text-error-500\" role=\"alert\">\n\t\t\t\t{formError}\n\t\t\t</p>\n\t\t{/if}\n\n\t\t<div class=\"mt-2 flex w-full justify-between gap-1 sm:gap-2\">\n\t\t\t<!-- Cancel Button -->\n\t\t\t<button type=\"button\" onclick={handleCancel} aria-label={m.button_cancel()} class=\"variant-filled btn\">\n\t\t\t\t{m.button_cancel()}\n\t\t\t</button>\n\n\t\t\t<!-- Submit Button -->\n\t\t\t<button\n\t\t\t\ttype=\"submit\"\n\t\t\t\tdisabled={!isFormValid || globalLoadingStore.isLoading}\n\t\t\t\taria-label={m.button_send()}\n\t\t\t\tclass=\"variant-filled btn items-center\"\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"flat-color-icons:google\" color=\"white\" width=\"20\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t<p>{m.oauth_signup()}</p>\n\t\t\t</button>\n\t\t</div>\n\t</form>\n</div>\n"],"names":["$$renderer","$.escape","m.oauth_entertoken","m.registration_token","m.signup_registrationtoken","$.attr","m.button_cancel","m.button_send","m.oauth_signup"],"mappings":";;;;;wCAKA;YAiBS,KAAI,IAAA;AAER,QAAA,QAAe;;;;;;;AAqDb,UAAA,KAAK,eAAa;;AAInB,QAAAA,YAAA,KAAA,0EAAAC,YAAAC,iBAAkB,CAAA,CAAA,QAAA;;;;;;UAQZ,OAAAC,qBAAoB,KAAQC,2BAA0B;AAAA;;;;;;qBAOlD;AAAA,qBACA;AAAA;mBATC;AAAA;;AAAA,oBAAK;;;;;;;;;;;;AAuBsC,MAAAJ,YAAA,KAAA,8FAAAK,KAAA,cAAAC,eAAe,CAAA,+BAAAL,YACtEK,cAAe,sFAOJC,aAAa,CAAA,kJAAAN,YAIrBO,aAAc,CAAA,CAAA,kCAAA;AAAA;;;;;;;EArDd,CAAA;;"}