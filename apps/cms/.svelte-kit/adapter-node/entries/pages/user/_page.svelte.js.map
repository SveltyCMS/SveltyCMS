{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/modules/root-context.js","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/anatomy/fallback.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/anatomy/image.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/anatomy/root-context.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/anatomy/root-provider.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/modules/provider.svelte.js","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/anatomy/root.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/avatar/modules/anatomy.js","../../../../../../../../shared/components/src/system/table/Boolean.svelte","../../../../../../../../shared/components/src/system/table/Role.svelte","../../../../../../../../shared/features/src/user/components/Multibutton.svelte","../../../../../../../../shared/features/src/user/components/AdminArea.svelte","../../../../../../../../shared/utils/src/globalSearchIndex.ts","../../../../../../src/routes/user/+page.svelte"],"sourcesContent":["import { createContext } from '../../../internal/create-context.js';\nexport const RootContext = createContext();\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface AvatarFallbackProps extends PropsWithElement<'span'>, HTMLAttributes<'span'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: AvatarFallbackProps = $props();\n\n\tconst avatar = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(avatar().getFallbackProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<span {...attributes}>\n\t\t{@render children?.()}\n\t</span>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface AvatarImageProps extends PropsWithElement<'img'>, HTMLAttributes<'img'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: AvatarImageProps = $props();\n\n\tconst avatar = RootContext.consume();\n\n\tconst { element, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(avatar().getImageProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<img {...attributes} />\n{/if}\n","<script lang=\"ts\" module>\n\timport type { useAvatar } from '../modules/provider.svelte';\n\timport type { Snippet } from 'svelte';\n\n\texport interface AvatarRootContextProps {\n\t\tchildren: Snippet<[ReturnType<typeof useAvatar>]>;\n\t}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\n\tconst props: AvatarRootContextProps = $props();\n\n\tconst avatar = RootContext.consume();\n\n\tconst { children } = $derived(props);\n</script>\n\n{@render children(avatar)}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport type { useAvatar } from '../modules/provider.svelte';\n\n\texport interface AvatarRootProviderProps extends PropsWithElement<'div'>, HTMLAttributes<'div', 'id' | 'dir'> {\n\t\tvalue: ReturnType<typeof useAvatar>;\n\t}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: AvatarRootProviderProps = $props();\n\n\tconst { element, children, value: avatar, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(avatar().getRootProps(), rest));\n\n\tRootContext.provide(() => avatar());\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","import { connect, machine } from '@zag-js/avatar';\nimport { normalizeProps, useMachine } from '@zag-js/svelte';\nexport function useAvatar(props) {\n    const service = useMachine(machine, props);\n    const avatar = $derived(connect(service, normalizeProps));\n    return () => avatar;\n}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport type { Props } from '@zag-js/avatar';\n\n\texport interface AvatarRootProps extends Omit<Props, 'id'>, PropsWithElement<'div'>, HTMLAttributes<'div', 'id' | 'dir'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { useAvatar } from '../modules/provider.svelte';\n\timport { RootContext } from '../modules/root-context.js';\n\timport { splitProps } from '@zag-js/avatar';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: AvatarRootProps = $props();\n\n\tconst [avatarProps, componentProps] = $derived(splitProps(props));\n\tconst { element, children, ...rest } = $derived(componentProps);\n\n\tconst id = $props.id();\n\tconst avatar = useAvatar(() => ({\n\t\t...avatarProps,\n\t\tid: id,\n\t}));\n\n\tconst attributes = $derived(mergeProps(avatar().getRootProps(), rest));\n\n\tRootContext.provide(() => avatar());\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","import Fallback from '../anatomy/fallback.svelte';\nimport Image from '../anatomy/image.svelte';\nimport RootContext from '../anatomy/root-context.svelte';\nimport RootProvider from '../anatomy/root-provider.svelte';\nimport Root from '../anatomy/root.svelte';\nexport const Avatar = Object.assign(Root, {\n    Provider: RootProvider,\n    Context: RootContext,\n    Image: Image,\n    Fallback: Fallback,\n});\n","<!-- \n@file src/components/system/table/Boolean.svelte\n@component \n**Boolean component for displaying 'Yes' or 'No' with badges in a table**\n\n@example\n<Boolean value={true} />\n\n### Props\n- `value` {boolean}: The boolean value to display\n\n### Features:\n- Displays 'Yes' for true and 'No' for false\n- Uses badges with different gradients for visual distinction\n-->\n\n<script lang=\"ts\">\n\t//ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Svelte 5 props\n\tinterface Props {\n\t\tvalue?: boolean;\n\t}\n\n\tconst { value = false }: Props = $props();\n</script>\n\n<!-- Display 'Yes' for true and 'No' for false with badges -->\n<span class={value ? 'gradient-error badge rounded' : 'gradient-primary badge rounded'}>\n\t{value ? m.boolean_yes() : m.boolean_no()}\n</span>\n","<!--\n@file src/components/system/table/Role.svelte\n@component\n**Role component for displaying different badges based on user roles.**\n\n@example\n<Role value={roles[0]?._id} />\n\n### Props\n- `value` {string}: The role ID to display\n- `roles` {Role[]}: Array of role objects to reference for display\n\n### Features\n- Dynamic role rendering based on user roles\n- Customizable role badges with icons and colors\n- Fallback to default role if role ID not found in roles array\n-->\n\n<script lang=\"ts\">\n\t// Auth\n\timport type { Role } from '@shared/database/auth/types';\n\n\t// Ensure roles is an array\n\tconst { value, roles = [] } = $props();\n\n\tconst roleClasses = (roleId: string) => {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\t\tif (!role) {\n\t\t\tconst defaultRole = roles.find((r: Role) => r._id === 'user');\n\t\t\treturn defaultRole?.color || 'text-white';\n\t\t}\n\t\treturn role.color || 'text-white';\n\t};\n\n\tconst iconForRole = (roleId: string) => {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\t\tif (!role) {\n\t\t\tconst defaultRole = roles.find((r: Role) => r._id === 'user');\n\t\t\treturn defaultRole?.icon || 'material-symbols:person';\n\t\t}\n\t\treturn role.icon || 'material-symbols:person';\n\t};\n\n\tconst roleName = (roleId: string) => {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\t\tif (!role) {\n\t\t\tconst defaultRole = roles.find((r: Role) => r._id === 'user');\n\t\t\treturn defaultRole?.name || 'User';\n\t\t}\n\t\treturn role.name || 'User';\n\t};\n</script>\n\n<span class=\"badge {roleClasses(value)}\">\n\t{#if iconForRole(value)}\n\t\t<iconify-icon icon={iconForRole(value)} width=\"20\"></iconify-icon> {roleName(value)}\n\t{:else}\n\t\t<span>{roleName(value)}</span>\n\t{/if}\n</span>\n","<!-- \n@files src/components/user/Multibutton.svelte\n@component\n**A unified multibutton component for managing users and tokens**\n\nManages actions (edit, delete, block, unblock) with debounced submissions.\n\n@Example\n<Multibutton bind:selectedRows={selectedRows} type=\"user\" />\n\n#### Props\n- `selectedRows` {array} - Array of selected rows (User | Token)\n- `type` {\"user\" | \"token\"} - Type of data to manage (default: 'user')\n-->\n\n<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { scale } from 'svelte/transition';\n\timport { quintOut } from 'svelte/easing';\n\timport { invalidateAll } from '$app/navigation';\n\timport { logger } from '@shared/utils/logger';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Stores\n\timport { storeListboxValue } from '@shared/stores/store.svelte';\n\n\t// Skeleton & Utils\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\n\timport ModalEditForm from './ModalEditForm.svelte';\n\timport ModalEditToken from './ModalEditToken.svelte';\n\timport type { User, Token } from '@shared/database/auth/types';\n\n\tconst isUser = (row: unknown): row is User => {\n\t\treturn !!row && typeof row === 'object' && '_id' in row;\n\t};\n\tconst isToken = (row: unknown): row is Token => {\n\t\treturn !!row && typeof row === 'object' && 'token' in row;\n\t};\n\n\ttype ActionType = 'edit' | 'delete' | 'block' | 'unblock';\n\n\t// Props\n\tlet { selectedRows, type = 'user', totalUsers = 0, currentUser = null, onUpdate = () => {} } = $props();\n\n\t// State\n\tlet listboxValue = $state<ActionType>('edit');\n\tlet isDropdownOpen = $state(false);\n\tlet hoveredAction = $state<ActionType | null>(null);\n\tlet dropdownRef = $state<HTMLElement | null>(null);\n\n\t// Sync local listboxValue with global store for TableIcons\n\t$effect(() => {\n\t\tstoreListboxValue.set(listboxValue);\n\t});\n\n\t// Handle click outside to close dropdown\n\tfunction handleClickOutside(event: MouseEvent) {\n\t\tif (isDropdownOpen && dropdownRef && !dropdownRef.contains(event.target as Node)) {\n\t\t\tisDropdownOpen = false;\n\t\t}\n\t}\n\n\tonMount(() => {\n\t\tdocument.addEventListener('click', handleClickOutside);\n\t});\n\n\tonDestroy(() => {\n\t\tdocument.removeEventListener('click', handleClickOutside);\n\t});\n\n\t// Normalize selection to a safe array\n\tconst safeSelectedRows = $derived(Array.isArray(selectedRows) ? (selectedRows.filter(Boolean) as Array<User | Token>) : []);\n\n\t// Derived values\n\tconst isDisabled = $derived(safeSelectedRows.length === 0);\n\tconst isMultipleSelected = $derived(safeSelectedRows.length > 1);\n\n\t// Smart state detection for block/unblock actions\n\tconst blockState = $derived(() => {\n\t\tif (safeSelectedRows.length === 0) return null;\n\n\t\tif (type === 'user') {\n\t\t\tconst users = safeSelectedRows.filter(isUser);\n\t\t\tif (users.length === 0) return null;\n\t\t\tconst blockedCount = users.filter((user: User) => user.blocked).length;\n\t\t\tconst unblockedCount = users.filter((user: User) => !user.blocked).length;\n\n\t\t\tif (blockedCount === users.length) return 'all-blocked';\n\t\t\tif (unblockedCount === users.length) return 'all-unblocked';\n\t\t\treturn 'mixed';\n\t\t} else {\n\t\t\tconst tokens = safeSelectedRows.filter(isToken);\n\t\t\tif (tokens.length === 0) return null;\n\t\t\tconst blockedCount = tokens.filter((token: Token) => token.blocked).length;\n\t\t\tconst unblockedCount = tokens.filter((token: Token) => !token.blocked).length;\n\n\t\t\tif (blockedCount === tokens.length) return 'all-blocked';\n\t\t\tif (unblockedCount === tokens.length) return 'all-unblocked';\n\t\t\treturn 'mixed';\n\t\t}\n\t});\n\n\t// Available actions based on current state\n\tconst availableActions = $derived.by<ActionType[]>(() => {\n\t\tconst baseActions: ActionType[] = ['edit', 'delete'];\n\t\tconst currentBlockState = blockState;\n\n\t\tif (currentBlockState() === 'all-blocked') {\n\t\t\treturn [...baseActions, 'unblock'];\n\t\t} else if (currentBlockState() === 'all-unblocked') {\n\t\t\treturn [...baseActions, 'block'];\n\t\t} else if (currentBlockState() === 'mixed') {\n\t\t\treturn [...baseActions, 'block', 'unblock'];\n\t\t}\n\n\t\treturn baseActions;\n\t});\n\n\t// Actions to show in dropdown\n\tconst filteredActions = $derived.by<ActionType[]>(() => {\n\t\tconst actions = Array.isArray(availableActions) ? availableActions : [];\n\t\treturn actions.filter((action) => action !== listboxValue);\n\t});\n\n\t// Auto-adjust listboxValue when selection changes\n\t$effect(() => {\n\t\tif (safeSelectedRows.length > 0 && !availableActions.includes(listboxValue)) {\n\t\t\tconst currentBlockState = blockState;\n\t\t\t// If current action is not available, switch to the most appropriate one\n\t\t\tif (currentBlockState() === 'all-blocked' && listboxValue === 'block') {\n\t\t\t\tlistboxValue = 'unblock';\n\t\t\t} else if (currentBlockState() === 'all-unblocked' && listboxValue === 'unblock') {\n\t\t\t\tlistboxValue = 'block';\n\t\t\t} else if (!availableActions.includes(listboxValue)) {\n\t\t\t\tlistboxValue = 'edit'; // Default fallback\n\t\t\t}\n\t\t}\n\t});\n\n\t// Check if delete should be disabled for users\n\tconst isDeleteDisabled = $derived(\n\t\ttype === 'user' &&\n\t\t\tlistboxValue === 'delete' &&\n\t\t\t(totalUsers <= 1 ||\n\t\t\t\t(currentUser &&\n\t\t\t\t\tsafeSelectedRows.length === 1 &&\n\t\t\t\t\tisUser(safeSelectedRows[0]) &&\n\t\t\t\t\t(safeSelectedRows[0] as User)._id === currentUser._id &&\n\t\t\t\t\ttotalUsers === 1) ||\n\t\t\t\tsafeSelectedRows.length >= totalUsers)\n\t);\n\n\t// Helper function to convert Date to expires format expected by ModalEditToken\n\tfunction convertDateToExpiresFormat(expiresDate: Date | string | null): string {\n\t\tif (!expiresDate) return '7d'; // Default\n\n\t\tconst now = new Date();\n\t\tconst expires = new Date(expiresDate);\n\t\tconst diffMs = expires.getTime() - now.getTime();\n\t\tconst diffHours = Math.ceil(diffMs / (1000 * 60 * 60));\n\t\tconst diffDays = Math.ceil(diffHours / 24);\n\n\t\t// Match the available options in ModalEditToken\n\t\tif (diffHours <= 1) return '1h';\n\t\tif (diffDays <= 1) return '1d';\n\t\tif (diffDays <= 7) return '7d';\n\t\tif (diffDays <= 30) return '30d';\n\t\tif (diffDays <= 90) return '90d';\n\n\t\treturn '90d'; // Max available option\n\t}\n\n\t// Unified batch endpoints for consistent API design\n\tinterface ActionConfigItem {\n\t\tbuttonClass: string;\n\t\thoverClass: string;\n\t\ticonValue: string;\n\t\tlabel: string;\n\t\tmodalTitle: () => any;\n\t\tmodalBody: () => any;\n\t\tendpoint: () => string;\n\t\tmethod: () => string;\n\t\ttoastMessage: () => string;\n\t\ttoastBackground: string;\n\t}\n\n\tconst actionConfig = $derived<Record<ActionType, ActionConfigItem>>({\n\t\tedit: {\n\t\t\tbuttonClass: 'gradient-primary',\n\t\t\thoverClass: 'gradient-primary-hover',\n\t\t\ticonValue: 'bi:pencil-fill',\n\t\t\tlabel: 'Edit',\n\t\t\tmodalTitle: () => (type === 'user' ? m.adminarea_title() : m.multibuttontoken_modaltitle()),\n\t\t\tmodalBody: () => (type === 'user' ? 'Modify your data and then press Save.' : m.multibuttontoken_modalbody()),\n\t\t\tendpoint: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn '/api/user/updateUserAttributes';\n\t\t\t\t} else {\n\t\t\t\t\tconst firstRow = safeSelectedRows[0];\n\t\t\t\t\tif (isToken(firstRow)) {\n\t\t\t\t\t\treturn `/api/token/${firstRow.token}`;\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error('No token selected for editing');\n\t\t\t\t}\n\t\t\t},\n\t\t\tmethod: () => 'PUT',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'User' : 'Token'} Updated`,\n\t\t\ttoastBackground: 'gradient-primary'\n\t\t},\n\t\tdelete: {\n\t\t\tbuttonClass: 'gradient-error',\n\t\t\thoverClass: 'gradient-error-hover',\n\t\t\ticonValue: 'bi:trash3-fill',\n\t\t\tlabel: 'Delete',\n\t\t\tmodalTitle: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn `Please Confirm User <span class=\"text-error-500 font-bold\">Deletion</span>`;\n\t\t\t\t}\n\t\t\t\treturn `Please Confirm Token <span class=\"text-error-500 font-bold\">Deletion</span>`;\n\t\t\t},\n\t\t\tmodalBody: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst user = safeSelectedRows[0];\n\t\t\t\t\t\tif (isUser(user)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This action cannot be undone and will permanently remove the user from the system.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} users</span>? This action cannot be undone and will permanently remove all selected users from the system.`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst token = safeSelectedRows[0];\n\t\t\t\t\t\tif (isToken(token)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This action cannot be undone and will permanently remove the token from the system.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} tokens</span>? This action cannot be undone and will permanently remove all selected tokens from the system.`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tendpoint: () => (type === 'user' ? '/api/user/batch' : '/api/token/batch'),\n\t\t\tmethod: () => 'POST',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'Users' : 'Tokens'} Deleted`,\n\t\t\ttoastBackground: 'preset-filled-success-500'\n\t\t},\n\t\tblock: {\n\t\t\tbuttonClass: 'gradient-pink',\n\t\t\thoverClass: 'gradient-yellow-hover',\n\t\t\ticonValue: 'material-symbols:lock',\n\t\t\tlabel: 'Block',\n\t\t\tmodalTitle: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn `Please Confirm User <span class=\"text-error-500 font-bold\">Block</span>`;\n\t\t\t\t}\n\t\t\t\treturn `Please Confirm Token <span class=\"text-error-500 font-bold\">Block</span>`;\n\t\t\t},\n\t\t\tmodalBody: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst user = safeSelectedRows[0];\n\t\t\t\t\t\tif (isUser(user)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will prevent them from accessing the system.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} users</span>? This will prevent them from accessing the system.`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Token blocking with enhanced styling\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst token = safeSelectedRows[0];\n\t\t\t\t\t\tif (isToken(token)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will prevent the token from being used.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} tokens</span>? This will prevent them from being used.`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tendpoint: () => (type === 'user' ? '/api/user/batch' : '/api/token/batch'),\n\t\t\tmethod: () => 'POST',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'Users' : 'Tokens'} Blocked`,\n\t\t\ttoastBackground: 'preset-filled-success-500'\n\t\t},\n\t\tunblock: {\n\t\t\tbuttonClass: 'gradient-yellow',\n\t\t\thoverClass: 'gradient-primary-hover',\n\t\t\ticonValue: 'material-symbols:lock-open',\n\t\t\tlabel: 'Unblock',\n\t\t\tmodalTitle: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn `Please Confirm User <span class=\"text-success-500 font-bold\">Unblock</span>`;\n\t\t\t\t}\n\t\t\t\treturn `Please Confirm Token <span class=\"text-success-500 font-bold\">Unblock</span>`;\n\t\t\t},\n\t\t\tmodalBody: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst user = safeSelectedRows[0];\n\t\t\t\t\t\tif (isUser(user)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will allow them to access the system again.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} users</span>? This will allow them to access the system again.`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Token unblocking with enhanced styling\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst token = safeSelectedRows[0];\n\t\t\t\t\t\tif (isToken(token)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will allow the token to be used again.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} tokens</span>? This will allow them to be used again.`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tendpoint: () => (type === 'user' ? '/api/user/batch' : '/api/token/batch'),\n\t\t\tmethod: () => 'POST',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'Users' : 'Tokens'} Unblocked`,\n\t\t\ttoastBackground: 'preset-filled-success-500'\n\t\t}\n\t});\n\n\tasync function executeBatchAction(action: ActionType, config: any) {\n\t\ttry {\n\t\t\tlet body: string;\n\t\t\t// Handle batch operations (delete, block, unblock)\n\t\t\tif (type === 'user') {\n\t\t\t\tbody = JSON.stringify({\n\t\t\t\t\tuserIds: safeSelectedRows.filter(isUser).map((row: User) => row._id),\n\t\t\t\t\taction: action\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Token batch operations\n\t\t\t\tbody = JSON.stringify({\n\t\t\t\t\ttokenIds: safeSelectedRows.filter(isToken).map((row: Token) => row.token),\n\t\t\t\t\taction: action\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst endpoint = config.endpoint();\n\t\t\tconst res = await fetch(endpoint, {\n\t\t\t\tmethod: config.method(),\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\t// Try to parse error response\n\t\t\t\tlet errorMessage = `Failed to ${action} ${type}`;\n\t\t\t\ttry {\n\t\t\t\t\tconst errorData = await res.json();\n\t\t\t\t\terrorMessage = errorData.message || errorMessage;\n\t\t\t\t} catch {\n\t\t\t\t\t// If JSON parsing fails, use status text\n\t\t\t\t\terrorMessage = res.statusText || errorMessage;\n\t\t\t\t}\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\t// Generate smart toast message based on what actually changed\n\t\t\tlet toastMessage = data.message || config.toastMessage();\n\n\t\t\ttoaster.success({ description: toastMessage });\n\n\t\t\t// Dispatch update event for parent component to handle local state updates\n\t\t\tif (action === 'block' || action === 'unblock' || action === 'delete') {\n\t\t\t\tconst ids =\n\t\t\t\t\ttype === 'user'\n\t\t\t\t\t\t? safeSelectedRows.filter(isUser).map((row: User) => row._id)\n\t\t\t\t\t\t: safeSelectedRows.filter(isToken).map((row: Token) => row.token);\n\n\t\t\t\tonUpdate({\n\t\t\t\t\tids,\n\t\t\t\t\taction: action,\n\t\t\t\t\ttype\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait invalidateAll();\n\t\t} catch (error) {\n\t\t\tlogger.error(`Error during action '${action}' for type '${type}':`, error);\n\t\t\tconst errorMessage = error instanceof Error ? error.message : `An unknown error occurred.`;\n\t\t\ttoaster.error({ description: errorMessage });\n\t\t}\n\t}\n\n\tasync function handleAction(action: ActionType) {\n\t\tif (isDisabled) {\n\t\t\ttoaster.error({ description: `Please select ${type}(s) to ${action}` });\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if delete is disabled for users\n\t\tif (action === 'delete' && isDeleteDisabled) {\n\t\t\ttoaster.error({ description: 'Cannot delete the last user in the system' });\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === 'edit' && isMultipleSelected) {\n\t\t\ttoaster.error({ description: `Please select only one ${type} to edit` });\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if action is available (shouldn't happen with smart UI, but good safeguard)\n\t\tif (!availableActions.includes(action)) {\n\t\t\tconst currentBlockState = blockState;\n\t\t\tif (currentBlockState() === 'all-blocked' && action === 'block') {\n\t\t\t\ttoaster.warning({ description: 'All selected items are already blocked' });\n\t\t\t\treturn;\n\t\t\t} else if (currentBlockState() === 'all-unblocked' && action === 'unblock') {\n\t\t\t\ttoaster.warning({ description: 'All selected items are already unblocked' });\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Additional validation for token editing\n\t\tif (action === 'edit' && type === 'token') {\n\t\t\tconst tokenData = isToken(safeSelectedRows[0]) ? safeSelectedRows[0] : undefined;\n\t\t\tif (!tokenData?.token) {\n\t\t\t\ttoaster.error({ description: 'Invalid token data selected' });\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst config = actionConfig[action];\n\t\tconst isEdit = action === 'edit';\n\n\t\tif (isEdit) {\n\t\t\t// Component Dialog\n\t\t\tif (type === 'user') {\n\t\t\t\tmodalState.trigger(ModalEditForm as any, {\n\t\t\t\t\tisGivenData: true,\n\t\t\t\t\tusername: isUser(safeSelectedRows[0]) ? ((safeSelectedRows[0] as User).username ?? null) : null,\n\t\t\t\t\temail: safeSelectedRows[0].email,\n\t\t\t\t\trole: safeSelectedRows[0].role,\n\t\t\t\t\tuser_id: (safeSelectedRows[0] as User)._id,\n\t\t\t\t\ttitle: config.modalTitle(),\n\t\t\t\t\tbody: config.modalBody() // Pass body if ModalEditForm supports it\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmodalState.trigger(\n\t\t\t\t\tModalEditToken as any,\n\t\t\t\t\t{\n\t\t\t\t\t\ttoken: (safeSelectedRows[0] as Token).token,\n\t\t\t\t\t\temail: safeSelectedRows[0].email,\n\t\t\t\t\t\trole: safeSelectedRows[0].role,\n\t\t\t\t\t\tuser_id: (safeSelectedRows[0] as Token).user_id,\n\t\t\t\t\t\texpires: convertDateToExpiresFormat((safeSelectedRows[0] as Token).expires),\n\t\t\t\t\t\ttitle: config.modalTitle(),\n\t\t\t\t\t\tbody: config.modalBody()\n\t\t\t\t\t},\n\t\t\t\t\t(res: any) => {\n\t\t\t\t\t\tif (res && res.success) {\n\t\t\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t\t\taction: 'refresh',\n\t\t\t\t\t\t\t\ttype: 'token',\n\t\t\t\t\t\t\t\tids: []\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\t// Confirm Dialog\n\t\t\tshowConfirm({\n\t\t\t\ttitle: config.modalTitle(),\n\t\t\t\tbody: config.modalBody(),\n\t\t\t\tonConfirm: async () => {\n\t\t\t\t\tawait executeBatchAction(action, config);\n\t\t\t\t\tmodalState.close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction toggleDropdown(e: MouseEvent) {\n\t\te.stopPropagation();\n\t\tif (isDisabled) return;\n\t\tisDropdownOpen = !isDropdownOpen;\n\t}\n\n\tfunction handleOptionClick(event: Event, action: ActionType) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tlistboxValue = action;\n\t\tisDropdownOpen = false;\n\t\thandleAction(action);\n\t}\n</script>\n\n<!-- Multi-button group -->\n<div class=\"relative flex items-center\" bind:this={dropdownRef}>\n\t<div\n\t\tclass=\"group/main relative flex items-center shadow-xl overflow-visible transition-all duration-200 {!isDisabled\n\t\t\t? 'active:scale-95 cursor-pointer'\n\t\t\t: ''} rounded-l-full rounded-r-md border border-white/20 {isDropdownOpen ? 'ring-2 ring-primary-500/50' : ''}\"\n\t\trole=\"group\"\n\t>\n\t\t<!-- Main Action Button -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonclick={() => handleAction(listboxValue)}\n\t\t\tdisabled={isDisabled || (listboxValue === 'delete' && isDeleteDisabled)}\n\t\t\tclass=\"h-[40px] min-w-[120px] font-bold transition-all duration-200\n\t\t\t\t{!isDisabled ? 'active:scale-95' : 'pointer-events-none opacity-50 grayscale'} \n\t\t\t\t{actionConfig[listboxValue].buttonClass} text-white\n\t\t\t\trounded-l-full rounded-r-none px-6 flex items-center justify-center gap-2 border-r border-white/20\"\n\t\t\taria-label=\"{listboxValue} selected items\"\n\t\t>\n\t\t\t<iconify-icon icon={actionConfig[listboxValue].iconValue} width=\"20\"></iconify-icon>\n\t\t\t<span class=\"uppercase tracking-wider\">{listboxValue}</span>\n\t\t</button>\n\n\t\t<!-- Dropdown Toggle -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonclick={toggleDropdown}\n\t\t\tdisabled={isDisabled}\n\t\t\tclass=\"h-[40px] w-[40px] transition-all duration-200 text-white flex items-center justify-center shadow-inner rounded-r-md\n\t\t\t\t{!isDisabled ? 'bg-surface-800 hover:bg-surface-700 active:scale-95 cursor-pointer' : 'bg-surface-800 opacity-50 pointer-events-none'}\"\n\t\t\taria-haspopup=\"menu\"\n\t\t\taria-expanded={isDropdownOpen}\n\t\t\taria-label=\"Toggle actions menu\"\n\t\t>\n\t\t\t<iconify-icon icon=\"ic:round-keyboard-arrow-down\" width=\"24\" class=\"transition-transform duration-200 {isDropdownOpen ? 'rotate-180' : ''}\"\n\t\t\t></iconify-icon>\n\t\t</button>\n\n\t\t<!-- Dropdown Menu -->\n\t\t{#if isDropdownOpen}\n\t\t\t<div\n\t\t\t\tclass=\"absolute right-0 top-full z-50 mt-2 w-56 overflow-hidden rounded-xl bg-surface-800 shadow-2xl ring-1 ring-black/20 backdrop-blur-md origin-top-right\"\n\t\t\t\trole=\"menu\"\n\t\t\t\taria-label=\"Available actions\"\n\t\t\t\ttransition:scale={{ duration: 150, easing: quintOut, start: 0.95, opacity: 0 }}\n\t\t\t>\n\t\t\t\t<ul class=\"flex flex-col py-1\">\n\t\t\t\t\t{#each filteredActions as action}\n\t\t\t\t\t\t{@const config = actionConfig[action]}\n\t\t\t\t\t\t<li role=\"none\" onmouseenter={() => (hoveredAction = action)} onmouseleave={() => (hoveredAction = null)}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tonclick={(e) => handleOptionClick(e, action)}\n\t\t\t\t\t\t\t\trole=\"menuitem\"\n\t\t\t\t\t\t\t\tclass=\"group/item relative flex w-full items-center gap-3 px-4 py-3 text-left text-white transition-all duration-200 hover:bg-white/5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<!-- Hover Gradient Indicator - Full Background -->\n\t\t\t\t\t\t\t\t<div class=\"absolute inset-0 {config.buttonClass} opacity-0 transition-opacity duration-200 group-hover/item:opacity-100\"></div>\n\n\t\t\t\t\t\t\t\t<!-- Icon -->\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"relative z-10 flex h-8 w-8 items-center justify-center rounded-full bg-surface-700/50 transition-transform group-hover/item:scale-110\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<iconify-icon icon={config.iconValue} width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<!-- Label -->\n\t\t\t\t\t\t\t\t<div class=\"relative z-10 flex-1\">\n\t\t\t\t\t\t\t\t\t<div class=\"font-semibold capitalize\">{action}</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<!-- Check Indicator or Chevron -->\n\t\t\t\t\t\t\t\t{#if hoveredAction === action}\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:chevron-right\" width=\"18\" class=\"relative z-10 text-white\"></iconify-icon>\n\t\t\t\t\t\t\t\t{:else if listboxValue === action}\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:check\" width=\"18\" class=\"relative z-10 text-primary-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t{/each}\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n","<!-- \n@file src/routes/(app)/user/components/AdminArea.svelte\n@component \n**Admin area for managing users and tokens with efficient filtering and pagination.**\n\n### Features\n- Efficient filtering and pagination\n- Sorting by any column\n- Bulk actions for tokens\n- Copy to clipboard\n- \n-->\n\n<script lang=\"ts\">\n\t// Type guards for template and logic\n\tfunction isToken(row: User | Token): row is Token {\n\t\treturn 'token' in row && typeof row.token === 'string';\n\t}\n\tfunction isUser(row: User | Token): row is User {\n\t\treturn '_id' in row && typeof row._id === 'string';\n\t}\n\timport { debounce } from '@shared/utils/utils';\n\timport { untrack } from 'svelte';\n\timport { logger } from '@shared/utils/logger';\n\t// Stores\n\timport { avatarSrc } from '@shared/stores/store.svelte';\n\timport { globalLoadingStore, loadingOperations } from '@shared/stores/loadingStore.svelte';\n\n\t// Components\n\timport PermissionGuard from '@cms/components/PermissionGuard.svelte';\n\timport FloatingInput from '@cms/components/system/inputs/floatingInput.svelte';\n\timport Boolean from '@cms/components/system/table/Boolean.svelte';\n\timport Role from '@cms/components/system/table/Role.svelte';\n\timport TableFilter from '@cms/components/system/table/TableFilter.svelte';\n\timport TableIcons from '@cms/components/system/table/TableIcons.svelte';\n\timport TablePagination from '@cms/components/system/table/TablePagination.svelte';\n\timport ModalEditToken from './ModalEditToken.svelte';\n\timport Multibutton from './Multibutton.svelte';\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\t// Skeleton\n\timport { Avatar } from '@skeletonlabs/skeleton-svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\timport { toaster } from '@shared/stores/store.svelte';\n\t// Svelte-dnd-action\n\timport { PermissionAction, PermissionType } from '@shared/database/auth/types';\n\timport { dndzone } from 'svelte-dnd-action';\n\timport { flip } from 'svelte/animate';\n\n\t// Types\n\timport type { User, Token } from '@shared/database/auth/types';\n\n\ttype TableDataType = User | Token;\n\n\tinterface TableHeader {\n\t\tlabel: string;\n\t\tkey: keyof User | keyof Token;\n\t\tvisible: boolean;\n\t\tid: string;\n\t}\n\n\t// Props - Using API for scalability\n\tconst { currentUser = null, isMultiTenant = false, roles = [] } = $props();\n\n\tconst waitFilter = debounce(300);\n\tconst flipDurationMs = 300;\n\n\t// State for API-fetched data (replaces adminData usage for scalability)\n\tlet tableData: TableDataType[] = $state([]);\n\tlet totalItems = $state(0);\n\n\tasync function fetchData() {\n\t\tawait globalLoadingStore.withLoading(\n\t\t\tloadingOperations.dataFetch,\n\t\t\tasync () => {\n\t\t\t\tconst endpoint = showUserList ? '/api/admin/users' : '/api/admin/tokens';\n\t\t\t\t// eslint-disable-next-line svelte/prefer-svelte-reactivity\n\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\tparams.set('page', String(currentPage));\n\t\t\t\tparams.set('limit', String(rowsPerPage));\n\t\t\t\tparams.set('sort', sorting.sortedBy || 'createdAt');\n\t\t\t\tif (sorting.isSorted !== 0) {\n\t\t\t\t\tparams.set('order', sorting.isSorted === 1 ? 'asc' : 'desc');\n\t\t\t\t}\n\t\t\t\tif (globalSearchValue) {\n\t\t\t\t\tparams.set('search', globalSearchValue);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch(`${endpoint}?${params.toString()}`);\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tconst errorData = await response.json();\n\t\t\t\t\t\tthrow new Error(errorData.message || 'Failed to fetch data');\n\t\t\t\t\t}\n\t\t\t\t\tconst result = await response.json();\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\ttableData = result.data;\n\t\t\t\t\t\ttotalItems = result.pagination.totalItems;\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Unknown error';\n\t\t\t\t\tlogger.error('AdminArea fetch error:', errorMessage);\n\t\t\t\t\ttoaster.error({ description: `Error fetching data: ${errorMessage}` });\n\t\t\t\t\ttableData = [];\n\t\t\t\t\ttotalItems = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t\t'Fetching admin data'\n\t\t);\n\t}\n\n\t// Custom event handler for updates from Multibutton\n\tfunction handleBatchUpdate(data: { ids: string[]; action: string; type: 'user' | 'token' }) {\n\t\tconst { ids, action, type } = data;\n\n\t\tif (action === 'refresh') {\n\t\t\tfetchData();\n\t\t\treturn;\n\t\t}\n\n\t\t// Update the tableData instead of adminData for scalability\n\t\tif (tableData) {\n\t\t\tlet updated = false;\n\n\t\t\tif (action === 'delete') {\n\t\t\t\t// Remove deleted items from the table\n\t\t\t\tconst updatedData = tableData.filter((item: User | Token) => {\n\t\t\t\t\tif (type === 'user' && isUser(item)) return !ids.includes(item._id);\n\t\t\t\t\tif (type === 'token' && isToken(item)) return !ids.includes(item.token);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\n\t\t\t\tif (updatedData.length !== tableData.length) {\n\t\t\t\t\ttableData = updatedData;\n\t\t\t\t\tupdated = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Handle block/unblock actions\n\t\t\t\tconst updatedData = tableData.map((item: User | Token) => {\n\t\t\t\t\tlet shouldUpdate = false;\n\t\t\t\t\tif (type === 'user' && isUser(item) && ids.includes(item._id)) shouldUpdate = true;\n\t\t\t\t\tif (type === 'token' && isToken(item) && ids.includes(item.token)) shouldUpdate = true;\n\n\t\t\t\t\tif (shouldUpdate) {\n\t\t\t\t\t\tupdated = true;\n\t\t\t\t\t\tif (action === 'block') {\n\t\t\t\t\t\t\treturn { ...item, blocked: true };\n\t\t\t\t\t\t} else if (action === 'unblock') {\n\t\t\t\t\t\t\treturn { ...item, blocked: false };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn item;\n\t\t\t\t});\n\n\t\t\t\tif (updated) {\n\t\t\t\t\ttableData = updatedData;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Clear selection after any action\n\t\t\tif (updated) {\n\t\t\t\tselectedMap = {};\n\t\t\t\tselectAll = false;\n\t\t\t}\n\t\t}\n\t} // Table header definitions\n\tconst tableHeadersUser = [\n\t\t{ label: m.adminarea_blocked(), key: 'blocked' },\n\t\t{ label: m.form_avatar(), key: 'avatar' },\n\t\t{ label: m.email(), key: 'email' },\n\t\t{ label: m.username(), key: 'username' },\n\t\t{ label: m.role(), key: 'role' },\n\t\t{ label: 'Tenant ID', key: 'tenantId' },\n\t\t{ label: m.adminarea_user_id(), key: '_id' },\n\t\t{ label: m.adminarea_activesession(), key: 'activeSessions' },\n\t\t{ label: m.adminarea_lastaccess(), key: 'lastAccess' },\n\t\t{ label: m.adminarea_createat(), key: 'createdAt' },\n\t\t{ label: m.adminarea_updatedat(), key: 'updatedAt' }\n\t] as const;\n\n\tconst tableHeaderToken = [\n\t\t{ label: m.adminarea_blocked(), key: 'blocked' },\n\t\t{ label: m.email(), key: 'email' },\n\t\t{ label: m.role(), key: 'role' },\n\t\t{ label: 'Tenant ID', key: 'tenantId' },\n\t\t{ label: m.adminarea_token(), key: 'token' },\n\t\t{ label: m.adminarea_expiresin(), key: 'expires' },\n\t\t{ label: m.adminarea_createat(), key: 'createdAt' },\n\t\t{ label: m.adminarea_updatedat(), key: 'updatedAt' }\n\t] as const;\n\n\t// Core state with proper initialization\n\tlet showUserList = $state(true);\n\tlet showUsertoken = $state(false);\n\tlet showExpiredTokens = $state(false);\n\tlet globalSearchValue = $state('');\n\tlet searchShow = $state(false);\n\tlet filterShow = $state(false);\n\tlet columnShow = $state(false);\n\tlet selectAll = $state(false);\n\tlet selectedMap: Record<number, boolean> = $state({});\n\n\t// Derived rows to display and selection will be defined below\n\tlet density = $state(\n\t\t(() => {\n\t\t\tconst settings = localStorage.getItem('userPaginationSettings');\n\t\t\treturn settings ? (JSON.parse(settings).density ?? 'normal') : 'normal';\n\t\t})()\n\t);\n\tlet selectAllColumns = $state(true);\n\t// pagesCount becomes derived below\n\tlet currentPage = $state(1);\n\tlet rowsPerPage = $state(10);\n\tlet filters = $state({});\n\tlet sorting = $state({ sortedBy: '', isSorted: 0 });\n\n\t// Initialize displayTableHeaders with a safe default\n\tlet displayTableHeaders: TableHeader[] = $state([]);\n\n\t$effect(() => {\n\t\t// Update displayTableHeaders when view changes\n\t\tconst baseHeaders = showUserList ? tableHeadersUser : tableHeaderToken;\n\t\tconst relevantHeaders = isMultiTenant ? baseHeaders : baseHeaders.filter((h) => h.key !== 'tenantId');\n\t\tdisplayTableHeaders = relevantHeaders.map((header) => ({\n\t\t\tlabel: header.label,\n\t\t\tkey: header.key,\n\t\t\tvisible: true,\n\t\t\tid: `header-${Math.random().toString(36).substring(2, 15)}-${Date.now().toString(36)}`\n\t\t}));\n\t});\n\n\t// Reactive effect to fetch data when dependencies change\n\t$effect(() => {\n\t\t// Rerun when any of these reactive variables change\n\t\tvoid showUserList;\n\t\tvoid showUsertoken;\n\t\tvoid currentPage;\n\t\tvoid rowsPerPage;\n\t\tvoid sorting;\n\t\tvoid globalSearchValue;\n\t\tvoid currentUser; // Watch for changes to current user (triggers refresh after user update)\n\n\t\tuntrack(() => {\n\t\t\tfetchData();\n\t\t});\n\t});\n\n\t// Function to edit a specific token\n\tfunction editToken(tokenId: Token) {\n\t\tconst tokenData = tokenId;\n\t\tif (!tokenData) return;\n\n\t\tmodalState.trigger(\n\t\t\tModalEditToken as any,\n\t\t\t{\n\t\t\t\ttoken: tokenData.token,\n\t\t\t\temail: tokenData.email,\n\t\t\t\trole: tokenData.role,\n\t\t\t\texpires: convertDateToExpiresFormat(tokenData.expires),\n\t\t\t\ttitle: m.multibuttontoken_modaltitle(),\n\t\t\t\tbody: m.multibuttontoken_modalbody(),\n\t\t\t\troles // Pass roles explicitly\n\t\t\t},\n\t\t\t(result: any) => {\n\t\t\t\tif (result && result.success) {\n\t\t\t\t\tfetchData();\n\t\t\t\t} else if (result?.success === false) {\n\t\t\t\t\ttoaster.error({ description: result.error || 'Failed to update token' });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t// Helper function to convert Date to expires format expected by ModalEditToken\n\tfunction convertDateToExpiresFormat(expiresDate: Date | string | null): string {\n\t\tif (!expiresDate) return '2 days'; // Default\n\n\t\tconst now = new Date();\n\t\tconst expires = new Date(expiresDate);\n\t\tconst diffMs = expires.getTime() - now.getTime();\n\t\tconst diffHours = Math.ceil(diffMs / (1000 * 60 * 60));\n\t\tconst diffDays = Math.ceil(diffHours / 24);\n\n\t\t// Match the available options in ModalEditToken\n\t\tif (diffHours <= 2) return '2 hrs';\n\t\tif (diffHours <= 12) return '12 hrs';\n\t\tif (diffDays <= 2) return '2 days';\n\t\tif (diffDays <= 7) return '1 week';\n\t\tif (diffDays <= 14) return '2 weeks';\n\t\tif (diffDays <= 30) return '1 month';\n\n\t\treturn '1 month'; // Max available option\n\t}\n\n\t// Normalize media URLs for table display to avoid requesting bare /files\n\tfunction normalizeMediaUrl(url: string | null | undefined): string {\n\t\tif (!url) return '/Default_User.svg';\n\t\ttry {\n\t\t\tif (url.startsWith('data:') || /^https?:\\/\\//i.test(url)) return url;\n\n\t\t\t// Allow direct svg in static\n\t\t\tif (/^\\/?[^\\s?]+\\.svg$/i.test(url)) return url.startsWith('/') ? url : `/${url}`;\n\n\t\t\t// Normalize path\n\t\t\t// 1. Remove leading slashes\n\t\t\tlet clean = url.replace(/^\\/+/, '');\n\t\t\t// 2. Remove prefixes\n\t\t\tclean = clean.replace(/^mediaFolder\\//, '').replace(/^files\\//, '');\n\t\t\t// 3. Remove leading slashes again just in case\n\t\t\tclean = clean.replace(/^\\/+/, '');\n\n\t\t\tif (clean === 'files' || clean === '') return '/Default_User.svg';\n\n\t\t\t// Add timestamp for cache busting\n\t\t\treturn `/files/${clean}?t=${Date.now()}`;\n\t\t} catch {\n\t\t\treturn '/Default_User.svg';\n\t\t}\n\t}\n\n\t// Helper function to calculate remaining time until expiration for display in table\n\tfunction getRemainingTime(expiresDate: Date | string | null): string {\n\t\tif (!expiresDate) return 'Never';\n\n\t\tconst now = new Date();\n\t\tconst expires = new Date(expiresDate);\n\t\tconst diffMs = expires.getTime() - now.getTime();\n\n\t\t// If expired, return 'Expired'\n\t\tif (diffMs <= 0) return 'Expired';\n\n\t\tconst diffMinutes = Math.floor(diffMs / (1000 * 60));\n\t\tconst diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n\t\tconst diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n\t\tif (diffDays > 0) {\n\t\t\tconst remainingHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n\t\t\treturn remainingHours > 0 ? `${diffDays}d ${remainingHours}h` : `${diffDays}d`;\n\t\t} else if (diffHours > 0) {\n\t\t\tconst remainingMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n\t\t\treturn remainingMinutes > 0 ? `${diffHours}h ${remainingMinutes}m` : `${diffHours}h`;\n\t\t} else {\n\t\t\treturn `${diffMinutes}m`;\n\t\t}\n\t}\n\n\t// Safe date formatter for unknown values coming from API\n\tfunction formatDate(value: unknown): string {\n\t\tif (value === null || value === undefined || value === '') return '-';\n\t\ttry {\n\t\t\tconst d = value instanceof Date ? value : new Date(String(value));\n\t\t\tif (isNaN(d.getTime())) return '-';\n\t\t\treturn d.toLocaleString();\n\t\t} catch {\n\t\t\treturn '-';\n\t\t}\n\t}\n\n\t// Toggle user blocked status - always show confirmation modal (like Multibutton)\n\tasync function toggleUserBlocked(user: User) {\n\t\tif (!user._id) return;\n\n\t\t// Prevent admins from blocking themselves\n\t\tif (currentUser && user._id === currentUser._id) {\n\t\t\ttoaster.warning({ description: 'You cannot block your own account' });\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = user.blocked ? 'unblock' : 'block';\n\t\tconst actionPastTense = user.blocked ? 'unblocked' : 'blocked';\n\n\t\t// Always show confirmation modal (same logic as Multibutton) with enhanced styling using theme colors\n\t\tconst actionColor = user.blocked ? 'text-success-500' : 'text-error-500';\n\t\tconst actionWord = user.blocked ? 'Unblock' : 'Block';\n\n\t\tconst modalTitle = `Please Confirm User <span class=\"${actionColor} font-bold\">${actionWord}</span>`;\n\t\tconst modalBody = user.blocked\n\t\t\t? `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will allow them to access the system again.`\n\t\t\t: `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will prevent them from accessing the system.`;\n\n\t\tshowConfirm({\n\t\t\ttitle: modalTitle,\n\t\t\tbody: modalBody,\n\t\t\tonConfirm: async () => {\n\t\t\t\tawait performBlockAction(user, action, actionPastTense);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function performBlockAction(user: User, action: string, actionPastTense: string) {\n\t\ttry {\n\t\t\tconst response = await fetch('/api/user/batch', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tuserIds: [user._id],\n\t\t\t\t\taction: action\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (result.success) {\n\t\t\t\t// Update the user in tableData to reflect changes immediately\n\t\t\t\tconst updatedData = tableData.map((item: User | Token) =>\n\t\t\t\t\t'_id' in item && (item as User)._id === user._id ? { ...item, blocked: !item.blocked } : item\n\t\t\t\t);\n\t\t\t\ttableData = updatedData;\n\t\t\t\ttoaster.success({ description: `User ${actionPastTense} successfully` });\n\t\t\t} else {\n\t\t\t\tthrow new Error(result.message || `Failed to ${action} user`);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Unknown error';\n\t\t\ttoaster.error({ description: `Failed to ${action} user: ${errorMessage}` });\n\t\t}\n\t}\n\n\t// Toggle token blocked status - similar to user blocking\n\tasync function toggleTokenBlocked(token: Token) {\n\t\tif (!token.token) return;\n\n\t\tconst action = token.blocked ? 'unblock' : 'block';\n\t\tconst actionPastTense = token.blocked ? 'unblocked' : 'blocked';\n\n\t\t// Show confirmation modal with enhanced styling using theme colors\n\t\tconst actionColor = token.blocked ? 'text-success-500' : 'text-error-500';\n\t\tconst actionWord = token.blocked ? 'Unblock' : 'Block';\n\n\t\tconst modalTitle = `Please Confirm Token <span class=\"${actionColor} font-bold\">${actionWord}</span>`;\n\t\tconst modalBody = token.blocked\n\t\t\t? `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will allow the token to be used again.`\n\t\t\t: `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will prevent the token from being used.`;\n\n\t\tshowConfirm({\n\t\t\ttitle: modalTitle,\n\t\t\tbody: modalBody,\n\t\t\tonConfirm: async () => {\n\t\t\t\tawait performTokenBlockAction(token, action, actionPastTense);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function performTokenBlockAction(token: Token, action: string, actionPastTense: string) {\n\t\ttry {\n\t\t\tconst response = await fetch('/api/token/batch', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\ttokenIds: [token.token],\n\t\t\t\t\taction: action\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (result.success) {\n\t\t\t\t// Update the token in tableData to reflect changes immediately\n\t\t\t\tconst updatedData = tableData.map((item: User | Token) =>\n\t\t\t\t\t'token' in item && (item as Token).token === token.token ? { ...item, blocked: !item.blocked } : item\n\t\t\t\t);\n\t\t\t\ttableData = updatedData;\n\t\t\t\ttoaster.success({ description: `Token ${actionPastTense} successfully` });\n\t\t\t} else {\n\t\t\t\tthrow new Error(result.message || `Failed to ${action} token`);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Unknown error';\n\t\t\ttoaster.error({ description: `Failed to ${action} token: ${errorMessage}` });\n\t\t}\n\t}\n\n\tfunction handleDndConsider(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t}\n\n\tfunction handleDndFinalize(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t\tlocalStorage.setItem('userPaginationSettings', JSON.stringify({ density, displayTableHeaders }));\n\t}\n\n\tfunction modalTokenUser() {\n\t\tmodalState.trigger(\n\t\t\tModalEditToken as any,\n\t\t\t{\n\t\t\t\ttitle: m.multibuttontoken_modaltitle(),\n\t\t\t\tbody: m.multibuttontoken_modalbody(),\n\t\t\t\troles, // Pass available roles\n\t\t\t\tuser: currentUser // Pass current user context if needed\n\t\t\t},\n\t\t\t(result: any) => {\n\t\t\t\t// Refresh data if token was created\n\t\t\t\tif (result && result.success) {\n\t\t\t\t\tfetchData();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t// Toggle views\n\tfunction toggleUserList() {\n\t\tshowUserList = !showUserList;\n\t\tif (showUsertoken) showUsertoken = false;\n\t}\n\n\tfunction toggleUserToken() {\n\t\tshowUsertoken = !showUsertoken;\n\t\tshowUserList = false;\n\t}\n\n\t// --- SERVER-SIDE PAGINATION: API handles filtering, sorting, pagination ---\n\t// tableData is now the current page from API, not all data\n\t// totalItems is the total count from API\n\n\tconst pagesCount = $derived.by(() => Math.ceil(totalItems / rowsPerPage) || 1);\n\n\t// Derive selected rows from selectedMap; ensure type compatibility by mapping to UserData | TokenData\n\tlet selectedRows: TableDataType[] = $derived.by(() =>\n\t\tObject.entries(selectedMap)\n\t\t\t.filter(([, isSelected]) => isSelected)\n\t\t\t.map(([index]) => tableData[parseInt(index)])\n\t\t\t.filter((item): item is User | Token => item !== undefined && item !== null)\n\t);\n\n\t// Reset selection and page when the data source changes\n\t$effect(() => {\n\t\tvoid tableData; // track dependency\n\t\tuntrack(() => {\n\t\t\tselectedMap = {};\n\t\t\tselectAll = false;\n\t\t\tcurrentPage = 1;\n\t\t});\n\t});\n\n\t// Keep current page in bounds when page count shrinks\n\t$effect(() => {\n\t\tif (currentPage > pagesCount) {\n\t\t\tcurrentPage = pagesCount;\n\t\t}\n\t});\n\n\tfunction handleCheckboxChange() {\n\t\tconst allColumnsVisible = displayTableHeaders.every((header) => header.visible);\n\t\tdisplayTableHeaders = displayTableHeaders.map((header) => ({\n\t\t\t...header,\n\t\t\tvisible: !allColumnsVisible\n\t\t}));\n\t\tselectAllColumns = !allColumnsVisible;\n\t}\n\n\tfunction handleInputChange(value: string, headerKey: string) {\n\t\tif (value) {\n\t\t\tconst newFilters: Record<string, string | undefined> = { ...filters, [headerKey]: value };\n\t\t\twaitFilter(() => {\n\t\t\t\tfilters = newFilters;\n\t\t\t});\n\t\t} else {\n\t\t\tconst newFilters: Record<string, string | undefined> = { ...filters };\n\t\t\tdelete newFilters[headerKey];\n\t\t\tfilters = newFilters;\n\t\t}\n\t}\n</script>\n\n<div class=\"flex flex-col\">\n\t<p class=\"h2 mb-2 text-center text-3xl font-bold dark:text-white\">{m.adminarea_adminarea()}</p>\n\n\t<div class=\"flex flex-col flex-wrap items-center justify-evenly gap-2 sm:flex-row xl:justify-between\">\n\t\t<button onclick={modalTokenUser} aria-label={m.adminarea_emailtoken()} class=\"gradient-primary btn w-full text-white sm:max-w-xs\">\n\t\t\t<iconify-icon icon=\"material-symbols:mail\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t<span class=\"whitespace-normal wrap-break-word\">{m.adminarea_emailtoken()}</span>\n\t\t</button>\n\n\t\t<PermissionGuard\n\t\t\tconfig={{\n\t\t\t\tcontextId: 'user:manage',\n\t\t\t\tname: 'Manage User Tokens',\n\t\t\t\tdescription: 'Allows management of user tokens in the admin area.',\n\t\t\t\taction: PermissionAction.MANAGE,\n\t\t\t\tcontextType: PermissionType.USER\n\t\t\t}}\n\t\t>\n\t\t\t<button\n\t\t\t\tonclick={toggleUserToken}\n\t\t\t\taria-label={showUsertoken ? m.adminarea_hideusertoken() : m.adminarea_showtoken()}\n\t\t\t\tclass=\"gradient-secondary btn w-full text-white sm:max-w-xs\"\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"material-symbols:key-outline\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t<span>{showUsertoken ? m.adminarea_hideusertoken() : m.adminarea_showtoken()}</span>\n\t\t\t</button>\n\n\t\t\t{#if showUsertoken && !showUserList && tableData}\n\t\t\t\t{@const now = new Date()}\n\t\t\t\t{@const expiredTokens = tableData.filter(\n\t\t\t\t\t(item): item is Token => isToken(item) && item.expires != null && new Date(String(item.expires)) < now\n\t\t\t\t)}\n\t\t\t\t{#if expiredTokens.length > 0}\n\t\t\t\t\t<button\n\t\t\t\t\t\tonclick={() => (showExpiredTokens = !showExpiredTokens)}\n\t\t\t\t\t\taria-label={showExpiredTokens ? 'Hide Expired Tokens' : 'Show Expired Tokens'}\n\t\t\t\t\t\tclass=\"gradient-secondary btn w-full text-white sm:max-w-xs\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"material-symbols:schedule\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t\t\t<span>{showExpiredTokens ? 'Hide Expired' : 'Show Expired'}</span>\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</PermissionGuard>\n\n\t\t<button\n\t\t\tonclick={toggleUserList}\n\t\t\taria-label={showUserList ? m.adminarea_hideuserlist() : m.adminarea_showuserlist()}\n\t\t\tclass=\"gradient-tertiary btn w-full text-white sm:max-w-xs\"\n\t\t>\n\t\t\t<iconify-icon icon=\"mdi:account-circle\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t<span>{showUserList ? m.adminarea_hideuserlist() : m.adminarea_showuserlist()}</span>\n\t\t</button>\n\t</div>\n\n\t{#if showUserList || showUsertoken}\n\t\t<div class=\"my-4 flex flex-wrap items-center justify-between gap-1\">\n\t\t\t<h2 class=\"order-1 text-xl font-bold text-tertiary-500 dark:text-primary-500\">\n\t\t\t\t{#if showUserList}{m.adminarea_userlist()}{:else if showUsertoken}{m.adminarea_listtoken()}{/if}\n\t\t\t</h2>\n\n\t\t\t<div class=\"order-3 sm:order-2\">\n\t\t\t\t<TableFilter bind:globalSearchValue bind:searchShow bind:filterShow bind:columnShow bind:density />\n\t\t\t</div>\n\n\t\t\t<div class=\"order-2 flex items-center justify-center sm:order-3\">\n\t\t\t\t<Multibutton {selectedRows} type={showUserList ? 'user' : 'token'} totalUsers={totalItems} {currentUser} onUpdate={handleBatchUpdate} />\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if tableData && tableData.length > 0}\n\t\t\t{#if columnShow}\n\t\t\t\t<div class=\"rounded-b-0 flex flex-col justify-center rounded-t-md border-b bg-surface-300 text-center dark:bg-surface-700\">\n\t\t\t\t\t<div class=\"text-white dark:text-primary-500\">{m.entrylist_dnd()}</div>\n\t\t\t\t\t<div class=\"my-2 flex w-full items-center justify-center gap-1\">\n\t\t\t\t\t\t<label class=\"mr-2\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" bind:checked={selectAllColumns} onclick={handleCheckboxChange} />\n\t\t\t\t\t\t\t{m.entrylist_all()}\n\t\t\t\t\t\t</label>\n\n\t\t\t\t\t\t<section\n\t\t\t\t\t\t\tuse:dndzone={{ items: displayTableHeaders, flipDurationMs }}\n\t\t\t\t\t\t\tonconsider={handleDndConsider}\n\t\t\t\t\t\t\tonfinalize={handleDndFinalize}\n\t\t\t\t\t\t\tclass=\"flex flex-wrap justify-center gap-1 rounded-md p-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#each displayTableHeaders as header: TableHeader (header.id)}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"chip {header.visible\n\t\t\t\t\t\t\t\t\t\t? 'preset-filled-secondary-500'\n\t\t\t\t\t\t\t\t\t\t: 'preset-ghost-secondary-500'} w-100 mr-2 flex items-center justify-center\"\n\t\t\t\t\t\t\t\t\tanimate:flip={{ duration: flipDurationMs }}\n\t\t\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\t\t\tdisplayTableHeaders = displayTableHeaders.map((h) => (h.id === header.id ? { ...h, visible: !h.visible } : h));\n\t\t\t\t\t\t\t\t\t\tselectAllColumns = displayTableHeaders.every((h) => h.visible);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if header.visible}\n\t\t\t\t\t\t\t\t\t\t<span><iconify-icon icon=\"fa:check\"></iconify-icon></span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<span class=\"ml-2 capitalize\">{header.label}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"table-container max-h-[calc(100vh-120px)] overflow-auto\">\n\t\t\t\t<table class=\"table table-interactive {density === 'compact' ? 'table-compact' : density === 'normal' ? '' : 'table-comfortable'}\">\n\t\t\t\t\t<thead\n\t\t\t\t\t\tclass=\"divide-x divide-surface-200/50 dark:divide-surface-50 text-surface-500 dark:text-surface-300 bg-secondary-100 dark:bg-surface-800/50\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if filterShow}\n\t\t\t\t\t\t\t<tr class=\"divide-x divide-surface-200/50 dark:divide-surface-700/50\">\n\t\t\t\t\t\t\t\t<th>\n\t\t\t\t\t\t\t\t\t{#if Object.keys(filters).length > 0}\n\t\t\t\t\t\t\t\t\t\t<button onclick={() => (filters = {})} aria-label=\"Clear All Filters\" class=\"preset-outline btn-icon\">\n\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"material-symbols:close\" width=\"24\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</th>\n\n\t\t\t\t\t\t\t\t{#each displayTableHeaders.filter((header) => header.visible) as header (header.id)}\n\t\t\t\t\t\t\t\t\t<th>\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t<FloatingInput\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\t\ticon=\"material-symbols:search-rounded\"\n\t\t\t\t\t\t\t\t\t\t\t\tlabel={m.entrylist_filter()}\n\t\t\t\t\t\t\t\t\t\t\t\tname={header.key}\n\t\t\t\t\t\t\t\t\t\t\t\tonInput={(value) => handleInputChange(value, header.key)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\tclass=\"divide-x divide-surface-300 dark:divide-surface-50 border-b border-surface-300 dark:border-surface-50 font-semibold tracking-wide uppercase text-xs\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TableIcons\n\t\t\t\t\t\t\t\tcellClass=\"w-10 text-center\"\n\t\t\t\t\t\t\t\tchecked={selectAll}\n\t\t\t\t\t\t\t\tonCheck={(checked: boolean) => {\n\t\t\t\t\t\t\t\t\tselectAll = checked;\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < tableData.length; i++) {\n\t\t\t\t\t\t\t\t\t\tselectedMap[i] = checked;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t{#each displayTableHeaders.filter((header) => header.visible) as header (header.id)}\n\t\t\t\t\t\t\t\t<th\n\t\t\t\t\t\t\t\t\tclass=\"cursor-pointer text-tertiary-500 dark:text-primary-500 hover:bg-surface-100/50 dark:hover:bg-surface-800/50 transition-colors\"\n\t\t\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\t\t\tsorting = {\n\t\t\t\t\t\t\t\t\t\t\tsortedBy: header.key,\n\t\t\t\t\t\t\t\t\t\t\tisSorted: sorting.sortedBy === header.key ? (sorting.isSorted === 1 ? -1 : sorting.isSorted === -1 ? 0 : 1) : 1\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t{header.label}\n\t\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\t\ticon=\"material-symbols:arrow-upward-rounded\"\n\t\t\t\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"origin-center duration-300 ease-in-out\"\n\t\t\t\t\t\t\t\t\t\t\tclass:up={sorting.isSorted === 1 && sorting.sortedBy === header.key}\n\t\t\t\t\t\t\t\t\t\t\tclass:invisible={sorting.isSorted === 0 || sorting.sortedBy !== header.key}\n\t\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\n\t\t\t\t\t<tbody class=\"divide-y divide-surface-200/30 dark:divide-surface-700/30\">\n\t\t\t\t\t\t{#each tableData as row, index (isUser(row) ? row._id : isToken(row) ? row.token : index)}\n\t\t\t\t\t\t\t{@const expiresVal: string | Date | null = isToken(row) ? row.expires : null}\n\t\t\t\t\t\t\t{@const isExpired = showUsertoken && expiresVal && new Date(expiresVal) < new Date()}\n\t\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\t\tclass=\"divide-x divide-surface-200/50 dark:divide-surface-50 {isExpired\n\t\t\t\t\t\t\t\t\t? 'bg-error-50 opacity-60 dark:bg-error-900/20'\n\t\t\t\t\t\t\t\t\t: ''} {showUsertoken ? 'cursor-pointer hover:bg-surface-100 dark:hover:bg-surface-800' : ''}\"\n\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t// Only handle click if it's on a token row and not on the checkbox\n\t\t\t\t\t\t\t\t\tif (showUsertoken && !(event.target as HTMLElement)?.closest('td:first-child')) {\n\t\t\t\t\t\t\t\t\t\tif (isToken(row)) editToken(row);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TableIcons\n\t\t\t\t\t\t\t\t\tchecked={selectedMap[index] ?? false}\n\t\t\t\t\t\t\t\t\tonCheck={(checked: boolean) => {\n\t\t\t\t\t\t\t\t\t\tselectedMap[index] = checked;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{#each displayTableHeaders.filter((header) => header.visible) as header (header.id)}\n\t\t\t\t\t\t\t\t\t<td class=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t{#if header.key === 'blocked'}\n\t\t\t\t\t\t\t\t\t\t\t{#if showUserList}\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={() => isUser(row) && toggleUserBlocked(row)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn-sm cursor-pointer rounded-md p-1 transition-all duration-200 hover:scale-105 hover:bg-surface-200 hover:shadow-md dark:hover:bg-surface-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={row.blocked ? 'Click to unblock user' : 'Click to block user'}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={row.blocked ? 'Click to unblock user' : 'Click to block user'}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Boolean value={!!row[header.key]} />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isToken(row)) toggleTokenBlocked(row);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn-sm cursor-pointer rounded-md p-1 transition-all duration-200 hover:scale-105 hover:bg-surface-200 hover:shadow-md dark:hover:bg-surface-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={row.blocked ? 'Click to unblock token' : 'Click to block token'}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={row.blocked ? 'Click to unblock token' : 'Click to block token'}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Boolean value={!!row[header.key]} />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{:else if showUserList && header.key === 'avatar'}\n\t\t\t\t\t\t\t\t\t\t\t<Avatar class=\"size-10 overflow-hidden rounded-full border border-surface-200/50 dark:text-surface-50/50\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Avatar.Image\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={currentUser && isUser(row) && row._id === currentUser._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? normalizeMediaUrl(avatarSrc.value)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: isUser(row) && header.key === 'avatar'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? normalizeMediaUrl(row.avatar)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: '/Default_User.svg'}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-full w-full object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t<Avatar.Fallback>User</Avatar.Fallback>\n\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'role'}\n\t\t\t\t\t\t\t\t\t\t\t<Role\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={isUser(row) && header.key === 'role' ? row.role : isToken(row) && header.key === 'role' ? (row.role ?? '') : ''}\n\t\t\t\t\t\t\t\t\t\t\t\t{roles}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === '_id'}\n\t\t\t\t\t\t\t\t\t\t\t<!-- User ID with clipboard functionality -->\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-mono text-sm\">{isUser(row) ? row._id : isToken(row) ? row._id : '-'}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"preset-ghost btn-icon btn-icon-sm hover:preset-filled-tertiary-500 hover:dark:preset-filled-primary-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Copy User ID\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Copy User ID to clipboard\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst val = String(isUser(row) ? row._id : isToken(row) ? row._id : '');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.clipboard\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.writeText(val)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.success({ description: 'User ID copied to clipboard' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.error({ description: 'Failed to copy' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"oui:copy-clipboard\" class=\"\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'token'}\n\t\t\t\t\t\t\t\t\t\t\t<!-- Token with clipboard functionality -->\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"max-w-[200px] truncate font-mono text-sm\">{isToken(row) && header.key === 'token' ? row.token : '-'}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"preset-ghost btn-icon btn-icon-sm hover:preset-filled-tertiary-500 hover:dark:preset-filled-primary-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Copy Token\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Copy Token to clipboard\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst val = isToken(row) && header.key === 'token' ? row.token : '';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.clipboard\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.writeText(val)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.success({ description: 'Token copied to clipboard' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.error({ description: 'Failed to copy' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"oui:copy-clipboard\" class=\"\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if ['createdAt', 'updatedAt', 'lastAccess', 'expires'].includes(header.key)}\n\t\t\t\t\t\t\t\t\t\t\t{@const dateKey = header.key as 'createdAt' | 'updatedAt' | 'lastAccess' | 'expires'}\n\t\t\t\t\t\t\t\t\t\t\t{@const dateValue = isUser(row) ? row[dateKey as keyof User] : isToken(row) ? row[dateKey as keyof Token] : undefined}\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(dateValue)}\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'expires'}\n\t\t\t\t\t\t\t\t\t\t\t{#if isToken(row) && header.key === 'expires' && row.expires}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const expiresVal = row.expires as string | Date | null}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const isTokenExpired =\n\t\t\t\t\t\t\t\t\t\t\t\t\texpiresVal !== null &&\n\t\t\t\t\t\t\t\t\t\t\t\t\texpiresVal !== undefined &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t(expiresVal instanceof Date ? expiresVal : new Date(String(expiresVal))) < new Date()}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const remainingTime = getRemainingTime(expiresVal)}\n\t\t\t\t\t\t\t\t\t\t\t\t<span class={isTokenExpired ? 'font-semibold text-error-500' : ''}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{remainingTime}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if isTokenExpired}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"material-symbols:warning\" class=\"ml-1 text-error-500\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t-\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t{@const displayValue = isUser(row)\n\t\t\t\t\t\t\t\t\t\t\t\t? String(row[header.key as keyof User] ?? '-')\n\t\t\t\t\t\t\t\t\t\t\t\t: isToken(row)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? String(row[header.key as keyof Token] ?? '-')\n\t\t\t\t\t\t\t\t\t\t\t\t\t: '-'}\n\t\t\t\t\t\t\t\t\t\t\t<!-- eslint-disable-next-line svelte/no-at-html-tags -->\n\t\t\t\t\t\t\t\t\t\t\t{@html displayValue}\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\n\t\t\t<!-- Pagination  -->\n\t\t\t<div class=\"mt-2 flex flex-col items-center justify-center px-2 md:flex-row md:justify-between md:p-4\">\n\t\t\t\t<TablePagination\n\t\t\t\t\tbind:currentPage\n\t\t\t\t\tbind:rowsPerPage\n\t\t\t\t\t{pagesCount}\n\t\t\t\t\t{totalItems}\n\t\t\t\t\trowsPerPageOptions={[2, 10, 25, 50, 100, 500]}\n\t\t\t\t\tonUpdatePage={(page: number) => {\n\t\t\t\t\t\tcurrentPage = page;\n\t\t\t\t\t}}\n\t\t\t\t\tonUpdateRowsPerPage={(rows: number) => {\n\t\t\t\t\t\trowsPerPage = rows;\n\t\t\t\t\t\tcurrentPage = 1;\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"preset-ghost-error-500 btn text-center font-bold\">\n\t\t\t\t{#if showUserList}{m.adminarea_nouser()}{:else if showUsertoken}{m.adminarea_notoken()}{/if}\n\t\t\t</div>\n\t\t{/if}\n\t{/if}\n</div>\n","/**\n * @file src/utils/globalSearchIndex.ts\n * @description\n * This file implements a global search index functionality for a web application.\n * It provides a centralized search mechanism across various parts of the application.\n * Key features include:\n *\n * - Creation and management of a global search index using Svelte stores\n * - Predefined search data for common application areas (Home, Marketplace, User Profile, etc.)\n * - Support for search triggers with associated actions and paths\n * - Functions to add new items to the search index\n * - Search functionality to query the global index\n * - Integration with system logging for tracking search-related activities\n * - Initialization function for setting up the global search functionality\n *\n * The global search index is designed to improve navigation and discoverability\n * within the application, allowing users to quickly find and access different\n * features and content areas.\n *\n * @module GlobalSearchIndex\n */\n\nimport { writable } from 'svelte/store';\nimport { modalState } from '@shared/utils/modalState.svelte';\nimport { ModalEditAvatar, ModalEditForm } from '@cms/user';\n\n// System Logs\nimport { logger } from '@shared/utils/logger';\n\nexport const isSearchVisible = writable(false);\nexport const triggerActionStore = writable<(() => void | Promise<void>)[]>([]);\n\n// Create a writable store for the global search index\nexport interface SearchData {\n\ttitle: string;\n\tdescription: string;\n\tkeywords: string[];\n\ttriggers: {\n\t\t[title: string]: {\n\t\t\tpath: string;\n\t\t\taction?: (() => void | Promise<void>)[];\n\t\t};\n\t};\n}\n\n// Initialize the global search index with predefined data\nexport const globalSearchIndex = writable<SearchData[]>([\n\t{\n\t\ttitle: 'Home',\n\t\tdescription: 'The home page of the blog.',\n\t\tkeywords: ['home', 'dashboard'],\n\t\ttriggers: { 'Go to Home Page': { path: '/' } }\n\t},\n\t{\n\t\ttitle: 'Marketplace',\n\t\tdescription: 'SveltCMS Widget Marketplace.',\n\t\tkeywords: ['widget', 'marketplace', 'plugins', 'extensions'],\n\t\ttriggers: { 'Go to Marketplace': { path: 'https://www.sveltycms.com' } }\n\t},\n\t{\n\t\ttitle: 'GraphQL Yoga',\n\t\tdescription: 'GraphQL Explorer',\n\t\tkeywords: ['graphQL', 'Explorer', 'Yoga', 'API', 'query'],\n\t\ttriggers: { 'Go to GraphQL Explorer': { path: '/api/graphql' } }\n\t},\n\t{\n\t\ttitle: 'User Profile',\n\t\tdescription: 'View and edit your user profile.',\n\t\tkeywords: ['user', 'avatar', 'profile', 'settings', 'account', 'password', 'delete'],\n\t\ttriggers: {\n\t\t\t'Show User Profile': { path: '/user' },\n\t\t\t'Edit Avatar Image': {\n\t\t\t\tpath: '/user',\n\t\t\t\taction: [\n\t\t\t\t\t() => {\n\t\t\t\t\t\tmodalState.trigger(ModalEditAvatar, {\n\t\t\t\t\t\t\ttitle: 'Edit Avatar',\n\t\t\t\t\t\t\tbody: 'Upload or change your avatar image'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t'Edit User Profile': {\n\t\t\t\tpath: '/user',\n\t\t\t\taction: [\n\t\t\t\t\t() => {\n\t\t\t\t\t\tmodalState.trigger(ModalEditForm, {\n\t\t\t\t\t\t\ttitle: 'Edit Profile',\n\t\t\t\t\t\t\tbody: 'Modify your data and then press Save.'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\ttitle: 'User Admin Area',\n\t\tdescription: 'View and edit users in the user admin area.',\n\t\tkeywords: ['user', 'role', 'profile', 'settings', 'account', 'password', 'token', 'admin'],\n\t\ttriggers: {\n\t\t\t'Show User Admin': { path: '/user' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Media Gallery',\n\t\tdescription: 'View and edit your media gallery.',\n\t\tkeywords: ['media', 'gallery', 'images', 'videos', 'documents', 'files'],\n\t\ttriggers: {\n\t\t\t'Go to Media Gallery': { path: '/mediagallery' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Add Media',\n\t\tdescription: 'Add new media to gallery.',\n\t\tkeywords: ['add', 'media', 'gallery', 'images', 'videos', 'documents', 'upload'],\n\t\ttriggers: {\n\t\t\t'Go to Add Media': { path: '/mediagallery/uploadMedia' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Image Editor',\n\t\tdescription: 'Edit and manage images with the image editor.',\n\t\tkeywords: ['image', 'editor', 'edit', 'photos', 'media', 'crop', 'resize'],\n\t\ttriggers: {\n\t\t\t'Go to Image Editor': { path: '/imageEditor' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'System Dashboard',\n\t\tdescription: 'View and manage your dashboard.',\n\t\tkeywords: ['dashboard', 'profile', 'settings', 'load', 'system', 'overview'],\n\t\ttriggers: { 'Go to Dashboard': { path: '/dashboard' } }\n\t},\n\t{\n\t\ttitle: 'Configuration',\n\t\tdescription: 'Configure the system settings.',\n\t\tkeywords: ['configuration', 'settings', 'system', 'setup'],\n\t\ttriggers: { 'Go to Configuration': { path: '/config' } }\n\t},\n\t{\n\t\ttitle: 'System Builder',\n\t\tdescription: 'Build and customize your collections.',\n\t\tkeywords: ['builder', 'category', 'collection', 'configuration', 'settings', 'system', 'permissions'],\n\t\ttriggers: { 'Go to System Builder': { path: '/config/collectionbuilder' } }\n\t},\n\t{\n\t\ttitle: 'Access Management',\n\t\tdescription: 'Manage user access and permissions.',\n\t\tkeywords: ['access', 'management', 'permissions', 'roles', 'users', 'security'],\n\t\ttriggers: {\n\t\t\t'Go to Access Management': { path: '/config/accessManagement' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Roles',\n\t\tdescription: 'Manage user roles in the system.',\n\t\tkeywords: ['roles', 'user roles', 'permissions', 'access', 'security'],\n\t\ttriggers: {\n\t\t\t'Manage Roles': { path: '/config/accessManagement/roles' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Permissions',\n\t\tdescription: 'Configure and manage system permissions.',\n\t\tkeywords: ['permissions', 'access control', 'security', 'roles'],\n\t\ttriggers: {\n\t\t\t'Manage Permissions': { path: '/config/accessManagement/permissions' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Theme Management',\n\t\tdescription: 'Customize the look and feel of your site.',\n\t\tkeywords: ['theme', 'appearance', 'design', 'colors', 'layout', 'customize'],\n\t\ttriggers: {\n\t\t\t'Customize Theme': { path: '/config/themeManagement' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Widget Management',\n\t\tdescription: 'Extend the functionality of your site.',\n\t\tkeywords: ['widget', 'extension', 'customization', 'plugins'],\n\t\ttriggers: {\n\t\t\t'Customize Widget': { path: '/config/widgetManagement' }\n\t\t}\n\t}\n]);\n\nlogger.info('Global search index initialized');\n\n// Function to add new items to the global search index\nexport function addToGlobalSearchIndex(newItem: SearchData) {\n\tglobalSearchIndex.update((currentIndex) => [...currentIndex, newItem]);\n\tlogger.info(`Added new item to global search index: ${newItem.title}`);\n}\n\n// Function to search the global index\nexport function searchGlobalIndex(query: string): SearchData[] {\n\tlet results: SearchData[] = [];\n\tglobalSearchIndex.subscribe((index) => {\n\t\tresults = index.filter(\n\t\t\t(item) =>\n\t\t\t\titem.title.toLowerCase().includes(query.toLowerCase()) ||\n\t\t\t\titem.description.toLowerCase().includes(query.toLowerCase()) ||\n\t\t\t\titem.keywords.some((keyword) => keyword.toLowerCase().includes(query.toLowerCase()))\n\t\t);\n\t})();\n\treturn results;\n}\n\n// Initialize the global search functionality\nexport function initializeGlobalSearch() {\n\t// This function can be called to set up any necessary event listeners or initial state\n\tlogger.info('Global search functionality initialized');\n}\n","<!-- \n@file src/routes/(app)/user/+page.svelte\n@component\n**This file sets up and displays the user page, providing a streamlined interface for managing user accounts and settings**\n\n@example\n<User />\n\n### Props\n- `users` {array} - Array of users\n\n### Features\n- Displays a list of users\n- Provides a user-friendly interface for managing user accounts and settings\n-->\n\n<script lang=\"ts\">\n\timport { invalidateAll } from '$app/navigation';\n\timport { onMount } from 'svelte';\n\t// Auth\n\t// Auth\n\timport { ModalTwoFactorAuth, AdminArea, ModalEditAvatar, ModalEditForm } from '@cms/user';\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Stores\n\timport { avatarSrc } from '@shared/stores/store.svelte';\n\timport { triggerActionStore } from '@shared/utils/globalSearchIndex';\n\t// Components\n\timport PageTitle from '@cms/components/PageTitle.svelte';\n\timport PermissionGuard from '@cms/components/PermissionGuard.svelte';\n\t// Skeleton\n\timport { Avatar } from '@skeletonlabs/skeleton-svelte';\n\timport { setCollection } from '@shared/stores/collectionStore.svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\timport { toaster } from '@shared/stores/store.svelte';\n\n\t// Props\n\tconst { data } = $props();\n\tconst { user: serverUser, isFirstUser, isMultiTenant, is2FAEnabledGlobal } = $derived(data);\n\n\t// Make user data reactive\n\tconst user = $derived({\n\t\t_id: serverUser?._id ?? '',\n\t\temail: serverUser?.email ?? '',\n\t\tusername: serverUser?.username ?? '',\n\t\trole: serverUser?.role ?? '',\n\t\tavatar: serverUser?.avatar ?? '/Default_User.svg',\n\t\ttenantId: serverUser?.tenantId ?? '', // Add tenantId\n\t\tis2FAEnabled: serverUser?.is2FAEnabled ?? false,\n\t\tpermissions: []\n\t});\n\n\t// Define password as state\n\tlet password = $state('hash-password');\n\n\t// Function to open 2FA modal\n\tfunction open2FAModal(): void {\n\t\tmodalState.trigger(ModalTwoFactorAuth, { user }, async (r: any) => {\n\t\t\tif (r) {\n\t\t\t\t// Refresh user data after 2FA changes\n\t\t\t\tawait invalidateAll();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Function to execute actions\n\tfunction executeActions() {\n\t\tconst actions = $triggerActionStore;\n\t\tif (actions.length === 1) {\n\t\t\tactions[0]();\n\t\t} else {\n\t\t\tfor (const action of actions) {\n\t\t\t\taction();\n\t\t\t}\n\t\t}\n\t\ttriggerActionStore.set([]);\n\t}\n\n\t// Execute actions on mount if triggerActionStore has data\n\tonMount(() => {\n\t\tif ($triggerActionStore.length > 0) {\n\t\t\texecuteActions();\n\t\t}\n\t\tsetCollection(null);\n\n\t\t// Note: Avatar initialization is handled by the layout component\n\t\t// to ensure consistent avatar state across the application\n\t});\n\n\t// Modal Trigger - User Form\n\tfunction modalUserForm(): void {\n\t\tmodalState.trigger(ModalEditForm, {\n\t\t\ttitle: m.adminarea_title(),\n\t\t\tbody: m.usermodaluser_settingbody() || 'Update your user details below.'\n\t\t});\n\t}\n\n\t// Modal Trigger - Edit Avatar\n\tfunction modalEditAvatar(): void {\n\t\tmodalState.trigger(\n\t\t\tModalEditAvatar,\n\t\t\t{\n\t\t\t\ttitle: m.usermodaluser_settingtitle(),\n\t\t\t\tbody: m.usermodaluser_settingbody()\n\t\t\t},\n\t\t\tasync (r: any) => {\n\t\t\t\tif (r) {\n\t\t\t\t\ttoaster.success({\n\t\t\t\t\t\tdescription: '<iconify-icon icon=\"radix-icons:avatar\" color=\"white\" width=\"26\" class=\"mr-1\"></iconify-icon> Avatar Updated'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t// Modal Confirm\n\tfunction modalConfirm(): void {\n\t\tshowConfirm({\n\t\t\ttitle: m.usermodalconfirmtitle(),\n\t\t\tbody: m.usermodalconfirmbody(),\n\t\t\t// confirmText: m.usermodalconfirmdeleteuser(),\n\t\t\tonConfirm: async () => {\n\t\t\t\tconst res = await fetch(`/api/user/deleteUsers`, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\tbody: JSON.stringify([user])\n\t\t\t\t});\n\t\t\t\tif (res.status === 200) {\n\t\t\t\t\tawait invalidateAll();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t// Helper to normalize avatar URL\n\tfunction normalizeAvatarUrl(url: string | null | undefined): string {\n\t\tif (!url) return '/Default_User.svg';\n\t\tif (url.startsWith('data:')) return url;\n\n\t\t// 1. Remove leading slashes\n\t\tlet clean = url.replace(/^\\/+/, '');\n\t\t// 2. Remove prefixes\n\t\tclean = clean.replace(/^mediaFolder\\//, '').replace(/^files\\//, '');\n\t\t// 3. Remove leading slashes again just in case\n\t\tclean = clean.replace(/^\\/+/, '');\n\n\t\treturn `/files/${clean}?t=${Date.now()}`;\n\t}\n</script>\n\n<!-- Page Title with Back Button -->\n<PageTitle name={m.userpage_title()} icon=\"mdi:account-circle\" showBackButton={true} backUrl=\"/config\" />\n\n<div class=\"max-h-[calc(100vh-65px)] overflow-auto\">\n\t<div class=\"wrapper mb-2\">\n\t\t<div class=\"grid grid-cols-1 grid-rows-2 gap-1 overflow-hidden md:grid-cols-2 md:grid-rows-1\">\n\t\t\t<!-- Avatar with user info -->\n\t\t\t<div class=\"relative flex flex-col items-center justify-center gap-1\">\n\t\t\t\t<div class=\"relative group\">\n\t\t\t\t\t<Avatar class=\"w-32 h-32 rounded-full border border-white shadow-lg dark:border-surface-800\">\n\t\t\t\t\t\t<Avatar.Image src={normalizeAvatarUrl(avatarSrc.value)} class=\"object-cover\" />\n\t\t\t\t\t\t<Avatar.Fallback>AV</Avatar.Fallback>\n\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t<!-- Edit button - icon overlay -->\n\t\t\t\t\t<button\n\t\t\t\t\t\tonclick={modalEditAvatar}\n\t\t\t\t\t\tclass=\"absolute bottom-0 right-0 p-2 rounded-full gradient-tertiary dark:gradient-primary btn-icon\"\n\t\t\t\t\t\ttitle={m.userpage_editavatar()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:pencil\" width=\"18\"></iconify-icon>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<!-- User ID -->\n\t\t\t\t<div class=\"gradient-secondary badge mt-1 w-full max-w-xs text-white\">\n\t\t\t\t\t{m.userpage_user_id()}<span class=\"ml-2\">{user?._id || 'N/A'}</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- Role -->\n\t\t\t\t<div class=\"gradient-tertiary badge w-full max-w-xs text-white\">\n\t\t\t\t\t{m.role()}<span class=\"ml-2\">{user?.role || 'N/A'}</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- Two-Factor Authentication Status -->\n\t\t\t\t{#if is2FAEnabledGlobal}\n\t\t\t\t\t<button onclick={open2FAModal} class=\"btn preset-outlined btn-sm w-full max-w-xs\">\n\t\t\t\t\t\t<div class=\"flex w-full items-center justify-between\">\n\t\t\t\t\t\t\t<span>Two-Factor Auth</span>\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\ticon=\"mdi:{user?.is2FAEnabled ? 'shield-check' : 'shield-off'}\"\n\t\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\t\tclass={user?.is2FAEnabled ? 'text-primary-500' : 'text-error-500'}\n\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t<span class=\"text-xs\">{user?.is2FAEnabled ? 'Enabled' : 'Disabled'}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t\t<!-- Tenant ID -->\n\t\t\t\t{#if isMultiTenant}\n\t\t\t\t\t<div class=\"gradient-primary badge w-full max-w-xs text-white\">\n\t\t\t\t\t\tTenant ID:<span class=\"ml-2\">{user?.tenantId || 'N/A'}</span>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t\t<!-- Permissions List -->\n\t\t\t\t{#each user.permissions as permission}\n\t\t\t\t\t<div class=\"gradient-primary badge mt-1 w-full max-w-xs text-white\">\n\t\t\t\t\t\t{permission}\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<!-- User fields -->\n\t\t\t{#if user}\n\t\t\t\t<form>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t{m.username()}:\n\t\t\t\t\t\t<input value={user.username} name=\"username\" type=\"text\" autocomplete=\"username\" disabled class=\"input\" />\n\t\t\t\t\t</label>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t{m.email()}:\n\t\t\t\t\t\t<input value={user.email} name=\"email\" type=\"email\" autocomplete=\"email\" disabled class=\"input\" />\n\t\t\t\t\t</label>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t{m.form_password()}:\n\t\t\t\t\t\t<input bind:value={password} name=\"password\" type=\"password\" autocomplete=\"current-password\" disabled class=\"input\" />\n\t\t\t\t\t</label>\n\n\t\t\t\t\t<div class=\"mt-4 flex flex-col justify-between gap-2 sm:flex-row sm:gap-1\">\n\t\t\t\t\t\t<!-- Edit Modal Button -->\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={modalUserForm}\n\t\t\t\t\t\t\taria-label={m.userpage_edit_usersetting()}\n\t\t\t\t\t\t\tclass=\"gradient-tertiary btn w-full max-w-sm text-white {isFirstUser ? '' : 'mx-auto md:mx-0'}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<iconify-icon icon=\"bi:pencil-fill\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>{m.userpage_edit_usersetting()}\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<!-- Delete Modal Button -->\n\t\t\t\t\t\t{#if isFirstUser}\n\t\t\t\t\t\t\t<button onclick={modalConfirm} aria-label={m.button_delete()} class=\"gradient-error btn w-full max-w-sm text-white\">\n\t\t\t\t\t\t\t\t<iconify-icon icon=\"bi:trash3-fill\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t\t\t\t\t{m.button_delete()}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\n\t<!-- Admin area -->\n\t<PermissionGuard\n\t\tconfig={{\n\t\t\tname: 'Admin Area Access',\n\t\t\tcontextId: 'config/adminArea',\n\t\t\taction: 'manage',\n\t\t\tcontextType: 'system',\n\t\t\tdescription: 'Allows access to admin area for user management'\n\t\t}}\n\t\tsilent={true}\n\t>\n\t\t<div class=\"wrapper2\">\n\t\t\t<AdminArea currentUser={{ ...user }} {isMultiTenant} roles={data.roles} />\n\t\t</div>\n\t</PermissionGuard>\n</div>\n"],"names":["attributes","$$renderer","$.props_id","RootProvider","RootContext","$.escape","m.boolean_yes","m.boolean_no","role","$.attr_class","$.stringify","$.attr","m.adminarea_title","m.multibuttontoken_modaltitle","m.multibuttontoken_modalbody","m.adminarea_adminarea","m.adminarea_emailtoken","m.adminarea_showtoken","m.adminarea_hideuserlist","m.adminarea_userlist","m.entrylist_dnd","m.entrylist_all","$.ensure_array_like","m.entrylist_filter","$.clsx","m.adminarea_nouser","m.userpage_title","m.userpage_editavatar","m.userpage_user_id","m.role","m.username","m.email","m.form_password","m.userpage_edit_usersetting","m.button_delete"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7]}