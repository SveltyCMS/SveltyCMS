{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/theme/get-current-theme/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/theme/get-current-theme/+server.ts\n * @description Server-side handler for fetching the current theme for a tenant.\n */\n\nimport type { RequestHandler } from './$types';\nimport { ThemeManager } from '@shared/database/themeManager';\nimport { json } from '@sveltejs/kit';\n\n// Permission checking\n\n// System Logs\nimport { logger } from '@shared/utils/logger.server';\n\n// Get the singleton ThemeManager instance\nconst themeManager = ThemeManager.getInstance();\n\nexport const GET: RequestHandler = async ({ locals }) => {\n\tconst { user, tenantId } = locals; // User is guaranteed to exist due to hooks protection\n\n\ttry {\n\t\t// Authentication is handled by hooks.server.ts\n\t\tif (!user) {\n\t\t\treturn json({ success: false, error: 'Unauthorized' }, { status: 401 });\n\t\t}\n\n\t\t// Note: tenantId validation is handled by hooks in multi-tenant mode\n\t\tconst currentTheme = await themeManager.getTheme(tenantId);\n\t\tif (currentTheme) {\n\t\t\tlogger.info('Current theme fetched successfully', { theme: currentTheme.name, tenantId });\n\t\t\treturn json(currentTheme, { status: 200 });\n\t\t} else {\n\t\t\tlogger.warn('No active theme found for tenant', { tenantId });\n\t\t\treturn json({ error: 'No active theme found.' }, { status: 404 });\n\t\t}\n\t} catch (err) {\n\t\tconst errorMessage = err instanceof Error ? err.message : String(err);\n\t\tlogger.error('Error fetching current theme:', { error: errorMessage, tenantId });\n\t\treturn json({ success: false, error: `Error fetching current theme: ${errorMessage}` }, { status: 500 });\n\t}\n};\n"],"names":[],"mappings":";;;AAeA,MAAM,eAAe,aAAa,YAAA;AAE3B,MAAM,MAAsB,OAAO,EAAE,aAAa;AACxD,QAAM,EAAE,MAAM,SAAA,IAAa;AAE3B,MAAI;AAEH,QAAI,CAAC,MAAM;AACV,aAAO,KAAK,EAAE,SAAS,OAAO,OAAO,kBAAkB,EAAE,QAAQ,KAAK;AAAA,IACvE;AAGA,UAAM,eAAe,MAAM,aAAa,SAAS,QAAQ;AACzD,QAAI,cAAc;AACjB,aAAO,KAAK,sCAAsC,EAAE,OAAO,aAAa,MAAM,UAAU;AACxF,aAAO,KAAK,cAAc,EAAE,QAAQ,KAAK;AAAA,IAC1C,OAAO;AACN,aAAO,KAAK,oCAAoC,EAAE,SAAA,CAAU;AAC5D,aAAO,KAAK,EAAE,OAAO,yBAAA,GAA4B,EAAE,QAAQ,KAAK;AAAA,IACjE;AAAA,EACD,SAAS,KAAK;AACb,UAAM,eAAe,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG;AACpE,WAAO,MAAM,iCAAiC,EAAE,OAAO,cAAc,UAAU;AAC/E,WAAO,KAAK,EAAE,SAAS,OAAO,OAAO,iCAAiC,YAAY,GAAA,GAAM,EAAE,QAAQ,IAAA,CAAK;AAAA,EACxG;AACD;"}