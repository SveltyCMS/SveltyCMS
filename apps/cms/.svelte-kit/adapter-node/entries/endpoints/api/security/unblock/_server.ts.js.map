{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/security/unblock/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/security/unblock/+server.ts\n * @description IP unblocking endpoint for security management\n */\n\nimport { json, type RequestHandler } from '@sveltejs/kit';\nimport { securityResponseService } from '@shared/services/SecurityResponseService';\nimport { hasApiPermission } from '@shared/database/auth/apiPermissions';\nimport { logger } from '@shared/utils/logger.server';\n\n/**\n * POST /api/security/unblock\n * Manually unblock an IP address from the security blacklist.\n */\nexport const POST: RequestHandler = async ({ locals, request }) => {\n\ttry {\n\t\t// Authorization check - admin only\n\t\tif (!locals.user || !hasApiPermission(locals.user.role, 'security')) {\n\t\t\treturn json({ error: 'Unauthorized - Admin access required' }, { status: 403 });\n\t\t}\n\n\t\tconst body = await request.json();\n\t\tconst { ip } = body;\n\n\t\tif (!ip) {\n\t\t\treturn json({ error: 'IP address is required' }, { status: 400 });\n\t\t}\n\n\t\t// Validate IP format (basic validation)\n\t\tconst ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n\t\tif (!ipRegex.test(ip)) {\n\t\t\treturn json({ error: 'Invalid IP address format' }, { status: 400 });\n\t\t}\n\n\t\t// Attempt to unblock the IP\n\t\tconst success = securityResponseService.unblockIP(ip);\n\n\t\tif (!success) {\n\t\t\treturn json(\n\t\t\t\t{\n\t\t\t\t\terror: 'IP address not found in blocked list or already unblocked'\n\t\t\t\t},\n\t\t\t\t{ status: 404 }\n\t\t\t);\n\t\t}\n\n\t\tlogger.info('IP address manually unblocked', {\n\t\t\tip,\n\t\t\tunblockedBy: locals.user._id,\n\t\t\ttimestamp: Date.now()\n\t\t});\n\n\t\treturn json({\n\t\t\tsuccess: true,\n\t\t\tmessage: `IP address ${ip} has been unblocked successfully`\n\t\t});\n\t} catch (error) {\n\t\tlogger.error('Error unblocking IP address:', error);\n\t\treturn json({ error: 'Internal server error' }, { status: 500 });\n\t}\n};\n"],"names":[],"mappings":";;;;AAcO,MAAM,OAAuB,OAAO,EAAE,QAAQ,cAAc;AAClE,MAAI;AAEH,QAAI,CAAC,OAAO,QAAQ,CAAC,iBAAiB,OAAO,KAAK,MAAM,UAAU,GAAG;AACpE,aAAO,KAAK,EAAE,OAAO,uCAAA,GAA0C,EAAE,QAAQ,KAAK;AAAA,IAC/E;AAEA,UAAM,OAAO,MAAM,QAAQ,KAAA;AAC3B,UAAM,EAAE,OAAO;AAEf,QAAI,CAAC,IAAI;AACR,aAAO,KAAK,EAAE,OAAO,yBAAA,GAA4B,EAAE,QAAQ,KAAK;AAAA,IACjE;AAGA,UAAM,UAAU;AAChB,QAAI,CAAC,QAAQ,KAAK,EAAE,GAAG;AACtB,aAAO,KAAK,EAAE,OAAO,4BAAA,GAA+B,EAAE,QAAQ,KAAK;AAAA,IACpE;AAGA,UAAM,UAAU,wBAAwB,UAAU,EAAE;AAEpD,QAAI,CAAC,SAAS;AACb,aAAO;AAAA,QACN;AAAA,UACC,OAAO;AAAA,QAAA;AAAA,QAER,EAAE,QAAQ,IAAA;AAAA,MAAI;AAAA,IAEhB;AAEA,WAAO,KAAK,iCAAiC;AAAA,MAC5C;AAAA,MACA,aAAa,OAAO,KAAK;AAAA,MACzB,WAAW,KAAK,IAAA;AAAA,IAAI,CACpB;AAED,WAAO,KAAK;AAAA,MACX,SAAS;AAAA,MACT,SAAS,cAAc,EAAE;AAAA,IAAA,CACzB;AAAA,EACF,SAAS,OAAO;AACf,WAAO,MAAM,gCAAgC,KAAK;AAClD,WAAO,KAAK,EAAE,OAAO,wBAAA,GAA2B,EAAE,QAAQ,KAAK;AAAA,EAChE;AACD;"}