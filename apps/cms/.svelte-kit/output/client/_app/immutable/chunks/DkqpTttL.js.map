{"version":3,"file":"DkqpTttL.js","sources":["../../../../../../../../shared/features/src/dashboard/widgets/LogsWidget.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/dashboard/widgets/LogsWidget.svelte\n@component\n**Logs widget component to display system logs with filtering, searching, and pagination.**\n\n### Props\n- Inherits all props from BaseWidget.svelte\n- `data`: Fetched log data from the server.\n\n### Features:\n- Displays paginated log entries.\n- Allows filtering logs by level (fatal, error, warn, info, debug, trace).\n- Provides a search input to filter log messages by text.\n- Includes date range filtering for logs.\n- Integrates with BaseWidget for common widget functionalities.\n-->\n<script lang=\"ts\" module>\n\texport const widgetMeta = {\n\t\tname: 'Logs',\n\t\ticon: 'mdi:text-box-outline',\n\t\tdefaultSize: { w: 2, h: 2 }\n\t};\n</script>\n\n<script lang=\"ts\">\n\timport BaseWidget from '../BaseWidget.svelte';\n\timport type { TablePaginationProps, WidgetSize } from '@cms-types';\n\timport TablePagination from '@cms/components/system/table/TablePagination.svelte';\n\n\tinterface LogEntryDisplay {\n\t\ttimestamp: string;\n\t\tlevel: string;\n\t\tmessage: string;\n\t\tmessageHtml?: string;\n\t\targs: unknown[];\n\t}\n\n\tinterface FetchedData {\n\t\tlogs: LogEntryDisplay[];\n\t\tpage: number;\n\t\ttotal: number;\n\t\ttotalPages?: number;\n\t\thasMore?: boolean;\n\t}\n\n\tconst {\n\t\tlabel = 'System Logs',\n\t\ticon = 'mdi:file-document-outline',\n\t\twidgetId = undefined,\n\t\tsize = { w: 2, h: 2 } as WidgetSize,\n\t\tonSizeChange = (_newSize: WidgetSize) => {},\n\t\tonRemove = () => {},\n\t\tendpoint = '/api/dashboard/logs',\n\t\tpollInterval = 15000\n\t}: {\n\t\tlabel?: string;\n\t\ticon?: string;\n\t\twidgetId?: string;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tonRemove?: () => void;\n\t\tendpoint?: string;\n\t\tpollInterval?: number;\n\t} = $props();\n\n\t// Internal state for logs data\n\tlet currentPage = $state(1);\n\tlet logsPerPage = $state(20); // Default logs per page\n\n\t// Filter states\n\tlet filterLevel = $state('all');\n\tlet searchText = $state('');\n\tlet startDate: string = $state(''); // YYYY-MM-DD\n\tlet endDate: string = $state(''); // YYYY-MM-DD\n\n\t// Debounce search/filter inputs\n\tlet searchTimeout: ReturnType<typeof setTimeout> | null = null;\n\tlet triggerFetchFlag = $state(0); // Dummy state to explicitly trigger fetch via $effect\n\n\t// Function to construct query parameters for the endpoint\n\tconst getQueryParams = () => {\n\t\tconst params = new URLSearchParams();\n\t\tif (filterLevel !== 'all') params.append('level', filterLevel);\n\t\tif (searchText) params.append('search', searchText);\n\t\tif (startDate) params.append('startDate', startDate);\n\t\tif (endDate) params.append('endDate', endDate);\n\t\tparams.append('page', currentPage.toString());\n\t\tparams.append('limit', logsPerPage.toString());\n\t\treturn params.toString();\n\t};\n\n\t// Effect to re-trigger fetch when filters or pagination change\n\t$effect(() => {\n\t\tif (searchTimeout) clearTimeout(searchTimeout);\n\t\tsearchTimeout = setTimeout(() => {\n\t\t\tconst isFilterChange = filterLevel !== 'all' || searchText !== '' || startDate !== '' || endDate !== '';\n\t\t\tif (isFilterChange && currentPage !== 1) {\n\t\t\t\tcurrentPage = 1;\n\t\t\t}\n\t\t\ttriggerFetchFlag++;\n\t\t}, 300); // 300ms debounce\n\t});\n\n\t// Handle pagination changes\n\tconst onUpdatePage = (page: number) => {\n\t\tcurrentPage = page;\n\t\ttriggerFetchFlag++;\n\t};\n\n\tconst onUpdateRowsPerPage = (rows: number) => {\n\t\tlogsPerPage = rows;\n\t\tcurrentPage = 1;\n\t\ttriggerFetchFlag++;\n\t};\n\n\tconst handleFilterLevelChange = (newLevel: typeof filterLevel) => {\n\t\tfilterLevel = newLevel;\n\t\tcurrentPage = 1;\n\t\ttriggerFetchFlag++;\n\t};\n\n\tconst dynamicEndpoint = $derived(`${endpoint}?${getQueryParams()}&_t=${triggerFetchFlag}`);\n\n\tconst logLevelOptions = [\n\t\t{ value: 'all', label: 'All Levels' },\n\t\t{ value: 'fatal', label: 'Fatal' },\n\t\t{ value: 'error', label: 'Error' },\n\t\t{ value: 'warn', label: 'Warn' },\n\t\t{ value: 'info', label: 'Info' },\n\t\t{ value: 'debug', label: 'Debug' },\n\t\t{ value: 'trace', label: 'Trace' }\n\t];\n\n\tconst getLogLevelColor = (level: string) => {\n\t\tswitch (level.toLowerCase()) {\n\t\t\tcase 'fatal':\n\t\t\t\treturn 'text-purple-500 dark:text-purple-400';\n\t\t\tcase 'error':\n\t\t\t\treturn 'text-red-500 dark:text-red-400';\n\t\t\tcase 'warn':\n\t\t\t\treturn 'text-yellow-500 dark:text-yellow-400';\n\t\t\tcase 'info':\n\t\t\t\treturn 'text-green-500 dark:text-green-400';\n\t\t\tcase 'debug':\n\t\t\t\treturn 'text-blue-500 dark:text-blue-400';\n\t\t\tcase 'trace':\n\t\t\t\treturn 'text-cyan-500 dark:text-cyan-400';\n\t\t\tdefault:\n\t\t\t\treturn 'text-gray-700 dark:text-gray-300';\n\t\t}\n\t};\n</script>\n\n<BaseWidget {label} endpoint={dynamicEndpoint} {pollInterval} {icon} {widgetId} {size} {onSizeChange} onCloseRequest={onRemove}>\n\t{#snippet children({ data: fetchedData }: { data: FetchedData | undefined })}\n\t\t<div class=\"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\" role=\"region\" aria-label=\"Log controls\">\n\t\t\t<div class=\"flex flex-1 gap-2\">\n\t\t\t\t<select\n\t\t\t\t\tbind:value={filterLevel}\n\t\t\t\t\tonchange={(e) => handleFilterLevelChange((e.target as HTMLSelectElement).value as typeof filterLevel)}\n\t\t\t\t\tclass=\"rounded border border-surface-300 bg-white px-8 py-1 text-sm text-surface-700 shadow-sm focus:border-primary-400 focus:ring-2 focus:ring-primary-200 dark:border-surface-400 dark:bg-surface-800 dark:text-surface-100 dark:focus:border-primary-500\"\n\t\t\t\t\taria-label=\"Filter log level\"\n\t\t\t\t>\n\t\t\t\t\t{#each logLevelOptions as { value, label }}\n\t\t\t\t\t\t<option {value}>{label}</option>\n\t\t\t\t\t{/each}\n\t\t\t\t</select>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder=\"Search logs...\"\n\t\t\t\t\tbind:value={searchText}\n\t\t\t\t\tclass=\"rounded border border-surface-300 bg-white px-3 py-1 text-sm text-surface-700 shadow-sm focus:border-primary-400 focus:ring-2 focus:ring-primary-200 dark:border-surface-400 dark:bg-surface-800 dark:text-surface-100 dark:focus:border-primary-500\"\n\t\t\t\t\taria-label=\"Search logs\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"date\"\n\t\t\t\t\tbind:value={startDate}\n\t\t\t\t\tclass=\"rounded border border-surface-300 bg-white px-2 py-1 text-sm text-surface-700 shadow-sm focus:border-primary-400 focus:ring-2 focus:ring-primary-200 dark:border-surface-400 dark:bg-surface-800 dark:text-surface-100 dark:focus:border-primary-500\"\n\t\t\t\t\taria-label=\"Start date\"\n\t\t\t\t/>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"date\"\n\t\t\t\t\tbind:value={endDate}\n\t\t\t\t\tclass=\"rounded border border-surface-300 bg-white px-2 py-1 text-sm text-surface-700 shadow-sm focus:border-primary-400 focus:ring-2 focus:ring-primary-200 dark:border-surface-400 dark:bg-surface-800 dark:text-surface-100 dark:focus:border-primary-500\"\n\t\t\t\t\taria-label=\"End date\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t\t{#if fetchedData && fetchedData.logs && fetchedData.logs.length > 0}\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col gap-1 overflow-y-auto\"\n\t\t\t\tstyle=\"max-height: calc({size.h} * 120px - 120px);\"\n\t\t\t\trole=\"list\"\n\t\t\t\taria-label=\"System log entries\"\n\t\t\t>\n\t\t\t\t{#each fetchedData.logs as log}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex items-center gap-1 rounded border border-surface-200 bg-surface-50/50 px-1 py-1 text-xs dark:text-surface-50 dark:bg-surface-800/30\"\n\t\t\t\t\t\trole=\"listitem\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:circle\" width=\"8\" class=\"{getLogLevelColor(log.level)} shrink-0\" aria-label=\"{log.level} log level\"\n\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t<span class=\"w-8 shrink-0 text-xs text-surface-500 dark:text-surface-50\">\n\t\t\t\t\t\t\t{new Date(log.timestamp).toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' })}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"w-14 shrink-0 text-xs font-medium {getLogLevelColor(log.level)}\">\n\t\t\t\t\t\t\t{log.level.toUpperCase()}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"text-text-900 dark:text-text-100 flex-1 select-text truncate text-xs\" style=\"user-select: text;\" title={log.message}>\n\t\t\t\t\t\t\t{log.message}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<div class=\"mt-auto flex items-center justify-between pt-2\">\n\t\t\t\t<TablePagination\n\t\t\t\t\tcurrentPage={(fetchedData.page || 1) as TablePaginationProps['currentPage']}\n\t\t\t\t\trowsPerPage={logsPerPage as TablePaginationProps['rowsPerPage']}\n\t\t\t\t\trowsPerPageOptions={[10, 20, 50, 100] as TablePaginationProps['rowsPerPageOptions']}\n\t\t\t\t\ttotalItems={(fetchedData.total || 0) as TablePaginationProps['totalItems']}\n\t\t\t\t\tpagesCount={(fetchedData.hasMore ? (fetchedData.page || 1) + 1 : fetchedData.page || 1) as TablePaginationProps['pagesCount']}\n\t\t\t\t\tonUpdatePage={onUpdatePage as TablePaginationProps['onUpdatePage']}\n\t\t\t\t\tonUpdateRowsPerPage={onUpdateRowsPerPage as TablePaginationProps['onUpdateRowsPerPage']}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"flex flex-1 flex-col items-center justify-center py-6 text-xs text-gray-500 dark:text-gray-400\" role=\"status\" aria-live=\"polite\">\n\t\t\t\t<iconify-icon icon=\"mdi:file-remove-outline\" width=\"32\" class=\"mb-2 text-surface-400 dark:text-surface-500\" aria-hidden=\"true\"></iconify-icon>\n\t\t\t\t<span>No logs found</span>\n\t\t\t</div>\n\t\t{/if}\n\t{/snippet}\n</BaseWidget>\n"],"names":["widgetMeta","label","icon","widgetId","size","onSizeChange","$.prop","$$props","_newSize","onRemove","endpoint","pollInterval","currentPage","$.state","logsPerPage","filterLevel","searchText","startDate","endDate","searchTimeout","triggerFetchFlag","getQueryParams","params","$.get","$.user_effect","$.set","onUpdatePage","page","onUpdateRowsPerPage","rows","handleFilterLevelChange","newLevel","dynamicEndpoint","$.derived","logLevelOptions","getLogLevelColor","level","BaseWidget","$$anchor","$$arg0","fetchedData","div","$.first_child","fragment_1","div_1","select","$.child","e","$.each","$.index","$$item","$$index","$$array","value","option","root_2","$.reset","input","$.sibling","$.remove_input_defaults","div_2","input_1","input_2","div_3","fragment_2","log","div_4","root_4","iconify_icon","span","span_1","span_2","$0","$2","$.set_text","text_3","$.append","div_5","TablePagination","node_1","div_6","root_5","iconify_icon_1","$$render","consequent","alternate","$$value"],"mappings":"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"}