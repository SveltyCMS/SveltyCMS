{"version":3,"file":"DnGOEg-Z.js","sources":["../../../../../../../../shared/features/src/dashboard/widgets/SystemHealthWidget.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/dashboard/widgets/SystemHealthWidget.svelte\n@component\n**Dashboard widget for monitoring system health and service status**\n\n@example\n<SystemHealthWidget label=\"System Health\" />\n\n### Props\n- `label`: The label for the widget (default: 'System Health')\n\n### Features:\n- Real-time system state monitoring (IDLE, INITIALIZING, READY, DEGRADED, FAILED)\n- Individual service health tracking (database, auth, cache, etc.)\n- Service restart capability for administrators\n- Auto-refresh with configurable interval\n- Theme-aware rendering (light/dark mode support)\n-->\n<script lang=\"ts\" module>\n\texport const widgetMeta = {\n\t\tname: 'System Health',\n\t\ticon: 'mdi:heart-pulse',\n\t\tdescription: 'Monitor system services and overall health',\n\t\tdefaultSize: { w: 2, h: 2 }\n\t};\n</script>\n\n<script lang=\"ts\">\n\timport BaseWidget from '../BaseWidget.svelte';\n\timport { showToast } from '@shared/utils/toast';\n\timport type { WidgetSize } from '@cms-types';\n\n\ttype SystemState = 'IDLE' | 'INITIALIZING' | 'READY' | 'DEGRADED' | 'FAILED';\n\ttype ServiceHealth = 'healthy' | 'unhealthy' | 'initializing';\n\n\tinterface ServiceStatus {\n\t\tstatus: ServiceHealth;\n\t\tmessage: string;\n\t\tlastChecked?: number;\n\t\terror?: string;\n\t}\n\n\tinterface HealthData {\n\t\toverallStatus: SystemState;\n\t\ttimestamp: number;\n\t\tuptime: number;\n\t\tcomponents: Record<string, ServiceStatus>;\n\t}\n\n\tconst {\n\t\tlabel = 'System Health',\n\t\ttheme = 'light' as 'light' | 'dark',\n\t\ticon = 'mdi:heart-pulse',\n\t\twidgetId = undefined,\n\t\tsize = { w: 2, h: 2 } as WidgetSize,\n\t\tonSizeChange = (_newSize: any) => {},\n\t\tonRemove = () => {}\n\t}: {\n\t\tlabel?: string;\n\t\ttheme?: 'light' | 'dark';\n\t\ticon?: string;\n\t\twidgetId?: string;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tonRemove?: () => void;\n\t} = $props();\n\n\tasync function reinitializeSystem() {\n\t\ttry {\n\t\t\tshowToast('Reinitializing system...', 'warning');\n\n\t\t\tconst response = await fetch('/api/system', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ action: 'reinitialize', force: true })\n\t\t\t});\n\n\t\t\tif (response.ok) {\n\t\t\t\tconst result = await response.json();\n\t\t\t\tshowToast(result.message || `System reinitialized: ${result.status}`, 'success');\n\t\t\t} else {\n\t\t\t\tconst error = await response.json();\n\t\t\t\tthrow new Error(error.error || 'Reinitialization failed');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tshowToast(`Failed to reinitialize: ${error instanceof Error ? error.message : 'Unknown error'}`, 'error');\n\t\t}\n\t}\n\tfunction getStateColor(state: SystemState): string {\n\t\tswitch (state) {\n\t\t\tcase 'READY':\n\t\t\t\treturn 'text-success-500';\n\t\t\tcase 'DEGRADED':\n\t\t\t\treturn 'text-warning-500';\n\t\t\tcase 'INITIALIZING':\n\t\t\t\treturn 'text-primary-500';\n\t\t\tcase 'FAILED':\n\t\t\t\treturn 'text-error-500';\n\t\t\tcase 'IDLE':\n\t\t\t\treturn 'text-surface-500';\n\t\t\tdefault:\n\t\t\t\treturn 'text-surface-500';\n\t\t}\n\t}\n\n\tfunction getStateIcon(state: SystemState): string {\n\t\tswitch (state) {\n\t\t\tcase 'READY':\n\t\t\t\treturn 'mdi:check-circle';\n\t\t\tcase 'DEGRADED':\n\t\t\t\treturn 'mdi:alert';\n\t\t\tcase 'INITIALIZING':\n\t\t\t\treturn 'mdi:loading';\n\t\t\tcase 'FAILED':\n\t\t\t\treturn 'mdi:close-circle';\n\t\t\tcase 'IDLE':\n\t\t\t\treturn 'mdi:pause-circle';\n\t\t\tdefault:\n\t\t\t\treturn 'mdi:help-circle';\n\t\t}\n\t}\n\n\tfunction getServiceBadgeClass(status: ServiceHealth): string {\n\t\tswitch (status) {\n\t\t\tcase 'healthy':\n\t\t\t\treturn 'preset-filled-primary-500';\n\t\t\tcase 'unhealthy':\n\t\t\t\treturn 'preset-filled-error-500';\n\t\t\tcase 'initializing':\n\t\t\t\treturn 'variant-filled-warning';\n\t\t\tdefault:\n\t\t\t\treturn 'preset-filled-surface-500';\n\t\t}\n\t}\n\n\tfunction formatUptime(ms: number): string {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst minutes = Math.floor(seconds / 60);\n\t\tconst hours = Math.floor(minutes / 60);\n\t\tconst days = Math.floor(hours / 24);\n\n\t\tif (days > 0) return `${days}d ${hours % 24}h`;\n\t\tif (hours > 0) return `${hours}h ${minutes % 60}m`;\n\t\tif (minutes > 0) return `${minutes}m`;\n\t\treturn `${seconds}s`;\n\t}\n\n\tfunction formatServiceName(name: string): string {\n\t\treturn name.charAt(0).toUpperCase() + name.slice(1).replace(/([A-Z])/g, ' $1');\n\t}\n</script>\n\n<BaseWidget {label} {theme} endpoint=\"/api/dashboard/health\" pollInterval={5000} {icon} {widgetId} {size} {onSizeChange} onCloseRequest={onRemove}>\n\t{#snippet children({ data }: { data: HealthData | undefined })}\n\t\t{#if data}\n\t\t\t<div class=\"flex h-full flex-col gap-3\">\n\t\t\t\t<!-- Overall Status -->\n\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t<iconify-icon icon={getStateIcon(data.overallStatus)} class={`text-2xl ${getStateColor(data.overallStatus)}`} width=\"24\"></iconify-icon>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span class={`font-bold ${getStateColor(data.overallStatus)}`}>\n\t\t\t\t\t\t\t\t{data.overallStatus}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<p class=\"text-xs opacity-70\">Uptime: {formatUptime(data.uptime)}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<button class=\"preset-outlined-warning-500 btn-sm\" onclick={reinitializeSystem} title=\"Reinitialize system\">\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:refresh\" width=\"16\"></iconify-icon>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Services Grid -->\n\t\t\t\t<div class=\"grid flex-1 grid-cols-2 gap-2 overflow-y-auto\" style=\"max-height: calc({size.h} * 120px - 80px);\">\n\t\t\t\t\t{#each Object.entries(data.components) as [name, service]}\n\t\t\t\t\t\t<div class=\"card preset-outlined-surface-500flex flex-col gap-1 p-2\">\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t<span class=\"text-xs font-semibold\">{formatServiceName(name)}</span>\n\t\t\t\t\t\t\t\t<span class={`badge ${getServiceBadgeClass(service.status)}`}>\n\t\t\t\t\t\t\t\t\t{service.status}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<p class=\"truncate text-xs opacity-70\" title={service.message}>\n\t\t\t\t\t\t\t\t{service.message}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{#if service.error}\n\t\t\t\t\t\t\t\t<p class=\"truncate text-xs text-error-500\" title={service.error}>\n\t\t\t\t\t\t\t\t\t{service.error}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"flex flex-1 flex-col items-center justify-center py-6 text-xs text-gray-500 dark:text-gray-400\">\n\t\t\t\t<iconify-icon icon=\"mdi:alert-circle-outline\" width=\"32\" class=\"mb-2 text-surface-400\"></iconify-icon>\n\t\t\t\t<span>Health data unavailable</span>\n\t\t\t</div>\n\t\t{/if}\n\t{/snippet}\n</BaseWidget>\n"],"names":["widgetMeta","label","theme","icon","widgetId","size","onSizeChange","$.prop","$$props","_newSize","onRemove","reinitializeSystem","showToast","response","result","error","getStateColor","state","getStateIcon","getServiceBadgeClass","status","formatUptime","ms","seconds","minutes","hours","days","formatServiceName","name","BaseWidget","$$anchor","$$arg0","data","div","root_2","div_1","div_2","iconify_icon","$.template_effect","$.set_custom_element_data","div_3","span","p","button","iconify_icon_1","div_4","$.each","$.index","$$item","$.get","$$array","service","div_5","root_3","div_6","span_1","span_2","p_1","p_2","root_4","$.set_text","text_5","$$render","consequent","$1","text_3","text_4","$0","text","div_7","root_5","iconify_icon_2","consequent_1","alternate"],"mappings":"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"}