{"version":3,"file":"Jwj1YebI.js","sources":["../../../../../../../../shared/features/src/image-editor/widgets/Crop/cropMath.ts"],"sourcesContent":["/**\n * @file src/routes/(app)/imageEditor/widgets/Crop/cropMath.ts\n * @description Crop math for Konva\n *\n * Features:\n * - Convert a client rect in stage space into image-local pixel rect\n */\nimport Konva from 'konva';\n\n/** Convert a client rect in stage space into image-local pixel rect */\nexport function stageRectToImageRect(rect: { x: number; y: number; width: number; height: number }, imageNode: Konva.Image, imageGroup: Konva.Group) {\n\tconst containerAbs = imageGroup.getAbsoluteTransform();\n\tconst inv = containerAbs.copy().invert();\n\tconst topLeft = inv.point({ x: rect.x, y: rect.y });\n\tconst bottomRight = inv.point({ x: rect.x + rect.width, y: rect.y + rect.height });\n\tconst imgW = imageNode.width();\n\tconst imgH = imageNode.height();\n\tconst offsetX = imgW / 2;\n\tconst offsetY = imgH / 2;\n\tconst relX = Math.max(0, Math.min(imgW, Math.round(topLeft.x + offsetX)));\n\tconst relY = Math.max(0, Math.min(imgH, Math.round(topLeft.y + offsetY)));\n\tconst relW = Math.max(1, Math.min(imgW - relX, Math.round(bottomRight.x - topLeft.x)));\n\tconst relH = Math.max(1, Math.min(imgH - relY, Math.round(bottomRight.y - topLeft.y)));\n\treturn { x: relX, y: relY, width: relW, height: relH };\n}\n"],"names":["stageRectToImageRect","rect","imageNode","imageGroup","inv","topLeft","bottomRight","imgW","imgH","offsetX","offsetY","relX","relY","relW","relH"],"mappings":"sBAUO,SAASA,EAAqBC,EAA+DC,EAAwBC,EAAyB,CAEpJ,MAAMC,EADeD,EAAW,qBAAA,EACP,KAAA,EAAO,OAAA,EAC1BE,EAAUD,EAAI,MAAM,CAAE,EAAGH,EAAK,EAAG,EAAGA,EAAK,EAAG,EAC5CK,EAAcF,EAAI,MAAM,CAAE,EAAGH,EAAK,EAAIA,EAAK,MAAO,EAAGA,EAAK,EAAIA,EAAK,OAAQ,EAC3EM,EAAOL,EAAU,MAAA,EACjBM,EAAON,EAAU,OAAA,EACjBO,EAAUF,EAAO,EACjBG,EAAUF,EAAO,EACjBG,EAAO,KAAK,IAAI,EAAG,KAAK,IAAIJ,EAAM,KAAK,MAAMF,EAAQ,EAAII,CAAO,CAAC,CAAC,EAClEG,EAAO,KAAK,IAAI,EAAG,KAAK,IAAIJ,EAAM,KAAK,MAAMH,EAAQ,EAAIK,CAAO,CAAC,CAAC,EAClEG,EAAO,KAAK,IAAI,EAAG,KAAK,IAAIN,EAAOI,EAAM,KAAK,MAAML,EAAY,EAAID,EAAQ,CAAC,CAAC,CAAC,EAC/ES,EAAO,KAAK,IAAI,EAAG,KAAK,IAAIN,EAAOI,EAAM,KAAK,MAAMN,EAAY,EAAID,EAAQ,CAAC,CAAC,CAAC,EACrF,MAAO,CAAE,EAAGM,EAAM,EAAGC,EAAM,MAAOC,EAAM,OAAQC,CAAA,CACjD"}