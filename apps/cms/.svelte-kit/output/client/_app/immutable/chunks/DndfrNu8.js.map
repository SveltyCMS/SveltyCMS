{"version":3,"file":"DndfrNu8.js","sources":["../../../../../../src/widgets/custom/Currency/Input.svelte"],"sourcesContent":["<!--\n@file src/widgets/custom/Currency/Input.svelte\n@component\n**Currency Widget Input Component**\n\nProvides localized currency input with real-time formatting and parsing capabilities.\nPart of the Three Pillars Architecture for WSidget system.\n\n@example\n<CurrencyInput bind:value={amount} field={{ currencyCode: \"EUR\", required: true }} />\nUser types \"1234.56\" → displays \"1.234,56 €\" → stores 1234.56 as number \n\n### Props\n- `field: FieldType` - Widget field definition with currency code and validation\n- `value: number | null | undefined` - Numeric currency value (bindable)\n- `error?: string | null` - Validation error message for display\n\n### Features\n- **Bi-directional Formatting**: Converts between localized display and numeric storage\n- **Real-time Parsing**: Parses localized input (e.g., \"1.234,56\") to clean numbers\n- **Auto-formatting on Blur**: Reformats input to canonical currency display\n- **Locale-aware Parsing**: Handles different decimal/thousand separators by region\n- **Mobile Optimized**: Uses `inputmode=\"decimal\"` for numeric keyboards\n- **Multi-Currency Support**: Configurable currency codes with proper symbols\n- **Error State Handling**: Visual error indication with accessible messaging\n- **Placeholder Intelligence**: Shows formatted zero as input placeholder\n- **Data Integrity**: Stores clean numeric values regardless of display format\n-->\n\n<script lang=\"ts\">\n\timport { app } from '@shared/stores/store.svelte';\n\timport type { FieldType } from './';\n\timport { tokenTarget } from '@shared/services/token/tokenTarget';\n\n\tlet { field, value, error }: { field: FieldType; value: number | null | undefined; error?: string | null } = $props();\n\n\t// Get the user's current UI language.\n\tconst lang = $derived(app.systemLanguage);\n\n\t// Create a memoized number formatter for the specified currency.\n\tconst formatter = $derived(\n\t\tnew Intl.NumberFormat(lang as string, {\n\t\t\tstyle: 'currency',\n\t\t\tcurrency: (field.currencyCode as string) || 'EUR'\n\t\t})\n\t);\n\n\t// Local state for the displayed, formatted string.\n\tlet formattedValue = $state('');\n\n\t// Effect 1: When the parent `value` (number) changes, update the local formatted string.\n\t$effect(() => {\n\t\t// Only update if the number is valid and different from what the input already represents.\n\t\tconst currentNumericValue = parseLocalizedNumber(formattedValue, lang);\n\t\tif (typeof value === 'number' && value !== currentNumericValue) {\n\t\t\tformattedValue = formatter.format(value);\n\t\t} else if (value === null || value === undefined) {\n\t\t\tformattedValue = '';\n\t\t}\n\t});\n\n\t// This function is called when the user types in the input.\n\tfunction handleInput(event: Event & { currentTarget: HTMLInputElement }) {\n\t\tconst inputString = event.currentTarget.value;\n\t\t// Parse the localized string back into a number.\n\t\tconst numericValue = parseLocalizedNumber(inputString, lang);\n\t\t// Update the parent's `value` with the clean number.\n\t\tvalue = isNaN(numericValue) ? null : numericValue;\n\t}\n\n\t// This function is called when the user leaves the input field.\n\tfunction handleBlur() {\n\t\t// Re-format the input to a clean, canonical currency format.\n\t\tif (typeof value === 'number') {\n\t\t\tformattedValue = formatter.format(value);\n\t\t}\n\t}\n\n\t// A helper function to parse a localized number string (e.g., \"1.234,56\") into a JS number.\n\tfunction parseLocalizedNumber(str: string, locale: string): number {\n\t\tconst parts = new Intl.NumberFormat(locale).formatToParts(1234.5);\n\t\tconst group = parts.find((p) => p.type === 'group')?.value || ',';\n\t\tconst decimal = parts.find((p) => p.type === 'decimal')?.value || '.';\n\t\tconst cleaned = str.replace(new RegExp(`\\\\${group}`, 'g'), '').replace(decimal, '.');\n\t\treturn parseFloat(cleaned.replace(/[^\\d.-]/g, ''));\n\t}\n</script>\n\n<div class=\"input-container relative mb-4\">\n\t<div class=\"preset-filled-surface-500 btn-group flex w-full rounded\" role=\"group\">\n\t\t{#if field?.prefix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.prefix} prefix`}>\n\t\t\t\t{field?.prefix}\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"relative w-full flex-1\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tbind:value={formattedValue}\n\t\t\t\toninput={handleInput}\n\t\t\t\tonblur={handleBlur}\n\t\t\t\tuse:tokenTarget={{\n\t\t\t\t\tname: field.db_fieldName,\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tcollection: (field as any).collection\n\t\t\t\t}}\n\t\t\t\tname={field?.db_fieldName}\n\t\t\t\tid={field?.db_fieldName}\n\t\t\t\tplaceholder={typeof field?.placeholder === 'string' && field.placeholder !== '' ? field.placeholder : String(field?.db_fieldName ?? '')}\n\t\t\t\trequired={field?.required as boolean | undefined}\n\t\t\t\treadonly={field?.readonly as boolean | undefined}\n\t\t\t\tdisabled={field?.disabled as boolean | undefined}\n\t\t\t\tclass=\"input w-full rounded-none text-black dark:text-primary-500\"\n\t\t\t\tclass:!border-error-500={!!error}\n\t\t\t\tclass:!ring-1={!!error}\n\t\t\t\tclass:!ring-error-500={!!error}\n\t\t\t\taria-invalid={!!error}\n\t\t\t\taria-describedby={error ? `${field.db_fieldName}-error` : undefined}\n\t\t\t\taria-required={field?.required}\n\t\t\t\tdata-testid=\"currency-input\"\n\t\t\t/>\n\t\t</div>\n\n\t\t{#if field?.suffix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.suffix} suffix`}>\n\t\t\t\t{field?.suffix}\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n\n\t<!-- Validation indicator -->\n\t{#if error}\n\t\t<p id={`${field.db_fieldName}-error`} class=\"absolute bottom-0 left-0 w-full text-center text-xs text-error-500\" role=\"alert\" aria-live=\"polite\">\n\t\t\t{error}\n\t\t</p>\n\t{/if}\n</div>\n"],"names":["value","$.prop","$$props","lang","$.derived","app","formatter","formattedValue","$.state","$.user_effect","currentNumericValue","parseLocalizedNumber","$.get","$.set","handleInput","event","inputString","numericValue","handleBlur","str","locale","parts","group","p","decimal","cleaned","div","root","div_1","button","root_1","$.set_attribute","$$render","consequent","div_2","$.sibling","node","input","$.child","$.remove_input_defaults","$$value","$.action","$$node","$$action_arg","tokenTarget","button_1","root_2","consequent_1","p_1","root_3","$0","classes","$.set_class","$.event"],"mappings":"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"}