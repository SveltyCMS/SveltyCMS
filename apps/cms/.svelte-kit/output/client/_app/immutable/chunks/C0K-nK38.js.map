{"version":3,"file":"C0K-nK38.js","sources":["../../../../../../src/widgets/custom/Number/Input.svelte"],"sourcesContent":["<!--\n@file src/widgets/custom/Number/Input.svelte\n@component\n**Number Widget Component**\n\n@example\n<Number field={{ label: \"Price\", db_fieldName: \"price\", required: true, min: 0, required={field?.required as boolean | undefined}\n\t\t\t\treadonly={field?.readonly as boolean | undefined}\n\t\t\t\tdisabled={field?.disabled as boolean | undefined}\n\t\t\t\tmin={field?.min as number | undefined}\n\t\t\t\tmax={field?.max as number | undefined}\n\t\t\t\tstep={(field?.step as number) || 1}\n\t\t\t\tclass=\"input w-full flex-1 rounded-none text-black dark:text-primary-500\"00 }} />\n\n### Props\n- `field`: FieldType\n- `value`: any\n\n### Features\n- **Number Validation**: Stores as actual number type (not string)\n- **Non-Translatable**: Numbers are universal values\n- **Semantic HTML**: Uses type=\"number\" for proper mobile keyboards\n- **Min/Max Validation**: Numeric range constraints\n- **Step Controls**: Configurable increment/decrement\n- **Locale Support**: Respects user's number formatting preferences\n- **Enhanced Validation**: Integration with validation store\n- **Touch State Management**: Proper error display based on interaction\n- **Debounced Validation**: Performance-optimized validation\n- **Prefix/Suffix Support**: For units (e.g., \"$\", \"kg\", \"px\")\n- **Accessibility**: Full ARIA support and semantic HTML\n-->\n\n<script lang=\"ts\">\n\timport { onDestroy } from 'svelte';\n\timport type { FieldType } from '.';\n\timport { publicEnv } from '@shared/stores/globalSettings.svelte';\n\n\t// Stores\n\timport { app, validationStore } from '@shared/stores/store.svelte';\n\n\timport { getFieldName } from '@shared/utils/utils';\n\timport { tokenTarget } from '@shared/services/token/tokenTarget';\n\n\t// Valibot validation\n\timport { number as numberSchema, pipe, parse, minValue, maxValue, optional, type ValiError } from 'valibot';\n\n\tinterface Props {\n\t\tfield: FieldType;\n\t\tvalue?: any;\n\t}\n\n\tlet { field, value = $bindable() }: Props = $props();\n\n\tconst fieldName = $derived(getFieldName(field));\n\t// Use current content language for translated fields, default for non-translated\n\tconst _language = $derived(field.translated ? app.contentLanguage : ((publicEnv.DEFAULT_CONTENT_LANGUAGE as string) || 'en').toLowerCase());\n\tconst language = $derived(app.contentLanguage);\n\n\t// Initialize value\n\t$effect(() => {\n\t\tif (!value) {\n\t\t\tvalue = { [_language]: null };\n\t\t}\n\t});\n\n\tconst safeValue = $derived(value?.[_language]);\n\tconst validationError = $derived(validationStore.getError(fieldName));\n\tlet debounceTimeout: number | undefined;\n\tlet isTouched = $state(false);\n\tlet isValidating = $state(false);\n\n\t// Define number validation schema with range validations\n\tconst validationSchemaFunc = $derived.by(() => {\n\t\tconst rules: Array<any> = [];\n\n\t\tif (typeof field.min === 'number') {\n\t\t\trules.push(minValue(field.min, `Value must be at least ${field.min}`));\n\t\t}\n\t\tif (typeof field.max === 'number') {\n\t\t\trules.push(maxValue(field.max, `Value must not exceed ${field.max}`));\n\t\t}\n\n\t\tconst schema = rules.length > 0 ? pipe(numberSchema('Value must be a number'), ...(rules as [])) : numberSchema('Value must be a number');\n\n\t\treturn field.required ? schema : optional(schema);\n\t});\n\n\t// Get decimal separator for the current locale\n\tfunction getDecimalSeparator(locale: string) {\n\t\tconst numberWithDecimalSeparator = new Intl.NumberFormat(locale).format(1.1);\n\t\treturn numberWithDecimalSeparator.substring(1, 2);\n\t}\n\n\t// Handle input with locale-aware parsing\n\tfunction handleInput(event: Event) {\n\t\tconst target = event.target as HTMLInputElement;\n\t\tconst inputValue = target.value;\n\n\t\tif (!inputValue || inputValue === '') {\n\t\t\tif (!value) value = {};\n\t\t\tvalue = { ...value, [_language]: null };\n\t\t\tvalidateInput(false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst decimalSeparator = getDecimalSeparator(language);\n\n\t\t// Allow partial input (ending with decimal separator)\n\t\tif (inputValue[inputValue.length - 1] === decimalSeparator) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Parse the number\n\t\tconst cleanedValue = inputValue.replace(new RegExp(`[^0-9${decimalSeparator}-]`, 'g'), '').replace(decimalSeparator, '.');\n\t\tconst number = parseFloat(cleanedValue);\n\n\t\tif (!isNaN(number)) {\n\t\t\tif (!value) value = {};\n\t\t\tvalue = { ...value, [_language]: number };\n\t\t\t// Format the display value\n\t\t\ttarget.value = new Intl.NumberFormat(language, {\n\t\t\t\tmaximumFractionDigits: typeof field.step === 'number' && field.step < 1 ? 2 : 0\n\t\t\t}).format(number);\n\t\t}\n\n\t\tvalidateInput(false);\n\t}\n\n\t// Handle blur - finalize the value\n\tfunction handleBlur() {\n\t\tisTouched = true;\n\t\tvalidateInput(true);\n\t}\n\n\t// Validation function\n\tfunction validateInput(immediate = false) {\n\t\tif (debounceTimeout) clearTimeout(debounceTimeout);\n\n\t\tconst doValidation = () => {\n\t\t\ttry {\n\t\t\t\tisValidating = true;\n\t\t\t\tconst currentValue = safeValue;\n\n\t\t\t\t// Required validation\n\t\t\t\tif (field?.required && (currentValue === null || currentValue === undefined)) {\n\t\t\t\t\tvalidationStore.setError(fieldName, 'This field is required');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If no value and not required, clear errors\n\t\t\t\tif (!field?.required && (currentValue === null || currentValue === undefined)) {\n\t\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Valibot validation\n\t\t\t\tparse(validationSchemaFunc, currentValue);\n\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t} catch (error) {\n\t\t\t\tif ((error as ValiError<any>).issues) {\n\t\t\t\t\tconst valiError = error as ValiError<any>;\n\t\t\t\t\tconst errorMessage = valiError.issues[0]?.message || 'Invalid input';\n\t\t\t\t\tvalidationStore.setError(fieldName, errorMessage);\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tisValidating = false;\n\t\t\t}\n\t\t};\n\n\t\tif (immediate) {\n\t\t\tdoValidation();\n\t\t} else {\n\t\t\tdebounceTimeout = window.setTimeout(doValidation, 300);\n\t\t}\n\t}\n\n\t// Cleanup\n\tonDestroy(() => {\n\t\tif (debounceTimeout) clearTimeout(debounceTimeout);\n\t});\n\n\t// Export WidgetData for data binding with Fields.svelte\n\texport const WidgetData = async () => value;\n</script>\n\n<div class=\"input-container relative mb-4\">\n\t<div class=\"preset-filled-surface-500 btn-group flex w-full rounded\" role=\"group\">\n\t\t{#if field?.prefix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.prefix} prefix`}>\n\t\t\t\t{field?.prefix}\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"relative w-full flex-1\">\n\t\t\t<input\n\t\t\t\ttype=\"number\"\n\t\t\t\tvalue={safeValue !== null && safeValue !== undefined ? safeValue : ''}\n\t\t\t\toninput={handleInput}\n\t\t\t\tonblur={handleBlur}\n\t\t\t\tuse:tokenTarget={{\n\t\t\t\t\tname: field.db_fieldName,\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tcollection: (field as any).collection\n\t\t\t\t}}\n\t\t\t\tname={field?.db_fieldName}\n\t\t\t\tid={field?.db_fieldName}\n\t\t\t\tplaceholder={typeof field?.placeholder === 'string' && field.placeholder !== '' ? field.placeholder : String(field?.db_fieldName ?? '')}\n\t\t\t\trequired={field?.required as boolean | undefined}\n\t\t\t\treadonly={field?.readonly as boolean | undefined}\n\t\t\t\tdisabled={field?.disabled as boolean | undefined}\n\t\t\t\tmin={field?.min as number | undefined}\n\t\t\t\tmax={field?.max as number | undefined}\n\t\t\t\tstep={(field?.step as number) || 1}\n\t\t\t\tclass=\"input w-full rounded-none text-black dark:text-primary-500\"\n\t\t\t\tclass:!border-error-500={!!validationError}\n\t\t\t\tclass:!ring-1={!!validationError || isValidating}\n\t\t\t\tclass:!ring-error-500={!!validationError}\n\t\t\t\tclass:!border-primary-500={isValidating && !validationError}\n\t\t\t\tclass:!ring-primary-500={isValidating && !validationError}\n\t\t\t\taria-invalid={!!validationError}\n\t\t\t\taria-describedby={validationError ? `${fieldName}-error` : undefined}\n\t\t\t\taria-required={field?.required}\n\t\t\t\tdata-testid=\"number-input\"\n\t\t\t/>\n\t\t</div>\n\n\t\t{#if field?.suffix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.suffix} suffix`}>\n\t\t\t\t{field?.suffix}\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<!-- Validation indicator -->\n\t\t{#if isValidating}\n\t\t\t<div class=\"flex items-center px-2\" aria-label=\"Validating\">\n\t\t\t\t<div class=\"h-4 w-4 animate-spin rounded-full border-2 border-primary-500 border-t-transparent\"></div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\n\t<!-- Error Message -->\n\t{#if validationError && isTouched}\n\t\t<p id={`${fieldName}-error`} class=\"absolute -bottom-4 left-0 w-full text-center text-xs text-error-500\" role=\"alert\" aria-live=\"polite\">\n\t\t\t{validationError}\n\t\t</p>\n\t{/if}\n</div>\n"],"names":["value","$.prop","$$props","fieldName","getFieldName","_language","app","publicEnv","language","$.derived","$.user_effect","$.get","safeValue","validationError","validationStore","debounceTimeout","isTouched","$.state","isValidating","validationSchemaFunc","rules","minValue","maxValue","schema","pipe","numberSchema","optional","getDecimalSeparator","locale","handleInput","event","target","inputValue","validateInput","decimalSeparator","cleanedValue","number","handleBlur","$.set","immediate","doValidation","currentValue","parse","error","errorMessage","onDestroy","div","root","div_1","button","root_1","$.set_attribute","$$render","consequent","div_2","$.sibling","node","input","$.child","$.remove_input_defaults","$.action","$$node","$$action_arg","tokenTarget","button_1","root_2","consequent_1","div_3","root_3","consequent_2","p","root_4","consequent_3","$0","classes","$.set_class","$.event"],"mappings":"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"}