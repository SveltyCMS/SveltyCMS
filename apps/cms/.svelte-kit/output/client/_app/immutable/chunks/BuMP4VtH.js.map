{"version":3,"file":"BuMP4VtH.js","sources":["../../../../../../src/widgets/core/RichText/components/DropDown.svelte"],"sourcesContent":["<!--\n@file: /src/components/Dropdown.svelte\n@component\n**An improved dropdown component that displays the currently selected item and properly handles icons**\n\n### Props\n- `items`: Array of selectable items\n- `label`: Optional label for the dropdown\n- `icon`: Optional icon for the dropdown button\n- `class`: Custom class for the dropdown container\n- `show`: Whether to show the dropdown\n- `active`: Currently active dropdown ID\n\n### Features\n- Click to edit\n- Enter to save\n- Escape to cancel\n-->\n\n<script lang=\"ts\">\n\timport { onMount, tick } from 'svelte';\n\timport { twMerge } from 'tailwind-merge';\n\n\t// Define props using Svelte 5 runes\n\tlet {\n\t\titems = [], // Array of selectable items\n\t\tlabel = '', // Optional label for the dropdown\n\t\ticon = undefined, // Optional icon for the dropdown button\n\t\tclass: className = '', // Custom class for the dropdown container\n\t\tshow = true, // Whether to show the dropdown\n\t\tactive = $bindable('') // Currently active dropdown ID\n\t} = $props();\n\n\tlet expanded = $state(false);\n\tlet dropdownRef: HTMLDivElement | undefined = $state();\n\tlet buttonRef: HTMLButtonElement | undefined = $state();\n\tconst dropdownId = $state(`dropdown-${Math.random().toString(36).substring(2, 9)}`);\n\tconst listboxId = $derived(`${dropdownId}-menu`);\n\tlet focusedIndex = $state(-1); // roving focus index when expanded\n\tconst itemRefs: Array<HTMLButtonElement | null> = [];\n\tlet _refresh = $state(0); // force re-render when selection changes\n\n\t// Action to capture each item's button element reference\n\tfunction captureItem(node: HTMLButtonElement, index: number) {\n\t\titemRefs[index] = node;\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\t// Clean up reference on removal\n\t\t\t\tif (itemRefs[index] === node) itemRefs[index] = null;\n\t\t\t}\n\t\t};\n\t}\n\n\t// Get active item based on items with active: true\n\tfunction getActiveItem() {\n\t\treturn items.find((item) => item.active && item.active());\n\t}\n\n\t// Toggle dropdown expansion\n\tfunction open(expandToIndex: number | null = null) {\n\t\tif (expanded) return;\n\t\t// close other dropdowns\n\t\tif (active !== dropdownId && active !== '') active = '';\n\t\texpanded = true;\n\t\tactive = dropdownId;\n\t\t// set initial focus index\n\t\tconst activeItem = getActiveItem();\n\t\tlet idx = expandToIndex ?? (activeItem ? items.findIndex((i) => i === activeItem) : 0);\n\t\tif (idx < 0) idx = 0;\n\t\tfocusedIndex = idx;\n\t\ttick().then(() => itemRefs[focusedIndex]?.focus());\n\t}\n\n\tfunction close(focusButton = true) {\n\t\tif (!expanded) return;\n\t\texpanded = false;\n\t\tactive = '';\n\t\tfocusedIndex = -1;\n\t\tif (focusButton) buttonRef?.focus();\n\t}\n\n\tfunction toggleExpanded(e: Event) {\n\t\te.stopPropagation();\n\t\texpanded ? close(true) : open();\n\t}\n\n\t// Handle item selection\n\tfunction selectItem(item: any, e: Event) {\n\t\te.stopPropagation();\n\t\tif (item.onClick) item.onClick();\n\t\t_refresh++; // trigger recompute of button label/icon\n\t\tclose(true);\n\t}\n\n\t// Effect to handle closing when active changes\n\t$effect(() => {\n\t\tif (active !== dropdownId) {\n\t\t\texpanded = false;\n\t\t}\n\t});\n\n\t// Add global click event listener to close dropdown when clicking outside\n\tonMount(() => {\n\t\tconst handleClickOutside = (event: MouseEvent) => {\n\t\t\tif (dropdownRef && !dropdownRef.contains(event.target as Node) && expanded) {\n\t\t\t\tclose(false);\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener('click', handleClickOutside);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('click', handleClickOutside);\n\t\t};\n\t});\n\n\t// Button label/icon reflect active item or fallback to provided label/icon\n\tfunction getButtonText() {\n\t\tconst ai = getActiveItem();\n\t\treturn (ai && (ai.name || ai.title)) || label;\n\t}\n\n\tfunction getButtonIcon() {\n\t\tconst ai = getActiveItem();\n\t\t// If we have an active item with icon use it, else fallback to provided icon\n\t\treturn ai?.icon || icon;\n\t}\n</script>\n\n<div class={twMerge('relative', className)} class:hidden={!show} bind:this={dropdownRef}>\n\t<button\n\t\tbind:this={buttonRef}\n\t\tonclick={toggleExpanded}\n\t\tonkeydown={(e) => {\n\t\t\tif (e.key === 'ArrowDown') {\n\t\t\t\topen(0);\n\t\t\t\te.preventDefault();\n\t\t\t} else if (e.key === 'ArrowUp') {\n\t\t\t\topen(items.length - 1);\n\t\t\t\te.preventDefault();\n\t\t\t} else if (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\topen();\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t}}\n\t\tclass=\"preset-filled-tertiary-500 btn flex w-fit items-center gap-1 rounded dark:preset-outlined-primary-500\"\n\t\taria-haspopup=\"true\"\n\t\taria-expanded={expanded}\n\t\taria-controls={listboxId}\n\t\tid={`${dropdownId}-button`}\n\t\taria-label={label || undefined}\n\t>\n\t\t{#if getButtonIcon()}\n\t\t\t<iconify-icon\n\t\t\t\ticon={getButtonIcon()}\n\t\t\t\twidth=\"18\"\n\t\t\t\tclass={getActiveItem() ? 'text-tertiary-50 dark:text-tertiary-300' : 'text-surface-800 dark:text-surface-200'}\n\t\t\t></iconify-icon>\n\t\t{/if}\n\t\t<span class=\"hidden text-sm sm:inline\" class:text-tertiary-50={!!getActiveItem()} class:text-surface-800={!getActiveItem()}\n\t\t\t>{getButtonText()}</span\n\t\t>\n\t</button>\n\n\t{#if expanded}\n\t\t<div\n\t\t\tid={listboxId}\n\t\t\tclass=\"absolute z-20 mt-1 w-fit min-w-full overflow-auto rounded-md border border-surface-400/30 bg-surface-50/95 shadow-lg backdrop-blur-sm focus:outline-none dark:border-surface-300/20 dark:bg-surface-800/90\"\n\t\t\trole=\"menu\"\n\t\t\ttabindex=\"-1\"\n\t\t\taria-labelledby={`${dropdownId}-button`}\n\t\t\tonkeydown={(e) => {\n\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\tclose(true);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst max = items.length - 1;\n\t\t\t\tif (e.key === 'ArrowDown') {\n\t\t\t\t\tfocusedIndex = focusedIndex < max ? focusedIndex + 1 : 0;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.key === 'ArrowUp') {\n\t\t\t\t\tfocusedIndex = focusedIndex > 0 ? focusedIndex - 1 : max;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.key === 'Home') {\n\t\t\t\t\tfocusedIndex = 0;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.key === 'End') {\n\t\t\t\t\tfocusedIndex = max;\n\t\t\t\t\titemRefs[focusedIndex]?.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t{#each items as item, i}\n\t\t\t\t<button\n\t\t\t\t\tuse:captureItem={i}\n\t\t\t\t\tonclick={(e) => selectItem(item, e)}\n\t\t\t\t\tonkeydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\t\t\tselectItem(item, e);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tclass=\"flex w-full items-center gap-2 px-3 py-2 text-left text-surface-700 hover:bg-surface-200/70 focus:bg-tertiary-500/20 focus:outline-none dark:text-white dark:hover:bg-surface-600/60 dark:focus:bg-tertiary-400/25\"\n\t\t\t\t\tclass:active={item.active && item.active()}\n\t\t\t\t\trole=\"menuitem\"\n\t\t\t\t\ttabindex={i === focusedIndex ? 0 : -1}\n\t\t\t\t\taria-current={item.active && item.active() ? 'true' : undefined}\n\t\t\t\t>\n\t\t\t\t\t{#if item.active && item.active()}\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:check\" width=\"16\" class=\"text-tertiary-600 dark:text-tertiary-400\"></iconify-icon>\n\t\t\t\t\t{:else if item.icon}\n\t\t\t\t\t\t<iconify-icon icon={item.icon} width=\"18\"></iconify-icon>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<span class=\"whitespace-nowrap text-sm\">{item.name || item.title || ''}</span>\n\t\t\t\t</button>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\tbutton.active {\n\t\tcolor: rgb(0, 255, 123);\n\t}\n</style>\n"],"names":["items","$.prop","$$props","label","icon","className","show","active","expanded","$.state","dropdownRef","buttonRef","dropdownId","listboxId","focusedIndex","itemRefs","_refresh","captureItem","node","index","getActiveItem","item","open","expandToIndex","$.set","activeItem","idx","i","tick","$.get","close","focusButton","toggleExpanded","selectItem","e","$.user_effect","onMount","handleClickOutside","event","getButtonText","ai","getButtonIcon","div","root","button","$.child","node_1","iconify_icon","root_1","$.template_effect","$.set_custom_element_data","$0","$$render","consequent","span","$.sibling","$.reset","$$value","node_2","div_1","root_2","max","button_1","root_3","node_3","iconify_icon_1","root_4","iconify_icon_2","root_6","consequent_2","consequent_1","alternate","span_1","$.action","$$node","$$action_arg","classes_2","$.set_class","$.set_attribute","$1","$.set_text","text_1","$.append","$$anchor","consequent_3","classes","classes_1","twMerge"],"mappings":"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"}