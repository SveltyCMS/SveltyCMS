{"version":3,"file":"BC9iKKM3.js","sources":["../../../../../../src/widgets/core/Date/Input.svelte"],"sourcesContent":["<!--\n@file src/widgets/core/Date/Input.svelte\n@component\n**Date Widget Input Component**\n\nProvides native HTML date input with automatic ISO 8601 normalization.\nPart of the Three Pillars Architecture for widget system.\n\n@example\n<DateInput bind:value={dateValue} {field} />\n\n#### Props\n- `field: FieldType` - Widget field definition with metadata\n- `value: string | null | undefined` - ISO 8601 date string (bindable)\n- `error: string | null | undefined` - Validation error message\n\n#### Features\n- Native date picker for optimal UX\n- ISO 8601 normalization\n- Timezone consistency\n- Min/max date constraints\n- Automatic validation\n- Required field support\n- Helper text support\n- Accessible with ARIA labels\n-->\n\n<script lang=\"ts\">\n\timport { getFieldName } from '@shared/utils/utils';\n\timport { validationStore } from '@shared/stores/store.svelte';\n\timport type { FieldType } from './';\n\timport { tokenTarget } from '@shared/services/token/tokenTarget';\n\n\tinterface Props {\n\t\tfield: FieldType;\n\t\tvalue: string | null | undefined;\n\t\terror?: string | null | undefined;\n\t}\n\n\tlet { field, value = $bindable(), error }: Props = $props();\n\n\tconst fieldName = $derived(getFieldName(field));\n\n\t// Convert ISO string to YYYY-MM-DD format for native input\n\n\tconst inputValue = $derived.by(() => {\n\t\tif (!value) return '';\n\t\ttry {\n\t\t\treturn value.substring(0, 10);\n\t\t} catch {\n\t\t\treturn '';\n\t\t}\n\t});\n\n\t// Calculate minimum date constraint\n\n\tconst minDate = $derived.by(() => {\n\t\tif (!field.minDate) return undefined;\n\t\ttry {\n\t\t\treturn new Date(field.minDate as string | Date).toISOString().substring(0, 10);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t});\n\n\t// Calculate maximum date constraint\n\tconst maxDate = $derived.by(() => {\n\t\tif (!field.maxDate) return undefined;\n\t\ttry {\n\t\t\treturn new Date(field.maxDate as string | Date).toISOString().substring(0, 10);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t});\n\n\t// Handle date input change\n\tfunction handleInput(event: Event & { currentTarget: HTMLInputElement }): void {\n\t\tconst dateStr = event.currentTarget.value;\n\n\t\tif (dateStr) {\n\t\t\ttry {\n\t\t\t\tconst selectedDate = new Date(dateStr);\n\n\t\t\t\t// Validate min date constraint\n\t\t\t\tif (field.minDate && selectedDate < new Date(field.minDate as string | Date)) {\n\t\t\t\t\tvalidationStore.setError(fieldName, `Date must be on or after ${new Date(field.minDate as string | Date).toLocaleDateString()}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Validate max date constraint\n\t\t\t\tif (field.maxDate && selectedDate > new Date(field.maxDate as string | Date)) {\n\t\t\t\t\tvalidationStore.setError(fieldName, `Date must be on or before ${new Date(field.maxDate as string | Date).toLocaleDateString()}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Convert to ISO string at UTC midnight\n\t\t\t\tvalue = selectedDate.toISOString();\n\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t} catch (e) {\n\t\t\t\tvalidationStore.setError(fieldName, 'Invalid date format');\n\t\t\t}\n\t\t} else {\n\t\t\tvalue = null;\n\t\t\tif (field.required) {\n\t\t\t\tvalidationStore.setError(fieldName, 'This field is required');\n\t\t\t} else {\n\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Handle blur for final validation\n\tfunction handleBlur(): void {\n\t\tif (!value && field.required) {\n\t\t\tvalidationStore.setError(fieldName, 'This field is required');\n\t\t}\n\t}\n</script>\n\n<div class=\"relative space-y-1\">\n\t<!-- Screen Reader Only Label -->\n\t<label for={field.db_fieldName} class=\"sr-only\">\n\t\t{field.label}\n\t\t{#if field.required}\n\t\t\t<span>(required)</span>\n\t\t{/if}\n\t</label>\n\n\t<!-- Date Input -->\n\t<div class=\"relative w-full\">\n\t\t<input\n\t\t\ttype=\"date\"\n\t\t\tid={field.db_fieldName}\n\t\t\tname={field.db_fieldName}\n\t\t\trequired={field.required}\n\t\t\tvalue={inputValue}\n\t\t\tmin={minDate}\n\t\t\tmax={maxDate}\n\t\t\toninput={handleInput}\n\t\t\tonblur={handleBlur}\n\t\t\tuse:tokenTarget={{\n\t\t\t\tname: field.db_fieldName,\n\t\t\t\tlabel: field.label,\n\t\t\t\tcollection: (field as any).collection\n\t\t\t}}\n\t\t\tclass=\"input\"\n\t\t\tclass:invalid={error}\n\t\t\taria-invalid={!!error}\n\t\t\taria-describedby={error ? `${field.db_fieldName}-error` : field.helper ? `${field.db_fieldName}-helper` : undefined}\n\t\t\taria-required={field.required}\n\t\t\tdata-testid=\"date-input\"\n\t\t/>\n\t</div>\n\n\t<!-- Helper Text -->\n\t{#if field.helper && !error}\n\t\t<p id={`${field.db_fieldName}-helper`} class=\"text-xs text-gray-600 dark:text-gray-400\">\n\t\t\t{field.helper}\n\t\t</p>\n\t{/if}\n\n\t<!-- Error Message -->\n\t{#if error}\n\t\t<p id={`${field.db_fieldName}-error`} class=\"text-xs text-error-500\" role=\"alert\" aria-live=\"polite\">\n\t\t\t{error}\n\t\t</p>\n\t{/if}\n</div>\n\n<style>\n\t/* Screen reader only utility */\n\t.sr-only {\n\t\tposition: absolute;\n\t\twidth: 1px;\n\t\theight: 1px;\n\t\tpadding: 0;\n\t\tmargin: -1px;\n\t\toverflow: hidden;\n\t\tclip: rect(0, 0, 0, 0);\n\t\twhite-space: nowrap;\n\t\tborder: 0;\n\t}\n</style>\n"],"names":["value","$.prop","$$props","fieldName","getFieldName","inputValue","$.derived","minDate","maxDate","handleInput","event","dateStr","selectedDate","validationStore","$.get","handleBlur","div","root","label","span","root_1","$$render","consequent","div_1","input","$.child","$.remove_input_defaults","$.action","$$node","$$action_arg","tokenTarget","p","root_2","$.set_attribute","consequent_1","p_1","root_3","$.set_value","classes","$.set_class","$.event"],"mappings":"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"}