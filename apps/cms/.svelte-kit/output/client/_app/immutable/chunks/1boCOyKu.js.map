{"version":3,"file":"1boCOyKu.js","sources":["../../../../../../../../shared/features/src/dashboard/widgets/UserOnlineWidget.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/dashboard/widgets/UserOnlineWidget.svelte\n@component\n**Dashboard widget for displaying online users with online time tracking**\n\n@example\n<UserOnlineWidget label=\"Online Users\" />\n\n### Props\n- `label`: The label for the widget (default: 'Online Users')\n\nFeatures:\n- Display currently logged-in users\n- Show online duration for each user\n- Sorted by longest online time first\n- Real-time avatar display with fallback placeholders\n- Responsive layout with hover effects\n- Theme-aware rendering (light/dark mode support)\n- Real-time data updates\n-->\n<script lang=\"ts\" module>\n\texport const widgetMeta = {\n\t\tname: 'Online Users',\n\t\ticon: 'mdi:account-multiple-outline',\n\t\tdefaultSize: { w: 1, h: 2 }\n\t};\n</script>\n\n<script lang=\"ts\">\n\timport BaseWidget from '../BaseWidget.svelte';\n\timport type { WidgetSize } from '@cms-types';\n\n\tinterface OnlineUser {\n\t\tid: string;\n\t\tname: string;\n\t\tavatarUrl?: string;\n\t\tonlineTime: string;\n\t\tonlineMinutes: number;\n\t}\n\n\ttype FetchedData = { onlineUsers: OnlineUser[] } | undefined;\n\n\tlet searchTerm = $state('');\n\n\tconst {\n\t\tlabel = 'Online Users',\n\t\ttheme = 'light' as 'light' | 'dark',\n\t\ticon = 'mdi:account-multiple-outline',\n\t\twidgetId = undefined,\n\t\tsize = { w: 1, h: 1 },\n\t\tonSizeChange = (_newSize: WidgetSize) => {},\n\t\tonRemove = () => {}\n\t}: {\n\t\tlabel?: string;\n\t\ttheme?: 'light' | 'dark';\n\t\ticon?: string;\n\t\twidgetId?: string;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tonRemove?: () => void;\n\t} = $props();\n\n\tfunction getPlaceholderAvatar(name: string) {\n\t\tconst initials = name\n\t\t\t.split(' ')\n\t\t\t.map((n) => n[0])\n\t\t\t.join('')\n\t\t\t.substring(0, 2)\n\t\t\t.toUpperCase();\n\t\treturn `https://placehold.co/40x40/6366f1/e0e7ff?text=${initials}`;\n\t}\n\n\tfunction filterUsers(users: OnlineUser[], search: string): OnlineUser[] {\n\t\tif (!search.trim()) return users;\n\t\tconst searchLower = search.toLowerCase();\n\t\treturn users.filter((user) => user.name.toLowerCase().includes(searchLower));\n\t}\n</script>\n\n<BaseWidget\n\t{label}\n\t{theme}\n\tendpoint=\"/api/dashboard/online_user\"\n\tpollInterval={60000}\n\t{icon}\n\t{widgetId}\n\t{size}\n\t{onSizeChange}\n\tonCloseRequest={onRemove}\n>\n\t{#snippet children({ data: fetchedData }: { data: FetchedData })}\n\t\t{#if fetchedData?.onlineUsers}\n\t\t\t{@const filteredUsers = filterUsers(fetchedData.onlineUsers, searchTerm)}\n\t\t\t<div class=\"flex h-full flex-col space-y-2\">\n\t\t\t\t<!-- Header with count -->\n\t\t\t\t<div class=\"text-center text-sm\">\n\t\t\t\t\t<span class=\"font-bold text-primary-500\">{fetchedData.onlineUsers.length}</span>\n\t\t\t\t\tUser(s) currently online.\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Search input (always show if there are users) -->\n\t\t\t\t{#if fetchedData.onlineUsers.length > 0}\n\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tplaceholder=\"Search users...\"\n\t\t\t\t\t\t\tbind:value={searchTerm}\n\t\t\t\t\t\t\tclass=\"w-full rounded-md border border-surface-300 bg-surface-50 px-3 py-1.5 text-xs placeholder-surface-400 focus:border-primary-400 focus:outline-none focus:ring-1 focus:ring-primary-400 dark:border-surface-600 dark:bg-surface-700 dark:text-surface-200 dark:placeholder-surface-500\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:magnify\" class=\"absolute right-2 top-1/2 -translate-y-1/2 text-surface-400 dark:text-surface-500\" width=\"14\"\n\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- User list -->\n\t\t\t\t<div class=\"grow space-y-1 overflow-y-auto\" style=\"max-height: 180px;\">\n\t\t\t\t\t{#if filteredUsers.length > 0}\n\t\t\t\t\t\t{#each filteredUsers as user (user.id)}\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-between gap-2 rounded-lg p-2 hover:bg-surface-50 dark:hover:bg-surface-700\">\n\t\t\t\t\t\t\t\t<div class=\"flex min-w-0 flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\tsrc={user.avatarUrl || getPlaceholderAvatar(user.name)}\n\t\t\t\t\t\t\t\t\t\talt=\"{user.name}'s avatar\"\n\t\t\t\t\t\t\t\t\t\tclass=\"h-7 w-7 shrink-0 rounded-full bg-surface-200 dark:bg-surface-700\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span class=\"truncate text-sm font-medium text-surface-800 dark:text-surface-200\">{user.name}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class=\"shrink-0 text-xs text-surface-500 dark:text-surface-50\">\n\t\t\t\t\t\t\t\t\t{user.onlineTime || 'N/A'}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{:else if searchTerm}\n\t\t\t\t\t\t<div class=\"flex h-full items-center justify-center text-sm text-surface-500\">\n\t\t\t\t\t\t\tNo users found matching \"{searchTerm}\".\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"flex h-full items-center justify-center text-sm text-surface-500\">No users are currently active.</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"flex h-full items-center justify-center text-sm text-surface-500\">Loading online users...</div>\n\t\t{/if}\n\t{/snippet}\n</BaseWidget>\n"],"names":["widgetMeta","searchTerm","$.state","label","theme","icon","widgetId","size","onSizeChange","$.prop","$$props","_newSize","onRemove","getPlaceholderAvatar","name","n","filterUsers","users","search","searchLower","user","BaseWidget","$$anchor","$$arg0","fetchedData","filteredUsers","div","root_2","div_1","span","div_2","root_3","input","$.child","$.remove_input_defaults","iconify_icon","$.sibling","$.get","$$value","$$render","consequent","div_3","node_1","$.each","node_3","div_4","root_5","div_5","img","span_1","span_2","$.set_attribute","$0","$.set_text","text_1","div_6","root_7","div_7","root_8","consequent_2","alternate","consequent_1","alternate_1","div_8","root_9","consequent_3","alternate_2"],"mappings":"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"}