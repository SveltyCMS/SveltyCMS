{"version":3,"file":"20.B6lMiz5z.js","sources":["../../../../../../src/routes/login/oauth/+page.svelte"],"sourcesContent":["<!-- \n@cms/routes/login/oauth/+page.svelte\n@description OAuth login page \n-->\n\n<script lang=\"ts\">\n\timport type { PageData } from './$types';\n\n\t// Components\n\timport SveltyCMSLogoFull from '@cms/components/system/icons/SveltyCMS_LogoFull.svelte';\n\timport FloatingInput from '@cms/components/system/inputs/floatingInput.svelte';\n\n\t// Stores\n\timport { globalLoadingStore, loadingOperations } from '@shared/stores/loadingStore.svelte';\n\n\t//ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\tinterface Props {\n\t\tdata: PageData;\n\t}\n\n\tconst { data }: Props = $props();\n\n\tlet token = $state('');\n\tlet formError = $state('');\n\tlet isFormValid = $state(false);\n\n\t// Update form validation when token changes\n\t$effect(() => {\n\t\tisFormValid = !data.requiresToken || (token.length >= 16 && token.length <= 48);\n\t});\n\n\t// Handle form submission\n\tasync function handleSubmit(event: SubmitEvent) {\n\t\tevent.preventDefault();\n\t\tif (data.requiresToken && !isFormValid) {\n\t\t\tformError = 'Invalid token length';\n\t\t\treturn;\n\t\t}\n\n\t\tformError = '';\n\n\t\tawait globalLoadingStore\n\t\t\t.withLoading(\n\t\t\t\tloadingOperations.authentication,\n\t\t\t\tasync () => {\n\t\t\t\t\tconst form = event.target as HTMLFormElement;\n\t\t\t\t\tconst formData = new FormData(form);\n\t\t\t\t\tconst response = await fetch(form.action, {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tbody: formData\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tthrow new Error('OAuth authentication failed');\n\t\t\t\t\t}\n\t\t\t\t\t// Redirect will be handled by the server\n\t\t\t\t},\n\t\t\t\t'OAuth.handleSubmit'\n\t\t\t)\n\t\t\t.catch((error) => {\n\t\t\t\tformError = error instanceof Error ? error.message : 'Authentication failed';\n\t\t\t});\n\t}\n\n\t// Handle cancel button\n\tfunction handleCancel() {\n\t\twindow.history.back();\n\t}\n</script>\n\n<div class=\"grid h-full w-full place-items-center bg-[#242728]\">\n\t<form class=\"card m-2 flex flex-col items-center gap-2 rounded border p-2 sm:p-6\" method=\"post\" action=\"?/OAuth\" onsubmit={handleSubmit}>\n\t\t<!-- CSS Logo -->\n\t\t<SveltyCMSLogoFull />\n\n\t\t{#if data.requiresToken}\n\t\t\t<!-- Token Input Form -->\n\t\t\t<label>\n\t\t\t\t<h2 class=\"mb-2 text-center text-xl font-bold text-primary-500\">\n\t\t\t\t\t{m.oauth_entertoken()}\n\t\t\t\t</h2>\n\t\t\t\t<FloatingInput\n\t\t\t\t\tid=\"token\"\n\t\t\t\t\tname=\"token\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\trequired\n\t\t\t\t\tbind:value={token}\n\t\t\t\t\tlabel={m.registration_token?.() || m.signup_registrationtoken?.()}\n\t\t\t\t\ticon=\"mdi:key-chain\"\n\t\t\t\t\ticonColor=\"white\"\n\t\t\t\t\ttextColor=\"white\"\n\t\t\t\t\tpasswordIconColor=\"white\"\n\t\t\t\t\tinputClass=\"text-white\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tminlength={16}\n\t\t\t\t\tmaxlength={48}\n\t\t\t\t/>\n\t\t\t</label>\n\t\t{/if}\n\n\t\t<!-- Error Message -->\n\t\t{#if formError}\n\t\t\t<p id=\"error-message\" class=\"text-error-500\" role=\"alert\">\n\t\t\t\t{formError}\n\t\t\t</p>\n\t\t{/if}\n\n\t\t<div class=\"mt-2 flex w-full justify-between gap-1 sm:gap-2\">\n\t\t\t<!-- Cancel Button -->\n\t\t\t<button type=\"button\" onclick={handleCancel} aria-label={m.button_cancel()} class=\"variant-filled btn\">\n\t\t\t\t{m.button_cancel()}\n\t\t\t</button>\n\n\t\t\t<!-- Submit Button -->\n\t\t\t<button\n\t\t\t\ttype=\"submit\"\n\t\t\t\tdisabled={!isFormValid || globalLoadingStore.isLoading}\n\t\t\t\taria-label={m.button_send()}\n\t\t\t\tclass=\"variant-filled btn items-center\"\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"flat-color-icons:google\" color=\"white\" width=\"20\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t<p>{m.oauth_signup()}</p>\n\t\t\t</button>\n\t\t</div>\n\t</form>\n</div>\n"],"names":["token","$.state","formError","isFormValid","$.user_effect","$.set","$$props","$.get","handleSubmit","event","globalLoadingStore","loadingOperations","form","formData","error","handleCancel","div","root","form_1","SveltyCMSLogoFull","node","label","root_1","h2","$0","$.derived","m.registration_token","m.signup_registrationtoken","FloatingInput","node_2","$$value","$.template_effect","$.set_text","text","m.oauth_entertoken","$$render","consequent","p","root_2","consequent_1","div_1","$.sibling","node_3","button","button_1","iconify_icon","$.child","p_1","$.reset","$.set_attribute","$2","m.button_cancel","m.button_send","m.oauth_signup","$.event"],"mappings":"wmCAKA,aAmBKA,EAAQC,EAAO,EAAE,EACjBC,EAAYD,EAAO,EAAE,EACrBE,EAAcF,EAAO,EAAK,EAG9BG,EAAO,IAAO,CACbC,EAAAF,EAAW,CAAAG,EAAA,KAAS,eAAaC,EAAKP,CAAK,EAAC,QAAU,IAAEO,EAAIP,CAAK,EAAC,QAAU,GAAE,EAAA,CAC/E,CAAC,iBAGcQ,EAAaC,EAAoB,IAC/CA,EAAM,eAAc,SACX,eAAa,CAAAF,EAAKJ,CAAW,EAAE,CACvCE,EAAAH,EAAY,sBAAsB,QAEnC,CAEAG,EAAAH,EAAY,EAAE,EAER,MAAAQ,EACJ,YACAC,EAAkB,eACN,SAAA,OACLC,EAAOH,EAAM,OACbI,EAAQ,IAAO,SAASD,CAAI,OACpB,MAAS,MAAMA,EAAK,OAAM,CACvC,OAAQ,OACR,KAAMC,EAAA,GAGO,GACH,MAAA,IAAA,MAAM,6BAA6B,CAG/C,EACA,sBAEA,MAAOC,GAAU,GACjBZ,EAAYY,aAAiB,MAAQA,EAAM,QAAU,wBAAuB,EAAA,CAC7E,CAAC,CACH,CAGS,SAAAC,GAAe,CACvB,OAAO,QAAQ,KAAI,CACpB,KAGAC,EAAGC,GAAA,EACFC,IADDF,CAAG,MACFE,CAAI,EAEHC,EAAiBC,EAAA,EAAA,8BAIhBC,EAAKC,GAAA,EACJC,IADDF,CAAK,MACJE,EAAE,EAAA,IAAFA,CAAE,UAAFA,EAAE,CAAA,GASK,IAAAC,EAAAC,EAAA,IAAAC,KAAoB,GAAQC,KAA0B,CAAA,EAN7DC,EAAAC,EAAA,kNAaW,aACA,OATX,OAAU,UAAE7B,CAAK,OAAjB,MAAU8B,EAAA,GAAE9B,EAAK8B,EAAA,EAAA,OATlBT,CAAK,EAEHU,EAAAP,GAAAQ,EAAAC,EAAAT,CAAA,EAAA,CAAA,IAAAU,GAAkB,CAAA,CAAA,MAFpBb,CAAK,kBAFG,eAAac,EAAAC,CAAA,gCA2BrBC,EAACC,GAAA,MAADD,EAAC,EAAA,IAADA,CAAC,cACAnC,CAAS,CAAA,CAAA,MADVmC,CAAC,aADEnC,CAAS,GAAAiC,EAAAI,CAAA,QAMbC,EAAGC,EAAAC,EAAA,CAAA,EAEFC,IAFDH,CAAG,EAEFG,EAAqB,QAAS5B,UAA9B4B,EAAM,EAAA,IAANA,CAAM,EAKN,IAAAC,EAAAH,EALAE,EAAM,CAAA,EAWLE,EAAYC,EANbF,CAAA,IAMCC,EAAY,OAAA,yBAAA,IAAZA,EAAY,QAAA,OAAA,IAAZA,EAAY,QAAA,IAAA,IAAZA,EAAY,EAAA,MAAA,EACZ,IAAAE,IADAF,EAAY,CAAA,MACZE,EAAC,EAAA,IAADA,CAAC,EAPFC,EAAAJ,CAAA,IAPDJ,CAAG,IApCJtB,CAAI,IADLF,CAAG,kBAuCA2B,EAAM,aAAAnB,CAAA,SAKNoB,EAAA,SAAA,CAAArC,EAEWJ,CAAW,GAAIO,EAAmB,UAF7CuC,EAAAL,EAAA,aAAAM,CAAA,WALwD,IAAAC,EAAe,EACtE,IAAAA,EAAe,EAOJ,IAAAC,EAAa,EAIrB,IAAAC,GAAc,IAlDpBC,EAAA,SAAApC,EAA0HV,CAAY,MADvIQ,CAAG,KAFI"}