{"version":3,"mappings":"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","names":["LAYOUT_KEY","fetchLayout","res","logger","e","saveLayout","layout","PreferencesStore","$.state","$.proxy","value","#loading","#error","w","preferences","widget","prefs","idx","widgets","ordered","i","id","systemPreferences","MAX_COLUMNS","MAX_ROWS","HEADER_HEIGHT","mainContainerEl","dropdownOpen","searchQuery","registryLoaded","widgetRegistry","loadedWidgets","widgetObservers","showImportExport","dragState","dropIndicator","gridDropIndicator","loadWidgetRegistry","modules","__vitePreload","registry","path","name","module","$.set","loadWidgetComponent","widgetId","componentName","$.get","error","setupWidgetObserver","element","params","observer","entries","entry","widgetComponentRegistry","currentPreferences","$.derived","availableWidgets","item","filteredWidgets","currentTheme","themeStore","findInsertionPosition","x","y","gridContainer","widgetPositions","el","rect","gridRect","relativeX","relativeY","insertIndex","minDistance","targetY","targetX","lastWidget","prevWidget","nextWidget","distance","ensureWidgetOrder","needsUpdate","index","a","b","addNewWidget","componentInfo","defaultSize","newItem","removeWidget","resetAllWidgets","resizeWidget","newSize","updatedSize","performDrop","indicator","currentWidgets","currentIndex","movedWidget","updatedWidgets","handleDragStart","event","coords","clone","handleDragMove","handleDragEnd","insertionIndex","p","originalElement","onMount","main","$.first_child","fragment","header","PageTitle","node","div","$.sibling","button","root_1","iconify_icon","$$render","consequent","div_1","node_1","button_1","root_2","iconify_icon_1","$.child","$.reset","$.template_effect","$.set_attribute","$.append","$$anchor","consequent_1","div_2","root_3","div_3","input","div_4","widgetName","widgetInfo","button_2","root_4","iconify_icon_2","$.set_custom_element_data","div_5","span","div_6","root_5","$$value","consequent_2","div_7","section","div_8","root_6","div_9","root_7","styles","$.set_style","consequent_3","WidgetComponent","div_10","root_8","node_7","div_11","root_9","div_12","root_11","iconify_icon_3","p_1","button_3","$.set_text","text_1","$0","$$props","WidgetComponent_1","consequent_5","alternate","alternate_1","consequent_4","isDropTarget","div_13","root_14","consequent_6","consequent_7","$.action","$$node","$$action_arg","styles_1","flip","div_14","root_15","div_15","iconify_icon_4","button_4","iconify_icon_5","consequent_8","alternate_2","div_16","root_16","div_17","div_18","button_5","iconify_icon_6","div_19","ImportExportManager","node_13","div_20","div_21","iconify_icon_7","div_22","button_6","consequent_9"],"ignoreList":[],"sources":["../../../../../../../../shared/stores/src/systemPreferences.svelte.ts","../../../../../../src/routes/dashboard/+page.svelte"],"sourcesContent":["/**\n * @file src/stores/systemPreferences.svelte.ts\n * @description User preferences with server persistence (Svelte 5 runes)\n */\n\nimport type { DashboardWidgetConfig, Layout } from '@cms-types/content';\nimport { logger } from '@shared/utils/logger';\n\nconst LAYOUT_KEY = 'dashboard.layout.default';\n\n// --- API Helpers ---\n\nasync function fetchLayout(): Promise<Layout | null> {\n\ttry {\n\t\tconst res = await fetch(`/api/systemPreferences?key=${LAYOUT_KEY}`);\n\t\tif (res.status === 404) {\n\t\t\tlogger.info('No saved dashboard layout, using default');\n\t\t\treturn null;\n\t\t}\n\t\tif (!res.ok) throw new Error(`Fetch failed: ${res.statusText}`);\n\t\treturn await res.json();\n\t} catch (e) {\n\t\tlogger.error('Failed to fetch preferences:', e);\n\t\tthrow e;\n\t}\n}\n\nasync function saveLayout(layout: Layout): Promise<void> {\n\ttry {\n\t\tconst res = await fetch('/api/systemPreferences', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\tbody: JSON.stringify({ key: LAYOUT_KEY, value: layout })\n\t\t});\n\t\tif (!res.ok) throw new Error(`Save failed: ${res.statusText}`);\n\t} catch (e) {\n\t\tlogger.error('Failed to save preferences:', e);\n\t\tthrow e;\n\t}\n}\n\n// --- Store ---\n\nclass PreferencesStore {\n\tpreferences = $state<DashboardWidgetConfig[]>([]);\n\tloading = $state(true);\n\terror = $state<string | null>(null);\n\n\tasync load() {\n\t\tthis.loading = true;\n\t\tthis.error = null;\n\n\t\ttry {\n\t\t\tconst layout = await fetchLayout();\n\t\t\tthis.preferences = (layout?.preferences || []).map((w) => ({\n\t\t\t\t...w,\n\t\t\t\tsize: w.size?.w && w.size?.h ? w.size : { w: 1, h: 1 }\n\t\t\t}));\n\t\t} catch (e) {\n\t\t\tthis.error = e instanceof Error ? e.message : 'Unknown error';\n\t\t\tthis.preferences = [];\n\t\t} finally {\n\t\t\tthis.loading = false;\n\t\t}\n\t}\n\n\tasync set(preferences: DashboardWidgetConfig[]) {\n\t\tthis.preferences = preferences;\n\t\tawait saveLayout({\n\t\t\tid: 'default',\n\t\t\tname: 'Default',\n\t\t\tpreferences\n\t\t});\n\t}\n\n\tasync updateWidget(widget: DashboardWidgetConfig) {\n\t\tconst prefs = [...this.preferences];\n\t\tconst idx = prefs.findIndex((w) => w.id === widget.id);\n\n\t\tif (idx > -1) prefs[idx] = widget;\n\t\telse prefs.push(widget);\n\n\t\tthis.preferences = prefs;\n\t\tawait saveLayout({ id: 'default', name: 'Default', preferences: prefs });\n\t}\n\n\tasync updateWidgets(widgets: DashboardWidgetConfig[]) {\n\t\tconst ordered = widgets.map((w, i) => ({ ...w, order: i }));\n\t\tthis.preferences = ordered;\n\t\tawait saveLayout({ id: 'default', name: 'Default', preferences: ordered });\n\t}\n\n\tasync removeWidget(id: string) {\n\t\tconst prefs = this.preferences.filter((w) => w.id !== id);\n\t\tthis.preferences = prefs;\n\t\tawait saveLayout({ id: 'default', name: 'Default', preferences: prefs });\n\t}\n\n\t// Compatibility aliases\n\tasync loadPreferences() {\n\t\treturn this.load();\n\t}\n\n\tasync setPreferences(prefs: DashboardWidgetConfig[]) {\n\t\treturn this.set(prefs);\n\t}\n}\n\nexport const preferences = new PreferencesStore();\nexport const systemPreferences = preferences;\n","<!--\n@file src/routes/(app)/dashboard/+page.svelte\n@component\n**Dashboard page providing a user-friendly interface for managing system resources and system messages**\n\n@example\n<Dashboard />\n\n### Props\n- `data` {object} - Object containing user data\n\n### Features\n- Displays widgets for CPU usage, disk usage, memory usage, performance, user activity, and system messages\n- Fully responsive grid with dynamic width and height resizing\n- Drag-and-drop widget reordering\n- Persistent widget configurations via systemPreferences with multiple layouts\n- Layout switching (e.g., default, compact)\n- Accessible widget addition, removal, and layout switching\n- Lazy loading with Intersection Observer for optimal performance\n-->\n<script lang=\"ts\">\n\timport ImportExportManager from '@cms/components/admin/ImportExportManager.svelte';\n\timport PageTitle from '@cms/components/PageTitle.svelte';\n\timport type { DashboardWidgetConfig, DropIndicator, WidgetComponent, WidgetMeta, WidgetSize } from '@cms-types';\n\timport { themeStore } from '@shared/stores/themeStore.svelte';\n\timport { systemPreferences } from '@shared/stores/systemPreferences.svelte';\n\timport { logger } from '@shared/utils/logger';\n\timport { onMount } from 'svelte';\n\timport { flip } from 'svelte/animate';\n\timport type { PageData } from './$types';\n\n\tconst { data }: { data: PageData } = $props();\n\n\t// Define the types for the widget registry\n\tinterface WidgetRegistryEntry {\n\t\tcomponent: WidgetComponent;\n\t\tname: string;\n\t\tdescription: string;\n\t\ticon: string;\n\t\twidgetMeta: WidgetMeta;\n\t}\n\ttype WidgetRegistry = Record<string, WidgetRegistryEntry>;\n\n\tconst MAX_COLUMNS = 4;\n\tconst MAX_ROWS = 4;\n\tconst HEADER_HEIGHT = 48; // Approx height of widget header\n\n\tlet mainContainerEl: HTMLElement | null = $state(null);\n\tlet dropdownOpen = $state(false);\n\tlet searchQuery = $state('');\n\tlet registryLoaded = $state(false);\n\tlet widgetRegistry: WidgetRegistry = $state({});\n\n\t// Lazy loading state for widgets\n\tlet loadedWidgets = $state(new Map());\n\tconst widgetObservers = new Map();\n\n\tlet showImportExport = $state(false);\n\n\tlet dragState: {\n\t\titem: DashboardWidgetConfig | null;\n\t\telement: HTMLElement | null;\n\t\toffset: { x: number; y: number };\n\t\tisActive: boolean;\n\t\tgridPosition?: { row: number; col: number };\n\t} = $state({ item: null, element: null, offset: { x: 0, y: 0 }, isActive: false });\n\tlet dropIndicator: DropIndicator | null = $state(null);\n\tlet gridDropIndicator: { row: number; col: number; width: number; height: number } | null = $state(null);\n\n\tasync function loadWidgetRegistry() {\n\t\tconst modules = import.meta.glob('@cms/dashboard/widgets/*.svelte');\n\t\tconst registry: typeof widgetRegistry = {};\n\t\tfor (const path in modules) {\n\t\t\tconst name = path.split('/').pop()?.replace('.svelte', '');\n\t\t\tif (name) {\n\t\t\t\tconst module = (await modules[path]()) as { default: WidgetComponent; widgetMeta: WidgetMeta };\n\t\t\t\tregistry[name] = {\n\t\t\t\t\tcomponent: module.default,\n\t\t\t\t\tname: module.widgetMeta?.name || name,\n\t\t\t\t\tdescription: module.widgetMeta?.description || '',\n\t\t\t\t\ticon: module.widgetMeta?.icon || 'mdi:widgets',\n\t\t\t\t\twidgetMeta: module.widgetMeta\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\twidgetRegistry = registry;\n\t\tregistryLoaded = true;\n\t}\n\n\t// Lazy load individual widget when it becomes visible\n\tasync function loadWidgetComponent(widgetId: string, componentName: string) {\n\t\t// Skip if already loaded\n\t\tif (loadedWidgets.has(widgetId)) return;\n\n\t\ttry {\n\t\t\t// Dynamically import the widget component\n\t\t\tconst module = await import(`@cms/dashboard/widgets/${componentName}.svelte`);\n\t\t\tloadedWidgets.set(widgetId, module.default);\n\t\t\tloadedWidgets = new Map(loadedWidgets); // Trigger reactivity\n\t\t} catch (error) {\n\t\t\tlogger.error(`Failed to load widget: ${componentName}`, error);\n\t\t\tloadedWidgets.set(widgetId, null); // Mark as failed\n\t\t\tloadedWidgets = new Map(loadedWidgets);\n\t\t}\n\t}\n\n\t// Setup intersection observer for lazy loading (Svelte action)\n\tfunction setupWidgetObserver(element: HTMLElement, params: [string, string]) {\n\t\tconst [widgetId, componentName] = params;\n\n\t\tconst observer = new IntersectionObserver(\n\t\t\t(entries) => {\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (entry.isIntersecting && !loadedWidgets.has(widgetId)) {\n\t\t\t\t\t\tloadWidgetComponent(widgetId, componentName);\n\t\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\t\twidgetObservers.delete(widgetId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t{ rootMargin: '100px' } // Start loading 100px before visible\n\t\t);\n\n\t\tobserver.observe(element);\n\t\twidgetObservers.set(widgetId, observer);\n\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\tobserver.disconnect();\n\t\t\t\twidgetObservers.delete(widgetId);\n\t\t\t}\n\t\t};\n\t}\n\n\tconst widgetComponentRegistry = $derived(widgetRegistry);\n\tconst currentPreferences = $derived(systemPreferences.preferences || []);\n\tconst availableWidgets = $derived(\n\t\tregistryLoaded && currentPreferences\n\t\t\t? Object.keys(widgetComponentRegistry).filter((name) => !currentPreferences.some((item: DashboardWidgetConfig) => item.component === name))\n\t\t\t: []\n\t);\n\tconst filteredWidgets = $derived(availableWidgets.filter((name) => name.toLowerCase().includes(searchQuery.toLowerCase())));\n\n\tconst currentTheme: 'dark' | 'light' = $derived(themeStore.isDarkMode ? 'dark' : 'light');\n\n\t// Helper function to find insertion position based on coordinates\n\tfunction findInsertionPosition(x: number, y: number): number {\n\t\tconst gridContainer = mainContainerEl?.querySelector('.responsive-dashboard-grid') as HTMLElement;\n\t\tif (!gridContainer) return currentPreferences.length;\n\n\t\t// Get all widget elements and their positions\n\t\tconst widgets = Array.from(gridContainer.querySelectorAll('.widget-container')) as HTMLElement[];\n\t\tconst widgetPositions = widgets.map((el) => {\n\t\t\tconst rect = el.getBoundingClientRect();\n\t\t\tconst gridRect = gridContainer.getBoundingClientRect();\n\t\t\treturn {\n\t\t\t\tid: el.dataset.widgetId,\n\t\t\t\tcenterX: rect.left + rect.width / 2 - gridRect.left,\n\t\t\t\tcenterY: rect.top + rect.height / 2 - gridRect.top,\n\t\t\t\trect\n\t\t\t};\n\t\t});\n\n\t\tconst relativeX = x - gridContainer.getBoundingClientRect().left;\n\t\tconst relativeY = y - gridContainer.getBoundingClientRect().top;\n\n\t\t// Find the closest widget or insertion point\n\t\tlet insertIndex = 0;\n\t\tlet minDistance = Infinity;\n\n\t\tfor (let i = 0; i <= widgetPositions.length; i++) {\n\t\t\tlet targetY, targetX;\n\n\t\t\tif (i === 0) {\n\t\t\t\t// Before first widget\n\t\t\t\ttargetY = widgetPositions[0]?.centerY || 0;\n\t\t\t\ttargetX = widgetPositions[0]?.centerX || 0;\n\t\t\t} else if (i === widgetPositions.length) {\n\t\t\t\t// After last widget\n\t\t\t\tconst lastWidget = widgetPositions[widgetPositions.length - 1];\n\t\t\t\ttargetY = lastWidget?.centerY || relativeY;\n\t\t\t\ttargetX = lastWidget?.centerX || relativeX;\n\t\t\t} else {\n\t\t\t\t// Between widgets\n\t\t\t\tconst prevWidget = widgetPositions[i - 1];\n\t\t\t\tconst nextWidget = widgetPositions[i];\n\t\t\t\ttargetY = (prevWidget.centerY + nextWidget.centerY) / 2;\n\t\t\t\ttargetX = (prevWidget.centerX + nextWidget.centerX) / 2;\n\t\t\t}\n\n\t\t\tconst distance = Math.sqrt(Math.pow(relativeX - targetX, 2) + Math.pow(relativeY - targetY, 2));\n\n\t\t\tif (distance < minDistance) {\n\t\t\t\tminDistance = distance;\n\t\t\t\tinsertIndex = i;\n\t\t\t}\n\t\t}\n\n\t\treturn insertIndex;\n\t}\n\n\t// Ensure all widgets have proper order values\n\tfunction ensureWidgetOrder() {\n\t\tconst widgets = [...currentPreferences];\n\t\tlet needsUpdate = false;\n\n\t\t// Check if any widgets are missing order property\n\t\twidgets.forEach((widget, index) => {\n\t\t\tif (typeof widget.order !== 'number') {\n\t\t\t\twidget.order = index;\n\t\t\t\tneedsUpdate = true;\n\t\t\t}\n\t\t});\n\n\t\t// Sort by existing order and reassign sequential order values\n\t\twidgets.sort((a, b) => (a.order || 0) - (b.order || 0));\n\t\twidgets.forEach((widget, index) => {\n\t\t\tif (widget.order !== index) {\n\t\t\t\twidget.order = index;\n\t\t\t\tneedsUpdate = true;\n\t\t\t}\n\t\t});\n\n\t\t// Update widgets if needed using batch update\n\t\tif (needsUpdate) {\n\t\t\tsystemPreferences.updateWidgets(widgets);\n\t\t}\n\t}\n\n\tfunction addNewWidget(componentName: string) {\n\t\tconst componentInfo = widgetComponentRegistry[componentName];\n\t\tif (!componentInfo) {\n\t\t\tlogger.error(`SveltyCMS: Widget component info for \"${componentName}\" not found in registry.`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst defaultSize = componentInfo.widgetMeta?.defaultSize || { w: 1, h: 1 };\n\n\t\tconst newItem: DashboardWidgetConfig = {\n\t\t\tid: `widget-${Math.random().toString(36).substring(2, 15)}-${Date.now().toString(36)}`,\n\t\t\tcomponent: componentName,\n\t\t\tlabel: componentInfo.name,\n\t\t\ticon: componentInfo.icon,\n\t\t\tsize: defaultSize,\n\t\t\tsettings: componentInfo.widgetMeta?.settings || {},\n\t\t\torder: currentPreferences.length // Use order instead of gridPosition\n\t\t};\n\t\tsystemPreferences.updateWidget(newItem);\n\t\tdropdownOpen = false;\n\t\tsearchQuery = '';\n\t}\n\n\tfunction removeWidget(id: string) {\n\t\tsystemPreferences.removeWidget(id);\n\t\t// Clean up loaded widget and observer\n\t\tloadedWidgets.delete(id);\n\t\tconst observer = widgetObservers.get(id);\n\t\tif (observer) {\n\t\t\tobserver.disconnect();\n\t\t\twidgetObservers.delete(id);\n\t\t}\n\t}\n\n\tfunction resetAllWidgets() {\n\t\tsystemPreferences.setPreferences([]);\n\t\t// Clean up all loaded widgets and observers\n\t\tloadedWidgets.clear();\n\t\twidgetObservers.forEach((observer) => observer.disconnect());\n\t\twidgetObservers.clear();\n\t}\n\n\tfunction resizeWidget(widgetId: string, newSize: WidgetSize) {\n\t\tconst item = currentPreferences.find((i: DashboardWidgetConfig) => i.id === widgetId);\n\t\tif (item) {\n\t\t\tconst updatedSize = {\n\t\t\t\tw: Math.max(1, Math.min(MAX_COLUMNS, newSize.w)),\n\t\t\t\th: Math.max(1, Math.min(MAX_ROWS, newSize.h))\n\t\t\t};\n\t\t\tsystemPreferences.updateWidget({ ...item, size: updatedSize });\n\t\t}\n\t}\n\n\tfunction performDrop(widget: DashboardWidgetConfig, indicator: { targetIndex: number }) {\n\t\tconst currentWidgets = [...currentPreferences];\n\t\tconst currentIndex = currentWidgets.findIndex((w) => w.id === widget.id);\n\n\t\tif (currentIndex === -1) return;\n\n\t\t// Remove from current position\n\t\tconst [movedWidget] = currentWidgets.splice(currentIndex, 1);\n\n\t\t// Insert at new position\n\t\tcurrentWidgets.splice(indicator.targetIndex, 0, movedWidget);\n\n\t\t// Update order property for all widgets and save them as a batch\n\t\tconst updatedWidgets = currentWidgets.map((w, index) => ({\n\t\t\t...w,\n\t\t\torder: index\n\t\t}));\n\n\t\tsystemPreferences.updateWidgets(updatedWidgets);\n\t}\n\tfunction handleDragStart(event: MouseEvent | TouchEvent | PointerEvent, item: DashboardWidgetConfig, element: HTMLElement) {\n\t\t// Ignore clicks on interactive elements and resize handles\n\t\tif ((event.target as HTMLElement).closest('button, a, input, select, [role=button], .resize-handles, [data-direction]')) return;\n\n\t\tconst coords = 'touches' in event ? event.touches[0] : event;\n\t\tconst rect = element.getBoundingClientRect();\n\n\t\tif (coords.clientY - rect.top > HEADER_HEIGHT) return;\n\n\t\tevent.preventDefault();\n\t\tdragState = {\n\t\t\titem,\n\t\t\telement,\n\t\t\toffset: { x: coords.clientX - rect.left, y: coords.clientY - rect.top },\n\t\t\tisActive: true\n\t\t};\n\n\t\telement.style.opacity = '0.5';\n\t\telement.style.zIndex = '1000';\n\t\tconst clone = element.cloneNode(true) as HTMLElement;\n\t\tclone.style.cssText = `position: fixed; left: ${rect.left}px; top: ${rect.top}px; width: ${rect.width}px; height: ${rect.height}px; pointer-events: none; transform: scale(1.02); box-shadow: 0 20px 40px rgba(0,0,0,0.15); margin: 0;`;\n\t\tdocument.body.appendChild(clone);\n\t\tdragState.element = clone;\n\n\t\t// Use pointer events to cover mouse, touch, and pen with a passive move listener\n\t\tdocument.addEventListener('pointermove', handleDragMove as EventListener, { passive: true });\n\t\tdocument.addEventListener('pointerup', handleDragEnd as EventListener, { once: true });\n\t}\n\n\tfunction handleDragMove(event: MouseEvent | TouchEvent | PointerEvent) {\n\t\tif (!dragState.isActive || !dragState.element) return;\n\n\t\tconst coords = 'touches' in event ? event.touches[0] : event;\n\t\tdragState.element.style.left = `${coords.clientX - dragState.offset.x}px`;\n\t\tdragState.element.style.top = `${coords.clientY - dragState.offset.y}px`;\n\n\t\t// Find insertion position based on mouse coordinates\n\t\tconst insertionIndex = findInsertionPosition(coords.clientX, coords.clientY);\n\n\t\t// Show visual feedback for insertion position\n\t\tif (dragState.item) {\n\t\t\tconst currentIndex = currentPreferences.findIndex((p: DashboardWidgetConfig) => p.id === dragState.item?.id);\n\t\t\tif (currentIndex !== -1 && insertionIndex !== currentIndex && insertionIndex !== currentIndex + 1) {\n\t\t\t\tdropIndicator = {\n\t\t\t\t\tshow: true,\n\t\t\t\t\tposition: insertionIndex,\n\t\t\t\t\ttargetIndex: insertionIndex > currentIndex ? insertionIndex - 1 : insertionIndex\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tdropIndicator = null;\n\t\t\t}\n\t\t}\n\n\t\t// Clear grid drop indicator as we're using linear positioning\n\t\tgridDropIndicator = null;\n\t}\n\n\tfunction handleDragEnd() {\n\t\tif (!dragState.isActive) return;\n\n\t\tconst originalElement = mainContainerEl?.querySelector(`[data-widget-id=\"${dragState.item?.id}\"]`) as HTMLElement;\n\t\tif (originalElement) {\n\t\t\toriginalElement.style.opacity = '';\n\t\t\toriginalElement.style.zIndex = '';\n\t\t}\n\n\t\tif (dragState.element) {\n\t\t\tdocument.body.removeChild(dragState.element);\n\t\t}\n\n\t\t// Handle repositioning based on drop indicator\n\t\tif (dropIndicator && dragState.item && dropIndicator.targetIndex !== undefined) {\n\t\t\tperformDrop(dragState.item, { targetIndex: dropIndicator.targetIndex });\n\t\t}\n\n\t\tdragState = { item: null, element: null, offset: { x: 0, y: 0 }, isActive: false };\n\t\tdropIndicator = null;\n\t\tgridDropIndicator = null;\n\n\t\tdocument.removeEventListener('pointermove', handleDragMove as EventListener);\n\t}\n\n\tonMount(() => {\n\t\tloadWidgetRegistry();\n\t\tsystemPreferences.loadPreferences();\n\t\t// Ensure proper widget ordering after preferences load\n\t\tsetTimeout(ensureWidgetOrder, 100);\n\n\t\t// Cleanup observers on unmount\n\t\treturn () => {\n\t\t\twidgetObservers.forEach((observer) => observer.disconnect());\n\t\t\twidgetObservers.clear();\n\t\t};\n\t});\n</script>\n\n<main bind:this={mainContainerEl} class=\"relative overflow-y-auto overflow-x-hidden\" style=\"touch-action: pan-y;\">\n\t<header class=\"mb-2 flex items-center justify-between gap-2 border-b border-surface-200 p-2 dark:text-surface-50\">\n\t\t<PageTitle name=\"Dashboard\" icon=\"bi:bar-chart-line\" showBackButton={true} backUrl=\"/config\" />\n\t\t<div class=\"flex items-center gap-2\">\n\t\t\t<!-- Reset All Button - Small and subtle -->\n\t\t\t{#if currentPreferences.length > 0}\n\t\t\t\t<button class=\"preset-outlined-surface-500 btn-icon\" onclick={resetAllWidgets} aria-label=\"Reset all widgets\" title=\"Reset all widgets\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:refresh\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t\t<!-- Add Widget Button -->\n\t\t\t<div class=\"relative\">\n\t\t\t\t{#if availableWidgets.length > 0}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"preset-filled-tertiary-500 btn dark:preset-filled-primary-500\"\n\t\t\t\t\t\tonclick={() => (dropdownOpen = !dropdownOpen)}\n\t\t\t\t\t\taria-haspopup=\"true\"\n\t\t\t\t\t\taria-expanded={dropdownOpen}\n\t\t\t\t\t\taria-label=\"Add Widget\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:plus\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t\tAdd Widget\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t\t{#if dropdownOpen}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"widget-dropdown absolute right-0 z-30 mt-2 w-72 rounded border bg-white shadow-2xl dark:border-gray-700 dark:bg-surface-900\"\n\t\t\t\t\t\trole=\"menu\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"p-2\">\n\t\t\t\t\t\t\t<input type=\"text\" class=\"input w-full\" placeholder=\"Search widgets...\" bind:value={searchQuery} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"max-h-64 overflow-y-auto py-1\">\n\t\t\t\t\t\t\t{#each filteredWidgets as widgetName (widgetName)}\n\t\t\t\t\t\t\t\t{@const widgetInfo = widgetComponentRegistry[widgetName]}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex w-full items-center gap-2 px-4 py-2 text-left transition-colors hover:bg-primary-100 dark:hover:bg-primary-900/30\"\n\t\t\t\t\t\t\t\t\tonclick={() => addNewWidget(widgetName)}\n\t\t\t\t\t\t\t\t\ttitle={widgetInfo?.description}\n\t\t\t\t\t\t\t\t\trole=\"menuitem\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<iconify-icon icon={widgetInfo?.icon || 'mdi:widgets'} class=\"text-primary-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t\t\t<span>{widgetInfo?.name || widgetName}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\"px-4 py-2 text-sm text-gray-500\">No widgets found.</div>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</header>\n\n\t<div class=\"relative m-0 w-full p-0\">\n\t\t<section class=\"w-full px-1 py-4\">\n\t\t\t{#if currentPreferences.length > 0}\n\t\t\t\t<div class=\"responsive-dashboard-grid\" role=\"grid\">\n\t\t\t\t\t<!-- Grid drop indicator -->\n\t\t\t\t\t{#if gridDropIndicator}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"pointer-events-none absolute z-30 rounded-lg border-2 border-dashed border-primary-500 bg-primary-500/20\"\n\t\t\t\t\t\t\tstyle:grid-column=\"span {gridDropIndicator.width}\"\n\t\t\t\t\t\t\tstyle:grid-row=\"span {gridDropIndicator.height}\"\n\t\t\t\t\t\t\tstyle:grid-column-start={gridDropIndicator.col + 1}\n\t\t\t\t\t\t\tstyle:grid-row-start={gridDropIndicator.row + 1}\n\t\t\t\t\t\t></div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#each currentPreferences.sort((a: DashboardWidgetConfig, b: DashboardWidgetConfig) => (a.order || 0) - (b.order || 0)) as item (item.id)}\n\t\t\t\t\t\t{@const WidgetComponent = loadedWidgets.get(item.id)}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\t\tclass=\"widget-container group relative select-none overflow-hidden rounded-lg border border-surface-200/80 bg-surface-50 shadow-sm transition-all duration-300 dark:text-surface-50 dark:bg-surface-800\"\n\t\t\t\t\t\t\tdata-widget-id={item.id}\n\t\t\t\t\t\t\tstyle:grid-column=\"span {item.size.w}\"\n\t\t\t\t\t\t\tstyle:grid-row=\"span {item.size.h}\"\n\t\t\t\t\t\t\tstyle:touch-action=\"manipulation\"\n\t\t\t\t\t\t\tstyle:min-height=\"{item.size.h * 180}px\"\n\t\t\t\t\t\t\tanimate:flip={{ duration: 300 }}\n\t\t\t\t\t\t\tonpointerdown={(event) => handleDragStart(event, item, event.currentTarget)}\n\t\t\t\t\t\t\tuse:setupWidgetObserver={[item.id, item.component]}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if !WidgetComponent}\n\t\t\t\t\t\t\t\t<!-- Loading skeleton -->\n\t\t\t\t\t\t\t\t<div class=\"widget-skeleton h-full animate-pulse\">\n\t\t\t\t\t\t\t\t\t<div class=\"mb-2 h-12 rounded-t bg-surface-300 dark:bg-surface-700\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"h-full rounded-b bg-surface-200 p-4 dark:bg-surface-800\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"mb-3 h-8 rounded bg-surface-300 dark:bg-surface-700\"></div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"mb-2 h-6 w-3/4 rounded bg-surface-300 dark:bg-surface-700\"></div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"mb-2 h-6 w-1/2 rounded bg-surface-300 dark:bg-surface-700\"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else if WidgetComponent === null}\n\t\t\t\t\t\t\t\t<!-- Error state -->\n\t\t\t\t\t\t\t\t<div class=\"card preset-ghost-error-500 flex h-full flex-col items-center justify-center p-4\">\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:alert-circle-outline\" width=\"48\" class=\"mb-2 text-error-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t<h3 class=\"h4 mb-2\">Widget Load Error</h3>\n\t\t\t\t\t\t\t\t\t<p class=\"text-sm\">Failed to load: {item.component}</p>\n\t\t\t\t\t\t\t\t\t<button class=\"preset-filled-error-500 btn-sm mt-4\" onclick={() => removeWidget(item.id)}> Remove Widget </button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<!-- Render the actual widget - Svelte 5 dynamic components -->\n\t\t\t\t\t\t\t\t<WidgetComponent\n\t\t\t\t\t\t\t\t\tconfig={item}\n\t\t\t\t\t\t\t\t\tonRemove={() => removeWidget(item.id)}\n\t\t\t\t\t\t\t\t\tonSizeChange={(newSize: WidgetSize) => resizeWidget(item.id, newSize)}\n\t\t\t\t\t\t\t\t\ttheme={currentTheme}\n\t\t\t\t\t\t\t\t\tcurrentUser={data.pageData?.user}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{#if dropIndicator}\n\t\t\t\t\t\t\t\t{@const currentIndex = currentPreferences.findIndex((p: DashboardWidgetConfig) => p.id === item.id)}\n\t\t\t\t\t\t\t\t{@const isDropTarget = dropIndicator.targetIndex === currentIndex}\n\t\t\t\t\t\t\t\t{#if isDropTarget}\n\t\t\t\t\t\t\t\t\t<div class=\"pointer-events-none absolute inset-x-0 top-0 z-20 h-1 bg-primary-500\" style:transform=\"translateY(-50%)\"></div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"mx-auto flex h-[60vh] w-full flex-col items-center justify-center text-center\">\n\t\t\t\t\t<div class=\"flex flex-col items-center px-10 py-12\">\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:view-dashboard-outline\" width=\"80\" class=\"mb-6 text-tertiary-500 drop-shadow-lg dark:text-primary-500\"\n\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t<p class=\"mb-2 text-2xl font-bold text-tertiary-500 dark:text-primary-500\">Your Dashboard is Empty</p>\n\t\t\t\t\t\t<p class=\"mb-6 text-base text-surface-600 dark:text-surface-300\">Click below to add your first widget and get started.</p>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn rounded-full bg-tertiary-500 px-6 py-3 text-lg font-semibold text-white shadow-lg dark:bg-primary-500\"\n\t\t\t\t\t\t\tonclick={() => (dropdownOpen = true)}\n\t\t\t\t\t\t\taria-label=\"Add first widget\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:plus\" width=\"22\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t\t\tAdd Widget\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</section>\n\t</div>\n</main>\n\n<!-- Import/Export Modal -->\n{#if showImportExport}\n\t<div class=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4\">\n\t\t<div class=\"max-h-[90vh] w-full max-w-6xl overflow-hidden rounded-lg bg-surface-50 shadow-xl dark:bg-surface-800\">\n\t\t\t<div class=\"flex items-center justify-between border-b p-6\">\n\t\t\t\t<h3 class=\"text-xl font-semibold\">Data Import & Export</h3>\n\t\t\t\t<button onclick={() => (showImportExport = false)} class=\"preset-ghost btn-sm\" aria-label=\"Close import/export modal\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:close\" class=\"h-5 w-5\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div class=\"max-h-[calc(90vh-140px)] overflow-y-auto p-6\">\n\t\t\t\t<ImportExportManager />\n\t\t\t</div>\n\n\t\t\t<div class=\"flex items-center justify-between border-t bg-surface-100 p-6 dark:bg-surface-700\">\n\t\t\t\t<div class=\"text-sm text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:shield-check\" class=\"mr-1 inline h-4 w-4\"></iconify-icon>\n\t\t\t\t\tYour data is securely managed and never leaves your server\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex space-x-2\">\n\t\t\t\t\t<button onclick={() => (showImportExport = false)} class=\"preset-filled-primary-500 btn\"> Done </button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<style>\n\t.responsive-dashboard-grid {\n\t\tdisplay: grid;\n\t\tgap: 1rem;\n\t\tgrid-template-columns: repeat(4, 1fr);\n\t\tgrid-auto-rows: 180px;\n\t\tgrid-auto-flow: row dense;\n\t\tposition: relative;\n\t}\n</style>\n"],"file":"16.CLoabDNs.js"}