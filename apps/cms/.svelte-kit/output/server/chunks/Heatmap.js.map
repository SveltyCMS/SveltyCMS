{"version":3,"file":"Heatmap.js","sources":["../../../../src/widgets/custom/Seo/components/Heatmap.svelte"],"sourcesContent":["<!--\n@file src/widgets/custom/Seo/components/Heatmap.svelte\n@component\n**Heatmap widget for SEO Widget to manage meta title, description, and robots meta tags**\n\n@example\n<Heatmap content={title + ' ' + description} language={$contentLanguage} keywords={seoKeywords} on:heatmapGenerated={handleHeatmapGenerated} />\n\n#### Props\n- `content` {string} - Content text\n- `language` {string} - Content language\n- `keywords` {string[]} - Array of keywords\n- `on:heatmapGenerated` {function} - Heatmap data handler\n\n#### Features\n- Translatable\n-->\n\n<script lang=\"ts\">\n\timport { debounce } from '@shared/utils/utils';\n\timport { tick } from 'svelte';\n\timport { fade } from 'svelte/transition';\n\n\tinterface HeatmapData {\n\t\theatmapData: Array<{ word: string; heatLevel: number; isKeyword: boolean }>;\n\t\tkeywordDensity: Record<string, number>;\n\t}\n\n\tinterface Props {\n\t\tcontent?: string;\n\t\tlanguage?: string;\n\t\tkeywords?: string[];\n\t\t'on:heatmapGenerated'?: (data: HeatmapData) => void;\n\t}\n\n\t// Props with default values\n\tconst { content = '', language = 'en', keywords = [], 'on:heatmapGenerated': onHeatmapGenerated = () => {} }: Props = $props();\n\n\tlet heatmapData = $state<Array<{ word: string; heatLevel: number; isKeyword: boolean }>>([]);\n\tlet keywordDensity = $state<Record<string, number>>({});\n\n\t// Use global debounce for content analysis\n\tconst debouncedAnalysis = debounce.create(() => {\n\t\tgenerateHeatmap();\n\t}, 300);\n\n\tasync function generateHeatmap() {\n\t\tif (!content) {\n\t\t\theatmapData = [];\n\t\t\tkeywordDensity = {};\n\t\t\tonHeatmapGenerated({ heatmapData, keywordDensity });\n\t\t\treturn;\n\t\t}\n\n\t\tconst words = content.split(/\\s+/);\n\n\t\theatmapData = words.map((word, index) => ({\n\t\t\tword,\n\t\t\theatLevel: calculateHeatLevel(word, index, words.length, language),\n\t\t\tisKeyword: keywords.includes(word.toLowerCase())\n\t\t}));\n\n\t\tanalyzeKeywordDensity(words);\n\t\tonHeatmapGenerated({ heatmapData, keywordDensity });\n\t\tawait tick();\n\t}\n\n\tfunction calculateHeatLevel(word: string, index: number, totalWords: number, lang: string): number {\n\t\tlet score = 0;\n\n\t\t// Position-based scoring\n\t\tconst positionFactor = 1 - index / totalWords;\n\t\tscore += positionFactor * 2;\n\n\t\t// Word length scoring (adjust for different languages)\n\t\tconst idealLength = lang === 'en' ? 5 : 6;\n\t\tscore += Math.max(0, 3 - Math.abs(word.length - idealLength));\n\n\t\t// Keyword bonus\n\t\tif (keywords.includes(word.toLowerCase())) {\n\t\t\tscore += 2;\n\t\t}\n\n\t\t// Normalize score to 1-5 range\n\t\treturn Math.max(1, Math.min(5, Math.round(score)));\n\t}\n\n\tfunction analyzeKeywordDensity(words: string[]) {\n\t\tconst totalWords = words.length;\n\t\tconst result: Record<string, number> = {};\n\n\t\tfor (const keyword of keywords) {\n\t\t\tconst count = words.filter((word) => word.toLowerCase() === keyword.toLowerCase()).length;\n\t\t\tresult[keyword] = (count / totalWords) * 100;\n\t\t}\n\n\t\tkeywordDensity = result;\n\t}\n\n\tfunction getHeatClasses(heatLevel: number): string {\n\t\tconst heatMap = {\n\t\t\t1: 'bg-green-500/20',\n\t\t\t2: 'bg-yellow-500/20',\n\t\t\t3: 'bg-orange-500/20',\n\t\t\t4: 'bg-red-500/20',\n\t\t\t5: 'bg-purple-500/20'\n\t\t};\n\t\treturn heatMap[heatLevel as keyof typeof heatMap] || '';\n\t}\n\n\t// Effect to handle content changes with debounced analysis\n\t$effect(() => {\n\t\t// React to content, language, or keywords changes\n\t\tvoid content;\n\t\tvoid language;\n\t\tvoid keywords;\n\n\t\t// Use the debounced analysis function\n\t\tdebouncedAnalysis();\n\t});\n</script>\n\n<div class=\"wrap-break-word leading-6 max-sm:text-sm max-sm:leading-tight\">\n\t{#if heatmapData.length > 0}\n\t\t{#each heatmapData as { word, heatLevel, isKeyword }}\n\t\t\t<span\n\t\t\t\tclass=\"relative cursor-help {getHeatClasses(heatLevel)} {isKeyword ? 'border-b-2 border-blue-500' : ''} group\"\n\t\t\t\taria-label=\"Heat level {heatLevel}: {word}{isKeyword ? ', keyword' : ''}\"\n\t\t\t\ttransition:fade={{ duration: 200 }}\n\t\t\t>\n\t\t\t\t{word}\n\t\t\t\t<span\n\t\t\t\t\tclass=\"absolute bottom-full left-1/2 hidden -translate-x-1/2 whitespace-nowrap rounded-md bg-gray-800 p-1 text-xs text-white group-hover:block\"\n\t\t\t\t>\n\t\t\t\t\tHeat: {heatLevel}, {isKeyword ? 'Keyword' : 'Regular word'}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t{/each}\n\t{:else}\n\t\t<p>No content available for heatmap.</p>\n\t{/if}\n</div>\n\n<div class=\"mt-5 text-sm max-sm:text-xs\">\n\t<h4>Keyword Density</h4>\n\t{#if Object.keys(keywordDensity).length > 0}\n\t\t<ul>\n\t\t\t{#each Object.entries(keywordDensity) as [keyword, density]}\n\t\t\t\t<li>{keyword}: {density.toFixed(2)}%</li>\n\t\t\t{/each}\n\t\t</ul>\n\t{:else}\n\t\t<p>No keywords provided or no matching keywords found in content.</p>\n\t{/if}\n</div>\n"],"names":["$.stringify","$.attr","$.escape","$$renderer"],"mappings":";;;;wCAkBA;;MAkBS,UAAU;AAAA,MAAI,WAAW;AAAA,MAAM,WAAQ,CAAA;AAAA,MAAO,uBAAuB,qBAAkB,MAAS;AAAA,MAAC;AAAA;QAErG,cAAW,CAAA;QACX,iBAAc,CAAA;AAGQ,aAAS;AAAA,MAAa,MAAA;AAC/C,wBAAe;AAAA,MAChB;AAAA,MAAG;AAAA;AAEY,mBAAA,kBAAkB;AAC3B,UAAA,CAAA,SAAS;AACb,sBAAW,CAAA;AACX,yBAAc,CAAA;AACd,2BAAkB,EAAG,aAAa,gBAAc;;MAEjD;AAEM,YAAA,QAAQ,QAAQ,MAAM,KAAK;AAEjC,oBAAc,MAAM,IAAG,CAAE,MAAM,WAAK;AAAA,QACnC;AAAA,QACA,WAAW,mBAAmB,MAAM,OAAO,MAAM,QAAQ,QAAQ;AAAA,QACjE,WAAW,SAAS,SAAS,KAAK,YAAW,CAAA;AAAA;AAG9C,4BAAsB,KAAK;AAC3B,yBAAkB,EAAG,aAAa,gBAAc;YAC1C,KAAI;AAAA,IACX;aAES,mBAAmB,MAAc,OAAe,YAAoB,MAAsB;AAC9F,UAAA,QAAQ;AAGN,YAAA,iBAAiB,IAAI,QAAQ;AACnC,eAAS,iBAAiB;AAGpB,YAAA,cAAc,SAAS,OAAO,IAAI;AACxC,eAAS,KAAK,IAAI,GAAG,IAAI,KAAK,IAAI,KAAK,SAAS,WAAW,CAAA;AAGvD,UAAA,SAAS,SAAS,KAAK,YAAW,CAAA,GAAK;AAC1C,iBAAS;AAAA,MACV;AAGO,aAAA,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG,KAAK,MAAM,KAAK,CAAA,CAAA;AAAA,IAChD;aAES,sBAAsB,OAAiB;YACzC,aAAa,MAAM;YACnB,SAA8B,CAAA;iBAEzB,WAAW,UAAU;AACzB,cAAA,QAAQ,MAAM,QAAQ,SAAS,KAAK,kBAAkB,QAAQ,YAAW,GAAI;AACnF,eAAO,OAAO,IAAK,QAAQ,aAAc;AAAA,MAC1C;AAEA,uBAAiB;AAAA,IAClB;aAES,eAAe,WAA2B;YAC5C,UAAO;AAAA,QACZ,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA;aAEG,QAAQ,SAAS,KAA6B;AAAA,IACtD;;;;;;MAeK,YAAY,SAAS;AAAA,MAAC;;;2CACnB,WAAW;;cAAM,MAAM,WAAW,UAAU,IAAA,WAAA,OAAA;8EAEpB,eAAe,SAAS,CAAA,CAAA,IAAAA,UAAI,YAAY,+BAA+B,EAAE,CAAA,QAAA,CAAA,GAAAC,KAAA,cAAA,cAAAD,UAC9E,SAAS,CAAA,KAAAA,UAAI,IAAI,CAAA,GAAAA,UAAE,YAAY,cAAc,EAAE,CAAA,EAAA,CAAA,IAAAE,YAGtE,IAAI,CAAA,gKAAAA,YAIG,SAAS,CAAA,KAAAA,YAAI,YAAY,YAAY,cAAc,CAAA,gBAAA;AAAA;;;;;;;AAWzD,QAAA,OAAO,KAAK,cAAc,EAAE,SAAS,GAAC;;;6CAElC,OAAO,QAAQ,cAAc,CAAA;;AAAM,YAAA,CAAA,SAAS,OAAQ,IAAA,aAAA,SAAA;AACrD,QAAAC,YAAA,KAAA,OAAAD,YAAA,OAAO,CAAA,KAAAA,YAAI,QAAQ,QAAQ,CAAC,CAAA,CAAA,QAAA;AAAA;;;;;;;EA5B7B,CAAA;;"}