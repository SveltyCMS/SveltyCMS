{"version":3,"file":"Input6.js","sources":["../../../../src/widgets/core/MegaMenu/Input.svelte"],"sourcesContent":["<!--\n@file src/widgets/core/MegaMenu/Input.svelte\n@component\n**MegaMenu Widget Input Component**\n\nProvides hierarchical menu management with drag-and-drop reordering and modal editing.\nPart of the Three Pillars Architecture for enterp\t\t\t\t</div>\n\n\t\t\t\t{#if item.children.length > 0 && item._expanded !== false}\n\t\t\t\t\t<div class=\"ml-8 space-y-2 border-l-2 border-surface-200 pl-4\">\n\t\t\t\t\t\t{#each item.children as child (child._id)}\n\t\t\t\t\t\t\t<MegaMenuInput bind:value={item.children} {field} {error} />\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>dy widget system.\n\n@example\n<MegaMenuInput bind:value={menuItems} field={fieldDefinition} />\nInteractive menu builder with add/edit/reorder capabilities\n\n### Props\n- `field: FieldType` - Widget field definition with menu structure configuration\n- `value: MenuItem[] | null | undefined` - Array of menu items (bindable)\n- `error?: string | null` - Validation error message for display\n\n### Features\n- **Hierarchical Menu Builder**: Create nested menu structures with unlimited depth\n- **Drag & Drop Reordering**: Visual reordering of menu items with advanced positioning\n- **Modal Editing**: Skeleton Labs modal integration for item editing\n- **UUID Generation**: Automatic unique ID assignment for new menu items\n- **Empty State Handling**: User-friendly message when no items exist\n- **Real-time Updates**: Immediate UI updates with proper reactivity\n- **Error Display**: Accessible error messaging with ARIA attributes\n- **Expand/Collapse**: Visual hierarchy with collapsible sections\n- **Visual Indicators**: Icons and styling for different operations\n-->\n\n<script lang=\"ts\">\n\timport { showModal } from '@shared/utils/modalUtils';\n\timport type { FieldType } from './';\n\timport type { MenuItem, MenuEditContext } from './types';\n\timport { app } from '@shared/stores/store.svelte';\n\timport MegaMenuInput from './Input.svelte';\n\n\tlet { field, value = $bindable(), error }: { field: FieldType; value: MenuItem[] | null | undefined; error?: string | null } = $props();\n\n\t// Initialize the value as an empty array if it's null or undefined.\n\tif (!value) {\n\t\tvalue = [];\n\t}\n\n\t// State for drag and drop\n\tlet draggedItem = $state<any | null>(null);\n\tlet dragOverIndex = $state<number | null>(null);\n\n\t// Function to add a new top-level menu item.\n\tfunction addItem() {\n\t\tvalue = [\n\t\t\t...(value || []),\n\t\t\t{\n\t\t\t\t_id: crypto.randomUUID(),\n\t\t\t\t_fields: {},\n\t\t\t\tchildren: []\n\t\t\t}\n\t\t];\n\t}\n\n\t// Function to handle drag start\n\tfunction handleDragStart(event: DragEvent, item: MenuItem) {\n\t\tdraggedItem = item;\n\t\tevent.dataTransfer!.effectAllowed = 'move';\n\t\tevent.dataTransfer!.setData('text/plain', item._id);\n\t}\n\n\t// Function to handle drag over\n\tfunction handleDragOver(event: DragEvent, index: number) {\n\t\tevent.preventDefault();\n\t\tdragOverIndex = index;\n\t}\n\n\t// Function to handle drop\n\tfunction handleDrop(event: DragEvent, dropIndex: number) {\n\t\tevent.preventDefault();\n\n\t\tif (!draggedItem || !value) return;\n\n\t\tconst draggedIndex = value.findIndex((item) => item._id === draggedItem!._id);\n\t\tif (draggedIndex === -1) return;\n\n\t\t// Remove dragged item from current position\n\t\tconst newValue = [...value];\n\t\tconst [removed] = newValue.splice(draggedIndex, 1);\n\n\t\t// Insert at new position\n\t\tlet insertIndex = dropIndex;\n\t\tif (draggedIndex < dropIndex) {\n\t\t\tinsertIndex--; // Adjust for removed item\n\t\t}\n\n\t\tnewValue.splice(insertIndex, 0, removed);\n\t\tvalue = newValue;\n\n\t\t// Reset drag state\n\t\tdraggedItem = null;\n\t\tdragOverIndex = null;\n\t}\n\n\t// Function to handle drag end\n\tfunction handleDragEnd() {\n\t\tdraggedItem = null;\n\t\tdragOverIndex = null;\n\t}\n\n\t// Function to open edit modal\n\tfunction editItem(item: MenuItem, level: number) {\n\t\tconst modalContext: MenuEditContext = {\n\t\t\titem,\n\t\t\tlevel,\n\t\t\tfields: (field as any).fields?.[level] || [],\n\t\t\tisNew: false,\n\t\t\tparent: undefined,\n\t\t\tonSave: (data: Record<string, any>) => {\n\t\t\t\titem._fields = data;\n\t\t\t\tvalue = [...(value || [])]; // Trigger reactivity\n\t\t\t},\n\t\t\tonCancel: () => {\n\t\t\t\t// Modal closed without saving\n\t\t\t}\n\t\t};\n\n\t\tshowModal({\n\t\t\tcomponent: 'menuItemEditorModal',\n\t\t\tmeta: modalContext\n\t\t});\n\t}\n\n\t// Function to delete an item\n\tfunction deleteItem(itemToDelete: MenuItem) {\n\t\tif (!value) return;\n\n\t\tconst confirmDelete = confirm('Are you sure you want to delete this menu item and all its children?');\n\t\tif (!confirmDelete) return;\n\n\t\tvalue = value.filter((item) => item._id !== itemToDelete._id);\n\t}\n\n\t// Function to add child item\n\tfunction addChildItem(parentItem: MenuItem) {\n\t\tconst newChild: MenuItem = {\n\t\t\t_id: crypto.randomUUID(),\n\t\t\t_fields: {},\n\t\t\tchildren: []\n\t\t};\n\n\t\tparentItem.children = [...(parentItem.children || []), newChild];\n\t\tvalue = [...(value || [])]; // Trigger reactivity\n\t}\n\n\t// Function to toggle expanded state\n\tfunction toggleExpanded(item: MenuItem) {\n\t\titem._expanded = item._expanded === false; // Toggle true/undefined to false, and false to true\n\t\tvalue = [...(value || [])]; // Trigger reactivity\n\t}\n\n\tconst lang = $derived(app.contentLanguage);\n</script>\n\n<div class=\"space-y-4\">\n\t<div class=\"flex items-center justify-between border-b border-surface-200 pb-3 dark:text-surface-50\">\n\t\t<h3 class=\" text-lg font-semibold text-surface-900 dark:text-surface-100\">Menu Structure</h3>\n\t\t<button type=\"button\" class=\"preset-filled-tertiary-500 btn dark:preset-filled-primary-500\" onclick={addItem}>\n\t\t\t<iconify-icon icon=\"mdi:plus\" width=\"16\"></iconify-icon>\n\t\t\tAdd Menu Item\n\t\t</button>\n\t</div>\n\n\t<div\n\t\tclass=\"mmin-h-[200px] space-y-2\"\n\t\tclass:flex={!value || value.length === 0}\n\t\tclass:items-center={!value || value.length === 0}\n\t\tclass:justify-center={!value || value.length === 0}\n\t>\n\t\t{#if value && value.length > 0}\n\t\t\t{#each value as item, index (item._id)}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"rounded-lg border border-surface-200 bg-surface-50/50 transition-all duration-200 dark:text-surface-50 dark:bg-surface-800/50\"\n\t\t\t\t\tclass:scale-95={draggedItem?._id === item._id}\n\t\t\t\t\tclass:opacity-50={draggedItem?._id === item._id}\n\t\t\t\t\tclass:!border-primary-400={dragOverIndex === index}\n\t\t\t\t\tclass:!bg-primary-500={dragOverIndex === index}\n\t\t\t\t\tclass:dark:!border-primary-600={dragOverIndex === index}\n\t\t\t\t\tclass:dark:!bg-primary-900={dragOverIndex === index}\n\t\t\t\t\tdraggable={(field as any).defaults?.enableDragDrop !== false}\n\t\t\t\t\tondragstart={(e) => handleDragStart(e, item)}\n\t\t\t\t\tondragover={(e) => handleDragOver(e, index)}\n\t\t\t\t\tondrop={(e) => handleDrop(e, index)}\n\t\t\t\t\tondragend={handleDragEnd}\n\t\t\t\t\trole=\"listitem\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center gap-3 p-3\">\n\t\t\t\t\t\t<div class=\" flex items-center gap-1\">\n\t\t\t\t\t\t\t{#if (field as any).defaults?.enableDragDrop !== false}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"cursor-move p-1 text-surface-400 transition-colors hover:text-surface-600 dark:text-surface-500 dark:hover:text-surface-300\"\n\t\t\t\t\t\t\t\t\taria-label=\"Drag to reorder\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:drag\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if item.children.length > 0 && (field as any).defaults?.enableExpandCollapse !== false}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclass=\"preset-filled-surface-500 btn\"\n\t\t\t\t\t\t\t\t\tonclick={() => toggleExpanded(item)}\n\t\t\t\t\t\t\t\t\taria-expanded={item._expanded !== false}\n\t\t\t\t\t\t\t\t\taria-label={item._expanded !== false ? 'Collapse children' : 'Expand children'}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\ticon=\"mdi:chevron-down\"\n\t\t\t\t\t\t\t\t\t\twidth=\"16\"\n\t\t\t\t\t\t\t\t\t\tclass=\"chevron transition-transform duration-200\"\n\t\t\t\t\t\t\t\t\t\tclass:-rotate-90={item._expanded === false}\n\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{:else if item.children.length === 0}\n\t\t\t\t\t\t\t\t<div class=\"spacer w-8\"></div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\" min-w-0 flex-1\">\n\t\t\t\t\t\t\t<span class=\" truncate font-medium text-surface-900 dark:text-surface-100\">\n\t\t\t\t\t\t\t\t{(item._fields as any)?.title?.[lang] || (item._fields as any)?.title?.en || 'Untitled Item'}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{#if item.children.length > 0}\n\t\t\t\t\t\t\t\t<span class=\" ml-2 text-xs text-surface-500 dark:text-surface-50\">({item.children.length} children)</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t{#if (field as any).fields && (field as any).fields.length > 1}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclass=\"preset-filled-tertiary-500 btn dark:preset-filled-primary-500\"\n\t\t\t\t\t\t\t\t\tonclick={() => addChildItem(item)}\n\t\t\t\t\t\t\t\t\taria-label=\"Add child item\"\n\t\t\t\t\t\t\t\t\ttitle=\"Add child item\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:plus\" width=\"14\"></iconify-icon>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<button type=\"button\" class=\"abtn preset-filled-surface-500\" onclick={() => editItem(item, 0)} aria-label=\"Edit item\" title=\"Edit item\">\n\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:pencil\" width=\"14\"></iconify-icon>\n\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t<button type=\"button\" class=\"preset-filled-error-500 btn\" onclick={() => deleteItem(item)} aria-label=\"Delete item\" title=\"Delete item\">\n\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:delete\" width=\"14\"></iconify-icon>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if item.children.length > 0 && item._expanded !== false}\n\t\t\t\t\t\t<div class=\"ml-8 border-l-2 border-surface-200 pl-4 dark:text-surface-50\">\n\t\t\t\t\t\t\t<MegaMenuInput bind:value={item.children} {field} {error} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t{:else}\n\t\t\t<div class=\"py-8 text-center\">\n\t\t\t\t<iconify-icon icon=\"mdi:menu\" width=\"48\" class=\"empty-icon mb-4 text-surface-300 dark:text-surface-600\"></iconify-icon>\n\t\t\t\t<p class=\"empty-message text-surface-500 dark:text-surface-50\">No menu items yet. Click \"Add Menu Item\" to get started.</p>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\n\t{#if error}\n\t\t<div\n\t\t\tclass=\"flex items-center gap-2 rounded-lg border border-red-200 bg-red-50 p-3 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300\"\n\t\t\trole=\"alert\"\n\t\t\taria-live=\"polite\"\n\t\t>\n\t\t\t<iconify-icon icon=\"mdi:alert-circle\" width=\"16\"></iconify-icon>\n\t\t\t{error}\n\t\t</div>\n\t{/if}\n</div>\n"],"names":["$.attr","$$renderer","$.attr_class","$.escape"],"mappings":";;;;wCAoCA;UAOO,OAAO,QAAK,QAAgB,MAAK,IAAA;AAGlC,QAAA,CAAA,OAAO;AACX,cAAK,CAAA;AAAA,IACN;AAGI,QAAA,cAAiC;AACjC,QAAA,gBAAsC;UA+GpC,OAAgB,IAAI;;;;;QAcZ,QAAA,CAAA,SAAS,MAAM,WAAW;AAAA,QAClB,gBAAA,CAAA,SAAS,MAAM,WAAW;AAAA,QACxB,kBAAA,CAAA,SAAS,MAAM,WAAW;AAAA;AAE5C,UAAA,SAAS,MAAM,SAAS,GAAC;;;6CACtB,KAAK;;cAAI,OAAI,WAAA,KAAA;;YAGF,YAAA,aAAa,QAAQ,KAAK;AAAA,YACxB,cAAA,aAAa,QAAQ,KAAK;AAAA,YACjB,uBAAA,kBAAkB;AAAA,YACtB,mBAAA,kBAAkB;AAAA,YACT,4BAAA,kBAAkB;AAAA,YACtB,wBAAA,kBAAkB;AAAA,UAClC,CAAA,CAAA,GAAAA,KAAA,aAAA,MAAc,UAAU,mBAAmB,KAAK,CAAA,iGAAA;AASpD,cAAA,MAAc,UAAU,mBAAmB,OAAK;;;;;;;AASjD,cAAA,KAAK,SAAS,SAAS,KAAM,MAAc,UAAU,yBAAyB,OAAK;;AAKvE,YAAAC,YAAA,KAAA,8DAAAD,KAAA,iBAAA,KAAK,cAAc,KAAK,CAAA,GAAAA,KAAA,cAC3B,KAAK,cAAc,QAAQ,sBAAsB,iBAAiB,CAAA,oDAAAE,WAAA,6CAAA,QAAA,EAAA,cAM3D,KAAK,cAAc,MAAK,CAAA,CAAA,2BAAA;AAAA;;AAGnC,gBAAA,KAAK,SAAS,WAAW,GAAC;;;;;;;;AAOjC,UAAAD,YAAA,KAAA,wHAAAE,YAAA,KAAK,SAAiB,QAAQ,IAAI,KAAM,KAAK,SAAiB,OAAO,MAAM,eAAe,CAAA,UAAA;AAExF,cAAA,KAAK,SAAS,SAAS,GAAC;;8GACwC,KAAK,SAAS,MAAM,CAAA,mBAAA;AAAA;;;;cAKnF,MAAc,UAAW,MAAc,OAAO,SAAS,GAAC;;;;;;;cAsB3D,KAAK,SAAS,SAAS,KAAK,KAAK,cAAc,OAAK;;;;cAEZ;AAAA,cAAQ;AAAA;AAAxB,uBAAA,KAAK;AAAA;;AAAL,qBAAK,WAAQ;;;;;;;;;;;;;;;;UAazC,OAAK;;mSAOP,KAAK,CAAA,QAAA;AAAA;;;;;;;;;;;;EAvHD,CAAA;;"}