{"version":3,"file":"imageEditorStore.svelte.js","sources":["../../../../../../shared/stores/src/imageEditorStore.svelte.ts"],"sourcesContent":["/**\n * @file src/stores/imageEditorStore.svelte.ts\n * @description Manages the image editor\n *\n * This provides functionality to:\n * - Undo and redo actions in the image editor\n * - Add edit actions to the image editor\n * - Track image editor state\n * - Update image editor state reactively\n */\n\nimport type Konva from 'konva';\nimport type { Component } from 'svelte';\n\n// Types\nexport interface EditAction {\n\tundo: () => void;\n\tredo: () => void;\n}\n\nexport interface ToolbarControls {\n\tcomponent: Component<any>;\n\tprops: Record<string, any>;\n}\n\nexport interface ImageEditorTool {\n\tid: string;\n\tname: string;\n\ticon: string;\n\tdescription: string;\n}\n\nexport interface ImageEditorState {\n\tfile: File | null;\n\tsaveEditedImage: boolean;\n\teditHistory: EditAction[];\n\tcurrentHistoryIndex: number;\n\tstage: Konva.Stage | null;\n\tlayer: Konva.Layer | null;\n\timageNode: Konva.Image | null;\n\timageGroup: Konva.Group | null;\n\tactiveState: string;\n\tstateHistory: string[];\n\ttoolbarControls: { component: any; props: any } | null;\n\tpreToolSnapshot: string | null;\n\tactions?: {\n\t\tundo?: () => void;\n\t\tredo?: () => void;\n\t\tsave?: () => void;\n\t\tcancel?: () => void;\n\t};\n\terror?: string | null;\n}\n\n// Create image editor store\nfunction createImageEditorStore() {\n\t// State using $state rune\n\tconst state = $state<ImageEditorState>({\n\t\tfile: null,\n\t\tsaveEditedImage: false,\n\t\teditHistory: [],\n\t\tcurrentHistoryIndex: -1,\n\t\tstage: null,\n\t\tlayer: null,\n\t\timageNode: null,\n\t\timageGroup: null,\n\t\tactiveState: '',\n\t\tstateHistory: [],\n\t\ttoolbarControls: null,\n\t\tpreToolSnapshot: null,\n\t\tactions: {},\n\t\terror: null\n\t});\n\n\t// Derived values using $derived rune\n\tconst canUndo = $derived(state.currentHistoryIndex >= 0);\n\tconst canRedo = $derived(state.currentHistoryIndex < state.editHistory.length - 1);\n\tconst hasActiveImage = $derived(!!state.file && !!state.imageNode);\n\tconst canUndoState = $derived(state.stateHistory.length > 1 && state.currentHistoryIndex > 0);\n\tconst canRedoState = $derived(state.currentHistoryIndex < state.stateHistory.length - 1);\n\n\t// Methods to update state\n\tfunction setFile(file: File | null) {\n\t\tstate.file = file;\n\t}\n\n\tfunction setSaveEditedImage(value: boolean) {\n\t\tstate.saveEditedImage = value;\n\t}\n\n\tfunction setStage(stage: Konva.Stage) {\n\t\tstate.stage = stage;\n\t}\n\n\tfunction setLayer(layer: Konva.Layer) {\n\t\tstate.layer = layer;\n\t}\n\n\tfunction setImageNode(imageNode: Konva.Image) {\n\t\tstate.imageNode = imageNode;\n\t}\n\n\tfunction setImageGroup(imageGroup: Konva.Group) {\n\t\tstate.imageGroup = imageGroup;\n\t}\n\n\tfunction setActiveState(newState: string) {\n\t\tconst currentState = state.activeState;\n\t\tif (newState !== '' && newState !== currentState) {\n\t\t\t// Capture revert point\n\t\t\tstate.preToolSnapshot = undoState(true);\n\t\t} else if (newState === '') {\n\t\t\tstate.preToolSnapshot = null;\n\t\t}\n\t\tstate.activeState = newState;\n\t}\n\n\tfunction cancelActiveTool() {\n\t\tconst currentState = state.activeState;\n\t\tif (!currentState) return;\n\n\t\tif (state.preToolSnapshot) {\n\t\t\t// Restore the pre-tool snapshot\n\t\t\t// Note: We don't use undo() because that changes history.\n\t\t\t// We manually restore the state data.\n\t\t\t// This logic is currently partially in Editor.svelte (restoreFromStateData).\n\t\t\t// We'll need to trigger a 'restore' event or similar.\n\t\t}\n\n\t\tcleanupToolSpecific(currentState);\n\t\tsetActiveState('');\n\t\tsetToolbarControls(null);\n\t}\n\n\tfunction setToolbarControls(controls: ToolbarControls | null) {\n\t\tstate.toolbarControls = controls;\n\t}\n\n\tfunction setActions(actions: Partial<NonNullable<ImageEditorState['actions']>>) {\n\t\tstate.actions = { ...state.actions, ...actions };\n\t}\n\n\tfunction setError(error: string | null) {\n\t\tstate.error = error;\n\t}\n\n\tfunction cleanupTempNodes() {\n\t\tif (!state.layer) return;\n\n\t\t// Remove all temporary nodes by name and class\n\t\tconst tempSelectors = [\n\t\t\t'.cropTool',\n\t\t\t'.transformer',\n\t\t\t'.blurTool',\n\t\t\t'.cropOverlayGroup',\n\t\t\t'[name=\"cropTool\"]',\n\t\t\t'[name=\"cropHighlight\"]',\n\t\t\t'[name=\"cropOverlay\"]',\n\t\t\t'.rotationGrid',\n\t\t\t'.gridLayer',\n\t\t\t'.blurRegion',\n\t\t\t'.mosaicOverlay',\n\t\t\t'[name=\"watermark\"]',\n\t\t\t'[name=\"watermarkTransformer\"]'\n\t\t];\n\t\ttempSelectors.forEach((selector) => {\n\t\t\tstate.layer!.find(selector).forEach((node) => {\n\t\t\t\ttry {\n\t\t\t\t\tnode.destroy();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Error destroying node:', e);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Remove all transformers EXCEPT the annotation transformer\n\t\tstate.layer.find('Transformer').forEach((node) => {\n\t\t\t// Keep the annotation transformer alive\n\t\t\tif (node.name() === 'annotationTransformer') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tnode.destroy();\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Error destroying transformer:', e);\n\t\t\t}\n\t\t});\n\n\t\t// Remove any image overlays that might be from blur tool\n\t\tstate.layer.find('Image').forEach((node) => {\n\t\t\t// Only remove overlay images, not the main image node\n\t\t\tif (node !== state.imageNode) {\n\t\t\t\ttry {\n\t\t\t\t\tnode.destroy();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Error destroying overlay image:', e);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove any temporary groups\n\t\tstate.layer.find('Group').forEach((node) => {\n\t\t\t// Check if it's a temporary overlay group\n\t\t\tif (node.name() === 'cropOverlayGroup' || node.name().includes('temp')) {\n\t\t\t\ttry {\n\t\t\t\t\tnode.destroy();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Error destroying temporary group:', e);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Clear any caches to prevent ghosting\n\t\tstate.layer.clearCache();\n\t\tstate.layer.batchDraw();\n\t}\n\n\tfunction cleanupToolSpecific(toolName: string) {\n\t\tif (!state.layer) return;\n\n\t\tswitch (toolName) {\n\t\t\tcase 'crop':\n\t\t\t\t// Clean up crop-specific elements\n\t\t\t\tstate.layer.find('.cropTool').forEach((node) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('Error destroying crop tool:', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstate.layer.find('.cropOverlayGroup').forEach((node) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('Error destroying crop overlay group:', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstate.layer.find('[name=\"cropHighlight\"]').forEach((node) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('Error destroying crop highlight:', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase 'blur':\n\t\t\t\t// Clean up blur-specific elements\n\t\t\t\tstate.layer.find('.blurRegion').forEach((node) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('Error destroying blur region:', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstate.layer.find('.mosaicOverlay').forEach((node) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('Error destroying mosaic overlay:', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// Remove any temporary images created by blur tool\n\t\t\t\tstate.layer.find('Image').forEach((node) => {\n\t\t\t\t\t// Only remove overlay images, not the main image node\n\t\t\t\t\tif (node !== state.imageNode) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.warn('Error destroying blur overlay image:', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'watermark':\n\t\t\t\t// Clean up watermark-specific elements\n\t\t\t\tstate.layer.find('[name=\"watermark\"]').forEach((node) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('Error destroying watermark:', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstate.layer.find('[name=\"watermarkTransformer\"]').forEach((node) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnode.destroy();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('Error destroying watermark transformer:', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Always clean up transformers EXCEPT the annotation transformer\n\t\tstate.layer.find('Transformer').forEach((node) => {\n\t\t\t// Keep the annotation transformer alive\n\t\t\tif (node.name() === 'annotationTransformer') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tnode.destroy();\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Error destroying transformer:', e);\n\t\t\t}\n\t\t});\n\n\t\t// Clear cache and redraw\n\t\tstate.layer.clearCache();\n\t\tstate.layer.batchDraw();\n\t}\n\n\tfunction saveToolState() {\n\t\t// Take a snapshot before switching tools to preserve the current state\n\t\tif (state.stage) {\n\t\t\ttakeSnapshot();\n\t\t}\n\t}\n\n\t/**\n\t * Proactively hides all UI elements (handles, toolbars, grids)\n\t * before a high-resolution export or save.\n\t */\n\tfunction hideAllUI() {\n\t\tif (!state.stage) return;\n\n\t\tconst uiItems = state.stage.find((node: any) => {\n\t\t\tconst className = node.className;\n\t\t\tconst name = node.name() || '';\n\t\t\treturn (\n\t\t\t\tclassName === 'Transformer' ||\n\t\t\t\tname.includes('toolbar') ||\n\t\t\t\tname.includes('Overlay') ||\n\t\t\t\tname.includes('Grid') ||\n\t\t\t\tname.includes('cropTool') || // Specific for crop\n\t\t\t\tname.includes('cropCut')\n\t\t\t);\n\t\t});\n\n\t\tuiItems.forEach((item) => {\n\t\t\titem.visible(false);\n\t\t});\n\n\t\tif (state.layer) state.layer.batchDraw();\n\t\tstate.stage.batchDraw();\n\t}\n\n\tfunction takeSnapshot() {\n\t\tif (!state.stage) return;\n\n\t\t// Force a redraw to ensure the current state is captured\n\t\tif (state.layer) {\n\t\t\tstate.layer.batchDraw();\n\t\t}\n\n\t\t// Save current canvas state to history\n\t\t// We use a custom object to store extra data if needed\n\t\tconst snapshot = {\n\t\t\tstage: state.stage.toJSON(),\n\t\t\tactiveState: state.activeState,\n\t\t\ttimestamp: Date.now()\n\t\t};\n\n\t\tsaveStateHistory(JSON.stringify(snapshot));\n\t}\n\n\tfunction addEditAction(action: EditAction) {\n\t\t// Remove any redoable actions after current index\n\t\tstate.editHistory = state.editHistory.slice(0, state.currentHistoryIndex + 1);\n\t\t// Add new action\n\t\tstate.editHistory.push(action);\n\t\t// Update current index\n\t\tstate.currentHistoryIndex = state.editHistory.length - 1;\n\t}\n\n\tfunction saveStateHistory(stateData: string) {\n\t\t// If we're not at the end of history, truncate it\n\t\tif (state.currentHistoryIndex < state.stateHistory.length - 1) {\n\t\t\tstate.stateHistory = state.stateHistory.slice(0, state.currentHistoryIndex + 1);\n\t\t}\n\n\t\tstate.stateHistory.push(stateData);\n\t\tstate.currentHistoryIndex = state.stateHistory.length - 1;\n\t}\n\n\tfunction undo() {\n\t\tif (state.currentHistoryIndex >= 0) {\n\t\t\tstate.editHistory[state.currentHistoryIndex].undo();\n\t\t\tstate.currentHistoryIndex--;\n\t\t}\n\t}\n\n\tfunction redo() {\n\t\tif (state.currentHistoryIndex < state.editHistory.length - 1) {\n\t\t\tstate.currentHistoryIndex++;\n\t\t\tstate.editHistory[state.currentHistoryIndex].redo();\n\t\t}\n\t}\n\n\tfunction undoState(peek = false): string | null {\n\t\t// If not peeking, we need to ensure there's a previous state to go back to.\n\t\t// If peeking, we just need to ensure there's a current state to read.\n\t\tif (!peek && !canUndoState) {\n\t\t\treturn null;\n\t\t}\n\t\tif (peek && state.currentHistoryIndex < 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet targetIndex = state.currentHistoryIndex;\n\t\tif (!peek) {\n\t\t\ttargetIndex--;\n\t\t\tstate.currentHistoryIndex = targetIndex; // Update the actual history index\n\t\t}\n\n\t\tif (targetIndex < 0 || targetIndex >= state.stateHistory.length) {\n\t\t\treturn null; // Should not happen if checks above are correct, but as a safeguard\n\t\t}\n\n\t\tconst stateData = state.stateHistory[targetIndex];\n\t\treturn stateData;\n\t}\n\n\tfunction redoState(): string | null {\n\t\tif (!canRedoState) return null;\n\t\tstate.currentHistoryIndex++;\n\t\tconst stateData = state.stateHistory[state.currentHistoryIndex];\n\t\treturn stateData;\n\t}\n\n\tfunction clearHistory() {\n\t\tstate.editHistory = [];\n\t\tstate.currentHistoryIndex = -1;\n\t\tstate.stateHistory = [];\n\t}\n\n\tfunction reset() {\n\t\tstate.file = null;\n\t\tstate.saveEditedImage = false;\n\t\tstate.editHistory = [];\n\t\tstate.currentHistoryIndex = -1;\n\t\tstate.stage = null;\n\t\tstate.layer = null;\n\t\tstate.imageNode = null;\n\t\tstate.imageGroup = null;\n\t\tstate.activeState = '';\n\t\tstate.stateHistory = [];\n\t}\n\n\treturn {\n\t\tget state() {\n\t\t\treturn state;\n\t\t},\n\t\tget canUndo() {\n\t\t\treturn canUndo;\n\t\t},\n\t\tget canRedo() {\n\t\t\treturn canRedo;\n\t\t},\n\t\tget hasActiveImage() {\n\t\t\treturn hasActiveImage;\n\t\t},\n\t\tget canUndoState() {\n\t\t\treturn canUndoState;\n\t\t},\n\t\tget canRedoState() {\n\t\t\treturn canRedoState;\n\t\t},\n\t\treset,\n\t\tsetStage,\n\t\tsetLayer,\n\t\tsetImageNode,\n\t\tsetImageGroup,\n\t\tsetFile,\n\t\tsetActiveState,\n\t\tsetToolbarControls,\n\t\tsetError,\n\t\tsetActions,\n\t\tcleanupTempNodes,\n\t\thideAllUI,\n\t\ttakeSnapshot,\n\t\taddEditAction,\n\t\tsaveToolState,\n\t\tcleanupToolSpecific,\n\t\tcancelActiveTool,\n\t\tundoState: (peek?: boolean) => undoState(peek),\n\t\tredoState,\n\t\tclearHistory,\n\t\tsetSaveEditedImage,\n\t\thandleUndo: () => undo(),\n\t\thandleRedo: () => redo()\n\t};\n}\n\n// Create and export the store instance\nexport const imageEditorStore = createImageEditorStore();\n"],"names":[],"mappings":";AAuDS,SAAA,yBAAyB;QAE3B;IACL,MAAM;AAAA,IACN,iBAAiB;AAAA,IACjB;IACA;IACA,OAAO;AAAA,IACP,OAAO;AAAA,IACP,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,aAAa;AAAA,IACb;IACA,iBAAiB;AAAA,IACjB,iBAAiB;AAAA,IACjB;IACA,OAAO;AAAA;AAIF,QAAA,UAAmB,MAAM,uBAAuB;QAChD,UAAmB,MAAM,sBAAsB,MAAM,YAAY,SAAS;AAC1E,QAAA,mBAA4B,MAAM,QAAA,CAAA,CAAU,MAAM;AAClD,QAAA,eAAwB,MAAM,aAAa,SAAS,KAAK,MAAM,sBAAsB;QACrF,eAAwB,MAAM,sBAAsB,MAAM,aAAa,SAAS;WAG7E,QAAQ,MAAmB;AACnC,UAAM,OAAO;AAAA,EACd;WAES,mBAAmB,OAAgB;AAC3C,UAAM,kBAAkB;AAAA,EACzB;WAES,SAAS,OAAoB;AACrC,UAAM,QAAQ;AAAA,EACf;WAES,SAAS,OAAoB;AACrC,UAAM,QAAQ;AAAA,EACf;WAES,aAAa,WAAwB;AAC7C,UAAM,YAAY;AAAA,EACnB;WAES,cAAc,YAAyB;AAC/C,UAAM,aAAa;AAAA,EACpB;WAES,eAAe,UAAkB;UACnC,eAAe,MAAM;AACvB,QAAA,aAAa,MAAM,aAAa,cAAc;AAEjD,YAAM,kBAAkB,UAAU,IAAI;AAAA,IACvC,WAAW,aAAa,IAAI;AAC3B,YAAM,kBAAkB;AAAA,IACzB;AACA,UAAM,cAAc;AAAA,EACrB;AAES,WAAA,mBAAmB;UACrB,eAAe,MAAM;SACtB,aAAA;AAUL,wBAAoB,YAAY;AAChC,mBAAe,EAAE;AACjB,uBAAmB,IAAI;AAAA,EACxB;WAES,mBAAmB,UAAkC;AAC7D,UAAM,kBAAkB;AAAA,EACzB;WAES,WAAW,SAA4D;AAC/E,UAAM,eAAe,MAAM,YAAY,QAAA;AAAA,EACxC;WAES,SAAS,OAAsB;AACvC,UAAM,QAAQ;AAAA,EACf;AAES,WAAA,mBAAmB;AACtB,QAAA,CAAA,MAAM,MAAA;UAGL,gBAAA;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAED,kBAAc,QAAA,CAAS,aAAa;AACnC,YAAM,MAAO,KAAK,QAAQ,EAAE,QAAA,CAAS,SAAS;YACzC;AACH,eAAK,QAAA;AAAA,QACN,SAAS,GAAG;AACX,kBAAQ,KAAK,0BAA0B,CAAC;AAAA,QACzC;AAAA,MACD,CAAC;AAAA,IACF,CAAC;AAGD,UAAM,MAAM,KAAK,aAAa,EAAE,QAAA,CAAS,SAAS;AAE7C,UAAA,KAAK,KAAA,MAAW,yBAAyB;;MAE7C;UACI;AACH,aAAK,QAAA;AAAA,MACN,SAAS,GAAG;AACX,gBAAQ,KAAK,iCAAiC,CAAC;AAAA,MAChD;AAAA,IACD,CAAC;AAGD,UAAM,MAAM,KAAK,OAAO,EAAE,QAAA,CAAS,SAAS;AAEvC,UAAA,SAAS,MAAM,WAAW;YACzB;AACH,eAAK,QAAA;AAAA,QACN,SAAS,GAAG;AACX,kBAAQ,KAAK,mCAAmC,CAAC;AAAA,QAClD;AAAA,MACD;AAAA,IACD,CAAC;AAGD,UAAM,MAAM,KAAK,OAAO,EAAE,QAAA,CAAS,SAAS;AAEvC,UAAA,KAAK,WAAW,sBAAsB,KAAK,KAAA,EAAO,SAAS,MAAM,GAAG;YACnE;AACH,eAAK,QAAA;AAAA,QACN,SAAS,GAAG;AACX,kBAAQ,KAAK,qCAAqC,CAAC;AAAA,QACpD;AAAA,MACD;AAAA,IACD,CAAC;AAGD,UAAM,MAAM,WAAA;AACZ,UAAM,MAAM,UAAA;AAAA,EACb;WAES,oBAAoB,UAAkB;AACzC,QAAA,CAAA,MAAM,MAAA;YAEH,UAAA;AAAA,WACF;AAEJ,cAAM,MAAM,KAAK,WAAW,EAAE,QAAA,CAAS,SAAS;cAC3C;AACH,iBAAK,QAAA;AAAA,UACN,SAAS,GAAG;AACX,oBAAQ,KAAK,+BAA+B,CAAC;AAAA,UAC9C;AAAA,QACD,CAAC;AACD,cAAM,MAAM,KAAK,mBAAmB,EAAE,QAAA,CAAS,SAAS;cACnD;AACH,iBAAK,QAAA;AAAA,UACN,SAAS,GAAG;AACX,oBAAQ,KAAK,wCAAwC,CAAC;AAAA,UACvD;AAAA,QACD,CAAC;AACD,cAAM,MAAM,KAAK,wBAAwB,EAAE,QAAA,CAAS,SAAS;cACxD;AACH,iBAAK,QAAA;AAAA,UACN,SAAS,GAAG;AACX,oBAAQ,KAAK,oCAAoC,CAAC;AAAA,UACnD;AAAA,QACD,CAAC;;WAGG;AAEJ,cAAM,MAAM,KAAK,aAAa,EAAE,QAAA,CAAS,SAAS;cAC7C;AACH,iBAAK,QAAA;AAAA,UACN,SAAS,GAAG;AACX,oBAAQ,KAAK,iCAAiC,CAAC;AAAA,UAChD;AAAA,QACD,CAAC;AACD,cAAM,MAAM,KAAK,gBAAgB,EAAE,QAAA,CAAS,SAAS;cAChD;AACH,iBAAK,QAAA;AAAA,UACN,SAAS,GAAG;AACX,oBAAQ,KAAK,oCAAoC,CAAC;AAAA,UACnD;AAAA,QACD,CAAC;AAED,cAAM,MAAM,KAAK,OAAO,EAAE,QAAA,CAAS,SAAS;AAEvC,cAAA,SAAS,MAAM,WAAW;gBACzB;AACH,mBAAK,QAAA;AAAA,YACN,SAAS,GAAG;AACX,sBAAQ,KAAK,wCAAwC,CAAC;AAAA,YACvD;AAAA,UACD;AAAA,QACD,CAAC;;WAKG;AAEJ,cAAM,MAAM,KAAK,oBAAoB,EAAE,QAAA,CAAS,SAAS;cACpD;AACH,iBAAK,QAAA;AAAA,UACN,SAAS,GAAG;AACX,oBAAQ,KAAK,+BAA+B,CAAC;AAAA,UAC9C;AAAA,QACD,CAAC;AACD,cAAM,MAAM,KAAK,+BAA+B,EAAE,QAAA,CAAS,SAAS;cAC/D;AACH,iBAAK,QAAA;AAAA,UACN,SAAS,GAAG;AACX,oBAAQ,KAAK,2CAA2C,CAAC;AAAA,UAC1D;AAAA,QACD,CAAC;;;AAKH,UAAM,MAAM,KAAK,aAAa,EAAE,QAAA,CAAS,SAAS;AAE7C,UAAA,KAAK,KAAA,MAAW,yBAAyB;;MAE7C;UACI;AACH,aAAK,QAAA;AAAA,MACN,SAAS,GAAG;AACX,gBAAQ,KAAK,iCAAiC,CAAC;AAAA,MAChD;AAAA,IACD,CAAC;AAGD,UAAM,MAAM,WAAA;AACZ,UAAM,MAAM,UAAA;AAAA,EACb;AAES,WAAA,gBAAgB;QAEpB,MAAM,OAAO;AAChB,mBAAA;AAAA,IACD;AAAA,EACD;AAMS,WAAA,YAAY;AACf,QAAA,CAAA,MAAM,MAAA;UAEL,UAAU,MAAM,MAAM,KAAA,CAAM,SAAc;YACzC,YAAY,KAAK;AACjB,YAAA,OAAO,KAAK,KAAA,KAAU;aAE3B,cAAc,iBACd,KAAK,SAAS,SAAS,KACvB,KAAK,SAAS,SAAS,KACvB,KAAK,SAAS,MAAM,KACpB,KAAK,SAAS,UAAU;AAAA,MACxB,KAAK,SAAS,SAAS;AAAA,IAEzB,CAAC;AAED,YAAQ,QAAA,CAAS,SAAS;AACzB,WAAK,QAAQ,KAAK;AAAA,IACnB,CAAC;AAEG,QAAA,MAAM,MAAO,OAAM,MAAM,UAAA;AAC7B,UAAM,MAAM,UAAA;AAAA,EACb;AAES,WAAA,eAAe;AAClB,QAAA,CAAA,MAAM,MAAA;QAGP,MAAM,OAAO;AAChB,YAAM,MAAM,UAAA;AAAA,IACb;UAIM,WAAA;AAAA,MACL,OAAO,MAAM,MAAM,OAAA;AAAA,MACnB,aAAa,MAAM;AAAA,MACnB,WAAW,KAAK,IAAA;AAAA;AAGjB,qBAAiB,KAAK,UAAU,QAAQ,CAAA;AAAA,EACzC;WAES,cAAc,QAAoB;AAE1C,UAAM,cAAc,MAAM,YAAY,MAAM,GAAG,MAAM,sBAAsB,CAAC;AAE5E,UAAM,YAAY,KAAK,MAAM;AAE7B,UAAM,sBAAsB,MAAM,YAAY,SAAS;AAAA,EACxD;WAES,iBAAiB,WAAmB;QAExC,MAAM,sBAAsB,MAAM,aAAa,SAAS,GAAG;AAC9D,YAAM,eAAe,MAAM,aAAa,MAAM,GAAG,MAAM,sBAAsB,CAAC;AAAA,IAC/E;AAEA,UAAM,aAAa,KAAK,SAAS;AACjC,UAAM,sBAAsB,MAAM,aAAa,SAAS;AAAA,EACzD;AAES,WAAA,OAAO;AACX,QAAA,MAAM,uBAAuB,GAAG;AACnC,YAAM,YAAY,MAAM,mBAAmB,EAAE,KAAA;AAC7C,YAAM;AAAA,IACP;AAAA,EACD;AAES,WAAA,OAAO;QACX,MAAM,sBAAsB,MAAM,YAAY,SAAS,GAAG;AAC7D,YAAM;AACN,YAAM,YAAY,MAAM,mBAAmB,EAAE,KAAA;AAAA,IAC9C;AAAA,EACD;AAES,WAAA,UAAU,OAAO,OAAsB;SAG1C,QAAA,CAAS,cAAc;aACpB;AAAA,IACR;AACI,QAAA,QAAQ,MAAM,sBAAsB,GAAG;aACnC;AAAA,IACR;QAEI,cAAc,MAAM;AACnB,QAAA,CAAA,MAAM;AACV;AACA,YAAM,sBAAsB;AAAA,IAC7B;QAEI,cAAc,KAAK,eAAe,MAAM,aAAa,QAAQ;aACzD;AAAA,IACR;AAEM,UAAA,YAAY,MAAM,aAAa,WAAW;WACzC;AAAA,EACR;AAES,WAAA,YAA2B;AAC9B,QAAA,CAAA,qBAAqB;AAC1B,UAAM;AACA,UAAA,YAAY,MAAM,aAAa,MAAM,mBAAmB;WACvD;AAAA,EACR;AAES,WAAA,eAAe;AACvB,UAAM;AACN,UAAM,sBAAA;AACN,UAAM;EACP;AAES,WAAA,QAAQ;AAChB,UAAM,OAAO;AACb,UAAM,kBAAkB;AACxB,UAAM;AACN,UAAM,sBAAA;AACN,UAAM,QAAQ;AACd,UAAM,QAAQ;AACd,UAAM,YAAY;AAClB,UAAM,aAAa;AACnB,UAAM,cAAc;AACpB,UAAM;EACP;;IAGK,IAAA,QAAQ;aACJ;AAAA,IACR;AAAA,IACI,IAAA,UAAU;aACN;AAAA,IACR;AAAA,IACI,IAAA,UAAU;aACN;AAAA,IACR;AAAA,IACI,IAAA,iBAAiB;aACb;AAAA,IACR;AAAA,IACI,IAAA,eAAe;aACX;AAAA,IACR;AAAA,IACI,IAAA,eAAe;aACX;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,WAAA,CAAY,SAAmB,UAAU,IAAI;AAAA,IAC7C;AAAA,IACA;AAAA,IACA;AAAA,IACA,kBAAkB,KAAA;AAAA,IAClB,kBAAkB,KAAA;AAAA;AAEpB;AAGa,MAAA,mBAAmB,uBAAA;"}