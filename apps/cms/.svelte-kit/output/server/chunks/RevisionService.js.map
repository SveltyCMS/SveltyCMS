{"version":3,"file":"RevisionService.js","sources":["../../../../../../shared/services/src/RevisionService.ts"],"sourcesContent":["import { getPrivateSettingSync } from '@shared/services/settingsService';\nimport type { DatabaseId } from '@shared/database/dbInterface';\n\ninterface Collection {\n\t_id: string;\n\trevision?: boolean;\n\t[key: string]: any;\n}\n\n// Shared logic for retrieving revisions\nexport async function getRevisions({\n\tcollection,\n\tentryId,\n\ttenantId,\n\tdbAdapter,\n\tpage = 1,\n\tlimit = 10\n}: {\n\tcollection: Collection;\n\tentryId: string;\n\ttenantId: string;\n\tdbAdapter: any;\n\tpage?: number;\n\tlimit?: number;\n}) {\n\tif (!collection) {\n\t\treturn { success: false, error: { message: 'Collection is required' } };\n\t}\n\n\t// --- MULTI-TENANCY SECURITY CHECK ---\n\tif (getPrivateSettingSync('MULTI_TENANT')) {\n\t\tconst collectionName = `collection_${collection._id}`;\n\t\tconst entryResult = await dbAdapter.crud.findMany(collectionName, { _id: entryId, tenantId } as Record<string, unknown>);\n\t\tif (!entryResult.success || !entryResult.data || entryResult.data.length === 0) {\n\t\t\treturn { success: false, error: { message: 'Entry not found' } };\n\t\t}\n\t}\n\n\tconst revisionResult = await dbAdapter.content.revisions.getHistory(entryId as unknown as DatabaseId, {\n\t\tpage,\n\t\tpageSize: limit\n\t});\n\n\treturn revisionResult;\n}\n"],"names":[],"mappings":";AAUA,eAAsB,aAAa;AAAA,EAClC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,OAAO;AAAA,EACP,QAAQ;AACT,GAOG;AACF,MAAI,CAAC,YAAY;AAChB,WAAO,EAAE,SAAS,OAAO,OAAO,EAAE,SAAS,2BAAyB;AAAA,EACrE;AAGA,MAAI,sBAAsB,cAAc,GAAG;AAC1C,UAAM,iBAAiB,cAAc,WAAW,GAAG;AACnD,UAAM,cAAc,MAAM,UAAU,KAAK,SAAS,gBAAgB,EAAE,KAAK,SAAS,UAAqC;AACvH,QAAI,CAAC,YAAY,WAAW,CAAC,YAAY,QAAQ,YAAY,KAAK,WAAW,GAAG;AAC/E,aAAO,EAAE,SAAS,OAAO,OAAO,EAAE,SAAS,oBAAkB;AAAA,IAC9D;AAAA,EACD;AAEA,QAAM,iBAAiB,MAAM,UAAU,QAAQ,UAAU,WAAW,SAAkC;AAAA,IACrG;AAAA,IACA,UAAU;AAAA,EAAA,CACV;AAED,SAAO;AACR;"}