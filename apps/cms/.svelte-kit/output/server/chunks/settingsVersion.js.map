{"version":3,"file":"settingsVersion.js","sources":["../../../../../../shared/utils/src/server/settingsVersion.ts"],"sourcesContent":["/**\n * @file src/utils/server/settingsVersion.ts\n * @description Settings change notification system using Server-Sent Events\n *\n * When settings are updated in the database, this broadcasts the change\n * to all connected clients via SSE for instant UI updates.\n */\n\nimport { logger } from '@shared/utils/logger.server';\n\nlet currentVersion = 0;\ntype VersionListener = (version: number) => void;\nconst listeners = new Set<VersionListener>();\n\n/**\n * Increment the settings version and notify all connected clients.\n * Should be called whenever settings are updated in the database.\n */\nexport function updateVersion(): void {\n\tcurrentVersion++;\n\t// Notify all SSE listeners\n\tlisteners.forEach((listener) => {\n\t\ttry {\n\t\t\tlistener(currentVersion);\n\t\t} catch (error) {\n\t\t\tlogger.error('Error notifying settings listener:', error);\n\t\t}\n\t});\n}\n\n/**\n * Subscribe to settings changes for real-time notifications.\n * Used by SSE endpoint to push updates to connected clients.\n * @param listener Callback function that receives the new version number\n * @returns Unsubscribe function\n */\nexport function subscribeToSettingsChanges(listener: VersionListener): () => void {\n\tlisteners.add(listener);\n\treturn () => listeners.delete(listener);\n}\n"],"names":[],"mappings":";AAUA,IAAI,iBAAiB;AAErB,MAAM,gCAAgB,IAAA;AAMf,SAAS,gBAAsB;AACrC;AAEA,YAAU,QAAQ,CAAC,aAAa;AAC/B,QAAI;AACH,eAAS,cAAc;AAAA,IACxB,SAAS,OAAO;AACf,aAAO,MAAM,sCAAsC,KAAK;AAAA,IACzD;AAAA,EACD,CAAC;AACF;AAQO,SAAS,2BAA2B,UAAuC;AACjF,YAAU,IAAI,QAAQ;AACtB,SAAO,MAAM,UAAU,OAAO,QAAQ;AACvC;"}