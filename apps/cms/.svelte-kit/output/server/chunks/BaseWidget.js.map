{"version":3,"file":"BaseWidget.js","sources":["../../../../../../shared/features/src/dashboard/BaseWidget.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/dashboard/BaseWidget.svelte\n@component\n**Base widget**\n\nNew Features:\n- Manual refresh with loading state\n- Client-side caching with TTL\n- Automatic retry with exponential backoff\n- Last update timestamp\n- Enhanced error handling\n- All features opt-in and backward compatible\n-->\n<script lang=\"ts\">\n\timport { logger } from '@shared/utils/logger';\n\timport type { WidgetSize } from '@cms-types';\n\texport type { WidgetSize };\n\n\ttype Snippet<T = any> = (args: T) => any;\n\n\ttype ChildSnippetProps = {\n\t\tdata: any;\n\t\tupdateWidgetState: (key: string, value: any) => void;\n\t\tgetWidgetState: (key: string) => any;\n\t\trefresh?: () => Promise<void>;\n\t\tisLoading?: boolean;\n\t\terror?: string | null;\n\t};\n\n\tconst {\n\t\tlabel = 'Widget',\n\t\ttheme = 'light',\n\t\ticon = undefined,\n\t\tendpoint = undefined,\n\t\tpollInterval = 0,\n\t\twidgetId = undefined,\n\t\tchildren = undefined as Snippet<ChildSnippetProps> | undefined,\n\t\tsize = { w: 1, h: 1 } as WidgetSize,\n\t\tonSizeChange = (_newSize: WidgetSize) => {},\n\t\tresizable = true,\n\t\tonCloseRequest = () => {},\n\t\tinitialData: passedInitialData = undefined,\n\t\tonDataLoaded = (_fetchedData: any) => {},\n\t\t// Enhanced features (all optional)\n\t\tshowRefreshButton = false,\n\t\tcacheKey = undefined as string | undefined,\n\t\tcacheTTL = 300000,\n\t\tretryCount = 3,\n\t\tretryDelay = 1000\n\t} = $props<{\n\t\tlabel: string;\n\t\ttheme?: 'light' | 'dark';\n\t\ticon?: string;\n\t\tendpoint?: string;\n\t\tpollInterval?: number;\n\t\twidgetId?: string;\n\t\tchildren?: Snippet<ChildSnippetProps>;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tresizable?: boolean;\n\t\tonCloseRequest?: () => void;\n\t\tinitialData?: any;\n\t\tonDataLoaded?: (fetchedData: any) => void;\n\t\tshowRefreshButton?: boolean;\n\t\tcacheKey?: string;\n\t\tcacheTTL?: number;\n\t\tretryCount?: number;\n\t\tretryDelay?: number;\n\t\t[key: string]: any;\n\t}>();\n\n\tlet widgetState = $state<Record<string, any>>({});\n\tlet loading = $state(false);\n\tlet error = $state<string | null>(null);\n\tlet internalData = $state(undefined);\n\tlet lastFetchTime = $state<number>(0);\n\tlet currentRetry = $state(0);\n\n\t$effect(() => {\n\t\tif (passedInitialData !== undefined) {\n\t\t\tinternalData = passedInitialData;\n\t\t}\n\t});\n\n\t// Cache management (localStorage)\n\tfunction getCachedData(): any | null {\n\t\tif (!cacheKey || typeof window === 'undefined') return null;\n\t\ttry {\n\t\t\tconst cached = localStorage.getItem(`widget_cache_${cacheKey}`);\n\t\t\tif (!cached) return null;\n\n\t\t\tconst { data, timestamp } = JSON.parse(cached);\n\t\t\tif (Date.now() - timestamp > cacheTTL) {\n\t\t\t\tlocalStorage.removeItem(`widget_cache_${cacheKey}`);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn data;\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tfunction setCachedData(data: any) {\n\t\tif (!cacheKey || typeof window === 'undefined') return;\n\t\ttry {\n\t\t\tlocalStorage.setItem(\n\t\t\t\t`widget_cache_${cacheKey}`,\n\t\t\t\tJSON.stringify({\n\t\t\t\t\tdata,\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t})\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tlogger.warn(`Failed to cache widget data for ${label}:`, err);\n\t\t}\n\t}\n\n\t// Enhanced fetch with retry logic\n\tasync function fetchData(retryAttempt = 0): Promise<void> {\n\t\tif (!endpoint) {\n\t\t\tloading = false;\n\t\t\treturn;\n\t\t}\n\n\t\t// Check cache first on initial load\n\t\tif (retryAttempt === 0) {\n\t\t\tconst cached = getCachedData();\n\t\t\tif (cached) {\n\t\t\t\tinternalData = cached;\n\t\t\t\tonDataLoaded(cached);\n\t\t\t\tloading = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tloading = true;\n\t\terror = null;\n\t\tcurrentRetry = retryAttempt;\n\n\t\ttry {\n\t\t\t// Add cache-busting param, use & if endpoint already has query params\n\t\t\tconst separator = endpoint.includes('?') ? '&' : '?';\n\t\t\tconst res = await fetch(`${endpoint}${separator}_=${Date.now()}`);\n\t\t\tif (!res.ok) {\n\t\t\t\tthrow new Error(`HTTP ${res.status}: ${res.statusText}`);\n\t\t\t}\n\n\t\t\tconst newData = await res.json();\n\t\t\tinternalData = newData;\n\t\t\tlastFetchTime = Date.now();\n\t\t\tonDataLoaded(newData);\n\t\t\tsetCachedData(newData);\n\t\t\tcurrentRetry = 0;\n\t\t\terror = null;\n\t\t} catch (err) {\n\t\t\tconst errorMsg = err instanceof Error ? err.message : 'Failed to fetch data';\n\n\t\t\t// Retry logic with exponential backoff\n\t\t\tif (retryAttempt < retryCount) {\n\t\t\t\tlogger.warn(`[${label}] Retry ${retryAttempt + 1}/${retryCount}:`, errorMsg);\n\t\t\t\tconst delay = retryDelay * Math.pow(2, retryAttempt); // Exponential backoff\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, delay));\n\t\t\t\treturn fetchData(retryAttempt + 1);\n\t\t\t}\n\n\t\t\terror = errorMsg;\n\t\t\tlogger.error(`[${label}] Failed after ${retryCount} attempts:`, error);\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\t// Manual refresh function\n\tasync function refresh() {\n\t\t// Clear cache on manual refresh\n\t\tif (cacheKey && typeof window !== 'undefined') {\n\t\t\tlocalStorage.removeItem(`widget_cache_${cacheKey}`);\n\t\t}\n\t\tcurrentRetry = 0;\n\t\tawait fetchData();\n\t}\n\n\t// Effect for fetching data with polling\n\t$effect(() => {\n\t\tif (!endpoint) {\n\t\t\tloading = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet isActive = true;\n\t\tlet timerId: NodeJS.Timeout;\n\n\t\t// Initial fetch\n\t\t(async () => {\n\t\t\tif (isActive) await fetchData();\n\t\t})();\n\n\t\t// Setup polling if interval specified\n\t\tif (pollInterval > 0) {\n\t\t\ttimerId = setInterval(() => {\n\t\t\t\tif (isActive) fetchData();\n\t\t\t}, pollInterval);\n\t\t}\n\n\t\treturn () => {\n\t\t\tisActive = false;\n\t\t\tclearInterval(timerId);\n\t\t};\n\t});\n\n\t// Widget state management\n\tfunction updateWidgetState(key: string, value: any) {\n\t\twidgetState = { ...widgetState, [key]: value };\n\t}\n\n\tfunction getWidgetState(key: string) {\n\t\treturn widgetState[key];\n\t}\n\n\t// UI helpers\n\tfunction getSizeLabel(s: WidgetSize): string {\n\t\treturn `${s.w}Ã—${s.h}`;\n\t}\n\n\tfunction getLastUpdateText(): string {\n\t\tif (!lastFetchTime) return '';\n\t\tconst seconds = Math.floor((Date.now() - lastFetchTime) / 1000);\n\t\tif (seconds < 60) return `${seconds}s ago`;\n\t\tconst minutes = Math.floor(seconds / 60);\n\t\tif (minutes < 60) return `${minutes}m ago`;\n\t\tconst hours = Math.floor(minutes / 60);\n\t\treturn `${hours}h ago`;\n\t}\n\n\t// Resize and menu logic\n\tlet widgetEl: HTMLElement | undefined = $state();\n\tlet showSizeMenu = $state(false);\n\tlet isResizing = $state(false);\n\tlet previewSize = $state<WidgetSize | null>(null);\n\n\tconst availableSizes: WidgetSize[] = [\n\t\t{ w: 1, h: 1 },\n\t\t{ w: 2, h: 1 },\n\t\t{ w: 3, h: 1 },\n\t\t{ w: 4, h: 1 },\n\t\t{ w: 1, h: 2 },\n\t\t{ w: 2, h: 2 },\n\t\t{ w: 3, h: 2 },\n\t\t{ w: 4, h: 2 },\n\t\t{ w: 1, h: 3 },\n\t\t{ w: 2, h: 3 },\n\t\t{ w: 3, h: 3 },\n\t\t{ w: 4, h: 3 },\n\t\t{ w: 1, h: 4 },\n\t\t{ w: 2, h: 4 },\n\t\t{ w: 3, h: 4 },\n\t\t{ w: 4, h: 4 }\n\t];\n\n\tfunction handleResizePointerDown(e: PointerEvent) {\n\t\tif (!resizable || !widgetEl) return;\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst target = e.target as HTMLElement;\n\t\tconst direction = target.dataset.direction || target.closest('[data-direction]')?.getAttribute('data-direction');\n\n\t\tisResizing = true;\n\t\tconst startX = e.clientX;\n\t\tconst startY = e.clientY;\n\t\tconst gridContainer = widgetEl.closest('.responsive-dashboard-grid') as HTMLElement;\n\n\t\tif (!gridContainer) {\n\t\t\tisResizing = false;\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridGap = parseFloat(getComputedStyle(gridContainer).gap) || 16;\n\t\tconst gridCols = 4;\n\t\tconst totalGapWidth = gridGap * (gridCols - 1);\n\t\tconst singleColumnWidth = (gridContainer.offsetWidth - totalGapWidth) / gridCols;\n\t\tconst singleRowHeight = 180;\n\n\t\tconst currentColumns = size.w;\n\t\tconst currentRows = size.h;\n\n\t\tconst handlePointerMove = (moveEvent: PointerEvent) => {\n\t\t\tconst deltaX = moveEvent.clientX - startX;\n\t\t\tconst deltaY = moveEvent.clientY - startY;\n\n\t\t\tlet columnChange = 0;\n\t\t\tif (direction?.includes('e')) columnChange = deltaX / (singleColumnWidth + gridGap);\n\t\t\telse if (direction?.includes('w')) columnChange = -deltaX / (singleColumnWidth + gridGap);\n\n\t\t\tlet rowChange = 0;\n\t\t\tif (direction?.includes('s')) rowChange = deltaY / (singleRowHeight + gridGap);\n\t\t\telse if (direction?.includes('n')) rowChange = -deltaY / (singleRowHeight + gridGap);\n\n\t\t\tconst targetColumns = Math.round(currentColumns + columnChange);\n\t\t\tconst targetRows = Math.round(currentRows + rowChange);\n\n\t\t\tconst newColumns = Math.max(1, Math.min(4, targetColumns));\n\t\t\tconst newRows = Math.max(1, Math.min(4, targetRows));\n\n\t\t\tpreviewSize = { w: newColumns, h: newRows };\n\t\t};\n\n\t\tconst handlePointerUp = () => {\n\t\t\twindow.removeEventListener('pointermove', handlePointerMove);\n\t\t\twindow.removeEventListener('pointerup', handlePointerUp);\n\t\t\tisResizing = false;\n\t\t\tif (previewSize && (previewSize.w !== size.w || previewSize.h !== size.h)) {\n\t\t\t\tonSizeChange(previewSize);\n\t\t\t}\n\t\t\tpreviewSize = null;\n\t\t};\n\n\t\twindow.addEventListener('pointermove', handlePointerMove);\n\t\twindow.addEventListener('pointerup', handlePointerUp, { once: true });\n\t}\n\n\tfunction handleMenuSizeChange(newSize: WidgetSize) {\n\t\tonSizeChange(newSize);\n\t\tshowSizeMenu = false;\n\t}\n\n\tfunction handleClickOutside(event: MouseEvent) {\n\t\tif (showSizeMenu && widgetEl && !widgetEl.contains(event.target as Node)) {\n\t\t\tshowSizeMenu = false;\n\t\t}\n\t}\n\n\t$effect(() => {\n\t\tif (showSizeMenu) {\n\t\t\tdocument.addEventListener('click', handleClickOutside);\n\t\t} else {\n\t\t\tdocument.removeEventListener('click', handleClickOutside);\n\t\t}\n\t\treturn () => document.removeEventListener('click', handleClickOutside);\n\t});\n</script>\n\n<article\n\tbind:this={widgetEl}\n\tclass=\"widget-base-container text-text-900 dark:text-text-100 group relative flex h-full flex-col rounded-lg border border-surface-200 bg-white shadow-sm transition-all duration-150 focus-within:ring-2 focus-within:ring-primary-200 dark:text-surface-50 dark:bg-surface-800\"\n\taria-labelledby=\"widget-title-{widgetId || label}\"\n\tstyle=\"overflow: visible;\"\n>\n\t<header\n\t\tclass=\"widget-header flex cursor-grab items-center justify-between border-b border-gray-100 bg-white py-2 pl-4 pr-2 dark:text-surface-50 dark:bg-surface-800\"\n\t\tstyle=\"touch-action: none; overflow: visible; position: relative; z-index: 10;\"\n\t>\n\t\t<div class=\"flex flex-1 flex-col gap-0.5\">\n\t\t\t<h2\n\t\t\t\tid=\"widget-title-{widgetId || label}\"\n\t\t\t\tclass=\"font-display text-text-900 dark:text-text-100 flex items-center gap-2 truncate text-base font-semibold tracking-tight\"\n\t\t\t>\n\t\t\t\t{#if icon}\n\t\t\t\t\t<iconify-icon {icon} width=\"24\" class={theme === 'light' ? 'text-tertiary-600' : 'text-primary-400'}></iconify-icon>\n\t\t\t\t{/if}\n\t\t\t\t<span class=\"truncate\">{label}</span>\n\t\t\t</h2>\n\n\t\t\t{#if endpoint && lastFetchTime && showRefreshButton}\n\t\t\t\t<div class=\"flex items-center gap-2 text-xs text-surface-500\">\n\t\t\t\t\t<span>{getLastUpdateText()}</span>\n\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t<span class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:loading\" class=\"animate-spin\" width=\"10\"></iconify-icon>\n\t\t\t\t\t\t\t{#if currentRetry > 0}\n\t\t\t\t\t\t\t\t<span>Retry {currentRetry}/{retryCount}</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"flex items-center gap-1\">\n\t\t\t{#if endpoint && showRefreshButton}\n\t\t\t\t<button\n\t\t\t\t\tonclick={() => refresh()}\n\t\t\t\t\tclass=\"variant-outline-surface btn-icon\"\n\t\t\t\t\taria-label=\"Refresh widget\"\n\t\t\t\t\tdisabled={loading}\n\t\t\t\t\ttitle=\"Refresh data\"\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon=\"mdi:refresh\" width=\"16\" class={loading ? 'animate-spin' : ''}></iconify-icon>\n\t\t\t\t</button>\n\t\t\t{/if}\n\n\t\t\t<div class=\"relative\" style=\"overflow: visible;\">\n\t\t\t\t<button onclick={() => (showSizeMenu = !showSizeMenu)} class=\"variant-outline-surface btn-icon\" aria-label=\"Change widget size\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:dots-vertical\" width=\"18\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t\t{#if showSizeMenu}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"absolute right-0 top-full z-50 mt-2 w-48 rounded-md border border-surface-200 bg-white py-1 shadow-xl dark:text-surface-50 dark:bg-surface-800\"\n\t\t\t\t\t\tstyle=\"z-index: 9999; position: absolute;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#each availableSizes as s}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full items-center justify-between px-4 py-2 text-sm transition-colors hover:bg-surface-100 dark:hover:bg-surface-700 {size.w ===\n\t\t\t\t\t\t\t\t\ts.w && size.h === s.h\n\t\t\t\t\t\t\t\t\t? 'font-bold text-primary-500'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\tonclick={() => handleMenuSizeChange(s)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>{getSizeLabel(s)}</span>\n\t\t\t\t\t\t\t\t{#if size.w === s.w && size.h === s.h}\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:check\" class=\"text-primary-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<button onclick={onCloseRequest} class=\"variant-outline-surface btn-icon\" aria-label=\"Remove {label} widget\">\n\t\t\t\t<iconify-icon icon=\"mdi:close\" width=\"18\"></iconify-icon>\n\t\t\t</button>\n\t\t</div>\n\t</header>\n\t<section\n\t\tclass=\"widget-body relative min-h-[50px] flex-1 bg-white px-3 pb-2 dark:bg-surface-800\"\n\t\tstyle=\"width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: stretch; align-items: stretch;\"\n\t>\n\t\t{#if endpoint && loading && !internalData}\n\t\t\t<div class=\"loading-state text-text-400 absolute inset-0 flex items-center justify-center text-base\">Loading...</div>\n\t\t{:else if endpoint && error && !internalData}\n\t\t\t<div class=\"error-state absolute inset-0 flex flex-col items-center justify-center p-2 text-center text-base text-error-500\">\n\t\t\t\t<iconify-icon icon=\"mdi:alert-circle-outline\" width=\"24\" class=\"mb-1\"></iconify-icon>\n\t\t\t\t<span>{error}</span>\n\t\t\t</div>\n\t\t{:else if children}\n\t\t\t{@render children({\n\t\t\t\tdata: internalData,\n\t\t\t\tupdateWidgetState,\n\t\t\t\tgetWidgetState,\n\t\t\t\trefresh,\n\t\t\t\tisLoading: loading,\n\t\t\t\terror\n\t\t\t})}\n\t\t{:else if internalData}\n\t\t\t<pre class=\"text-text-700 dark:text-text-200 whitespace-pre-wrap break-all text-sm\" style=\"width: 100%; height: 100%;\">{JSON.stringify(\n\t\t\t\t\tinternalData,\n\t\t\t\t\tnull,\n\t\t\t\t\t2\n\t\t\t\t)}</pre>\n\t\t{:else}\n\t\t\t<div class=\"text-text-400 absolute inset-0 flex items-center justify-center text-base\">No content.</div>\n\t\t{/if}\n\t</section>\n\t{#if resizable}\n\t\t<div class=\"resize-handles pointer-events-none absolute inset-0\">\n\t\t\t{#each [{ dir: 'nw', classes: 'top-0 left-0 cursor-nw-resize', icon: 'clarity:drag-handle-corner-line', size: '12px', rotation: 'rotate-180' }, { dir: 'n', classes: 'top-0 left-1/2 cursor-n-resize', icon: 'mdi:drag-vertical', size: '12px', style: 'transform: translateX(-50%) rotate(90deg);', rotation: '' }, { dir: 'ne', classes: 'top-0 right-0 cursor-ne-resize', icon: 'clarity:drag-handle-corner-line', size: '12px', rotation: '-rotate-90' }, { dir: 'e', classes: 'top-1/2 right-0 cursor-e-resize', icon: 'mdi:drag-vertical', size: '12px', style: 'transform: translateY(-50%) rotate(180deg);', rotation: '' }, { dir: 'se', classes: 'bottom-0 right-0 cursor-se-resize', icon: 'clarity:drag-handle-corner-line', size: '12px', rotation: '' }, { dir: 's', classes: 'bottom-0 left-1/2 cursor-s-resize', icon: 'mdi:drag-vertical', size: '12px', style: 'transform: translateX(-50%) rotate(90deg);', rotation: '' }, { dir: 'sw', classes: 'bottom-0 left-0 cursor-sw-resize', icon: 'clarity:drag-handle-corner-line', size: '12px', rotation: 'rotate-90' }, { dir: 'w', classes: 'top-1/2 left-0 cursor-w-resize', icon: 'mdi:drag-vertical', size: '12px', style: 'transform: translateY(-50%) rotate(180deg);', rotation: '' }] as handle}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"pointer-events-auto absolute z-20 flex items-center justify-center opacity-0 transition-all duration-200 hover:scale-125 hover:opacity-100 group-hover:opacity-60 {handle.classes} {handle.rotation}\"\n\t\t\t\t\tstyle=\"width: 16px; height: 16px; {handle.style || ''}\"\n\t\t\t\t\tdata-direction={handle.dir}\n\t\t\t\t\ttitle=\"Resize widget by dragging {handle.dir}\"\n\t\t\t\t\taria-label=\"Resize widget {handle.dir}\"\n\t\t\t\t\tonpointerdown={handleResizePointerDown}\n\t\t\t\t\trole=\"button\"\n\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\tonkeydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon={handle.icon} width={handle.size} class=\"text-gray-900 drop-shadow-sm dark:text-surface-300\"></iconify-icon>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n\n\t{#if isResizing && previewSize}\n\t\t<div class=\"pointer-events-none absolute inset-0 z-20 flex items-center justify-center rounded-lg bg-primary-500/10 backdrop-blur-sm\">\n\t\t\t<div class=\"rounded-lg bg-primary-500 px-4 py-2 text-white shadow-lg\">\n\t\t\t\tSnap to: {getSizeLabel(previewSize)}\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</article>\n"],"names":["$$renderer","$.attr","$.stringify","$.escape","$.attr_class","$.clsx","$.attr_style"],"mappings":"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"}