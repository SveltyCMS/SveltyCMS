{"version":3,"file":"definitions.js","sources":["../../../../src/types/definitions.ts"],"sourcesContent":["/**\n * @file shared/types/src/definitions.ts\n * @description Combined core types to resolve circular dependencies between content and widgets\n */\n\nimport type { SvelteComponent } from 'svelte';\n\n// --- From content.ts ---\n\n// Define core value and status types\nexport type FieldValue = string | number | boolean | object | null;\n\n// Status types for collections and entries\nexport const StatusTypes = {\n\tarchive: 'archive',\n\tdraft: 'draft',\n\tpublish: 'publish',\n\tunpublish: 'unpublish',\n\tschedule: 'schedule',\n\tclone: 'clone',\n\tdelete: 'delete'\n} as const;\n\nexport type StatusType = (typeof StatusTypes)[keyof typeof StatusTypes];\n\n// --- Strongly-Typed Identifiers ---\nexport type DatabaseId = string & { readonly __brand: 'DatabaseId' };\nexport type ISODateString = string & { readonly __isoDate: 'ISODateString' };\n\nexport interface BaseEntity {\n\t_id: DatabaseId;\n\tcreatedAt: ISODateString;\n\tupdatedAt: ISODateString;\n\tisDeleted?: boolean; // Soft delete flag\n\tdeletedAt?: ISODateString; // Timestamp of deletion\n\tdeletedBy?: string; // User who performed deletion\n\ttenantId?: string; // For multi-tenant support\n}\n\nexport interface Translation {\n\tlanguageTag: string;\n\ttranslationName: string;\n\tisDefault?: boolean;\n}\n\n// Unified Content Node\nexport interface ContentNode {\n\t_id: DatabaseId;\n\tname: string;\n\tslug?: string;\n\tdescription?: string;\n\tnodeType: 'category' | 'collection';\n\ticon?: string;\n\torder: number;\n\tparentId?: DatabaseId;\n\tpath?: string;\n\ttranslations: Translation[];\n\tcollectionDef?: Schema;\n\tchildren?: ContentNode[];\n\tcreatedAt: ISODateString;\n\tupdatedAt: ISODateString;\n\ttenantId?: string;\n\tdeletedAt?: ISODateString;\n\tdeletedBy?: string;\n}\n\nexport interface ContentNodeOperation {\n\ttype: 'create' | 'update' | 'delete' | 'move' | 'rename';\n\tnode: ContentNode;\n}\n\nexport type ConfigEntity = {\n\tuuid: string;\n\ttype: string;\n\tname: string;\n\thash: string;\n\tentity: Record<string, unknown>;\n};\n\nexport type ConfigSyncStatus = {\n\tstatus: 'in_sync' | 'changes_detected';\n\tchanges: { new: ConfigEntity[]; updated: ConfigEntity[]; deleted: ConfigEntity[] };\n\tunmetRequirements: Array<{ key: string; value?: unknown }>;\n};\n\nexport interface IContentManager {\n\tinitialize(): Promise<void>;\n\tgetCollections(): Promise<Schema[]>;\n\tgetCollection(identifier: string, tenantId?: string): Promise<Schema | undefined>;\n\tgetCollectionById(collectionId: string, tenantId?: string): Promise<Schema | undefined>;\n\tgetCollectionStats(identifier: string, tenantId?: string): Promise<any>;\n}\n\n// Field Instance - An actual field using a widget with specific configuration\nexport interface FieldInstance {\n\t/** A reference to the widget's immutable definition. */\n\twidget: WidgetDefinition;\n\n\t// Field properties\n\tlabel: string;\n\tdb_fieldName: string;\n\ttranslated: boolean;\n\trequired: boolean;\n\tunique?: boolean;\n\tdefault?: FieldValue;\n\n\t// UI properties\n\ticon?: string;\n\twidth?: number;\n\thelper?: string;\n\n\t// Permissions\n\tpermissions?: Record<string, Record<string, boolean>>;\n\n\t// Functions\n\tvalidate?: (value: FieldValue) => boolean | Promise<boolean>;\n\tdisplay?: (args: {\n\t\tdata: Record<string, FieldValue>;\n\t\tcollection?: string;\n\t\tfield?: FieldInstance;\n\t\tentry?: Record<string, FieldValue>;\n\t\tcontentLanguage?: string;\n\t}) => Promise<string> | string;\n\tcallback?: (args: { data: Record<string, FieldValue> }) => void;\n\tmodifyRequest?: (args: Record<string, unknown>) => Promise<Record<string, unknown>>;\n\tmodifyRequestBatch?: (args: {\n\t\tdata: Record<string, unknown>[];\n\t\tcollection: unknown;\n\t\tfield: unknown;\n\t\tuser: unknown;\n\t\ttype: string;\n\t\ttenantId?: string;\n\t}) => Promise<Record<string, unknown>[]>;\n\n\t/** Widget-specific properties, now strongly typed by the factory. */\n\t[key: string]: unknown;\n}\n\n// Field definition\nexport type FieldDefinition = unknown | WidgetPlaceholder;\n\n// Collection Schema Definition\nexport interface Schema {\n\tid?: number;\n\t_id?: string;\n\tname?: string;\n\tlabel?: string;\n\tslug?: string;\n\ticon?: string;\n\torder?: number;\n\tdescription?: string;\n\tstrict?: boolean;\n\trevision?: boolean;\n\trevisionLimit?: number;\n\tpath?: string;\n\tpermissions?: any; // Avoiding circular dependency on RolePermissions\n\tlivePreview?: boolean;\n\tstatus?: StatusType;\n\tlinks?: Array<string>;\n\tfields: FieldDefinition[];\n\ttranslations?: Translation[];\n\n\ttenantId?: string;\n}\n\n// Dashboard types\nexport interface WidgetSize {\n\tw: number; // Width in grid units\n\th: number; // Height in grid units\n}\n\nexport interface DashboardWidgetConfig {\n\tid: string; // Unique widget identifier\n\tcomponent: string; // Svelte component name\n\tlabel: string; // Display label for the widget\n\ticon: string; // Icon identifier (iconify icon)\n\tsize: WidgetSize; // Widget dimensions\n\tsettings: Record<string, unknown>; // Widget-specific settings\n\tgridPosition?: number; // Optional position in the grid layout\n\torder?: number; // Optional order for sorting\n}\n\nexport interface Layout {\n\tid: string; // Layout identifier\n\tname: string; // Human-readable layout name\n\tpreferences: DashboardWidgetConfig[]; // Array of widget configurations\n}\n\nexport interface SystemPreferencesDocument {\n\t_id: string; // Document ID (combination of userId and layoutId)\n\tuserId?: string; // Optional user ID for user-scoped preferences\n\tlayoutId: string; // Layout identifier\n\tlayout: Layout; // Complete layout configuration\n\tscope: 'user' | 'system' | 'widget'; // Preference scope\n\tcreatedAt: ISODateString; // Creation timestamp\n\tupdatedAt: ISODateString; // Last update timestamp\n}\n\nexport interface RevisionData {\n\t_id: string;\n\tentryId: string;\n\tcollectionId: string;\n\tdata: Record<string, unknown>;\n\ttimestamp: ISODateString;\n\tuserId?: string;\n\toperation?: 'create' | 'update' | 'delete' | 'status_change';\n\ttenantId?: string;\n\t[key: string]: unknown;\n}\n\nexport interface CollectionEntry extends Record<string, unknown> {\n\t_id?: string;\n\tstatus?: StatusType;\n\tcreatedAt?: string;\n\tupdatedAt?: string;\n\tcreatedBy?: string;\n\tupdatedBy?: string;\n\ttenantId?: string;\n}\n\n// --- From widgets.ts ---\n\nexport interface GuiFieldConfig {\n\twidget: unknown;\n\trequired: boolean;\n}\n\nexport type WidgetType = 'core' | 'custom' | 'marketplace';\n\nexport interface WidgetMetadata {\n\ttype: WidgetType;\n\tversion?: string;\n\tauthor?: string;\n\tdependencies?: string[];\n\ttags?: string[];\n}\n\n/**\n * The immutable definition of a widget - created once by the factory\n * This is what gets stored in the widget registry\n */\nexport interface WidgetDefinition<TProps extends Record<string, unknown> = Record<string, unknown>> {\n\t// Core identity\n\twidgetId: string;\n\tName: string;\n\tIcon?: string;\n\tDescription?: string;\n\n\t// 3-Pillar Architecture paths\n\tinputComponentPath?: string;\n\tdisplayComponentPath?: string;\n\n\t// Validation (can be static schema or function)\n\tvalidationSchema: unknown | ((field: FieldInstance) => unknown);\n\n\t/** Optional function to return widget-specific translatable paths. */\n\tgetTranslatablePaths?: (basePath: string) => string[];\n\n\t// Default values for widget-specific props\n\tdefaults?: Partial<TProps>;\n\n\t// Configuration UI in Collection Builder\n\tGuiFields?: Record<string, unknown>;\n\tGuiSchema?: Record<string, unknown>; // Compatibility for legacy widgets\n\n\t// Optional advanced features\n\tGraphqlSchema?: (params: { field: unknown; label: string; collection: unknown; collectionNameMapping?: Map<string, string> }) => {\n\t\ttypeID: string | null;\n\t\tgraphql: string;\n\t\tresolver?: Record<string, unknown>;\n\t};\n\n\taggregations?: {\n\t\tfilters?: (params: { field: FieldInstance; filter: string; contentLanguage: string }) => Promise<unknown[]>;\n\t\tsorts?: (params: { field: FieldInstance; sortDirection: number; contentLanguage: string }) => Promise<Record<string, number>>;\n\t};\n\n\t// Metadata\n\tmetadata?: WidgetMetadata;\n}\n\n/**\n * The factory function that creates field instances\n * This is what collection authors use in their schemas\n */\nexport interface WidgetFactory<TProps extends Record<string, unknown> = Record<string, unknown>> {\n\t// The callable function that creates field instances\n\t(config: FieldConfig<TProps>): FieldInstance;\n\n\t// Static properties attached to the function (for compatibility)\n\tName: string;\n\tIcon?: string;\n\tDescription?: string;\n\tGuiSchema?: Record<string, unknown>;\n\tGraphqlSchema?: WidgetDefinition['GraphqlSchema'];\n\taggregations?: WidgetDefinition['aggregations'];\n\t__inputComponentPath?: string;\n\t__displayComponentPath?: string;\n\t__widgetType?: WidgetType;\n\t__dependencies?: string[];\n\n\t// String representation\n\ttoString(): string;\n}\n\n/**\n * Configuration for creating a field instance\n * Combines standard field properties with widget-specific props\n */\nexport type FieldConfig<TProps extends Record<string, unknown> = Record<string, unknown>> = {\n\t// Standard field properties\n\tlabel: string;\n\tdb_fieldName?: string;\n\trequired?: boolean;\n\ttranslated?: boolean;\n\twidth?: number;\n\thelper?: string;\n\ticon?: string;\n\tdisabled?: boolean;\n\treadonly?: boolean;\n\n\t// Permissions\n\tpermissions?: Record<string, Record<string, boolean>>;\n} & Partial<TProps>; // Widget-specific props\n\n/**\n * @deprecated Use WidgetFactory instead\n */\nexport interface Widget {\n\t(field: FieldInstance): FieldInstance;\n\tName: string;\n\tIcon?: string;\n\tDescription?: string;\n\tGuiSchema?: SvelteComponent;\n\tGraphqlSchema?: unknown;\n\taggregations?: unknown;\n\t__widgetType?: WidgetType;\n\t__dependencies?: string[];\n\t__inputComponentPath?: string;\n\t__displayComponentPath?: string;\n\tcomponentPath?: string;\n}\n\n/**\n * @deprecated Use WidgetFactory instead\n */\nexport interface WidgetFunction {\n\t(config: Record<string, unknown>): Widget;\n\t__widgetId?: string;\n\tName: string;\n\tGuiSchema?: typeof SvelteComponent | Record<string, unknown>;\n\tGraphqlSchema?: unknown;\n\tIcon?: string;\n\tDescription?: string;\n\taggregations?: unknown;\n\t__widgetType?: WidgetType;\n\t__isCore?: boolean;\n\t__dependencies?: string[];\n\t__inputComponentPath?: string;\n\t__displayComponentPath?: string;\n\tcomponentPath?: string;\n}\n\nexport type WidgetModule = {\n\tdefault: WidgetFactory;\n};\n\n/**\n * Parameters passed to widget components at runtime\n */\nexport type WidgetParam = {\n\tfield: FieldInstance;\n\tschema: Schema;\n\tuser: any; // Use any for now or import User from auth types if available\n\tvalue: unknown;\n\tvalues: unknown;\n\tonValueChange: (value: unknown) => void;\n\tconfig: GuiFieldConfig;\n\tplaceholder: WidgetPlaceholder;\n};\n\nexport interface WidgetPlaceholder {\n\t__widgetId: string;\n\t__widgetName: string;\n\t__widgetConfig: Record<string, unknown>;\n}\n\nexport interface WidgetRegistryEntry {\n\tdefinition: WidgetDefinition;\n\tfactory: WidgetFactory;\n\tstatus: 'active' | 'inactive' | 'error';\n\tmetadata: WidgetMetadata;\n\tloadedAt?: Date;\n\terror?: string;\n}\n"],"names":[],"mappings":"AAaO,MAAM,cAAc;AAAA,EAC1B,SAAS;AAAA,EACT,OAAO;AAAA,EACP,SAAS;AAAA,EACT,WAAW;AAAA,EACX,UAAU;AAAA,EACV,OAAO;AAAA,EACP,QAAQ;AACT;"}