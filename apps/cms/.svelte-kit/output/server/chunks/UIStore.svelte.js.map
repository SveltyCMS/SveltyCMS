{"version":3,"file":"UIStore.svelte.js","sources":["../../../../../../shared/stores/src/UIStore.svelte.ts"],"sourcesContent":["/**\n * @file src/stores/UIStore.svelte.ts\n * @description UI visibility management using Svelte 5 runes\n *\n * Features:\n * - Class-based singleton with $state properties\n * - Single $effect.root for controlled updates\n * - Manual override timer for sidebar toggles\n *\n * Usage:\n * - ui.state - Current UIState object\n * - ui.toggle(element, visibility) - Toggle UI element\n * - ui.forceUpdate() - Force layout recalculation\n * - ui.setRouteContext(ctx) - Set special route context\n */\n\nimport { mode } from './collectionStore.svelte';\nimport { screen, ScreenSize } from './screenSizeStore.svelte';\nimport { untrack } from 'svelte';\n\n// Types for UI visibility states\nexport type UIVisibility = 'hidden' | 'collapsed' | 'full';\n\n// Interface for UI state\nexport interface UIState {\n\tleftSidebar: UIVisibility;\n\trightSidebar: UIVisibility;\n\tpageheader: UIVisibility;\n\tpagefooter: UIVisibility;\n\theader: UIVisibility;\n\tfooter: UIVisibility;\n}\n\n/**\n * UIStore - Manages UI element visibility based on screen size and mode\n */\nclass UIStore {\n\t// Core reactive state\n\tstate = $state<UIState>({\n\t\tleftSidebar: 'full',\n\t\trightSidebar: 'hidden',\n\t\tpageheader: 'full',\n\t\tpagefooter: 'hidden',\n\t\theader: 'hidden',\n\t\tfooter: 'hidden'\n\t});\n\n\t// Route context for special layouts\n\trouteContext = $state({\n\t\tisImageEditor: false,\n\t\tisCollectionBuilder: false\n\t});\n\n\t// UI toggles\n\tmanualOverrideActive = $state(false);\n\theaderShowMore = $state(false);\n\tisSearchVisible = $state(false);\n\tuserPreferred = $state<UIVisibility>('collapsed');\n\n\t// Internal state\n\tprivate manualTimer: ReturnType<typeof setTimeout> | null = null;\n\tprivate effectCleanup?: () => void;\n\n\t// Computed visibility getters\n\tget isLeftSidebarVisible(): boolean {\n\t\treturn this.state.leftSidebar !== 'hidden';\n\t}\n\n\tget isRightSidebarVisible(): boolean {\n\t\treturn this.state.rightSidebar !== 'hidden';\n\t}\n\n\tget isPageHeaderVisible(): boolean {\n\t\treturn this.state.pageheader !== 'hidden';\n\t}\n\n\tget isPageFooterVisible(): boolean {\n\t\treturn this.state.pagefooter !== 'hidden';\n\t}\n\n\tget isHeaderVisible(): boolean {\n\t\treturn this.state.header !== 'hidden';\n\t}\n\n\tget isFooterVisible(): boolean {\n\t\treturn this.state.footer !== 'hidden';\n\t}\n\n\tconstructor() {\n\t\tif (typeof window === 'undefined') return;\n\n\t\t// Single effect root watches size + mode changes\n\t\tthis.effectCleanup = $effect.root(() => {\n\t\t\t$effect(() => {\n\t\t\t\tconst size = screen.size;\n\t\t\t\tconst currentMode = mode.value;\n\t\t\t\t// Track route context changes to trigger updates\n\t\t\t\tconst _ctx = this.routeContext.isImageEditor || this.routeContext.isCollectionBuilder;\n\t\t\t\tvoid _ctx;\n\n\t\t\t\tuntrack(() => {\n\t\t\t\t\tif (!this.manualOverrideActive) {\n\t\t\t\t\t\tthis.updateFromContext(size, currentMode);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Updates UI state based on screen size and current mode\n\t */\n\tprivate updateFromContext(size: ScreenSize, currentMode: string): void {\n\t\tconst isViewMode = currentMode === 'view' || currentMode === 'media';\n\n\t\t// Special routes\n\t\tif (this.routeContext.isImageEditor) {\n\t\t\tthis.state = {\n\t\t\t\tleftSidebar: 'collapsed',\n\t\t\t\trightSidebar: 'hidden',\n\t\t\t\tpageheader: 'full',\n\t\t\t\tpagefooter: 'full',\n\t\t\t\theader: 'hidden',\n\t\t\t\tfooter: 'hidden'\n\t\t\t};\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.routeContext.isCollectionBuilder) {\n\t\t\t// Collection builder should respect screen size for sidebar\n\t\t\tlet sidebarState: UIVisibility = 'full';\n\t\t\tif (size === ScreenSize.XS || size === ScreenSize.SM) {\n\t\t\t\tsidebarState = 'hidden';\n\t\t\t} else if (size === ScreenSize.MD) {\n\t\t\t\tsidebarState = 'collapsed';\n\t\t\t}\n\n\t\t\tthis.state = {\n\t\t\t\tleftSidebar: sidebarState,\n\t\t\t\trightSidebar: 'hidden',\n\t\t\t\tpageheader: 'hidden', // No HeaderEdit in collection builder\n\t\t\t\tpagefooter: 'hidden',\n\t\t\t\theader: 'hidden',\n\t\t\t\tfooter: 'hidden'\n\t\t\t};\n\t\t\treturn;\n\t\t}\n\n\t\tconst showPageHeader = ['edit', 'create', 'modify', 'media'].includes(currentMode);\n\n\t\t// Mobile\n\t\tif (size === ScreenSize.XS || size === ScreenSize.SM) {\n\t\t\tthis.state = {\n\t\t\t\tleftSidebar: 'hidden',\n\t\t\t\trightSidebar: 'hidden',\n\t\t\t\tpageheader: showPageHeader ? 'full' : 'hidden',\n\t\t\t\tpagefooter: 'hidden',\n\t\t\t\theader: 'hidden',\n\t\t\t\tfooter: 'hidden'\n\t\t\t};\n\t\t\treturn;\n\t\t}\n\n\t\t// Tablet\n\t\tif (size === ScreenSize.MD) {\n\t\t\tthis.state = {\n\t\t\t\tleftSidebar: isViewMode ? 'collapsed' : 'hidden',\n\t\t\t\trightSidebar: 'hidden',\n\t\t\t\tpageheader: showPageHeader ? 'full' : 'hidden',\n\t\t\t\tpagefooter: 'hidden',\n\t\t\t\theader: 'hidden',\n\t\t\t\tfooter: 'hidden'\n\t\t\t};\n\t\t\treturn;\n\t\t}\n\n\t\t// Desktop\n\t\tthis.state = {\n\t\t\tleftSidebar: isViewMode ? 'full' : 'collapsed',\n\t\t\trightSidebar: isViewMode ? 'hidden' : 'full',\n\t\t\tpageheader: showPageHeader ? 'full' : 'hidden',\n\t\t\tpagefooter: 'hidden',\n\t\t\theader: 'hidden',\n\t\t\tfooter: 'hidden'\n\t\t};\n\t}\n\n\t/**\n\t * Toggle a UI element's visibility\n\t */\n\ttoggle(element: keyof UIState, visibility: UIVisibility): void {\n\t\tthis.state[element] = visibility;\n\n\t\t// Prevent auto-updates for 600ms after manual toggle\n\t\tif (element === 'leftSidebar' || element === 'rightSidebar') {\n\t\t\tthis.manualOverrideActive = true;\n\n\t\t\tif (this.manualTimer) clearTimeout(this.manualTimer);\n\t\t\tthis.manualTimer = setTimeout(() => {\n\t\t\t\tthis.manualOverrideActive = false;\n\t\t\t\tthis.manualTimer = null;\n\t\t\t}, 600);\n\t\t}\n\t}\n\n\t/**\n\t * Set route context for special layouts\n\t */\n\tsetRouteContext(ctx: { isImageEditor?: boolean; isCollectionBuilder?: boolean }): void {\n\t\tfor (const key in ctx) {\n\t\t\tconst k = key as keyof typeof ctx;\n\t\t\tif (this.routeContext[k] !== ctx[k]) {\n\t\t\t\tthis.routeContext[k] = ctx[k] ?? false; // Fallback to false if undefined\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Force a layout update\n\t */\n\tforceUpdate(): void {\n\t\tthis.updateFromContext(screen.size, mode.value);\n\t}\n\n\t/**\n\t * Cleanup resources\n\t */\n\tdestroy(): void {\n\t\tif (this.manualTimer) {\n\t\t\tclearTimeout(this.manualTimer);\n\t\t\tthis.manualTimer = null;\n\t\t}\n\t\tthis.effectCleanup?.();\n\t}\n}\n\n// Singleton instance - the main export\nexport const ui = new UIStore();\n\n// Backward compatibility exports for theme branch components\nexport function toggleUIElement(element: keyof UIState, visibility: UIVisibility): void {\n\tui.toggle(element, visibility);\n}\n\n// Compatibility export for uiStateManager - wraps ui instance\nexport const uiStateManager = {\n\tget state() {\n\t\treturn ui.state;\n\t},\n\tget uiState() {\n\t\treturn { value: ui.state };\n\t},\n\ttoggle: ui.toggle.bind(ui),\n\tshow: (element: keyof UIState) => ui.toggle(element, 'full'),\n\thide: (element: keyof UIState) => ui.toggle(element, 'hidden')\n};\n\n// Compatibility export for userPreferredState - wraps ui.state\nexport const userPreferredState = {\n\tget leftSidebar() {\n\t\treturn ui.state.leftSidebar;\n\t},\n\tget rightSidebar() {\n\t\treturn ui.state.rightSidebar;\n\t},\n\tget pageheader() {\n\t\treturn ui.state.pageheader;\n\t},\n\tset(state: UIVisibility) {\n\t\t// No-op or map to something?\n\t\t// Theme branch likely set a preference.\n\t\tui.userPreferred = state;\n\t}\n};\n\nexport const setRouteContext = ui.setRouteContext.bind(ui);\n"],"names":[],"mappings":"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"}