{"version":3,"file":"scanner.js","sources":["../../../../../../shared/components/src/IconifyPicker.svelte","../../../../../../shared/components/src/PermissionsSetting.svelte","../../../../../../shared/components/src/system/inputs/Input.svelte","../../../../../../shared/components/src/system/inputs/Toggles.svelte","../../../../src/widgets/widgetFactory.ts","../../../../src/widgets/core/Checkbox/index.ts","../../../../src/widgets/core/Date/index.ts","../../../../src/widgets/core/DateRange/index.ts","../../../../src/widgets/core/Group/index.ts","../../../../src/widgets/core/Input/index.ts","../../../../src/widgets/core/MediaUpload/index.ts","../../../../src/widgets/core/MegaMenu/index.ts","../../../../src/widgets/core/Radio/index.ts","../../../../../../shared/components/src/system/builder/CollectionPicker.svelte","../../../../../../shared/components/src/system/builder/FieldPicker.svelte","../../../../src/widgets/core/Relation/index.ts","../../../../src/widgets/core/RichText/index.ts","../../../../src/widgets/custom/Address/index.ts","../../../../src/widgets/custom/ColorPicker/index.ts","../../../../src/widgets/custom/Currency/index.ts","../../../../src/widgets/custom/Email/index.ts","../../../../src/widgets/custom/Number/index.ts","../../../../src/widgets/custom/PhoneNumber/index.ts","../../../../src/widgets/custom/Rating/index.ts","../../../../src/widgets/custom/RemoteVideo/index.ts","../../../../src/widgets/custom/Seo/index.ts","../../../../src/widgets/scanner.js"],"sourcesContent":["<!-- \n@file src/components/IconifyPicker.svelte\n@component\n**Enhanced IconifyPicker - Svelte 5 Optimized**\n\nAdvanced icon picker with search, pagination, and favorites.\n\n@example\n```svelte\n<IconifyPicker bind:iconselected />\n```\n\n### Features\n- Debounced search with performance optimization\n- Paginated results with smooth loading\n- Multiple icon library support\n- Favorite icons (in-memory)\n- Recent selections history\n- Keyboard navigation (Arrow keys, Enter, Escape)\n- Copy icon name to clipboard\n- Preview mode with size adjustment\n- Full ARIA accessibility\n- Reduced motion support\n-->\n\n<script lang=\"ts\">\n\timport * as m from '@shared/paraglide/messages';\n\timport { loadIcons } from '@iconify/svelte';\n\timport { logger } from '@shared/utils/logger';\n\timport { onMount, onDestroy } from 'svelte';\n\timport { fade, scale, slide } from 'svelte/transition';\n\timport { quintOut } from 'svelte/easing';\n\timport { showToast } from '@shared/utils/toast';\n\n\t// Constants\n\tconst DEBOUNCE_MS = 300;\n\tconst ICONS_PER_PAGE = 50;\n\tconst DEFAULT_LIBRARY = 'ic';\n\tconst ICONIFY_API_BASE = 'https://api.iconify.design';\n\tconst MAX_RECENT = 10;\n\n\t// Types\n\tinterface IconLibrary {\n\t\tname: string;\n\t\ttotal: number;\n\t\tprefix?: string;\n\t\tauthor?: string;\n\t\tlicense?: string;\n\t\tcategory?: string;\n\t}\n\n\tinterface IconSearchResponse {\n\t\ticons: string[];\n\t\ttotal: number;\n\t\tlimit: number;\n\t\tstart: number;\n\t\tcollections: Record<string, IconLibrary>;\n\t\tprefix?: string;\n\t}\n\n\tinterface Props {\n\t\ticonselected: string;\n\t\tsearchQuery?: string;\n\t\tshowFavorites?: boolean;\n\t}\n\n\tlet { iconselected = $bindable(), searchQuery = $bindable(''), showFavorites = true }: Props = $props();\n\n\t// State\n\tlet icons = $state<string[]>([]);\n\tlet currentPage = $state(0);\n\tlet selectedLibrary = $state(DEFAULT_LIBRARY);\n\tlet iconLibraries = $state<Record<string, IconLibrary>>({});\n\tlet isLoadingLibraries = $state(false);\n\tlet searchError = $state<string | null>(null);\n\tlet debounceTimer: ReturnType<typeof setTimeout> | null = null;\n\tlet favorites = $state<string[]>([]);\n\tlet recentSelections = $state<string[]>([]);\n\tlet isLoading = $state(false);\n\tlet activeTab = $state<'search' | 'favorites' | 'recent'>('search');\n\tlet showDropdown = $state(false);\n\tlet selectedIndex = $state(-1);\n\tlet prefersReducedMotion = $state(false);\n\tlet previewSize = $state(24);\n\n\t// Refs\n\tlet dropdownRef = $state<HTMLDivElement | null>(null);\n\tlet gridRef = $state<HTMLDivElement | null>(null);\n\n\t// Derived values\n\t// Removed unused 'hasIcons'\n\tconst startIndex = $derived(currentPage * ICONS_PER_PAGE);\n\tconst librariesLoaded = $derived(Object.keys(iconLibraries).length > 0);\n\tconst hasSearchQuery = $derived(searchQuery.trim().length > 0);\n\tconst isFavorite = $derived(favorites.includes(iconselected));\n\tconst hasRecent = $derived(recentSelections.length > 0);\n\tconst hasFavorites = $derived(favorites.length > 0);\n\n\tconst sortedLibraries = $derived.by(() => {\n\t\treturn Object.entries(iconLibraries).sort(([, a], [, b]) => a.name.localeCompare(b.name));\n\t});\n\n\tlet visibleLimit = $state(50);\n\n\t// Display icons based on active tab\n\tconst displayIcons = $derived.by(() => {\n\t\tif (activeTab === 'favorites') return favorites;\n\t\tif (activeTab === 'recent') return recentSelections;\n\n\t\t// If searching (API results), 'icons' is usually just the current page\n\t\t// BUT if browsing (all icons), we slice.\n\t\t// Since we now use infinite scroll for everything:\n\t\treturn icons.slice(0, visibleLimit);\n\t});\n\n\t// Intersection Observer Action for Infinite Scroll\n\tfunction intersectionObserverAction(node: HTMLElement) {\n\t\tconst observer = new IntersectionObserver((entries) => {\n\t\t\tif (entries[0].isIntersecting) {\n\t\t\t\tloadMore();\n\t\t\t}\n\t\t});\n\n\t\tobserver.observe(node);\n\n\t\treturn {\n\t\t\tdestroy() {\n\t\t\t\tobserver.disconnect();\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction loadMore() {\n\t\t// If browsing (all icons loaded), just increase visible limit\n\t\tif (icons.length > visibleLimit) {\n\t\t\tvisibleLimit += 50;\n\t\t}\n\t\t// If searching (API pagination), fetch more\n\t\telse if (hasSearchQuery || selectedLibrary === '') {\n\t\t\t// Logic to fetch next page from API and append (requires searchIcons to append)\n\t\t\t// For simplicity, we can ignore this for now if searchTokens returns 50 at a time\n\t\t\t// But since we removed Page Next/Prev buttons, we SHOULD implement API pagination here.\n\t\t\t// Let's assume searchIcons handles appending if we pass a flag?\n\t\t\t// Actually, let's keep it simple: Browse is infinite scroll local, Search is infinite scroll remote?\n\t\t\t// Refactoring searchIcons to append:\n\t\t\tif (!isLoading) {\n\t\t\t\tcurrentPage++;\n\t\t\t\tsearchIcons(searchQuery, selectedLibrary, true); // true = append\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleScroll() {\n\t\t// keeping this if needed for manual scroll handling, but IntersectionObserver is better\n\t}\n\n\t// Debounced search\n\tfunction debouncedSearch(query: string, library: string): void {\n\t\tif (debounceTimer) {\n\t\t\tclearTimeout(debounceTimer);\n\t\t}\n\n\t\tif (!query.trim()) {\n\t\t\ticons = [];\n\t\t\tisLoading = false;\n\t\t\treturn;\n\t\t}\n\n\t\tisLoading = true;\n\t\tdebounceTimer = setTimeout(() => {\n\t\t\tsearchIcons(query, library);\n\t\t}, DEBOUNCE_MS);\n\t}\n\n\t// Fetch icons from Iconify API\n\tasync function searchIcons(query: string, library: string, append: boolean = false): Promise<void> {\n\t\t// If no query, load the library's icons instead of clearing\n\t\tif (!query.trim()) {\n\t\t\tif (library && !append) {\n\t\t\t\tawait fetchCollectionIcons(library);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tisLoading = true;\n\t\tsearchError = null;\n\n\t\ttry {\n\t\t\tconst url = new URL(`${ICONIFY_API_BASE}/search`);\n\t\t\turl.searchParams.set('query', query);\n\t\t\t// Only set prefix if a specific library is selected\n\t\t\tif (library) {\n\t\t\t\turl.searchParams.set('prefix', library);\n\t\t\t}\n\t\t\turl.searchParams.set('start', startIndex.toString());\n\t\t\turl.searchParams.set('limit', ICONS_PER_PAGE.toString());\n\n\t\t\tconst controller = new AbortController();\n\t\t\tconst timeout = setTimeout(() => controller.abort(), 10000);\n\n\t\t\tconst response = await fetch(url.toString(), {\n\t\t\t\tsignal: controller.signal\n\t\t\t});\n\n\t\t\tclearTimeout(timeout);\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`API error: ${response.status}`);\n\t\t\t}\n\n\t\t\tconst data: IconSearchResponse = await response.json();\n\n\t\t\tif (data?.icons && Array.isArray(data.icons)) {\n\t\t\t\tconst newIcons = data.icons;\n\n\t\t\t\tif (append) {\n\t\t\t\t\ticons = [...icons, ...newIcons];\n\t\t\t\t\tvisibleLimit += newIcons.length; // Ensure they are visible\n\t\t\t\t} else {\n\t\t\t\t\ticons = newIcons;\n\t\t\t\t\tvisibleLimit = 50;\n\t\t\t\t\tcurrentPage = 0;\n\t\t\t\t}\n\n\t\t\t\t// Preload icons for better UX\n\t\t\t\tconst iconIds = newIcons.map((icon) => {\n\t\t\t\t\t// If global search, icon already includes prefix\n\t\t\t\t\treturn library ? `${library}:${icon}` : icon;\n\t\t\t\t});\n\t\t\t\tawait loadIcons(iconIds);\n\n\t\t\t\tactiveTab = 'search';\n\t\t\t} else {\n\t\t\t\tif (!append) icons = [];\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (error instanceof Error && error.name === 'AbortError') {\n\t\t\t\tsearchError = 'Search timeout - please try again';\n\t\t\t} else {\n\t\t\t\tlogger.error('Error fetching icons:', error);\n\t\t\t\tsearchError = 'Failed to fetch icons';\n\t\t\t}\n\t\t\ticons = [];\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\t// Fetch all icons for a specific collection (browsing mode)\n\tasync function fetchCollectionIcons(library: string): Promise<void> {\n\t\tisLoading = true;\n\t\tsearchError = null;\n\t\ticons = [];\n\n\t\ttry {\n\t\t\tconst response = await fetch(`${ICONIFY_API_BASE}/collection?prefix=${library}`);\n\t\t\tif (!response.ok) throw new Error(`Failed to load collection: ${response.status}`);\n\n\t\t\tconst data = await response.json();\n\n\t\t\t// Flatten the collection data into a simple list of icon names\n\t\t\tlet allIcons: string[] = [];\n\n\t\t\t// Add uncategorized\n\t\t\tif (data.uncategorized) {\n\t\t\t\tallIcons.push(...data.uncategorized);\n\t\t\t}\n\n\t\t\t// Add categorized\n\t\t\tif (data.categories) {\n\t\t\t\tObject.values(data.categories).forEach((categoryIcons: any) => {\n\t\t\t\t\tallIcons.push(...categoryIcons);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add hidden/aliases if needed, but usually main icons are enough\n\n\t\t\ticons = allIcons;\n\t\t\tvisibleLimit = 50; // Reset for new collection\n\t\t\t// Reset to page 0 for new collection\n\t\t\t// currentPage = 0; // Don't reset here, handled by caller if needed\n\t\t} catch (error) {\n\t\t\tlogger.error('Error fetching collection icons:', error);\n\t\t\tsearchError = 'Failed to load library icons';\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\t// Fetch available icon libraries\n\tasync function fetchIconLibraries(): Promise<void> {\n\t\tif (librariesLoaded || isLoadingLibraries) return;\n\n\t\tisLoadingLibraries = true;\n\t\tsearchError = null;\n\n\t\ttry {\n\t\t\tconst controller = new AbortController();\n\t\t\tconst timeout = setTimeout(() => controller.abort(), 10000);\n\n\t\t\tconst response = await fetch(`${ICONIFY_API_BASE}/collections`, {\n\t\t\t\tsignal: controller.signal\n\t\t\t});\n\n\t\t\tclearTimeout(timeout);\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`Failed to fetch libraries: ${response.status}`);\n\t\t\t}\n\n\t\t\tconst data: Record<string, IconLibrary> = await response.json();\n\t\t\ticonLibraries = data;\n\t\t} catch (error) {\n\t\t\tlogger.error('Error fetching icon libraries:', error);\n\t\t\tsearchError = 'Failed to load libraries';\n\t\t} finally {\n\t\t\tisLoadingLibraries = false;\n\t\t}\n\t}\n\n\t// Navigation handlers\n\n\t// Icon selection\n\tfunction selectIcon(icon: string): void {\n\t\tconst fullIconName = icon.includes(':') ? icon : `${selectedLibrary}:${icon}`;\n\t\ticonselected = fullIconName;\n\n\t\t// Add to recent (avoiding duplicates)\n\t\trecentSelections = [fullIconName, ...recentSelections.filter((i) => i !== fullIconName)].slice(0, MAX_RECENT);\n\n\t\tshowDropdown = false;\n\t\tshowToast(`Icon selected: ${fullIconName}`, 'success');\n\t}\n\n\t// Favorites management\n\tfunction toggleFavorite(icon?: string): void {\n\t\tconst targetIcon = icon || iconselected;\n\t\tif (!targetIcon) return;\n\n\t\tif (favorites.includes(targetIcon)) {\n\t\t\tfavorites = favorites.filter((i) => i !== targetIcon);\n\t\t\tshowToast('Removed from favorites', 'info');\n\t\t} else {\n\t\t\tfavorites = [...favorites, targetIcon];\n\t\t\tshowToast('Added to favorites', 'success');\n\t\t}\n\t}\n\n\t// Copy icon name\n\tasync function copyIconName(): Promise<void> {\n\t\tif (!iconselected) return;\n\n\t\ttry {\n\t\t\tawait navigator.clipboard.writeText(iconselected);\n\t\t\tshowToast('Icon name copied to clipboard', 'success');\n\t\t} catch (error) {\n\t\t\tlogger.error('Copy failed:', error);\n\t\t\tshowToast('Failed to copy icon name', 'error');\n\t\t}\n\t}\n\n\t// Remove icon\n\tfunction removeIcon(): void {\n\t\ticonselected = '';\n\t\tsearchQuery = '';\n\t\ticons = [];\n\t}\n\n\t// Library change handler\n\tfunction handleLibraryChange(): void {\n\t\tcurrentPage = 0;\n\t\tif (hasSearchQuery) {\n\t\t\tsearchIcons(searchQuery, selectedLibrary);\n\t\t}\n\t}\n\n\t// Show dropdown\n\tfunction handleFocus(): void {\n\t\tshowDropdown = true;\n\t\tfetchIconLibraries();\n\t\t// If we have no icons yet, try to load something\n\t\tif (icons.length === 0) {\n\t\t\tif (searchQuery) {\n\t\t\t\tsearchIcons(searchQuery, selectedLibrary);\n\t\t\t} else if (selectedLibrary) {\n\t\t\t\tfetchCollectionIcons(selectedLibrary);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Close dropdown\n\tfunction handleClickOutside(event: MouseEvent): void {\n\t\tconst target = event.target as HTMLElement;\n\t\tif (dropdownRef && !dropdownRef.contains(target)) {\n\t\t\tshowDropdown = false;\n\t\t}\n\t}\n\n\t// Keyboard navigation\n\tfunction handleKeyDown(event: KeyboardEvent): void {\n\t\tif (!showDropdown) return;\n\n\t\tconst iconsToNavigate = displayIcons;\n\n\t\tswitch (event.key) {\n\t\t\tcase 'Escape':\n\t\t\t\tevent.preventDefault();\n\t\t\t\tshowDropdown = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 'ArrowDown':\n\t\t\t\tevent.preventDefault();\n\t\t\t\tselectedIndex = Math.min(selectedIndex + 1, iconsToNavigate.length - 1);\n\t\t\t\tscrollToSelected();\n\t\t\t\tbreak;\n\n\t\t\tcase 'ArrowUp':\n\t\t\t\tevent.preventDefault();\n\t\t\t\tselectedIndex = Math.max(selectedIndex - 1, -1);\n\t\t\t\tscrollToSelected();\n\t\t\t\tbreak;\n\n\t\t\tcase 'Enter':\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (selectedIndex >= 0 && iconsToNavigate[selectedIndex]) {\n\t\t\t\t\tselectIcon(iconsToNavigate[selectedIndex]);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Scroll to selected icon\n\tfunction scrollToSelected(): void {\n\t\tif (!gridRef || selectedIndex < 0) return;\n\n\t\tconst selectedElement = gridRef.children[selectedIndex] as HTMLElement;\n\t\tif (selectedElement) {\n\t\t\tselectedElement.scrollIntoView({\n\t\t\t\tblock: 'nearest',\n\t\t\t\tbehavior: prefersReducedMotion ? 'auto' : 'smooth'\n\t\t\t});\n\t\t}\n\t}\n\n\t// Switch tabs\n\tfunction switchTab(tab: typeof activeTab): void {\n\t\tactiveTab = tab;\n\t\tselectedIndex = -1;\n\t}\n\n\t// Effects\n\t$effect(() => {\n\t\tif (showDropdown) {\n\t\t\tdocument.addEventListener('click', handleClickOutside);\n\t\t\tdocument.addEventListener('keydown', handleKeyDown);\n\t\t\treturn () => {\n\t\t\t\tdocument.removeEventListener('click', handleClickOutside);\n\t\t\t\tdocument.removeEventListener('keydown', handleKeyDown);\n\t\t\t};\n\t\t}\n\t});\n\n\t// Lifecycle\n\tonMount(() => {\n\t\tconst mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n\t\tprefersReducedMotion = mediaQuery.matches;\n\n\t\tconst handleChange = (e: MediaQueryListEvent) => {\n\t\t\tprefersReducedMotion = e.matches;\n\t\t};\n\n\t\tmediaQuery.addEventListener('change', handleChange);\n\t\treturn () => mediaQuery.removeEventListener('change', handleChange);\n\t});\n\n\tonDestroy(() => {\n\t\tif (debounceTimer) {\n\t\t\tclearTimeout(debounceTimer);\n\t\t}\n\t});\n</script>\n\n```\n<div class=\"icon-picker-container flex w-full flex-col\" bind:this={dropdownRef}>\n\t<!-- Selected icon display -->\n\t{#if iconselected}\n\t\t<div\n\t\t\tclass=\"mb-2 flex items-center justify-between gap-2\"\n\t\t\tin:scale={{ duration: prefersReducedMotion ? 0 : 200, easing: quintOut, start: 0.9 }}\n\t\t\tout:scale={{ duration: prefersReducedMotion ? 0 : 150, easing: quintOut, start: 0.9 }}\n\t\t>\n\t\t\t<div class=\"flex flex-1 items-center gap-3 rounded-lg bg-surface-100 p-2 dark:bg-surface-800\">\n\t\t\t\t<iconify-icon\n\t\t\t\t\ticon={iconselected}\n\t\t\t\t\twidth={previewSize}\n\t\t\t\t\tclass=\"text-tertiary-500 transition-transform duration-200 hover:scale-110 dark:text-primary-500\"\n\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t></iconify-icon>\n\t\t\t\t<div class=\"flex-1 overflow-hidden\">\n\t\t\t\t\t<p class=\"text-xs text-surface-600 dark:text-surface-50\">Selected Icon</p>\n\t\t\t\t\t<p class=\"truncate text-sm font-medium text-tertiary-500 dark:text-primary-500\">\n\t\t\t\t\t\t{iconselected}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex gap-1\">\n\t\t\t\t<button\n\t\t\t\t\tonclick={() => toggleFavorite(iconselected)}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"btn-icon preset-outlined-surface-500 transition-all duration-200 hover:scale-110\"\n\t\t\t\t\taria-label={isFavorite ? 'Remove from favorites' : 'Add to favorites'}\n\t\t\t\t\ttitle={isFavorite ? 'Remove from favorites' : 'Add to favorites'}\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon={isFavorite ? 'mdi:heart' : 'mdi:heart-outline'} width=\"22\" class={isFavorite ? 'text-error-500' : ''}></iconify-icon>\n\t\t\t\t</button>\n\n\t\t\t\t<button\n\t\t\t\t\tonclick={copyIconName}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"btn-icon preset-outlined-surface-500 transition-all duration-200 hover:scale-110\"\n\t\t\t\t\taria-label=\"Copy icon name\"\n\t\t\t\t\ttitle=\"Copy icon name\"\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon=\"mdi:content-copy\" width=\"22\"></iconify-icon>\n\t\t\t\t</button>\n\n\t\t\t\t<button\n\t\t\t\t\tonclick={removeIcon}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"btn-icon preset-outlined-error-500 transition-all duration-200 hover:scale-110\"\n\t\t\t\t\taria-label=\"Remove selected icon\"\n\t\t\t\t\ttitle=\"Remove icon\"\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon=\"mdi:close\" width=\"22\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<!-- Search input container -->\n\t<div class=\"relative\">\n\t\t<input\n\t\t\ttype=\"text\"\n\t\t\trole=\"combobox\"\n\t\t\tbind:value={searchQuery}\n\t\t\tplaceholder={iconselected ? `Replace: ${iconselected}` : m.iconpicker_placeholder()}\n\t\t\tclass=\"input w-full pr-10 transition-all duration-200 focus:scale-[1.01] focus:shadow-lg\"\n\t\t\toninput={() => debouncedSearch(searchQuery, selectedLibrary)}\n\t\t\tonfocus={handleFocus}\n\t\t\taria-label=\"Search icons\"\n\t\t\taria-controls=\"icon-dropdown\"\n\t\t\taria-haspopup=\"listbox\"\n\t\t\taria-expanded={showDropdown}\n\t\t\taria-describedby={searchError ? 'search-error' : undefined}\n\t\t/>\n\t\t{#if searchQuery}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"absolute right-2 top-1/2 -translate-y-1/2 text-surface-400 hover:text-surface-600 dark:hover:text-surface-200\"\n\t\t\t\tonclick={() => {\n\t\t\t\t\tsearchQuery = '';\n\t\t\t\t\tdebouncedSearch('', selectedLibrary);\n\t\t\t\t}}\n\t\t\t\taria-label=\"Clear search\"\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"mdi:close\" width=\"20\"></iconify-icon>\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n\n\t<!-- Error message -->\n\t{#if searchError}\n\t\t<div\n\t\t\tid=\"search-error\"\n\t\t\tclass=\"mt-2 rounded-lg border-l-4 border-error-500 bg-error-50 p-3 text-sm text-error-700 dark:bg-error-900/20 dark:text-error-300\"\n\t\t\trole=\"alert\"\n\t\t\tin:fade={{ duration: prefersReducedMotion ? 0 : 200 }}\n\t\t>\n\t\t\t<div class=\"flex items-start gap-2\">\n\t\t\t\t<iconify-icon icon=\"mdi:alert-circle\" width=\"18\" aria-hidden=\"true\"></iconify-icon>\n\t\t\t\t<span>{searchError}</span>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<!-- Dropdown -->\n\t{#if showDropdown}\n\t\t<div\n\t\t\tid=\"icon-dropdown\"\n\t\t\tclass=\"mt-2 overflow-hidden rounded-lg border border-surface-200 bg-surface-50 shadow-2xl dark:text-surface-50 dark:bg-surface-800\"\n\t\t\trole=\"region\"\n\t\t\taria-label=\"Icon picker dropdown\"\n\t\t\tin:scale={{ duration: prefersReducedMotion ? 0 : 200, easing: quintOut, start: 0.95, opacity: 0 }}\n\t\t\tout:scale={{ duration: prefersReducedMotion ? 0 : 150, easing: quintOut, start: 0.95, opacity: 0 }}\n\t\t>\n\t\t\t<!-- Tabs -->\n\t\t\t<div class=\"flex border-b border-surface-200 dark:text-surface-50\" role=\"tablist\">\n\t\t\t\t<button\n\t\t\t\t\trole=\"tab\"\n\t\t\t\t\taria-selected={activeTab === 'search'}\n\t\t\t\t\tonclick={() => switchTab('search')}\n\t\t\t\t\tclass=\"flex-1 px-4 py-3 text-sm font-medium transition-colors {activeTab === 'search'\n\t\t\t\t\t\t? 'border-b-2 border-primary-500 text-primary-500'\n\t\t\t\t\t\t: 'text-surface-600 hover:text-surface-900 dark:text-surface-50 dark:hover:text-surface-100'}\"\n\t\t\t\t>\n\t\t\t\t\tSearch\n\t\t\t\t</button>\n\t\t\t\t{#if showFavorites && hasFavorites}\n\t\t\t\t\t<button\n\t\t\t\t\t\trole=\"tab\"\n\t\t\t\t\t\taria-selected={activeTab === 'favorites'}\n\t\t\t\t\t\tonclick={() => switchTab('favorites')}\n\t\t\t\t\t\tclass=\"flex-1 px-4 py-3 text-sm font-medium transition-colors {activeTab === 'favorites'\n\t\t\t\t\t\t\t? 'border-b-2 border-primary-500 text-primary-500'\n\t\t\t\t\t\t\t: 'text-surface-600 hover:text-surface-900 dark:text-surface-50 dark:hover:text-surface-100'}\"\n\t\t\t\t\t>\n\t\t\t\t\t\tFavorites ({favorites.length})\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t\t{#if hasRecent}\n\t\t\t\t\t<button\n\t\t\t\t\t\trole=\"tab\"\n\t\t\t\t\t\taria-selected={activeTab === 'recent'}\n\t\t\t\t\t\tonclick={() => switchTab('recent')}\n\t\t\t\t\t\tclass=\"flex-1 px-4 py-3 text-sm font-medium transition-colors {activeTab === 'recent'\n\t\t\t\t\t\t\t? 'border-b-2 border-primary-500 text-primary-500'\n\t\t\t\t\t\t\t: 'text-surface-600 hover:text-surface-900 dark:text-surface-50 dark:hover:text-surface-100'}\"\n\t\t\t\t\t>\n\t\t\t\t\t\tRecent ({recentSelections.length})\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<!-- Library selector (only for search tab) -->\n\t\t\t{#if activeTab === 'search'}\n\t\t\t\t<div class=\"border-b border-surface-200 p-4 dark:text-surface-50\" transition:slide={{ duration: prefersReducedMotion ? 0 : 200 }}>\n\t\t\t\t\t<label for=\"library-select\" class=\"mb-2 block text-sm font-medium\"> Icon Library </label>\n\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"library-select\"\n\t\t\t\t\t\t\tbind:value={selectedLibrary}\n\t\t\t\t\t\t\tonchange={handleLibraryChange}\n\t\t\t\t\t\t\tonclick={fetchIconLibraries}\n\t\t\t\t\t\t\tclass=\"input w-full\"\n\t\t\t\t\t\t\tdisabled={isLoadingLibraries}\n\t\t\t\t\t\t\taria-label=\"Select icon library\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\">All Libraries (Global Search)</option>\n\t\t\t\t\t\t\t{#if !librariesLoaded}\n\t\t\t\t\t\t\t\t<option value={DEFAULT_LIBRARY}>Loading libraries...</option>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t{#each sortedLibraries as [prefix, library] (prefix)}\n\t\t\t\t\t\t\t\t\t<option value={prefix}>\n\t\t\t\t\t\t\t\t\t\t{library.name} ({prefix}) — {library.total.toLocaleString()} icons\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<!-- Content -->\n\t\t\t<div class=\"h-80 overflow-y-auto p-4\" onscroll={handleScroll}>\n\t\t\t\t{#if isLoading && icons.length === 0}\n\t\t\t\t\t<!-- Loading state (initial) -->\n\t\t\t\t\t<div class=\"flex justify-center py-12\" in:fade={{ duration: prefersReducedMotion ? 0 : 200 }}>\n\t\t\t\t\t\t<div class=\"flex flex-col items-center gap-3\">\n\t\t\t\t\t\t\t<div class=\"h-10 w-10 animate-spin rounded-full border-4 border-primary-500 border-t-transparent\"></div>\n\t\t\t\t\t\t\t<p class=\"text-sm text-surface-600 dark:text-surface-50\">Loading icons...</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{:else if displayIcons.length > 0}\n\t\t\t\t\t<!-- Icon grid -->\n\t\t\t\t\t<div\n\t\t\t\t\t\tbind:this={gridRef}\n\t\t\t\t\t\tclass=\"grid grid-cols-6 gap-2 sm:grid-cols-8 md:grid-cols-10\"\n\t\t\t\t\t\trole=\"listbox\"\n\t\t\t\t\t\taria-label=\"Available icons\"\n\t\t\t\t\t\tin:fade={{ duration: prefersReducedMotion ? 0 : 300 }}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#each displayIcons as icon, index (icon)}\n\t\t\t\t\t\t\t{@const fullIconName = icon.includes(':') ? icon : `${selectedLibrary}:${icon}`}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tonclick={() => selectIcon(icon)}\n\t\t\t\t\t\t\t\tonkeydown={(e) => e.key === 'Enter' && selectIcon(icon)}\n\t\t\t\t\t\t\t\trole=\"option\"\n\t\t\t\t\t\t\t\taria-selected={iconselected === fullIconName || index === selectedIndex}\n\t\t\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\t\t\tclass=\"group relative flex cursor-pointer items-center justify-center rounded-lg p-3 transition-all duration-200 hover:scale-110 hover:bg-primary-500/10 focus:outline-none focus:ring-2 focus:ring-primary-500 active:scale-95 {index ===\n\t\t\t\t\t\t\t\tselectedIndex\n\t\t\t\t\t\t\t\t\t? 'ring-2 ring-primary-500'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\taria-label={`Select icon ${fullIconName}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<iconify-icon icon={fullIconName} width=\"24\" aria-hidden=\"true\" class=\"transition-colors duration-200 group-hover:text-primary-500\"\n\t\t\t\t\t\t\t\t></iconify-icon>\n\n\t\t\t\t\t\t\t\t{#if activeTab === 'favorites'}\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\ttoggleFavorite(icon);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tclass=\"absolute right-0 top-0 opacity-0 transition-opacity group-hover:opacity-100\"\n\t\t\t\t\t\t\t\t\t\taria-label=\"Remove from favorites\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:close-circle\" width=\"16\" class=\"text-error-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t<!-- Infinite Scroll Loading Indicator -->\n\t\t\t\t\t\t{#if isLoading}\n\t\t\t\t\t\t\t<div class=\"col-span-full py-4 text-center\">\n\t\t\t\t\t\t\t\t<iconify-icon icon=\"eos-icons:loading\" class=\"animate-spin text-surface-400\" width=\"24\"></iconify-icon>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<!-- Sentinel for IntersectionObserver (infinite scroll) -->\n\t\t\t\t\t\t{#if activeTab === 'search' && !isLoading}\n\t\t\t\t\t\t\t<div class=\"col-span-full h-4\" use:intersectionObserverAction></div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{:else if hasSearchQuery && activeTab === 'search'}\n\t\t\t\t\t<!-- No results -->\n\t\t\t\t\t<div class=\"flex flex-col items-center gap-3 py-12 text-center\" in:fade={{ duration: prefersReducedMotion ? 0 : 200 }}>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:magnify-close\" width=\"48\" class=\"text-surface-400\" aria-hidden=\"true\"></iconify-icon>\n\t\t\t\t\t\t<p class=\"text-surface-600 dark:text-surface-50\">\n\t\t\t\t\t\t\tNo icons found for \"<span class=\"font-medium\">{searchQuery}</span>\"\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<!-- Empty state -->\n\t\t\t\t\t<div class=\"flex flex-col items-center gap-3 py-12 text-center\" in:fade={{ duration: prefersReducedMotion ? 0 : 200 }}>\n\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\ticon={activeTab === 'favorites' ? 'mdi:heart-outline' : activeTab === 'recent' ? 'mdi:history' : 'mdi:magnify'}\n\t\t\t\t\t\t\twidth=\"48\"\n\t\t\t\t\t\t\tclass=\"text-surface-400\"\n\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t<p class=\"text-surface-600 dark:text-surface-50\">\n\t\t\t\t\t\t\t{#if activeTab === 'favorites'}\n\t\t\t\t\t\t\t\tNo favorite icons yet\n\t\t\t\t\t\t\t{:else if activeTab === 'recent'}\n\t\t\t\t\t\t\t\tNo recent selections\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\tStart typing to search icons\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n","<!--\n@file src/components/PermissionsSetting.svelte\n@component\n**Enhanced Permissions Management - Svelte 5 Optimized**\n\nAdvanced permission management interface with bulk actions and presets.\n\n@example\n```svelte\n<PermissionsSetting {permissions} {roles} {onUpdate} />\n```\n\n### Props\n- `permissions` (object): Current permissions configuration\n- `roles` (Role[]): Available roles\n- `onUpdate` (function): Callback when permissions change\n\n### Features\n- Visual permission matrix\n- Bulk permission actions (enable/disable all)\n- Permission presets (read-only, editor, admin)\n- Role search and filtering\n- Admin role protection\n- Undo/redo support\n- Export/import permissions\n- Full ARIA accessibility\n- Reduced motion support\n-->\n\n<script lang=\"ts\">\n\timport type { Role } from '@shared/database/auth/types';\n\timport { PermissionAction } from '@shared/database/auth/types';\n\timport { showToast } from '@shared/utils/toast';\n\timport { fade, slide } from 'svelte/transition';\n\timport { onMount } from 'svelte';\n\n\ttype PermissionsMap = Record<string, Record<string, boolean>>;\n\n\tinterface Props {\n\t\tpermissions?: PermissionsMap;\n\t\troles?: Role[];\n\t\tonUpdate?: (permissions: PermissionsMap) => void;\n\t}\n\n\tconst { permissions = {}, roles = [], onUpdate = () => {} }: Props = $props();\n\n\t// State\n\tlet error = $state<string | null>(null);\n\tlet searchQuery = $state('');\n\tlet showBulkActions = $state(false);\n\tlet prefersReducedMotion = $state(false);\n\tlet historyIndex = $state(-1);\n\tlet permissionsHistory = $state<PermissionsMap[]>([]);\n\n\t// Icons for permissions\n\tconst actionIcons: Record<PermissionAction, string> = {\n\t\t[PermissionAction.CREATE]: 'bi:plus-circle-fill',\n\t\t[PermissionAction.READ]: 'bi:eye-fill',\n\t\t[PermissionAction.WRITE]: 'bi:pencil-square',\n\t\t[PermissionAction.UPDATE]: 'bi:pencil-fill',\n\t\t[PermissionAction.DELETE]: 'bi:trash-fill',\n\t\t[PermissionAction.MANAGE]: 'bi:gear-fill',\n\t\t[PermissionAction.ACCESS]: 'bi:key-fill',\n\t\t[PermissionAction.EXECUTE]: 'bi:play-fill',\n\t\t[PermissionAction.SHARE]: 'bi:share-fill'\n\t};\n\n\t// Permission presets\n\tconst presets = {\n\t\t'read-only': {\n\t\t\tname: 'Read Only',\n\t\t\tdescription: 'Can only view content',\n\t\t\tpermissions: {\n\t\t\t\tread: true,\n\t\t\t\taccess: true,\n\t\t\t\tcreate: false,\n\t\t\t\twrite: false,\n\t\t\t\tupdate: false,\n\t\t\t\tdelete: false,\n\t\t\t\tmanage: false,\n\t\t\t\texecute: false,\n\t\t\t\tshare: false\n\t\t\t}\n\t\t},\n\t\teditor: {\n\t\t\tname: 'Editor',\n\t\t\tdescription: 'Can create and edit content',\n\t\t\tpermissions: {\n\t\t\t\tread: true,\n\t\t\t\taccess: true,\n\t\t\t\tcreate: true,\n\t\t\t\twrite: true,\n\t\t\t\tupdate: true,\n\t\t\t\tshare: true,\n\t\t\t\tdelete: false,\n\t\t\t\tmanage: false,\n\t\t\t\texecute: false\n\t\t\t}\n\t\t},\n\t\tadmin: {\n\t\t\tname: 'Administrator',\n\t\t\tdescription: 'Full access to everything',\n\t\t\tpermissions: Object.fromEntries(Object.values(PermissionAction).map((action) => [action, true]))\n\t\t}\n\t};\n\n\t// Initialize permissions with all roles\n\tfunction initializePermissions(currentPermissions: PermissionsMap, availableRoles: Role[]): PermissionsMap {\n\t\tconst initialized: PermissionsMap = { ...currentPermissions };\n\n\t\tavailableRoles.forEach((role) => {\n\t\t\tif (!initialized[role._id]) {\n\t\t\t\tinitialized[role._id] = Object.fromEntries(Object.values(PermissionAction).map((action) => [action, true]));\n\t\t\t}\n\t\t});\n\n\t\treturn initialized;\n\t}\n\n\t// Initialize state from props - use $derived to react to prop changes\n\tlet permissionsState = $derived(initializePermissions(permissions, roles));\n\n\t// Save to history\n\tfunction saveToHistory() {\n\t\tconst newHistory = permissionsHistory.slice(0, historyIndex + 1);\n\t\tnewHistory.push(JSON.parse(JSON.stringify(permissionsState)));\n\t\tpermissionsHistory = newHistory;\n\t\thistoryIndex = newHistory.length - 1;\n\t}\n\n\t// Undo/Redo\n\tfunction undo() {\n\t\tif (historyIndex > 0) {\n\t\t\thistoryIndex--;\n\t\t\tpermissionsState = JSON.parse(JSON.stringify(permissionsHistory[historyIndex]));\n\t\t\tupdateParent();\n\t\t}\n\t}\n\n\tfunction redo() {\n\t\tif (historyIndex < permissionsHistory.length - 1) {\n\t\t\thistoryIndex++;\n\t\t\tpermissionsState = JSON.parse(JSON.stringify(permissionsHistory[historyIndex]));\n\t\t\tupdateParent();\n\t\t}\n\t}\n\n\tconst canUndo = $derived(historyIndex > 0);\n\tconst canRedo = $derived(historyIndex < permissionsHistory.length - 1);\n\n\t// Toggle permission\n\tfunction togglePermission(roleId: string, action: PermissionAction) {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\n\t\tif (role?.isAdmin) {\n\t\t\tshowToast('Cannot modify permissions for admin role', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!permissionsState[roleId]) {\n\t\t\tpermissionsState[roleId] = {} as Record<string, boolean>;\n\t\t}\n\n\t\tpermissionsState[roleId][action] = !permissionsState[roleId][action];\n\t\tsaveToHistory();\n\t\tupdateParent();\n\t}\n\n\t// Bulk actions\n\tfunction setAllPermissionsForRole(roleId: string, value: boolean) {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\n\t\tif (role?.isAdmin) {\n\t\t\tshowToast('Cannot modify permissions for admin role', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tpermissionsState[roleId] = Object.fromEntries(Object.values(PermissionAction).map((action) => [action, value]));\n\n\t\tsaveToHistory();\n\t\tupdateParent();\n\t\tshowToast(`All permissions ${value ? 'enabled' : 'disabled'} for ${role?.name}`, 'success');\n\t}\n\n\tfunction setPermissionForAllRoles(action: PermissionAction, value: boolean) {\n\t\troles.forEach((role) => {\n\t\t\tif (!role.isAdmin) {\n\t\t\t\tpermissionsState[role._id][action] = value;\n\t\t\t}\n\t\t});\n\n\t\tsaveToHistory();\n\t\tupdateParent();\n\t\tshowToast(`${action} ${value ? 'enabled' : 'disabled'} for all roles`, 'success');\n\t}\n\n\t// Apply preset\n\tfunction applyPreset(roleId: string, presetKey: string) {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\n\t\tif (role?.isAdmin) {\n\t\t\tshowToast('Cannot modify permissions for admin role', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tconst preset = presets[presetKey as keyof typeof presets];\n\t\tif (preset) {\n\t\t\tpermissionsState[roleId] = { ...preset.permissions };\n\t\t\tsaveToHistory();\n\t\t\tupdateParent();\n\t\t\tshowToast(`Applied \"${preset.name}\" preset to ${role?.name}`, 'success');\n\t\t}\n\t}\n\n\t// Update parent\n\tfunction updateParent() {\n\t\tconst cleanedPermissions = Object.entries(permissionsState).reduce((acc, [roleId, perms]) => {\n\t\t\tconst hasRestrictions = Object.values(perms).some((value) => value === false);\n\t\t\tif (hasRestrictions) {\n\t\t\t\tacc[roleId] = perms;\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, {} as PermissionsMap);\n\n\t\tonUpdate(cleanedPermissions);\n\t}\n\n\t// Export permissions\n\tfunction exportPermissions() {\n\t\tconst data = JSON.stringify(permissionsState, null, 2);\n\t\tconst blob = new Blob([data], { type: 'application/json' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `permissions-${new Date().toISOString().split('T')[0]}.json`;\n\t\ta.click();\n\t\tURL.revokeObjectURL(url);\n\t\tshowToast('Permissions exported', 'success');\n\t}\n\n\t// Import permissions\n\tasync function importPermissions(event: Event) {\n\t\tconst input = event.target as HTMLInputElement;\n\t\tconst file = input.files?.[0];\n\n\t\tif (!file) return;\n\n\t\ttry {\n\t\t\tconst text = await file.text();\n\t\t\tconst imported = JSON.parse(text);\n\t\t\tpermissionsState = { ...permissionsState, ...imported };\n\t\t\tsaveToHistory();\n\t\t\tupdateParent();\n\t\t\tshowToast('Permissions imported successfully', 'success');\n\t\t} catch (err) {\n\t\t\tshowToast('Failed to import permissions', 'error');\n\t\t\terror = 'Invalid permissions file';\n\t\t}\n\t}\n\n\t// Filter roles\n\tconst filteredRoles = $derived(\n\t\troles.filter(\n\t\t\t(role) => role.name.toLowerCase().includes(searchQuery.toLowerCase()) || role.description?.toLowerCase().includes(searchQuery.toLowerCase())\n\t\t)\n\t);\n\n\t// Count enabled permissions per role\n\tfunction countEnabledPermissions(roleId: string): number {\n\t\treturn Object.values(permissionsState[roleId] || {}).filter(Boolean).length;\n\t}\n\n\tconst totalActions = $derived(Object.values(PermissionAction).length);\n\n\t// Lifecycle\n\tonMount(() => {\n\t\tconst mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n\t\tprefersReducedMotion = mediaQuery.matches;\n\n\t\tconst handleChange = (e: MediaQueryListEvent) => {\n\t\t\tprefersReducedMotion = e.matches;\n\t\t};\n\n\t\tmediaQuery.addEventListener('change', handleChange);\n\n\t\t// Initialize history\n\t\tsaveToHistory();\n\n\t\treturn () => mediaQuery.removeEventListener('change', handleChange);\n\t});\n</script>\n\n{#if error}\n\t<div\n\t\tclass=\"rounded-lg border-l-4 border-error-500 bg-error-50 p-4 text-error-700 dark:bg-error-900/20 dark:text-error-300\"\n\t\trole=\"alert\"\n\t\ttransition:fade={{ duration: prefersReducedMotion ? 0 : 200 }}\n\t>\n\t\t<div class=\"flex items-start gap-3\">\n\t\t\t<span class=\"text-2xl\" role=\"img\" aria-label=\"Error\">⚠️</span>\n\t\t\t<div class=\"flex-1\">\n\t\t\t\t<p class=\"font-semibold\">Error</p>\n\t\t\t\t<p class=\"mt-1 text-sm\">{error}</p>\n\t\t\t</div>\n\t\t\t<button onclick={() => (error = null)} class=\"preset-outlined-error-500 btn-sm\" aria-label=\"Dismiss error\"> Dismiss </button>\n\t\t</div>\n\t</div>\n{:else}\n\t<div class=\"flex flex-col gap-4\" role=\"region\" aria-label=\"Permission settings\">\n\t\t<!-- Toolbar -->\n\t\t<div class=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n\t\t\t<!-- Search -->\n\t\t\t<div class=\"flex-1\">\n\t\t\t\t<input bind:value={searchQuery} placeholder=\"Search roles...\" class=\"input w-full\" type=\"search\" aria-label=\"Search roles\" />\n\t\t\t</div>\n\n\t\t\t<!-- Actions -->\n\t\t\t<div class=\"flex flex-wrap gap-2\">\n\t\t\t\t<!-- Undo/Redo -->\n\t\t\t\t<button onclick={undo} disabled={!canUndo} class=\"preset-outlined-surface-500btn btn-sm\" title=\"Undo\" aria-label=\"Undo last change\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:undo\" width=\"18\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t\t<button onclick={redo} disabled={!canRedo} class=\"preset-outlined-surface-500btn btn-sm\" title=\"Redo\" aria-label=\"Redo last change\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:redo\" width=\"18\"></iconify-icon>\n\t\t\t\t</button>\n\n\t\t\t\t<!-- Bulk Actions Toggle -->\n\t\t\t\t<button onclick={() => (showBulkActions = !showBulkActions)} class=\"preset-outlined-primary-500 btn-sm\" aria-expanded={showBulkActions}>\n\t\t\t\t\t<iconify-icon icon=\"mdi:cog-box\" width=\"18\"></iconify-icon>\n\t\t\t\t\tBulk Actions\n\t\t\t\t</button>\n\n\t\t\t\t<!-- Export -->\n\t\t\t\t<button\n\t\t\t\t\tonclick={exportPermissions}\n\t\t\t\t\tclass=\"preset-outlined-primary-500 btn-sm\"\n\t\t\t\t\ttitle=\"Export permissions\"\n\t\t\t\t\taria-label=\"Export permissions as JSON\"\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon=\"mdi:download\" width=\"18\"></iconify-icon>\n\t\t\t\t</button>\n\n\t\t\t\t<!-- Import -->\n\t\t\t\t<label class=\"preset-outlined-warning-500 btn-sm cursor-pointer\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:upload\" width=\"18\"></iconify-icon>\n\t\t\t\t\t<input type=\"file\" accept=\".json\" onchange={importPermissions} class=\"hidden\" aria-label=\"Import permissions from JSON\" />\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Bulk Actions Panel -->\n\t\t{#if showBulkActions}\n\t\t\t<div\n\t\t\t\tclass=\"rounded-lg border border-primary-200 bg-primary-50 p-4 dark:border-primary-800 dark:bg-primary-900/20\"\n\t\t\t\ttransition:slide={{ duration: prefersReducedMotion ? 0 : 200 }}\n\t\t\t>\n\t\t\t\t<h3 class=\"mb-3 text-sm font-semibold\">Bulk Actions</h3>\n\t\t\t\t<div class=\"flex flex-wrap gap-2\">\n\t\t\t\t\t{#each Object.values(PermissionAction) as action (action)}\n\t\t\t\t\t\t<div class=\"flex gap-1\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonclick={() => setPermissionForAllRoles(action, true)}\n\t\t\t\t\t\t\t\tclass=\"preset-filled-success-500 btn-sm\"\n\t\t\t\t\t\t\t\ttitle={`Enable ${action} for all roles`}\n\t\t\t\t\t\t\t\taria-label={`Enable ${action} for all roles`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<iconify-icon icon={actionIcons[action]} width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t✓\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonclick={() => setPermissionForAllRoles(action, false)}\n\t\t\t\t\t\t\t\tclass=\"preset-filled-error-500 btn-sm\"\n\t\t\t\t\t\t\t\ttitle={`Disable ${action} for all roles`}\n\t\t\t\t\t\t\t\taria-label={`Disable ${action} for all roles`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<iconify-icon icon={actionIcons[action]} width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t✗\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<!-- Permissions Table -->\n\t\t<div class=\"overflow-x-auto rounded-lg border border-surface-200 dark:text-surface-50\">\n\t\t\t<table class=\"table w-full\" role=\"grid\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th scope=\"col\" class=\"px-4 py-3 text-left\">\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\tRole\n\t\t\t\t\t\t\t\t<span class=\"text-xs font-normal opacity-70\">\n\t\t\t\t\t\t\t\t\t({filteredRoles.length})\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</th>\n\t\t\t\t\t\t{#each Object.values(PermissionAction) as action (action)}\n\t\t\t\t\t\t\t<th scope=\"col\" class=\"px-4 py-3 text-center\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-col items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<iconify-icon icon={actionIcons[action]} width=\"20\" aria-hidden=\"true\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t<span class=\"text-xs\">{action}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t<th scope=\"col\" class=\"px-4 py-3 text-center\"> Actions </th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t{#each filteredRoles as role (role._id)}\n\t\t\t\t\t\t<tr class=\"border-t border-surface-200 dark:text-surface-50\">\n\t\t\t\t\t\t\t<!-- Role Info -->\n\t\t\t\t\t\t\t<th scope=\"row\" class=\"px-4 py-3\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-col gap-1\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"font-semibold\">{role.name}</span>\n\t\t\t\t\t\t\t\t\t\t{#if role.isAdmin}\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge preset-filled-primary-500 text-xs\"> Admin </span>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{#if role.description}\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-xs text-surface-600 dark:text-surface-50\">\n\t\t\t\t\t\t\t\t\t\t\t{role.description}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-primary-500\">\n\t\t\t\t\t\t\t\t\t\t{countEnabledPermissions(role._id)}/{totalActions} enabled\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</th>\n\n\t\t\t\t\t\t\t<!-- Permission Toggles -->\n\t\t\t\t\t\t\t{#each Object.values(PermissionAction) as action (action)}\n\t\t\t\t\t\t\t\t<td class=\"px-4 py-3 text-center\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={() => togglePermission(role._id, action)}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\taria-label={`${permissionsState[role._id]?.[action] ? 'Disable' : 'Enable'} ${action} for ${role.name}`}\n\t\t\t\t\t\t\t\t\t\tclass=\"btn-icon transition-all duration-200 {permissionsState[role._id]?.[action]\n\t\t\t\t\t\t\t\t\t\t\t? 'preset-filled-success-500 hover:scale-110'\n\t\t\t\t\t\t\t\t\t\t\t: 'preset-filled-error-500 opacity-50 hover:opacity-100 hover:scale-110'} {role.isAdmin ? 'cursor-not-allowed opacity-30' : ''}\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\t\ticon={permissionsState[role._id]?.[action] ? 'mdi:check' : 'mdi:check'}\n\t\t\t\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\t\t\t\tclass={permissionsState[role._id]?.[action] ? 'text-white' : 'text-white'}\n\t\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t\t<!-- Row Actions -->\n\t\t\t\t\t\t\t<td class=\"px-4 py-3 text-center\">\n\t\t\t\t\t\t\t\t<div class=\"flex justify-center gap-1\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={() => setAllPermissionsForRole(role._id, true)}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\tclass=\"preset-outlined-primary-500 btn-sm\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Enable all\"\n\t\t\t\t\t\t\t\t\t\taria-label={`Enable all permissions for ${role.name}`}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t✓ All\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={() => setAllPermissionsForRole(role._id, false)}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\tclass=\"preset-outlined-error-500 btn-sm\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Disable all\"\n\t\t\t\t\t\t\t\t\t\taria-label={`Disable all permissions for ${role.name}`}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t✗ All\n\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t<!-- Preset Dropdown -->\n\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\tonchange={(e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst target = e.target as HTMLSelectElement;\n\t\t\t\t\t\t\t\t\t\t\tif (target.value) {\n\t\t\t\t\t\t\t\t\t\t\t\tapplyPreset(role._id, target.value);\n\t\t\t\t\t\t\t\t\t\t\t\ttarget.value = '';\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\tclass=\"input w-auto px-2 py-1 text-xs\"\n\t\t\t\t\t\t\t\t\t\taria-label={`Apply preset to ${role.name}`}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<option value=\"\">Preset...</option>\n\t\t\t\t\t\t\t\t\t\t{#each Object.entries(presets) as [key, preset] (key)}\n\t\t\t\t\t\t\t\t\t\t\t<option value={key}>{preset.name}</option>\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/each}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\n\t\t<!-- No Results -->\n\t\t{#if filteredRoles.length === 0}\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col items-center gap-3 rounded-lg bg-surface-50 py-12 text-center dark:bg-surface-800\"\n\t\t\t\ttransition:fade={{ duration: prefersReducedMotion ? 0 : 200 }}\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"mdi:magnify-close\" width=\"48\" class=\"text-surface-400\"></iconify-icon>\n\t\t\t\t<p class=\"text-surface-600 dark:text-surface-50\">\n\t\t\t\t\tNo roles match your search for \"<span class=\"font-medium\">{searchQuery}</span>\"\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n{/if}\n","<!-- \n@file src/components/system/inputs/Input.svelte\n@component \n**Component for file input**\n\n### Props:\n- `type`: 'text' | 'password' | 'email' - Type of the input field.\n- `label`: string - Label for the input field.\n- `labelClass`: string - Additional classes for the label.\n- `inputClass`: string - Additional classes for the input field.\n- `placeholder`: string - Placeholder text for the input field.\n- `value`: string - Value of the input field.\n\n### Features:\n- File input \n- Multiple file input\n- Drag and drop\n-->\n\n<script lang=\"ts\">\n\tinterface InputProps {\n\t\ttype: 'text' | 'password' | 'email';\n\t\tlabel?: string;\n\t\tlabelClass?: string;\n\t\tinputClass?: string;\n\t\tplaceholder?: string;\n\t\tvalue?: string;\n\t}\n\n\tlet { type = 'text', label, labelClass, inputClass, placeholder, value = $bindable('') }: InputProps = $props();\n\tfunction typeAction(node: HTMLInputElement) {\n\t\tnode.type = type;\n\t}\n</script>\n\n<div class=\"m-1 flex max-w-full items-center justify-between gap-2\">\n\t{#if label}\n\t\t<label for=\"input\" class=\"w-32 flex-none {labelClass}\">{label}</label>\n\t{/if}\n\t<input use:typeAction id=\"input\" class=\"input grow text-black dark:text-primary-500 {inputClass}\" bind:value {placeholder} />\n</div>\n","<!-- \n@file src/components/system/inputs/Toggles.svelte\n@component\n**Toggle switch component with customizable icons and labels**\n\n### Props\n- `value` {boolean}: The toggle state (bindable)\n- `label` {string}: Label displayed next to the toggle (default: '')\n- `labelColor` {string}: Color class for the label when off (default: 'text-primary-500')\n- `iconOn` {string}: Icon to display when toggle is on (default: '')\n- `iconOff` {string}: Icon to display when toggle is off (default: '')\n- `size` {'sm' | 'md' | 'lg'}: Size of the toggle (default: 'md')\n- `disabled` {boolean}: Whether the toggle is disabled (default: false)\n- `title` {string}: Title attribute for the toggle (default: '')\n- `onChange` {(changed: boolean) => void}: Callback function when toggle state changes (optional)\t\n\n### Features:\n- Customizable icons for on/off states\n- Size options for different UI needs\n- Disabled state handling\n- Accessible with proper labeling and focus management\n-->\n\n<script lang=\"ts\">\n\timport { logger } from '@shared/utils/logger';\n\n\timport type { TogglesProps } from './types';\n\n\tlet {\n\t\tvalue = $bindable(false),\n\t\tlabel = '',\n\t\tlabelColor = 'text-primary-500',\n\t\ticonOn = '',\n\t\ticonOff = '',\n\t\tsize = 'md',\n\t\tdisabled = false,\n\t\ttitle = '',\n\t\tonChange = undefined\n\t}: TogglesProps = $props();\n\n\t// Generate a unique ID for a11y\n\tconst id = `toggle-${Math.random().toString(36).substring(2, 9)}`;\n\n\t// Handle toggle state change\n\tfunction handleToggle(event: Event) {\n\t\tif (disabled) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tconst checked = (event.target as HTMLInputElement).checked;\n\n\t\tvalue = checked;\n\n\t\ttry {\n\t\t\tonChange?.(checked);\n\t\t} catch (error) {\n\t\t\tlogger.error('[Toggles] Error in onChange callback:', error);\n\t\t}\n\t}\n\n\t// Compute classes and sizes using $derived\n\tconst trackClasses = $derived(\n\t\t{\n\t\t\tsm: 'h-6 w-10 min-w-[40px]', // Ensure minimum touch target size\n\t\t\tmd: 'h-8 w-14 min-w-[48px]',\n\t\t\tlg: 'h-10 w-20 min-w-[56px]'\n\t\t}[size]\n\t);\n\n\tconst dotClasses = $derived(\n\t\t{\n\t\t\tsm: 'h-4 w-4 peer-checked:translate-x-5',\n\t\t\tmd: 'h-6 w-6 peer-checked:translate-x-7',\n\t\t\tlg: 'h-8 w-8 peer-checked:translate-x-11'\n\t\t}[size]\n\t);\n\n\tconst iconSize = $derived(\n\t\t{\n\t\t\tsm: '16',\n\t\t\tmd: '24',\n\t\t\tlg: '32'\n\t\t}[size]\n\t);\n</script>\n\n<label for={id} class=\"flex cursor-pointer select-none items-center gap-2\" class:opacity-50={disabled} class:cursor-not-allowed={disabled} {title}>\n\t{#if label}\n\t\t<span class=\"capitalize {value ? 'text-primary-500' : labelColor}\">{label}</span>\n\t{/if}\n\n\t<div class=\"relative\">\n\t\t<input name={label || 'toggle'} type=\"checkbox\" {id} bind:checked={value} {disabled} class=\"peer sr-only\" onchange={handleToggle} />\n\n\t\t<!-- Background track -->\n\t\t<div class=\"{trackClasses} rounded-full bg-error-500 transition-colors peer-checked:bg-primary-500\">\n\t\t\t<!-- Sliding dot -->\n\t\t\t<div\n\t\t\t\tclass=\"{dotClasses} absolute left-1 top-1 flex items-center justify-center rounded-full bg-white transition-transform\"\n\t\t\t\tclass:bg-surface-400={disabled}\n\t\t\t>\n\t\t\t\t{#if iconOn && iconOff}\n\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\ticon={value ? iconOn : iconOff}\n\t\t\t\t\t\twidth={iconSize}\n\t\t\t\t\t\tclass={value ? 'text-primary-500' : 'text-error-500'}\n\t\t\t\t\t\tclass:text-surface-600={disabled}\n\t\t\t\t\t></iconify-icon>\n\t\t\t\t{:else}\n\t\t\t\t\t<span class=\"text-[10px] font-bold {value ? 'text-primary-500' : 'text-error-500'}\" class:text-surface-600={disabled}>\n\t\t\t\t\t\t{value ? 'ON' : 'OFF'}\n\t\t\t\t\t</span>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</label>\n\n<style>\n\t/* Ensure minimum touch target size */\n\tinput[type='checkbox'] {\n\t\ttouch-action: manipulation; /* Improve touch responsiveness */\n\t}\n</style>\n","/**\n * @file src/widgets/widgetFactory.ts\n * @description The definitive, type-safe Widget Factory for SveltyCMS.\n *\n * @features\n * - Generic-based for supreme type safety on widget-specific properties.\n * - Implements the \"Three Pillars\" architecture: Definition, Input, and Display.\n * - Integrates Valibot for declarative, type-safe data validation.\n * - Clean, modern, and free of legacy patterns.\n */\n\nimport type { BaseIssue, BaseSchema } from 'valibot';\nimport type { FieldInstance } from '@cms-types';\nimport type { WidgetDefinition, WidgetFactory } from '@widgets/types';\n\n// A base constraint for widget-specific properties.\ntype WidgetProps = Record<string, unknown>;\n\nexport type FieldConfig<TProps extends WidgetProps = WidgetProps> = {\n\twidget?: any;\n\tlabel?: string;\n\tdb_fieldName?: string;\n\tpermissions?: any;\n\t[key: string]: any;\n} & TProps;\n\n/**\n * The configuration for DEFINING a widget's blueprint.\n * It's generic over the widget's custom props (TProps).\n */\nexport interface WidgetConfig<TProps extends WidgetProps = WidgetProps> {\n\tName: string;\n\tIcon?: string;\n\tDescription?: string;\n\n\t/** Path to the interactive INPUT component used in the editor (e.g., Fields.svelte). */\n\tinputComponentPath?: string;\n\n\t/** Path to the lightweight DISPLAY component for lists (e.g., EntryList.svelte). */\n\tdisplayComponentPath?: string;\n\n\t/** Type-safe default values for the widget's custom properties. */\n\tdefaults?: Partial<TProps>;\n\n\t/**\n\t * Valibot validation schema for the widget's data.\n\t *  Accepts either a static schema object (Valibot BaseSchema) or a function that receives the FieldInstance and returns one.\n\t *  Kept as `unknown` to avoid over-constraining the factory; callers may provide properly-typed Valibot schemas.\n\t */\n\tvalidationSchema: unknown | ((field: FieldInstance) => unknown);\n\n\t// Optional advanced features\n\tGuiSchema?: Record<string, unknown>;\n\tGraphqlSchema?: (params: { field: unknown; label: string; collection: unknown; collectionNameMapping?: Map<string, string> }) => {\n\t\ttypeID: string | null;\n\t\tgraphql: string;\n\t\tresolver?: Record<string, unknown>;\n\t};\n\taggregations?: unknown;\n\n\t/** Optional function to return widget-specific translatable paths. */\n\tgetTranslatablePaths?: (basePath: string) => string[];\n}\n\n/**\n * Creates a new SveltyCMS widget factory.\n * @param config The static definition of the widget (its blueprint).\n * @returns A function that can be called to create type-safe field instances.\n */\nexport function createWidget<TProps extends WidgetProps = WidgetProps>(config: WidgetConfig<TProps>): WidgetFactory<TProps> {\n\t// 1. Create the immutable widget definition once.\n\t// This now includes all the \"Three Pillars\" information.\n\tconst widgetDefinition: WidgetDefinition = {\n\t\twidgetId: config.Name,\n\t\tName: config.Name,\n\t\tIcon: config.Icon,\n\t\tDescription: config.Description,\n\t\tinputComponentPath: config.inputComponentPath || '',\n\t\tdisplayComponentPath: config.displayComponentPath || '',\n\t\t// validationSchema may be a function or a static schema. Keep as-is so other systems can call it.\n\t\tvalidationSchema: config.validationSchema as unknown as BaseSchema<unknown, unknown, BaseIssue<unknown>>,\n\t\tdefaults: config.defaults,\n\t\tGuiFields: config.GuiSchema || ({} as Record<string, unknown>),\n\t\taggregations: config.aggregations as WidgetDefinition['aggregations'],\n\t\tgetTranslatablePaths: config.getTranslatablePaths\n\t\t// ... other definition properties like GraphqlSchema\n\t};\n\n\t// 2. Return the factory function that creates field instances.\n\tconst widgetFactoryFunction = (fieldConfig: FieldConfig<TProps>): FieldInstance => {\n\t\tconst fieldInstance: FieldInstance = {\n\t\t\twidget: widgetDefinition,\n\t\t\tlabel: fieldConfig.label, // Will be overridden by fieldConfig later if present\n\t\t\tdb_fieldName: '', // Will be set below\n\t\t\trequired: false, // Will be overridden by fieldConfig or config.defaults later\n\t\t\ttranslated: false, // Will be overridden by fieldConfig or config.defaults later\n\t\t\twidth: undefined, // Will be overridden by fieldConfig or config.defaults later\n\t\t\thelper: undefined, // Will be overridden by fieldConfig or config.defaults later\n\t\t\tpermissions: undefined // Will be overridden by fieldConfig or config.defaults later\n\t\t} as FieldInstance; // Cast to FieldInstance to allow adding custom properties\n\n\t\t// 1. Apply defaults from config.defaults (for custom properties)\n\t\tif (config.defaults) {\n\t\t\t// logger.debug(`[WidgetFactory] Applying defaults for ${config.Name}`, { defaults: config.defaults });\n\t\t\tfor (const key in config.defaults) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(config.defaults, key)) {\n\t\t\t\t\tconst value = (config.defaults as Record<string, unknown>)[key];\n\t\t\t\t\t(fieldInstance as Record<string, unknown>)[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 2. Apply fieldConfig properties, overriding defaults and initial standard values\n\t\tfor (const key in fieldConfig) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(fieldConfig, key)) {\n\t\t\t\tconst value = (fieldConfig as Record<string, unknown>)[key];\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t// Only apply if not undefined\n\t\t\t\t\t(fieldInstance as Record<string, unknown>)[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 3. Handle specific standard property defaults and generation after all merges\n\t\tfieldInstance.required = fieldInstance.required ?? false;\n\t\tfieldInstance.translated = fieldInstance.translated ?? false;\n\t\tif (!fieldInstance.db_fieldName && fieldInstance.label) {\n\t\t\tfieldInstance.db_fieldName = fieldInstance.label\n\t\t\t\t.toLowerCase()\n\t\t\t\t.replace(/\\s+/g, '_')\n\t\t\t\t.replace(/[^a-z0-9_]/g, '');\n\t\t} else if (!fieldInstance.db_fieldName) {\n\t\t\tfieldInstance.db_fieldName = 'unnamed_field';\n\t\t}\n\n\t\treturn fieldInstance;\n\t};\n\n\t// 3. Attach metadata to the factory for compatibility with existing system\n\twidgetFactoryFunction.Name = config.Name;\n\twidgetFactoryFunction.Icon = config.Icon;\n\twidgetFactoryFunction.Description = config.Description;\n\twidgetFactoryFunction.GuiSchema = config.GuiSchema;\n\twidgetFactoryFunction.GraphqlSchema = config.GraphqlSchema;\n\twidgetFactoryFunction.aggregations = config.aggregations as WidgetDefinition['aggregations'];\n\twidgetFactoryFunction.__inputComponentPath = config.inputComponentPath || '';\n\twidgetFactoryFunction.__displayComponentPath = config.displayComponentPath || '';\n\twidgetFactoryFunction.toString = () => '';\n\n\t// 4. Return the clean factory.\n\treturn widgetFactoryFunction as WidgetFactory<TProps>;\n}\n","/**\n * @file src/widgets/core/Checkbox/index.ts\n * @description Definition of the Checkbox widget\n *\n * Implements a robust date range widget using the Three Pillars Architecture.\n *\n * @features\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { boolean, type InferInput as ValibotInput } from 'valibot';\n\nimport type { CheckboxProps } from './types';\n\n// ParaglideJS\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the data this widget stores.\nconst CheckboxValidationSchema = boolean('Must be a boolean.');\n\n// Create the widget definition using the factory.\nconst CheckboxWidget = createWidget<CheckboxProps>({\n\tName: 'Checkbox',\n\tIcon: 'tabler:checkbox',\n\tDescription: m.widget_checkbox_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Checkbox/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Checkbox/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: CheckboxValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tcolor: 'primary',\n\t\tsize: 'md',\n\t\ttranslated: false // A simple boolean is typically not translated.\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false }\n\t},\n\n\t// Correct database aggregation logic for booleans.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [{ $match: { [field.db_fieldName]: filter === 'true' } }],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema should return a simple Boolean.\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Boolean', // Use primitive Boolean type\n\t\tgraphql: '' // No custom type definition needed for primitives\n\t})\n});\n\nexport default CheckboxWidget;\n\n// Export helper types for use in Svelte components.\nexport type FieldType = ReturnType<typeof CheckboxWidget>;\nexport type CheckboxWidgetData = ValibotInput<typeof CheckboxValidationSchema>;\n","/**\n * @file src/widgets/core/Date/index.ts\n * @description Date Widget Definition\n *\n * Implements date widget using the Three Pillars Architecture.\n * Stores dates in ISO 8601 UTC format for consistency across timezones while\n * providing localized display and native HTML date input experience.\n *\n * @features\n * - **ISO 8601 Storage**: All dates stored in standardized UTC format\n * - **Valibot Validation**: Type-safe validation with runtime checking\n * - **Three Pillars Architecture**: Separated Definition/Input/Display components\n * - **Timezone Consistency**: Handles user timezones transparently\n * - **Database Aggregation**: Advanced filtering and sorting for date ranges\n * - **Localized Display**: Automatic formatting based on user's browser locale\n * - **Native Date Picker**: Uses browser's built-in date input for optimal UX\n * - **Error Handling**: Deterministic IDs, proper error handling\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { isoDate, minLength, pipe, string, type InferInput as ValibotInput } from 'valibot';\n\nimport type { DateProps } from './types';\n\n// ParaglideJS\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the data this widget stores.\nconst DateValidationSchema = pipe(\n\tstring('A value is required.'), // This message shows if the value is not a string\n\tminLength(1, 'This date is required.'), // This message shows for empty strings\n\tisoDate('The date must be a valid ISO 8601 string.')\n);\n\n// Create the widget definition using the factory.\nconst DateWidget = createWidget<DateProps>({\n\tName: 'Date',\n\tIcon: 'mdi:calendar',\n\tDescription: m.widget_date_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Date/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Date/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: DateValidationSchema,\n\n\t// Set widget-specific defaults. A date is typically not translated.\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false },\n\t\tminDate: { widget: Input, required: false },\n\t\tmaxDate: { widget: Input, required: false },\n\t\tdisplayFormat: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\tplaceholder: 'medium (short, medium, long, full)'\n\t\t}\n\t},\n\n\t// Define correct database aggregation logic for dates.\n\taggregations: {\n\t\t/**\n\t\t * Filters entries based on a date or date range.\n\t\t * Expects filter string format: \"YYYY-MM-DD\" or \"YYYY-MM-DD_YYYY-MM-DD\"\n\t\t */\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => {\n\t\t\tconst fieldName = field.db_fieldName;\n\t\t\tconst [startDateStr, endDateStr] = filter.split('_');\n\n\t\t\tconst startDate = new Date(startDateStr);\n\t\t\tstartDate.setUTCHours(0, 0, 0, 0); // Start of the day\n\n\t\t\tif (isNaN(startDate.getTime())) return []; // Invalid date\n\n\t\t\t// Handle date range\n\t\t\tif (endDateStr) {\n\t\t\t\tconst endDate = new Date(endDateStr);\n\t\t\t\tendDate.setUTCHours(23, 59, 59, 999); // End of the day\n\t\t\t\tif (!isNaN(endDate.getTime())) {\n\t\t\t\t\treturn [{ $match: { [fieldName]: { $gte: startDate, $lte: endDate } } }];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Handle single day\n\t\t\tconst endOfDay = new Date(startDate);\n\t\t\tendOfDay.setUTCHours(23, 59, 59, 999);\n\t\t\treturn [{ $match: { [fieldName]: { $gte: startDate, $lte: endOfDay } } }];\n\t\t},\n\t\t// Sorts entries by the date field.\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for date\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // ISO 8601 date string\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default DateWidget;\n\n// Export helper types for use in Svelte components\nexport type FieldType = ReturnType<typeof DateWidget>;\nexport type DateWidgetData = ValibotInput<typeof DateValidationSchema>;\n","/**\n * @file src/widgets/core/Daterange/index.ts\n * @description DateRange Widget Definition.\n *\n * Implements a robust date range widget using the Three Pillars Architecture.\n * Stores a start and end date object in ISO 8601 UTC format.\n *\n * @features\n * - **Complex Object Storage**: Manages a `{ start, end }` data structure.\n * - **Advanced Validation**: Uses Valibot `refine` to ensure end date is after start date.\n * - **Timezone Consistency**: Stores all dates in UTC to prevent timezone bugs.\n * - **Database Aggregation**: Powerful filter to find entries where a date falls within the range.\n * - **Native Date Pickers**: Uses two native date inputs for a lightweight and accessible UX.\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { check, isoDate, minLength, object, pipe, string, type InferInput as ValibotInput } from 'valibot';\n\nimport type { DateRangeProps } from './types';\n\n//ParaglideJS\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the `{ start, end }` object.\nconst DateRangeValidationSchema = pipe(\n\tobject({\n\t\tstart: pipe(string(), minLength(1, 'Start date is required.'), isoDate()),\n\t\tend: pipe(string(), minLength(1, 'End date is required.'), isoDate())\n\t}),\n\tcheck((data) => new Date(data.start) <= new Date(data.end), 'End date must be on or after the start date.')\n);\n\n// Create the widget definition using the factory.\nconst DateRangeWidget = createWidget<DateRangeProps>({\n\tName: 'DateRange',\n\tIcon: 'mdi:calendar-range',\n\tDescription: m.widget_dateRange_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Daterange/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Daterange/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: DateRangeValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false }\n\t},\n\n\t// Define database aggregation logic for date ranges.\n\taggregations: {\n\t\t/**\n\t\t * Filters for entries where the provided date falls within the entry's date range.\n\t\t * Expects filter string format: \"YYYY-MM-DD\"\n\t\t */\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => {\n\t\t\tconst fieldName = field.db_fieldName;\n\t\t\tconst filterDate = new Date(filter);\n\t\t\tif (isNaN(filterDate.getTime())) return [];\n\n\t\t\t// Find documents where the filterDate is between the start and end fields.\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\t$match: {\n\t\t\t\t\t\t[`${fieldName}.start`]: { $lte: filterDate },\n\t\t\t\t\t\t[`${fieldName}.end`]: { $gte: filterDate }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t},\n\t\t// Sorting will be based on the start date of the range.\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[`${field.db_fieldName}.start`]: sortDirection\n\t\t})\n\t}\n});\n\nexport default DateRangeWidget;\n\n// Export helper types for use in Svelte components.\nexport type FieldType = ReturnType<typeof DateRangeWidget>;\nexport type DateRangeWidgetData = ValibotInput<typeof DateRangeValidationSchema>;\n","/**\n * @file src/widgets/core/Group/index.ts\n * @description Group Widget Definition.\n *\n * Implements a Group widget using the Three Pillars Architecture.\n * Groups multiple fields together for better organization and user experience.\n *\n * @features\n * - **Field Organization**: Groups related fields together visually\n * - **Collapsible Sections**: Optional collapsible functionality for better UX\n * - **Visual Variants**: Different styling options (default, card, bordered)\n * - **Accessibility**: Proper ARIA attributes and keyboard navigation\n * - **Responsive Design**: Adapts to different screen sizes\n * - **Nested Structure**: Can contain other widgets within the group\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\nimport { object, type InferInput as ValibotInput } from 'valibot';\n\nimport type { GroupProps } from './types';\n\n// Define the validation schema for the group data.\n// Groups can contain any data structure, so we use a flexible object schema.\nconst GroupValidationSchema = object({});\n\n// Create the widget definition using the factory.\nconst GroupWidget = createWidget<GroupProps>({\n\tName: 'Group',\n\tIcon: 'mdi:folder-outline',\n\tDescription: 'Group related fields together',\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Group/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Group/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: GroupValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tcollapsible: false,\n\t\tcollapsed: false,\n\t\tvariant: 'default'\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tgroupTitle: { widget: Input, required: false },\n\t\tcollapsible: { widget: Toggles, required: false },\n\t\tcollapsed: { widget: Toggles, required: false },\n\t\tvariant: { widget: Input, required: false },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false }\n\t},\n\n\t// Groups don't typically need database aggregations as they contain other widgets\n\taggregations: {}\n});\n\nexport default GroupWidget;\n\n// Export helper types for use in Svelte components.\nexport type FieldType = ReturnType<typeof GroupWidget>;\nexport type GroupWidgetData = ValibotInput<typeof GroupValidationSchema>;\n","/**\n * @file src/widgets/core/Input/index.ts\n * @description Input Widget Definition - Text Input\n *\n * Implements a professional text input widget using the Three Pillars Architecture.\n * This widget is specialized for text content and supports full translation capabilities.\n *\n * @features\n * - **Text-Only**: Focused implementation for text content (use specialized widgets for email/phone/number)\n * - **Dynamic Validation**: Schema is generated based on `required`, `minLength`, `maxLength`, etc.\n * - **Configurable GUI**: `GuiSchema` allows easy configuration in the Collection Builder.\n * - **Translatable**: Fully supports multilingual content entry by default.\n * - **Database Aggregation**: Supports case-insensitive text search and sorting.\n * - **Character Counting**: Visual feedback for length constraints\n * - **Prefix/Suffix Support**: Flexible UI composition\n */\n\n// Import components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport {\n\tmaxLength,\n\tminLength,\n\toptional,\n\tpipe,\n\tstring,\n\ttransform,\n\ttype BaseIssue,\n\ttype BaseSchema,\n\ttype InferInput as ValibotInput,\n\trecord\n} from 'valibot';\nimport type { InputProps } from './types';\n\n// ✅ SSOT: Validation Schema - Exported for use in Input.svelte\nexport const createValidationSchema = (field: ReturnType<typeof InputWidget>): BaseSchema<unknown, unknown, BaseIssue<unknown>> => {\n\t// Build a string schema with text-specific rules\n\tconst stringRules: Array<unknown> = [transform((s: string) => (typeof s === 'string' ? s.trim() : s))];\n\n\tif (field.required) stringRules.push(minLength(1, 'This field is required.'));\n\tif ((field as InputProps).minLength)\n\t\tstringRules.push(minLength((field as InputProps).minLength as number, `Must be at least ${(field as InputProps).minLength} characters.`));\n\tif ((field as InputProps).maxLength)\n\t\tstringRules.push(maxLength((field as InputProps).maxLength as number, `Must be no more than ${(field as InputProps).maxLength} characters.`));\n\n\t// Build the base string schema\n\tconst schema: BaseSchema<unknown, unknown, BaseIssue<unknown>> = pipe(string(), ...(stringRules as unknown as []));\n\n\t// Translated fields store an object with language keys -> validate as flexible object\n\tif (field.translated) {\n\t\treturn optional(record(string(), string()), {});\n\t}\n\n\t// If not required, allow optional empty value\n\treturn field.required ? schema : optional(schema, '');\n};\n\n// Create the widget definition using the factory.\nconst InputWidget = createWidget<InputProps>({\n\tName: 'Input',\n\tIcon: 'mdi:form-textbox',\n\tDescription: m.widget_text_description(),\n\tinputComponentPath: '/src/widgets/core/Input/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Input/Display.svelte',\n\n\tvalidationSchema: createValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: true\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ttranslated: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false },\n\t\tplaceholder: { widget: Input, required: false },\n\t\tminLength: { widget: Input, required: false },\n\t\tmaxLength: { widget: Input, required: false },\n\t\tprefix: { widget: Input, required: false },\n\t\tsuffix: { widget: Input, required: false },\n\t\tcount: { widget: Input, required: false }\n\t},\n\n\t// Aggregations for text search and sorting.\n\taggregations: {\n\t\tfilters: async ({ field, filter, contentLanguage }: { field: AggregationField; filter: string; contentLanguage: string }) => [\n\t\t\t{ $match: { [`${field.db_fieldName}.${contentLanguage}`]: { $regex: filter, $options: 'i' } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection, contentLanguage }: { field: AggregationField; sortDirection: number; contentLanguage: string }) => ({\n\t\t\t[`${field.db_fieldName}.${contentLanguage}`]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for text input\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Use primitive String type\n\t\tgraphql: '' // No custom type definition needed for primitives\n\t})\n});\n\nexport default InputWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof InputWidget>;\nexport type InputWidgetData = ValibotInput<ReturnType<typeof createValidationSchema>>;\n","/**\n * @file src/widgets/core/MediaUpload/index.ts\n * @description Media Widget Definition.\n *\n * Implements a powerful media selector using the Three Pillars Architecture.\n * Stores references (IDs) to media files, keeping content documents lightweight.\n *\n * @features\n * - **Relational Data**: Stores media IDs, not the full media objects.\n * - **Dynamic Validation**: Schema adapts to `multiupload` (single ID vs. array of IDs).\n * - **Modal-Based UX**: Designed to work with a separate media library modal.\n * - **Advanced Aggregation**: Performs a `$lookup` to filter/sort based on actual media metadata.\n */\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport Checkbox from '@widgets/core/Checkbox/index';\nimport Input from '@widgets/core/Input/index';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { array, minLength, optional, pipe, string, type BaseIssue, type BaseSchema, type InferInput as ValibotInput } from 'valibot';\nimport type { MediaProps } from './types';\n\n// ✅ SSOT: Validation Schema - Exported for use in Input.svelte\nexport const createValidationSchema = (field: ReturnType<typeof MediaWidget>): BaseSchema<unknown, unknown, BaseIssue<unknown>> => {\n\t// The base schema for a single media ID (must be a non-empty string).\n\tconst idSchema = pipe(string(), minLength(1, 'A media file is required.'));\n\n\t// If multiupload is enabled, the value should be an array of IDs.\n\tif (field.multiupload) {\n\t\tconst arraySchema = array(idSchema);\n\t\t// If the field is required, the array must not be empty.\n\t\treturn field.required ? pipe(arraySchema, minLength(1, 'At least one media file is required.')) : optional(arraySchema);\n\t}\n\n\t// Otherwise, the value is just a single ID string.\n\treturn field.required ? idSchema : optional(idSchema, '');\n};\n\n// Create the widget definition using the factory.\nconst MediaWidget = createWidget<MediaProps>({\n\tName: 'MediaUpload',\n\tIcon: 'mdi:image-multiple',\n\tDescription: m.widget_media_description(),\n\tinputComponentPath: '/src/widgets/core/MediaUpload/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/MediaUpload/Display.svelte',\n\tvalidationSchema: createValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tmultiupload: false,\n\t\tallowedTypes: []\n\t},\n\n\tGuiSchema: {\n\t\tmultiupload: { widget: Checkbox, label: 'Allow Multiple Files' },\n\t\twatermark: {\n\t\t\twidget: 'group',\n\t\t\tlabel: 'Watermark Options',\n\t\t\tfields: {\n\t\t\t\ttext: { widget: Input, label: 'Watermark Text' },\n\t\t\t\tposition: { widget: Input, label: 'Position (e.g., center, top-right)' },\n\t\t\t\topacity: { widget: Input, label: 'Opacity (0-1)' },\n\t\t\t\tscale: { widget: Input, label: 'Scale (e.g., 0.5 for 50%)' }\n\t\t\t}\n\t\t}\n\t},\n\n\t// Aggregation performs a lookup to search by the actual media file name.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t// Join with the 'media_files' collection.\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: 'media_files',\n\t\t\t\t\tlocalField: field.db_fieldName,\n\t\t\t\t\tforeignField: '_id',\n\t\t\t\t\tas: 'media_docs'\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Filter based on the name of the joined media files.\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\t'media_docs.name': { $regex: filter, $options: 'i' }\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t\t// Sorting would follow a similar `$lookup` pattern.\n\t}\n});\n\nexport default MediaWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof MediaWidget>;\nexport type MediaWidgetData = ValibotInput<ReturnType<typeof createValidationSchema>>;\n","/**\n * @file src/widgets/core/megamenu/index.ts\n * @description MegaMenu Widget Definition.\n *\n * A powerful builder widget for creating nested, hierarchical menu structures.\n * Features advanced drag-and-drop, modal editing, permissions, and comprehensive validation.\n *\n * @features\n * - **Recursive Validation**: Uses Valibot's `lazy` schema to validate a nested data structure.\n * - **Hierarchical Data**: Stores a tree of menu items with parent-child relationships.\n * - **Configurable Levels**: `fields` property allows defining different widgets for each menu depth.\n * - **Drag & Drop**: Visual reordering with advanced positioning logic.\n * - **Modal Editing**: Integrated modal system for item configuration.\n * - **Permissions**: Role-based access control for menu operations.\n * - **Aggregations**: Advanced filtering and sorting capabilities.\n * - **Clean Data Contract**: Stores a clean, predictable array of `MenuItem` objects.\n */\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { array, maxLength, object, pipe, string } from 'valibot';\nimport type { MegaMenuProps, MenuItem } from './types';\n\n// SECURITY: Define a base schema for a nested menu item's data with validation\nconst MenuItemSchema = object({\n\t_id: pipe(string(), maxLength(100)),\n\t_fields: object({}), // The fields inside validated separately\n\tchildren: array(object({})) // Nested children with same structure\n});\n\n// The top-level schema is an array of these menu items.\nconst MegaMenuValidationSchema = array(MenuItemSchema);\n\n// Create the widget definition using the factory.\nconst MegaMenuWidget = createWidget({\n\tName: 'MegaMenu',\n\tIcon: 'lucide:menu-square',\n\tDescription: m.widget_megaMenu_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/megamenu/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/megamenu/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: MegaMenuValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tfields: [],\n\t\tmaxDepth: 5,\n\t\tenableDragDrop: true,\n\t\tenableExpandCollapse: true\n\t}\n});\n\n// Helper function for recursive operations\nexport const traverseMenuItems = (\n\titems: MenuItem[],\n\tcallback: (item: MenuItem, level: number, parent?: MenuItem) => void,\n\tlevel = 0,\n\tparent?: MenuItem\n): void => {\n\titems.forEach((item) => {\n\t\tcallback(item, level, parent);\n\t\tif (item.children && item.children.length > 0) {\n\t\t\ttraverseMenuItems(item.children, callback, level + 1, item);\n\t\t}\n\t});\n};\n\n// Helper function to find menu item by path\nexport const findMenuItemByPath = (items: MenuItem[], path: number[]): MenuItem | null => {\n\tlet currentItems = items;\n\tlet targetItem: MenuItem | null = null;\n\n\tfor (const index of path) {\n\t\tif (index >= 0 && index < currentItems.length) {\n\t\t\ttargetItem = currentItems[index];\n\t\t\tcurrentItems = targetItem.children;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\treturn targetItem;\n};\n\n// Helper function to validate menu structure\nexport const validateMenuStructure = (items: MenuItem[], config: MegaMenuProps): { valid: boolean; errors: string[] } => {\n\tconst errors: string[] = [];\n\tconst maxDepth = config.maxDepth || 5;\n\n\t// Check depth constraints\n\tconst checkDepth = (item: MenuItem, currentDepth = 0): void => {\n\t\tif (currentDepth > maxDepth) {\n\t\t\terrors.push(`Menu item \"${item._fields?.title || item._id}\" exceeds maximum depth of ${maxDepth}`);\n\t\t}\n\t\titem.children.forEach((child) => checkDepth(child, currentDepth + 1));\n\t};\n\n\t// Check other constraints\n\tconst checkConstraints = (item: MenuItem): void => {\n\t\tconst childrenCount = item.children.length;\n\t\tconst maxChildren = config.validationRules?.maxChildrenPerParent;\n\n\t\tif (maxChildren && childrenCount > maxChildren) {\n\t\t\terrors.push(`Menu item \"${item._fields?.title || item._id}\" has ${childrenCount} children, maximum allowed is ${maxChildren}`);\n\t\t}\n\n\t\titem.children.forEach(checkConstraints);\n\t};\n\n\titems.forEach((item) => {\n\t\tcheckDepth(item);\n\t\tcheckConstraints(item);\n\t});\n\n\treturn {\n\t\tvalid: errors.length === 0,\n\t\terrors\n\t};\n};\n\nexport default MegaMenuWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof MegaMenuWidget>;\n","/**\n * @file src/widgets/core/Radio/index.ts\n * @description Radio Widget Definition.\n *\n * Implements a radio button group for selecting a single option from a list.\n *\n * @features\n * - **Dynamic Options**: Configurable with a list of `label`/`value` pairs.\n * - **Strict Validation**: Valibot schema ensures the selected value is one of the allowed options.\n * - **Accessible**: The `Input.svelte` component uses `fieldset` and `legend` for accessibility.\n * - **Clean Data Storage**: Stores only the primitive value of the selected option.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { literal, optional, union, type InferInput as ValibotInput } from 'valibot';\nimport type { RadioProps, RadioOption } from './types';\n\n// The validation schema is a function that generates rules based on the configured options.\nconst validationSchema = (field: FieldInstance & RadioProps) => {\n\t// Extract the allowed values from the field's options array.\n\tconst allowedValues = (field.options as RadioOption[] | undefined)?.map((opt) => literal(opt.value)) || [];\n\n\t// Create a schema that only allows one of the specified literal values.\n\t// This provides powerful, automatic validation.\n\tconst schema = union([...allowedValues], 'Please select a valid option.');\n\n\t// If the field is not required, the value can be null or undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst RadioWidget = createWidget<RadioProps>({\n\tName: 'Radio',\n\tIcon: 'mdi:radiobox-marked',\n\tDescription: m.widget_radio_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Radio/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Radio/Display.svelte',\n\n\t// Assign the dynamic validation schema.\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\toptions: [],\n\t\ttranslated: false, // A single selection is not typically translated.\n\t\tlegend: ''\n\t},\n\n\t// GuiSchema allows a simple text area for defining options in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tlegend: { widget: Input, required: false, helper: 'Legend text for the radio group' },\n\t\toptions: {\n\t\t\twidget: Input, // Using a simple textarea for JSON/JS array input\n\t\t\trequired: true,\n\t\t\thelper: \"Enter an array of objects, e.g., [{label: 'First', value: 1}, {label: 'Second', value: 2}]\"\n\t\t}\n\t},\n\n\t// GraphQL schema for radio\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Radio value as string\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default RadioWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RadioWidget>;\nexport type RadioWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","<!--\n@file src/components/system/builder/CollectionPicker.svelte\n@description Component for selecting a collection from available collections\n-->\n\n<script lang=\"ts\">\n\timport { collections } from '@shared/stores/collectionStore.svelte';\n\n\tinterface Props {\n\t\tvalue?: string;\n\t}\n\n\tlet { value = $bindable('') }: Props = $props();\n\n\timport type { Schema } from '@cms-types/content';\n\t// Get collection names\n\tconst collectionNames = $derived(Object.values((collections as any).all as Record<string, Schema>).map((c) => c.name));\n</script>\n\n<div class=\"m-1 flex max-w-full items-center justify-between gap-2\">\n\t<label for=\"collection-select\" class=\"w-32 flex-none\">Collection</label>\n\t<select id=\"collection-select\" class=\"input grow text-black dark:text-primary-500\" bind:value>\n\t\t<option value=\"\">Select a collection</option>\n\t\t{#each collectionNames as name}\n\t\t\t<option value={name}>{name}</option>\n\t\t{/each}\n\t</select>\n</div>\n","<!--\n@file src/components/system/builder/FieldPicker.svelte\n@description Component for selecting a field from the fields of a selected collection\n-->\n\n<script lang=\"ts\">\n\timport { collections } from '@shared/stores/collectionStore.svelte';\n\n\tinterface Props {\n\t\tvalue?: string;\n\t\tcollection?: string;\n\t}\n\n\tlet { value = $bindable(''), collection = '' }: Props = $props();\n\n\timport type { Schema } from '@cms-types/content';\n\t// Get fields for the selected collection\n\tconst selectedCollection = $derived(Object.values((collections as any).all as Record<string, Schema>).find((c) => c.name === collection));\n\tconst fieldNames = $derived(selectedCollection?.fields?.map((f: any) => f.db_fieldName).filter(Boolean) || []);\n</script>\n\n<div class=\"m-1 flex max-w-full items-center justify-between gap-2\">\n\t<label for=\"field-select\" class=\"w-32 flex-none\">Display Field</label>\n\t<select id=\"field-select\" class=\"input grow text-black dark:text-primary-500\" bind:value disabled={!collection}>\n\t\t<option value=\"\">Select a field</option>\n\t\t{#each fieldNames as name}\n\t\t\t<option value={name}>{name}</option>\n\t\t{/each}\n\t</select>\n</div>\n","/**\n * @file src/widgets/core/Relation/index.ts\n * @description Relation (One-to-One) Widget Definition.\n *\n * Implements a one-to-one relationship selector. Stores a single string ID\n * referencing an entry in another collection.\n *\n * @features\n * - **Relational Data**: Stores a single foreign key (ID).\n * - **Configurable GUI**: `GuiSchema` provides an intuitive UI for the collection builder.\n * - **Modal-Based UX**: Designed to work with a selection modal for a clean UX.\n * - **Advanced Aggregation**: Performs a `$lookup` to filter/sort by the related entry's data.\n */\n\n// Import components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport CollectionPicker from '@cms/components/system/builder/CollectionPicker.svelte';\nimport FieldPicker from '@cms/components/system/builder/FieldPicker.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; collection: string; displayField: string; [key: string]: unknown };\n\nimport { minLength, optional, pipe, string, type InferInput as ValibotInput } from 'valibot';\nimport type { RelationProps } from './types';\n\n// The validation schema ensures the value is a string ID.\nconst validationSchema = (field: FieldInstance) => {\n\tconst idSchema = pipe(string(), minLength(1, 'An entry must be selected.'));\n\treturn field.required ? idSchema : optional(idSchema, '');\n};\n\n// Create the widget definition using the factory.\nconst RelationWidget = createWidget<RelationProps>({\n\tName: 'Relation',\n\tIcon: 'mdi:relation-one-to-one',\n\tDescription: m.widget_relation_description(),\n\tinputComponentPath: '/src/widgets/core/Relation/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Relation/Display.svelte',\n\tvalidationSchema,\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\t// Standard fields\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false },\n\n\t\t// Widget-specific fields\n\t\tcollection: {\n\t\t\twidget: CollectionPicker, // A dropdown to select a collection\n\t\t\trequired: true\n\t\t},\n\t\tdisplayField: {\n\t\t\twidget: FieldPicker, // A dropdown to select a field from the chosen collection\n\t\t\trequired: true\n\t\t}\n\t},\n\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\t// Aggregation performs a lookup to search by the related entry's displayField.\n\t// SECURITY: Includes tenant isolation to prevent IDOR attacks\n\taggregations: {\n\t\tfilters: async ({ field, filter, tenantId }: { field: AggregationField; filter: string; tenantId?: string }) => [\n\t\t\t{ $lookup: { from: field.collection, localField: field.db_fieldName, foreignField: '_id', as: 'related_doc' } },\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\t...(tenantId ? { 'related_doc.tenantId': tenantId } : {}),\n\t\t\t\t\t[`related_doc.${field.displayField}`]: { $regex: filter, $options: 'i' }\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => {\n\t\t\t// SECURITY: Tenant-aware sorting\n\t\t\treturn {\n\t\t\t\t[`${field.db_fieldName}.${field.displayField}`]: sortDirection\n\t\t\t};\n\t\t}\n\t},\n\n\t// GraphQL schema for relation (returns ID of related document)\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Related document ID\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default RelationWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RelationWidget>;\nexport type RelationWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/core/RichText/index.ts\n * @description RichText Widget Definition.\n *\n * Implements a Tiptap-based rich text editor with a highly configurable toolbar\n * and a secure, clean data contract.\n *\n * @features\n * - **Configurable Toolbar**: The `toolbar` prop determines which editing features are available.\n * - **Advanced Validation**: Valibot schema validates the title and intelligently checks if content is empty.\n * - **Secure by Design**: Designed to work with a display component that sanitizes HTML.\n * - **Translatable**: Fully supports multilingual content by default.\n */\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { object, optional, pipe, string, custom, type InferInput } from 'valibot';\nimport type { RichTextProps } from './types';\n\n// Helper to strip HTML-like tags and angle brackets from a string.\n// This is intentionally aggressive and is only used for \"is empty\" checks,\n// not for producing HTML to render.\nconst stripHtmlTags = (html: string): string => {\n\tif (!html) return '';\n\n\tlet previous: string;\n\tlet current = html;\n\n\t// Repeatedly remove tags like <tag ...> until no more matches remain.\n\t// This avoids issues where a single multi-character replacement\n\t// can cause previously hidden patterns to reappear.\n\tdo {\n\t\tprevious = current;\n\t\tcurrent = current.replace(/<[^>]*>/g, '');\n\t} while (current !== previous);\n\n\t// Remove any remaining angle brackets to avoid partial tag fragments\n\t// such as \"<script\" surviving the stripping process.\n\tcurrent = current.replace(/[<>]/g, '');\n\n\treturn current;\n};\n\n// Helper to check if HTML content is effectively empty.\n// NOTE: Input.svelte already sanitizes with DOMPurify before storage,\n// so we don't need to remove scripts here (defense-in-depth handled upstream)\nconst isContentEmpty = (html: string) => {\n\tif (!html) return true;\n\n\t// Strip all HTML tags and angle brackets to check for actual text content.\n\tconst stripped = stripHtmlTags(html).trim();\n\n\treturn stripped.length === 0;\n};\n\n// The validation schema is a function to accommodate the `required` flag.\nconst validationSchema = (field: FieldInstance) => {\n\t// The base schema for the rich text data object.\n\tconst schema = object({\n\t\ttitle: optional(string()), // Title can be optional.\n\t\tcontent: string() // HTML content.\n\t});\n\n\t// If the field is required, validate that content is not empty\n\tif (field.required) {\n\t\treturn object({\n\t\t\ttitle: optional(string()),\n\t\t\tcontent: pipe(\n\t\t\t\tstring(),\n\t\t\t\tcustom((input) => !isContentEmpty(input as string), 'Content is required.')\n\t\t\t)\n\t\t});\n\t}\n\n\treturn optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst RichTextWidget = createWidget<RichTextProps>({\n\tName: 'RichText',\n\tIcon: 'mdi:format-pilcrow-arrow-right',\n\tDescription: m.widget_richText_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/RichText/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/RichText/Display.svelte',\n\n\t// Assign the validation schema function.\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\t// Provide a default full toolbar configuration.\n\t\ttoolbar: ['bold', 'italic', 'headings', 'lists', 'link', 'image', 'align', 'clear'],\n\t\ttranslated: true\n\t}\n});\n\nexport default RichTextWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RichTextWidget>;\nexport type RichTextWidgetData = InferInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Address/index.ts\n * @description Address Widget Definition.\n *\n * A comprehensive widget for capturing and displaying structured address data,\n * optionally integrated with an interactive map for geocoding.\n *\n * @features\n * - **Structured Data**: Stores a complete, well-defined address object.\n * - **Configurable GUI**: `GuiSchema` provides a UI for setting widget-specific props.\n * - **Geocoding Support**: Integrates with Mapbox for visual location picking.\n * - **Valibot Schema**: Ensures all parts of the address are correctly formatted.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\nimport { object, string, number, minLength, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { AddressProps } from './types';\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the address data object.\nconst AddressValidationSchema = object({\n\tstreet: pipe(string(), minLength(1, 'Street is required.')),\n\thouseNumber: string(),\n\tpostalCode: pipe(string(), minLength(1, 'Postal code is required.')),\n\tcity: pipe(string(), minLength(1, 'City is required.')),\n\tcountry: pipe(string(), minLength(2, 'Country is required.')),\n\tlatitude: number(),\n\tlongitude: number()\n});\n\n// Create the widget definition using the factory.\nconst AddressWidget = createWidget<AddressProps>({\n\tName: 'Address',\n\tIcon: 'mdi:home-map-marker',\n\tDescription: m.widget_address_description(),\n\tinputComponentPath: '/src/widgets/custom/Address/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Address/Display.svelte',\n\tvalidationSchema: AddressValidationSchema,\n\n\t// Define the UI for configuring this widget's properties in the Collection Builder.\n\tGuiSchema: {\n\t\t// Standard fields\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\twidth: { widget: Input, required: false },\n\n\t\t// Widget-specific fields from AddressProps\n\t\tdefaultCountry: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\thelper: \"Default 2-letter country code (e.g., 'DE', 'US').\"\n\t\t},\n\t\tmapCenter: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\thelper: \"Default map center (e.g., '51.34,6.57').\"\n\t\t},\n\t\tzoom: { widget: Input, required: false, helper: 'Default map zoom level (e.g., 12).' },\n\t\thiddenFields: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\thelper: \"Comma-separated list of fields to hide (e.g., 'latitude,longitude').\"\n\t\t}\n\t},\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tmapCenter: { lat: 51.34, lng: 6.57 },\n\t\tzoom: 12,\n\t\tdefaultCountry: 'DE',\n\t\thiddenFields: [],\n\t\ttranslated: false\n\t},\n\n\tgetTranslatablePaths: (basePath: string) => {\n\t\treturn [`${basePath}.street`, `${basePath}.postalCode`, `${basePath}.city`, `${basePath}.country`];\n\t}\n});\n\nexport default AddressWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof AddressWidget>;\nexport type AddressWidgetData = ValibotInput<typeof AddressValidationSchema>;\n","/**\n * @file src/widgets/custom/ColorPicker/index.ts\n * @description ColorPicker Widget Definition.\n *\n * Implements an intuitive color picker using the Three Pillars Architecture.\n * Stores a standard 6-digit hex color code as a string.\n *\n * @features\n * - **Simple Data Contract**: Stores a single, clean hex color string (e.g., '#FFFFFF').\n * - **Robust Validation**: Valibot schema ensures the value is a valid hex code.\n * - **Configurable GUI**: `GuiSchema` allows easy configuration in the Collection Builder.\n * - **Native Color Picker**: Uses the browser's native color input for a good UX.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { minLength, optional, pipe, regex, string, type InferInput as ValibotInput } from 'valibot';\nimport type { ColorPickerProps } from './types';\n\n// The validation schema is a function to accommodate the `required` flag.\nconst validationSchema = (field: FieldInstance) => {\n\t// Base schema validates the hex color format.\n\tconst hexSchema = pipe(string(), regex(/^#[0-9a-f]{6}$/i, 'Must be a valid 6-digit hex code (e.g., #FF5733).'));\n\n\t// If the field is required, ensure it's not an empty string before checking the format.\n\tif (field.required) {\n\t\treturn pipe(string(), minLength(1, 'A color is required.'), hexSchema);\n\t}\n\n\t// If not required, allow an empty string or a valid hex code.\n\treturn optional(hexSchema, '');\n};\n\n// Create the widget definition using the factory.\nconst ColorPickerWidget = createWidget<ColorPickerProps>({\n\tName: 'ColorPicker',\n\tIcon: 'ic:outline-colorize',\n\tDescription: m.widget_colorPicker_description(),\n\tinputComponentPath: '/src/widgets/custom/ColorPicker/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/ColorPicker/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults. A color is a universal value.\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\twidth: { widget: Input, required: false }\n\t}\n});\n\nexport default ColorPickerWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof ColorPickerWidget>;\nexport type ColorPickerWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Currency/index.ts\n * @description Currency Widget Definition.\n *\n * Implements a robust currency input widget that stores a precise number\n * while displaying and accepting localized, formatted currency strings.\n *\n * @features\n * - **Numeric Storage**: Stores currency as a `number` for accuracy.\n * - **Dynamic Validation**: Schema adapts to `required`, `minValue`, and `maxValue` settings.\n * - **Internationalization**: Uses `Intl.NumberFormat` for locale-aware formatting.\n * - **Configurable GUI**: `GuiSchema` allows easy setup in the Collection Builder.\n * - **Database Aggregation**: Supports numeric filtering (e.g., price > 100) and sorting.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { maxValue, minValue, number, optional, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { CurrencyProps } from './types';\n\n// Helper type for aggregation field\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// Build validation actions based on field config\n\tconst validationActions: Array<ReturnType<typeof minValue> | ReturnType<typeof maxValue>> = [];\n\n\tif (field.minValue !== undefined) {\n\t\tvalidationActions.push(minValue(field.minValue as number, `Value must be at least ${field.minValue}.`));\n\t}\n\tif (field.maxValue !== undefined) {\n\t\tvalidationActions.push(maxValue(field.maxValue as number, `Value must not exceed ${field.maxValue}.`));\n\t}\n\n\t// Create final schema with validations\n\tconst baseSchema = number('Value must be a number.');\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tconst schema = validationActions.length > 0 ? pipe(baseSchema, ...(validationActions as any)) : baseSchema;\n\n\t// If the field is not required, wrap the schema to allow it to be undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst CurrencyWidget = createWidget<CurrencyProps>({\n\tName: 'Currency',\n\tIcon: 'mdi:currency-usd',\n\tDescription: m.widget_currency_description(),\n\tinputComponentPath: '/src/widgets/custom/Currency/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Currency/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tcurrencyCode: 'EUR',\n\t\ttranslated: false // A monetary value is typically not translated.\n\t},\n\n\t// SECURITY: Validate ISO 4217 currency codes\n\t// validCurrencyCodes: ['USD', 'EUR', 'GBP', 'JPY', 'CNY', 'AUD', 'CAD', 'CHF', 'HKD', 'SGD', 'SEK', 'NOK', 'NZD', 'KRW', 'TRY', 'INR', 'BRL', 'ZAR'],\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tcurrencyCode: {\n\t\t\twidget: Input,\n\t\t\trequired: true,\n\t\t\thelper: 'ISO 4217 code (USD, EUR, GBP, etc.)',\n\t\t\tpattern: '^[A-Z]{3}$'\n\t\t},\n\t\tminValue: { widget: Input, required: false },\n\t\tmaxValue: { widget: Input, required: false },\n\t\tplaceholder: { widget: Input, required: false }\n\t},\n\n\t// Aggregations perform numeric comparisons.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t// Example: filter=\">100\" or filter=\"<50\" or filter=\"150\"\n\t\t\t// This requires a simple parser for the filter string.\n\t\t\t{ $match: { [field.db_fieldName]: { $eq: parseFloat(filter) } } } // Simplified for exact match\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for currency\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Float', // Use Float for currency values\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default CurrencyWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof CurrencyWidget>;\nexport type CurrencyWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Email/index.ts\n * @description Email Widget Definition.\n *\n * Implements a robust email input widget using the Three Pillars Architecture.\n *\n * @features\n * - **Email Validation**: Uses Valibot's `email()` validator for strong format checking.\n * - **Simple Data Contract**: Stores a single, clean email string.\n * - **Non-Translatable**: Correctly treats email addresses as universal, non-translatable data.\n * - **Configurable GUI**: `GuiSchema` allows for easy setup in the Collection Builder.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { custom, email, minLength, optional, pipe, string, type InferInput as ValibotInput } from 'valibot';\nimport type { EmailProps } from './types';\n\n// SECURITY: Common disposable email domains to block\nconst DISPOSABLE_DOMAINS = [\n\t'tempmail.com',\n\t'guerrillamail.com',\n\t'10minutemail.com',\n\t'mailinator.com',\n\t'throwaway.email',\n\t'yopmail.com',\n\t'temp-mail.org',\n\t'getnada.com'\n];\n\nconst blockDisposableEmail = custom((input: unknown) => {\n\tif (typeof input !== 'string') return false;\n\tconst domain = input.split('@')[1]?.toLowerCase();\n\treturn !DISPOSABLE_DOMAINS.includes(domain);\n}, 'Disposable email addresses are not allowed');\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// Start with a base string schema that requires a valid email format.\n\tconst baseSchema = pipe(string(), email('Please enter a valid email address.'), blockDisposableEmail as any);\n\n\t// If the field is required, also ensure it's not empty.\n\tconst schema = field.required\n\t\t? pipe(string(), minLength(1, 'This field is required.'), email('Please enter a valid email address.'), blockDisposableEmail as any)\n\t\t: baseSchema;\n\n\t// If not required, wrap the schema to allow it to be optional.\n\treturn field.required ? schema : optional(schema, '');\n};\n\n// Create the widget definition using the factory.\nconst EmailWidget = createWidget<EmailProps>({\n\tName: 'Email',\n\tIcon: 'ic:outline-email',\n\tDescription: m.widget_email_description(),\n\tinputComponentPath: '/src/widgets/custom/Email/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Email/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: false // An email address should not be translatable.\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tplaceholder: { widget: Input, required: false }\n\t},\n\n\t// GraphQL schema for email input\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Use primitive String type\n\t\tgraphql: '' // No custom type definition needed for primitives\n\t})\n});\n\nexport default EmailWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof EmailWidget>;\nexport type EmailWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Number/index.ts\n * @description Number Widget Definition.\n *\n * Implements a robust number input widget that stores a precise number.\n *\n * @features\n * - **Numeric Storage**: Stores data as a `number` for accuracy and calculations.\n * - **Dynamic Validation**: Schema adapts to `required`, `min`, and `max` settings.\n * - **Native Number Input**: Uses `<input type=\"number\">` for optimal UX and accessibility.\n * - **Database Aggregation**: Supports numeric filtering (e.g., value > 100) and sorting.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { maxValue, minValue, number, optional, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { NumberProps } from './types';\n\n// Helper type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// Build validation actions based on field config\n\tconst validationActions: Array<ReturnType<typeof minValue> | ReturnType<typeof maxValue>> = [];\n\n\tif (field.min !== undefined) {\n\t\tvalidationActions.push(minValue(field.min as number, `Value must be at least ${field.min}.`));\n\t}\n\tif (field.max !== undefined) {\n\t\tvalidationActions.push(maxValue(field.max as number, `Value must not exceed ${field.max}.`));\n\t}\n\n\t// Create final schema with validations\n\tconst baseSchema = number('Value must be a number.');\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tconst schema = validationActions.length > 0 ? pipe(baseSchema, ...(validationActions as any)) : baseSchema;\n\n\t// If the field is not required, wrap the schema to allow it to be undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst NumberWidget = createWidget<NumberProps>({\n\tName: 'Number',\n\tIcon: 'mdi:numeric',\n\tDescription: m.widget_number_description(),\n\tinputComponentPath: '/src/widgets/custom/Number/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Number/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tstep: 1,\n\t\ttranslated: false // A number is a universal value.\n\t},\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tmin: { widget: Input, required: false, helper: 'Minimum allowed value.' },\n\t\tmax: { widget: Input, required: false, helper: 'Maximum allowed value.' },\n\t\tstep: { widget: Input, required: false, helper: 'Stepping interval.' },\n\t\tplaceholder: { widget: Input, required: false }\n\t},\n\n\t// Aggregations perform numeric comparisons.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t// Example: filter=\">100\" or filter=\"<50\" or filter=\"150\"\n\t\t\t{ $match: { [field.db_fieldName]: { $eq: parseFloat(filter) } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for number\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Float', // Use Float for numeric values\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default NumberWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof NumberWidget>;\nexport type NumberWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/phonenumber/index.ts\n * @description PhoneNumber Widget Definition.\n *\n * Implements a robust phone number input that stores a simple string.\n *\n * @features\n * - **Dynamic Validation**: Uses a custom `pattern` if provided, otherwise defaults to E.164 international format.\n * - **Semantic HTML**: The input component uses `<input type=\"tel\">` for accessibility.\n * - **Actionable Display**: The display component renders a clickable `tel:` link.\n * - **Configurable GUI**: `GuiSchema` allows for easy setup in the Collection Builder.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { minLength, optional, pipe, regex, string, type InferInput as ValibotInput } from 'valibot';\nimport type { PhoneNumberProps } from './types';\n\n// SECURITY: More robust phone validation\n// E.164 format: +[country code][subscriber number]\n// Country code: 1-3 digits, Subscriber: up to 15 total digits\nconst validationSchema = (field: FieldInstance) => {\n\t// Improved regex for E.164 international format\n\tconst defaultPattern = /^\\+[1-9]\\d{1,3}[\\d\\s-]{4,14}$/;\n\tconst validationMessage = 'Please enter a valid international phone number (e.g., +49 123 456789)';\n\n\t// Use the custom pattern from the field config, or fall back to the default.\n\tconst validationPattern = field.pattern ? new RegExp(field.pattern as string) : defaultPattern;\n\n\t// Start with a base string schema that includes the regex validation.\n\tconst baseSchema = pipe(string(), regex(validationPattern, validationMessage));\n\n\t// If the field is required, also ensure it's not empty.\n\tconst schema = field.required\n\t\t? pipe(string(), minLength(1, 'This field is required.'), regex(validationPattern, validationMessage) as any)\n\t\t: baseSchema;\n\n\t// If not required, wrap the schema to allow it to be optional.\n\treturn field.required ? schema : optional(schema, '');\n};\n\n// Create the widget definition using the factory.\nconst PhoneNumberWidget = createWidget<PhoneNumberProps>({\n\tName: 'PhoneNumber',\n\tIcon: 'ic:baseline-phone-in-talk',\n\tDescription: m.widget_phoneNumber_description(),\n\tinputComponentPath: '/src/widgets/custom/PhoneNumber/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/PhoneNumber/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: false // A phone number should not be translatable.\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tplaceholder: { widget: Input, required: false },\n\t\tpattern: { widget: Input, required: false, helper: 'Optional: Custom regex for validation.' }\n\t}\n});\n\nexport default PhoneNumberWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof PhoneNumberWidget>;\nexport type PhoneNumberWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Rating/index.ts\n * @description Rating Widget Definition.\n *\n * Implements an interactive star rating widget.\n *\n * @features\n * - **Numeric Storage**: Stores the rating as a simple `number`.\n * - **Dynamic Validation**: Schema adapts to the `max` rating setting.\n * - **Configurable GUI**: `GuiSchema` allows for easy setup in the Collection Builder.\n * - **Database Aggregation**: Supports numeric filtering (e.g., rating >= 4) and sorting.\n */\n\n// Import components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { maxValue, minValue, number, optional, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { RatingProps } from './types';\n\n// Helper type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// The maximum value is determined by the field's config, defaulting to 5.\n\tconst max = (field.max || 5) as number;\n\n\t// Start with a base number schema.\n\tconst schema = pipe(number('Rating must be a number.'), minValue(1, 'A rating is required.'), maxValue(max, `Rating cannot exceed ${max}.`));\n\n\t// If the field is not required, wrap the schema to allow it to be undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst RatingWidget = createWidget<RatingProps>({\n\tName: 'Rating',\n\tIcon: 'material-symbols:star-outline',\n\tDescription: m.widget_rating_description(),\n\tinputComponentPath: '/src/widgets/custom/Rating/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Rating/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tmax: 5,\n\t\ticonFull: 'material-symbols:star',\n\t\ticonEmpty: 'material-symbols:star-outline',\n\t\ttranslated: false\n\t},\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tmax: { widget: Input, required: false, helper: 'Maximum number of stars.' },\n\t\ticonFull: { widget: IconifyPicker, required: false },\n\t\ticonEmpty: { widget: IconifyPicker, required: false }\n\t},\n\n\t// Aggregations perform numeric comparisons.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t{ $match: { [field.db_fieldName]: { $eq: parseInt(filter, 10) } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for rating\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Int', // Use Int for rating values\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default RatingWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RatingWidget>;\nexport type RatingWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/RemoteVideo/index.ts\n * @description RemoteVideo Widget Definition.\n *\n * Implements a dynamic widget for embedding videos from various remote platforms\n * (YouTube, Vimeo, Twitch, TikTok). Stores rich video metadata and handles\n * server-side API fetching for security and performance.\n *\n * @features\n * - **Structured Metadata**: Stores a comprehensive `RemoteVideoData` object.\n * - **Dynamic Validation**: Ensures URL validity and platform compatibility.\n * - **Server-Side APIs**: Delegates metadata fetching to a server endpoint to protect API keys.\n * - **Configurable Platforms**: `allowedPlatforms` limits video sources.\n * - **GraphQL Schema**: Defines a structured GraphQL type for video data.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { custom, literal, minLength, number, object, optional, pipe, string, union, url, type InferInput as ValibotInput } from 'valibot';\n\n// Helper type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// SECURITY: Strict URL validation to prevent SSRF\nconst SAFE_VIDEO_URL_PATTERNS = [\n\t/^https?:\\/\\/(www\\.)?(youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([a-zA-Z0-9_-]{11})/,\n\t/^https?:\\/\\/(www\\.)?vimeo\\.com\\/\\d+$/,\n\t/^https?:\\/\\/(www\\.)?twitch\\.tv\\/videos\\/\\d+$/,\n\t/^https?:\\/\\/(www\\.)?tiktok\\.com\\/@[\\w.-]+\\/video\\/\\d+$/\n];\n\n// Define the validation schema for the RemoteVideoData object.\nconst RemoteVideoDataSchema = object({\n\tplatform: union([literal('youtube'), literal('vimeo'), literal('twitch'), literal('tiktok'), literal('other')]),\n\turl: pipe(\n\t\tstring(),\n\t\turl('Must be a valid video URL.'),\n\t\tcustom((input) => {\n\t\t\tconst str = input as string;\n\t\t\treturn SAFE_VIDEO_URL_PATTERNS.some((pattern) => pattern.test(str));\n\t\t}, 'URL must be from an allowed video platform (YouTube, Vimeo, Twitch, or TikTok)')\n\t),\n\tvideoId: pipe(string(), minLength(1, 'Video ID is required.')),\n\ttitle: pipe(string(), minLength(1, 'Video title is required.')),\n\tthumbnailUrl: pipe(string(), url('Must be a valid thumbnail URL.')),\n\tchannelTitle: optional(string()),\n\tduration: optional(string()),\n\twidth: optional(number()),\n\theight: optional(number()),\n\tpublishedAt: optional(string())\n});\n\n// The validation schema for the remote video data.\nconst validationSchema = RemoteVideoDataSchema;\n\n// Create the widget definition using the factory.\nconst RemoteVideoWidget = createWidget({\n\tName: 'RemoteVideo',\n\tIcon: 'mdi:video-vintage',\n\tDescription: m.widget_remoteVideo_description(),\n\tinputComponentPath: '/src/widgets/custom/RemoteVideo/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/RemoteVideo/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tplaceholder: 'Enter video URL (YouTube, Vimeo, Twitch, TikTok)',\n\t\tallowedPlatforms: ['youtube', 'vimeo', 'twitch', 'tiktok'],\n\t\ttranslated: false // Video metadata is not typically translated per-field.\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tplaceholder: { widget: Input, required: false },\n\t\tallowedPlatforms: {\n\t\t\twidget: Input, // A multi-select component would be better here in a real CMS.\n\t\t\trequired: false,\n\t\t\thelper: \"Comma-separated platforms (e.g., 'youtube,vimeo').\"\n\t\t}\n\t},\n\n\t// Aggregations filter/sort by video title.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t{ $match: { [`${field.db_fieldName}.title`]: { $regex: filter, $options: 'i' } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[`${field.db_fieldName}.title`]: sortDirection\n\t\t})\n\t},\n\n\t// Define the GraphQL schema for the RemoteVideoData object.\n\tGraphqlSchema: ({ label }: { label: string }) => ({\n\t\ttypeID: label, // Using the label as the GraphQL type name.\n\t\tgraphql: `\n            type ${label} {\n                platform: String!\n                url: String!\n                videoId: String!\n                title: String!\n                thumbnailUrl: String!\n                channelTitle: String\n                duration: String\n                width: Int\n                height: Int\n                publishedAt: String\n            }\n        `\n\t})\n});\n\nexport default RemoteVideoWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RemoteVideoWidget>;\nexport type RemoteVideoWidgetData = ValibotInput<typeof validationSchema>;\n","/**\n * @file src/widgets/custom/Seo/index.ts\n * @description SEO Widget Definition.\n *\n * An SEO analysis and optimization tool embedded as a widget.\n *\n * @features\n * - **Comprehensive Validation**: Valibot schema validates the entire SEO data object, including length checks.\n * - **Structured Data**: Stores a single, clean `SeoData` object.\n * - **Configurable Features**: The `features` prop allows tailoring the UI for different needs.\n * - **Translatable**: Fully supports multilingual SEO content.\n */\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { custom, literal, maxLength, object, optional, pipe, regex, string, transform, union, url, type InferInput as ValibotInput } from 'valibot';\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\n// SECURITY: Escape HTML entities to prevent meta tag injection\nconst escapeHtml = (str: string): string => {\n\treturn str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#039;');\n};\n\n// Define a robust validation schema for the SeoData object.\nconst SeoValidationSchema = object({\n\ttitle: pipe(string(), maxLength(60, 'Title should be under 60 characters.'), transform(escapeHtml)),\n\tdescription: pipe(string(), maxLength(160, 'Description should be under 160 characters.'), transform(escapeHtml)),\n\tfocusKeyword: pipe(string(), transform(escapeHtml)),\n\t// Advanced\n\trobotsMeta: pipe(string(), transform(escapeHtml)),\n\tcanonicalUrl: optional(pipe(string(), url('Must be a valid URL.'), regex(/^https?:\\/\\//, 'Must use HTTP or HTTPS protocol'))),\n\t// Social\n\togTitle: optional(string()),\n\togDescription: optional(string()),\n\togImage: optional(string()), // ID of a media file\n\ttwitterCard: union([literal('summary'), literal('summary_large_image')]),\n\ttwitterTitle: optional(string()),\n\ttwitterDescription: optional(string()),\n\ttwitterImage: optional(string()), // ID of a media file\n\t// Schema - SECURITY: Validate JSON structure\n\tschemaMarkup: optional(\n\t\tpipe(\n\t\t\tstring(),\n\t\t\tcustom((input) => {\n\t\t\t\tif (!input) return true;\n\t\t\t\ttry {\n\t\t\t\t\tconst parsed = JSON.parse(input as string);\n\t\t\t\t\t// Must be an object, not a string or array at root level\n\t\t\t\t\treturn typeof parsed === 'object' && !Array.isArray(parsed);\n\t\t\t\t} catch {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}, 'Must be valid JSON object')\n\t\t)\n\t)\n});\n\n// Create the widget definition using the factory.\nconst SeoWidget = createWidget({\n\tName: 'SEO',\n\tIcon: 'tabler:seo',\n\tDescription: m.widget_seo_description(),\n\tinputComponentPath: '/src/widgets/custom/Seo/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Seo/Display.svelte',\n\tvalidationSchema: SeoValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tfeatures: ['social', 'schema', 'advanced', 'ai'],\n\t\ttranslated: true\n\t},\n\n\t// Validation - defines which fields are translatable\n\tgetTranslatablePaths: (basePath: string) => {\n\t\t// Return only fields that contribute to the global translation status\n\t\t// Exclude technical fields like robotsMeta, canonicalUrl which have defaults\n\t\treturn [\n\t\t\t`${basePath}.title`,\n\t\t\t`${basePath}.description`,\n\t\t\t`${basePath}.focusKeyword`,\n\t\t\t`${basePath}.ogTitle`,\n\t\t\t`${basePath}.ogDescription`,\n\t\t\t`${basePath}.twitterTitle`,\n\t\t\t`${basePath}.twitterDescription`,\n\t\t\t`${basePath}.schemaMarkup`\n\t\t];\n\t},\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ttranslated: { widget: Toggles, required: false },\n\t\tfeatures: {\n\t\t\twidget: Input, // A multi-select component would be better here.\n\t\t\trequired: false,\n\t\t\thelper: 'Comma-separated features (social, schema, advanced, ai).'\n\t\t}\n\t},\n\n\t// GraphQL schema for SEO (complex object, would need custom type)\n\t// For now, return String to serialize as JSON\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // JSON string representation\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default SeoWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof SeoWidget>;\nexport type SeoWidgetData = ValibotInput<typeof SeoValidationSchema>;\n","/**\n * @file src/widgets/scanner.ts\n * @description Centralized widget scanner using Vite's import.meta.glob.\n * Provides a single source of truth for widget discovery to avoid redundant scanning.\n */\n// Scan for core widgets\nexport const coreModules = import.meta.glob('./core/*/index.ts', {\n    eager: true\n});\n// Scan for custom widgets\nexport const customModules = import.meta.glob('./custom/*/index.ts', {\n    eager: true\n});\n// Combined modules for easier iteration\nexport const allWidgetModules = { ...coreModules, ...customModules };\n/**\n * Extracts widget name from file path\n * @param path - The file path (e.g., './core/input/index.ts')\n * @returns The widget name (e.g., 'input')\n */\nexport function getWidgetNameFromPath(path) {\n    const parts = path.split('/');\n    return parts.at(-2) || null;\n}\n"],"names":["$.attr","$.escape","$.attr_class","$.clsx","$$renderer","m.iconpicker_placeholder","$.stringify","m.widget_checkbox_description","m.widget_date_description","m.widget_dateRange_description","createValidationSchema","m.widget_text_description","m.widget_media_description","Checkbox","Input","m.widget_megaMenu_description","validationSchema","m.widget_radio_description","m.widget_relation_description","m.widget_richText_description","m.widget_address_description","m.widget_colorPicker_description","m.widget_currency_description","m.widget_email_description","m.widget_number_description","m.widget_phoneNumber_description","m.widget_rating_description","m.widget_remoteVideo_description","m.widget_seo_description"],"mappings":"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"}