{"version":3,"file":"store.svelte.js","sources":["../../../../../../node_modules/svelte/src/reactivity/index-server.js","../../../../../../shared/stores/src/store.svelte.ts"],"sourcesContent":["export const SvelteDate = globalThis.Date;\nexport const SvelteSet = globalThis.Set;\nexport const SvelteMap = globalThis.Map;\nexport const SvelteURL = globalThis.URL;\nexport const SvelteURLSearchParams = globalThis.URLSearchParams;\n\nexport class MediaQuery {\n\tcurrent;\n\t/**\n\t * @param {string} query\n\t * @param {boolean} [matches]\n\t */\n\tconstructor(query, matches = false) {\n\t\tthis.current = matches;\n\t}\n}\n\n/**\n * @param {any} _\n */\nexport function createSubscriber(_) {\n\treturn () => {};\n}\n","/**\n * @file src/stores/store.svelte.ts\n * @description Global state management with Enterprise-grade reactivity (SveltyCMS 2025)\n */\n\nimport type { Locale } from '@shared/paraglide/runtime';\nimport { publicEnv } from '@shared/stores/globalSettings.svelte';\nimport { SvelteMap, SvelteSet } from 'svelte/reactivity';\nimport { createToaster } from '@skeletonlabs/skeleton-svelte';\n\n// --- TYPES & INTERFACES ---\n\ninterface SaveFunction {\n\tfn: (args?: unknown) => unknown;\n\treset: () => void;\n}\n\nexport interface TranslationSet {\n\ttotal: SvelteSet<string>;\n\ttranslated: SvelteSet<string>;\n}\n\nexport type TranslationProgress = {\n\t[key in Locale]?: TranslationSet;\n} & {\n\tshow: boolean;\n};\n\n// --- HELPER FUNCTIONS ---\n\n/**\n * Normalizes avatar URLs to ensure consistency across environments.\n */\nfunction normalizeAvatarUrl(url: string | null | undefined): string {\n\tconst DEFAULT_AVATAR = '/Default_User.svg';\n\tif (!url) return DEFAULT_AVATAR;\n\n\tif (url.startsWith('data:') || /^https?:\\/\\//i.test(url)) return url;\n\tif (/^\\/?Default_User\\.svg$/i.test(url)) return DEFAULT_AVATAR;\n\n\tlet normalized = url.replace(/^https?:\\/\\/[^/]+/i, '').replace(/^\\/+/, '/');\n\tif (normalized === '/files' || normalized === '/files/') return DEFAULT_AVATAR;\n\tif (normalized.startsWith('/files/')) return normalized;\n\n\tconst trimmed = normalized.startsWith('/') ? normalized.slice(1) : normalized;\n\tif (trimmed === 'files') return DEFAULT_AVATAR;\n\n\tif (trimmed.startsWith('static/')) return `/${trimmed}`;\n\n\tconst MEDIA_FOLDER = publicEnv.MEDIA_FOLDER;\n\tif (trimmed.startsWith(`${MEDIA_FOLDER}/`)) {\n\t\treturn `/files/${trimmed.slice(MEDIA_FOLDER.length + 1)}`;\n\t}\n\tif (trimmed.startsWith('avatars/')) return `/files/${trimmed}`;\n\n\treturn trimmed ? (trimmed.endsWith('.svg') ? `/${trimmed}` : `/files/${trimmed}`) : DEFAULT_AVATAR;\n}\n\n/**\n * Cookie management helper\n */\nfunction getCookie(name: string): string | null {\n\tif (typeof document === 'undefined') return null;\n\tconst value = `; ${document.cookie}`;\n\tconst parts = value.split(`; ${name}=`);\n\tif (parts.length === 2) return parts.pop()?.split(';').shift() || null;\n\treturn null;\n}\n\nfunction setCookie(name: string, value: string) {\n\tif (typeof document === 'undefined' || !value) return;\n\tdocument.cookie = `${name}=${value}; path=/; max-age=${60 * 60 * 24 * 365}; SameSite=Lax${process.env.NODE_ENV === 'production' ? '; Secure' : ''}`;\n}\n\n// --- CORE APP STORE ---\n\nexport class AppStore {\n\t// Granular Reactive State\n\ttranslationProgress = $state({ show: false }) as TranslationProgress;\n\tvalidationErrorsMap = new SvelteMap<string, string | null>();\n\n\t// Core UI State\n\ttabSetState = $state(0);\n\tdrawerExpandedState = $state(true);\n\tlistboxValueState = $state('create');\n\tavatarSrc = $state('/Default_User.svg');\n\n\t// Status & Completion\n\ttranslationStatus = $state<Record<string, unknown>>({});\n\tcompletionStatus = $state(0);\n\ttranslationStatusOpen = $state(false);\n\n\t// Language Management (with persistence)\n\t_systemLanguage = $state<Locale>('en' as Locale);\n\t_contentLanguage = $state<Locale>('en' as Locale);\n\n\t// Rendering & UI Elements\n\theaderActionButton = $state<any>(undefined);\n\theaderActionButton2 = $state<any>(undefined);\n\tpkgBgColor = $state('preset-filled-primary-500');\n\tfile = $state<File | null>(null);\n\tsaveEditedImage = $state(false);\n\tsaveFunction = $state<SaveFunction>({ fn: () => {}, reset: () => {} });\n\n\t// App Lifecycle\n\tsaveLayerStore = $state<() => Promise<void>>(async () => {});\n\tshouldShowNextButton = $state(false);\n\n\tconstructor() {\n\t\tthis.init();\n\t}\n\n\tprivate init() {\n\t\t// 1. Initialize Languages from Cookies/Env\n\t\ttry {\n\t\t\tthis._systemLanguage = (getCookie('systemLanguage') as Locale) ?? (publicEnv.BASE_LOCALE as Locale) ?? 'en';\n\t\t\tthis._contentLanguage = (getCookie('contentLanguage') as Locale) ?? (publicEnv.DEFAULT_CONTENT_LANGUAGE as Locale) ?? 'en';\n\t\t} catch {\n\t\t\tthis._systemLanguage = 'en' as Locale;\n\t\t\tthis._contentLanguage = 'en' as Locale;\n\t\t}\n\n\t\t// 2. Initialize Translation Progress Maps\n\t\tconst langs = (publicEnv.AVAILABLE_CONTENT_LANGUAGES as Locale[]) || [];\n\t\tfor (const lang of langs) {\n\t\t\tthis.translationProgress[lang] = {\n\t\t\t\ttotal: new SvelteSet<string>(),\n\t\t\t\ttranslated: new SvelteSet<string>()\n\t\t\t};\n\t\t}\n\t}\n\n\t// Dynamic Getters/Setters for Language (Auto-sync with cookies)\n\tget systemLanguage() {\n\t\treturn this._systemLanguage;\n\t}\n\tset systemLanguage(v: Locale) {\n\t\tthis._systemLanguage = v;\n\t\tsetCookie('systemLanguage', v);\n\t}\n\n\tget contentLanguage() {\n\t\treturn this._contentLanguage;\n\t}\n\tset contentLanguage(v: Locale) {\n\t\tthis._contentLanguage = v;\n\t\tsetCookie('contentLanguage', v);\n\t}\n\n\t// Methods\n\tsetAvatarSrc(v: string) {\n\t\tthis.avatarSrc = normalizeAvatarUrl(v);\n\t}\n\n\tupdateTranslationStatus(value: Record<string, unknown>) {\n\t\tObject.assign(this.translationStatus, value);\n\t}\n\n\tsetTranslationStatusOpen(v: boolean) {\n\t\tthis.translationStatusOpen = v;\n\t}\n\n\tsetCompletionStatus(v: number) {\n\t\tthis.completionStatus = v;\n\t}\n}\n\nexport const app = new AppStore();\n\n// --- ENTERPRISE VALIDATION STORE ---\n\nexport const validationStore = {\n\tget errors() {\n\t\treturn Object.fromEntries(app.validationErrorsMap);\n\t},\n\tget isValid() {\n\t\tfor (const error of app.validationErrorsMap.values()) {\n\t\t\tif (error) return false;\n\t\t}\n\t\treturn true;\n\t},\n\tsetError: (fieldName: string, errorMessage: string | null) => {\n\t\tif (app.validationErrorsMap.get(fieldName) !== errorMessage) {\n\t\t\tapp.validationErrorsMap.set(fieldName, errorMessage);\n\t\t}\n\t},\n\tclearError: (fieldName: string) => {\n\t\tif (app.validationErrorsMap.has(fieldName)) {\n\t\t\tapp.validationErrorsMap.delete(fieldName);\n\t\t}\n\t},\n\tclearAllErrors: () => app.validationErrorsMap.clear(),\n\tgetError: (fieldName: string) => app.validationErrorsMap.get(fieldName) || null,\n\thasError: (fieldName: string) => !!app.validationErrorsMap.get(fieldName)\n};\n\n// --- ENTERPRISE DATA CHANGE TRACKING ---\n\nclass DataChangeStore {\n\thasChanges = $state(false);\n\tinitialDataSnapshot = $state('');\n\n\tsetHasChanges(v: boolean) {\n\t\tthis.hasChanges = v;\n\t}\n\n\tsetInitialSnapshot(data: Record<string, unknown>) {\n\t\tthis.initialDataSnapshot = JSON.stringify(data);\n\t\tthis.hasChanges = false;\n\t}\n\n\tcompareWithCurrent(currentData: Record<string, unknown>): boolean {\n\t\tif (!this.initialDataSnapshot) return false;\n\t\tconst currentSnapshot = JSON.stringify(currentData);\n\t\tconst changed = currentSnapshot !== this.initialDataSnapshot;\n\t\tif (this.hasChanges !== changed) this.hasChanges = changed;\n\t\treturn changed;\n\t}\n\n\treset() {\n\t\tthis.hasChanges = false;\n\t\tthis.initialDataSnapshot = '';\n\t}\n}\n\nexport const dataChangeStore = new DataChangeStore();\n\n// Skeleton Toaster Singleton\nexport const toaster = createToaster();\n\n// Static Constants\nexport const tableHeaders = ['id', 'email', 'username', 'role', 'createdAt'] as const;\nexport const indexer = undefined;\n\n// --- Language Store Wrappers (Compatibility with theme branch API) ---\n// These provide .value getter and .set() method that delegate to app store\n\nexport const systemLanguage = {\n\tget value() {\n\t\treturn app.systemLanguage;\n\t},\n\tset value(newValue: Locale) {\n\t\tapp.systemLanguage = newValue;\n\t},\n\tset(newValue: Locale) {\n\t\tapp.systemLanguage = newValue;\n\t},\n\tupdate(fn: (value: Locale) => Locale) {\n\t\tapp.systemLanguage = fn(app.systemLanguage);\n\t}\n};\n\nexport const contentLanguage = {\n\tget value() {\n\t\treturn app.contentLanguage;\n\t},\n\tset value(newValue: Locale) {\n\t\tapp.contentLanguage = newValue;\n\t},\n\tset(newValue: Locale) {\n\t\tapp.contentLanguage = newValue;\n\t},\n\tupdate(fn: (value: Locale) => Locale) {\n\t\tapp.contentLanguage = fn(app.contentLanguage);\n\t}\n};\n\n// --- Compatibility Exports for theme branch components ---\n\n// translationProgress - direct reference to app.translationProgress\nexport const translationProgress = {\n\tget value() {\n\t\treturn app.translationProgress;\n\t},\n\tset value(newValue: TranslationProgress) {\n\t\tObject.assign(app.translationProgress, newValue);\n\t},\n\tsubscribe(fn: (value: TranslationProgress) => void) {\n\t\tfn(app.translationProgress);\n\t\treturn () => {};\n\t}\n};\n\n// avatarSrc - provides .value getter and setter\nexport const avatarSrc = {\n\tget value() {\n\t\treturn app.avatarSrc;\n\t},\n\tset value(newValue: string) {\n\t\tapp.avatarSrc = newValue;\n\t},\n\tset(newValue: string) {\n\t\tapp.avatarSrc = newValue;\n\t}\n};\n\nexport const storeListboxValue = {\n\tget value() {\n\t\treturn app.listboxValueState;\n\t},\n\tset value(newValue: string) {\n\t\tapp.listboxValueState = newValue;\n\t},\n\tset(newValue: string) {\n\t\tapp.listboxValueState = newValue;\n\t},\n\tsubscribe(fn: (value: string) => void) {\n\t\tfn(app.listboxValueState);\n\t\treturn () => {};\n\t}\n};\n\n// tabSet - direct reference to app.tabSetState\nexport const tabSet = {\n\tget value() {\n\t\treturn app.tabSetState;\n\t},\n\tset value(newValue: number) {\n\t\tapp.tabSetState = newValue;\n\t},\n\tset(newValue: number) {\n\t\tapp.tabSetState = newValue;\n\t},\n\tsubscribe(fn: (value: number) => void) {\n\t\tfn(app.tabSetState);\n\t\treturn () => {};\n\t},\n\tupdate(fn: (value: number) => number) {\n\t\tapp.tabSetState = fn(app.tabSetState);\n\t}\n};\n"],"names":["createToaster"],"mappings":"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","x_google_ignoreList":[0]}