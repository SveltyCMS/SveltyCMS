{"version":3,"file":"DatabasePoolDiagnostics.js","sources":["../../../../../../shared/features/src/dashboard/widgets/DatabasePoolDiagnostics.svelte"],"sourcesContent":["<script lang=\"ts\" module>\n\texport const widgetMeta = {\n\t\tname: 'Database Pool',\n\t\ticon: 'mdi:database-cog',\n\t\tdescription: 'Monitor database connection pool health and diagnostics',\n\t\tdefaultSize: { w: 2, h: 3 },\n\t\tcategory: 'monitoring'\n\t};\n</script>\n\n<script lang=\"ts\">\n\t/**\n\t * @file Database Pool Diagnostics Widget\n\t *\n\t * Displays real-time connection pool statistics and health recommendations.\n\t * Shows metrics from DatabaseResilience system.\n\t */\n\timport BaseWidget from '../BaseWidget.svelte';\n\timport type { WidgetSize } from '@cms-types';\n\n\tconst {\n\t\tlabel = 'Connection Pool',\n\t\ttheme = 'light',\n\t\ticon = 'mdi:database-cog',\n\t\twidgetId = undefined,\n\t\tsize = { w: 2, h: 3 } as WidgetSize,\n\t\tonSizeChange = (_newSize: WidgetSize) => {},\n\t\tonRemove = () => {}\n\t}: {\n\t\tlabel?: string;\n\t\ttheme?: 'light' | 'dark';\n\t\ticon?: string;\n\t\twidgetId?: string;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tonRemove?: () => void;\n\t} = $props();\n\n\t/**\n\t * Get status color based on health\n\t */\n\tfunction getHealthColor(health: string): string {\n\t\tswitch (health) {\n\t\t\tcase 'healthy':\n\t\t\t\treturn 'text-success-600 bg-success-50';\n\t\t\tcase 'degraded':\n\t\t\t\treturn 'text-warning-600 bg-warning-50';\n\t\t\tcase 'critical':\n\t\t\t\treturn 'text-error-600 bg-error-50';\n\t\t\tdefault:\n\t\t\t\treturn 'text-gray-600 bg-gray-50';\n\t\t}\n\t}\n\n\t/**\n\t * Get utilization color\n\t */\n\tfunction getUtilizationColor(utilization: number): string {\n\t\tif (utilization >= 90) return 'text-error-600';\n\t\tif (utilization >= 75) return 'text-warning-600';\n\t\treturn 'text-success-600';\n\t}\n\n\t/**\n\t * Get utilization bar color\n\t */\n\tfunction getUtilizationBarColor(utilization: number): string {\n\t\tif (utilization >= 90) return 'bg-error-600';\n\t\tif (utilization >= 75) return 'bg-warning-500';\n\t\treturn 'bg-success-500';\n\t}\n\n\t/**\n\t * Get recommendation icon color\n\t */\n\tfunction getRecommendationIconColor(recommendation: string): string {\n\t\tif (recommendation.includes('healthy')) return 'text-success-600';\n\t\tif (recommendation.includes('Consider') || recommendation.includes('increase') || recommendation.includes('reduce')) return 'text-warning-600';\n\t\treturn 'text-info-600';\n\t}\n</script>\n\n<BaseWidget\n\t{label}\n\t{theme}\n\t{icon}\n\t{size}\n\t{onSizeChange}\n\tendpoint=\"/api/database/pool-diagnostics\"\n\tpollInterval={30000}\n\t{widgetId}\n\tonCloseRequest={onRemove}\n>\n\t{#snippet children({ data: diagnostics, isLoading, error })}\n\t\t{#if isLoading && !diagnostics}\n\t\t\t<!-- Loading State -->\n\t\t\t<div class=\"flex items-center justify-center py-8\">\n\t\t\t\t<div class=\"h-8 w-8 animate-spin rounded-full border-b-2 border-primary-600\"></div>\n\t\t\t</div>\n\t\t{:else if error}\n\t\t\t<!-- Error State -->\n\t\t\t<div class=\"rounded-lg border border-error-200 bg-error-50 p-4 dark:border-error-800 dark:bg-error-900/20\">\n\t\t\t\t<p class=\"text-sm text-error-800 dark:text-error-200\">{error}</p>\n\t\t\t</div>\n\t\t{:else if diagnostics}\n\t\t\t<!-- Health Status Badge -->\n\t\t\t<div class=\"mb-4\">\n\t\t\t\t<span class=\"inline-flex items-center rounded-full px-3 py-1 text-sm font-medium {getHealthColor(diagnostics.healthStatus)}\">\n\t\t\t\t\t<span class=\"mr-2 h-2 w-2 rounded-full bg-current\"></span>\n\t\t\t\t\t{diagnostics.healthStatus.charAt(0).toUpperCase() + diagnostics.healthStatus.slice(1)}\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<!-- Statistics Grid -->\n\t\t\t<div class=\"mb-6 grid grid-cols-2 gap-4\">\n\t\t\t\t<!-- Total Connections -->\n\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700/50\">\n\t\t\t\t\t<div class=\"mb-1 text-xs text-surface-500 dark:text-surface-50\">Total</div>\n\t\t\t\t\t<div class=\"text-2xl font-bold text-surface-900 dark:text-white\">{diagnostics.totalConnections}</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Active Connections -->\n\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700/50\">\n\t\t\t\t\t<div class=\"mb-1 text-xs text-surface-500 dark:text-surface-50\">Active</div>\n\t\t\t\t\t<div class=\"text-2xl font-bold text-surface-900 dark:text-white\">{diagnostics.activeConnections}</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Idle Connections -->\n\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700/50\">\n\t\t\t\t\t<div class=\"mb-1 text-xs text-surface-500 dark:text-surface-50\">Idle</div>\n\t\t\t\t\t<div class=\"text-2xl font-bold text-surface-900 dark:text-white\">{diagnostics.idleConnections}</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Waiting Requests -->\n\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700/50\">\n\t\t\t\t\t<div class=\"mb-1 text-xs text-surface-500 dark:text-surface-50\">Waiting</div>\n\t\t\t\t\t<div class=\"text-2xl font-bold {diagnostics.waitingRequests > 0 ? 'text-warning-600' : 'text-surface-900 dark:text-white'}\">\n\t\t\t\t\t\t{diagnostics.waitingRequests}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<!-- Utilization Bar -->\n\t\t\t<div class=\"mb-6\">\n\t\t\t\t<div class=\"mb-2 flex items-center justify-between\">\n\t\t\t\t\t<span class=\"text-sm font-medium text-surface-700 dark:text-surface-300\">Pool Utilization</span>\n\t\t\t\t\t<span class=\"text-sm font-semibold {getUtilizationColor(diagnostics.poolUtilization)}\">\n\t\t\t\t\t\t{diagnostics.poolUtilization.toFixed(1)}%\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"h-3 w-full overflow-hidden rounded-full bg-surface-200 dark:bg-surface-700\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"h-full rounded-full transition-all duration-500 {getUtilizationBarColor(diagnostics.poolUtilization)}\"\n\t\t\t\t\t\tstyle=\"width: {Math.min(diagnostics.poolUtilization, 100)}%\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<!-- Recommendations -->\n\t\t\t{#if diagnostics.recommendations && diagnostics.recommendations.length > 0}\n\t\t\t\t<div class=\"border-t border-surface-200 pt-4 dark:text-surface-50\">\n\t\t\t\t\t<h4 class=\"mb-2 text-sm font-semibold text-surface-700 dark:text-surface-300\">Recommendations</h4>\n\t\t\t\t\t<ul class=\"space-y-2\">\n\t\t\t\t\t\t{#each diagnostics.recommendations as recommendation}\n\t\t\t\t\t\t\t<li class=\"flex items-start gap-2 text-sm text-surface-600 dark:text-surface-50\">\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\tclass=\"mt-0.5 h-4 w-4 shrink-0 {getRecommendationIconColor(recommendation)}\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\td=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<span>{recommendation}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t{/snippet}\n</BaseWidget>\n"],"names":["$$renderer","$.attr_class","$.stringify","$.escape","$.attr_style","$.ensure_array_like"],"mappings":";;MACc,aAAU;AAAA,EACtB,MAAM;AAAA,EACN,MAAM;AAAA,EACN,aAAa;AAAA,EACb,eAAe,GAAG,GAAG,GAAG,EAAC;AAAA,EACzB,UAAU;;;wCAIZ;;MAWE,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,WAAW;AAAA,MACX,SAAS,GAAG,GAAG,GAAG,EAAC;AAAA,MACnB,eAAY,CAAI,aAAyB;AAAA,MAAC;AAAA,MAC1C,iBAAiB;AAAA,MAAC;AAAA;aAcV,eAAe,QAAwB;cACvC,QAAM;AAAA,aACR;iBACG;AAAA,aACH;iBACG;AAAA,aACH;iBACG;AAAA;iBAEA;AAAA;IAEV;aAKS,oBAAoB,aAA6B;UACrD,eAAe,GAAE,QAAS;UAC1B,eAAe,GAAE,QAAS;aACvB;AAAA,IACR;aAKS,uBAAuB,aAA6B;UACxD,eAAe,GAAE,QAAS;UAC1B,eAAe,GAAE,QAAS;aACvB;AAAA,IACR;aAKS,2BAA2B,gBAAgC;AAC/D,UAAA,eAAe,SAAS,SAAS,UAAU;AAC3C,UAAA,eAAe,SAAS,UAAU,KAAK,eAAe,SAAS,UAAU,KAAK,eAAe,SAAS,QAAQ,UAAU;aACrH;AAAA,IACR;;AAcU,UAAA,WAAA,wBAAW,MAAM,aAAa,WAAW,SAAK;AAClD,YAAA,cAAc,aAAW;;;;;cAKpB,OAAK;;6MAG0C,KAAK,CAAA,YAAA;AAAA;;gBAEpD,aAAW;;AAG+D,cAAAA,YAAA,KAAA,0BAAAC,WAAA,uEAAAC,UAAA,eAAe,YAAY,YAAY,CAAA,CAAA,EAAA,CAAA,+DAAAC,YAEvH,YAAY,aAAa,OAAO,CAAC,EAAE,gBAAgB,YAAY,aAAa,MAAM,CAAC,CAAA,CAAA,yQAAAA,YASlB,YAAY,gBAAgB,CAAA,gOAAAA,YAM5B,YAAY,iBAAiB,CAAA,8NAAAA,YAM7B,YAAY,eAAe,CAAA,oKAAAF,WAAA,sBAAAC,UAM7D,YAAY,kBAAkB,IAAI,qBAAqB,kCAAkC,CAAA,EAAA,CAAA,IAAAC,YACvH,YAAY,eAAe,iPASO,oBAAoB,YAAY,eAAe,CAAA,CAAA,EAAA,CAAA,IAAAA,YACjF,YAAY,gBAAgB,QAAQ,CAAC,CAAA,CAAA,8GAAAF,WAAA,mDAAAC,UAKkB,uBAAuB,YAAY,eAAe,CAAA,CAAA,EAAA,CAAA,GAAAE,WAAA,UAAAF,UAC3F,KAAK,IAAI,YAAY,iBAAiB,GAAG,CAAA,CAAA,GAAA,CAAA,sBAAA;kBAMtD,YAAY,mBAAmB,YAAY,gBAAgB,SAAS,GAAC;;;AAIhE,sBAAA,aAAAG,kBAAA,YAAY,eAAe;;sBAAI,iBAAc,WAAA,OAAA;2KAGjB,2BAA2B,cAAc,CAAA,CAAA,EAAA,CAAA,kNAAAF,YAYnE,cAAc,CAAA,cAAA;AAAA;;;;;;;;;;;;;;;;QA/F3B;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA;sBAEa;AAAA,QACb;AAAA,wBACe;AAAA,QAEN;AAAA;;EAbH,CAAA;;"}