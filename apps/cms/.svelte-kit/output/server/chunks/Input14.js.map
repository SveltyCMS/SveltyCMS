{"version":3,"file":"Input14.js","sources":["../../../../src/widgets/core/Date/Input.svelte"],"sourcesContent":["<!--\n@file src/widgets/core/Date/Input.svelte\n@component\n**Date Widget Input Component**\n\nProvides native HTML date input with automatic ISO 8601 normalization.\nPart of the Three Pillars Architecture for widget system.\n\n@example\n<DateInput bind:value={dateValue} {field} />\n\n#### Props\n- `field: FieldType` - Widget field definition with metadata\n- `value: string | null | undefined` - ISO 8601 date string (bindable)\n- `error: string | null | undefined` - Validation error message\n\n#### Features\n- Native date picker for optimal UX\n- ISO 8601 normalization\n- Timezone consistency\n- Min/max date constraints\n- Automatic validation\n- Required field support\n- Helper text support\n- Accessible with ARIA labels\n-->\n\n<script lang=\"ts\">\n\timport { getFieldName } from '@shared/utils/utils';\n\timport { validationStore } from '@shared/stores/store.svelte';\n\timport type { FieldType } from './';\n\timport { tokenTarget } from '@shared/services/token/tokenTarget';\n\n\tinterface Props {\n\t\tfield: FieldType;\n\t\tvalue: string | null | undefined;\n\t\terror?: string | null | undefined;\n\t}\n\n\tlet { field, value = $bindable(), error }: Props = $props();\n\n\tconst fieldName = $derived(getFieldName(field));\n\n\t// Convert ISO string to YYYY-MM-DD format for native input\n\n\tconst inputValue = $derived.by(() => {\n\t\tif (!value) return '';\n\t\ttry {\n\t\t\treturn value.substring(0, 10);\n\t\t} catch {\n\t\t\treturn '';\n\t\t}\n\t});\n\n\t// Calculate minimum date constraint\n\n\tconst minDate = $derived.by(() => {\n\t\tif (!field.minDate) return undefined;\n\t\ttry {\n\t\t\treturn new Date(field.minDate as string | Date).toISOString().substring(0, 10);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t});\n\n\t// Calculate maximum date constraint\n\tconst maxDate = $derived.by(() => {\n\t\tif (!field.maxDate) return undefined;\n\t\ttry {\n\t\t\treturn new Date(field.maxDate as string | Date).toISOString().substring(0, 10);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t});\n\n\t// Handle date input change\n\tfunction handleInput(event: Event & { currentTarget: HTMLInputElement }): void {\n\t\tconst dateStr = event.currentTarget.value;\n\n\t\tif (dateStr) {\n\t\t\ttry {\n\t\t\t\tconst selectedDate = new Date(dateStr);\n\n\t\t\t\t// Validate min date constraint\n\t\t\t\tif (field.minDate && selectedDate < new Date(field.minDate as string | Date)) {\n\t\t\t\t\tvalidationStore.setError(fieldName, `Date must be on or after ${new Date(field.minDate as string | Date).toLocaleDateString()}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Validate max date constraint\n\t\t\t\tif (field.maxDate && selectedDate > new Date(field.maxDate as string | Date)) {\n\t\t\t\t\tvalidationStore.setError(fieldName, `Date must be on or before ${new Date(field.maxDate as string | Date).toLocaleDateString()}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Convert to ISO string at UTC midnight\n\t\t\t\tvalue = selectedDate.toISOString();\n\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t} catch (e) {\n\t\t\t\tvalidationStore.setError(fieldName, 'Invalid date format');\n\t\t\t}\n\t\t} else {\n\t\t\tvalue = null;\n\t\t\tif (field.required) {\n\t\t\t\tvalidationStore.setError(fieldName, 'This field is required');\n\t\t\t} else {\n\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Handle blur for final validation\n\tfunction handleBlur(): void {\n\t\tif (!value && field.required) {\n\t\t\tvalidationStore.setError(fieldName, 'This field is required');\n\t\t}\n\t}\n</script>\n\n<div class=\"relative space-y-1\">\n\t<!-- Screen Reader Only Label -->\n\t<label for={field.db_fieldName} class=\"sr-only\">\n\t\t{field.label}\n\t\t{#if field.required}\n\t\t\t<span>(required)</span>\n\t\t{/if}\n\t</label>\n\n\t<!-- Date Input -->\n\t<div class=\"relative w-full\">\n\t\t<input\n\t\t\ttype=\"date\"\n\t\t\tid={field.db_fieldName}\n\t\t\tname={field.db_fieldName}\n\t\t\trequired={field.required}\n\t\t\tvalue={inputValue}\n\t\t\tmin={minDate}\n\t\t\tmax={maxDate}\n\t\t\toninput={handleInput}\n\t\t\tonblur={handleBlur}\n\t\t\tuse:tokenTarget={{\n\t\t\t\tname: field.db_fieldName,\n\t\t\t\tlabel: field.label,\n\t\t\t\tcollection: (field as any).collection\n\t\t\t}}\n\t\t\tclass=\"input\"\n\t\t\tclass:invalid={error}\n\t\t\taria-invalid={!!error}\n\t\t\taria-describedby={error ? `${field.db_fieldName}-error` : field.helper ? `${field.db_fieldName}-helper` : undefined}\n\t\t\taria-required={field.required}\n\t\t\tdata-testid=\"date-input\"\n\t\t/>\n\t</div>\n\n\t<!-- Helper Text -->\n\t{#if field.helper && !error}\n\t\t<p id={`${field.db_fieldName}-helper`} class=\"text-xs text-gray-600 dark:text-gray-400\">\n\t\t\t{field.helper}\n\t\t</p>\n\t{/if}\n\n\t<!-- Error Message -->\n\t{#if error}\n\t\t<p id={`${field.db_fieldName}-error`} class=\"text-xs text-error-500\" role=\"alert\" aria-live=\"polite\">\n\t\t\t{error}\n\t\t</p>\n\t{/if}\n</div>\n\n<style>\n\t/* Screen reader only utility */\n\t.sr-only {\n\t\tposition: absolute;\n\t\twidth: 1px;\n\t\theight: 1px;\n\t\tpadding: 0;\n\t\tmargin: -1px;\n\t\toverflow: hidden;\n\t\tclip: rect(0, 0, 0, 0);\n\t\twhite-space: nowrap;\n\t\tborder: 0;\n\t}\n</style>\n"],"names":["$$renderer","$.attr","$.escape"],"mappings":";;;;wCA2BA;UAYO,OAAO,QAAK,QAAgB,MAAK,IAAA;AAEZ,iBAAa,KAAK;AAIvC,UAAA,cAAU,MAAqB;AAC/B,UAAA,CAAA,cAAc;AACf,UAAA;AACI,eAAA,MAAM,UAAU,GAAG,EAAE;AAAA,MAC7B,QAAQ;eACA;AAAA,MACR;AAAA,IACD,GAAC;AAIK,UAAA,WAAO,MAAqB;WAC5B,MAAM,QAAO,QAAS;AACvB,UAAA;mBACQ,KAAK,MAAM,OAAO,EAAmB,cAAc,UAAU,GAAG,EAAE;AAAA,MAC9E,QAAQ;eACA;AAAA,MACR;AAAA,IACD,GAAC;AAGK,UAAA,WAAO,MAAqB;WAC5B,MAAM,QAAO,QAAS;AACvB,UAAA;mBACQ,KAAK,MAAM,OAAO,EAAmB,cAAc,UAAU,GAAG,EAAE;AAAA,MAC9E,QAAQ;eACA;AAAA,MACR;AAAA,IACD,GAAC;AAgDW,IAAAA,YAAA,KAAA,yCAAAC,KAAA,OAAA,MAAM,YAAY,CAAA,kCAAAC,YAC5B,MAAM,KAAK,CAAA,GAAA;AACP,QAAA,MAAM,UAAQ;;;;;;mGASd,MAAM,YAAY,CAAA,GAAAD,KAAA,QAChB,MAAM,YAAY,CAAA,GAAAA,KAAA,YACd,MAAM,gCACT,UAAU,CAAA,GAAAA,KAAA,OACZ,OAAO,CAAA,GAAAA,KAAA,OACP,OAAO,6CASG,MAAK,CAAA,CAAA,GAAAA,KAAA,gBAAA,CAAA,CACJ,KAAK,CAAA,GAAAA,KAAA,oBACH,QAAW,GAAA,MAAM,YAAY,WAAW,MAAM,SAAM,GAAM,MAAM,YAAY,YAAY,MAAS,CAAA,GAAAA,KAAA,iBACpG,MAAM,QAAQ,CAAA,oCAAA;QAM1B,MAAM,UAAM,CAAK,OAAK;;AAChB,MAAAD,YAAA,KAAA,KAAAC,KAAA,MAAA,GAAA,MAAM,YAAY,SAAA,CAAA,qDAAAC,YAC1B,MAAM,MAAM,CAAA,MAAA;AAAA;;;;QAKV,OAAK;;0CACC,MAAM,YAAY,QAAA,CAAA,mEAAAA,YAC1B,KAAK,CAAA,MAAA;AAAA;;;;;EA/CD,CAAA;;"}