{"version":3,"file":"websiteToken.js","sources":["../../../../../../shared/database/src/mongodb/models/contentStructure.ts","../../../../../../shared/database/src/mongodb/models/systemSetting.ts","../../../../../../shared/database/src/mongodb/models/theme.ts","../../../../../../shared/database/src/mongodb/models/websiteToken.ts"],"sourcesContent":["/**\n * @file src/databases/mongodb/models/contentStructure.ts\n * @description MongoDB schema and model for Content Structure.\n *\n * This module defines a schema and model for Content Structure in the MongoDB database.\n * Content Structure represents the hierarchical organization of content in the CMS.\n *\n * Features:\n * - Defines a schema for Content Structure\n * - Defines a model for Content Structure\n * - Defines static methods for Content Structure\n * - Defines indexes for Content Structure\n */\n\nimport type { ContentNode, Translation } from '@cms-types/content';\nimport { StatusTypes } from '@cms-types/content';\nimport type { DatabaseError, DatabaseResult } from '@shared/database/dbInterface';\nimport { generateId } from '@shared/database/mongodb/methods/mongoDBUtils';\nimport { logger } from '@shared/utils/logger';\nimport type { Model, Document as MongooseDocument } from 'mongoose';\nimport mongoose, { Schema } from 'mongoose';\n\n// --- Type Definitions for Mongoose Documents content structure---\nexport interface ContentStructureDocument extends Omit<ContentNode, 'collectionDef' | '_id' | 'children' | 'nodeType'>, MongooseDocument {\n\t_id: any;\n\tnodeType: 'category' | 'collection'; // Explicitly define discriminator key\n\tlinks?: Array<string>; // Array of string links for content structure\n\tcollectionDef?: any; // Avoiding circular dependency on Schema\n\tpermissions?: Record<string, Record<string, boolean>>;\n\tlivePreview?: boolean;\n\tstrict?: boolean;\n\trevision?: boolean;\n\tdescription?: string;\n\tslug?: string;\n\tstatus?: import('@cms-types/content').StatusType;\n}\n\n/** Represents a category-specific document. */\nexport interface CategoryDocument extends ContentStructureDocument {\n\tnodeType: 'category';\n}\n\n/** Represents a collection-specific document. */\nexport interface CollectionDocument extends ContentStructureDocument {\n\tnodeType: 'collection';\n}\n\n// Flag to track if discriminators have been registered\nlet discriminatorsRegistered = false;\n\n// --- Schema Definitions ---\n\n// Translation sub-schema\n// Note: _id: false prevents Mongoose from adding unnecessary _id to each translation object\nconst translationSchema = new Schema<Translation>(\n\t{\n\t\tlanguageTag: { type: String, required: true },\n\t\ttranslationName: { type: String, required: true },\n\t\tisDefault: { type: Boolean, default: false }\n\t},\n\t{ _id: false }\n);\n\n// Base schema for the content structure\nconst contentStructureSchema = new Schema<ContentStructureDocument>(\n\t{\n\t\t_id: { type: String, required: true, default: () => generateId() },\n\t\tname: { type: String, required: true },\n\t\tpath: { type: String, index: true }, // Add path field for URL routing\n\t\ticon: { type: String, default: 'bi:folder' },\n\t\torder: { type: Number, default: 999 },\n\t\tnodeType: { type: String, required: true, enum: ['category', 'collection'] },\n\t\ttranslations: [translationSchema],\n\t\tparentId: { type: String, default: null, index: true },\n\t\t// Properties from ContentNode that are not in the base Mongoose Document\n\t\t// label removed if not in ContentNode\n\t\tpermissions: Schema.Types.Mixed,\n\t\tlivePreview: { type: Boolean },\n\t\tstrict: { type: Boolean },\n\t\trevision: { type: Boolean },\n\t\tdescription: { type: String },\n\t\tslug: { type: String },\n\t\tstatus: {\n\t\t\ttype: String,\n\t\t\tenum: Object.values(StatusTypes)\n\t\t},\n\t\tlinks: [{ type: String }],\n\t\tcollectionDef: { type: Schema.Types.Mixed }, // Use 'collectionDef' instead of 'collection' to avoid Mongoose reserved key warning\n\t\ttenantId: { type: String, index: true } // Add tenantId for multi-tenancy support\n\t},\n\t{\n\t\ttimestamps: true,\n\t\tcollection: 'system_content_structure',\n\t\tdiscriminatorKey: 'nodeType', // Use nodeType to differentiate between category and collection\n\t\t_id: false // Disable Mongoose auto-ObjectId generation since we use UUID strings\n\t}\n);\n\n// --- Indexes ---\ncontentStructureSchema.index({ updatedAt: -1 });\ncontentStructureSchema.index({ 'translations.languageTag': 1 });\n\n// --- Compound Indexes ---\ncontentStructureSchema.index({ tenantId: 1, parentId: 1, order: 1 }); // Hierarchical content queries\ncontentStructureSchema.index({ tenantId: 1, nodeType: 1, status: 1 }); // Content type filtering\ncontentStructureSchema.index({ tenantId: 1, path: 1 }, { unique: true, sparse: true }); // URL routing (unique per tenant)\ncontentStructureSchema.index({ tenantId: 1, slug: 1 }, { sparse: true }); // Slug-based lookups\ncontentStructureSchema.index({ tenantId: 1, 'translations.languageTag': 1, nodeType: 1 }); // Multi-language content\ncontentStructureSchema.index({ parentId: 1, order: 1, nodeType: 1 }); // Child node ordering\ncontentStructureSchema.index({ nodeType: 1, updatedAt: -1 }); // Recent content by type\n\n// --- DTOs ---\nexport interface ContentStructureReorderItem {\n\tid: string;\n\tparentId: string | null;\n\torder: number;\n\tpath: string;\n}\n\n// --- Static Methods ---\n\n/**\n * Utility function to create a standardized DatabaseError object.\n * @param error - The original error object.\n * @param code - A custom error code.\n * @param message - A descriptive error message.\n * @returns A DatabaseError object.\n */\nconst createDatabaseError = (error: unknown, code: string, message: string): DatabaseError => {\n\tconst err = error instanceof Error ? error : new Error(String(error));\n\tlogger.error(`${code}: ${message}`, err);\n\treturn {\n\t\tcode,\n\t\tmessage,\n\t\tdetails: err.message,\n\t\tstack: err.stack\n\t};\n};\n\ncontentStructureSchema.statics = {\n\tasync getContentStructure(): Promise<DatabaseResult<ContentStructureDocument[]>> {\n\t\ttry {\n\t\t\tconst contentStructure = await this.find({}).lean();\n\t\t\treturn { success: true, data: contentStructure };\n\t\t} catch (error) {\n\t\t\tconst message = 'Error fetching content structure';\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage,\n\t\t\t\terror: createDatabaseError(error, 'CONTENT_GET_CONTENT_STRUCTURE_ERROR', message)\n\t\t\t};\n\t\t}\n\t},\n\n\tasync upsertCategory(category: ContentNode): Promise<DatabaseResult<CategoryDocument>> {\n\t\ttry {\n\t\t\tconst result = await this.findOneAndUpdate(\n\t\t\t\t{ _id: category._id },\n\t\t\t\t{ $set: { ...category, nodeType: 'category' } },\n\t\t\t\t{ upsert: true, new: true }\n\t\t\t).lean();\n\t\t\tif (!result) {\n\t\t\t\tconst message = `Failed to upsert category: ${category.path}`;\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage,\n\t\t\t\t\terror: createDatabaseError(new Error(message), 'CONTENT_UPSERT_CATEGORY_ERROR', message)\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn { success: true, data: result as CategoryDocument };\n\t\t} catch (error) {\n\t\t\tconst message = `Error upserting category: ${category.path}`;\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage,\n\t\t\t\terror: createDatabaseError(error, 'CONTENT_UPSERT_CATEGORY_ERROR', message)\n\t\t\t};\n\t\t}\n\t},\n\tasync upsertCollection(collection: ContentNode): Promise<DatabaseResult<CollectionDocument>> {\n\t\ttry {\n\t\t\tconst result = await this.findOneAndUpdate(\n\t\t\t\t{ _id: collection._id },\n\t\t\t\t{ $set: { ...collection, nodeType: 'collection' } },\n\t\t\t\t{ upsert: true, new: true }\n\t\t\t).lean();\n\t\t\tif (!result) {\n\t\t\t\tconst message = `Failed to upsert collection: ${collection.path || collection._id}`;\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage,\n\t\t\t\t\terror: createDatabaseError(new Error(message), 'CONTENT_UPSERT_COLLECTION_ERROR', message)\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn { success: true, data: result as CollectionDocument };\n\t\t} catch (error) {\n\t\t\tconst message = `Error upserting collection: ${collection.path || collection._id}`;\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage,\n\t\t\t\terror: createDatabaseError(error, 'CONTENT_UPSERT_COLLECTION_ERROR', message)\n\t\t\t};\n\t\t}\n\t},\n\n\tasync getNodeById(id: string): Promise<DatabaseResult<ContentStructureDocument | null>> {\n\t\ttry {\n\t\t\tconst node = await this.findOne({ _id: id }).lean();\n\t\t\treturn { success: true, data: node };\n\t\t} catch (error) {\n\t\t\tconst message = `Error fetching node by id: ${id}`;\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage,\n\t\t\t\terror: createDatabaseError(error, 'CONTENT_GET_NODE_BY_ID_ERROR', message)\n\t\t\t};\n\t\t}\n\t},\n\n\tasync getChildren(parentId: string): Promise<DatabaseResult<ContentStructureDocument[]>> {\n\t\ttry {\n\t\t\tconst children = await this.find({ parentId }).sort({ order: 1 }).lean();\n\t\t\treturn { success: true, data: children };\n\t\t} catch (error) {\n\t\t\tconst message = `Error fetching children for parent id: ${parentId}`;\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage,\n\t\t\t\terror: createDatabaseError(error, 'CONTENT_GET_CHILDREN_ERROR', message)\n\t\t\t};\n\t\t}\n\t},\n\n\t/**\n\t * Validates a parent-child relationship before persisting changes.\n\t */\n\tasync validateMove(nodeId: string, newParentId: string | null): Promise<DatabaseResult<void>> {\n\t\ttry {\n\t\t\tconst node = await this.findOne({ _id: nodeId }).lean();\n\t\t\tconst parent = newParentId ? await this.findOne({ _id: newParentId }).lean() : null;\n\n\t\t\tif (!node) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: 'Node not found',\n\t\t\t\t\terror: createDatabaseError(new Error('Node not found'), 'CONTENT_NODE_NOT_FOUND', 'Node not found')\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (parent && parent.nodeType === 'collection' && node.nodeType === 'category') {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: 'Categories cannot be nested under collections',\n\t\t\t\t\terror: createDatabaseError(new Error('Invalid nesting'), 'CONTENT_INVALID_NESTING', 'Categories cannot be nested under collections')\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn { success: true, data: undefined };\n\t\t} catch (error) {\n\t\t\tconst message = `Error validating move for node ${nodeId}`;\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage,\n\t\t\t\terror: createDatabaseError(error, 'CONTENT_VALIDATE_MOVE_ERROR', message)\n\t\t\t};\n\t\t}\n\t},\n\n\t/**\n\t * Persists a full or partial content structure reorder.\n\t * This method updates parentId, order, and path atomically.\n\t */\n\tasync reorderStructure(items: ContentStructureReorderItem[], tenantId?: string): Promise<DatabaseResult<void>> {\n\t\tconst session = await mongoose.startSession();\n\t\tsession.startTransaction();\n\n\t\ttry {\n\t\t\tconst bulkOps = items.map((item) => ({\n\t\t\t\tupdateOne: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t_id: item.id,\n\t\t\t\t\t\t...(tenantId ? { tenantId } : {})\n\t\t\t\t\t} as any,\n\t\t\t\t\tupdate: {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tparentId: item.parentId as any,\n\t\t\t\t\t\t\torder: item.order,\n\t\t\t\t\t\t\tpath: item.path\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tif (bulkOps.length > 0) {\n\t\t\t\tawait this.bulkWrite(bulkOps, { session });\n\t\t\t}\n\n\t\t\tawait session.commitTransaction();\n\t\t\treturn { success: true, data: undefined };\n\t\t} catch (error) {\n\t\t\tawait session.abortTransaction();\n\t\t\tconst message = 'Error reordering content structure';\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage,\n\t\t\t\terror: createDatabaseError(error, 'CONTENT_REORDER_ERROR', message)\n\t\t\t};\n\t\t} finally {\n\t\t\tsession.endSession();\n\t\t}\n\t}\n};\n\n/**\n * Register discriminators for the content structure model.\n * This allows us to have different schemas for 'category' and 'collection' if needed in the future while storing them in the same collection.\n */\nexport function registerContentStructureDiscriminators() {\n\tif (discriminatorsRegistered) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\tconst baseModel = mongoose.models.system_content_structure as Model<ContentStructureDocument>;\n\t\tif (!baseModel) {\n\t\t\tthrow new Error('Base model system_content_structure not found. It must be created before registering discriminators.');\n\t\t}\n\n\t\tif (!baseModel.discriminators) {\n\t\t\tbaseModel.discriminators = {};\n\t\t}\n\n\t\tif (!baseModel.discriminators['category']) {\n\t\t\tbaseModel.discriminator('category', new Schema<CategoryDocument>({}, { _id: false }));\n\t\t\tlogger.debug('CONTENT_STRUCTURE_CATEGORY_DISCRIMINATOR_REGISTERED');\n\t\t}\n\n\t\tif (!baseModel.discriminators['collection']) {\n\t\t\tbaseModel.discriminator('collection', new Schema<CollectionDocument>({}, { _id: false }));\n\t\t\tlogger.debug('CONTENT_STRUCTURE_COLLECTION_DISCRIMINATOR_REGISTERED');\n\t\t}\n\n\t\tdiscriminatorsRegistered = true;\n\t} catch (error) {\n\t\tlogger.error('CONTENT_STRUCTURE_DISCRIMINATOR_REGISTRATION_ERROR', error);\n\t\t// Don't re-throw during initialization, as it can crash the server start-up.\n\t}\n}\n\n// --- Model Export ---\n\n// Force model recreation to ensure schema changes take effect (especially _id: false)\nif (mongoose.models.system_content_structure) {\n\tdelete mongoose.models.system_content_structure;\n}\n\n// Create the model\nexport const ContentStructureModel = mongoose.model<\n\tContentStructureDocument,\n\tModel<ContentStructureDocument, object, object, object, object, object> & typeof contentStructureSchema.statics\n>('system_content_structure', contentStructureSchema);\n","/**\n * @file src/databases/mongodb/models/setting.ts\n * @description Mongoose schema and model for system key-value settings.\n *\n * ### Features\n * - Schema definition with fields for key, value, scope, category, and timestamps\n * - Indexes for efficient querying by key, scope, and category\n * - UUID primary key generation\n * - Supports different setting scopes (system, public, private)\n * - Categorization of settings for security and organization\n */\n\nimport mongoose, { Schema } from 'mongoose';\nimport { generateId } from '@shared/database/mongodb/methods/mongoDBUtils';\nimport { nowISODateString } from '@shared/utils/dateUtils';\n\nexport interface SystemSetting {\n\t_id: string; // UUID primary key\n\tkey: string;\n\tvalue: unknown;\n\tscope: string; // e.g., 'system', 'public', 'private'\n\tcategory: string; // 'public' | 'private' - setting classification for security/organization\n\tisGlobal?: boolean;\n\tupdatedAt?: string; // ISODateString\n}\n\nconst SystemSettingSchema = new Schema<SystemSetting>(\n\t{\n\t\t_id: { type: String, required: true, default: () => generateId() }, // UUID primary key\n\t\tkey: { type: String, required: true, index: true, unique: true },\n\t\tvalue: { type: Schema.Types.Mixed, required: true },\n\t\tscope: { type: String, default: 'system', index: true },\n\t\tcategory: { type: String, enum: ['public', 'private'], default: 'public', index: true },\n\t\tisGlobal: { type: Boolean, default: true },\n\t\tupdatedAt: { type: String, default: () => nowISODateString() }\n\t},\n\t{\n\t\ttimestamps: true,\n\t\tcollection: 'system_settings',\n\t\tstrict: true,\n\t\t_id: false // Disable Mongoose auto-ObjectId generation\n\t}\n);\n\n// Force model recreation if schema changed\nif (mongoose.models.system_settings) {\n\tdelete mongoose.models.system_settings;\n}\nif (mongoose.models.SystemSetting) {\n\tdelete mongoose.models.SystemSetting;\n}\n\nexport const SystemSettingModel =\n\t(mongoose.models?.SystemSetting as mongoose.Model<SystemSetting> | undefined) ||\n\tmongoose.model<SystemSetting>('SystemSetting', SystemSettingSchema);\n","/**\n * @file src/models/theme.ts\n * @description Mongoose schema and model definition for themes in the CMS.\n *\n * This module defines the `themeSchema` and `ThemeModel` for managing themes in the CMS\n *\n * ### Features\n * - Schema definition with fields for theme properties\n * - Indexes for efficient querying\n * - Static methods for common operations:\n *   - getActiveTheme: Retrieve the currently active theme\n *   - getThemeByName: Fetch a theme by its name\n *   - storeThemes: Bulk upsert themes with optimized performance\n *   - getAllThemes: Retrieve all themes from the database\n *\n * The model ensures data integrity and provides utility methods for theme management.\n */\n\nimport type { Theme } from '@shared/database/dbInterface';\nimport type { Model } from 'mongoose';\nimport mongoose, { Schema } from 'mongoose';\nimport { nowISODateString, toISOString } from '@shared/utils/dateUtils';\n\n// System Logger\nimport { logger } from '@shared/utils/logger';\n\n// Theme schema\nexport const themeSchema = new Schema<Theme>(\n\t{\n\t\t_id: { type: String, required: true }, // UUID\n\t\tname: { type: String, required: true },\n\t\tpath: { type: String, required: true },\n\t\tisActive: { type: Boolean, default: false },\n\t\tisDefault: { type: Boolean, default: false },\n\t\tconfig: {\n\t\t\ttailwindConfigPath: String,\n\t\t\tassetsPath: String,\n\t\t\tproperties: {\n\t\t\t\ttype: Map,\n\t\t\t\tof: String,\n\t\t\t\tdefault: {}\n\t\t\t}\n\t\t},\n\t\tpreviewImage: String,\n\t\tcreatedAt: { type: String, default: () => nowISODateString() },\n\t\tupdatedAt: { type: String, default: () => nowISODateString() }\n\t},\n\t{\n\t\ttimestamps: true,\n\t\tcollection: 'system_theme',\n\t\tstrict: true,\n\t\t_id: false // Disable Mongoose auto-ObjectId generation\n\t}\n);\n\n// Index\nthemeSchema.index({ isActive: 1 });\nthemeSchema.index({ name: 1 }, { unique: true });\n\n// Static methods\nthemeSchema.statics = {\n\t// Get active theme\n\tasync getActiveTheme(): Promise<Theme | null> {\n\t\ttry {\n\t\t\tconst theme = await this.findOne({ isActive: true }).lean().exec();\n\t\t\tif (theme) {\n\t\t\t\ttheme.createdAt = toISOString(theme.createdAt);\n\t\t\t\ttheme.updatedAt = toISOString(theme.updatedAt);\n\t\t\t}\n\t\t\treturn theme;\n\t\t} catch (error) {\n\t\t\tlogger.error(`Error retrieving active theme: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\tthrow error;\n\t\t}\n\t},\n\n\t// Get theme by name\n\tasync getThemeByName(name: string): Promise<Theme | null> {\n\t\ttry {\n\t\t\tconst theme = await this.findOne({ name }).lean().exec();\n\t\t\tif (theme) {\n\t\t\t\ttheme.createdAt = toISOString(theme.createdAt);\n\t\t\t\ttheme.updatedAt = toISOString(theme.updatedAt);\n\t\t\t}\n\t\t\treturn theme;\n\t\t} catch (error) {\n\t\t\tlogger.error(`Error retrieving theme by name: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\tthrow error;\n\t\t}\n\t},\n\n\t// Store themes (bulk upsert) - Optimized with bulkWrite for atomic operation\n\tasync storeThemes(themes: Omit<Theme, '_id' | 'createdAt' | 'updatedAt'>[], generateId: () => string): Promise<void> {\n\t\tif (themes.length === 0) return;\n\n\t\ttry {\n\t\t\t// Build bulk operations: upsert each theme by name\n\t\t\tconst operations = themes.map((themeData) => ({\n\t\t\t\tupdateOne: {\n\t\t\t\t\tfilter: { name: themeData.name },\n\t\t\t\t\tupdate: {\n\t\t\t\t\t\t$set: themeData,\n\t\t\t\t\t\t$setOnInsert: { _id: generateId() }\n\t\t\t\t\t},\n\t\t\t\t\tupsert: true\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\t// Execute all upserts in a single atomic database call\n\t\t\t// Performance: 10 themes = 1 DB call instead of 20 (10 findOne + 10 updateOne/create)\n\t\t\tconst result = await this.bulkWrite(operations as any, { ordered: false });\n\n\t\t\tlogger.info(`Stored ${themes.length} themes via bulk operation ` + `(${result.upsertedCount} inserted, ${result.modifiedCount} updated)`);\n\t\t} catch (error) {\n\t\t\tlogger.error(`Error storing themes: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\tthrow error;\n\t\t}\n\t},\n\n\t// Get all themes\n\tasync getAllThemes(): Promise<Theme[]> {\n\t\ttry {\n\t\t\tconst themes = await this.find().lean().exec();\n\t\t\treturn themes.map((theme: Theme) => {\n\t\t\t\ttheme.createdAt = toISOString(theme.createdAt);\n\t\t\t\ttheme.updatedAt = toISOString(theme.updatedAt);\n\t\t\t\treturn theme;\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlogger.error(`Error retrieving all themes: ${error instanceof Error ? error.message : String(error)}`);\n\t\t\tthrow error;\n\t\t}\n\t}\n};\n\n// Create and export the Theme model\nexport const ThemeModel = (mongoose.models?.Theme as Model<Theme> | undefined) || mongoose.model<Theme>('Theme', themeSchema);\n","/**\n * @file src/databases/mongodb/models/websiteToken.ts\n * @description Mongoose model for Website Tokens used for external access\n *\n * ### Fields\n * - `_id`: Unique identifier for the token\n * - `name`: Human-readable name for the token\n * - `token`: The actual token string used for authentication\n * - `createdAt`: Timestamp of when the token was created\n * - `updatedAt`: Timestamp of the last update to the token\n * - `createdBy`: User ID of the creator of the token\n */\n\nimport mongoose, { Schema } from 'mongoose';\nimport type { Model } from 'mongoose';\nimport type { WebsiteToken } from '@shared/database/schemas';\nimport { nowISODateString } from '@shared/utils/dateUtils';\nimport { generateId } from '@shared/database/mongodb/methods/mongoDBUtils';\n\nexport const websiteTokenSchema = new Schema<WebsiteToken>(\n\t{\n\t\t_id: { type: String, required: true, default: () => generateId() },\n\t\tname: { type: String, required: true },\n\t\ttoken: { type: String, required: true, unique: true },\n\t\tcreatedAt: { type: String, default: () => nowISODateString() },\n\t\tupdatedAt: { type: String, default: () => nowISODateString() },\n\t\tcreatedBy: { type: String, required: true }\n\t},\n\t{\n\t\ttimestamps: true,\n\t\tcollection: 'system_website_tokens',\n\t\tstrict: true,\n\t\t_id: false\n\t}\n);\n\nwebsiteTokenSchema.index({ createdBy: 1 });\n\nexport const WebsiteTokenModel =\n\t(mongoose.models?.WebsiteToken as Model<WebsiteToken> | undefined) || mongoose.model<WebsiteToken>('WebsiteToken', websiteTokenSchema);\n"],"names":["generateId"],"mappings":"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"}