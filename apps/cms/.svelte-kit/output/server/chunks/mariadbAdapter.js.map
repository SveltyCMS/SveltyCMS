{"version":3,"file":"mariadbAdapter.js","sources":["../../../../../../shared/database/src/mariadb/schema/index.ts","../../../../../../shared/database/src/mariadb/utils.ts","../../../../../../shared/database/src/mariadb/adapter/adapterCore.ts","../../../../../../shared/database/src/mariadb/crud/crudModule.ts","../../../../../../shared/database/src/mariadb/modules/auth/authModule.ts","../../../../../../shared/database/src/mariadb/modules/content/contentModule.ts","../../../../../../shared/database/src/mariadb/modules/media/mediaModule.ts","../../../../../../shared/database/src/mariadb/modules/system/preferencesModule.ts","../../../../../../shared/database/src/mariadb/modules/system/virtualFoldersModule.ts","../../../../../../shared/database/src/mariadb/modules/themes/themesModule.ts","../../../../../../shared/database/src/mariadb/modules/widgets/widgetsModule.ts","../../../../../../shared/database/src/mariadb/modules/website/tokensModule.ts","../../../../../../shared/database/src/mariadb/operations/batchModule.ts","../../../../../../shared/database/src/mariadb/operations/transactionModule.ts","../../../../../../shared/database/src/mariadb/performance/performanceModule.ts","../../../../../../shared/database/src/mariadb/performance/cacheModule.ts","../../../../../../shared/database/src/mariadb/collection/collectionModule.ts","../../../../../../shared/database/src/mariadb/queryBuilder/MariaDBQueryBuilder.ts","../../../../../../shared/database/src/mariadb/adapter/index.ts"],"sourcesContent":["/**\n * @file src/databases/mariadb/schema/index.ts\n * @description Drizzle schema definitions for MariaDB tables\n *\n * This file defines the relational schema for SveltyCMS using Drizzle ORM.\n * All tables include multi-tenant support via nullable tenantId columns.\n * Date fields are stored as DATETIME and converted to ISODateString at boundaries.\n */\n\nimport { mysqlTable, varchar, text, datetime, boolean, int, json, index, unique } from 'drizzle-orm/mysql-core';\nimport { sql } from 'drizzle-orm';\n\n// Helper to create UUID primary key\nconst uuidPk = () => varchar('_id', { length: 36 }).primaryKey();\n\n// Helper for timestamps\nconst timestamps = {\n\tcreatedAt: datetime('createdAt')\n\t\t.notNull()\n\t\t.default(sql`CURRENT_TIMESTAMP`),\n\tupdatedAt: datetime('updatedAt')\n\t\t.notNull()\n\t\t.default(sql`CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP`)\n};\n\n// Helper for tenantId (nullable for multi-tenant support)\nconst tenantField = () => varchar('tenantId', { length: 36 });\n\n// Auth Users Table\nexport const authUsers = mysqlTable(\n\t'auth_users',\n\t{\n\t\t_id: uuidPk(),\n\t\temail: varchar('email', { length: 255 }).notNull(),\n\t\tusername: varchar('username', { length: 255 }),\n\t\tpassword: varchar('password', { length: 255 }),\n\t\temailVerified: boolean('emailVerified').notNull().default(false),\n\t\tblocked: boolean('blocked').notNull().default(false),\n\t\tfirstName: varchar('firstName', { length: 255 }),\n\t\tlastName: varchar('lastName', { length: 255 }),\n\t\tavatar: text('avatar'),\n\t\troleIds: json('roleIds').$type<string[]>().notNull().default([]),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\temailIdx: index('email_idx').on(table.email),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId),\n\t\temailTenantUnique: unique('email_tenant_unique').on(table.email, table.tenantId)\n\t})\n);\n\n// Auth Sessions Table\nexport const authSessions = mysqlTable(\n\t'auth_sessions',\n\t{\n\t\t_id: uuidPk(),\n\t\tuser_id: varchar('user_id', { length: 36 }).notNull(),\n\t\texpires: datetime('expires').notNull(),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tuserIdx: index('user_idx').on(table.user_id),\n\t\texpiresIdx: index('expires_idx').on(table.expires),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Auth Tokens Table\nexport const authTokens = mysqlTable(\n\t'auth_tokens',\n\t{\n\t\t_id: uuidPk(),\n\t\tuser_id: varchar('user_id', { length: 36 }).notNull(),\n\t\temail: varchar('email', { length: 255 }).notNull(),\n\t\ttoken: varchar('token', { length: 255 }).notNull(),\n\t\ttype: varchar('type', { length: 50 }).notNull(),\n\t\texpires: datetime('expires').notNull(),\n\t\tconsumed: boolean('consumed').notNull().default(false),\n\t\tblocked: boolean('blocked').notNull().default(false),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\ttokenIdx: index('token_idx').on(table.token),\n\t\tuserIdx: index('user_idx').on(table.user_id),\n\t\texpiresIdx: index('expires_idx').on(table.expires),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Roles Table\nexport const roles = mysqlTable(\n\t'roles',\n\t{\n\t\t_id: uuidPk(),\n\t\tname: varchar('name', { length: 255 }).notNull(),\n\t\tdescription: text('description'),\n\t\tpermissions: json('permissions').$type<string[]>().notNull().default([]),\n\t\tisAdmin: boolean('isAdmin').notNull().default(false),\n\t\ticon: varchar('icon', { length: 100 }),\n\t\tcolor: varchar('color', { length: 50 }),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tnameIdx: index('name_idx').on(table.name),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Content Nodes Table (Pages/Collections)\nexport const contentNodes = mysqlTable(\n\t'content_nodes',\n\t{\n\t\t_id: uuidPk(),\n\t\tpath: varchar('path', { length: 500 }).notNull(),\n\t\tparentId: varchar('parentId', { length: 36 }),\n\t\ttype: varchar('type', { length: 50 }).notNull(),\n\t\tstatus: varchar('status', { length: 50 }).notNull().default('draft'),\n\t\ttitle: varchar('title', { length: 500 }),\n\t\tslug: varchar('slug', { length: 500 }),\n\t\tdata: json('data'),\n\t\tmetadata: json('metadata'),\n\t\torder: int('order').notNull().default(0),\n\t\tisPublished: boolean('isPublished').notNull().default(false),\n\t\tpublishedAt: datetime('publishedAt'),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tpathIdx: unique('path_unique').on(table.path),\n\t\tparentIdx: index('parent_idx').on(table.parentId),\n\t\ttypeIdx: index('type_idx').on(table.type),\n\t\tstatusIdx: index('status_idx').on(table.status),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Content Drafts Table\nexport const contentDrafts = mysqlTable(\n\t'content_drafts',\n\t{\n\t\t_id: uuidPk(),\n\t\tcontentId: varchar('contentId', { length: 36 }).notNull(),\n\t\tdata: json('data').notNull(),\n\t\tversion: int('version').notNull().default(1),\n\t\tstatus: varchar('status', { length: 50 }).notNull().default('draft'),\n\t\tauthorId: varchar('authorId', { length: 36 }).notNull(),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tcontentIdx: index('content_idx').on(table.contentId),\n\t\tauthorIdx: index('author_idx').on(table.authorId),\n\t\tstatusIdx: index('status_idx').on(table.status),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Content Revisions Table\nexport const contentRevisions = mysqlTable(\n\t'content_revisions',\n\t{\n\t\t_id: uuidPk(),\n\t\tcontentId: varchar('contentId', { length: 36 }).notNull(),\n\t\tdata: json('data').notNull(),\n\t\tversion: int('version').notNull().default(1),\n\t\tcommitMessage: text('commitMessage'),\n\t\tauthorId: varchar('authorId', { length: 36 }).notNull(),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tcontentIdx: index('content_idx').on(table.contentId),\n\t\tversionIdx: index('version_idx').on(table.version),\n\t\tauthorIdx: index('author_idx').on(table.authorId),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Themes Table\nexport const themes = mysqlTable(\n\t'themes',\n\t{\n\t\t_id: uuidPk(),\n\t\tname: varchar('name', { length: 255 }).notNull(),\n\t\tpath: varchar('path', { length: 500 }).notNull(),\n\t\tisActive: boolean('isActive').notNull().default(false),\n\t\tisDefault: boolean('isDefault').notNull().default(false),\n\t\tconfig: json('config').notNull(),\n\t\tpreviewImage: text('previewImage'),\n\t\tcustomCss: text('customCss'),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tnameIdx: index('name_idx').on(table.name),\n\t\tactiveIdx: index('active_idx').on(table.isActive),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Widgets Table\nexport const widgets = mysqlTable(\n\t'widgets',\n\t{\n\t\t_id: uuidPk(),\n\t\tname: varchar('name', { length: 255 }).notNull(),\n\t\tisActive: boolean('isActive').notNull().default(true),\n\t\tinstances: json('instances').notNull().default({}),\n\t\tdependencies: json('dependencies').$type<string[]>().notNull().default([]),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tnameIdx: unique('name_unique').on(table.name),\n\t\tactiveIdx: index('active_idx').on(table.isActive),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Media Items Table\nexport const mediaItems = mysqlTable(\n\t'media_items',\n\t{\n\t\t_id: uuidPk(),\n\t\tfilename: varchar('filename', { length: 500 }).notNull(),\n\t\toriginalFilename: varchar('originalFilename', { length: 500 }).notNull(),\n\t\thash: varchar('hash', { length: 255 }).notNull(),\n\t\tpath: varchar('path', { length: 1000 }).notNull(),\n\t\tsize: int('size').notNull(),\n\t\tmimeType: varchar('mimeType', { length: 255 }).notNull(),\n\t\tfolderId: varchar('folderId', { length: 36 }),\n\t\toriginalId: varchar('originalId', { length: 36 }),\n\t\tthumbnails: json('thumbnails').notNull().default({}),\n\t\tmetadata: json('metadata').notNull().default({}),\n\t\taccess: varchar('access', { length: 50 }).notNull().default('public'),\n\t\tcreatedBy: varchar('createdBy', { length: 36 }).notNull(),\n\t\tupdatedBy: varchar('updatedBy', { length: 36 }).notNull(),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\thashIdx: index('hash_idx').on(table.hash),\n\t\tfolderIdx: index('folder_idx').on(table.folderId),\n\t\tcreatedByIdx: index('created_by_idx').on(table.createdBy),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// System Virtual Folders Table\nexport const systemVirtualFolders = mysqlTable(\n\t'system_virtual_folders',\n\t{\n\t\t_id: uuidPk(),\n\t\tname: varchar('name', { length: 500 }).notNull(),\n\t\tpath: varchar('path', { length: 1000 }).notNull(),\n\t\tparentId: varchar('parentId', { length: 36 }),\n\t\ticon: varchar('icon', { length: 100 }),\n\t\torder: int('order').notNull().default(0),\n\t\ttype: varchar('type', { length: 50 }).notNull().default('folder'),\n\t\tmetadata: json('metadata'),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tpathIdx: unique('path_unique').on(table.path),\n\t\tparentIdx: index('parent_idx').on(table.parentId),\n\t\ttypeIdx: index('type_idx').on(table.type),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// System Preferences Table\nexport const systemPreferences = mysqlTable(\n\t'system_preferences',\n\t{\n\t\t_id: uuidPk(),\n\t\tkey: varchar('key', { length: 255 }).notNull(),\n\t\tvalue: json('value'),\n\t\tscope: varchar('scope', { length: 50 }).notNull().default('system'),\n\t\tuserId: varchar('userId', { length: 36 }),\n\t\tvisibility: varchar('visibility', { length: 50 }).notNull().default('private'),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\tkeyIdx: index('key_idx').on(table.key),\n\t\tscopeIdx: index('scope_idx').on(table.scope),\n\t\tuserIdx: index('user_idx').on(table.userId),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Website Tokens Table\nexport const websiteTokens = mysqlTable(\n\t'website_tokens',\n\t{\n\t\t_id: uuidPk(),\n\t\tname: varchar('name', { length: 255 }).notNull(),\n\t\ttoken: varchar('token', { length: 255 }).notNull(),\n\t\tcreatedBy: varchar('createdBy', { length: 36 }).notNull(),\n\t\ttenantId: tenantField(),\n\t\t...timestamps\n\t},\n\t(table) => ({\n\t\ttokenIdx: unique('token_unique').on(table.token),\n\t\tnameIdx: index('name_idx').on(table.name),\n\t\ttenantIdx: index('tenant_idx').on(table.tenantId)\n\t})\n);\n\n// Export all tables as a schema object for Drizzle\nexport const schema = {\n\tauthUsers,\n\tauthSessions,\n\tauthTokens,\n\troles,\n\tcontentNodes,\n\tcontentDrafts,\n\tcontentRevisions,\n\tthemes,\n\twidgets,\n\tmediaItems,\n\tsystemVirtualFolders,\n\tsystemPreferences,\n\twebsiteTokens\n};\n","/**\n * @file src/databases/mariadb/utils.ts\n * @description Utility functions for MariaDB adapter\n *\n * Features:\n * - Generate a new UUID v4 for database IDs\n * - Validate a DatabaseId (UUID v4)\n * - Convert Date to ISODateString\n * - Convert ISODateString to Date\n * - Create a DatabaseError object\n * - Normalize path by removing leading/trailing slashes and deduplicating slashes\n * - Apply tenant filter to WHERE conditions\n * - Convert MySQL row dates to ISO strings\n * - Convert array of MySQL rows dates to ISO strings\n * - Create a paginated result from an array of items (in-memory)\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport type { DatabaseError, DatabaseId, ISODateString, PaginatedResult, PaginationOptions } from '../dbInterface';\n\n// Generate a new UUID v4 for database IDs\nexport function generateId(): DatabaseId {\n\treturn uuidv4() as DatabaseId;\n}\n\n// Validate a DatabaseId (UUID v4)\nexport function validateId(id: string): boolean {\n\tconst uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n\treturn uuidRegex.test(id);\n}\n\n// Convert Date to ISODateString\nexport function dateToISO(date: Date | null | undefined): ISODateString | undefined {\n\tif (!date) return undefined;\n\treturn date.toISOString() as ISODateString;\n}\n\n// Convert ISODateString to Date\nexport function isoToDate(iso: ISODateString | null | undefined): Date | undefined {\n\tif (!iso) return undefined;\n\treturn new Date(iso);\n}\n\n// Create a DatabaseError object\nexport function createDatabaseError(code: string, message: string, details?: unknown, statusCode?: number): DatabaseError {\n\treturn {\n\t\tcode,\n\t\tmessage,\n\t\tstatusCode,\n\t\tdetails\n\t};\n}\n\n// Normalize path by removing leading/trailing slashes and deduplicating slashes\nexport function normalizePath(path: string): string {\n\treturn path\n\t\t.replace(/^\\/+|\\/+$/g, '') // Remove leading/trailing slashes\n\t\t.replace(/\\/+/g, '/'); // Deduplicate slashes\n}\n\n// Apply tenant filter to WHERE conditions\nexport function applyTenantFilter<T extends Record<string, unknown>>(conditions: T, tenantId?: string): T & { tenantId?: string | null } {\n\tif (tenantId) {\n\t\treturn { ...conditions, tenantId };\n\t}\n\treturn conditions;\n}\n\n/**\n * Convert MySQL row dates to ISO strings\n * This ensures all date fields are properly formatted as ISODateString\n */\nexport function convertDatesToISO<T extends Record<string, unknown>>(row: T): T {\n\tconst result = { ...row };\n\n\tfor (const key in result) {\n\t\tconst value = result[key];\n\t\tif (value instanceof Date) {\n\t\t\t(result as Record<string, unknown>)[key] = value.toISOString() as ISODateString;\n\t\t}\n\t}\n\n\treturn result;\n}\n\n// Convert array of MySQL rows dates to ISO strings\nexport function convertArrayDatesToISO<T extends Record<string, unknown>>(rows: T[]): T[] {\n\treturn rows.map((row) => convertDatesToISO(row));\n}\n\n// Create a paginated result from an array of items (in-memory)\nexport function createPagination<T>(items: T[], options: PaginationOptions): PaginatedResult<T> {\n\tconst page = options.page || 1;\n\tconst pageSize = options.pageSize || 10;\n\tconst offset = (page - 1) * pageSize;\n\tconst total = items.length;\n\tconst paginatedItems = items.slice(offset, offset + pageSize);\n\n\treturn {\n\t\titems: paginatedItems,\n\t\ttotal,\n\t\tpage,\n\t\tpageSize,\n\t\thasNextPage: offset + pageSize < total,\n\t\thasPreviousPage: page > 1\n\t};\n}\n","/**\n * @file src/databases/mariadb/adapter/adapterCore.ts\n * @description Core functionality shared across MariaDB adapter modules.\n *\n * Features:\n * - Connect to MariaDB\n * - Disconnect from MariaDB\n * - Wait for connection\n * - Get connection health\n *\n */\n\nimport { drizzle, type MySql2Database } from 'drizzle-orm/mysql2';\nimport { eq, and } from 'drizzle-orm';\nimport mysql from 'mysql2/promise';\nimport type { DatabaseCapabilities, DatabaseResult, DatabaseError } from '../../dbInterface';\nimport * as schema from '../schema';\nimport * as utils from '../utils';\nimport { logger } from '@shared/utils/logger';\n\nexport class AdapterCore {\n\tpublic capabilities: DatabaseCapabilities = {\n\t\tsupportsTransactions: true,\n\t\tsupportsIndexing: true,\n\t\tsupportsFullTextSearch: true,\n\t\tsupportsAggregation: true,\n\t\tsupportsStreaming: false,\n\t\tsupportsPartitioning: true,\n\t\tmaxBatchSize: 1000,\n\t\tmaxQueryComplexity: 100\n\t};\n\n\tpublic pool: mysql.Pool | null = null;\n\tpublic db: MySql2Database<typeof schema> | null = null;\n\tprotected connected = false;\n\tpublic collectionRegistry = new Map<string, any>();\n\n\tpublic getCapabilities(): DatabaseCapabilities {\n\t\treturn this.capabilities;\n\t}\n\n\tpublic isConnected(): boolean {\n\t\treturn this.connected;\n\t}\n\n\tasync connect(connection: any, _options?: any): Promise<DatabaseResult<void>> {\n\t\ttry {\n\t\t\tif (typeof connection === 'string') {\n\t\t\t\tthis.pool = mysql.createPool(connection);\n\t\t\t} else {\n\t\t\t\tthis.pool = mysql.createPool(connection);\n\t\t\t}\n\t\t\tthis.db = drizzle(this.pool, { schema, mode: 'default' });\n\t\t\tthis.connected = true;\n\t\t\tlogger.info('Connected to MariaDB');\n\t\t\treturn { success: true, data: undefined };\n\t\t} catch (error) {\n\t\t\tthis.connected = false;\n\t\t\treturn this.handleError(error, 'CONNECTION_FAILED');\n\t\t}\n\t}\n\n\tasync disconnect(): Promise<DatabaseResult<void>> {\n\t\tif (this.pool) {\n\t\t\tawait this.pool.end();\n\t\t\tthis.pool = null;\n\t\t\tthis.db = null;\n\t\t\tthis.connected = false;\n\t\t\tlogger.info('Disconnected from MariaDB');\n\t\t}\n\t\treturn { success: true, data: undefined };\n\t}\n\n\tpublic async waitForConnection?(): Promise<void> {\n\t\tif (this.connected) return;\n\t\treturn new Promise((resolve) => {\n\t\t\tconst interval = setInterval(() => {\n\t\t\t\tif (this.connected) {\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t});\n\t}\n\n\tasync getConnectionHealth(): Promise<DatabaseResult<{ healthy: boolean; latency: number; activeConnections: number }>> {\n\t\tif (!this.connected || !this.pool) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage: 'Database not connected',\n\t\t\t\terror: utils.createDatabaseError('NOT_CONNECTED', 'Database not connected')\n\t\t\t};\n\t\t}\n\t\tconst start = Date.now();\n\t\ttry {\n\t\t\tawait this.pool.query('SELECT 1');\n\t\t\tconst latency = Date.now() - start;\n\t\t\tconst poolInfo = (this.pool as any).pool;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: {\n\t\t\t\t\thealthy: true,\n\t\t\t\t\tlatency,\n\t\t\t\t\tactiveConnections: poolInfo ? poolInfo._allConnections.length : 0\n\t\t\t\t}\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn this.handleError(error, 'HEALTH_CHECK_FAILED');\n\t\t}\n\t}\n\n\tprotected wrap<T>(fn: () => Promise<T>, code: string): Promise<DatabaseResult<T>> {\n\t\tif (!this.db) return Promise.resolve(this.notConnectedError());\n\t\ttry {\n\t\t\treturn fn()\n\t\t\t\t.then((data) => ({ success: true, data }) as DatabaseResult<T>)\n\t\t\t\t.catch((error) => this.handleError(error, code));\n\t\t} catch (error) {\n\t\t\treturn Promise.resolve(this.handleError(error, code));\n\t\t}\n\t}\n\n\tprotected handleError(error: unknown, code: string): DatabaseResult<any> {\n\t\tconst message = error instanceof Error ? error.message : String(error);\n\t\tlogger.error(`MariaDB adapter error [${code}]:`, message);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tmessage,\n\t\t\terror: utils.createDatabaseError(code, message, error) as DatabaseError\n\t\t};\n\t}\n\n\tprotected notImplemented(method: string): DatabaseResult<any> {\n\t\tconst message = `Method ${method} not yet implemented for MariaDB adapter.`;\n\t\tlogger.warn(message);\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tmessage,\n\t\t\terror: utils.createDatabaseError('NOT_IMPLEMENTED', message) as DatabaseError\n\t\t};\n\t}\n\n\tprotected notConnectedError(): DatabaseResult<any> {\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t\tmessage: 'Database not connected',\n\t\t\terror: utils.createDatabaseError('NOT_CONNECTED', 'Database connection not established') as DatabaseError\n\t\t};\n\t}\n\n\tpublic getTable(collection: string): any {\n\t\tif ((schema as any)[collection]) {\n\t\t\treturn (schema as any)[collection];\n\t\t}\n\t\t// Fallback to contentNodes for dynamic collections\n\t\treturn schema.contentNodes;\n\t}\n\n\tpublic mapQuery(table: any, query: Record<string, any>): any {\n\t\tif (!query || Object.keys(query).length === 0) return undefined;\n\n\t\tconst conditions: any[] = [];\n\t\tfor (const [key, value] of Object.entries(query)) {\n\t\t\tif (table[key]) {\n\t\t\t\tconditions.push(eq(table[key], value));\n\t\t\t}\n\t\t}\n\n\t\tif (conditions.length === 0) return undefined;\n\t\treturn and(...conditions);\n\t}\n}\n","/**\n * @file src/databases/mariadb/crud/crudModule.ts\n * @description CRUD operations module for MariaDB.\n *\n * Features:\n * - findOne\n * - findMany\n * - findByIds\n * - insert\n * - update\n * - delete\n * - upsert\n * - count\n * - exists\n * - insertMany\n */\n\nimport { eq, inArray, count } from 'drizzle-orm';\nimport type { BaseEntity, DatabaseId, DatabaseResult, QueryFilter } from '../../dbInterface';\nimport { AdapterCore } from '../adapter/adapterCore';\nimport * as utils from '../utils';\n\nexport class CrudModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tasync findOne<T extends BaseEntity>(\n\t\tcollection: string,\n\t\tquery: QueryFilter<T>,\n\t\t_options?: { fields?: (keyof T)[] }\n\t): Promise<DatabaseResult<T | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst where = (this.core as any).mapQuery(table, query);\n\t\t\tconst results = await this.db.select().from(table).where(where).limit(1);\n\t\t\tif (results.length === 0) return null;\n\t\t\treturn utils.convertDatesToISO(results[0]) as T;\n\t\t}, 'CRUD_FIND_ONE_FAILED');\n\t}\n\n\tasync findMany<T extends BaseEntity>(\n\t\tcollection: string,\n\t\tquery: QueryFilter<T>,\n\t\toptions?: { limit?: number; offset?: number; fields?: (keyof T)[] }\n\t): Promise<DatabaseResult<T[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst where = (this.core as any).mapQuery(table, query);\n\t\t\tlet q = this.db.select().from(table).where(where);\n\t\t\tif (options?.limit) q = q.limit(options.limit);\n\t\t\tif (options?.offset) q = q.offset(options.offset);\n\t\t\tconst results = await q;\n\t\t\treturn utils.convertArrayDatesToISO(results) as T[];\n\t\t}, 'CRUD_FIND_MANY_FAILED');\n\t}\n\n\tasync findByIds<T extends BaseEntity>(collection: string, ids: DatabaseId[], _options?: { fields?: (keyof T)[] }): Promise<DatabaseResult<T[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst results = await this.db.select().from(table).where(inArray(table._id, ids));\n\t\t\treturn utils.convertArrayDatesToISO(results) as T[];\n\t\t}, 'CRUD_FIND_BY_IDS_FAILED');\n\t}\n\n\tasync insert<T extends BaseEntity>(collection: string, data: Omit<T, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<T>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst id = utils.generateId();\n\t\t\tconst now = new Date();\n\t\t\tconst values = { ...data, _id: id, createdAt: now, updatedAt: now } as any;\n\t\t\tawait this.db.insert(table).values(values);\n\t\t\tconst result = await this.db.select().from(table).where(eq(table._id, id)).limit(1);\n\t\t\treturn utils.convertDatesToISO(result[0]) as T;\n\t\t}, 'CRUD_INSERT_FAILED');\n\t}\n\n\tasync update<T extends BaseEntity>(\n\t\tcollection: string,\n\t\tid: DatabaseId,\n\t\tdata: Partial<Omit<T, 'createdAt' | 'updatedAt'>>\n\t): Promise<DatabaseResult<T>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst now = new Date();\n\t\t\tawait this.db\n\t\t\t\t.update(table)\n\t\t\t\t.set({ ...data, updatedAt: now } as any)\n\t\t\t\t.where(eq(table._id, id));\n\t\t\tconst result = await this.db.select().from(table).where(eq(table._id, id)).limit(1);\n\t\t\treturn utils.convertDatesToISO(result[0]) as T;\n\t\t}, 'CRUD_UPDATE_FAILED');\n\t}\n\n\tasync delete(collection: string, id: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tawait this.db.delete(table).where(eq(table._id, id));\n\t\t}, 'CRUD_DELETE_FAILED');\n\t}\n\n\tasync upsert<T extends BaseEntity>(\n\t\tcollection: string,\n\t\tquery: QueryFilter<T>,\n\t\tdata: Omit<T, '_id' | 'createdAt' | 'updatedAt'>\n\t): Promise<DatabaseResult<T>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst where = (this.core as any).mapQuery(table, query);\n\t\t\tconst existing = await this.db.select().from(table).where(where).limit(1);\n\t\t\tif (existing.length > 0) {\n\t\t\t\tconst res = await this.update<T>(collection, existing[0]._id, data as any);\n\t\t\t\tif (!res.success) throw res.error;\n\t\t\t\treturn res.data;\n\t\t\t} else {\n\t\t\t\tconst res = await this.insert<T>(collection, data);\n\t\t\t\tif (!res.success) throw res.error;\n\t\t\t\treturn res.data;\n\t\t\t}\n\t\t}, 'CRUD_UPSERT_FAILED');\n\t}\n\n\tasync count<T extends BaseEntity>(collection: string, query: QueryFilter<T> = {}): Promise<DatabaseResult<number>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst where = (this.core as any).mapQuery(table, query);\n\t\t\tconst [result] = await this.db.select({ count: count() }).from(table).where(where);\n\t\t\treturn Number(result.count);\n\t\t}, 'CRUD_COUNT_FAILED');\n\t}\n\n\tasync exists<T extends BaseEntity>(collection: string, query: QueryFilter<T>): Promise<DatabaseResult<boolean>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst res = await this.count(collection, query);\n\t\t\tif (!res.success) throw res.error;\n\t\t\treturn (res.data ?? 0) > 0;\n\t\t}, 'CRUD_EXISTS_FAILED');\n\t}\n\n\tasync insertMany<T extends BaseEntity>(collection: string, data: Omit<T, '_id' | 'createdAt' | 'updatedAt'>[]): Promise<DatabaseResult<T[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tif (data.length === 0) return [];\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst now = new Date();\n\t\t\tconst values = data.map((d) => ({\n\t\t\t\t...d,\n\t\t\t\t_id: utils.generateId(),\n\t\t\t\tcreatedAt: now,\n\t\t\t\tupdatedAt: now\n\t\t\t})) as any[];\n\t\t\tawait this.db.insert(table).values(values);\n\t\t\tconst ids = values.map((v) => v._id);\n\t\t\tconst results = await this.db.select().from(table).where(inArray(table._id, ids));\n\t\t\treturn utils.convertArrayDatesToISO(results) as T[];\n\t\t}, 'CRUD_INSERT_MANY_FAILED');\n\t}\n\n\tasync updateMany<T extends BaseEntity>(\n\t\tcollection: string,\n\t\tquery: QueryFilter<T>,\n\t\tdata: Partial<Omit<T, 'createdAt' | 'updatedAt'>>\n\t): Promise<DatabaseResult<{ modifiedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst where = (this.core as any).mapQuery(table, query);\n\t\t\tconst now = new Date();\n\t\t\tconst result = await this.db\n\t\t\t\t.update(table)\n\t\t\t\t.set({ ...data, updatedAt: now } as any)\n\t\t\t\t.where(where);\n\t\t\treturn { modifiedCount: result[0].affectedRows };\n\t\t}, 'CRUD_UPDATE_MANY_FAILED');\n\t}\n\n\tasync deleteMany(collection: string, query: QueryFilter<BaseEntity>): Promise<DatabaseResult<{ deletedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst where = (this.core as any).mapQuery(table, query);\n\t\t\tconst result = await this.db.delete(table).where(where);\n\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t}, 'CRUD_DELETE_MANY_FAILED');\n\t}\n\n\tasync upsertMany<T extends BaseEntity>(\n\t\tcollection: string,\n\t\titems: Array<{ query: QueryFilter<T>; data: Omit<T, '_id' | 'createdAt' | 'updatedAt'> }>\n\t): Promise<DatabaseResult<{ upsertedCount: number; modifiedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tlet upsertedCount = 0;\n\t\t\tlet modifiedCount = 0;\n\t\t\tfor (const item of items) {\n\t\t\t\tconst existing = await this.findOne(collection, item.query);\n\t\t\t\tif (existing.success && existing.data) {\n\t\t\t\t\tawait this.update(collection, existing.data._id, item.data as any);\n\t\t\t\t\tmodifiedCount++;\n\t\t\t\t} else {\n\t\t\t\t\tawait this.insert(collection, item.data);\n\t\t\t\t\tupsertedCount++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn { upsertedCount, modifiedCount };\n\t\t}, 'CRUD_UPSERT_MANY_FAILED');\n\t}\n\n\tasync aggregate<_T extends BaseEntity, R = any>(_collection: string, _pipeline: any[]): Promise<DatabaseResult<R[]>> {\n\t\treturn (this.core as any).notImplemented('crud.aggregate');\n\t}\n}\n","/**\n * @file src/databases/mariadb/modules/auth/authModule.ts\n * @description Authentication and authorization module for MariaDB\n *\n * Features:\n * - Create user\n * - Update user\n * - Delete user\n * - Get user by id\n * - Get user by email\n * - Get all users\n * - Get user count\n * - Delete users\n */\n\nimport { eq, and, gt, lt, inArray, sql, desc, asc } from 'drizzle-orm';\nimport type { User, Session, Token, Role, DatabaseResult, PaginationOption } from '../../../dbInterface';\nimport type { ISODateString } from '@cms-types/content';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\nimport { logger } from '@shared/utils/logger';\n\nexport class AuthModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tprivate mapUser(dbUser: any): User {\n\t\tif (!dbUser) throw new Error('User not found');\n\t\tconst user = utils.convertDatesToISO(dbUser) as any;\n\n\t\t// Handle roleIds - ensure it is an array\n\t\tlet roleIds = user.roleIds;\n\t\tif (typeof roleIds === 'string') {\n\t\t\ttry {\n\t\t\t\troleIds = JSON.parse(roleIds);\n\t\t\t} catch (e) {\n\t\t\t\t// Fallback if parsing fails\n\t\t\t\troleIds = [];\n\t\t\t}\n\t\t}\n\n\t\tconst finalRoleIds = Array.isArray(roleIds) ? roleIds : [];\n\n\t\treturn {\n\t\t\t...user,\n\t\t\troleIds: finalRoleIds,\n\t\t\trole: finalRoleIds.length > 0 ? finalRoleIds[0] : 'user',\n\t\t\tpermissions: user.permissions || []\n\t\t} as unknown as User;\n\t}\n\n\t// Setup method for model registration\n\tasync setupAuthModels(): Promise<void> {\n\t\t// No-op for SQL - tables created by migrations\n\t\tlogger.debug('Auth models setup (no-op for SQL)');\n\t}\n\n\t// User methods\n\tasync createUser(userData: Partial<User>): Promise<DatabaseResult<User>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst id = userData._id || utils.generateId();\n\t\t\tconst now = new Date();\n\n\t\t\t// Ensure password is hashed if provided and not already hashed\n\t\t\tlet password = userData.password;\n\t\t\tif (password && !password.startsWith('$argon2')) {\n\t\t\t\tconst argon2 = await import('argon2');\n\t\t\t\tpassword = await argon2.hash(password);\n\t\t\t}\n\n\t\t\tconst values = {\n\t\t\t\t...userData,\n\t\t\t\t_id: id,\n\t\t\t\tpassword: password,\n\t\t\t\tcreatedAt: now,\n\t\t\t\tupdatedAt: now,\n\t\t\t\t// Map legacy 'role' string to 'roleIds' array if roleIds is missing/empty\n\t\t\t\troleIds: (userData as any).roleIds?.length ? (userData as any).roleIds : userData.role ? [userData.role] : []\n\t\t\t} as any;\n\t\t\tawait this.db.insert(schema.authUsers).values(values);\n\t\t\tconst [result] = await this.db.select().from(schema.authUsers).where(eq(schema.authUsers._id, id)).limit(1);\n\t\t\treturn this.mapUser(result);\n\t\t}, 'CREATE_USER_FAILED');\n\t}\n\n\tasync updateUserAttributes(user_id: string, userData: Partial<User>, tenantId?: string): Promise<DatabaseResult<User>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authUsers._id, user_id)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authUsers.tenantId, tenantId));\n\n\t\t\tconst dataToUpdate = { ...userData } as any;\n\t\t\t// Map legacy role string to roleIds array if roleIds is missing\n\t\t\tif (userData.role && !dataToUpdate.roleIds) {\n\t\t\t\tdataToUpdate.roleIds = [userData.role];\n\t\t\t}\n\n\t\t\tawait this.db\n\t\t\t\t.update(schema.authUsers)\n\t\t\t\t.set({ ...dataToUpdate, updatedAt: new Date() } as any)\n\t\t\t\t.where(and(...conditions));\n\n\t\t\tconst [result] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authUsers)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\t\t\treturn this.mapUser(result);\n\t\t}, 'UPDATE_USER_FAILED');\n\t}\n\n\tasync deleteUser(user_id: string, tenantId?: string): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authUsers._id, user_id)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authUsers.tenantId, tenantId));\n\t\t\tawait this.db.delete(schema.authUsers).where(and(...conditions));\n\t\t}, 'DELETE_USER_FAILED');\n\t}\n\n\tasync getUserById(user_id: string, tenantId?: string): Promise<DatabaseResult<User | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authUsers._id, user_id)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authUsers.tenantId, tenantId));\n\t\t\tconst [result] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authUsers)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\t\t\treturn result ? this.mapUser(result) : null;\n\t\t}, 'GET_USER_BY_ID_FAILED');\n\t}\n\n\tasync getUserByEmail(criteria: { email: string; tenantId?: string }): Promise<DatabaseResult<User | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authUsers.email, criteria.email)];\n\t\t\tif (criteria.tenantId) conditions.push(eq(schema.authUsers.tenantId, criteria.tenantId));\n\t\t\tconst [result] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authUsers)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\t\t\treturn result ? this.mapUser(result) : null;\n\t\t}, 'GET_USER_BY_EMAIL_FAILED');\n\t}\n\n\tasync getAllUsers(options?: PaginationOption): Promise<DatabaseResult<User[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tlet q: any = this.db.select().from(schema.authUsers);\n\n\t\t\tif (options?.sort) {\n\t\t\t\tif (Array.isArray(options.sort)) {\n\t\t\t\t\tfor (const [field, direction] of options.sort) {\n\t\t\t\t\t\tconst order = direction === 'desc' ? desc : asc;\n\t\t\t\t\t\tif ((schema.authUsers as any)[field]) {\n\t\t\t\t\t\t\tq = q.orderBy(order((schema.authUsers as any)[field]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (const [field, direction] of Object.entries(options.sort)) {\n\t\t\t\t\t\tconst order = direction === 'desc' ? desc : asc;\n\t\t\t\t\t\tif ((schema.authUsers as any)[field]) {\n\t\t\t\t\t\t\tq = q.orderBy(order((schema.authUsers as any)[field]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options?.limit) q = q.limit(options.limit);\n\t\t\tif (options?.offset) q = q.offset(options.offset);\n\n\t\t\tconst results = await q;\n\t\t\treturn results.map((u: any) => this.mapUser(u));\n\t\t}, 'GET_ALL_USERS_FAILED');\n\t}\n\n\tasync getUserCount(filter?: Record<string, unknown>): Promise<DatabaseResult<number>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = schema.authUsers;\n\t\t\t// Pass table schema AND filter to mapQuery\n\t\t\tconst where = filter ? (this.core as any).mapQuery(table, filter) : undefined;\n\n\t\t\tconst query = this.db.select({ count: sql<number>`count(*)` }).from(table);\n\n\t\t\tif (where) {\n\t\t\t\tquery.where(where);\n\t\t\t}\n\n\t\t\tconst [result] = await query;\n\t\t\treturn Number(result.count);\n\t\t}, 'GET_USER_COUNT_FAILED');\n\t}\n\n\tasync deleteUsers(user_ids: string[], tenantId?: string): Promise<DatabaseResult<{ deletedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [inArray(schema.authUsers._id, user_ids)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authUsers.tenantId, tenantId));\n\t\t\tconst result = await this.db.delete(schema.authUsers).where(and(...conditions));\n\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t}, 'DELETE_USERS_FAILED');\n\t}\n\n\tasync blockUsers(user_ids: string[], tenantId?: string): Promise<DatabaseResult<{ modifiedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [inArray(schema.authUsers._id, user_ids)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authUsers.tenantId, tenantId));\n\t\t\tconst result = await this.db\n\t\t\t\t.update(schema.authUsers)\n\t\t\t\t.set({ blocked: true, updatedAt: new Date() })\n\t\t\t\t.where(and(...conditions));\n\t\t\treturn { modifiedCount: result[0].affectedRows };\n\t\t}, 'BLOCK_USERS_FAILED');\n\t}\n\n\tasync unblockUsers(user_ids: string[], tenantId?: string): Promise<DatabaseResult<{ modifiedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [inArray(schema.authUsers._id, user_ids)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authUsers.tenantId, tenantId));\n\t\t\tconst result = await this.db\n\t\t\t\t.update(schema.authUsers)\n\t\t\t\t.set({ blocked: false, updatedAt: new Date() })\n\t\t\t\t.where(and(...conditions));\n\t\t\treturn { modifiedCount: result[0].affectedRows };\n\t\t}, 'UNBLOCK_USERS_FAILED');\n\t}\n\n\t// Combined methods\n\tasync createUserAndSession(\n\t\tuserData: Partial<User>,\n\t\tsessionData: { expires: ISODateString; tenantId?: string }\n\t): Promise<DatabaseResult<{ user: User; session: Session }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst userResult = await this.createUser(userData);\n\t\t\tif (!userResult.success) throw new Error(userResult.message);\n\t\t\tconst user = userResult.data;\n\n\t\t\tconst sessionResult = await this.createSession({\n\t\t\t\tuser_id: user._id,\n\t\t\t\texpires: sessionData.expires,\n\t\t\t\ttenantId: sessionData.tenantId\n\t\t\t});\n\t\t\tif (!sessionResult.success) throw new Error(sessionResult.message);\n\t\t\tconst session = sessionResult.data;\n\t\t\treturn { user, session };\n\t\t}, 'CREATE_USER_AND_SESSION_FAILED');\n\t}\n\n\tasync deleteUserAndSessions(user_id: string, tenantId?: string): Promise<DatabaseResult<{ deletedUser: boolean; deletedSessionCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.invalidateAllUserSessions(user_id, tenantId);\n\t\t\tconst userDeleteResult = await this.deleteUser(user_id, tenantId);\n\n\t\t\treturn {\n\t\t\t\tdeletedUser: userDeleteResult.success,\n\t\t\t\tdeletedSessionCount: 0\n\t\t\t};\n\t\t}, 'DELETE_USER_AND_SESSIONS_FAILED');\n\t}\n\n\t// Session methods\n\tasync createSession(sessionData: { user_id: string; expires: ISODateString; tenantId?: string }): Promise<DatabaseResult<Session>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst id = utils.generateId();\n\t\t\tawait this.db.insert(schema.authSessions).values({\n\t\t\t\t_id: id,\n\t\t\t\tuser_id: sessionData.user_id,\n\t\t\t\texpires: new Date(sessionData.expires),\n\t\t\t\ttenantId: sessionData.tenantId || null\n\t\t\t});\n\t\t\tconst [result] = await this.db.select().from(schema.authSessions).where(eq(schema.authSessions._id, id)).limit(1);\n\t\t\treturn utils.convertDatesToISO(result) as unknown as Session;\n\t\t}, 'CREATE_SESSION_FAILED');\n\t}\n\n\tasync updateSessionExpiry(session_id: string, newExpiry: ISODateString): Promise<DatabaseResult<Session>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db\n\t\t\t\t.update(schema.authSessions)\n\t\t\t\t.set({ expires: new Date(newExpiry), updatedAt: new Date() })\n\t\t\t\t.where(eq(schema.authSessions._id, session_id));\n\t\t\tconst [result] = await this.db.select().from(schema.authSessions).where(eq(schema.authSessions._id, session_id)).limit(1);\n\t\t\treturn utils.convertDatesToISO(result) as unknown as Session;\n\t\t}, 'UPDATE_SESSION_FAILED');\n\t}\n\n\tasync deleteSession(session_id: string): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db.delete(schema.authSessions).where(eq(schema.authSessions._id, session_id));\n\t\t}, 'DELETE_SESSION_FAILED');\n\t}\n\n\tasync deleteExpiredSessions(): Promise<DatabaseResult<number>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst result = await this.db.delete(schema.authSessions).where(lt(schema.authSessions.expires, new Date()));\n\t\t\treturn result[0].affectedRows;\n\t\t}, 'DELETE_EXPIRED_SESSIONS_FAILED');\n\t}\n\n\tasync validateSession(session_id: string): Promise<DatabaseResult<User | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [session] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authSessions)\n\t\t\t\t.where(and(eq(schema.authSessions._id, session_id), gt(schema.authSessions.expires, new Date())))\n\t\t\t\t.limit(1);\n\n\t\t\tif (!session) return null;\n\n\t\t\tconst userResult = await this.getUserById(session.user_id, session.tenantId || undefined);\n\t\t\treturn userResult.success ? userResult.data : null;\n\t\t}, 'VALIDATE_SESSION_FAILED');\n\t}\n\n\tasync invalidateAllUserSessions(user_id: string, tenantId?: string): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authSessions.user_id, user_id)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authSessions.tenantId, tenantId));\n\t\t\tawait this.db.delete(schema.authSessions).where(and(...conditions));\n\t\t}, 'INVALIDATE_USER_SESSIONS_FAILED');\n\t}\n\n\tasync getActiveSessions(user_id: string, tenantId?: string): Promise<DatabaseResult<Session[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authSessions.user_id, user_id), gt(schema.authSessions.expires, new Date())];\n\t\t\tif (tenantId) conditions.push(eq(schema.authSessions.tenantId, tenantId));\n\t\t\tconst results = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authSessions)\n\t\t\t\t.where(and(...conditions));\n\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as Session[];\n\t\t}, 'GET_ACTIVE_SESSIONS_FAILED');\n\t}\n\n\tasync getAllActiveSessions(tenantId?: string): Promise<DatabaseResult<Session[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [gt(schema.authSessions.expires, new Date())];\n\t\t\tif (tenantId) conditions.push(eq(schema.authSessions.tenantId, tenantId));\n\t\t\tconst results = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authSessions)\n\t\t\t\t.where(and(...conditions));\n\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as Session[];\n\t\t}, 'GET_ALL_ACTIVE_SESSIONS_FAILED');\n\t}\n\n\tasync getSessionTokenData(session_id: string): Promise<DatabaseResult<{ expiresAt: ISODateString; user_id: string } | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [session] = await this.db.select().from(schema.authSessions).where(eq(schema.authSessions._id, session_id)).limit(1);\n\t\t\tif (!session) return null;\n\t\t\treturn {\n\t\t\t\texpiresAt: session.expires.toISOString() as unknown as ISODateString,\n\t\t\t\tuser_id: session.user_id\n\t\t\t};\n\t\t}, 'GET_SESSION_TOKEN_DATA_FAILED');\n\t}\n\n\tasync rotateToken(oldToken: string, expires: ISODateString): Promise<DatabaseResult<string>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [oldSession] = await this.db.select().from(schema.authSessions).where(eq(schema.authSessions._id, oldToken)).limit(1);\n\n\t\t\tif (!oldSession) throw new Error('Session not found');\n\n\t\t\tconst newId = utils.generateId();\n\t\t\tconst now = new Date();\n\n\t\t\tawait this.db.insert(schema.authSessions).values({\n\t\t\t\t...oldSession,\n\t\t\t\t_id: newId,\n\t\t\t\texpires: new Date(expires),\n\t\t\t\tcreatedAt: now,\n\t\t\t\tupdatedAt: now\n\t\t\t});\n\n\t\t\tawait this.db.delete(schema.authSessions).where(eq(schema.authSessions._id, oldToken));\n\n\t\t\treturn newId;\n\t\t}, 'ROTATE_TOKEN_FAILED');\n\t}\n\n\tasync cleanupRotatedSessions(): Promise<DatabaseResult<number>> {\n\t\treturn (this.core as any).notImplemented('auth.cleanupRotatedSessions');\n\t}\n\n\t// Token methods\n\tasync createToken(data: {\n\t\tuser_id: string;\n\t\temail: string;\n\t\texpires: ISODateString;\n\t\ttype: string;\n\t\ttenantId?: string;\n\t}): Promise<DatabaseResult<string>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst id = utils.generateId();\n\t\t\tconst tokenValue = utils.generateId(); // Use a UUID as token for now\n\t\t\tawait this.db.insert(schema.authTokens).values({\n\t\t\t\t_id: id,\n\t\t\t\tuser_id: data.user_id,\n\t\t\t\temail: data.email,\n\t\t\t\ttoken: tokenValue,\n\t\t\t\ttype: data.type,\n\t\t\t\texpires: new Date(data.expires),\n\t\t\t\ttenantId: data.tenantId || null,\n\t\t\t\tconsumed: false\n\t\t\t});\n\t\t\treturn tokenValue;\n\t\t}, 'CREATE_TOKEN_FAILED');\n\t}\n\n\tasync updateToken(token_id: string, tokenData: Partial<Token>, tenantId?: string): Promise<DatabaseResult<Token>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authTokens._id, token_id)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authTokens.tenantId, tenantId));\n\t\t\tawait this.db\n\t\t\t\t.update(schema.authTokens)\n\t\t\t\t.set({ ...tokenData, updatedAt: new Date() } as any)\n\t\t\t\t.where(and(...conditions));\n\t\t\tconst [result] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authTokens)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\t\t\treturn utils.convertDatesToISO(result) as unknown as Token;\n\t\t}, 'UPDATE_TOKEN_FAILED');\n\t}\n\n\tasync validateToken(\n\t\ttoken: string,\n\t\tuser_id?: string,\n\t\ttype?: string,\n\t\ttenantId?: string\n\t): Promise<DatabaseResult<{ success: boolean; message: string; email?: string }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authTokens.token, token), gt(schema.authTokens.expires, new Date()), eq(schema.authTokens.consumed, false)];\n\t\t\tif (user_id) conditions.push(eq(schema.authTokens.user_id, user_id));\n\t\t\tif (type) conditions.push(eq(schema.authTokens.type, type));\n\t\t\tif (tenantId) conditions.push(eq(schema.authTokens.tenantId, tenantId));\n\n\t\t\tconst [t] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authTokens)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\n\t\t\tif (!t) return { success: false, message: 'Invalid or expired token' };\n\t\t\treturn { success: true, message: 'Token is valid', email: t.email };\n\t\t}, 'VALIDATE_TOKEN_FAILED');\n\t}\n\n\tasync consumeToken(\n\t\ttoken: string,\n\t\tuser_id?: string,\n\t\ttype?: string,\n\t\ttenantId?: string\n\t): Promise<DatabaseResult<{ status: boolean; message: string }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authTokens.token, token)];\n\t\t\tif (user_id) conditions.push(eq(schema.authTokens.user_id, user_id));\n\t\t\tif (type) conditions.push(eq(schema.authTokens.type, type));\n\t\t\tif (tenantId) conditions.push(eq(schema.authTokens.tenantId, tenantId));\n\n\t\t\tconst result = await this.db\n\t\t\t\t.update(schema.authTokens)\n\t\t\t\t.set({ consumed: true, updatedAt: new Date() })\n\t\t\t\t.where(and(...conditions));\n\n\t\t\treturn { status: result[0].affectedRows > 0, message: result[0].affectedRows > 0 ? 'Token consumed' : 'Token not found or already consumed' };\n\t\t}, 'CONSUME_TOKEN_FAILED');\n\t}\n\n\tasync getTokenData(token: string, user_id?: string, type?: string, tenantId?: string): Promise<DatabaseResult<Token | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.authTokens.token, token)];\n\t\t\tif (user_id) conditions.push(eq(schema.authTokens.user_id, user_id));\n\t\t\tif (type) conditions.push(eq(schema.authTokens.type, type));\n\t\t\tif (tenantId) conditions.push(eq(schema.authTokens.tenantId, tenantId));\n\n\t\t\tconst [t] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.authTokens)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\t\t\treturn t ? (utils.convertDatesToISO(t) as unknown as Token) : null;\n\t\t}, 'GET_TOKEN_DATA_FAILED');\n\t}\n\n\tasync getTokenByValue(token: string, tenantId?: string): Promise<DatabaseResult<Token | null>> {\n\t\treturn this.getTokenData(token, undefined, undefined, tenantId);\n\t}\n\n\tasync getAllTokens(_filter?: Record<string, unknown>): Promise<DatabaseResult<Token[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst results = await this.db.select().from(schema.authTokens);\n\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as Token[];\n\t\t}, 'GET_ALL_TOKENS_FAILED');\n\t}\n\n\tasync deleteExpiredTokens(): Promise<DatabaseResult<number>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst result = await this.db.delete(schema.authTokens).where(lt(schema.authTokens.expires, new Date()));\n\t\t\treturn result[0].affectedRows;\n\t\t}, 'DELETE_EXPIRED_TOKENS_FAILED');\n\t}\n\n\tasync deleteTokens(token_ids: string[], tenantId?: string): Promise<DatabaseResult<{ deletedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [inArray(schema.authTokens._id, token_ids)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authTokens.tenantId, tenantId));\n\t\t\tconst result = await this.db.delete(schema.authTokens).where(and(...conditions));\n\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t}, 'DELETE_TOKENS_FAILED');\n\t}\n\n\tasync blockTokens(token_ids: string[], tenantId?: string): Promise<DatabaseResult<{ modifiedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [inArray(schema.authTokens._id, token_ids)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authTokens.tenantId, tenantId));\n\t\t\tconst result = await this.db\n\t\t\t\t.update(schema.authTokens)\n\t\t\t\t.set({ blocked: true, updatedAt: new Date() })\n\t\t\t\t.where(and(...conditions));\n\t\t\treturn { modifiedCount: result[0].affectedRows };\n\t\t}, 'BLOCK_TOKENS_FAILED');\n\t}\n\n\tasync unblockTokens(token_ids: string[], tenantId?: string): Promise<DatabaseResult<{ modifiedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [inArray(schema.authTokens._id, token_ids)];\n\t\t\tif (tenantId) conditions.push(eq(schema.authTokens.tenantId, tenantId));\n\t\t\tconst result = await this.db\n\t\t\t\t.update(schema.authTokens)\n\t\t\t\t.set({ blocked: false, updatedAt: new Date() })\n\t\t\t\t.where(and(...conditions));\n\t\t\treturn { modifiedCount: result[0].affectedRows };\n\t\t}, 'UNBLOCK_TOKENS_FAILED');\n\t}\n\n\t// Role methods\n\tasync getAllRoles(tenantId?: string): Promise<Role[]> {\n\t\tif (!this.db) return [];\n\t\ttry {\n\t\t\tconst conditions = [];\n\t\t\tif (tenantId) conditions.push(eq(schema.roles.tenantId, tenantId));\n\t\t\tconst results = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.roles)\n\t\t\t\t.where(conditions.length > 0 ? and(...conditions) : undefined);\n\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as Role[];\n\t\t} catch (error) {\n\t\t\tlogger.error('Get all roles failed:', error);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync getRoleById(roleId: string, tenantId?: string): Promise<DatabaseResult<Role | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.roles._id, roleId)];\n\t\t\tif (tenantId) conditions.push(eq(schema.roles.tenantId, tenantId));\n\t\t\tconst [result] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.roles)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\t\t\treturn result ? (utils.convertDatesToISO(result) as unknown as Role) : null;\n\t\t}, 'GET_ROLE_BY_ID_FAILED');\n\t}\n\n\tasync createRole(role: Role): Promise<DatabaseResult<Role>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst id = role._id || utils.generateId();\n\t\t\tawait this.db.insert(schema.roles).values({\n\t\t\t\t...role,\n\t\t\t\t_id: id,\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\tupdatedAt: new Date(),\n\t\t\t\tpermissions: role.permissions || []\n\t\t\t} as any);\n\t\t\tconst [result] = await this.db.select().from(schema.roles).where(eq(schema.roles._id, id)).limit(1);\n\t\t\treturn utils.convertDatesToISO(result) as unknown as Role;\n\t\t}, 'CREATE_ROLE_FAILED');\n\t}\n\n\tasync updateRole(roleId: string, roleData: Partial<Role>, tenantId?: string): Promise<DatabaseResult<Role>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.roles._id, roleId)];\n\t\t\tif (tenantId) conditions.push(eq(schema.roles.tenantId, tenantId));\n\t\t\tawait this.db\n\t\t\t\t.update(schema.roles)\n\t\t\t\t.set({ ...roleData, updatedAt: new Date() } as any)\n\t\t\t\t.where(and(...conditions));\n\t\t\tconst [result] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.roles)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\t\t\treturn utils.convertDatesToISO(result) as unknown as Role;\n\t\t}, 'UPDATE_ROLE_FAILED');\n\t}\n\n\tasync deleteRole(roleId: string, tenantId?: string): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions = [eq(schema.roles._id, roleId)];\n\t\t\tif (tenantId) conditions.push(eq(schema.roles.tenantId, tenantId));\n\t\t\tawait this.db.delete(schema.roles).where(and(...conditions));\n\t\t}, 'DELETE_ROLE_FAILED');\n\t}\n}\n","/**\n * @file src/databases/mariadb/modules/content/contentModule.ts\n * @description Content management module for MariaDB\n *\n * Features:\n * - Get content structure\n * - Upsert content structure node\n * - Create content node\n * - Update content node\n * - Delete content node\n * - Get content node by id\n * - Get content node by path\n * - Get content node by tenant id\n * - Get content node count\n * - Delete content nodes\n */\n\nimport { eq, and, desc, asc, count, inArray } from 'drizzle-orm';\nimport type {\n\tContentNode,\n\tContentDraft,\n\tContentRevision,\n\tDatabaseId,\n\tDatabaseResult,\n\tPaginationOptions,\n\tPaginatedResult\n} from '../../../dbInterface';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\n\nexport class ContentModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tprivate sanitizeNode(node: Partial<ContentNode> & Record<string, any>): Partial<ContentNode> {\n\t\tconst validColumns = [\n\t\t\t'_id',\n\t\t\t'path',\n\t\t\t'parentId',\n\t\t\t'type',\n\t\t\t'status',\n\t\t\t'title',\n\t\t\t'slug',\n\t\t\t'data',\n\t\t\t'metadata',\n\t\t\t'order',\n\t\t\t'isPublished',\n\t\t\t'publishedAt',\n\t\t\t'tenantId',\n\t\t\t'createdAt',\n\t\t\t'updatedAt'\n\t\t];\n\n\t\tconst sanitized: any = {};\n\t\tfor (const key of validColumns) {\n\t\t\tif (node[key] !== undefined) {\n\t\t\t\tsanitized[key] = node[key];\n\t\t\t}\n\t\t}\n\n\t\t// Special handling: if collectionDef exists/is passed, it implies this node represents a collection.\n\t\t// We might want to store essential collection metadata in 'data' or 'metadata' if not already there,\n\t\t// but typically ContentManager relies on files or 'data' field.\n\t\t// ensuring 'data' or 'metadata' is preserved if passed is key.\n\n\t\treturn sanitized;\n\t}\n\n\tnodes = {\n\t\tgetStructure: async (mode: 'flat' | 'nested', filter?: Partial<ContentNode>, _bypassCache?: boolean): Promise<DatabaseResult<ContentNode[]>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tlet q: any = this.db.select().from(schema.contentNodes);\n\n\t\t\t\tif (filter) {\n\t\t\t\t\tconst conditions: any[] = [];\n\t\t\t\t\tif (filter._id) conditions.push(eq(schema.contentNodes._id, filter._id));\n\t\t\t\t\tif (filter.path) conditions.push(eq(schema.contentNodes.path, filter.path));\n\t\t\t\t\tif (filter.parentId) conditions.push(eq(schema.contentNodes.parentId, filter.parentId));\n\t\t\t\t\tif (filter.tenantId) conditions.push(eq(schema.contentNodes.tenantId, filter.tenantId));\n\t\t\t\t\tif (conditions.length > 0) q = q.where(and(...conditions));\n\t\t\t\t}\n\n\t\t\t\tq = q.orderBy(asc(schema.contentNodes.order));\n\n\t\t\t\tconst results = await q;\n\t\t\t\tconst nodes = utils.convertArrayDatesToISO(results) as unknown as ContentNode[];\n\n\t\t\t\tif (mode === 'nested') {\n\t\t\t\t\tconst idMap = new Map<string, ContentNode>();\n\t\t\t\t\tnodes.forEach((n) => idMap.set(n._id, { ...n, children: [] }));\n\t\t\t\t\tconst rootNodes: ContentNode[] = [];\n\t\t\t\t\tidMap.forEach((n) => {\n\t\t\t\t\t\tif (n.parentId && idMap.has(n.parentId)) {\n\t\t\t\t\t\t\tidMap.get(n.parentId)!.children!.push(n);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trootNodes.push(n);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn rootNodes;\n\t\t\t\t}\n\n\t\t\t\treturn nodes;\n\t\t\t}, 'GET_CONTENT_STRUCTURE_FAILED');\n\t\t},\n\n\t\tupsertContentStructureNode: async (node: Omit<ContentNode, 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<ContentNode>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst id = node._id || utils.generateId();\n\t\t\t\tconst sanitized = this.sanitizeNode(node);\n\t\t\t\tconst [existing] = await this.db.select().from(schema.contentNodes).where(eq(schema.contentNodes._id, id)).limit(1);\n\n\t\t\t\tif (existing) {\n\t\t\t\t\tawait this.db\n\t\t\t\t\t\t.update(schema.contentNodes)\n\t\t\t\t\t\t.set({ ...sanitized, updatedAt: new Date() } as any)\n\t\t\t\t\t\t.where(eq(schema.contentNodes._id, id));\n\t\t\t\t} else {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tawait this.db.insert(schema.contentNodes).values({\n\t\t\t\t\t\t...sanitized,\n\t\t\t\t\t\t_id: id,\n\t\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\t\tupdatedAt: now\n\t\t\t\t\t} as any);\n\t\t\t\t}\n\n\t\t\t\tconst [result] = await this.db.select().from(schema.contentNodes).where(eq(schema.contentNodes._id, id)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(result) as unknown as ContentNode;\n\t\t\t}, 'UPSERT_CONTENT_NODE_FAILED');\n\t\t},\n\n\t\tcreate: async (node: Omit<ContentNode, 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<ContentNode>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst id = node._id || utils.generateId();\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst sanitized = this.sanitizeNode(node);\n\t\t\t\tawait this.db.insert(schema.contentNodes).values({\n\t\t\t\t\t...sanitized,\n\t\t\t\t\t_id: id,\n\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\tupdatedAt: now\n\t\t\t\t} as any);\n\t\t\t\tconst [result] = await this.db.select().from(schema.contentNodes).where(eq(schema.contentNodes._id, id)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(result) as unknown as ContentNode;\n\t\t\t}, 'CREATE_CONTENT_NODE_FAILED');\n\t\t},\n\n\t\tcreateMany: async (nodes: Omit<ContentNode, 'createdAt' | 'updatedAt'>[]): Promise<DatabaseResult<ContentNode[]>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst values = nodes.map((node) => {\n\t\t\t\t\tconst sanitized = this.sanitizeNode(node);\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...sanitized,\n\t\t\t\t\t\t_id: node._id || utils.generateId(),\n\t\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\t\tupdatedAt: now\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tawait this.db.insert(schema.contentNodes).values(values as any);\n\t\t\t\tconst ids = values.map((v) => v._id);\n\t\t\t\tconst results = await this.db.select().from(schema.contentNodes).where(inArray(schema.contentNodes._id, ids));\n\t\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as ContentNode[];\n\t\t\t}, 'CREATE_MANY_CONTENT_NODES_FAILED');\n\t\t},\n\n\t\tupdate: async (path: string, changes: Partial<ContentNode>): Promise<DatabaseResult<ContentNode>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst sanitized = this.sanitizeNode(changes);\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.contentNodes)\n\t\t\t\t\t.set({ ...sanitized, updatedAt: new Date() } as any)\n\t\t\t\t\t.where(eq(schema.contentNodes.path, path));\n\t\t\t\tconst [result] = await this.db.select().from(schema.contentNodes).where(eq(schema.contentNodes.path, path)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(result) as unknown as ContentNode;\n\t\t\t}, 'UPDATE_CONTENT_NODE_FAILED');\n\t\t},\n\n\t\tbulkUpdate: async (updates: { path: string; changes: Partial<ContentNode> }[]): Promise<DatabaseResult<ContentNode[]>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst results: ContentNode[] = [];\n\t\t\t\tfor (const update of updates) {\n\t\t\t\t\t// Check if node exists\n\t\t\t\t\tconst [existing] = await this.db.select().from(schema.contentNodes).where(eq(schema.contentNodes.path, update.path)).limit(1);\n\t\t\t\t\tconst sanitized = this.sanitizeNode(update.changes);\n\n\t\t\t\t\tif (existing) {\n\t\t\t\t\t\t// Update existing\n\t\t\t\t\t\tawait this.db\n\t\t\t\t\t\t\t.update(schema.contentNodes)\n\t\t\t\t\t\t\t.set({ ...sanitized, updatedAt: new Date() } as any)\n\t\t\t\t\t\t\t.where(eq(schema.contentNodes.path, update.path));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Insert new (Upsert)\n\t\t\t\t\t\t// Ensure we have an ID\n\t\t\t\t\t\tconst id = (update.changes as any)._id || utils.generateId();\n\t\t\t\t\t\tconst now = new Date();\n\t\t\t\t\t\tawait this.db.insert(schema.contentNodes).values({\n\t\t\t\t\t\t\t...sanitized,\n\t\t\t\t\t\t\t_id: id,\n\t\t\t\t\t\t\tpath: update.path,\n\t\t\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\t\t\tupdatedAt: now\n\t\t\t\t\t\t} as any);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Return updated/inserted record\n\t\t\t\t\tconst [res] = await this.db.select().from(schema.contentNodes).where(eq(schema.contentNodes.path, update.path)).limit(1);\n\t\t\t\t\tif (res) results.push(utils.convertDatesToISO(res) as unknown as ContentNode);\n\t\t\t\t}\n\t\t\t\treturn results;\n\t\t\t}, 'BULK_UPDATE_CONTENT_NODES_FAILED');\n\t\t},\n\n\t\tdelete: async (path: string): Promise<DatabaseResult<void>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tawait this.db.delete(schema.contentNodes).where(eq(schema.contentNodes.path, path));\n\t\t\t}, 'DELETE_CONTENT_NODE_FAILED');\n\t\t},\n\n\t\tdeleteMany: async (paths: string[]): Promise<DatabaseResult<{ deletedCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst result = await this.db.delete(schema.contentNodes).where(inArray(schema.contentNodes.path, paths));\n\t\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t\t}, 'DELETE_MANY_CONTENT_NODES_FAILED');\n\t\t},\n\n\t\treorder: async (nodeUpdates: Array<{ path: string; newOrder: number }>): Promise<DatabaseResult<ContentNode[]>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst results: ContentNode[] = [];\n\t\t\t\tfor (const update of nodeUpdates) {\n\t\t\t\t\tawait this.db.update(schema.contentNodes).set({ order: update.newOrder }).where(eq(schema.contentNodes.path, update.path));\n\t\t\t\t\tconst [res] = await this.db.select().from(schema.contentNodes).where(eq(schema.contentNodes.path, update.path)).limit(1);\n\t\t\t\t\tif (res) results.push(utils.convertDatesToISO(res) as unknown as ContentNode);\n\t\t\t\t}\n\t\t\t\treturn results;\n\t\t\t}, 'REORDER_CONTENT_NODES_FAILED');\n\t\t},\n\n\t\treorderStructure: async (items: Array<{ id: string; parentId: string | null; order: number; path: string }>): Promise<DatabaseResult<void>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tfor (const item of items) {\n\t\t\t\t\tawait this.db\n\t\t\t\t\t\t.update(schema.contentNodes)\n\t\t\t\t\t\t.set({ parentId: item.parentId, order: item.order, path: item.path })\n\t\t\t\t\t\t.where(eq(schema.contentNodes._id, item.id));\n\t\t\t\t}\n\t\t\t}, 'REORDER_CONTENT_STRUCTURE_FAILED');\n\t\t}\n\t};\n\n\tdrafts = {\n\t\tcreate: async (draft: Omit<ContentDraft, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<ContentDraft>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst id = utils.generateId();\n\t\t\t\tconst now = new Date();\n\t\t\t\tawait this.db.insert(schema.contentDrafts).values({\n\t\t\t\t\t...draft,\n\t\t\t\t\t_id: id,\n\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\tupdatedAt: now\n\t\t\t\t} as any);\n\t\t\t\tconst [result] = await this.db.select().from(schema.contentDrafts).where(eq(schema.contentDrafts._id, id)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(result) as unknown as ContentDraft;\n\t\t\t}, 'CREATE_CONTENT_DRAFT_FAILED');\n\t\t},\n\n\t\tcreateMany: async (drafts: Omit<ContentDraft, '_id' | 'createdAt' | 'updatedAt'>[]): Promise<DatabaseResult<ContentDraft[]>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst values = drafts.map((draft) => ({\n\t\t\t\t\t...draft,\n\t\t\t\t\t_id: utils.generateId(),\n\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\tupdatedAt: now\n\t\t\t\t}));\n\t\t\t\tawait this.db.insert(schema.contentDrafts).values(values as any);\n\t\t\t\tconst ids = values.map((v) => v._id);\n\t\t\t\tconst results = await this.db.select().from(schema.contentDrafts).where(inArray(schema.contentDrafts._id, ids));\n\t\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as ContentDraft[];\n\t\t\t}, 'CREATE_MANY_CONTENT_DRAFTS_FAILED');\n\t\t},\n\n\t\tupdate: async (draftId: DatabaseId, data: unknown): Promise<DatabaseResult<ContentDraft>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.contentDrafts)\n\t\t\t\t\t.set({ data: data as any, updatedAt: new Date() })\n\t\t\t\t\t.where(eq(schema.contentDrafts._id, draftId));\n\t\t\t\tconst [result] = await this.db.select().from(schema.contentDrafts).where(eq(schema.contentDrafts._id, draftId)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(result) as unknown as ContentDraft;\n\t\t\t}, 'UPDATE_CONTENT_DRAFT_FAILED');\n\t\t},\n\n\t\tpublish: async (draftId: DatabaseId): Promise<DatabaseResult<void>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst [draft] = await this.db.select().from(schema.contentDrafts).where(eq(schema.contentDrafts._id, draftId)).limit(1);\n\t\t\t\tif (!draft) throw new Error('Draft not found');\n\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.contentNodes)\n\t\t\t\t\t.set({ ...draft.data, updatedAt: new Date(), isPublished: true, publishedAt: new Date() } as any)\n\t\t\t\t\t.where(eq(schema.contentNodes._id, draft.contentId));\n\n\t\t\t\tawait this.db.delete(schema.contentDrafts).where(eq(schema.contentDrafts._id, draftId));\n\t\t\t}, 'PUBLISH_CONTENT_DRAFT_FAILED');\n\t\t},\n\n\t\tpublishMany: async (draftIds: DatabaseId[]): Promise<DatabaseResult<{ publishedCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tlet publishedCount = 0;\n\t\t\t\tfor (const draftId of draftIds) {\n\t\t\t\t\tconst res = await this.drafts.publish(draftId);\n\t\t\t\t\tif (res.success) publishedCount++;\n\t\t\t\t}\n\t\t\t\treturn { publishedCount };\n\t\t\t}, 'PUBLISH_MANY_CONTENT_DRAFTS_FAILED');\n\t\t},\n\n\t\tgetForContent: async (contentId: DatabaseId, options?: PaginationOptions): Promise<DatabaseResult<PaginatedResult<ContentDraft>>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst conditions = [eq(schema.contentDrafts.contentId, contentId)];\n\t\t\t\tlet q: any = this.db\n\t\t\t\t\t.select()\n\t\t\t\t\t.from(schema.contentDrafts)\n\t\t\t\t\t.where(and(...conditions));\n\n\t\t\t\tconst limit = options?.pageSize || 20;\n\t\t\t\tconst offset = ((options?.page || 1) - 1) * limit;\n\n\t\t\t\tq = q.limit(limit).offset(offset).orderBy(desc(schema.contentDrafts.updatedAt));\n\n\t\t\t\tconst results = await q;\n\n\t\t\t\tconst [countResult] = (await this.db\n\t\t\t\t\t.select({ count: count() })\n\t\t\t\t\t.from(schema.contentDrafts)\n\t\t\t\t\t.where(and(...conditions))) as any;\n\n\t\t\t\tconst total = Number(countResult?.count || 0);\n\n\t\t\t\treturn {\n\t\t\t\t\titems: utils.convertArrayDatesToISO(results) as unknown as ContentDraft[],\n\t\t\t\t\ttotal,\n\t\t\t\t\tpage: options?.page || 1,\n\t\t\t\t\tpageSize: limit,\n\t\t\t\t\thasNextPage: offset + limit < total,\n\t\t\t\t\thasPreviousPage: (options?.page || 1) > 1\n\t\t\t\t};\n\t\t\t}, 'GET_CONTENT_DRAFTS_FAILED');\n\t\t},\n\n\t\tdelete: async (draftId: DatabaseId): Promise<DatabaseResult<void>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tawait this.db.delete(schema.contentDrafts).where(eq(schema.contentDrafts._id, draftId));\n\t\t\t}, 'DELETE_CONTENT_DRAFT_FAILED');\n\t\t},\n\n\t\tdeleteMany: async (draftIds: DatabaseId[]): Promise<DatabaseResult<{ deletedCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst result = await this.db.delete(schema.contentDrafts).where(inArray(schema.contentDrafts._id, draftIds));\n\t\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t\t}, 'DELETE_MANY_CONTENT_DRAFTS_FAILED');\n\t\t}\n\t};\n\n\trevisions = {\n\t\tcreate: async (revision: Omit<ContentRevision, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<ContentRevision>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst id = utils.generateId();\n\t\t\t\tconst now = new Date();\n\t\t\t\tawait this.db.insert(schema.contentRevisions).values({\n\t\t\t\t\t...revision,\n\t\t\t\t\t_id: id,\n\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\tupdatedAt: now\n\t\t\t\t} as any);\n\t\t\t\tconst [result] = await this.db.select().from(schema.contentRevisions).where(eq(schema.contentRevisions._id, id)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(result) as unknown as ContentRevision;\n\t\t\t}, 'CREATE_CONTENT_REVISION_FAILED');\n\t\t},\n\n\t\tgetHistory: async (contentId: DatabaseId, options?: PaginationOptions): Promise<DatabaseResult<PaginatedResult<ContentRevision>>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst conditions = [eq(schema.contentRevisions.contentId, contentId)];\n\t\t\t\tlet q: any = this.db\n\t\t\t\t\t.select()\n\t\t\t\t\t.from(schema.contentRevisions)\n\t\t\t\t\t.where(and(...conditions));\n\n\t\t\t\tconst limit = options?.pageSize || 20;\n\t\t\t\tconst offset = ((options?.page || 1) - 1) * limit;\n\n\t\t\t\tq = q.limit(limit).offset(offset).orderBy(desc(schema.contentRevisions.createdAt));\n\n\t\t\t\tconst results = await q;\n\n\t\t\t\tconst [countResult] = (await this.db\n\t\t\t\t\t.select({ count: count() })\n\t\t\t\t\t.from(schema.contentRevisions)\n\t\t\t\t\t.where(and(...conditions))) as any;\n\n\t\t\t\tconst total = Number(countResult?.count || 0);\n\n\t\t\t\treturn {\n\t\t\t\t\titems: utils.convertArrayDatesToISO(results) as unknown as ContentRevision[],\n\t\t\t\t\ttotal,\n\t\t\t\t\tpage: options?.page || 1,\n\t\t\t\t\tpageSize: limit,\n\t\t\t\t\thasNextPage: offset + limit < total,\n\t\t\t\t\thasPreviousPage: (options?.page || 1) > 1\n\t\t\t\t};\n\t\t\t}, 'GET_CONTENT_HISTORY_FAILED');\n\t\t},\n\n\t\trestore: async (revisionId: DatabaseId): Promise<DatabaseResult<void>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst [revision] = await this.db.select().from(schema.contentRevisions).where(eq(schema.contentRevisions._id, revisionId)).limit(1);\n\n\t\t\t\tif (!revision) throw new Error('Revision not found');\n\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.contentNodes)\n\t\t\t\t\t.set({ ...revision.data, updatedAt: new Date() } as any)\n\t\t\t\t\t.where(eq(schema.contentNodes._id, revision.contentId));\n\t\t\t}, 'RESTORE_CONTENT_REVISION_FAILED');\n\t\t},\n\n\t\tdelete: async (revisionId: DatabaseId): Promise<DatabaseResult<void>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tawait this.db.delete(schema.contentRevisions).where(eq(schema.contentRevisions._id, revisionId));\n\t\t\t}, 'DELETE_CONTENT_REVISION_FAILED');\n\t\t},\n\n\t\tdeleteMany: async (revisionIds: DatabaseId[]): Promise<DatabaseResult<{ deletedCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst result = await this.db.delete(schema.contentRevisions).where(inArray(schema.contentRevisions._id, revisionIds));\n\t\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t\t}, 'DELETE_MANY_CONTENT_REVISIONS_FAILED');\n\t\t},\n\n\t\tcleanup: async (contentId: DatabaseId, keepLatest: number): Promise<DatabaseResult<{ deletedCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst revisions = await this.db\n\t\t\t\t\t.select({ _id: schema.contentRevisions._id })\n\t\t\t\t\t.from(schema.contentRevisions)\n\t\t\t\t\t.where(eq(schema.contentRevisions.contentId, contentId))\n\t\t\t\t\t.orderBy(desc(schema.contentRevisions.createdAt))\n\t\t\t\t\t.offset(keepLatest);\n\n\t\t\t\tif (revisions.length === 0) return { deletedCount: 0 };\n\n\t\t\t\tconst idsToDelete = (revisions as any[]).map((r) => r._id);\n\t\t\t\tconst result = await this.db.delete(schema.contentRevisions).where(inArray(schema.contentRevisions._id, idsToDelete));\n\t\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t\t}, 'CLEANUP_CONTENT_REVISIONS_FAILED');\n\t\t}\n\t};\n}\n","/**\n * @file src/databases/mariadb/modules/media/mediaModule.ts\n * @description Media management module for MariaDB\n *\n * Features:\n * - Upload files\n * - Upload multiple files\n * - Delete file\n * - Delete multiple files\n * - Get files by folder\n * - Search files\n * - Get file metadata\n * - Update file metadata\n * - Move files\n * - Get folders\n * - Create folder\n * - Update folder\n * - Delete folder\n */\n\nimport { eq, and, or, like, inArray, count, desc, asc } from 'drizzle-orm';\nimport type { MediaItem, MediaFolder, MediaMetadata, DatabaseId, DatabaseResult, PaginationOptions, PaginatedResult } from '../../../dbInterface';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\nimport { logger } from '@shared/utils/logger';\n\nexport class MediaModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tprivate get crud() {\n\t\treturn (this.core as any).crud;\n\t}\n\n\tasync setupMediaModels(): Promise<void> {\n\t\t// No-op for SQL - tables created by migrations\n\t\tlogger.debug('Media models setup (no-op for SQL)');\n\t}\n\n\tfiles = {\n\t\tupload: async (file: Omit<MediaItem, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<MediaItem>> => {\n\t\t\treturn this.crud.insert('media_items', file as any);\n\t\t},\n\n\t\tuploadMany: async (files: Omit<MediaItem, '_id' | 'createdAt' | 'updatedAt'>[]): Promise<DatabaseResult<MediaItem[]>> => {\n\t\t\treturn this.crud.insertMany('media_items', files as any);\n\t\t},\n\n\t\tdelete: async (fileId: DatabaseId): Promise<DatabaseResult<void>> => {\n\t\t\treturn this.crud.delete('media_items', fileId);\n\t\t},\n\n\t\tdeleteMany: async (fileIds: DatabaseId[]): Promise<DatabaseResult<{ deletedCount: number }>> => {\n\t\t\treturn this.crud.deleteMany('media_items', fileIds);\n\t\t},\n\n\t\tgetByFolder: async (folderId?: DatabaseId, options?: PaginationOptions): Promise<DatabaseResult<PaginatedResult<MediaItem>>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst conditions = folderId ? [eq(schema.mediaItems.folderId, folderId)] : [];\n\n\t\t\t\tlet q: any = this.db.select().from(schema.mediaItems);\n\t\t\t\tif (conditions.length > 0) q = q.where(and(...conditions));\n\n\t\t\t\tif (options?.sortField) {\n\t\t\t\t\tconst order = options.sortDirection === 'desc' ? desc : asc;\n\t\t\t\t\tif ((schema.mediaItems as any)[options.sortField]) {\n\t\t\t\t\t\tq = q.orderBy(order((schema.mediaItems as any)[options.sortField]));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst limit = options?.pageSize || 20;\n\t\t\t\tconst offset = ((options?.page || 1) - 1) * limit;\n\n\t\t\t\tq = q.limit(limit).offset(offset);\n\n\t\t\t\tconst results = await q;\n\n\t\t\t\tconst [countResult] = (await this.db\n\t\t\t\t\t.select({ count: count() })\n\t\t\t\t\t.from(schema.mediaItems)\n\t\t\t\t\t.where(conditions.length > 0 ? and(...conditions) : undefined)) as any;\n\n\t\t\t\tconst total = Number(countResult?.count || 0);\n\n\t\t\t\treturn {\n\t\t\t\t\titems: utils.convertArrayDatesToISO(results) as unknown as MediaItem[],\n\t\t\t\t\ttotal,\n\t\t\t\t\tpage: options?.page || 1,\n\t\t\t\t\tpageSize: limit,\n\t\t\t\t\thasNextPage: offset + limit < total,\n\t\t\t\t\thasPreviousPage: (options?.page || 1) > 1\n\t\t\t\t};\n\t\t\t}, 'GET_FILES_BY_FOLDER_FAILED');\n\t\t},\n\n\t\tsearch: async (query: string, options?: PaginationOptions): Promise<DatabaseResult<PaginatedResult<MediaItem>>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst qry = `%${query}%`;\n\t\t\t\tconst conditions = [or(like(schema.mediaItems.filename, qry), like(schema.mediaItems.originalFilename, qry))];\n\n\t\t\t\tlet q: any = this.db\n\t\t\t\t\t.select()\n\t\t\t\t\t.from(schema.mediaItems)\n\t\t\t\t\t.where(and(...conditions));\n\n\t\t\t\tif (options?.sortField) {\n\t\t\t\t\tconst order = options.sortDirection === 'desc' ? desc : asc;\n\t\t\t\t\tif ((schema.mediaItems as any)[options.sortField]) {\n\t\t\t\t\t\tq = q.orderBy(order((schema.mediaItems as any)[options.sortField]));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst limit = options?.pageSize || 20;\n\t\t\t\tconst offset = ((options?.page || 1) - 1) * limit;\n\n\t\t\t\tq = q.limit(limit).offset(offset);\n\n\t\t\t\tconst results = await q;\n\n\t\t\t\tconst [countResult] = (await this.db\n\t\t\t\t\t.select({ count: count() })\n\t\t\t\t\t.from(schema.mediaItems)\n\t\t\t\t\t.where(and(...conditions))) as any;\n\n\t\t\t\tconst total = Number(countResult?.count || 0);\n\n\t\t\t\treturn {\n\t\t\t\t\titems: utils.convertArrayDatesToISO(results) as unknown as MediaItem[],\n\t\t\t\t\ttotal,\n\t\t\t\t\tpage: options?.page || 1,\n\t\t\t\t\tpageSize: limit,\n\t\t\t\t\thasNextPage: offset + limit < total,\n\t\t\t\t\thasPreviousPage: (options?.page || 1) > 1\n\t\t\t\t};\n\t\t\t}, 'SEARCH_FILES_FAILED');\n\t\t},\n\n\t\tgetMetadata: async (fileIds: DatabaseId[]): Promise<DatabaseResult<Record<string, MediaMetadata>>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst results = await this.db\n\t\t\t\t\t.select({ _id: schema.mediaItems._id, metadata: schema.mediaItems.metadata })\n\t\t\t\t\t.from(schema.mediaItems)\n\t\t\t\t\t.where(inArray(schema.mediaItems._id, fileIds));\n\n\t\t\t\tconst metadataMap: Record<string, MediaMetadata> = {};\n\t\t\t\tresults.forEach((r: any) => {\n\t\t\t\t\tmetadataMap[r._id] = r.metadata as MediaMetadata;\n\t\t\t\t});\n\t\t\t\treturn metadataMap;\n\t\t\t}, 'GET_FILE_METADATA_FAILED');\n\t\t},\n\n\t\tupdateMetadata: async (fileId: DatabaseId, metadata: Partial<MediaMetadata>): Promise<DatabaseResult<MediaItem>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst [existing] = await this.db\n\t\t\t\t\t.select({ metadata: schema.mediaItems.metadata })\n\t\t\t\t\t.from(schema.mediaItems)\n\t\t\t\t\t.where(eq(schema.mediaItems._id, fileId))\n\t\t\t\t\t.limit(1);\n\n\t\t\t\tconst newMetadata = { ...(existing?.metadata || {}), ...metadata };\n\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.mediaItems)\n\t\t\t\t\t.set({ metadata: newMetadata as any, updatedAt: new Date() })\n\t\t\t\t\t.where(eq(schema.mediaItems._id, fileId));\n\n\t\t\t\tconst [updated] = await this.db.select().from(schema.mediaItems).where(eq(schema.mediaItems._id, fileId)).limit(1);\n\n\t\t\t\treturn utils.convertDatesToISO(updated) as unknown as MediaItem;\n\t\t\t}, 'UPDATE_FILE_METADATA_FAILED');\n\t\t},\n\n\t\tmove: async (fileIds: DatabaseId[], targetFolderId?: DatabaseId): Promise<DatabaseResult<{ movedCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst result = await this.db\n\t\t\t\t\t.update(schema.mediaItems)\n\t\t\t\t\t.set({ folderId: targetFolderId || null, updatedAt: new Date() })\n\t\t\t\t\t.where(inArray(schema.mediaItems._id, fileIds));\n\t\t\t\treturn { movedCount: result[0].affectedRows };\n\t\t\t}, 'MOVE_FILES_FAILED');\n\t\t},\n\n\t\tduplicate: async (fileId: DatabaseId, newName?: string): Promise<DatabaseResult<MediaItem>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst [existing] = await this.db.select().from(schema.mediaItems).where(eq(schema.mediaItems._id, fileId)).limit(1);\n\n\t\t\t\tif (!existing) throw new Error('File not found');\n\n\t\t\t\tconst id = utils.generateId();\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst copy = {\n\t\t\t\t\t...existing,\n\t\t\t\t\t_id: id,\n\t\t\t\t\tfilename: newName || `${existing.filename}_copy`,\n\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\tupdatedAt: now\n\t\t\t\t};\n\n\t\t\t\tawait this.db.insert(schema.mediaItems).values(copy as any);\n\n\t\t\t\tconst [created] = await this.db.select().from(schema.mediaItems).where(eq(schema.mediaItems._id, id)).limit(1);\n\n\t\t\t\treturn utils.convertDatesToISO(created) as unknown as MediaItem;\n\t\t\t}, 'DUPLICATE_FILE_FAILED');\n\t\t}\n\t};\n\n\tfolders = {\n\t\tcreate: async (folder: Omit<MediaFolder, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<MediaFolder>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst id = utils.generateId();\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst values = {\n\t\t\t\t\t...folder,\n\t\t\t\t\t_id: id,\n\t\t\t\t\ttype: 'folder',\n\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\tupdatedAt: now\n\t\t\t\t};\n\t\t\t\tawait this.db.insert(schema.systemVirtualFolders).values(values as any);\n\t\t\t\tconst [result] = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders._id, id)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(result) as unknown as MediaFolder;\n\t\t\t}, 'CREATE_MEDIA_FOLDER_FAILED');\n\t\t},\n\n\t\tcreateMany: async (folders: Omit<MediaFolder, '_id' | 'createdAt' | 'updatedAt'>[]): Promise<DatabaseResult<MediaFolder[]>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst values = folders.map((f) => ({\n\t\t\t\t\t...f,\n\t\t\t\t\t_id: utils.generateId(),\n\t\t\t\t\ttype: 'folder',\n\t\t\t\t\tcreatedAt: now,\n\t\t\t\t\tupdatedAt: now\n\t\t\t\t}));\n\t\t\t\tawait this.db.insert(schema.systemVirtualFolders).values(values as any);\n\n\t\t\t\tconst ids = values.map((v) => v._id);\n\t\t\t\tconst results = await this.db.select().from(schema.systemVirtualFolders).where(inArray(schema.systemVirtualFolders._id, ids));\n\n\t\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as MediaFolder[];\n\t\t\t}, 'CREATE_MANY_MEDIA_FOLDERS_FAILED');\n\t\t},\n\n\t\tdelete: async (folderId: DatabaseId): Promise<DatabaseResult<void>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tawait this.db.delete(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders._id, folderId));\n\t\t\t}, 'DELETE_MEDIA_FOLDER_FAILED');\n\t\t},\n\n\t\tdeleteMany: async (folderIds: DatabaseId[]): Promise<DatabaseResult<{ deletedCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst result = await this.db.delete(schema.systemVirtualFolders).where(inArray(schema.systemVirtualFolders._id, folderIds));\n\t\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t\t}, 'DELETE_MANY_MEDIA_FOLDERS_FAILED');\n\t\t},\n\n\t\tgetTree: async (_maxDepth?: number): Promise<DatabaseResult<MediaFolder[]>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst results = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders.type, 'folder'));\n\t\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as MediaFolder[];\n\t\t\t}, 'GET_MEDIA_FOLDER_TREE_FAILED');\n\t\t},\n\n\t\tgetFolderContents: async (\n\t\t\tfolderId?: DatabaseId,\n\t\t\t_options?: PaginationOptions\n\t\t): Promise<DatabaseResult<{ folders: MediaFolder[]; files: MediaItem[]; totalCount: number }>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tconst folderConditions = folderId ? [eq(schema.systemVirtualFolders.parentId, folderId)] : [eq(schema.systemVirtualFolders.parentId, '')];\n\t\t\t\tconst fileConditions = folderId ? [eq(schema.mediaItems.folderId, folderId)] : [];\n\n\t\t\t\tconst folders = await this.db\n\t\t\t\t\t.select()\n\t\t\t\t\t.from(schema.systemVirtualFolders)\n\t\t\t\t\t.where(and(eq(schema.systemVirtualFolders.type, 'folder'), ...folderConditions));\n\n\t\t\t\tconst files = await this.db\n\t\t\t\t\t.select()\n\t\t\t\t\t.from(schema.mediaItems)\n\t\t\t\t\t.where(fileConditions.length > 0 ? and(...fileConditions) : undefined);\n\n\t\t\t\treturn {\n\t\t\t\t\tfolders: utils.convertArrayDatesToISO(folders) as unknown as MediaFolder[],\n\t\t\t\t\tfiles: utils.convertArrayDatesToISO(files) as unknown as MediaItem[],\n\t\t\t\t\ttotalCount: folders.length + files.length\n\t\t\t\t};\n\t\t\t}, 'GET_FOLDER_CONTENTS_FAILED');\n\t\t},\n\n\t\tmove: async (folderId: DatabaseId, targetParentId?: DatabaseId): Promise<DatabaseResult<MediaFolder>> => {\n\t\t\treturn (this.core as any).wrap(async () => {\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.systemVirtualFolders)\n\t\t\t\t\t.set({ parentId: targetParentId || null, updatedAt: new Date() })\n\t\t\t\t\t.where(eq(schema.systemVirtualFolders._id, folderId));\n\n\t\t\t\tconst [updated] = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders._id, folderId)).limit(1);\n\n\t\t\t\treturn utils.convertDatesToISO(updated) as unknown as MediaFolder;\n\t\t\t}, 'MOVE_MEDIA_FOLDER_FAILED');\n\t\t}\n\t};\n}\n","/**\n * @file src/databases/mariadb/modules/system/preferencesModule.ts\n * @description System preferences module for MariaDB\n *\n * Features:\n * - Get preference\n * - Get preferences\n * - Set preference\n * - Set preferences\n * - Delete preference\n * - Delete preferences\n * - Clear preferences\n */\n\nimport { eq, and, inArray } from 'drizzle-orm';\nimport type { DatabaseId, DatabaseResult } from '../../../dbInterface';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\n\nexport class PreferencesModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tasync get<T>(key: string, scope?: 'user' | 'system', userId?: DatabaseId): Promise<DatabaseResult<T>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions: any[] = [eq(schema.systemPreferences.key, key)];\n\t\t\tif (scope) conditions.push(eq(schema.systemPreferences.scope, scope));\n\t\t\tif (userId) conditions.push(eq(schema.systemPreferences.userId, userId));\n\n\t\t\tconst [result] = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.systemPreferences)\n\t\t\t\t.where(and(...conditions))\n\t\t\t\t.limit(1);\n\n\t\t\tif (!result) {\n\t\t\t\treturn { success: false, message: 'Preference not found', error: utils.createDatabaseError('NOT_FOUND', 'Preference not found') };\n\t\t\t}\n\n\t\t\treturn { success: true, data: result.value as T };\n\t\t}, 'GET_PREFERENCE_FAILED');\n\t}\n\n\tasync getMany<T>(keys: string[], scope?: 'user' | 'system', userId?: DatabaseId): Promise<DatabaseResult<Record<string, T>>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions: any[] = [inArray(schema.systemPreferences.key, keys)];\n\t\t\tif (scope) conditions.push(eq(schema.systemPreferences.scope, scope));\n\t\t\tif (userId) conditions.push(eq(schema.systemPreferences.userId, userId));\n\n\t\t\tconst results = await this.db\n\t\t\t\t.select()\n\t\t\t\t.from(schema.systemPreferences)\n\t\t\t\t.where(and(...conditions));\n\n\t\t\tconst prefs: Record<string, T> = {};\n\t\t\tfor (const result of results) {\n\t\t\t\tprefs[result.key] = result.value as T;\n\t\t\t}\n\n\t\t\treturn { success: true, data: prefs };\n\t\t}, 'GET_PREFERENCES_FAILED');\n\t}\n\n\tasync set<T>(key: string, value: T, scope?: 'user' | 'system', userId?: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst exists = await this.db.select().from(schema.systemPreferences).where(eq(schema.systemPreferences.key, key)).limit(1);\n\n\t\t\tif (exists.length > 0) {\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.systemPreferences)\n\t\t\t\t\t.set({ value: value as any, updatedAt: new Date() })\n\t\t\t\t\t.where(eq(schema.systemPreferences.key, key));\n\t\t\t} else {\n\t\t\t\tawait this.db.insert(schema.systemPreferences).values({\n\t\t\t\t\t_id: utils.generateId(),\n\t\t\t\t\tkey,\n\t\t\t\t\tvalue: value as any,\n\t\t\t\t\tscope: scope || 'system',\n\t\t\t\t\tuserId: userId || null,\n\t\t\t\t\tvisibility: 'private',\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\tupdatedAt: new Date()\n\t\t\t\t});\n\t\t\t}\n\t\t}, 'SET_PREFERENCE_FAILED');\n\t}\n\n\tasync setMany<T>(preferences: Array<{ key: string; value: T; scope?: 'user' | 'system'; userId?: DatabaseId }>): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tfor (const pref of preferences) {\n\t\t\t\tconst result = await this.set(pref.key, pref.value, pref.scope, pref.userId);\n\t\t\t\tif (!result.success) {\n\t\t\t\t\tthrow new Error(`Failed to set preference ${pref.key}: ${result.message}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 'SET_PREFERENCES_FAILED');\n\t}\n\n\tasync delete(key: string, scope?: 'user' | 'system', userId?: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions: any[] = [eq(schema.systemPreferences.key, key)];\n\t\t\tif (scope) conditions.push(eq(schema.systemPreferences.scope, scope));\n\t\t\tif (userId) conditions.push(eq(schema.systemPreferences.userId, userId));\n\n\t\t\tawait this.db.delete(schema.systemPreferences).where(and(...conditions));\n\t\t}, 'DELETE_PREFERENCE_FAILED');\n\t}\n\n\tasync deleteMany(keys: string[], scope?: 'user' | 'system', userId?: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions: any[] = [];\n\t\t\tif (keys.length > 0) conditions.push(inArray(schema.systemPreferences.key, keys));\n\t\t\tif (scope) conditions.push(eq(schema.systemPreferences.scope, scope));\n\t\t\tif (userId) conditions.push(eq(schema.systemPreferences.userId, userId));\n\n\t\t\tlet q = this.db.delete(schema.systemPreferences);\n\t\t\tif (conditions.length > 0) {\n\t\t\t\tawait q.where(and(...conditions));\n\t\t\t} else {\n\t\t\t\tawait q;\n\t\t\t}\n\t\t}, 'DELETE_PREFERENCES_FAILED');\n\t}\n\n\tasync clear(scope?: 'user' | 'system', userId?: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst conditions: any[] = [];\n\t\t\tif (scope) conditions.push(eq(schema.systemPreferences.scope, scope));\n\t\t\tif (userId) conditions.push(eq(schema.systemPreferences.userId, userId));\n\n\t\t\tlet q = this.db.delete(schema.systemPreferences);\n\t\t\tif (conditions.length > 0) {\n\t\t\t\tawait q.where(and(...conditions));\n\t\t\t} else {\n\t\t\t\tawait q;\n\t\t\t}\n\t\t}, 'CLEAR_PREFERENCES_FAILED');\n\t}\n}\n","/**\n * @file src/databases/mariadb/modules/system/virtualFoldersModule.ts\n * @description System virtual folders module for MariaDB\n *\n * Features:\n * - Get all virtual folders\n * - Get virtual folder by ID\n * - Get virtual folders by parent ID\n * - Create virtual folder\n * - Update virtual folder\n * - Delete virtual folder\n * - Check if virtual folder exists\n * - Get virtual folder contents\n * - Add to virtual folder\n */\n\nimport { eq, sql } from 'drizzle-orm';\nimport type { SystemVirtualFolder, DatabaseId, DatabaseResult, MediaItem } from '../../../dbInterface';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\n\nexport class VirtualFoldersModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tasync getAll(): Promise<DatabaseResult<SystemVirtualFolder[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst folders = await this.db.select().from(schema.systemVirtualFolders);\n\t\t\treturn utils.convertArrayDatesToISO(folders) as unknown as SystemVirtualFolder[];\n\t\t}, 'GET_VIRTUAL_FOLDERS_FAILED');\n\t}\n\n\tasync getById(folderId: DatabaseId): Promise<DatabaseResult<SystemVirtualFolder | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [folder] = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders._id, folderId)).limit(1);\n\t\t\treturn folder ? (utils.convertDatesToISO(folder) as unknown as SystemVirtualFolder) : null;\n\t\t}, 'GET_VIRTUAL_FOLDER_FAILED');\n\t}\n\n\tasync getByParentId(parentId: DatabaseId | null): Promise<DatabaseResult<SystemVirtualFolder[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst folders = parentId\n\t\t\t\t? await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders.parentId, parentId))\n\t\t\t\t: await this.db\n\t\t\t\t\t\t.select()\n\t\t\t\t\t\t.from(schema.systemVirtualFolders)\n\t\t\t\t\t\t.where(sql`${schema.systemVirtualFolders.parentId} IS NULL`);\n\n\t\t\treturn utils.convertArrayDatesToISO(folders) as unknown as SystemVirtualFolder[];\n\t\t}, 'GET_VIRTUAL_FOLDERS_BY_PARENT_FAILED');\n\t}\n\n\tasync create(folder: Omit<SystemVirtualFolder, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<SystemVirtualFolder>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst id = utils.generateId();\n\t\t\tawait this.db.insert(schema.systemVirtualFolders).values({\n\t\t\t\t_id: id,\n\t\t\t\tname: folder.name,\n\t\t\t\tpath: folder.path,\n\t\t\t\tparentId: folder.parentId || null,\n\t\t\t\ticon: folder.icon || null,\n\t\t\t\torder: folder.order,\n\t\t\t\ttype: folder.type,\n\t\t\t\tmetadata: folder.metadata as any,\n\t\t\t\ttenantId: folder.tenantId || null,\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\tupdatedAt: new Date()\n\t\t\t});\n\n\t\t\tconst [created] = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders._id, id));\n\t\t\treturn utils.convertDatesToISO(created) as unknown as SystemVirtualFolder;\n\t\t}, 'CREATE_VIRTUAL_FOLDER_FAILED');\n\t}\n\n\tasync update(folderId: DatabaseId, updateData: Partial<SystemVirtualFolder>): Promise<DatabaseResult<SystemVirtualFolder>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db\n\t\t\t\t.update(schema.systemVirtualFolders)\n\t\t\t\t.set({ ...updateData, metadata: updateData.metadata as any, updatedAt: new Date() })\n\t\t\t\t.where(eq(schema.systemVirtualFolders._id, folderId));\n\n\t\t\tconst [updated] = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders._id, folderId));\n\t\t\treturn utils.convertDatesToISO(updated) as unknown as SystemVirtualFolder;\n\t\t}, 'UPDATE_VIRTUAL_FOLDER_FAILED');\n\t}\n\n\tasync delete(folderId: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db.delete(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders._id, folderId));\n\t\t}, 'DELETE_VIRTUAL_FOLDER_FAILED');\n\t}\n\n\tasync exists(path: string): Promise<DatabaseResult<boolean>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [folder] = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders.path, path)).limit(1);\n\t\t\treturn !!folder;\n\t\t}, 'CHECK_VIRTUAL_FOLDER_EXISTS_FAILED');\n\t}\n\n\tasync getContents(folderPath: string): Promise<DatabaseResult<{ folders: SystemVirtualFolder[]; files: MediaItem[] }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [folder] = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders.path, folderPath)).limit(1);\n\t\t\tif (!folder) throw new Error('Folder not found');\n\n\t\t\tconst subfolders = await this.db.select().from(schema.systemVirtualFolders).where(eq(schema.systemVirtualFolders.parentId, folder._id));\n\t\t\tconst files = await this.db.select().from(schema.mediaItems).where(eq(schema.mediaItems.folderId, folder._id));\n\n\t\t\treturn {\n\t\t\t\tfolders: utils.convertArrayDatesToISO(subfolders) as unknown as SystemVirtualFolder[],\n\t\t\t\tfiles: utils.convertArrayDatesToISO(files) as unknown as MediaItem[]\n\t\t\t};\n\t\t}, 'GET_VIRTUAL_FOLDER_CONTENTS_FAILED');\n\t}\n\n\tasync addToFolder(_contentId: DatabaseId, _folderPath: string): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).notImplemented('systemVirtualFolder.addToFolder');\n\t}\n}\n","/**\n * @file src/databases/mariadb/modules/themes/themesModule.ts\n * @description Themes management module for MariaDB\n *\n * Features:\n * - Get active theme\n * - Set default theme\n * - Install theme\n * - Uninstall theme\n * - Update theme\n * - Get all themes\n * - Store themes\n * - Get default theme\n */\n\nimport { eq } from 'drizzle-orm';\nimport type { Theme, DatabaseId, DatabaseResult } from '../../../dbInterface';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\nimport { logger } from '@shared/utils/logger';\n\nexport class ThemesModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tasync setupThemeModels(): Promise<void> {\n\t\t// No-op for SQL - tables created by migrations\n\t\tlogger.debug('Theme models setup (no-op for SQL)');\n\t}\n\n\tasync getActive(): Promise<DatabaseResult<Theme>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [theme] = await this.db.select().from(schema.themes).where(eq(schema.themes.isActive, true)).limit(1);\n\n\t\t\tif (!theme) {\n\t\t\t\treturn { success: false, message: 'No active theme found', error: utils.createDatabaseError('NOT_FOUND', 'No active theme') };\n\t\t\t}\n\n\t\t\treturn { success: true, data: utils.convertDatesToISO(theme) as unknown as Theme };\n\t\t}, 'GET_ACTIVE_THEME_FAILED');\n\t}\n\n\tasync setDefault(themeId: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\t// Unset all defaults\n\t\t\tawait this.db.update(schema.themes).set({ isDefault: false });\n\n\t\t\t// Set new default\n\t\t\tawait this.db.update(schema.themes).set({ isDefault: true, isActive: true }).where(eq(schema.themes._id, themeId));\n\t\t}, 'SET_DEFAULT_THEME_FAILED');\n\t}\n\n\tasync install(theme: Omit<Theme, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<Theme>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst id = utils.generateId();\n\t\t\tawait this.db.insert(schema.themes).values({\n\t\t\t\t_id: id,\n\t\t\t\t...theme,\n\t\t\t\tconfig: theme.config as any,\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\tupdatedAt: new Date()\n\t\t\t});\n\n\t\t\tconst [inserted] = await this.db.select().from(schema.themes).where(eq(schema.themes._id, id));\n\t\t\treturn { success: true, data: utils.convertDatesToISO(inserted) as unknown as Theme };\n\t\t}, 'INSTALL_THEME_FAILED');\n\t}\n\n\tasync uninstall(themeId: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db.delete(schema.themes).where(eq(schema.themes._id, themeId));\n\t\t}, 'UNINSTALL_THEME_FAILED');\n\t}\n\n\tasync update(themeId: DatabaseId, theme: Partial<Omit<Theme, '_id' | 'createdAt' | 'updatedAt'>>): Promise<DatabaseResult<Theme>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db\n\t\t\t\t.update(schema.themes)\n\t\t\t\t.set({ ...theme, config: theme.config as any, updatedAt: new Date() })\n\t\t\t\t.where(eq(schema.themes._id, themeId));\n\n\t\t\tconst [updated] = await this.db.select().from(schema.themes).where(eq(schema.themes._id, themeId));\n\t\t\treturn { success: true, data: utils.convertDatesToISO(updated) as unknown as Theme };\n\t\t}, 'UPDATE_THEME_FAILED');\n\t}\n\n\tasync getAllThemes(): Promise<Theme[]> {\n\t\tif (!this.db) return [];\n\t\ttry {\n\t\t\tconst themes = await this.db.select().from(schema.themes);\n\t\t\treturn utils.convertArrayDatesToISO(themes) as unknown as Theme[];\n\t\t} catch (error) {\n\t\t\tlogger.error('Get all themes failed:', error);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync storeThemes(themes: Theme[]): Promise<void> {\n\t\tif (!this.db) throw new Error('Database not connected');\n\t\ttry {\n\t\t\tfor (const theme of themes) {\n\t\t\t\tconst exists = await this.db.select().from(schema.themes).where(eq(schema.themes.name, theme.name)).limit(1);\n\t\t\t\tif (exists.length === 0) {\n\t\t\t\t\tawait this.db.insert(schema.themes).values({\n\t\t\t\t\t\t_id: theme._id || utils.generateId(),\n\t\t\t\t\t\tname: theme.name,\n\t\t\t\t\t\tpath: theme.path,\n\t\t\t\t\t\tisActive: theme.isActive,\n\t\t\t\t\t\tisDefault: theme.isDefault,\n\t\t\t\t\t\tconfig: theme.config as any,\n\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\tupdatedAt: new Date()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error('Store themes failed:', error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tasync getDefaultTheme(_tenantId?: string): Promise<DatabaseResult<Theme | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [theme] = await this.db.select().from(schema.themes).where(eq(schema.themes.isDefault, true)).limit(1);\n\t\t\treturn theme ? (utils.convertDatesToISO(theme) as unknown as Theme) : null;\n\t\t}, 'GET_DEFAULT_THEME_FAILED');\n\t}\n}\n","/**\n * @file src/databases/mariadb/modules/widgets/widgetsModule.ts\n * @description Widgets management module for MariaDB\n *\n * Features:\n * - Register widget\n * - Get all widgets\n * - Get widget by ID\n * - Update widget\n * - Delete widget\n */\n\nimport { eq } from 'drizzle-orm';\nimport type { DatabaseId, DatabaseResult, Widget } from '../../../dbInterface';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\nimport { logger } from '@shared/utils/logger';\n\nexport class WidgetsModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tasync setupWidgetModels(): Promise<void> {\n\t\t// No-op for SQL - tables created by migrations\n\t\tlogger.debug('Widget models setup (no-op for SQL)');\n\t}\n\n\tasync register(widget: Omit<Widget, '_id' | 'createdAt' | 'updatedAt'>): Promise<DatabaseResult<Widget>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst exists = await this.db.select().from(schema.widgets).where(eq(schema.widgets.name, widget.name)).limit(1);\n\n\t\t\tif (exists.length > 0) {\n\t\t\t\tawait this.db\n\t\t\t\t\t.update(schema.widgets)\n\t\t\t\t\t.set({\n\t\t\t\t\t\tisActive: widget.isActive,\n\t\t\t\t\t\tinstances: (widget as any).instances as any,\n\t\t\t\t\t\tdependencies: (widget as any).dependencies,\n\t\t\t\t\t\tupdatedAt: new Date()\n\t\t\t\t\t})\n\t\t\t\t\t.where(eq(schema.widgets.name, widget.name));\n\t\t\t\tconst [updated] = await this.db.select().from(schema.widgets).where(eq(schema.widgets.name, widget.name)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(updated) as unknown as Widget;\n\t\t\t} else {\n\t\t\t\tconst id = utils.generateId();\n\t\t\t\tawait this.db.insert(schema.widgets).values({\n\t\t\t\t\t_id: id,\n\t\t\t\t\tname: widget.name,\n\t\t\t\t\tisActive: widget.isActive,\n\t\t\t\t\tinstances: (widget as any).instances as any,\n\t\t\t\t\tdependencies: (widget as any).dependencies,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\tupdatedAt: new Date()\n\t\t\t\t});\n\t\t\t\tconst [created] = await this.db.select().from(schema.widgets).where(eq(schema.widgets._id, id)).limit(1);\n\t\t\t\treturn utils.convertDatesToISO(created) as unknown as Widget;\n\t\t\t}\n\t\t}, 'REGISTER_WIDGET_FAILED');\n\t}\n\n\tasync findAll(): Promise<DatabaseResult<Widget[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst results = await this.db.select().from(schema.widgets);\n\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as Widget[];\n\t\t}, 'FIND_ALL_WIDGETS_FAILED');\n\t}\n\n\tasync getActiveWidgets(): Promise<DatabaseResult<Widget[]>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst results = await this.db.select().from(schema.widgets).where(eq(schema.widgets.isActive, true));\n\t\t\treturn utils.convertArrayDatesToISO(results) as unknown as Widget[];\n\t\t}, 'GET_ACTIVE_WIDGETS_FAILED');\n\t}\n\n\tasync activate(widgetId: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db.update(schema.widgets).set({ isActive: true, updatedAt: new Date() }).where(eq(schema.widgets._id, widgetId));\n\t\t}, 'ACTIVATE_WIDGET_FAILED');\n\t}\n\n\tasync deactivate(widgetId: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db.update(schema.widgets).set({ isActive: false, updatedAt: new Date() }).where(eq(schema.widgets._id, widgetId));\n\t\t}, 'DEACTIVATE_WIDGET_FAILED');\n\t}\n\n\tasync update(widgetId: DatabaseId, widget: Partial<Omit<Widget, '_id' | 'createdAt' | 'updatedAt'>>): Promise<DatabaseResult<Widget>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db\n\t\t\t\t.update(schema.widgets)\n\t\t\t\t.set({ ...widget, updatedAt: new Date() } as any)\n\t\t\t\t.where(eq(schema.widgets._id, widgetId));\n\t\t\tconst [updated] = await this.db.select().from(schema.widgets).where(eq(schema.widgets._id, widgetId)).limit(1);\n\t\t\treturn utils.convertDatesToISO(updated) as unknown as Widget;\n\t\t}, 'UPDATE_WIDGET_FAILED');\n\t}\n\n\tasync delete(widgetId: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db.delete(schema.widgets).where(eq(schema.widgets._id, widgetId));\n\t\t}, 'DELETE_WIDGET_FAILED');\n\t}\n}\n","/**\n * @file src/databases/mariadb/modules/website/tokensModule.ts\n * @description Website tokens module for MariaDB\n *\n * Features:\n * - Create token\n * - Get all tokens\n * - Get token by ID\n * - Update token\n * - Delete token\n */\n\nimport { eq, desc, asc, sql } from 'drizzle-orm';\nimport type { WebsiteToken, DatabaseId, DatabaseResult } from '../../../dbInterface';\nimport { AdapterCore } from '../../adapter/adapterCore';\nimport * as schema from '../../schema';\nimport * as utils from '../../utils';\n\nexport class WebsiteTokensModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tasync create(token: Omit<WebsiteToken, '_id' | 'createdAt'>): Promise<DatabaseResult<WebsiteToken>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst id = utils.generateId();\n\t\t\tconst now = new Date();\n\t\t\tawait this.db.insert(schema.websiteTokens).values({\n\t\t\t\t...token,\n\t\t\t\t_id: id,\n\t\t\t\tcreatedAt: now,\n\t\t\t\tupdatedAt: now\n\t\t\t} as any);\n\t\t\tconst [result] = await this.db.select().from(schema.websiteTokens).where(eq(schema.websiteTokens._id, id)).limit(1);\n\t\t\treturn utils.convertDatesToISO(result) as unknown as WebsiteToken;\n\t\t}, 'CREATE_WEBSITE_TOKEN_FAILED');\n\t}\n\n\tasync getAll(options: {\n\t\tlimit?: number;\n\t\tskip?: number;\n\t\tsort?: string;\n\t\torder?: string;\n\t}): Promise<DatabaseResult<{ data: WebsiteToken[]; total: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tlet q: any = this.db.select().from(schema.websiteTokens);\n\n\t\t\tif (options.sort) {\n\t\t\t\tconst order = options.order === 'desc' ? desc : asc;\n\t\t\t\tif ((schema.websiteTokens as any)[options.sort]) {\n\t\t\t\t\tq = q.orderBy(order((schema.websiteTokens as any)[options.sort]));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options.limit) q = q.limit(options.limit);\n\t\t\tif (options.skip) q = q.offset(options.skip);\n\n\t\t\tconst results = await q;\n\t\t\t// total count\n\t\t\tconst [countResult] = await this.db.select({ count: sql`count(*)` }).from(schema.websiteTokens);\n\t\t\tconst total = (countResult as any).count;\n\n\t\t\treturn {\n\t\t\t\tdata: utils.convertArrayDatesToISO(results) as unknown as WebsiteToken[],\n\t\t\t\ttotal: Number(total)\n\t\t\t};\n\t\t}, 'GET_WEBSITE_TOKENS_FAILED');\n\t}\n\n\tasync getByName(name: string): Promise<DatabaseResult<WebsiteToken | null>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst [result] = await this.db.select().from(schema.websiteTokens).where(eq(schema.websiteTokens.name, name)).limit(1);\n\t\t\treturn result ? (utils.convertDatesToISO(result) as unknown as WebsiteToken) : null;\n\t\t}, 'GET_WEBSITE_TOKEN_BY_NAME_FAILED');\n\t}\n\n\tasync delete(tokenId: DatabaseId): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tawait this.db.delete(schema.websiteTokens).where(eq(schema.websiteTokens._id, tokenId));\n\t\t}, 'DELETE_WEBSITE_TOKEN_FAILED');\n\t}\n}\n","/**\n * @file src/databases/mariadb/operations/batchModule.ts\n * @description Batch operations module for MariaDB\n *\n * Features:\n * - Execute batch operations\n * - Bulk insert\n * - Bulk update\n * - Bulk delete\n * - Bulk upsert\n */\n\nimport { eq, inArray } from 'drizzle-orm';\nimport type { BaseEntity, DatabaseId, DatabaseResult, DatabaseError, BatchOperation, BatchResult } from '../../dbInterface';\nimport { AdapterCore } from '../adapter/adapterCore';\nimport * as utils from '../utils';\n\nexport class BatchModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tprivate get crud() {\n\t\treturn (this.core as any).crud;\n\t}\n\n\tasync execute<T>(operations: BatchOperation<T>[]): Promise<DatabaseResult<BatchResult<T>>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst results: Array<DatabaseResult<T>> = [];\n\t\t\tlet totalProcessed = 0;\n\t\t\tconst errors: DatabaseError[] = [];\n\n\t\t\tfor (const op of operations) {\n\t\t\t\ttry {\n\t\t\t\t\tlet res: DatabaseResult<any>;\n\t\t\t\t\tswitch (op.operation) {\n\t\t\t\t\t\tcase 'insert':\n\t\t\t\t\t\t\tres = await this.crud.insert(op.collection, op.data as any);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'update':\n\t\t\t\t\t\t\tif (!op.id) throw new Error('ID required for update operation');\n\t\t\t\t\t\t\tres = await this.crud.update(op.collection, op.id, op.data as any);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'delete':\n\t\t\t\t\t\t\tif (!op.id) throw new Error('ID required for delete operation');\n\t\t\t\t\t\t\tres = await this.crud.delete(op.collection, op.id);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'upsert':\n\t\t\t\t\t\t\tif (!op.query || !op.data) throw new Error('Query and data required for upsert operation');\n\t\t\t\t\t\t\tres = await this.crud.upsert(op.collection, op.query as any, op.data as any);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported batch operation: ${op.operation}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tresults.push(res);\n\t\t\t\t\tif (res.success) {\n\t\t\t\t\t\ttotalProcessed++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\terrors.push(res.error!);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconst dbError = utils.createDatabaseError('BATCH_OP_FAILED', error instanceof Error ? error.message : String(error), error);\n\t\t\t\t\tresults.push({ success: false, message: dbError.message, error: dbError });\n\t\t\t\t\terrors.push(dbError);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tsuccess: errors.length === 0,\n\t\t\t\tresults,\n\t\t\t\ttotalProcessed,\n\t\t\t\terrors\n\t\t\t};\n\t\t}, 'BATCH_EXECUTE_FAILED');\n\t}\n\n\tasync bulkInsert<T extends BaseEntity>(collection: string, items: Omit<T, '_id' | 'createdAt' | 'updatedAt'>[]): Promise<DatabaseResult<T[]>> {\n\t\treturn this.crud.insertMany(collection, items);\n\t}\n\n\tasync bulkUpdate<T extends BaseEntity>(\n\t\tcollection: string,\n\t\tupdates: Array<{ id: DatabaseId; data: Partial<T> }>\n\t): Promise<DatabaseResult<{ modifiedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tlet modifiedCount = 0;\n\t\t\tfor (const update of updates) {\n\t\t\t\tconst result = await this.db\n\t\t\t\t\t.update(table)\n\t\t\t\t\t.set({ ...update.data, updatedAt: new Date() } as any)\n\t\t\t\t\t.where(eq(table._id, update.id));\n\t\t\t\tmodifiedCount += result[0].affectedRows;\n\t\t\t}\n\t\t\treturn { modifiedCount };\n\t\t}, 'BULK_UPDATE_FAILED');\n\t}\n\n\tasync bulkDelete(collection: string, ids: DatabaseId[]): Promise<DatabaseResult<{ deletedCount: number }>> {\n\t\treturn (this.core as any).wrap(async () => {\n\t\t\tconst table = (this.core as any).getTable(collection);\n\t\t\tconst result = await this.db.delete(table).where(inArray(table._id, ids));\n\t\t\treturn { deletedCount: result[0].affectedRows };\n\t\t}, 'BULK_DELETE_FAILED');\n\t}\n\n\tasync bulkUpsert<T extends BaseEntity>(collection: string, items: Array<Partial<T> & { id?: DatabaseId }>): Promise<DatabaseResult<T[]>> {\n\t\tconst mappedItems = items.map((item) => ({\n\t\t\tquery: { _id: item.id } as any,\n\t\t\tdata: item as any\n\t\t}));\n\t\treturn this.crud.upsertMany(collection, mappedItems) as any;\n\t}\n}\n","/**\n * @file src/databases/mariadb/operations/transactionModule.ts\n * @description Transaction module for MariaDB\n *\n * Features:\n * - Execute transaction\n */\n\nimport type { DatabaseTransaction, DatabaseResult } from '../../dbInterface';\nimport { AdapterCore } from '../adapter/adapterCore';\nimport * as utils from '../utils';\n\nexport class TransactionModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get db() {\n\t\treturn (this.core as any).db;\n\t}\n\n\tasync execute<T>(\n\t\tfn: (transaction: DatabaseTransaction) => Promise<DatabaseResult<T>>,\n\t\toptions?: { isolationLevel?: 'READ UNCOMMITTED' | 'READ COMMITTED' | 'REPEATABLE READ' | 'SERIALIZABLE' }\n\t): Promise<DatabaseResult<T>> {\n\t\tif (!this.db) return (this.core as any).notConnectedError();\n\n\t\ttry {\n\t\t\treturn await this.db.transaction(async (_tx: any) => {\n\t\t\t\tconst dbTransaction: DatabaseTransaction = {\n\t\t\t\t\tcommit: async () => ({ success: true, data: undefined }),\n\t\t\t\t\trollback: async () => {\n\t\t\t\t\t\tthrow new Error('ROLLBACK_TRANSACTION');\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst result = await fn(dbTransaction);\n\t\t\t\tif (!result.success) throw new Error(result.message || 'Transaction failed');\n\t\t\t\treturn result;\n\t\t\t}, options as any);\n\t\t} catch (error) {\n\t\t\tif ((error as Error).message === 'ROLLBACK_TRANSACTION') {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: 'Transaction rolled back',\n\t\t\t\t\terror: utils.createDatabaseError('TRANSACTION_ROLLED_BACK', 'Transaction rolled back')\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn (this.core as any).handleError(error, 'TRANSACTION_FAILED');\n\t\t}\n\t}\n}\n","/**\n * @file src/databases/mariadb/performance/performanceModule.ts\n * @description Performance metrics module for MariaDB\n *\n * Features:\n * - Get metrics\n * - Clear metrics\n * - Enable profiling\n * - Get slow queries\n */\n\nimport type { PerformanceMetrics, DatabaseResult } from '../../dbInterface';\nimport { AdapterCore } from '../adapter/adapterCore';\n\nexport class PerformanceModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tasync getMetrics(_tags?: string[]): Promise<DatabaseResult<PerformanceMetrics>> {\n\t\treturn (this.core as any).notImplemented('performance.getMetrics');\n\t}\n\n\tasync clearMetrics(_tags?: string[]): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).notImplemented('performance.clearMetrics');\n\t}\n\n\tasync enableProfiling(_enabled: boolean): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).notImplemented('performance.enableProfiling');\n\t}\n\n\tasync getSlowQueries(_limit?: number): Promise<DatabaseResult<any[]>> {\n\t\treturn (this.core as any).notImplemented('performance.getSlowQueries');\n\t}\n}\n","/**\n * @file src/databases/mariadb/performance/cacheModule.ts\n * @description Cache module for MariaDB\n *\n * Features:\n * - Get cache\n * - Set cache\n * - Delete cache\n * - Clear cache\n * - Invalidate collection\n */\n\nimport type { CacheOptions, DatabaseResult } from '../../dbInterface';\nimport { AdapterCore } from '../adapter/adapterCore';\n\nexport class CacheModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tasync get<T>(_key: string): Promise<DatabaseResult<T | null>> {\n\t\treturn (this.core as any).notImplemented('cache.get');\n\t}\n\n\tasync set<T>(_key: string, _value: T, _options?: CacheOptions): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).notImplemented('cache.set');\n\t}\n\n\tasync delete(_key: string): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).notImplemented('cache.delete');\n\t}\n\n\tasync clear(_tags?: string[]): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).notImplemented('cache.clear');\n\t}\n\n\tasync invalidateCollection(_collection: string): Promise<DatabaseResult<void>> {\n\t\treturn (this.core as any).notImplemented('cache.invalidateCollection');\n\t}\n}\n","/**\n * @file src/databases/mariadb/collection/collectionModule.ts\n * @description Dynamic collection management module for MariaDB\n *\n * Features:\n * - Create collection\n * - Update collection\n * - Delete collection\n */\n\nimport type { CollectionModel } from '../../dbInterface';\nimport type { Schema } from '@cms-types/content';\nimport { AdapterCore } from '../adapter/adapterCore';\n\nexport class CollectionModule {\n\tprivate core: AdapterCore;\n\n\tconstructor(core: AdapterCore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate get crud() {\n\t\treturn (this.core as any).crud;\n\t}\n\n\tprivate get collectionRegistry() {\n\t\treturn (this.core as any).collectionRegistry;\n\t}\n\n\tasync getModel(id: string): Promise<CollectionModel> {\n\t\tconst model = this.collectionRegistry.get(id);\n\t\tif (model) return model;\n\n\t\treturn {\n\t\t\tfindOne: async (query) => {\n\t\t\t\tconst res = await this.crud.findOne(id, query as any);\n\t\t\t\treturn res.success ? (res.data as any) : null;\n\t\t\t},\n\t\t\taggregate: async (pipeline) => {\n\t\t\t\tconst res = await this.crud.aggregate(id, pipeline);\n\t\t\t\treturn res.success ? (res.data as any[]) : [];\n\t\t\t}\n\t\t};\n\t}\n\n\tasync createModel(schemaData: Schema): Promise<void> {\n\t\tconst id = schemaData._id;\n\t\tif (!id) throw new Error('Schema must have an _id');\n\n\t\tconst wrappedModel: CollectionModel = {\n\t\t\tfindOne: async (query) => {\n\t\t\t\tconst res = await this.crud.findOne(id, query as any);\n\t\t\t\treturn res.success ? (res.data as any) : null;\n\t\t\t},\n\t\t\taggregate: async (pipeline) => {\n\t\t\t\tconst res = await this.crud.aggregate(id, pipeline);\n\t\t\t\treturn res.success ? (res.data as any[]) : [];\n\t\t\t}\n\t\t};\n\t\tthis.collectionRegistry.set(id, wrappedModel);\n\t}\n\n\tasync updateModel(schemaData: Schema): Promise<void> {\n\t\tawait this.createModel(schemaData);\n\t}\n\n\tasync deleteModel(id: string): Promise<void> {\n\t\tthis.collectionRegistry.delete(id);\n\t}\n}\n","/**\n * @file src/databases/mariadb/queryBuilder/MariaDBQueryBuilder.ts\n * @description MariaDB implementation of the QueryBuilder interface using Drizzle ORM\n *\n * Features:\n * - Where conditions\n * - In conditions\n * - Not in conditions\n * - Between conditions\n * - Null conditions\n * - Not null conditions\n * - Search conditions\n * - Limit\n * - Skip\n * - Pagination\n * - Sort\n * - Select\n * - Exclude\n * - Distinct\n * - Group by\n * - Hint\n * - Timeout\n */\n\nimport { eq, and, inArray, sql, or, desc, asc, count, lte, gte, like, notInArray } from 'drizzle-orm';\nimport type { BaseEntity, DatabaseResult, PaginationOptions, QueryBuilder, QueryOptimizationHints } from '../../dbInterface';\nimport type { MariaDBAdapter } from '../adapter';\nimport * as utils from '../utils';\nimport { logger } from '@shared/utils/logger';\n\nexport class MariaDBQueryBuilder<T extends BaseEntity> implements QueryBuilder<T> {\n\tprivate adapter: MariaDBAdapter;\n\tprivate collection: string;\n\tprivate conditions: any[] = [];\n\tprivate sortOptions: Array<{ field: keyof T; direction: 'asc' | 'desc' }> = [];\n\tprivate limitValue?: number;\n\tprivate skipValue?: number;\n\tprivate selectedFields?: (keyof T)[];\n\n\tconstructor(adapter: MariaDBAdapter, collection: string) {\n\t\tthis.adapter = adapter;\n\t\tthis.collection = collection;\n\t}\n\n\tprivate get table() {\n\t\treturn (this.adapter as any).getTable(this.collection);\n\t}\n\n\tprivate get db() {\n\t\treturn (this.adapter as any).db;\n\t}\n\n\twhere(conditions: Partial<T> | ((item: T) => boolean)): this {\n\t\tif (typeof conditions === 'function') {\n\t\t\tlogger.warn('Function-based where conditions are not supported in MariaDBQueryBuilder');\n\t\t\treturn this;\n\t\t}\n\n\t\tfor (const [key, value] of Object.entries(conditions)) {\n\t\t\tif (this.table[key]) {\n\t\t\t\tthis.conditions.push(eq(this.table[key], value));\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\twhereIn<K extends keyof T>(field: K, values: T[K][]): this {\n\t\tif (this.table[field as string]) {\n\t\t\tthis.conditions.push(inArray(this.table[field as string], values));\n\t\t}\n\t\treturn this;\n\t}\n\n\twhereNotIn<K extends keyof T>(field: K, values: T[K][]): this {\n\t\tif (this.table[field as string]) {\n\t\t\tthis.conditions.push(notInArray(this.table[field as string], values));\n\t\t}\n\t\treturn this;\n\t}\n\n\twhereBetween<K extends keyof T>(field: K, min: T[K], max: T[K]): this {\n\t\tif (this.table[field as string]) {\n\t\t\tthis.conditions.push(and(gte(this.table[field as string], min), lte(this.table[field as string], max)));\n\t\t}\n\t\treturn this;\n\t}\n\n\twhereNull<K extends keyof T>(field: K): this {\n\t\tif (this.table[field as string]) {\n\t\t\tthis.conditions.push(sql`${this.table[field as string]} IS NULL`);\n\t\t}\n\t\treturn this;\n\t}\n\n\twhereNotNull<K extends keyof T>(field: K): this {\n\t\tif (this.table[field as string]) {\n\t\t\tthis.conditions.push(sql`${this.table[field as string]} IS NOT NULL`);\n\t\t}\n\t\treturn this;\n\t}\n\n\tsearch(query: string, fields?: (keyof T)[]): this {\n\t\tif (fields && fields.length > 0) {\n\t\t\tconst searchConditions = fields\n\t\t\t\t.map((f) => {\n\t\t\t\t\tif (this.table[f as string]) {\n\t\t\t\t\t\treturn like(this.table[f as string], `%${query}%`);\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t})\n\t\t\t\t.filter(Boolean);\n\n\t\t\tif (searchConditions.length > 0) {\n\t\t\t\tthis.conditions.push(or(...(searchConditions as any[])));\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tlimit(value: number): this {\n\t\tthis.limitValue = value;\n\t\treturn this;\n\t}\n\n\tskip(value: number): this {\n\t\tthis.skipValue = value;\n\t\treturn this;\n\t}\n\n\tpaginate(options: PaginationOptions): this {\n\t\tif (options.page && options.pageSize) {\n\t\t\tthis.skipValue = (options.page - 1) * options.pageSize;\n\t\t\tthis.limitValue = options.pageSize;\n\t\t}\n\t\tif (options.sortField && options.sortDirection) {\n\t\t\tthis.sort(options.sortField as keyof T, options.sortDirection);\n\t\t}\n\t\treturn this;\n\t}\n\n\tsort<K extends keyof T>(field: K, direction: 'asc' | 'desc'): this {\n\t\tthis.sortOptions.push({ field, direction });\n\t\treturn this;\n\t}\n\n\torderBy<K extends keyof T>(sorts: Array<{ field: K; direction: 'asc' | 'desc' }>): this {\n\t\tthis.sortOptions = [...this.sortOptions, ...sorts];\n\t\treturn this;\n\t}\n\n\tselect<K extends keyof T>(fields: K[]): this {\n\t\tthis.selectedFields = fields;\n\t\treturn this;\n\t}\n\n\texclude<K extends keyof T>(_fields: K[]): this {\n\t\treturn this;\n\t}\n\n\tdistinct<K extends keyof T>(_field?: K): this {\n\t\treturn this;\n\t}\n\n\tgroupBy<K extends keyof T>(_field: K): this {\n\t\treturn this;\n\t}\n\n\thint(_hints: QueryOptimizationHints): this {\n\t\treturn this;\n\t}\n\n\ttimeout(_milliseconds: number): this {\n\t\treturn this;\n\t}\n\n\tprivate buildQuery() {\n\t\tif (!this.db) throw new Error('Database not connected');\n\n\t\tlet q: any;\n\t\tif (this.selectedFields) {\n\t\t\tconst projection: any = {};\n\t\t\tthis.selectedFields.forEach((f) => {\n\t\t\t\tif (this.table[f as string]) projection[f as string] = this.table[f as string];\n\t\t\t});\n\t\t\tq = this.db.select(projection).from(this.table);\n\t\t} else {\n\t\t\tq = this.db.select().from(this.table);\n\t\t}\n\n\t\tif (this.conditions.length > 0) {\n\t\t\tq = q.where(and(...this.conditions));\n\t\t}\n\n\t\tif (this.sortOptions.length > 0) {\n\t\t\tconst orderBys = this.sortOptions.map((s) => {\n\t\t\t\tconst order = s.direction === 'desc' ? desc : asc;\n\t\t\t\treturn order(this.table[s.field as string]);\n\t\t\t});\n\t\t\tq = q.orderBy(...orderBys);\n\t\t}\n\n\t\tif (this.limitValue !== undefined) q = q.limit(this.limitValue);\n\t\tif (this.skipValue !== undefined) q = q.offset(this.skipValue);\n\n\t\treturn q;\n\t}\n\n\tasync count(): Promise<DatabaseResult<number>> {\n\t\tconst startTime = Date.now();\n\t\ttry {\n\t\t\tconst table = this.table;\n\t\t\tlet q = this.db.select({ count: count() }).from(table);\n\t\t\tif (this.conditions.length > 0) {\n\t\t\t\tq = q.where(and(...this.conditions));\n\t\t\t}\n\t\t\tconst [result] = await q;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: Number(result.count),\n\t\t\t\tmeta: { executionTime: Date.now() - startTime }\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn (this.adapter as any).handleError(error, 'QUERY_BUILDER_COUNT_FAILED');\n\t\t}\n\t}\n\n\tasync exists(): Promise<DatabaseResult<boolean>> {\n\t\tconst res = await this.count();\n\t\tif (res.success) return { ...res, data: res.data > 0 };\n\t\treturn res as any;\n\t}\n\n\tasync execute(): Promise<DatabaseResult<T[]>> {\n\t\tconst startTime = Date.now();\n\t\ttry {\n\t\t\tconst q = this.buildQuery();\n\t\t\tconst results = await q;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: utils.convertArrayDatesToISO(results) as unknown as T[],\n\t\t\t\tmeta: { executionTime: Date.now() - startTime }\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn (this.adapter as any).handleError(error, 'QUERY_BUILDER_EXECUTE_FAILED');\n\t\t}\n\t}\n\n\tasync stream(): Promise<DatabaseResult<AsyncIterable<T>>> {\n\t\treturn (this.adapter as any).notImplemented('queryBuilder.stream');\n\t}\n\n\tasync findOne(): Promise<DatabaseResult<T | null>> {\n\t\tconst startTime = Date.now();\n\t\ttry {\n\t\t\tconst q = this.buildQuery().limit(1);\n\t\t\tconst [result] = await q;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: result ? (utils.convertDatesToISO(result) as unknown as T) : null,\n\t\t\t\tmeta: { executionTime: Date.now() - startTime }\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn (this.adapter as any).handleError(error, 'QUERY_BUILDER_FIND_ONE_FAILED');\n\t\t}\n\t}\n\n\tasync findOneOrFail(): Promise<DatabaseResult<T>> {\n\t\tconst res = await this.findOne();\n\t\tif (res.success && !res.data) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage: 'Document not found',\n\t\t\t\terror: utils.createDatabaseError('NOT_FOUND', 'Document not found')\n\t\t\t};\n\t\t}\n\t\treturn res as DatabaseResult<T>;\n\t}\n\n\tasync updateMany(data: Partial<T>): Promise<DatabaseResult<{ modifiedCount: number }>> {\n\t\tconst startTime = Date.now();\n\t\ttry {\n\t\t\tlet q = this.db.update(this.table).set({ ...data, updatedAt: new Date() } as any);\n\t\t\tif (this.conditions.length > 0) {\n\t\t\t\tq = q.where(and(...this.conditions));\n\t\t\t}\n\t\t\tconst result = await q;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: { modifiedCount: result[0].affectedRows },\n\t\t\t\tmeta: { executionTime: Date.now() - startTime }\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn (this.adapter as any).handleError(error, 'QUERY_BUILDER_UPDATE_MANY_FAILED');\n\t\t}\n\t}\n\n\tasync deleteMany(): Promise<DatabaseResult<{ deletedCount: number }>> {\n\t\tconst startTime = Date.now();\n\t\ttry {\n\t\t\tlet q = this.db.delete(this.table);\n\t\t\tif (this.conditions.length > 0) {\n\t\t\t\tq = q.where(and(...this.conditions));\n\t\t\t}\n\t\t\tconst result = await q;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: { deletedCount: result[0].affectedRows },\n\t\t\t\tmeta: { executionTime: Date.now() - startTime }\n\t\t\t};\n\t\t} catch (error) {\n\t\t\treturn (this.adapter as any).handleError(error, 'QUERY_BUILDER_DELETE_MANY_FAILED');\n\t\t}\n\t}\n}\n","/**\n * @file src/databases/mariadb/adapter/index.ts\n * @description Main MariaDB adapter class that composes feature modules and entry point.\n *\n * Features:\n * - CRUD operations\n * - Authentication\n * - Content management\n * - Media management\n * - System preferences\n * - Virtual folders\n * - Themes\n * - Widgets\n * - Website tokens\n * - Batch operations\n * - Transactions\n * - Performance monitoring\n * - Cache management\n * - Collection management\n * - Query builder\n */\n\nimport type { IDBAdapter, DatabaseResult, BaseEntity, DatabaseTransaction, QueryBuilder } from '../../dbInterface';\nimport { AdapterCore } from './adapterCore';\nimport { CrudModule } from '../crud/crudModule';\nimport { AuthModule } from '../modules/auth/authModule';\nimport { ContentModule } from '../modules/content/contentModule';\nimport { MediaModule } from '../modules/media/mediaModule';\nimport { PreferencesModule } from '../modules/system/preferencesModule';\nimport { VirtualFoldersModule } from '../modules/system/virtualFoldersModule';\nimport { ThemesModule } from '../modules/themes/themesModule';\nimport { WidgetsModule } from '../modules/widgets/widgetsModule';\nimport { WebsiteTokensModule } from '../modules/website/tokensModule';\nimport { BatchModule } from '../operations/batchModule';\nimport { TransactionModule } from '../operations/transactionModule';\nimport { PerformanceModule } from '../performance/performanceModule';\nimport { CacheModule } from '../performance/cacheModule';\nimport { CollectionModule } from '../collection/collectionModule';\nimport { MariaDBQueryBuilder } from '../queryBuilder/MariaDBQueryBuilder';\nimport * as utils from '../utils';\n\nexport class MariaDBAdapter extends AdapterCore implements IDBAdapter {\n\tpublic readonly crud: CrudModule;\n\tpublic readonly auth: AuthModule;\n\tpublic readonly content: ContentModule;\n\tpublic readonly media: MediaModule;\n\tpublic readonly systemPreferences: PreferencesModule;\n\tpublic readonly systemVirtualFolder: VirtualFoldersModule;\n\tpublic readonly themes: ThemesModule;\n\tpublic readonly widgets: WidgetsModule;\n\tpublic readonly websiteTokens: WebsiteTokensModule;\n\tpublic readonly batch: BatchModule;\n\tprivate readonly transactionModule: TransactionModule;\n\tpublic readonly performance: PerformanceModule;\n\tpublic readonly cache: CacheModule;\n\tpublic readonly collection: CollectionModule;\n\tpublic readonly utils = utils;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.crud = new CrudModule(this);\n\t\tthis.auth = new AuthModule(this);\n\t\tthis.content = new ContentModule(this);\n\t\tthis.media = new MediaModule(this);\n\t\tthis.systemPreferences = new PreferencesModule(this);\n\t\tthis.systemVirtualFolder = new VirtualFoldersModule(this);\n\t\tthis.themes = new ThemesModule(this);\n\t\tthis.widgets = new WidgetsModule(this);\n\t\tthis.websiteTokens = new WebsiteTokensModule(this);\n\t\tthis.batch = new BatchModule(this);\n\t\tthis.transactionModule = new TransactionModule(this);\n\t\tthis.performance = new PerformanceModule(this);\n\t\tthis.cache = new CacheModule(this);\n\t\tthis.collection = new CollectionModule(this);\n\t}\n\n\tpublic queryBuilder = <T extends BaseEntity>(collection: string): QueryBuilder<T> => {\n\t\treturn new MariaDBQueryBuilder<T>(this as any, collection);\n\t};\n\n\tpublic transaction = async <T>(\n\t\tfn: (transaction: DatabaseTransaction) => Promise<DatabaseResult<T>>,\n\t\toptions?: { isolationLevel?: 'READ UNCOMMITTED' | 'READ COMMITTED' | 'REPEATABLE READ' | 'SERIALIZABLE' }\n\t): Promise<DatabaseResult<T>> => {\n\t\treturn this.transactionModule.execute(fn, options);\n\t};\n\n\t// Global CRUD data methods\n\tgetCollectionData = async (\n\t\tcollection: string,\n\t\toptions?: { limit?: number; offset?: number; includeMetadata?: boolean; fields?: string[] }\n\t): Promise<DatabaseResult<{ data: any[]; metadata?: { totalCount: number; schema?: unknown; indexes?: string[] } }>> => {\n\t\treturn (this as any).wrap(async () => {\n\t\t\tconst res = await this.crud.findMany(collection, {}, options as any);\n\t\t\tif (!res.success) throw new Error(res.message);\n\t\t\treturn {\n\t\t\t\tdata: res.data ?? [],\n\t\t\t\tmetadata: options?.includeMetadata ? { totalCount: res.data?.length ?? 0 } : undefined\n\t\t\t};\n\t\t}, 'GET_COLLECTION_DATA_FAILED');\n\t};\n\n\tgetMultipleCollectionData = async (\n\t\tcollectionNames: string[],\n\t\toptions?: { limit?: number; fields?: string[] }\n\t): Promise<DatabaseResult<Record<string, any[]>>> => {\n\t\treturn (this as any).wrap(async () => {\n\t\t\tconst results: Record<string, any[]> = {};\n\t\t\tfor (const name of collectionNames) {\n\t\t\t\tconst res = await this.getCollectionData(name, { limit: options?.limit, fields: options?.fields });\n\t\t\t\tif (res.success) results[name] = res.data.data;\n\t\t\t}\n\t\t\treturn results;\n\t\t}, 'GET_MULTIPLE_COLLECTION_DATA_FAILED');\n\t};\n}\n\nexport * from './adapterTypes';\nexport * from './adapterCore';\n"],"names":["uuidv4","schema","utils.createDatabaseError","schema.contentNodes","utils.convertDatesToISO","utils.convertArrayDatesToISO","utils.generateId","schema.authUsers","schema.authSessions","schema.authTokens","schema.roles","schema.contentDrafts","schema.contentRevisions","schema.mediaItems","schema.systemVirtualFolders","schema.systemPreferences","schema.themes","themes","schema.widgets","schema.websiteTokens"],"mappings":"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"}