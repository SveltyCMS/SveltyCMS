{"version":3,"file":"logger.js","sources":["../../../../../../shared/utils/src/logger.ts"],"sourcesContent":["/**\n * @file src/utils/logger.ts\n * @description Universal logger (client + server) with formatting & tree-shaking\n *\n * Features:\n * - Level-based logging (fatal ‚Üí trace)\n * - Smart token highlighting\n * - Sensitive data masking\n * - Channel support\n * - Dump helper\n * - Fully stripped when VITE_LOG_LEVELS=none\n *\n * Configure via VITE_LOG_LEVELS (build) or LOG_LEVELS (runtime)\n */\nconst IS_BROWSER = typeof window !== 'undefined';\n\nexport type LoggableValue = string | number | boolean | null | undefined | object | Date | Error;\n\n// Log levels from env\nconst env = import.meta.env || {};\nconst proc = typeof process !== 'undefined' ? process.env : {};\nconst LOG_LEVELS = (env.VITE_LOG_LEVELS ?? proc.LOG_LEVELS ?? 'info').split(',').map((l) => l.trim().toLowerCase()) as LogLevel[];\n\nconst DISABLED = LOG_LEVELS.includes('none');\n\ntype LogLevel = 'none' | 'fatal' | 'error' | 'warn' | 'info' | 'debug' | 'trace';\n\nconst PRIORITY: Record<LogLevel, number> = {\n\tnone: 0,\n\tfatal: 1,\n\terror: 2,\n\twarn: 3,\n\tinfo: 4,\n\tdebug: 5,\n\ttrace: 6\n};\n\nconst MAX_PRIO = DISABLED ? 0 : Math.max(...LOG_LEVELS.map((l) => PRIORITY[l] ?? 0));\n\n// Enabled check (inlined)\nconst enabled = (level: LogLevel) => !DISABLED && PRIORITY[level] <= MAX_PRIO;\n\n// Sensitive keys\nconst SENSITIVE = [\n\t'password',\n\t'passwd',\n\t'pwd',\n\t'token',\n\t'access_token',\n\t'refresh_token',\n\t'api_key',\n\t'apikey',\n\t'secret',\n\t'client_secret',\n\t'authorization',\n\t'auth'\n];\n\n// Masking\nfunction mask(v: unknown, depth = 0): unknown {\n\tif (depth > 10) return '[Depth]';\n\tif (v === null || typeof v !== 'object') return v;\n\tif (v instanceof Date || v instanceof RegExp) return v;\n\tif (Array.isArray(v)) return v.map((i) => mask(i, depth + 1));\n\n\tconst o: Record<string, unknown> = {};\n\tfor (const [k, val] of Object.entries(v)) {\n\t\tif (SENSITIVE.some((s) => k.toLowerCase().includes(s))) {\n\t\t\to[k] = '[REDACTED]';\n\t\t} else {\n\t\t\to[k] = mask(val, depth + 1);\n\t\t}\n\t}\n\treturn o;\n}\n\n// Server formatting (ANSI)\nconst serverFormat =\n\t!IS_BROWSER && !DISABLED\n\t\t? (msg: string) => {\n\t\t\t\tconst patterns = [\n\t\t\t\t\t{ re: /\\b\\d+(\\.\\d+)?(ms|s)\\b/g, c: '\\x1b[32m' },\n\t\t\t\t\t{\n\t\t\t\t\t\tre: /[a-f0-9]{24}|[a-f0-9]{32}|[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi,\n\t\t\t\t\t\tc: '\\x1b[33m'\n\t\t\t\t\t},\n\t\t\t\t\t{ re: /\\/api\\/[^\\s]+/g, c: '\\x1b[36m' },\n\t\t\t\t\t{ re: /\\btrue\\b/g, c: '\\x1b[32m' },\n\t\t\t\t\t{ re: /\\bfalse\\b/g, c: '\\x1b[31m' },\n\t\t\t\t\t{ re: /\\b\\d+\\b/g, c: '\\x1b[34m' }\n\t\t\t\t];\n\t\t\t\tlet out = msg;\n\t\t\t\tfor (const { re, c } of patterns) {\n\t\t\t\t\tout = out.replace(re, `${c}$&${'\\x1b[0m'}`);\n\t\t\t\t}\n\t\t\t\treturn out;\n\t\t\t}\n\t\t: (msg: string) => msg;\n\n// Client formatting (console %c)\nconst clientFormat =\n\tIS_BROWSER && !DISABLED\n\t\t? (msg: string) => {\n\t\t\t\tconst styles: string[] = [];\n\t\t\t\tlet formatted = msg.replace(\n\t\t\t\t\t/\\b\\d+(\\.\\d+)?(ms|s)\\b|[a-f0-9]{24}|[a-f0-9]{32}|[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}|\\/api\\/[^\\s]+|\\btrue\\b|\\bfalse\\b|\\b\\d+\\b/gi,\n\t\t\t\t\t(m) => {\n\t\t\t\t\t\tconst color = m.match(/ms|s|\\d/)\n\t\t\t\t\t\t\t? '#22c55e'\n\t\t\t\t\t\t\t: m.match(/[a-f0-9]{24}|[a-f0-9]{32}|uuid/i)\n\t\t\t\t\t\t\t\t? '#f59e0b'\n\t\t\t\t\t\t\t\t: m === 'true'\n\t\t\t\t\t\t\t\t\t? '#22c55e'\n\t\t\t\t\t\t\t\t\t: m === 'false'\n\t\t\t\t\t\t\t\t\t\t? '#ef4444'\n\t\t\t\t\t\t\t\t\t\t: m.startsWith('/api/')\n\t\t\t\t\t\t\t\t\t\t\t? '#06b6d4'\n\t\t\t\t\t\t\t\t\t\t\t: '#3b82f6';\n\t\t\t\t\t\tstyles.push(`color:${color};font-weight:bold`);\n\t\t\t\t\t\tstyles.push('color:inherit');\n\t\t\t\t\t\treturn `%c${m}%c`;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn { formatted, styles };\n\t\t\t}\n\t\t: () => ({ formatted: '', styles: [] });\n\n// Core log\nfunction log(level: LogLevel, msg: string, args: unknown[]) {\n\tif (!enabled(level)) return;\n\n\tconst masked = args.map(mask);\n\tconst ts = new Date().toISOString().slice(0, 19).replace('T', ' ');\n\tconst icons: Record<LogLevel, string> = {\n\t\tfatal: 'üíÄ',\n\t\terror: '‚ùå',\n\t\twarn: '‚ö†Ô∏è',\n\t\tinfo: '‚ÑπÔ∏è',\n\t\tdebug: 'üêõ',\n\t\ttrace: 'üîç',\n\t\tnone: ''\n\t};\n\tconst method = level === 'fatal' || level === 'error' ? 'error' : level === 'warn' ? 'warn' : 'log';\n\n\tif (IS_BROWSER) {\n\t\tconst { formatted, styles } = clientFormat(msg);\n\t\tconsole[method](`%c${ts}%c ${icons[level]} [${level.toUpperCase()}] %c${formatted}`, 'color:#9ca3af', '', 'color:inherit', ...styles, ...masked);\n\t} else {\n\t\tconst colored = serverFormat(msg);\n\t\tconsole[method](`${'\\x1b[2m'}${ts}${'\\x1b[0m'} ${icons[level]} [${level.toUpperCase().padEnd(5)}] ${colored}`, ...masked);\n\t}\n}\n\n// Public logger\nexport const logger = DISABLED\n\t? {\n\t\t\tfatal: () => {},\n\t\t\terror: () => {},\n\t\t\twarn: () => {},\n\t\t\tinfo: () => {},\n\t\t\tdebug: () => {},\n\t\t\ttrace: () => {},\n\t\t\tchannel: () => ({\n\t\t\t\tfatal: () => {},\n\t\t\t\terror: () => {},\n\t\t\t\twarn: () => {},\n\t\t\t\tinfo: () => {},\n\t\t\t\tdebug: () => {},\n\t\t\t\ttrace: () => {}\n\t\t\t}),\n\t\t\tdump: () => {}\n\t\t}\n\t: {\n\t\t\tfatal: (m: string, ...a: unknown[]) => log('fatal', m, a),\n\t\t\terror: (m: string, ...a: unknown[]) => log('error', m, a),\n\t\t\twarn: (m: string, ...a: unknown[]) => log('warn', m, a),\n\t\t\tinfo: (m: string, ...a: unknown[]) => log('info', m, a),\n\t\t\tdebug: (m: string, ...a: unknown[]) => log('debug', m, a),\n\t\t\ttrace: (m: string, ...a: unknown[]) => log('trace', m, a),\n\n\t\t\tchannel: (name: string) => ({\n\t\t\t\tfatal: (m: string, ...a: unknown[]) => log('fatal', `[${name}] ${m}`, a),\n\t\t\t\terror: (m: string, ...a: unknown[]) => log('error', `[${name}] ${m}`, a),\n\t\t\t\twarn: (m: string, ...a: unknown[]) => log('warn', `[${name}] ${m}`, a),\n\t\t\t\tinfo: (m: string, ...a: unknown[]) => log('info', `[${name}] ${m}`, a),\n\t\t\t\tdebug: (m: string, ...a: unknown[]) => log('debug', `[${name}] ${m}`, a),\n\t\t\t\ttrace: (m: string, ...a: unknown[]) => log('trace', `[${name}] ${m}`, a)\n\t\t\t}),\n\n\t\t\tdump: (data: unknown, label?: string) => {\n\t\t\t\tif (!enabled('trace')) return;\n\t\t\t\tconst prefix = label ? `DUMP[${label}]` : 'DUMP';\n\t\t\t\tif (IS_BROWSER) {\n\t\t\t\t\tconsole.group(`üîç ${prefix}`);\n\t\t\t\t\tconsole.dir(mask(data), { depth: null });\n\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t} else {\n\t\t\t\t\tlog('trace', prefix, [data]);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n"],"names":[],"mappings":"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"}