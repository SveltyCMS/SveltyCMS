{"version":3,"file":"formSchemas.js","sources":["../../../../../../shared/utils/src/formSchemas.ts"],"sourcesContent":["/**\n * @file: src/utils/formSchemas.ts\n * @description: Defines Valibot schemas for various forms used in the application.\n *\n * @requires valibot - For schema definition and validation\n * @requires @shared/stores/globalSettings - For accessing settings from database\n * @requires @shared/paraglide/messages - For internationalized error messages\n */\n\nimport {\n\tarray,\n\tboolean,\n\tcheck,\n\tcustom,\n\temail as emailValidator,\n\tforward,\n\tmaxLength,\n\tminLength,\n\tnullable,\n\tnumber,\n\tobject,\n\toptional,\n\tpartialCheck,\n\tpicklist,\n\tpipe,\n\tregex,\n\tstrictObject,\n\tstring,\n\ttransform,\n\ttrim,\n\ttype InferInput\n} from 'valibot';\n\n// NOTE: Error messages are plain strings for universal (client/server) compatibility.\nconst MIN_PPASSWORD_LENGTH = 8;\n\n// --- Reusable Username Schemas ---\nconst usernameSchema = pipe(\n\tstring(),\n\ttrim(),\n\tminLength(2, 'Username must be at least 2 characters'),\n\tmaxLength(50, 'Username must be at most 50 characters'),\n\tregex(/^[a-zA-Z0-9@$!%*#._-]+$/, 'Username contains invalid characters')\n);\n\n// --- Reusable Email Schemas ---\nconst emailSchema = pipe(\n\tstring(),\n\ttrim(),\n\ttransform((value) => value.toLowerCase()),\n\temailValidator('Invalid email address')\n);\n\n// --- Reusable Password Schemas ---\nconst passwordSchema = pipe(\n\tstring(),\n\ttrim(),\n\tminLength(MIN_PPASSWORD_LENGTH, `Password must be at least ${MIN_PPASSWORD_LENGTH} characters and include a letter, number, and special character`),\n\tregex(\n\t\t/^(?=.*[A-Za-z])(?=.*[0-9])(?=.*[!@#$%^&*()_+\\-=[\\]{};':\"\\\\|,.<>?]).{8,}$/,\n\t\t`Password must be at least ${MIN_PPASSWORD_LENGTH} characters and include a letter, number, and special character`\n\t)\n);\n\n// --- Reusable Confirm Password Schemas ---\nconst confirmPasswordSchema = pipe(string(), trim());\n\n// --- Reusable Token Schemas ---\nconst tokenSchema = pipe(string(), trim(), minLength(16, 'Token must be at least 16 characters'));\n\n// Form Schemas------------------------------------\n\n// Login Form Schema\nexport const loginFormSchema = strictObject({\n\temail: emailSchema,\n\tpassword: passwordSchema,\n\tisToken: boolean()\n});\n\n// Forgot Password Form Schema\nexport const forgotFormSchema = object({\n\temail: emailSchema\n});\n\n// Reset Password Form Schema\nexport const resetFormSchema = pipe(\n\tobject({\n\t\tpassword: passwordSchema,\n\t\tconfirm_password: confirmPasswordSchema,\n\t\ttoken: tokenSchema,\n\t\temail: emailSchema\n\t}),\n\tforward(\n\t\tpartialCheck([['password'], ['confirm_password']], (input) => input.password === input.confirm_password, 'Passwords do not match'),\n\t\t['confirm_password']\n\t)\n);\n\n// Sign Up User Form Schema\nexport const signUpFormSchema = pipe(\n\tstrictObject({\n\t\tusername: usernameSchema,\n\t\temail: emailSchema,\n\t\tpassword: passwordSchema,\n\t\tconfirm_password: confirmPasswordSchema,\n\t\ttoken: optional(nullable(string()))\n\t}),\n\tcheck((input) => input.password === input.confirm_password, 'Passwords do not match')\n);\n\n// Google OAuth Token Schema\nexport const signUpOAuthFormSchema = object({\n\tlang: nullable(string())\n});\n\n// Validate New User Token Schema\nexport const addUserTokenSchema = object({\n\temail: emailSchema,\n\trole: string(),\n\texpiresIn: picklist(['2 hrs', '12 hrs', '2 days', '1 week', '2 weeks', '1 month'])\n});\n\n// Change Password Form Schema\nexport const changePasswordSchema = object({\n\told_password: string(),\n\tpassword: passwordSchema,\n\tconfirm_password: string()\n});\n\n// Widget Email Schema\nexport const widgetEmailSchema = object({\n\temail: emailSchema\n});\n\n// Add User Schema\nexport const addUserSchema = object({\n\temail: emailSchema,\n\trole: string()\n});\n\n// Edit User Schema\nexport const editUserSchema = pipe(\n\tobject({\n\t\tuser_id: string(),\n\t\tusername: usernameSchema,\n\t\temail: emailSchema,\n\t\trole: optional(string()),\n\t\tpassword: optional(string()),\n\t\tconfirmPassword: optional(string())\n\t}),\n\tforward(\n\t\tcheck((input) => {\n\t\t\tif (input.password && input.password.length > 0) {\n\t\t\t\treturn input.password === input.confirmPassword;\n\t\t\t}\n\t\t\treturn true;\n\t\t}, 'Passwords do not match'),\n\t\t['confirmPassword']\n\t)\n);\n\n// Setup Admin User Schema\nexport const setupAdminSchema = pipe(\n\tstrictObject({\n\t\tusername: usernameSchema,\n\t\temail: emailSchema,\n\t\tpassword: passwordSchema,\n\t\tconfirmPassword: confirmPasswordSchema\n\t}),\n\tcheck((input) => input.password === input.confirmPassword, 'Passwords do not match')\n);\n\n// --- SMTP Configuration Schemas ---\n\n// SMTP Host Schema\n// Validates hostname format (e.g., smtp.gmail.com)\n// Rejects email-like inputs (e.g., user@domain.com)\nconst smtpHostSchema = pipe(\n\tstring(),\n\ttrim(),\n\tminLength(1, 'SMTP host is required'),\n\tmaxLength(255, 'SMTP host is too long'),\n\tcustom((value) => {\n\t\tif (typeof value !== 'string') return false;\n\t\t// Reject if it looks like an email\n\t\tif (value.includes('@')) {\n\t\t\treturn false;\n\t\t}\n\t\t// Valid hostname: alphanumeric, hyphens, dots\n\t\t// Must have at least one dot and valid format\n\t\treturn /^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/.test(value);\n\t}, 'Invalid hostname format. Use \"smtp.domain.com\" not \"email@domain.com\"')\n);\n\n// SMTP Port Schema\n// Validates port number (1-65535)\nconst smtpPortSchema = pipe(\n\tnumber(),\n\tcustom((value) => {\n\t\tif (typeof value !== 'number') return false;\n\t\treturn value >= 1 && value <= 65535;\n\t}, 'Port must be between 1 and 65535')\n);\n\n// SMTP User Schema\n// Typically an email address or username\nconst smtpUserSchema = pipe(string(), trim(), minLength(1, 'SMTP username is required'), maxLength(255, 'SMTP username is too long'));\n\n// SMTP Password Schema\nconst smtpPasswordSchema = pipe(string(), trim(), minLength(1, 'SMTP password is required'));\n\n// SMTP From Address Schema (Optional)\nconst smtpFromSchema = pipe(string(), trim());\n\n// Complete SMTP Configuration Schema\nexport const smtpConfigSchema = object({\n\thost: smtpHostSchema,\n\tport: smtpPortSchema,\n\tuser: smtpUserSchema,\n\tpassword: smtpPasswordSchema,\n\tfrom: smtpFromSchema,\n\tsecure: boolean()\n});\n\n// --- Database Configuration Schemas ---\n\n// Database Type Schema\nconst dbTypeSchema = picklist(['mongodb', 'mongodb+srv', 'postgresql', 'mysql', 'mariadb'], 'Invalid database type');\n\n// Database Host Schema\nconst dbHostSchema = pipe(string(), trim(), minLength(1, 'Database host is required'), maxLength(255, 'Database host is too long'));\n\n// Database Port Schema (optional for Atlas)\nconst dbPortSchema = optional(\n\tpipe(\n\t\tstring(),\n\t\ttrim(),\n\t\ttransform((value) => (value ? parseInt(value, 10) : undefined)),\n\t\tcustom((value) => {\n\t\t\tif (value === undefined) return true;\n\t\t\tif (typeof value !== 'number') return false;\n\t\t\treturn value >= 1 && value <= 65535;\n\t\t}, 'Port must be between 1 and 65535')\n\t)\n);\n\n// Database Name Schema\nconst dbNameSchema = pipe(\n\tstring(),\n\ttrim(),\n\tminLength(1, 'Database name is required'),\n\tmaxLength(63, 'Database name is too long'),\n\tregex(/^[a-zA-Z0-9_-]+$/, 'Database name can only contain letters, numbers, hyphens, and underscores')\n);\n\n// Database User Schema (optional for MongoDB without auth)\nconst dbUserSchema = pipe(string(), trim(), maxLength(63, 'Database user is too long'));\n\n// Database Password Schema (optional for MongoDB without auth)\nconst dbPasswordSchema = pipe(string(), trim());\n\n// Complete Database Configuration Schema\nexport const dbConfigSchema = pipe(\n\tobject({\n\t\ttype: dbTypeSchema,\n\t\thost: dbHostSchema,\n\t\tport: dbPortSchema,\n\t\tname: dbNameSchema,\n\t\tuser: dbUserSchema,\n\t\tpassword: dbPasswordSchema\n\t}),\n\tcheck((input) => {\n\t\t// For PostgreSQL and MySQL, username and password are required\n\t\tif (input.type === 'postgresql' || input.type === 'mysql' || input.type === 'mariadb') {\n\t\t\treturn input.user.length > 0 && input.password.length > 0;\n\t\t}\n\t\t// For MongoDB (both standard and Atlas), authentication is optional\n\t\t// This allows local development without auth (e.g., MongoDB Compass)\n\t\treturn true;\n\t}, 'Username and password are required for this database type.')\n);\n\n// --- System Settings Schemas ---\n\n// Site Name Schema\nconst siteNameSchema = pipe(string(), trim(), minLength(1, 'Site name is required'), maxLength(100, 'Site name is too long'));\n\n// Production Host Schema\nconst hostProdSchema = pipe(\n\tstring(),\n\ttrim(),\n\tminLength(1, 'Production URL is required'),\n\tmaxLength(255, 'Production URL is too long'),\n\tregex(/^https?:\\/\\/.+/, 'Production URL must start with http:// or https://')\n);\n\n// Language Code Schema (ISO 639-1 two-letter codes)\nconst languageCodeSchema = pipe(\n\tstring(),\n\ttrim(),\n\ttransform((value) => value.toLowerCase()),\n\tregex(/^[a-z]{2}$/, 'Language code must be a valid ISO 639-1 two-letter code')\n);\n\n// Timezone Schema\nconst timezoneSchema = pipe(string(), trim(), minLength(1, 'Timezone is required'));\n\n// Media Storage Type Schema\nconst mediaStorageTypeSchema = picklist(['local', 's3', 'r2', 'cloudinary'], 'Invalid media storage type');\n\n// Media Folder Schema\nconst mediaFolderSchema = pipe(\n\tstring(),\n\ttrim(),\n\tminLength(1, 'Media folder/bucket name is required'),\n\tmaxLength(255, 'Media folder/bucket name is too long')\n);\n\n// Complete System Settings Schema\nexport const systemSettingsSchema = object({\n\tsiteName: siteNameSchema,\n\thostProd: hostProdSchema,\n\tdefaultSystemLanguage: languageCodeSchema,\n\tsystemLanguages: array(languageCodeSchema, 'System languages must be an array of valid language codes.'),\n\tdefaultContentLanguage: languageCodeSchema,\n\tcontentLanguages: array(languageCodeSchema, 'Content languages must be an array of valid language codes.'),\n\ttimezone: timezoneSchema,\n\tmediaStorageType: mediaStorageTypeSchema,\n\tmediaFolder: mediaFolderSchema\n});\n\n// Type Exports\nexport type LoginFormSchema = InferInput<typeof loginFormSchema>;\nexport type ForgotFormSchema = InferInput<typeof forgotFormSchema>;\nexport type ResetFormSchema = InferInput<typeof resetFormSchema>;\nexport type SignUpFormSchema = InferInput<typeof signUpFormSchema>;\nexport type SignUpOAuthFormSchema = InferInput<typeof signUpOAuthFormSchema>;\nexport type AddUserTokenSchema = InferInput<typeof addUserTokenSchema>;\nexport type ChangePasswordSchemaType = InferInput<typeof changePasswordSchema>;\nexport type WidgetEmailSchema = InferInput<typeof widgetEmailSchema>;\nexport type AddUserSchema = InferInput<typeof addUserSchema>;\nexport type EditUserSchema = InferInput<typeof editUserSchema>;\nexport type SetupAdminSchema = InferInput<typeof setupAdminSchema>;\nexport type SmtpConfigSchema = InferInput<typeof smtpConfigSchema>;\nexport type DbConfigSchema = InferInput<typeof dbConfigSchema>;\nexport type SystemSettingsSchema = InferInput<typeof systemSettingsSchema>;\n"],"names":["emailValidator"],"mappings":"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"}