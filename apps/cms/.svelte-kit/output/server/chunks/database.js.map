{"version":3,"file":"database.js","sources":["../../../../../../shared/utils/src/database.ts"],"sourcesContent":["/**\n * @file shared/utils/src/database.ts\n * @description Database-related utilities for connection and configuration.\n */\n\nimport type { DatabaseConfig } from '@shared/database/schemas';\n\n/**\n * Database connection string builder for supported database types.\n * Currently supports: MongoDB (standard and Atlas SRV), MariaDB\n */\nexport function buildDatabaseConnectionString(config: DatabaseConfig): string {\n\tswitch (config.type) {\n\t\tcase 'mongodb':\n\t\tcase 'mongodb+srv': {\n\t\t\tconst isSrv = config.type === 'mongodb+srv';\n\t\t\tconst protocol = isSrv ? 'mongodb+srv' : 'mongodb';\n\t\t\tconst port = isSrv || !config.port ? '' : `:${config.port}`;\n\n\t\t\t// Check if credentials are provided\n\t\t\tconst hasCredentials = config.user && config.password;\n\t\t\tconst user = hasCredentials ? `${encodeURIComponent(config.user)}:${encodeURIComponent(config.password)}@` : '';\n\n\t\t\t// For MongoDB Atlas (mongodb+srv), add standard query parameters\n\t\t\t// For regular MongoDB with auth, add authSource=admin\n\t\t\tlet queryParams = '';\n\t\t\tif (isSrv && hasCredentials) {\n\t\t\t\tqueryParams = '?retryWrites=true&w=majority';\n\t\t\t} else if (!isSrv && hasCredentials) {\n\t\t\t\tqueryParams = '?authSource=admin';\n\t\t\t}\n\n\t\t\treturn `${protocol}://${user}${config.host}${port}/${config.name}${queryParams}`;\n\t\t}\n\t\tcase 'mariadb': {\n\t\t\t// MariaDB connection string\n\t\t\tconst port = config.port ? `:${config.port}` : ':3306';\n\t\t\tconst hasCredentials = config.user && config.password;\n\t\t\tconst user = hasCredentials ? `${encodeURIComponent(config.user)}:${encodeURIComponent(config.password)}@` : '';\n\n\t\t\treturn `mysql://${user}${config.host}${port}/${config.name}`;\n\t\t}\n\t\tdefault: {\n\t\t\tconst _exhaustiveCheck: never = config.type;\n\t\t\tthrow new Error(`Unsupported database type: ${_exhaustiveCheck}`);\n\t\t}\n\t}\n}\n"],"names":[],"mappings":"AAWO,SAAS,8BAA8B,QAAgC;AAC7E,UAAQ,OAAO,MAAA;AAAA,IACd,KAAK;AAAA,IACL,KAAK,eAAe;AACnB,YAAM,QAAQ,OAAO,SAAS;AAC9B,YAAM,WAAW,QAAQ,gBAAgB;AACzC,YAAM,OAAO,SAAS,CAAC,OAAO,OAAO,KAAK,IAAI,OAAO,IAAI;AAGzD,YAAM,iBAAiB,OAAO,QAAQ,OAAO;AAC7C,YAAM,OAAO,iBAAiB,GAAG,mBAAmB,OAAO,IAAI,CAAC,IAAI,mBAAmB,OAAO,QAAQ,CAAC,MAAM;AAI7G,UAAI,cAAc;AAClB,UAAI,SAAS,gBAAgB;AAC5B,sBAAc;AAAA,MACf,WAAW,CAAC,SAAS,gBAAgB;AACpC,sBAAc;AAAA,MACf;AAEA,aAAO,GAAG,QAAQ,MAAM,IAAI,GAAG,OAAO,IAAI,GAAG,IAAI,IAAI,OAAO,IAAI,GAAG,WAAW;AAAA,IAC/E;AAAA,IACA,KAAK,WAAW;AAEf,YAAM,OAAO,OAAO,OAAO,IAAI,OAAO,IAAI,KAAK;AAC/C,YAAM,iBAAiB,OAAO,QAAQ,OAAO;AAC7C,YAAM,OAAO,iBAAiB,GAAG,mBAAmB,OAAO,IAAI,CAAC,IAAI,mBAAmB,OAAO,QAAQ,CAAC,MAAM;AAE7G,aAAO,WAAW,IAAI,GAAG,OAAO,IAAI,GAAG,IAAI,IAAI,OAAO,IAAI;AAAA,IAC3D;AAAA,IACA,SAAS;AACR,YAAM,mBAA0B,OAAO;AACvC,YAAM,IAAI,MAAM,8BAA8B,gBAAgB,EAAE;AAAA,IACjE;AAAA,EAAA;AAEF;"}