{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/media/trash/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/m\t// Authentication is handled by hooks.server.ts - user presence confirms accessts\n * @description\n * API endpoint for moving a media file to the trash within the current tenant.\n *\n * @example POST /api/media/trash\n *\n * Features:\n * - Secure, granular access control per operation\n * - Multi-Tenant Safe: File operations are scoped to the current tenant.\n */\n\nimport { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { error } from '@sveltejs/kit';\nimport { getPrivateSettingSync } from '@shared/services/settingsService';\n\n// Permission checking\n\n// Auth\nimport { auth } from '@shared/database/db';\n\n// Media Processing\nimport { moveMediaToTrash } from '@shared/utils/media/mediaStorage.server';\n\n// System Logger\nimport { logger } from '@shared/utils/logger.server';\n\nexport const POST: RequestHandler = async ({ request, locals }) => {\n\tconst { user, tenantId } = locals;\n\t// Authentication is handled by hooks.server.ts - user presence confirms access\n\n\tif (!auth) {\n\t\tlogger.error('Auth service is not initialized');\n\t\tthrow error(500, 'Auth service not available');\n\t}\n\n\tif (getPrivateSettingSync('MULTI_TENANT') && !tenantId) {\n\t\tthrow error(400, 'Tenant could not be identified for this operation.');\n\t}\n\n\ttry {\n\t\tconst { url, contentTypes } = await request.json();\n\t\tif (!url || !contentTypes) {\n\t\t\tthrow error(400, 'URL and collection types are required');\n\t\t}\n\n\t\t// Move media to trash\n\t\tawait moveMediaToTrash(url);\n\n\t\tlogger.info('Media file moved to trash successfully', { url, userId: user?._id, tenantId });\n\t\treturn json({ success: true });\n\t} catch (err) {\n\t\tconst message = `Error moving file to trash: ${err instanceof Error ? err.message : String(err)}`;\n\t\tlogger.error(message, { tenantId });\n\t\tthrow error(500, message);\n\t}\n};\n"],"names":[],"mappings":";;;;;AA4BO,MAAM,OAAuB,OAAO,EAAE,SAAS,aAAa;AAClE,QAAM,EAAE,MAAM,SAAA,IAAa;AAG3B,MAAI,CAAC,MAAM;AACV,WAAO,MAAM,iCAAiC;AAC9C,UAAM,MAAM,KAAK,4BAA4B;AAAA,EAC9C;AAEA,MAAI,sBAAsB,cAAc,KAAK,CAAC,UAAU;AACvD,UAAM,MAAM,KAAK,oDAAoD;AAAA,EACtE;AAEA,MAAI;AACH,UAAM,EAAE,KAAK,aAAA,IAAiB,MAAM,QAAQ,KAAA;AAC5C,QAAI,CAAC,OAAO,CAAC,cAAc;AAC1B,YAAM,MAAM,KAAK,uCAAuC;AAAA,IACzD;AAGA,UAAM,iBAAiB,GAAG;AAE1B,WAAO,KAAK,0CAA0C,EAAE,KAAK,QAAQ,MAAM,KAAK,UAAU;AAC1F,WAAO,KAAK,EAAE,SAAS,MAAM;AAAA,EAC9B,SAAS,KAAK;AACb,UAAM,UAAU,+BAA+B,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG,CAAC;AAC/F,WAAO,MAAM,SAAS,EAAE,SAAA,CAAU;AAClC,UAAM,MAAM,KAAK,OAAO;AAAA,EACzB;AACD;"}