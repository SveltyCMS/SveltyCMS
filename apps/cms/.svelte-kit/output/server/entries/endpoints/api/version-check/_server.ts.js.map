{"version":3,"file":"_server.ts.js","sources":["../../../../../../../src/routes/api/version-check/+server.ts"],"sourcesContent":["import { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { version as localVersion } from '@root/package.json';\n\n// Simple semver comparison function\nconst compareSemver = (a: string, b: string) => {\n\tconst aParts = a.split('.').map(Number);\n\tconst bParts = b.split('.').map(Number);\n\n\tfor (let i = 0; i < 3; i++) {\n\t\tif (aParts[i] > bParts[i]) return 1;\n\t\tif (aParts[i] < bParts[i]) return -1;\n\t}\n\treturn 0;\n};\n\nexport const GET: RequestHandler = async () => {\n\ttry {\n\t\tconst response = await fetch('https://api.github.com/repos/Rar9/SveltyCMS/releases/latest', {\n\t\t\theaders: {\n\t\t\t\t'User-Agent': 'SveltyCMS-Version-Check'\n\t\t\t}\n\t\t});\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`GitHub API responded with ${response.status}`);\n\t\t}\n\t\tconst latestRelease = await response.json();\n\t\tconst remoteVersion = latestRelease.tag_name.replace('v', ''); // remove 'v' prefix if it exists\n\t\tconst comparison = compareSemver(localVersion, remoteVersion);\n\n\t\tlet status: 'match' | 'minor' | 'major' | 'error' = 'match';\n\t\tif (comparison < 0) {\n\t\t\tconst localParts = localVersion.split('.').map(Number);\n\t\t\tconst remoteParts = remoteVersion.split('.').map(Number);\n\t\t\tif (localParts[0] < remoteParts[0]) {\n\t\t\t\tstatus = 'major';\n\t\t\t} else {\n\t\t\t\tstatus = 'minor';\n\t\t\t}\n\t\t}\n\n\t\treturn json({\n\t\t\tstatus,\n\t\t\tlocal: localVersion,\n\t\t\tremote: remoteVersion\n\t\t});\n\t} catch (error) {\n\t\tconst message = error instanceof Error ? error.message : 'Unknown error';\n\t\treturn json({ status: 'error', message }, { status: 500 });\n\t}\n};\n"],"names":["localVersion"],"mappings":";;AAKA,MAAM,gBAAgB,CAAC,GAAW,MAAc;AAC/C,QAAM,SAAS,EAAE,MAAM,GAAG,EAAE,IAAI,MAAM;AACtC,QAAM,SAAS,EAAE,MAAM,GAAG,EAAE,IAAI,MAAM;AAEtC,WAAS,IAAI,GAAG,IAAI,GAAG,KAAK;AAC3B,QAAI,OAAO,CAAC,IAAI,OAAO,CAAC,EAAG,QAAO;AAClC,QAAI,OAAO,CAAC,IAAI,OAAO,CAAC,EAAG,QAAO;AAAA,EACnC;AACA,SAAO;AACR;AAEO,MAAM,MAAsB,YAAY;AAC9C,MAAI;AACH,UAAM,WAAW,MAAM,MAAM,+DAA+D;AAAA,MAC3F,SAAS;AAAA,QACR,cAAc;AAAA,MAAA;AAAA,IACf,CACA;AACD,QAAI,CAAC,SAAS,IAAI;AACjB,YAAM,IAAI,MAAM,6BAA6B,SAAS,MAAM,EAAE;AAAA,IAC/D;AACA,UAAM,gBAAgB,MAAM,SAAS,KAAA;AACrC,UAAM,gBAAgB,cAAc,SAAS,QAAQ,KAAK,EAAE;AAC5D,UAAM,aAAa,cAAcA,SAAc,aAAa;AAE5D,QAAI,SAAgD;AACpD,QAAI,aAAa,GAAG;AACnB,YAAM,aAAaA,QAAa,MAAM,GAAG,EAAE,IAAI,MAAM;AACrD,YAAM,cAAc,cAAc,MAAM,GAAG,EAAE,IAAI,MAAM;AACvD,UAAI,WAAW,CAAC,IAAI,YAAY,CAAC,GAAG;AACnC,iBAAS;AAAA,MACV,OAAO;AACN,iBAAS;AAAA,MACV;AAAA,IACD;AAEA,WAAO,KAAK;AAAA,MACX;AAAA,MACA,OAAOA;AAAAA,MACP,QAAQ;AAAA,IAAA,CACR;AAAA,EACF,SAAS,OAAO;AACf,UAAM,UAAU,iBAAiB,QAAQ,MAAM,UAAU;AACzD,WAAO,KAAK,EAAE,QAAQ,SAAS,WAAW,EAAE,QAAQ,KAAK;AAAA,EAC1D;AACD;"}