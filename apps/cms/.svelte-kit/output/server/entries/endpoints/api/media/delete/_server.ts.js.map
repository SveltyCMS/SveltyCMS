{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/media/delete/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/media/delete/+server.ts\n * @description\n * API endpoint for deleting a media file within the current tenant.\n *\n * @example DELETE /api/media/delete\n *\n * Features:\n * - Secure, granular access control per operation\n * - Automatic metadata updates on modification (updatedBy)\n * - ModifyRequest support for widget-based data processing\n * - Status-based access control for non-admin users\n */\n\nimport { json, error } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { getPrivateSettingSync } from '@shared/services/settingsService';\n\n// Permissions\n\n// Media\nimport { deleteFile } from '@shared/utils/media/mediaStorage.server';\n\n// System Logger\nimport { logger } from '@shared/utils/logger.server';\n\nexport const DELETE: RequestHandler = async ({ request, locals }) => {\n\tconst { user, tenantId } = locals;\n\t// Authentication is handled by hooks.server.ts - user presence confirms access\n\n\tif (getPrivateSettingSync('MULTI_TENANT') && !tenantId) {\n\t\tthrow error(400, 'Tenant could not be identified for this operation.');\n\t}\n\n\ttry {\n\t\tconst { url } = await request.json();\n\t\tif (!url) {\n\t\t\tthrow error(400, 'URL is required');\n\t\t}\n\n\t\t// Delete the file (tenant is handled internally if needed)\n\t\tawait deleteFile(url);\n\n\t\tlogger.info('File deleted successfully', {\n\t\t\turl,\n\t\t\tuser: user?.email || 'unknown',\n\t\t\ttenantId\n\t\t});\n\n\t\treturn json({ success: true });\n\t} catch (err) {\n\t\tconst message = `Error deleting file: ${err instanceof Error ? err.message : String(err)}`;\n\t\tlogger.error(message, { user: user?.email || 'unknown', tenantId });\n\t\tthrow error(500, message);\n\t}\n};\n"],"names":[],"mappings":";;;;AA0BO,MAAM,SAAyB,OAAO,EAAE,SAAS,aAAa;AACpE,QAAM,EAAE,MAAM,SAAA,IAAa;AAG3B,MAAI,sBAAsB,cAAc,KAAK,CAAC,UAAU;AACvD,UAAM,MAAM,KAAK,oDAAoD;AAAA,EACtE;AAEA,MAAI;AACH,UAAM,EAAE,IAAA,IAAQ,MAAM,QAAQ,KAAA;AAC9B,QAAI,CAAC,KAAK;AACT,YAAM,MAAM,KAAK,iBAAiB;AAAA,IACnC;AAGA,UAAM,WAAW,GAAG;AAEpB,WAAO,KAAK,6BAA6B;AAAA,MACxC;AAAA,MACA,MAAM,MAAM,SAAS;AAAA,MACrB;AAAA,IAAA,CACA;AAED,WAAO,KAAK,EAAE,SAAS,MAAM;AAAA,EAC9B,SAAS,KAAK;AACb,UAAM,UAAU,wBAAwB,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG,CAAC;AACxF,WAAO,MAAM,SAAS,EAAE,MAAM,MAAM,SAAS,WAAW,UAAU;AAClE,UAAM,MAAM,KAAK,OAAO;AAAA,EACzB;AACD;"}