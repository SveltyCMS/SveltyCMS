{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/media/exists/+server.ts"],"sourcesContent":["/**\n * @file src/routes/a\t// Authentication is handled by hooks.server.ts - user presence confirms accesss/+server.ts\n * @description\n * API endpoint for checking the existence of a media file within the current tenant.\n *\n * @example GET /api/media/exists?url=https://example.com/image.jpg\n *\n * Features:\n * - Secure, granular access control per operation\n * - Multi-Tenant Safe: File existence check is scoped to the current tenant.\n */\n\nimport { json, error } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { getPrivateSettingSync } from '@shared/services/settingsService';\n\n// Media\nimport { fileExists } from '@shared/utils/media/mediaStorage.server';\n\n// System Logger\nimport { logger } from '@shared/utils/logger.server';\n\n// Permissions\n\nexport const GET: RequestHandler = async ({ url, locals }) => {\n\tconst { user, tenantId } = locals;\n\t// Authentication is handled by hooks.server.ts - user presence confirms access\n\n\tif (getPrivateSettingSync('MULTI_TENANT') && !tenantId) {\n\t\tthrow error(400, 'Tenant could not be identified for this operation.');\n\t}\n\n\ttry {\n\t\tconst fileUrl = url.searchParams.get('url');\n\t\tif (!fileUrl) {\n\t\t\tthrow error(400, 'URL parameter is required');\n\t\t}\n\n\t\t// Check file existence (tenant is handled internally if needed)\n\t\tconst exists = await fileExists(fileUrl);\n\t\tlogger.debug('Media file existence check', {\n\t\t\tfileUrl,\n\t\t\texists,\n\t\t\tuserId: user?._id,\n\t\t\ttenantId\n\t\t});\n\n\t\treturn json({ exists });\n\t} catch (err) {\n\t\tconst message = `Error checking file existence: ${err instanceof Error ? err.message : String(err)}`;\n\t\tlogger.error(message, { userId: user?._id, tenantId });\n\t\tthrow error(500, message);\n\t}\n};\n"],"names":[],"mappings":";;;;AAwBO,MAAM,MAAsB,OAAO,EAAE,KAAK,aAAa;AAC7D,QAAM,EAAE,MAAM,SAAA,IAAa;AAG3B,MAAI,sBAAsB,cAAc,KAAK,CAAC,UAAU;AACvD,UAAM,MAAM,KAAK,oDAAoD;AAAA,EACtE;AAEA,MAAI;AACH,UAAM,UAAU,IAAI,aAAa,IAAI,KAAK;AAC1C,QAAI,CAAC,SAAS;AACb,YAAM,MAAM,KAAK,2BAA2B;AAAA,IAC7C;AAGA,UAAM,SAAS,MAAM,WAAW,OAAO;AACvC,WAAO,MAAM,8BAA8B;AAAA,MAC1C;AAAA,MACA;AAAA,MACA,QAAQ,MAAM;AAAA,MACd;AAAA,IAAA,CACA;AAED,WAAO,KAAK,EAAE,QAAQ;AAAA,EACvB,SAAS,KAAK;AACb,UAAM,UAAU,kCAAkC,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG,CAAC;AAClG,WAAO,MAAM,SAAS,EAAE,QAAQ,MAAM,KAAK,UAAU;AACrD,UAAM,MAAM,KAAK,OAAO;AAAA,EACzB;AACD;"}