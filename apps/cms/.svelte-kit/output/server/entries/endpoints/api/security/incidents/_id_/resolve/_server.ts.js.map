{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../../../src/routes/api/security/incidents/[id]/resolve/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/security/incidents/[id]/resolve/+server.ts\n * @description Individual incident resolution endpoint\n */\n\nimport { json, type RequestHandler } from '@sveltejs/kit';\nimport { securityResponseService } from '@shared/services/SecurityResponseService';\nimport { hasApiPermission } from '@shared/database/auth/apiPermissions';\nimport { logger } from '@shared/utils/logger.server';\n\n/**\n * POST /api/security/incidents/[id]/resolve\n * Resolve a specific security incident.\n */\nexport const POST: RequestHandler = async ({ locals, params, request }) => {\n\ttry {\n\t\t// Authorization check - admin only\n\t\tif (!locals.user || !hasApiPermission(locals.user.role, 'security')) {\n\t\t\treturn json({ error: 'Unauthorized - Admin access required' }, { status: 403 });\n\t\t}\n\n\t\tconst incidentId = params.id;\n\t\tif (!incidentId) {\n\t\t\treturn json({ error: 'Incident ID is required' }, { status: 400 });\n\t\t}\n\n\t\tconst body = await request.json().catch(() => ({}));\n\t\tconst notes = body.notes || `Resolved by ${locals.user.email || locals.user._id}`;\n\n\t\t// Resolve the incident\n\t\tconst success = securityResponseService.resolveIncident(incidentId, notes);\n\n\t\tif (!success) {\n\t\t\treturn json({ error: 'Incident not found or already resolved' }, { status: 404 });\n\t\t}\n\n\t\tlogger.info('Security incident resolved', {\n\t\t\tincidentId,\n\t\t\tresolvedBy: locals.user._id,\n\t\t\tnotes\n\t\t});\n\n\t\treturn json({\n\t\t\tsuccess: true,\n\t\t\tmessage: 'Incident resolved successfully'\n\t\t});\n\t} catch (error) {\n\t\tlogger.error('Error resolving security incident:', error);\n\t\treturn json({ error: 'Internal server error' }, { status: 500 });\n\t}\n};\n"],"names":[],"mappings":";;;;AAcO,MAAM,OAAuB,OAAO,EAAE,QAAQ,QAAQ,cAAc;AAC1E,MAAI;AAEH,QAAI,CAAC,OAAO,QAAQ,CAAC,iBAAiB,OAAO,KAAK,MAAM,UAAU,GAAG;AACpE,aAAO,KAAK,EAAE,OAAO,uCAAA,GAA0C,EAAE,QAAQ,KAAK;AAAA,IAC/E;AAEA,UAAM,aAAa,OAAO;AAC1B,QAAI,CAAC,YAAY;AAChB,aAAO,KAAK,EAAE,OAAO,0BAAA,GAA6B,EAAE,QAAQ,KAAK;AAAA,IAClE;AAEA,UAAM,OAAO,MAAM,QAAQ,KAAA,EAAO,MAAM,OAAO,CAAA,EAAG;AAClD,UAAM,QAAQ,KAAK,SAAS,eAAe,OAAO,KAAK,SAAS,OAAO,KAAK,GAAG;AAG/E,UAAM,UAAU,wBAAwB,gBAAgB,YAAY,KAAK;AAEzE,QAAI,CAAC,SAAS;AACb,aAAO,KAAK,EAAE,OAAO,yCAAA,GAA4C,EAAE,QAAQ,KAAK;AAAA,IACjF;AAEA,WAAO,KAAK,8BAA8B;AAAA,MACzC;AAAA,MACA,YAAY,OAAO,KAAK;AAAA,MACxB;AAAA,IAAA,CACA;AAED,WAAO,KAAK;AAAA,MACX,SAAS;AAAA,MACT,SAAS;AAAA,IAAA,CACT;AAAA,EACF,SAAS,OAAO;AACf,WAAO,MAAM,sCAAsC,KAAK;AACxD,WAAO,KAAK,EAAE,OAAO,wBAAA,GAA2B,EAAE,QAAQ,KAAK;AAAA,EAChE;AACD;"}