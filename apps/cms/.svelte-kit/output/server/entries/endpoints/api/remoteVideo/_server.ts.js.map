{"version":3,"file":"_server.ts.js","sources":["../../../../../../../src/widgets/custom/RemoteVideo/video.server.ts","../../../../../../../src/routes/api/remoteVideo/+server.ts"],"sourcesContent":["/**\n * @file src/widgets/custom/RemoteVideo/video.ts\n * @description Centralized utility for fetching remote video metadata from various platforms.\n *\n * This module should primarily be used on the server-side to keep API keys secure.\n *\n * @features\n * - **Platform Agnostic**: Supports YouTube, Vimeo, Twitch, and TikTok.\n * - **Type-Safe Output**: Returns a unified `RemoteVideoData` object.\n * - **Caching**: Implements a simple in-memory cache to reduce redundant API calls.\n * - **Secure**: Designed for server-side execution to protect API keys.\n */\nimport { getPrivateSettingSync } from '@shared/services/settingsService'; // Assuming this is server-side access to private env vars\nimport { logger } from '@shared/utils/logger'; // Isomorphic logger (works client and server)\nimport type { RemoteVideoData, VideoPlatform } from './types';\n\n// Cached version of RemoteVideoData with internal timestamp\ninterface CachedRemoteVideoData extends RemoteVideoData {\n\t_cachedAt: number;\n}\n\n// Simple in-memory cache for API responses.\nconst cache = new Map<string, CachedRemoteVideoData>();\nconst CACHE_TTL = 15 * 60 * 1000; // Cache for 15 minutes.\n\ninterface ExternalVideoMetadata {\n\tvideoTitle: string;\n\tvideoThumbnail: string;\n\tvideoUrl: string;\n\tchannelTitle?: string;\n\tpublishedAt?: string;\n\twidth?: number;\n\theight?: number;\n\tduration?: string; // ISO 8601 duration\n\tuser_name?: string; // For Vimeo\n\tupload_date?: string; // For Vimeo\n\t_cachedAt?: number; // Internal cache timestamp\n}\n\n// Extracts a video ID from a given URL\nfunction extractVideoId(url: string): { platform: VideoPlatform; id: string } | null {\n\tconst youtubeRegex = /(?:youtube\\.com\\/(?:[^/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?/\\s]{11})/;\n\tconst vimeoRegex = /(?:vimeo\\.com\\/|player\\.vimeo\\.com\\/video\\/)(\\d+)/;\n\tconst twitchRegex = /(?:twitch\\.tv\\/videos\\/)(\\d+)/;\n\tconst tiktokRegex = /(?:tiktok\\.com\\/@(?:[a-zA-Z0-9._]+)\\/video\\/(\\d+))/;\n\n\tlet match;\n\n\tif ((match = url.match(youtubeRegex))) {\n\t\treturn { platform: 'youtube', id: match[1] };\n\t}\n\tif ((match = url.match(vimeoRegex))) {\n\t\treturn { platform: 'vimeo', id: match[1] };\n\t}\n\tif ((match = url.match(twitchRegex))) {\n\t\treturn { platform: 'twitch', id: match[1] };\n\t}\n\tif ((match = url.match(tiktokRegex))) {\n\t\treturn { platform: 'tiktok', id: match[1] };\n\t}\n\n\treturn null; // Unknown platform or invalid URL.\n}\n\n// Fetches YouTube video metadata\nasync function fetchYouTubeMetadata(videoId: string): Promise<ExternalVideoMetadata | null> {\n\tconst googleApiKey = getPrivateSettingSync('GOOGLE_API_KEY');\n\tif (!googleApiKey) {\n\t\tlogger.error('GOOGLE_API_KEY is not set for YouTube metadata fetch.');\n\t\treturn null;\n\t}\n\tconst parts = 'snippet,contentDetails';\n\tconst url = `https://www.googleapis.com/youtube/v3/videos?part=${parts}&id=${videoId}&key=${googleApiKey}`;\n\n\ttry {\n\t\tconst response = await fetch(url);\n\t\tif (!response.ok) {\n\t\t\tlogger.error(`YouTube API error: ${response.status} ${response.statusText}`);\n\t\t\treturn null;\n\t\t}\n\t\tconst data = await response.json();\n\t\tconst item = data.items?.[0];\n\n\t\tif (!item) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tvideoTitle: item.snippet.title,\n\t\t\tvideoThumbnail: item.snippet.thumbnails.high?.url || item.snippet.thumbnails.default?.url || '',\n\t\t\tvideoUrl: `https://www.youtube.com/watch?v=${videoId}`,\n\t\t\tchannelTitle: item.snippet.channelTitle,\n\t\t\tpublishedAt: item.snippet.publishedAt,\n\t\t\tduration: item.contentDetails.duration, // ISO 8601 duration\n\t\t\twidth: item.snippet.thumbnails.high?.width,\n\t\t\theight: item.snippet.thumbnails.high?.height\n\t\t};\n\t} catch (error) {\n\t\tlogger.error(`Failed to fetch YouTube metadata for ID ${videoId}:`, error);\n\t\treturn null;\n\t}\n}\n\n// Fetches Vimeo video metadata\nasync function fetchVimeoMetadata(videoId: string): Promise<ExternalVideoMetadata | null> {\n\tconst url = `https://vimeo.com/api/v2/video/${videoId}.json`;\n\ttry {\n\t\tconst response = await fetch(url);\n\t\tif (!response.ok) {\n\t\t\tlogger.error(`Vimeo API error: ${response.status} ${response.statusText}`);\n\t\t\treturn null;\n\t\t}\n\t\tconst data = await response.json();\n\t\tconst item = data?.[0];\n\n\t\tif (!item) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tvideoTitle: item.title,\n\t\t\tvideoThumbnail: item.thumbnail_large,\n\t\t\tvideoUrl: item.url,\n\t\t\tuser_name: item.user_name,\n\t\t\tupload_date: item.upload_date,\n\t\t\tduration: item.duration, // Duration in seconds\n\t\t\twidth: item.width,\n\t\t\theight: item.height\n\t\t};\n\t} catch (error) {\n\t\tlogger.error(`Failed to fetch Vimeo metadata for ID ${videoId}:`, error);\n\t\treturn null;\n\t}\n}\n\n// Fetches Twitch video metadata\nasync function fetchTwitchMetadata(videoId: string): Promise<ExternalVideoMetadata | null> {\n\tconst twitchToken = getPrivateSettingSync('TWITCH_TOKEN');\n\tconst twitchClientId = getPrivateSettingSync('TWITCH_CLIENT_ID');\n\tif (!twitchToken || !twitchClientId) {\n\t\tlogger.error('TWITCH_TOKEN or TWITCH_CLIENT_ID is not set for Twitch metadata fetch.');\n\t\treturn null;\n\t}\n\tconst url = `https://api.twitch.tv/helix/videos?id=${videoId}`;\n\ttry {\n\t\tconst response = await fetch(url, {\n\t\t\theaders: {\n\t\t\t\t'Client-ID': twitchClientId,\n\t\t\t\tAuthorization: `Bearer ${twitchToken}`\n\t\t\t}\n\t\t});\n\t\tif (!response.ok) {\n\t\t\tlogger.error(`Twitch API error: ${response.status} ${response.statusText}`);\n\t\t\treturn null;\n\t\t}\n\t\tconst data = await response.json();\n\t\tconst item = data.data?.[0];\n\n\t\tif (!item) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tvideoTitle: item.title,\n\t\t\tvideoThumbnail: item.thumbnail_url,\n\t\t\tvideoUrl: `https://www.twitch.tv/videos/${videoId}`,\n\t\t\tchannelTitle: item.user_name,\n\t\t\tduration: item.duration, // e.g., \"1h30m5s\"\n\t\t\tpublishedAt: item.created_at\n\t\t};\n\t} catch (error) {\n\t\tlogger.error(`Failed to fetch Twitch metadata for ID ${videoId}:`, error);\n\t\treturn null;\n\t}\n}\n\n/**\n * Fetches TikTok video metadata (requires scraping, which is brittle and not recommended for production).\n * A dedicated TikTok API or oEmbed endpoint would be preferred.\n */\nasync function fetchTikTokMetadata(url: string): Promise<ExternalVideoMetadata | null> {\n\tlogger.warn('TikTok metadata fetching is experimental and relies on web scraping which can be unreliable.');\n\ttry {\n\t\t// Using TikTok's oEmbed endpoint is generally more reliable than scraping.\n\t\t// Example: https://www.tiktok.com/oembed?url=https://www.tiktok.com/@scout2015/video/6718335390845095168\n\t\tconst oembedUrl = `https://www.tiktok.com/oembed?url=${encodeURIComponent(url)}`;\n\t\tconst response = await fetch(oembedUrl);\n\t\tif (!response.ok) {\n\t\t\tlogger.warn(`TikTok oEmbed API error: ${response.status} ${response.statusText}`);\n\t\t\treturn null;\n\t\t}\n\t\tconst data = await response.json();\n\t\treturn {\n\t\t\tvideoTitle: data.title || '',\n\t\t\tvideoThumbnail: data.thumbnail_url || '',\n\t\t\tvideoUrl: data.author_url || url, // oEmbed gives author URL, use original if not available.\n\t\t\tchannelTitle: data.author_name || '',\n\t\t\twidth: data.width,\n\t\t\theight: data.height\n\t\t\t// Duration and publishedAt are often not available via oEmbed for TikTok\n\t\t};\n\t} catch (error) {\n\t\tlogger.error(`Failed to fetch TikTok metadata for URL ${url}:`, error);\n\t\treturn null;\n\t}\n}\n\n/**\n * Fetches unified RemoteVideoData for a given video URL.\n * Designed for server-side execution.\n */\nexport async function getRemoteVideoData(url: string): Promise<RemoteVideoData | null> {\n\tconst parsed = extractVideoId(url);\n\tif (!parsed) {\n\t\treturn null;\n\t}\n\n\tconst cacheKey = `${parsed.platform}-${parsed.id}`;\n\tconst cached = cache.get(cacheKey);\n\tif (cached && cached._cachedAt && Date.now() - cached._cachedAt < CACHE_TTL) {\n\t\treturn cached;\n\t}\n\n\tlet metadata: ExternalVideoMetadata | null = null;\n\tswitch (parsed.platform) {\n\t\tcase 'youtube':\n\t\t\tmetadata = await fetchYouTubeMetadata(parsed.id);\n\t\t\tbreak;\n\t\tcase 'vimeo':\n\t\t\tmetadata = await fetchVimeoMetadata(parsed.id);\n\t\t\tbreak;\n\t\tcase 'twitch':\n\t\t\tmetadata = await fetchTwitchMetadata(parsed.id);\n\t\t\tbreak;\n\t\tcase 'tiktok':\n\t\t\tmetadata = await fetchTikTokMetadata(url); // TikTok needs the full URL\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn null;\n\t}\n\n\tif (!metadata) {\n\t\treturn null;\n\t}\n\n\tconst result: CachedRemoteVideoData = {\n\t\tplatform: parsed.platform,\n\t\turl: metadata.videoUrl,\n\t\tvideoId: parsed.id,\n\t\ttitle: metadata.videoTitle,\n\t\tthumbnailUrl: metadata.videoThumbnail,\n\t\tchannelTitle: metadata.channelTitle || metadata.user_name, // Handle different field names\n\t\tduration: metadata.duration,\n\t\twidth: metadata.width,\n\t\theight: metadata.height,\n\t\tpublishedAt: metadata.publishedAt,\n\t\t_cachedAt: Date.now() // Internal cache timestamp\n\t};\n\tcache.set(cacheKey, result);\n\treturn result;\n}\n\nimport { formatIsoDuration } from '@shared/utils/dateUtils';\nexport { formatIsoDuration };\n","/**\n * @file src/routes/api/remoteVideo/+server.ts\n * @description Secure, server-side API endpoint for fetching remote video metadata.\n *\n * This endpoint acts as a proxy to external video APIs (YouTube, Vimeo, etc.)\n * to protect private API keys and return a unified data structure.\n *\n * @features\n * - **Unified Data Structure**: Always returns the standard `RemoteVideoData` object.\n * - **Secure**: Keeps all API keys on the server, never exposing them to the client.\n * - **Centralized Logic**: Uses the `getRemoteVideoData` helper for all platform-specific logic.\n * - **Rule Enforcement**: Validates `allowedPlatforms` on the server-side.\n *\n * @usage\n * POST /api/remoteVideo\n * Body (JSON): { url: string, allowedPlatforms?: string[] }\n * Returns: JSON object { success: boolean, data?: RemoteVideoData, error?: string }\n */\nimport { json } from '@sveltejs/kit';\nimport { logger } from '@shared/utils/logger.server';\nimport type { RemoteVideoProps } from '@widgets/custom/RemoteVideo/types';\nimport { getRemoteVideoData } from '@widgets/custom/RemoteVideo/video.server';\n\nexport async function POST({ request }) {\n\ttry {\n\t\t// Expect a JSON body instead of FormData for cleaner data handling.\n\t\tconst { url, allowedPlatforms } = (await request.json()) as {\n\t\t\turl: string;\n\t\t\tallowedPlatforms?: RemoteVideoProps['allowedPlatforms'];\n\t\t};\n\n\t\t// Validate the incoming request body.\n\t\tif (!url || typeof url !== 'string') {\n\t\t\tlogger.warn('API /remoteVideo: Invalid or missing URL in request body.');\n\t\t\treturn json({ success: false, error: 'A valid URL is required.' }, { status: 400 });\n\t\t}\n\n\t\t// All platform-specific parsing and fetching is now handled by this single function.\n\t\tconst videoData = await getRemoteVideoData(url);\n\n\t\t// Handle cases where the URL is invalid or the platform is unsupported.\n\t\tif (!videoData) {\n\t\t\tconst errorMsg = 'Could not fetch video metadata. The URL may be invalid or the platform is unsupported.';\n\t\t\tlogger.warn(`API /remoteVideo: ${errorMsg}`, { url });\n\t\t\treturn json({ success: false, error: errorMsg }, { status: 400 });\n\t\t}\n\n\t\t// SECURITY: Enforce the `allowedPlatforms` rule on the server.\n\t\tif (allowedPlatforms && allowedPlatforms.length > 0 && !allowedPlatforms.includes(videoData.platform)) {\n\t\t\tconst errorMsg = `The platform '${videoData.platform}' is not permitted for this field.`;\n\t\t\tlogger.warn(`API /remoteVideo: Forbidden platform.`, { url, platform: videoData.platform, allowed: allowedPlatforms });\n\t\t\treturn json({ success: false, error: errorMsg }, { status: 403 }); // 403 Forbidden\n\t\t}\n\n\t\t// On success, return the unified data object.\n\t\tlogger.info(`API /remoteVideo: Successfully fetched metadata for ${videoData.platform} video.`, { url });\n\t\treturn json({ success: true, data: videoData });\n\t} catch (error) {\n\t\t// Catch any unexpected errors during processing.\n\t\tconst errorMessage = error instanceof Error ? error.message : String(error);\n\t\tlogger.error('API /remoteVideo critical error:', { error: errorMessage });\n\t\treturn json({ success: false, error: 'An internal server error occurred.' }, { status: 500 });\n\t}\n}\n"],"names":["logger"],"mappings":"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"}