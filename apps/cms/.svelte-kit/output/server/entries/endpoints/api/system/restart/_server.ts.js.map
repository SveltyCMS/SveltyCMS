{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/system/restart/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/system/restart/+server.ts\n * @description API endpoint to initiate a server restart.\n * This endpoint is protected and can only be accessed by admin users.\n * It works by creating a `restart.txt` file, which can be watched by a process manager like pm2.\n */\n\nimport { json, error } from '@sveltejs/kit';\nimport { setRestartNeeded } from '@shared/utils/server/restartRequired';\nimport { promises as fs } from 'fs';\nimport path from 'path';\n\nexport const POST = async ({ locals }) => {\n\tif (!locals.user || locals.user.role !== 'admin') {\n\t\tthrow error(403, 'Insufficient permissions');\n\t}\n\n\ttry {\n\t\t// Touch a file to signal a restart to a process manager like pm2\n\t\tawait fs.writeFile(path.join(process.cwd(), 'restart.txt'), new Date().toISOString());\n\n\t\t// Reset the restart needed flag\n\t\tsetRestartNeeded(false);\n\n\t\treturn json({ success: true, message: 'Server restart initiated.' });\n\t} catch {\n\t\treturn json({ success: false, error: 'Failed to initiate restart.' }, { status: 500 });\n\t}\n};\n"],"names":["fs"],"mappings":";;;;AAYO,MAAM,OAAO,OAAO,EAAE,aAAa;AACzC,MAAI,CAAC,OAAO,QAAQ,OAAO,KAAK,SAAS,SAAS;AACjD,UAAM,MAAM,KAAK,0BAA0B;AAAA,EAC5C;AAEA,MAAI;AAEH,UAAMA,SAAG,UAAU,KAAK,KAAK,QAAQ,OAAO,aAAa,IAAG,oBAAI,KAAA,GAAO,aAAa;AAGpF,qBAAiB,KAAK;AAEtB,WAAO,KAAK,EAAE,SAAS,MAAM,SAAS,6BAA6B;AAAA,EACpE,QAAQ;AACP,WAAO,KAAK,EAAE,SAAS,OAAO,OAAO,iCAAiC,EAAE,QAAQ,KAAK;AAAA,EACtF;AACD;"}