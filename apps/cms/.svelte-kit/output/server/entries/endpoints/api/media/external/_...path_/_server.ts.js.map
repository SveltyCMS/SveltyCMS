{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../../src/routes/api/media/external/[...path]/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/media/external/[...path]/+server.ts\n * @description API endpoint for processing media with external editors.\n *\n * This endpoint provides a generic interface to connect with various external\n * media processing services like Cloudinary, Imgix, or custom processors.\n *\n * ## POST /api/media/external/process\n *\n * ### Request Body\n * ```json\n * {\n *   \"mediaId\": \"...\",\n *   \"service\": \"cloudinary\",\n *   \"parameters\": {\n *     \"transformation\": \"e_grayscale\",\n *     \"crop\": \"fill\",\n *     \"width\": 800,\n *     \"height\": 600\n *   }\n * }\n * ```\n *\n * ### How it Works\n * 1.  The endpoint receives a request with the original media ID and service-specific parameters.\n * 2.  It identifies the appropriate service adapter (e.g., `cloudinaryAdapter`).\n * 3.  The adapter constructs and sends a request to the external service's API.\n * 4.  It receives the processed image (or a URL to it).\n * 5.  It saves this new image back into SveltyCMS as a \"variant,\" linking it to the original\n *     image via an `originalId` field.\n * 6.  It returns the new SveltyCMS media object to the client.\n */\n\nimport { json } from '@sveltejs/kit';\nimport { logger } from '@shared/utils/logger.server';\nimport type { RequestHandler } from './$types';\n\nexport const POST: RequestHandler = async ({ request }) => {\n\ttry {\n\t\tconst body = await request.json();\n\t\tconst { mediaId, service, parameters } = body;\n\n\t\tif (!mediaId || !service || !parameters) {\n\t\t\treturn json(\n\t\t\t\t{\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: 'Missing required fields: mediaId, service, and parameters.'\n\t\t\t\t},\n\t\t\t\t{ status: 400 }\n\t\t\t);\n\t\t}\n\n\t\tlogger.info(`Received external processing request for mediaId: ${mediaId} via service: ${service}`, {\n\t\t\tparameters\n\t\t});\n\n\t\t// -----------------------------------------------------------------\n\t\t// TODO: Implement the adapter pattern here\n\t\t//\n\t\t// switch (service) {\n\t\t//   case 'cloudinary':\n\t\t//     const cloudinaryAdapter = new CloudinaryAdapter();\n\t\t//     const newMediaItem = await cloudinaryAdapter.process(mediaId, parameters);\n\t\t//     return json({ success: true, data: newMediaItem });\n\t\t//\n\t\t//   case 'my-custom-processor':\n\t\t//     // ... call custom processor\n\t\t//\n\t\t//   default:\n\t\t//     return json({ success: false, error: `Unknown service: ${service}` }, { status: 400 });\n\t\t// }\n\t\t// -----------------------------------------------------------------\n\n\t\t// For now, return a placeholder success response\n\t\treturn json({\n\t\t\tsuccess: true,\n\t\t\tmessage: `Placeholder response: Successfully received request for service '${service}'.`,\n\t\t\tdata: {\n\t\t\t\toriginalMediaId: mediaId,\n\t\t\t\tservice,\n\t\t\t\tprocessedParameters: parameters,\n\t\t\t\tnewMediaId: `variant_${crypto.randomUUID()}` // Example new ID\n\t\t\t}\n\t\t});\n\t} catch (e) {\n\t\tlogger.error('Error in external media processing endpoint:', e);\n\t\treturn json({ success: false, error: 'An unexpected error occurred.' }, { status: 500 });\n\t}\n};\n"],"names":[],"mappings":";;AAqCO,MAAM,OAAuB,OAAO,EAAE,cAAc;AAC1D,MAAI;AACH,UAAM,OAAO,MAAM,QAAQ,KAAA;AAC3B,UAAM,EAAE,SAAS,SAAS,WAAA,IAAe;AAEzC,QAAI,CAAC,WAAW,CAAC,WAAW,CAAC,YAAY;AACxC,aAAO;AAAA,QACN;AAAA,UACC,SAAS;AAAA,UACT,OAAO;AAAA,QAAA;AAAA,QAER,EAAE,QAAQ,IAAA;AAAA,MAAI;AAAA,IAEhB;AAEA,WAAO,KAAK,qDAAqD,OAAO,iBAAiB,OAAO,IAAI;AAAA,MACnG;AAAA,IAAA,CACA;AAoBD,WAAO,KAAK;AAAA,MACX,SAAS;AAAA,MACT,SAAS,oEAAoE,OAAO;AAAA,MACpF,MAAM;AAAA,QACL,iBAAiB;AAAA,QACjB;AAAA,QACA,qBAAqB;AAAA,QACrB,YAAY,WAAW,OAAO,WAAA,CAAY;AAAA;AAAA,MAAA;AAAA,IAC3C,CACA;AAAA,EACF,SAAS,GAAG;AACX,WAAO,MAAM,gDAAgD,CAAC;AAC9D,WAAO,KAAK,EAAE,SAAS,OAAO,OAAO,mCAAmC,EAAE,QAAQ,KAAK;AAAA,EACxF;AACD;"}