{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../../src/routes/api/media/[id]/focal/+server.ts"],"sourcesContent":["/**\n * @file src/routes/api/media/[id]/focal/+server.ts\n * @description Quick focal point update API endpoint\n *\n * @example PATCH /api/media/abc123/focal\n * Body: { x: 60, y: 30 }\n *\n * @features\n * - Updates only metadata.focalPoint without touching the file\n * - Validates x and y are within 0-100 range\n * - Uses the existing media API for metadata updates\n * - Returns the updated focal point\n */\n\nimport { json, error } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\nimport { logger } from '@shared/utils/logger.server';\n\nexport const PATCH: RequestHandler = async ({ params, request, locals, fetch }) => {\n\tconst { user } = locals;\n\tif (!user) {\n\t\tthrow error(401, 'Unauthorized');\n\t}\n\n\tconst { id } = params;\n\tif (!id) {\n\t\tthrow error(400, 'Media ID is required');\n\t}\n\n\ttry {\n\t\tconst body = await request.json();\n\t\tconst { x, y } = body;\n\n\t\t// Validate coordinates\n\t\tif (typeof x !== 'number' || typeof y !== 'number') {\n\t\t\tthrow error(400, 'x and y must be numbers');\n\t\t}\n\t\tif (x < 0 || x > 100 || y < 0 || y > 100) {\n\t\t\tthrow error(400, 'x and y must be between 0 and 100');\n\t\t}\n\n\t\t// Use the existing media metadata update API\n\t\tconst response = await fetch(`/api/media/${encodeURIComponent(id)}`, {\n\t\t\tmethod: 'PATCH',\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\tbody: JSON.stringify({\n\t\t\t\tmetadata: {\n\t\t\t\t\tfocalPoint: { x, y }\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tconst errorText = await response.text();\n\t\t\tlogger.error('Failed to update focal point via media API', {\n\t\t\t\tmediaId: id,\n\t\t\t\tstatus: response.status,\n\t\t\t\terror: errorText\n\t\t\t});\n\t\t\tthrow error(response.status, errorText || 'Failed to update focal point');\n\t\t}\n\n\t\tlogger.info('Focal point updated', {\n\t\t\tmediaId: id,\n\t\t\tfocalPoint: { x, y },\n\t\t\tuserId: user._id.toString()\n\t\t});\n\n\t\treturn json({\n\t\t\tsuccess: true,\n\t\t\tdata: { focalPoint: { x, y } }\n\t\t});\n\t} catch (err) {\n\t\tif ((err as any).status) throw err;\n\t\tlogger.error('Error updating focal point', { error: err, mediaId: id });\n\t\tthrow error(500, 'Internal server error');\n\t}\n};\n"],"names":[],"mappings":";;AAkBO,MAAM,QAAwB,OAAO,EAAE,QAAQ,SAAS,QAAQ,YAAY;AAClF,QAAM,EAAE,SAAS;AACjB,MAAI,CAAC,MAAM;AACV,UAAM,MAAM,KAAK,cAAc;AAAA,EAChC;AAEA,QAAM,EAAE,OAAO;AACf,MAAI,CAAC,IAAI;AACR,UAAM,MAAM,KAAK,sBAAsB;AAAA,EACxC;AAEA,MAAI;AACH,UAAM,OAAO,MAAM,QAAQ,KAAA;AAC3B,UAAM,EAAE,GAAG,EAAA,IAAM;AAGjB,QAAI,OAAO,MAAM,YAAY,OAAO,MAAM,UAAU;AACnD,YAAM,MAAM,KAAK,yBAAyB;AAAA,IAC3C;AACA,QAAI,IAAI,KAAK,IAAI,OAAO,IAAI,KAAK,IAAI,KAAK;AACzC,YAAM,MAAM,KAAK,mCAAmC;AAAA,IACrD;AAGA,UAAM,WAAW,MAAM,MAAM,cAAc,mBAAmB,EAAE,CAAC,IAAI;AAAA,MACpE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAA;AAAA,MAC3B,MAAM,KAAK,UAAU;AAAA,QACpB,UAAU;AAAA,UACT,YAAY,EAAE,GAAG,EAAA;AAAA,QAAE;AAAA,MACpB,CACA;AAAA,IAAA,CACD;AAED,QAAI,CAAC,SAAS,IAAI;AACjB,YAAM,YAAY,MAAM,SAAS,KAAA;AACjC,aAAO,MAAM,8CAA8C;AAAA,QAC1D,SAAS;AAAA,QACT,QAAQ,SAAS;AAAA,QACjB,OAAO;AAAA,MAAA,CACP;AACD,YAAM,MAAM,SAAS,QAAQ,aAAa,8BAA8B;AAAA,IACzE;AAEA,WAAO,KAAK,uBAAuB;AAAA,MAClC,SAAS;AAAA,MACT,YAAY,EAAE,GAAG,EAAA;AAAA,MACjB,QAAQ,KAAK,IAAI,SAAA;AAAA,IAAS,CAC1B;AAED,WAAO,KAAK;AAAA,MACX,SAAS;AAAA,MACT,MAAM,EAAE,YAAY,EAAE,GAAG,IAAE;AAAA,IAAE,CAC7B;AAAA,EACF,SAAS,KAAK;AACb,QAAK,IAAY,OAAQ,OAAM;AAC/B,WAAO,MAAM,8BAA8B,EAAE,OAAO,KAAK,SAAS,IAAI;AACtE,UAAM,MAAM,KAAK,uBAAuB;AAAA,EACzC;AACD;"}