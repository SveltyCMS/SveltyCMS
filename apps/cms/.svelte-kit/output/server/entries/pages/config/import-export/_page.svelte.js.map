{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../../shared/components/src/admin/ImportExportManager.svelte","../../../../../../../src/routes/config/import-export/+page.svelte"],"sourcesContent":["<!--\n@file src/components/admin/ImportExportManager.svelte\n@description Import/Export Manager Component for Admin Dashboard\n\n### Features:\n- Export all collections data or individual collections\n- Import data with validation and error reporting\n- Support for JSON and CSV formats\n- Progress tracking and detailed results\n- File upload and download handling\n-->\n\n<script lang=\"ts\">\n\t// Components\n\timport Input from '@cms/components/system/inputs/Input.svelte';\n\timport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\timport ProgressBar from '@cms/components/system/ProgressBar.svelte';\n\t// Skeleton components\n\timport { showToast } from '@shared/utils/toast';\n\n\t// Utils\n\timport { getCollections } from '@shared/utils/apiClient';\n\timport { logger } from '@shared/utils/logger';\n\n\t// Types\n\timport type { Schema } from '@cms-types/content';\n\n\tinterface ExportOptions {\n\t\tformat: 'json' | 'csv';\n\t\tcollections: string[];\n\t\tincludeMetadata: boolean;\n\t\tlimit?: number;\n\t}\n\n\tinterface ImportOptions {\n\t\tformat: 'json' | 'csv';\n\t\toverwrite: boolean;\n\t\tvalidate: boolean;\n\t\tskipInvalid: boolean;\n\t\tbatchSize: number;\n\t}\n\n\tinterface ImportResult {\n\t\tsuccess: boolean;\n\t\tmessage: string;\n\t\ttotalImported: number;\n\t\ttotalSkipped: number;\n\t\ttotalErrors: number;\n\t\tresults: Array<any>;\n\t}\n\n\t// --- State using Svelte 5 Runes ---\n\tlet collections = $state<Partial<Schema>[]>([]);\n\tlet loading = $state(false);\n\tlet showExportModal = $state(false);\n\tlet showImportModal = $state(false);\n\tlet showResultsModal = $state(false);\n\n\t// Export state\n\tconst exportOptions = $state<ExportOptions>({\n\t\tformat: 'json',\n\t\tcollections: [],\n\t\tincludeMetadata: true,\n\t\tlimit: undefined\n\t});\n\tlet exportProgress = $state(0);\n\tlet exportUrl = $state('');\n\tlet exportLimitString = $state('');\n\n\t// Import state\n\tconst importOptions = $state<ImportOptions>({\n\t\tformat: 'json',\n\t\toverwrite: false,\n\t\tvalidate: true,\n\t\tskipInvalid: true,\n\t\tbatchSize: 100\n\t});\n\tlet importFiles = $state<FileList | null>(null);\n\tlet importProgress = $state(0);\n\tlet importResult = $state<ImportResult | null>(null);\n\tlet importBatchSizeString = $state('100');\n\n\t// Sync string and number values\n\t$effect(() => {\n\t\tconst limitNum = parseInt(exportLimitString, 10);\n\t\texportOptions.limit = isNaN(limitNum) ? undefined : limitNum;\n\t});\n\n\t$effect(() => {\n\t\tconst batchSizeNum = parseInt(importBatchSizeString, 10);\n\t\timportOptions.batchSize = isNaN(batchSizeNum) ? 100 : batchSizeNum;\n\t});\n\n\t// --- Data Loading ---\n\tloadCollections();\n\n\tasync function loadCollections() {\n\t\ttry {\n\t\t\tloading = true;\n\t\t\tconst response = await getCollections({ includeFields: false });\n\n\t\t\tif (response.success && response.data) {\n\t\t\t\t// Handle different response structures and map to our Collection interface\n\t\t\t\tlet rawCollections: any[] = [];\n\t\t\t\tif (Array.isArray(response.data)) {\n\t\t\t\t\trawCollections = response.data;\n\t\t\t\t} else if (response.data && typeof response.data === 'object' && 'collections' in response.data) {\n\t\t\t\t\trawCollections = (response.data as any).collections || [];\n\t\t\t\t}\n\n\t\t\t\t// Map to our Collection interface\n\t\t\t\tcollections = rawCollections.map((col) => ({\n\t\t\t\t\tid: col.id || col.name,\n\t\t\t\t\tname: col.name,\n\t\t\t\t\tlabel: col.label || col.name,\n\t\t\t\t\tdescription: col.description\n\t\t\t\t}));\n\n\t\t\t\t// Select all collections by default\n\t\t\t\texportOptions.collections = collections.map((c) => String(c.id));\n\t\t\t} else {\n\t\t\t\tshowAlertMessage('Failed to load collections', 'error');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error('Error loading collections:', error);\n\t\t\tshowAlertMessage('Error loading collections', 'error');\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\t// --- Export Functions ---\n\tasync function exportAllData() {\n\t\ttry {\n\t\t\tloading = true;\n\t\t\texportProgress = 0;\n\n\t\t\tconst progressInterval = setInterval(() => {\n\t\t\t\texportProgress = Math.min(exportProgress + 10, 90);\n\t\t\t}, 200);\n\n\t\t\tconst response = await fetch('/api/exportData', {\n\t\t\t\tmethod: 'GET'\n\t\t\t});\n\n\t\t\tclearInterval(progressInterval);\n\t\t\texportProgress = 100;\n\n\t\t\tif (response.ok) {\n\t\t\t\tshowAlertMessage('Data export completed successfully', 'success');\n\t\t\t} else {\n\t\t\t\tconst error = await response.text();\n\t\t\t\tshowAlertMessage(`Export failed: ${error}`, 'error');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error('Export error:', error);\n\t\t\tshowAlertMessage('Export failed', 'error');\n\t\t} finally {\n\t\t\tloading = false;\n\t\t\texportProgress = 0;\n\t\t}\n\t}\n\n\tasync function exportSelectedCollections() {\n\t\tif (exportOptions.collections.length === 0) {\n\t\t\tshowAlertMessage('Please select at least one collection to export', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tloading = true;\n\t\t\texportProgress = 0;\n\n\t\t\tconst progressInterval = setInterval(() => {\n\t\t\t\texportProgress = Math.min(exportProgress + 10, 90);\n\t\t\t}, 100);\n\n\t\t\t// Export each collection individually\n\t\t\tconst exportData: Record<string, any> = {};\n\n\t\t\tfor (let i = 0; i < exportOptions.collections.length; i++) {\n\t\t\t\tconst collectionId = exportOptions.collections[i];\n\n\t\t\t\tconst params = new URLSearchParams({\n\t\t\t\t\tformat: 'json',\n\t\t\t\t\t...(exportOptions.limit && { limit: exportOptions.limit.toString() })\n\t\t\t\t});\n\n\t\t\t\tconst response = await fetch(`/api/collections/${collectionId}/export?${params}`);\n\n\t\t\t\tif (response.ok) {\n\t\t\t\t\tconst data = await response.json();\n\t\t\t\t\texportData[collectionId] = data.data;\n\t\t\t\t} else {\n\t\t\t\t\tlogger.error(`Failed to export collection ${collectionId}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclearInterval(progressInterval);\n\t\t\texportProgress = 100;\n\n\t\t\t// Create download\n\t\t\tconst blob = new Blob([JSON.stringify(exportData, null, 2)], {\n\t\t\t\ttype: 'application/json'\n\t\t\t});\n\t\t\texportUrl = URL.createObjectURL(blob);\n\n\t\t\tshowAlertMessage(`Successfully exported ${exportOptions.collections.length} collections`, 'success');\n\t\t} catch (error) {\n\t\t\tlogger.error('Export error:', error);\n\t\t\tshowAlertMessage('Export failed', 'error');\n\t\t} finally {\n\t\t\tloading = false;\n\t\t\texportProgress = 0;\n\t\t\tshowExportModal = false;\n\t\t}\n\t}\n\n\t// --- Import Functions ---\n\tasync function handleImport() {\n\t\tif (!importFiles || importFiles.length === 0) {\n\t\t\tshowAlertMessage('Please select a file to import', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tloading = true;\n\t\t\timportProgress = 0;\n\n\t\t\tconst file = importFiles[0];\n\t\t\tlet importData;\n\n\t\t\t// Read file content\n\t\t\tif (importOptions.format === 'json') {\n\t\t\t\tconst text = await file.text();\n\t\t\t\timportData = JSON.parse(text);\n\t\t\t} else {\n\t\t\t\t// CSV format\n\t\t\t\tconst text = await file.text();\n\t\t\t\timportData = text;\n\t\t\t}\n\n\t\t\tconst progressInterval = setInterval(() => {\n\t\t\t\timportProgress = Math.min(importProgress + 5, 90);\n\t\t\t}, 200);\n\n\t\t\t// Import data\n\t\t\tconst response = await fetch('/api/importData', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tcollections: importData,\n\t\t\t\t\toptions: importOptions\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tclearInterval(progressInterval);\n\t\t\timportProgress = 100;\n\n\t\t\tif (response.ok) {\n\t\t\t\timportResult = await response.json();\n\t\t\t\tshowResultsModal = true;\n\t\t\t\tshowImportModal = false;\n\t\t\t} else {\n\t\t\t\tconst errorText = await response.text();\n\t\t\t\tshowAlertMessage(`Import failed: ${errorText}`, 'error');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error('Import error:', error);\n\t\t\tshowAlertMessage('Import failed', 'error');\n\t\t} finally {\n\t\t\tloading = false;\n\t\t\timportProgress = 0;\n\t\t}\n\t}\n\n\t// --- UI & Utility Functions ---\n\n\tfunction showAlertMessage(message: string, type: 'success' | 'error' | 'info' | 'warning') {\n\t\tshowToast(message, type, 5000);\n\t}\n\n\tfunction downloadExport() {\n\t\tif (exportUrl) {\n\t\t\tconst a = document.createElement('a');\n\t\t\ta.href = exportUrl;\n\t\t\ta.download = `collections-export-${new Date().toISOString().split('T')[0]}.json`;\n\t\t\tdocument.body.appendChild(a);\n\t\t\ta.click();\n\t\t\tdocument.body.removeChild(a);\n\t\t\tURL.revokeObjectURL(exportUrl);\n\t\t\texportUrl = '';\n\t\t}\n\t}\n\n\tfunction toggleCollectionSelection(collectionId: string) {\n\t\tconst index = exportOptions.collections.indexOf(collectionId);\n\t\tif (index > -1) {\n\t\t\texportOptions.collections.splice(index, 1);\n\t\t} else {\n\t\t\texportOptions.collections.push(collectionId);\n\t\t}\n\t}\n\n\tfunction selectAllCollections() {\n\t\texportOptions.collections = collections.map((c) => String(c.id));\n\t}\n\n\tfunction clearCollectionSelection() {\n\t\texportOptions.collections = [];\n\t}\n</script>\n\n<div class=\"import-export-manager\">\n\t<div class=\"mb-6 flex items-center justify-between\">\n\t\t<div>\n\t\t\t<h2 class=\"text-2xl font-bold text-gray-900 dark:text-white\">Data Import & Export</h2>\n\t\t\t<p class=\"mt-1 text-gray-600 dark:text-gray-400\">Backup and restore your collection data</p>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3\">\n\t\t\t<button onclick={() => (showExportModal = true)} class=\"preset-outlined-secondary-500 btn\" disabled={loading}>\n\t\t\t\t<iconify-icon icon=\"mdi:export\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\tExport Data\n\t\t\t</button>\n\n\t\t\t<button onclick={() => (showImportModal = true)} class=\"preset-outlined-primary-500 btn\" disabled={loading}>\n\t\t\t\t<iconify-icon icon=\"mdi:import\" width=\"24\" class=\"\"></iconify-icon>\n\n\t\t\t\tImport Data\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\n\t<div class=\"mb-8 grid grid-cols-1 gap-6 md:grid-cols-2\">\n\t\t<div class=\"rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800\">\n\t\t\t<div class=\"mb-4 flex items-center\">\n\t\t\t\t<div class=\"preset-filled-tertiary-500 btn-icon mr-3\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:database-export\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<h3 class=\"font-semibold text-gray-900 dark:text-white\">Export All Data</h3>\n\t\t\t\t\t<p class=\"text-sm text-gray-600 dark:text-gray-400\">Export all collections to file</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<button onclick={exportAllData} disabled={loading} class=\"preset-outline-secondary-500 btn mt-4 w-full\">Export Everything</button>\n\t\t</div>\n\n\t\t<div class=\"rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800\">\n\t\t\t<div class=\"mb-4 flex items-center\">\n\t\t\t\t<div class=\"preset-filled-primary-500 btn-icon mr-3\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:folder-multiple\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<h3 class=\"font-semibold text-gray-900 dark:text-white\">Collections</h3>\n\t\t\t\t\t<p class=\"text-sm text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t\t<span class=\"font-semibold text-tertiary-500 dark:text-primary-500\">{collections.length}</span> collections available\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"space-y-2\">\n\t\t\t\t{#each collections.slice(0, 3) as collection (collection.id)}\n\t\t\t\t\t<div class=\"flex items-center justify-between text-sm\">\n\t\t\t\t\t\t<span class=\"text-tertiary-500 dark:text-primary-500\">{collection.label}</span>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:chevron-right\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t\t{#if collections.length > 3}\n\t\t\t\t\t<p class=\"text-xs text-surface-300\">...and {collections.length - 3} more</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if loading && (exportProgress > 0 || importProgress > 0)}\n\t\t<div class=\"mb-6\">\n\t\t\t<ProgressBar value={exportProgress || importProgress} label={exportProgress > 0 ? 'Exporting...' : 'Importing...'} />\n\t\t</div>\n\t{/if}\n\n\t{#if exportUrl}\n\t\t<div class=\"mb-6\">\n\t\t\t<div class=\"alert preset-filled-success-500\">\n\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t<span>Export completed successfully!</span>\n\t\t\t\t\t<button onclick={downloadExport}>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:download\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\t\t\tDownload\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n\n{#if showExportModal}\n\t<div class=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\n\t\t<div class=\"max-h-[80vh] w-full max-w-2xl overflow-hidden rounded-lg bg-surface-50 shadow-xl dark:bg-surface-800\">\n\t\t\t<div class=\"flex items-center justify-between border-b p-6\">\n\t\t\t\t<h3 class=\"text-lg font-semibold\">Export Collections</h3>\n\t\t\t\t<button onclick={() => (showExportModal = false)} class=\"preset-outlined-surface-500 btn-icon\" aria-label=\"Close export modal\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:close\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"max-h-[calc(80vh-140px)] space-y-6 overflow-y-auto p-6\">\n\t\t\t\t<div>\n\t\t\t\t\t<label for=\"export-format\" class=\"mb-2 block text-sm font-medium\">Export Format</label>\n\t\t\t\t\t<select id=\"export-format\" class=\"select\" bind:value={exportOptions.format}>\n\t\t\t\t\t\t<option value=\"json\">JSON</option>\n\t\t\t\t\t\t<option value=\"csv\">CSV</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"mb-3 flex items-center justify-between\">\n\t\t\t\t\t\t<p class=\"block text-sm font-medium\">Select Collections</p>\n\t\t\t\t\t\t<div class=\"space-x-2\">\n\t\t\t\t\t\t\t<button onclick={selectAllCollections} class=\"preset-outlined-secondary-500 btn\">Select All</button>\n\t\t\t\t\t\t\t<button onclick={clearCollectionSelection} class=\"preset-outlined-secondary-500 btn\">Clear All</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"max-h-48 overflow-y-auto rounded-md border border-gray-200 p-3 dark:border-gray-700\">\n\t\t\t\t\t\t{#each collections as collection (collection.id)}\n\t\t\t\t\t\t\t{@const inputId = `export-collection-${collection.id}`}\n\t\t\t\t\t\t\t<label for={inputId} class=\"flex cursor-pointer items-center space-x-3 py-2\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid={inputId}\n\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\tchecked={exportOptions.collections.includes(String(collection.id))}\n\t\t\t\t\t\t\t\t\tonchange={() => toggleCollectionSelection(String(collection.id))}\n\t\t\t\t\t\t\t\t\tclass=\"rounded\"\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div class=\"font-medium\">\n\t\t\t\t\t\t\t\t\t{collection.label}\n\n\t\t\t\t\t\t\t\t\t{#if collection.description}\n\t\t\t\t\t\t\t\t\t\t<span class=\"ml-2 text-sm text-gray-500\">{collection.description}</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t<Toggles bind:value={exportOptions.includeMetadata} label=\"Include Metadata\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"export-limit\" class=\"mb-2 block text-sm font-medium\">Limit (optional)</label>\n\t\t\t\t\t\t<Input type=\"text\" bind:value={exportLimitString} placeholder=\"Leave empty for all records\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex justify-end space-x-3 border-t bg-surface-100 p-6 dark:bg-surface-700\">\n\t\t\t\t<button onclick={() => (showExportModal = false)} class=\"preset-outlined-secondary-500 btn\">Cancel</button>\n\t\t\t\t<button\n\t\t\t\t\tonclick={exportSelectedCollections}\n\t\t\t\t\tclass=\"preset-filled-primary-500 btn\"\n\t\t\t\t\tdisabled={loading || exportOptions.collections.length === 0}\n\t\t\t\t>\n\t\t\t\t\tExport Selected\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n{#if showImportModal}\n\t<div class=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\n\t\t<div class=\"max-h-[80vh] w-full max-w-2xl overflow-hidden rounded-lg bg-surface-50 shadow-xl dark:bg-surface-800\">\n\t\t\t<div class=\"flex items-center justify-between border-b p-6\">\n\t\t\t\t<h3 class=\"text-lg font-semibold\">Import Collections</h3>\n\t\t\t\t<button onclick={() => (showImportModal = false)} class=\"preset-outlined-surface-500 btn-icon\" aria-label=\"Close import modal\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:close\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"max-h-[calc(80vh-140px)] space-y-6 overflow-y-auto p-6\">\n\t\t\t\t<div>\n\t\t\t\t\t<label for=\"import-file\" class=\"mb-2 block text-sm font-medium\">Select File</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"import-file\"\n\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\tbind:files={importFiles}\n\t\t\t\t\t\taccept=\".json,.csv\"\n\t\t\t\t\t\tclass=\"block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-blue-50 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-blue-700 hover:file:bg-blue-100\"\n\t\t\t\t\t/>\n\t\t\t\t\t<p class=\"mt-1 text-xs text-gray-500\">Supported formats: JSON, CSV</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<label for=\"import-format\" class=\"mb-2 block text-sm font-medium\">Data Format</label>\n\t\t\t\t\t<select id=\"import-format\" class=\"select\" bind:value={importOptions.format}>\n\t\t\t\t\t\t<option value=\"json\">JSON</option>\n\t\t\t\t\t\t<option value=\"csv\">CSV</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t<Toggles bind:value={importOptions.overwrite} label=\"Overwrite Existing\" />\n\t\t\t\t\t<Toggles bind:value={importOptions.validate} label=\"Validate Data\" />\n\t\t\t\t\t<Toggles bind:value={importOptions.skipInvalid} label=\"Skip Invalid Entries\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for=\"import-batch-size\" class=\"mb-2 block text-sm font-medium\">Batch Size</label>\n\t\t\t\t\t\t<Input type=\"text\" bind:value={importBatchSizeString} placeholder=\"100\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex justify-end space-x-3 border-t bg-surface-100 p-6 dark:bg-surface-700\">\n\t\t\t\t<button onclick={() => (showImportModal = false)} class=\"preset-outlined-secondary-500 btn\">Cancel</button>\n\t\t\t\t<button onclick={handleImport} class=\"preset-filled-primary-500 btn\" disabled={loading || !importFiles}>Import Data</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n{#if showResultsModal && importResult}\n\t<div class=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\n\t\t<div class=\"max-h-[80vh] w-full max-w-4xl overflow-hidden rounded-lg bg-surface-50 shadow-xl dark:bg-surface-800\">\n\t\t\t<div class=\"flex items-center justify-between border-b p-6\">\n\t\t\t\t<h3 class=\"text-lg font-semibold\">Import Results</h3>\n\t\t\t\t<button onclick={() => (showResultsModal = false)} class=\"preset-outlined-surface-500 btn-sm\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:close\" width=\"24\" class=\"\"></iconify-icon>\n\t\t\t\t\tmdi:close\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"max-h-[calc(80vh-140px)] overflow-y-auto p-6\">\n\t\t\t\t<div class=\"space-y-6\">\n\t\t\t\t\t<div class=\"rounded-lg bg-gray-50 p-4 dark:bg-gray-800\">\n\t\t\t\t\t\t<h3 class=\"mb-3 font-semibold\">Import Summary</h3>\n\t\t\t\t\t\t<div class=\"grid grid-cols-3 gap-4 text-center\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"text-2xl font-bold text-primary-500\">{importResult.totalImported}</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-600\">Imported</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"text-waring-500 text-2xl font-bold\">{importResult.totalSkipped}</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-600\">Skipped</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"text-2xl font-bold text-error-500\">{importResult.totalErrors}</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-600\">Errors</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h3 class=\"mb-3 font-semibold\">Collection Details</h3>\n\t\t\t\t\t\t<div class=\"max-h-64 space-y-3 overflow-y-auto\">\n\t\t\t\t\t\t\t{#each importResult.results as result (result.collection)}\n\t\t\t\t\t\t\t\t<div class=\"rounded-lg border border-gray-200 p-3 dark:border-gray-700\">\n\t\t\t\t\t\t\t\t\t<div class=\"mb-2 flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<h4 class=\"font-medium\">{result.collection}</h4>\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex space-x-4 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-primary-500\">+{result.imported}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-waring-500\">~{result.skipped}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-error-500\">!{result.errors.length}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{#if result.errors.length > 0}\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t<details>\n\t\t\t\t\t\t\t\t\t\t\t\t<summary class=\"cursor-pointer text-red-600\">{result.errors.length} errors</summary>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-2 space-y-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#each result.errors.slice(0, 5) as error (error.index)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-600\">Line {error.index + 1}: {error.error}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if result.errors.length > 5}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...and {result.errors.length - 5} more errors\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</details>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex justify-end border-t bg-surface-100 p-6 dark:bg-surface-700\">\n\t\t\t\t<button onclick={() => (showResultsModal = false)} class=\"variant-primary\">Close</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<style>\n\t.import-export-manager {\n\t\tmax-width: 72rem;\n\t\tmargin: 0 auto;\n\t\tpadding: 1.5rem;\n\t}\n</style>\n","<!--\n@file src/routes/(app)/config/import-export/+page.svelte\n @component\n **Client-side UI for configuration import/export**\n\n### Purpose:\nProvides a simple page-level interface to call the centralized,\nprotected import/export API endpoints. All heavy lifting (auth,\nvalidation, batch processing, formats, per-collection handling)\nis handled in reusable backend APIs.\n\n### Features:\n- Displays authenticated user info (from +page.server.ts).\n- Provides a button to download/export current config via API.\n- Allows uploading a JSON file to trigger import via API.\n- Shows import results or errors in a formatted preview block.\n- Indicates loading state for both import and export actions.\n- Ensures UX safety by disabling buttons and resetting file inputs.\n-->\n\n<script lang=\"ts\">\n\t// Components\n\timport PageTitle from '@cms/components/PageTitle.svelte';\n\timport ImportExportManager from '@cms/components/admin/ImportExportManager.svelte';\n</script>\n\n<svelte:head>\n\t<title>Import & Export - SveltyCMS</title>\n\t<meta name=\"description\" content=\"Import and export your collections data for backup and migration purposes.\" />\n</svelte:head>\n\n<header class=\"mb-6\">\n\t<PageTitle name=\"Import & Export\" icon=\"mdi:database-import\" showBackButton={true} backUrl=\"/config\" />\n\n\t<div class=\"mt-4 rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20\">\n\t\t<div class=\"flex items-start space-x-3\">\n\t\t\t<iconify-icon icon=\"mdi:information\" width=\"24\" class=\"mt-1 text-tertiary-500 dark:text-primary-500\"></iconify-icon>\n\t\t\t<div>\n\t\t\t\t<p class=\"mb-2 font-semibold\">Data Management Tools:</p>\n\t\t\t\t<ul class=\"list-none space-y-1 text-sm\">\n\t\t\t\t\t<li class=\"flex\">\n\t\t\t\t\t\t<span class=\"w-24 font-semibold text-tertiary-500 dark:text-primary-500\">Export:</span>\n\t\t\t\t\t\t<span>Create backups of your collections data in JSON or CSV format</span>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class=\"flex\">\n\t\t\t\t\t\t<span class=\"w-24 font-semibold text-tertiary-500 dark:text-primary-500\">Import:</span>\n\t\t\t\t\t\t<span>Restore data from previous backups or migrate from other systems</span>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class=\"flex\">\n\t\t\t\t\t\t<span class=\"w-24 font-semibold text-tertiary-500 dark:text-primary-500\">Security:</span>\n\t\t\t\t\t\t<span>All operations are performed server-side - your data never leaves your server</span>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class=\"flex\">\n\t\t\t\t\t\t<span class=\"w-24 font-semibold text-tertiary-500 dark:text-primary-500\">Validation:</span>\n\t\t\t\t\t\t<span>Import process includes data validation and error reporting</span>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</header>\n\n<!-- <div class=\"space-y-6\">\n\t<div>\n\t\t<h2 class=\"text-2xl font-bold text-gray-900 dark:text-white\">Data Import & Export</h2>\n\t\t<p class=\"mt-1 text-gray-600 dark:text-gray-400\">Backup and restore your collection data</p>\n\t</div>\n\n\t<p class=\"text-sm\">\n\t\tWelcome <span class=\"font-bold text-primary-500\">{user.username}</span>\n\t\t({user.role})\n\t</p>\n\n\t<div class=\"flex gap-3\">\n\t\t<section class=\"card p-4 md:p-6\">\n\t\t\t<h3 class=\"h3 mb-4\">Export Configuration</h3>\n\t\t\t<p class=\"mb-4 text-sm\">Download a JSON backup of all your collections and settings.</p>\n\t\t\t<button onclick={handleExport} class=\"preset-filled-primary-500 btn\" disabled={isExporting}>\n\t\t\t\t<iconify-icon icon=\"mdi:database-export\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t<span>{isExporting ? 'Exporting...' : 'Download Export'}</span>\n\t\t\t</button>\n\t\t</section>\n\n\t\t<section class=\"card p-4 md:p-6\">\n\t\t\t<h3 class=\"h3 mb-4\">Import Configuration</h3>\n\t\t\t<p class=\"mb-4 text-sm\">Restore configuration from a previously exported JSON file.</p>\n\t\t\t<input type=\"file\" accept=\"application/json\" onchange={handleImport} class=\"input-file\" disabled={isImporting} />\n\n\t\t\t{#if isImporting}\n\t\t\t\t<p class=\"mt-4 animate-pulse text-sm text-primary-500\">Importing, please wait...</p>\n\t\t\t{/if}\n\n\t\t\t{#if importResult}\n\t\t\t\t<div class=\"mt-4\">\n\t\t\t\t\t<h4 class=\"mb-2 text-sm font-bold\">Import Result:</h4>\n\t\t\t\t\t<pre class=\"card preset-tonal  max-h-64 overflow-x-auto p-4 font-mono text-xs\">{importResult}</pre>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</section>\n\t</div>\n</div> -->\n\n<!-- Import/Export Manager Component -->\n<section class=\"rounded-lg bg-surface-50 p-6 shadow-sm dark:bg-surface-800\">\n\t<ImportExportManager />\n</section>\n"],"names":["$$renderer","$.attr","$.escape","$.ensure_array_like"],"mappings":";;;;;;;wCAYA;QAwCK,cAAW,CAAA;AACX,QAAA,UAAiB;UAMf,gBAAa;AAAA,MAClB,QAAQ;AAAA,MACR,aAAW,CAAA;AAAA,MACX,iBAAiB;AAAA,MACjB,OAAO;AAAA;AA+BR,oBAAe;AAEA,mBAAA,kBAAkB;AAC5B,UAAA;AACH,kBAAU;AACJ,cAAA,WAAQ,MAAS,eAAc,EAAG,eAAe,MAAK,CAAA;AAExD,YAAA,SAAS,WAAW,SAAS,MAAM;cAElC,iBAAqB,CAAA;AACrB,cAAA,MAAM,QAAQ,SAAS,IAAI,GAAG;AACjC,6BAAiB,SAAS;AAAA,UAC3B,WAAW,SAAS,QAAI,OAAW,SAAS,SAAS,YAAY,iBAAiB,SAAS,MAAM;AAChG,6BAAkB,SAAS,KAAa,eAAW,CAAA;AAAA,UACpD;AAGA,wBAAc,eAAe,KAAK,SAAG;AAAA,YACpC,IAAI,IAAI,MAAM,IAAI;AAAA,YAClB,MAAM,IAAI;AAAA,YACV,OAAO,IAAI,SAAS,IAAI;AAAA,YACxB,aAAa,IAAI;AAAA;AAIlB,wBAAc,cAAc,YAAY,IAAG,CAAE,MAAM,OAAO,EAAE,EAAE,CAAA;AAAA,QAC/D,OAAO;AACN,2BAAiB,8BAA8B,OAAO;AAAA,QACvD;AAAA,MACD,SAAS,OAAO;AACf,eAAO,MAAM,8BAA8B,KAAK;AAChD,yBAAiB,6BAA6B,OAAO;AAAA,MACtD,UAAC;AACA,kBAAU;AAAA,MACX;AAAA,IACD;AAuJS,aAAA,iBAAiB,SAAiB,MAAgD;AAC1F,gBAAU,SAAS,MAAM,GAAI;AAAA,IAC9B;;;;AAyCuG,MAAAA,YAAA,KAAA,oXAAAC,KAAA,YAAA,kKAKF,SAAO,IAAA,CAAA,0lBAAAA,KAAA,YAoBhE,SAAO,IAAA,CAAA,qiBAAAC,YAWuB,YAAY,MAAM,CAAA,+EAAA;AAMlF,YAAA,aAAAC,kBAAA,YAAY,MAAM,GAAG,CAAC,CAAA;;YAAK,aAAU,WAAA,OAAA;AAEa,QAAAH,YAAA,KAAA,gHAAAE,YAAA,WAAW,KAAK,CAAA,iFAAA;AAAA;;UAIpE,YAAY,SAAS,GAAC;;mFACkB,YAAY,SAAS,CAAC,CAAA,WAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EA3D/D,CAAA;;2BCrSR;;;;;;;;;;;oBAY8E;AAAA;;;;;AARtE;"}