{"version":3,"file":"_page.server.ts.js","sources":["../../../../../../../src/routes/config/configurationManager/+page.server.ts"],"sourcesContent":["/**\n * @file src/routes/(app)/config/configurationManager/+page.server.ts\n * @description Server-side logic for the Configuration Manager page.\n *\n * This handler ensures that only authenticated users with administrative\n * privileges can access the configuration synchronization UI.\n *\n * Features:\n * - Redirects unauthenticated users to the login page.\n * - Verifies that the user has an 'admin' role.\n * - Returns a safe user object to the page for display.\n * - Leverages the central authentication logic from `hooks.server.ts`.\n */\n\nimport { error, redirect } from '@sveltejs/kit';\nimport type { PageServerLoad } from './$types';\nimport { logger } from '@shared/utils/logger.server';\n\nexport const load: PageServerLoad = async ({ locals }) => {\n\t// 1. Get user from `locals`, populated by `hooks.server.ts`\n\tconst { user, isAdmin } = locals;\n\n\t// 2. Authentication Check: Ensure a user is logged in.\n\tif (!user) {\n\t\tlogger.warn('Unauthenticated access attempt to Configuration Manager');\n\t\tthrow redirect(302, '/login');\n\t}\n\n\t// 3. Authorization Check: Ensure the user is an administrator.\n\t//    Configuration synchronization is a high-privilege operation.\n\tif (!isAdmin) {\n\t\tlogger.warn(`Permission denied for user=${user._id} to access Configuration Manager.`);\n\t\tthrow error(403, 'Forbidden: You do not have permission to access this page.');\n\t}\n\n\t// 4. Return safe data to the UI.\n\t//    Only return non-sensitive information needed for display.\n\treturn {\n\t\tuser: {\n\t\t\temail: user.email\n\t\t}\n\t};\n};\n"],"names":[],"mappings":";;AAkBO,MAAM,OAAuB,OAAO,EAAE,aAAa;AAEzD,QAAM,EAAE,MAAM,QAAA,IAAY;AAG1B,MAAI,CAAC,MAAM;AACV,WAAO,KAAK,yDAAyD;AACrE,UAAM,SAAS,KAAK,QAAQ;AAAA,EAC7B;AAIA,MAAI,CAAC,SAAS;AACb,WAAO,KAAK,8BAA8B,KAAK,GAAG,mCAAmC;AACrF,UAAM,MAAM,KAAK,4DAA4D;AAAA,EAC9E;AAIA,SAAO;AAAA,IACN,MAAM;AAAA,MACL,OAAO,KAAK;AAAA,IAAA;AAAA,EACb;AAEF;"}