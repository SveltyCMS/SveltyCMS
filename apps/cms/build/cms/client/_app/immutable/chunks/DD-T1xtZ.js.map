{"version":3,"file":"DD-T1xtZ.js","sources":["../../../../../../../../shared/features/src/dashboard/widgets/PerformanceWidget.svelte"],"sourcesContent":["<!--\n@file src/routes/(app)/dashboard/widgets/PerformanceWidget.svelte\n@description Performance monitoring widget for dashboard using BaseWidget\nDisplays real-time system metrics integrated with the dashboard grid system\n-->\n\n<script lang=\"ts\" module>\n\texport const widgetMeta = {\n\t\tname: 'Performance Monitor',\n\t\ticon: 'mdi:chart-line',\n\t\tdescription: 'Track system performance metrics',\n\t\tdefaultSize: { w: 1, h: 2 }\n\t};\n</script>\n\n<script lang=\"ts\">\n\timport BaseWidget from '../BaseWidget.svelte';\n\timport type { WidgetSize } from '@cms-types';\n\n\tinterface HealthMetrics {\n\t\trequests: { total: number; errors: number };\n\t\tauth: { validations: number; failures: number };\n\t\tcache: { hits: number; misses: number };\n\t\tsessions: { active: number; rotations: number };\n\t\tlastReset: number;\n\t\tsystem?: {\n\t\t\tmemory: { used: number; total: number; external: number; rss: number };\n\t\t\tuptime: number;\n\t\t\tnodeVersion: string;\n\t\t};\n\t}\n\n\tconst {\n\t\tlabel = 'Performance Monitor',\n\t\ttheme = 'light',\n\t\ticon = 'mdi:chart-line',\n\t\twidgetId = undefined,\n\t\tsize = { w: 1, h: 1 } as WidgetSize,\n\t\tonSizeChange = (_newSize: WidgetSize) => {},\n\t\tonRemove = () => {}\n\t}: {\n\t\tlabel?: string;\n\t\ttheme?: 'light' | 'dark';\n\t\ticon?: string;\n\t\twidgetId?: string;\n\t\tsize?: WidgetSize;\n\t\tonSizeChange?: (newSize: WidgetSize) => void;\n\t\tonRemove?: () => void;\n\t} = $props();\n\n\t// Performance indicator color based on metrics\n\tfunction getPerformanceColor(errorRate: number): string {\n\t\tif (errorRate > 5) return 'text-error-500';\n\t\tif (errorRate > 2) return 'text-warning-500';\n\t\treturn 'text-success-500';\n\t}\n\n\tfunction formatUptime(seconds: number): string {\n\t\tif (seconds < 60) return `${seconds}s`;\n\t\tif (seconds < 3600) return `${Math.floor(seconds / 60)}m`;\n\t\tif (seconds < 86400) return `${Math.floor(seconds / 3600)}h`;\n\t\treturn `${Math.floor(seconds / 86400)}d`;\n\t}\n\n\tfunction formatMemory(mb: number): string {\n\t\tif (mb < 1024) return `${mb}MB`;\n\t\treturn `${(mb / 1024).toFixed(1)}GB`;\n\t}\n</script>\n\n<BaseWidget\n\t{label}\n\t{theme}\n\tendpoint=\"/api/dashboard/metrics?detailed=true\"\n\tpollInterval={10000}\n\t{icon}\n\t{widgetId}\n\t{size}\n\t{onSizeChange}\n\tonCloseRequest={onRemove}\n>\n\t{#snippet children({ data })}\n\t\t{@const metrics = data as HealthMetrics | null}\n\n\t\t{#if !metrics}\n\t\t\t<div class=\"flex h-full items-center justify-center text-surface-500\">\n\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:chart-line\" width=\"48\" class=\"mb-2 opacity-50\"></iconify-icon>\n\t\t\t\t\t<p>Loading metrics...</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t{@const errorRate = metrics.requests.total > 0 ? (metrics.requests.errors / metrics.requests.total) * 100 : 0}\n\t\t\t{@const authSuccessRate =\n\t\t\t\tmetrics.auth.validations > 0 ? ((metrics.auth.validations - metrics.auth.failures) / metrics.auth.validations) * 100 : 100}\n\t\t\t{@const cacheHitRate =\n\t\t\t\tmetrics.cache.hits + metrics.cache.misses > 0 ? (metrics.cache.hits / (metrics.cache.hits + metrics.cache.misses)) * 100 : 0}\n\n\t\t\t<div class=\"flex h-full flex-col space-y-3 text-sm\">\n\t\t\t\t<!-- Performance Overview -->\n\t\t\t\t<h3 class=\"text-center text-xs font-semibold\">Performance Overview:</h3>\n\n\t\t\t\t<div class=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Error Rate</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold {getPerformanceColor(errorRate)}\">{errorRate.toFixed(2)}%</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Cache Hit</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold text-primary-500\">{cacheHitRate.toFixed(1)}%</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Auth Success</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold text-success-500\">{authSuccessRate.toFixed(1)}%</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-surface-600 dark:text-surface-300\">Sessions</span>\n\t\t\t\t\t\t\t<span class=\"text-lg font-bold text-tertiary-500\">{metrics.sessions.active}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- System Metrics (if available) -->\n\t\t\t\t{#if metrics.system}\n\t\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t\t<h3 class=\"text-center text-xs font-semibold\">System:</h3>\n\n\t\t\t\t\t\t<div class=\"grid grid-cols-2 gap-2 text-xs\">\n\t\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Memory:</span>\n\t\t\t\t\t\t\t\t<span class=\"font-mono\">{formatMemory(metrics.system.memory.used)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Uptime:</span>\n\t\t\t\t\t\t\t\t<span class=\"font-mono\">{formatUptime(metrics.system.uptime)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Request Metrics -->\n\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t<h3 class=\"text-center text-xs font-semibold\">Requests:</h3>\n\n\t\t\t\t\t<div class=\"grid grid-cols-2 gap-2 text-xs\">\n\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Total:</span>\n\t\t\t\t\t\t\t<span class=\"font-mono\">{metrics.requests.total}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t\t<span class=\"text-surface-600 dark:text-surface-50\">Errors:</span>\n\t\t\t\t\t\t\t<span class=\"font-mono text-error-500\">{metrics.requests.errors}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t{/snippet}\n</BaseWidget>\n"],"names":["widgetMeta","label","theme","icon","widgetId","size","onSizeChange","$.prop","$$props","_newSize","onRemove","getPerformanceColor","errorRate","formatUptime","seconds","formatMemory","mb","BaseWidget","$$anchor","$$arg0","metrics","div","root_2","div_1","iconify_icon","$.get","authSuccessRate","cacheHitRate","$.derived","div_2","root_3","div_3","div_4","div_5","span","div_6","div_7","span_1","div_8","div_9","span_2","div_10","div_11","span_3","div_12","root_4","div_13","div_14","span_4","div_15","span_5","$$render","consequent_1","div_16","$.sibling","node_1","div_17","div_18","span_6","div_19","span_7","$0","alternate","consequent"],"mappings":"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"}