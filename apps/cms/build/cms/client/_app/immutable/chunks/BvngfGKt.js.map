{"version":3,"file":"BvngfGKt.js","sources":["../../../../../../../../shared/utils/src/logger.ts"],"sourcesContent":["/**\n * @file src/utils/logger.ts\n * @description Universal logger (client + server) with formatting & tree-shaking\n *\n * Features:\n * - Level-based logging (fatal ‚Üí trace)\n * - Smart token highlighting\n * - Sensitive data masking\n * - Channel support\n * - Dump helper\n * - Fully stripped when VITE_LOG_LEVELS=none\n *\n * Configure via VITE_LOG_LEVELS (build) or LOG_LEVELS (runtime)\n */\nconst IS_BROWSER = typeof window !== 'undefined';\n\nexport type LoggableValue = string | number | boolean | null | undefined | object | Date | Error;\n\n// Log levels from env\nconst env = import.meta.env || {};\nconst proc = typeof process !== 'undefined' ? process.env : {};\nconst LOG_LEVELS = (env.VITE_LOG_LEVELS ?? proc.LOG_LEVELS ?? 'info').split(',').map((l) => l.trim().toLowerCase()) as LogLevel[];\n\nconst DISABLED = LOG_LEVELS.includes('none');\n\ntype LogLevel = 'none' | 'fatal' | 'error' | 'warn' | 'info' | 'debug' | 'trace';\n\nconst PRIORITY: Record<LogLevel, number> = {\n\tnone: 0,\n\tfatal: 1,\n\terror: 2,\n\twarn: 3,\n\tinfo: 4,\n\tdebug: 5,\n\ttrace: 6\n};\n\nconst MAX_PRIO = DISABLED ? 0 : Math.max(...LOG_LEVELS.map((l) => PRIORITY[l] ?? 0));\n\n// Enabled check (inlined)\nconst enabled = (level: LogLevel) => !DISABLED && PRIORITY[level] <= MAX_PRIO;\n\n// Sensitive keys\nconst SENSITIVE = [\n\t'password',\n\t'passwd',\n\t'pwd',\n\t'token',\n\t'access_token',\n\t'refresh_token',\n\t'api_key',\n\t'apikey',\n\t'secret',\n\t'client_secret',\n\t'authorization',\n\t'auth'\n];\n\n// Masking\nfunction mask(v: unknown, depth = 0): unknown {\n\tif (depth > 10) return '[Depth]';\n\tif (v === null || typeof v !== 'object') return v;\n\tif (v instanceof Date || v instanceof RegExp) return v;\n\tif (Array.isArray(v)) return v.map((i) => mask(i, depth + 1));\n\n\tconst o: Record<string, unknown> = {};\n\tfor (const [k, val] of Object.entries(v)) {\n\t\tif (SENSITIVE.some((s) => k.toLowerCase().includes(s))) {\n\t\t\to[k] = '[REDACTED]';\n\t\t} else {\n\t\t\to[k] = mask(val, depth + 1);\n\t\t}\n\t}\n\treturn o;\n}\n\n// Server formatting (ANSI)\nconst serverFormat =\n\t!IS_BROWSER && !DISABLED\n\t\t? (msg: string) => {\n\t\t\t\tconst patterns = [\n\t\t\t\t\t{ re: /\\b\\d+(\\.\\d+)?(ms|s)\\b/g, c: '\\x1b[32m' },\n\t\t\t\t\t{\n\t\t\t\t\t\tre: /[a-f0-9]{24}|[a-f0-9]{32}|[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi,\n\t\t\t\t\t\tc: '\\x1b[33m'\n\t\t\t\t\t},\n\t\t\t\t\t{ re: /\\/api\\/[^\\s]+/g, c: '\\x1b[36m' },\n\t\t\t\t\t{ re: /\\btrue\\b/g, c: '\\x1b[32m' },\n\t\t\t\t\t{ re: /\\bfalse\\b/g, c: '\\x1b[31m' },\n\t\t\t\t\t{ re: /\\b\\d+\\b/g, c: '\\x1b[34m' }\n\t\t\t\t];\n\t\t\t\tlet out = msg;\n\t\t\t\tfor (const { re, c } of patterns) {\n\t\t\t\t\tout = out.replace(re, `${c}$&${'\\x1b[0m'}`);\n\t\t\t\t}\n\t\t\t\treturn out;\n\t\t\t}\n\t\t: (msg: string) => msg;\n\n// Client formatting (console %c)\nconst clientFormat =\n\tIS_BROWSER && !DISABLED\n\t\t? (msg: string) => {\n\t\t\t\tconst styles: string[] = [];\n\t\t\t\tlet formatted = msg.replace(\n\t\t\t\t\t/\\b\\d+(\\.\\d+)?(ms|s)\\b|[a-f0-9]{24}|[a-f0-9]{32}|[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}|\\/api\\/[^\\s]+|\\btrue\\b|\\bfalse\\b|\\b\\d+\\b/gi,\n\t\t\t\t\t(m) => {\n\t\t\t\t\t\tconst color = m.match(/ms|s|\\d/)\n\t\t\t\t\t\t\t? '#22c55e'\n\t\t\t\t\t\t\t: m.match(/[a-f0-9]{24}|[a-f0-9]{32}|uuid/i)\n\t\t\t\t\t\t\t\t? '#f59e0b'\n\t\t\t\t\t\t\t\t: m === 'true'\n\t\t\t\t\t\t\t\t\t? '#22c55e'\n\t\t\t\t\t\t\t\t\t: m === 'false'\n\t\t\t\t\t\t\t\t\t\t? '#ef4444'\n\t\t\t\t\t\t\t\t\t\t: m.startsWith('/api/')\n\t\t\t\t\t\t\t\t\t\t\t? '#06b6d4'\n\t\t\t\t\t\t\t\t\t\t\t: '#3b82f6';\n\t\t\t\t\t\tstyles.push(`color:${color};font-weight:bold`);\n\t\t\t\t\t\tstyles.push('color:inherit');\n\t\t\t\t\t\treturn `%c${m}%c`;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn { formatted, styles };\n\t\t\t}\n\t\t: () => ({ formatted: '', styles: [] });\n\n// Core log\nfunction log(level: LogLevel, msg: string, args: unknown[]) {\n\tif (!enabled(level)) return;\n\n\tconst masked = args.map(mask);\n\tconst ts = new Date().toISOString().slice(0, 19).replace('T', ' ');\n\tconst icons: Record<LogLevel, string> = {\n\t\tfatal: 'üíÄ',\n\t\terror: '‚ùå',\n\t\twarn: '‚ö†Ô∏è',\n\t\tinfo: '‚ÑπÔ∏è',\n\t\tdebug: 'üêõ',\n\t\ttrace: 'üîç',\n\t\tnone: ''\n\t};\n\tconst method = level === 'fatal' || level === 'error' ? 'error' : level === 'warn' ? 'warn' : 'log';\n\n\tif (IS_BROWSER) {\n\t\tconst { formatted, styles } = clientFormat(msg);\n\t\tconsole[method](`%c${ts}%c ${icons[level]} [${level.toUpperCase()}] %c${formatted}`, 'color:#9ca3af', '', 'color:inherit', ...styles, ...masked);\n\t} else {\n\t\tconst colored = serverFormat(msg);\n\t\tconsole[method](`${'\\x1b[2m'}${ts}${'\\x1b[0m'} ${icons[level]} [${level.toUpperCase().padEnd(5)}] ${colored}`, ...masked);\n\t}\n}\n\n// Public logger\nexport const logger = DISABLED\n\t? {\n\t\t\tfatal: () => {},\n\t\t\terror: () => {},\n\t\t\twarn: () => {},\n\t\t\tinfo: () => {},\n\t\t\tdebug: () => {},\n\t\t\ttrace: () => {},\n\t\t\tchannel: () => ({\n\t\t\t\tfatal: () => {},\n\t\t\t\terror: () => {},\n\t\t\t\twarn: () => {},\n\t\t\t\tinfo: () => {},\n\t\t\t\tdebug: () => {},\n\t\t\t\ttrace: () => {}\n\t\t\t}),\n\t\t\tdump: () => {}\n\t\t}\n\t: {\n\t\t\tfatal: (m: string, ...a: unknown[]) => log('fatal', m, a),\n\t\t\terror: (m: string, ...a: unknown[]) => log('error', m, a),\n\t\t\twarn: (m: string, ...a: unknown[]) => log('warn', m, a),\n\t\t\tinfo: (m: string, ...a: unknown[]) => log('info', m, a),\n\t\t\tdebug: (m: string, ...a: unknown[]) => log('debug', m, a),\n\t\t\ttrace: (m: string, ...a: unknown[]) => log('trace', m, a),\n\n\t\t\tchannel: (name: string) => ({\n\t\t\t\tfatal: (m: string, ...a: unknown[]) => log('fatal', `[${name}] ${m}`, a),\n\t\t\t\terror: (m: string, ...a: unknown[]) => log('error', `[${name}] ${m}`, a),\n\t\t\t\twarn: (m: string, ...a: unknown[]) => log('warn', `[${name}] ${m}`, a),\n\t\t\t\tinfo: (m: string, ...a: unknown[]) => log('info', `[${name}] ${m}`, a),\n\t\t\t\tdebug: (m: string, ...a: unknown[]) => log('debug', `[${name}] ${m}`, a),\n\t\t\t\ttrace: (m: string, ...a: unknown[]) => log('trace', `[${name}] ${m}`, a)\n\t\t\t}),\n\n\t\t\tdump: (data: unknown, label?: string) => {\n\t\t\t\tif (!enabled('trace')) return;\n\t\t\t\tconst prefix = label ? `DUMP[${label}]` : 'DUMP';\n\t\t\t\tif (IS_BROWSER) {\n\t\t\t\t\tconsole.group(`üîç ${prefix}`);\n\t\t\t\t\tconsole.dir(mask(data), { depth: null });\n\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t} else {\n\t\t\t\t\tlog('trace', prefix, [data]);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n"],"names":["IS_BROWSER","env","__vite_import_meta_env__","proc","define_process_env_default","LOG_LEVELS","l","DISABLED","PRIORITY","MAX_PRIO","enabled","level","SENSITIVE","mask","v","depth","i","o","k","val","serverFormat","msg","patterns","out","re","c","clientFormat","styles","m","color","log","args","masked","ts","icons","method","formatted","colored","logger","a","name","data","label","prefix"],"mappings":"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"}