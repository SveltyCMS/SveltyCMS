{"version":3,"file":"tDLbQXzX.js","sources":["../../../../../../src/widgets/custom/PhoneNumber/Input.svelte"],"sourcesContent":["<!--\n@file src/widgets/custom/PhoneNumber/Input.svelte\n@component\n**PhoneNumber Widget Component**\n\n@example\n<PhoneNumber field={{ label: \"Phon\t\t\t\tplaceholder={typeof field?.placeholder === 'string' && field?.placeholder.trim() !== '' ? field.placeholder : '+1234567890'}\n\t\trequired={field?.required as boolean | undefined}\n\t\treadonly={field?.readonly as boolean | undefined}\n\t\tdisabled={field?.disabled as boolean | undefined}\n\t\tpattern={field?.pattern as string | undefined}\n\t\tclass=\"input w-full flex-1 rounded-none text-black dark:text-primary-500\"ired={field?.required as boolean | undefined}\n\t\t\t\treadonly={field?.readonly as boolean | undefined}\n\t\t\t\tdisabled={field?.disabled as boolean | undefined}\n\t\t\t\tpattern={field?.pattern as string | undefined}\n\t\t\t\tclass=\"input w-full flex-1 rounded-none text-black dark:text-primary-500\"b_fieldName: \"phone\", required: true }} />\n\n### Props\n- `field`: FieldType\n- `value`: any\n\n### Features\n- **Phone Validation**: E.164 international format or custom pattern\n- **Non-Translatable**: Phone numbers are universal values\n- **Semantic HTML**: Uses type=\"tel\" for proper mobile keyboards\n- **Pattern Support**: Configurable regex for different formats\n- **Enhanced Validation**: Integration with validation store\n- **Touch State Management**: Proper error display based on interaction\n- **Debounced Validation**: Performance-optimized validation\n- **Accessibility**: Full ARIA support and semantic HTML\n- **Auto-Focus**: Focus management for required fields\n- **International Support**: Default E.164 format (+1234567890)\n-->\n\n<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport type { FieldType } from '.';\n\timport { publicEnv } from '@shared/stores/globalSettings.svelte';\n\n\t// Stores\n\timport { app, validationStore } from '@shared/stores/store.svelte';\n\n\timport { getFieldName } from '@shared/utils/utils';\n\timport { tokenTarget } from '@shared/services/token/tokenTarget';\n\n\t// Valibot validation\n\timport { string, regex, pipe, parse, type ValiError, minLength, optional } from 'valibot';\n\n\tinterface Props {\n\t\tfield: FieldType;\n\t\tvalue?: any;\n\t}\n\n\tlet { field, value = $bindable() }: Props = $props();\n\n\tconst fieldName = $derived(getFieldName(field));\n\t// Use current content language for translated fields, default for non-translated\n\tconst _language = $derived(field.translated ? app.contentLanguage : ((publicEnv.DEFAULT_CONTENT_LANGUAGE as string) || 'en').toLowerCase());\n\n\t// Initialize value\n\t$effect(() => {\n\t\tif (!value) {\n\t\t\tvalue = { [_language]: '' };\n\t\t}\n\t});\n\n\tconst safeValue = $derived(value?.[_language] ?? '');\n\tconst validationError = $derived(validationStore.getError(fieldName));\n\tlet debounceTimeout: number | undefined;\n\tlet inputElement = $state<HTMLInputElement | null>(null);\n\tlet isTouched = $state(false);\n\tlet isValidating = $state(false);\n\n\t// Create validation schema for phone number\n\t// Default E.164 pattern unless a custom pattern is provided\n\tconst defaultPattern = /^\\+?[1-9]\\d{1,14}$/;\n\tconst validationPattern = $derived(typeof field.pattern === 'string' && field.pattern.trim() !== '' ? new RegExp(field.pattern) : defaultPattern);\n\n\tconst phoneSchema = $derived(\n\t\tfield?.required\n\t\t\t? pipe(\n\t\t\t\t\tstring(),\n\t\t\t\t\tminLength(1, 'This field is required'),\n\t\t\t\t\tregex(validationPattern, 'Invalid phone number format. Please use international format (e.g., +1234567890)')\n\t\t\t\t)\n\t\t\t: optional(pipe(string(), regex(validationPattern, 'Invalid phone number format. Please use international format (e.g., +1234567890)')), '')\n\t);\n\n\t// Validation function with debounce\n\tfunction validateInput(immediate = false) {\n\t\tif (debounceTimeout) clearTimeout(debounceTimeout);\n\n\t\tconst doValidation = () => {\n\t\t\ttry {\n\t\t\t\tisValidating = true;\n\t\t\t\tconst currentValue = safeValue;\n\n\t\t\t\t// First validate if required\n\t\t\t\tif (field?.required && (!currentValue || currentValue.trim() === '')) {\n\t\t\t\t\tvalidationStore.setError(fieldName, 'This field is required');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Then validate phone format if value exists\n\t\t\t\tif (currentValue && currentValue.trim() !== '') {\n\t\t\t\t\tparse(phoneSchema, currentValue);\n\t\t\t\t}\n\n\t\t\t\tvalidationStore.clearError(fieldName);\n\t\t\t} catch (error) {\n\t\t\t\tif ((error as ValiError<any>).issues) {\n\t\t\t\t\tconst valiError = error as ValiError<any>;\n\t\t\t\t\tconst errorMessage = valiError.issues[0]?.message || 'Invalid input';\n\t\t\t\t\tvalidationStore.setError(fieldName, errorMessage);\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tisValidating = false;\n\t\t\t}\n\t\t};\n\n\t\tif (immediate) {\n\t\t\tdoValidation();\n\t\t} else {\n\t\t\tdebounceTimeout = window.setTimeout(doValidation, 300);\n\t\t}\n\t}\n\n\t// Handle input changes\n\tfunction handleInput(e: Event) {\n\t\tconst target = e.currentTarget as HTMLInputElement;\n\t\tif (!value) {\n\t\t\tvalue = {};\n\t\t}\n\t\tvalue = { ...value, [_language]: target.value };\n\t}\n\n\t// Handle blur\n\tfunction handleBlur() {\n\t\tisTouched = true;\n\t\tvalidateInput(true);\n\t}\n\n\t// Focus management\n\tonMount(() => {\n\t\tif (field?.required && !safeValue) {\n\t\t\tinputElement?.focus();\n\t\t}\n\t});\n\n\t// Cleanup\n\tonDestroy(() => {\n\t\tif (debounceTimeout) clearTimeout(debounceTimeout);\n\t});\n\n\t// Export WidgetData for data binding with Fields.svelte\n\texport const WidgetData = async () => value;\n</script>\n\n<div class=\"input-container relative mb-4\">\n\t<div class=\"preset-filled-surface-500 btn-group flex w-full rounded\" role=\"group\">\n\t\t{#if field?.prefix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.prefix} prefix`}>\n\t\t\t\t{field?.prefix}\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"relative w-full flex-1\">\n\t\t\t<input\n\t\t\t\ttype=\"tel\"\n\t\t\t\tvalue={safeValue || ''}\n\t\t\t\toninput={handleInput}\n\t\t\t\tonblur={handleBlur}\n\t\t\t\tuse:tokenTarget={{\n\t\t\t\t\tname: field.db_fieldName,\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tcollection: (field as any).collection\n\t\t\t\t}}\n\t\t\t\tname={field?.db_fieldName}\n\t\t\t\tid={field?.db_fieldName}\n\t\t\t\tplaceholder={typeof field?.placeholder === 'string' && field.placeholder !== '' ? field.placeholder : String(field?.db_fieldName ?? '')}\n\t\t\t\trequired={field?.required as boolean | undefined}\n\t\t\t\treadonly={field?.readonly as boolean | undefined}\n\t\t\t\tdisabled={field?.disabled as boolean | undefined}\n\t\t\t\tclass=\"input w-full rounded-none text-black dark:text-primary-500\"\n\t\t\t\tclass:!border-error-500={!!validationError}\n\t\t\t\tclass:!ring-1={!!validationError || isValidating}\n\t\t\t\tclass:!ring-error-500={!!validationError}\n\t\t\t\tclass:!border-primary-500={isValidating && !validationError}\n\t\t\t\tclass:!ring-primary-500={isValidating && !validationError}\n\t\t\t\taria-invalid={!!validationError}\n\t\t\t\taria-describedby={validationError ? `${fieldName}-error` : undefined}\n\t\t\t\taria-required={field?.required}\n\t\t\t\tdata-testid=\"phone-input\"\n\t\t\t/>\n\t\t</div>\n\n\t\t{#if field?.suffix}\n\t\t\t<button class=\"px-2!\" type=\"button\" aria-label={`${field.suffix} suffix`}>\n\t\t\t\t{field?.suffix}\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<!-- Validation indicator -->\n\t\t{#if isValidating}\n\t\t\t<div class=\"flex items-center px-2\" aria-label=\"Validating\">\n\t\t\t\t<div class=\"h-4 w-4 animate-spin rounded-full border-2 border-primary-500 border-t-transparent\"></div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\n\t<!-- Error Message -->\n\t{#if validationError && isTouched}\n\t\t<p id={`${field.db_fieldName}-error`} class=\"absolute -bottom-4 left-0 w-full text-center text-xs text-error-500\" role=\"alert\" aria-live=\"polite\">\n\t\t\t{validationError}\n\t\t</p>\n\t{/if}\n</div>\n\n<style>\n\t.input-container {\n\t\tmin-height: 2.5rem;\n\t}\n\n\t.animate-spin {\n\t\tanimation: spin 1s linear infinite;\n\t}\n\n\t@keyframes spin {\n\t\tto {\n\t\t\ttransform: rotate(360deg);\n\t\t}\n\t}\n</style>\n"],"names":["value","$.prop","$$props","fieldName","getFieldName","_language","app","publicEnv","$.user_effect","$.get","safeValue","$.derived","validationError","validationStore","debounceTimeout","isTouched","$.state","isValidating","defaultPattern","validationPattern","phoneSchema","pipe","string","minLength","regex","optional","validateInput","immediate","doValidation","$.set","currentValue","parse","error","errorMessage","handleInput","e","target","handleBlur","onMount","onDestroy","div","root","div_1","button","root_1","$.set_attribute","$$render","consequent","div_2","$.sibling","node","input","$.child","$.remove_input_defaults","$.action","$$node","$$action_arg","tokenTarget","button_1","root_2","consequent_1","div_3","root_3","consequent_2","p","root_4","consequent_3","$0","classes","$.set_class","$.event"],"mappings":"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"}