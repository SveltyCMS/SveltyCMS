{"version":3,"file":"vkx2g0aB.js","sources":["../../../../../../../../shared/components/src/PermissionsSetting.svelte","../../../../../../src/widgets/widgetFactory.ts","../../../../../../src/widgets/core/Checkbox/index.ts","../../../../../../src/widgets/core/Date/index.ts","../../../../../../src/widgets/core/DateRange/index.ts","../../../../../../src/widgets/core/Group/index.ts","../../../../../../src/widgets/core/Input/index.ts","../../../../../../src/widgets/core/MediaUpload/index.ts","../../../../../../src/widgets/core/MegaMenu/index.ts","../../../../../../src/widgets/core/Radio/index.ts","../../../../../../../../shared/components/src/system/builder/CollectionPicker.svelte","../../../../../../../../shared/components/src/system/builder/FieldPicker.svelte","../../../../../../src/widgets/core/Relation/index.ts","../../../../../../src/widgets/core/RichText/index.ts","../../../../../../src/widgets/custom/Address/index.ts","../../../../../../src/widgets/custom/ColorPicker/index.ts","../../../../../../src/widgets/custom/Currency/index.ts","../../../../../../src/widgets/custom/Email/index.ts","../../../../../../src/widgets/custom/Number/index.ts","../../../../../../src/widgets/custom/PhoneNumber/index.ts","../../../../../../src/widgets/custom/Rating/index.ts","../../../../../../src/widgets/custom/RemoteVideo/index.ts","../../../../../../src/widgets/custom/Seo/index.ts","../../../../../../src/widgets/scanner.js","../../../../../../../../shared/stores/src/widgetStore.svelte.ts"],"sourcesContent":["<!--\n@file src/components/PermissionsSetting.svelte\n@component\n**Enhanced Permissions Management - Svelte 5 Optimized**\n\nAdvanced permission management interface with bulk actions and presets.\n\n@example\n```svelte\n<PermissionsSetting {permissions} {roles} {onUpdate} />\n```\n\n### Props\n- `permissions` (object): Current permissions configuration\n- `roles` (Role[]): Available roles\n- `onUpdate` (function): Callback when permissions change\n\n### Features\n- Visual permission matrix\n- Bulk permission actions (enable/disable all)\n- Permission presets (read-only, editor, admin)\n- Role search and filtering\n- Admin role protection\n- Undo/redo support\n- Export/import permissions\n- Full ARIA accessibility\n- Reduced motion support\n-->\n\n<script lang=\"ts\">\n\timport type { Role } from '@shared/database/auth/types';\n\timport { PermissionAction } from '@shared/database/auth/types';\n\timport { showToast } from '@shared/utils/toast';\n\timport { fade, slide } from 'svelte/transition';\n\timport { onMount } from 'svelte';\n\n\ttype PermissionsMap = Record<string, Record<string, boolean>>;\n\n\tinterface Props {\n\t\tpermissions?: PermissionsMap;\n\t\troles?: Role[];\n\t\tonUpdate?: (permissions: PermissionsMap) => void;\n\t}\n\n\tconst { permissions = {}, roles = [], onUpdate = () => {} }: Props = $props();\n\n\t// State\n\tlet error = $state<string | null>(null);\n\tlet searchQuery = $state('');\n\tlet showBulkActions = $state(false);\n\tlet prefersReducedMotion = $state(false);\n\tlet historyIndex = $state(-1);\n\tlet permissionsHistory = $state<PermissionsMap[]>([]);\n\n\t// Icons for permissions\n\tconst actionIcons: Record<PermissionAction, string> = {\n\t\t[PermissionAction.CREATE]: 'bi:plus-circle-fill',\n\t\t[PermissionAction.READ]: 'bi:eye-fill',\n\t\t[PermissionAction.WRITE]: 'bi:pencil-square',\n\t\t[PermissionAction.UPDATE]: 'bi:pencil-fill',\n\t\t[PermissionAction.DELETE]: 'bi:trash-fill',\n\t\t[PermissionAction.MANAGE]: 'bi:gear-fill',\n\t\t[PermissionAction.ACCESS]: 'bi:key-fill',\n\t\t[PermissionAction.EXECUTE]: 'bi:play-fill',\n\t\t[PermissionAction.SHARE]: 'bi:share-fill'\n\t};\n\n\t// Permission presets\n\tconst presets = {\n\t\t'read-only': {\n\t\t\tname: 'Read Only',\n\t\t\tdescription: 'Can only view content',\n\t\t\tpermissions: {\n\t\t\t\tread: true,\n\t\t\t\taccess: true,\n\t\t\t\tcreate: false,\n\t\t\t\twrite: false,\n\t\t\t\tupdate: false,\n\t\t\t\tdelete: false,\n\t\t\t\tmanage: false,\n\t\t\t\texecute: false,\n\t\t\t\tshare: false\n\t\t\t}\n\t\t},\n\t\teditor: {\n\t\t\tname: 'Editor',\n\t\t\tdescription: 'Can create and edit content',\n\t\t\tpermissions: {\n\t\t\t\tread: true,\n\t\t\t\taccess: true,\n\t\t\t\tcreate: true,\n\t\t\t\twrite: true,\n\t\t\t\tupdate: true,\n\t\t\t\tshare: true,\n\t\t\t\tdelete: false,\n\t\t\t\tmanage: false,\n\t\t\t\texecute: false\n\t\t\t}\n\t\t},\n\t\tadmin: {\n\t\t\tname: 'Administrator',\n\t\t\tdescription: 'Full access to everything',\n\t\t\tpermissions: Object.fromEntries(Object.values(PermissionAction).map((action) => [action, true]))\n\t\t}\n\t};\n\n\t// Initialize permissions with all roles\n\tfunction initializePermissions(currentPermissions: PermissionsMap, availableRoles: Role[]): PermissionsMap {\n\t\tconst initialized: PermissionsMap = { ...currentPermissions };\n\n\t\tavailableRoles.forEach((role) => {\n\t\t\tif (!initialized[role._id]) {\n\t\t\t\tinitialized[role._id] = Object.fromEntries(Object.values(PermissionAction).map((action) => [action, true]));\n\t\t\t}\n\t\t});\n\n\t\treturn initialized;\n\t}\n\n\t// Initialize state from props - use $derived to react to prop changes\n\tlet permissionsState = $derived(initializePermissions(permissions, roles));\n\n\t// Save to history\n\tfunction saveToHistory() {\n\t\tconst newHistory = permissionsHistory.slice(0, historyIndex + 1);\n\t\tnewHistory.push(JSON.parse(JSON.stringify(permissionsState)));\n\t\tpermissionsHistory = newHistory;\n\t\thistoryIndex = newHistory.length - 1;\n\t}\n\n\t// Undo/Redo\n\tfunction undo() {\n\t\tif (historyIndex > 0) {\n\t\t\thistoryIndex--;\n\t\t\tpermissionsState = JSON.parse(JSON.stringify(permissionsHistory[historyIndex]));\n\t\t\tupdateParent();\n\t\t}\n\t}\n\n\tfunction redo() {\n\t\tif (historyIndex < permissionsHistory.length - 1) {\n\t\t\thistoryIndex++;\n\t\t\tpermissionsState = JSON.parse(JSON.stringify(permissionsHistory[historyIndex]));\n\t\t\tupdateParent();\n\t\t}\n\t}\n\n\tconst canUndo = $derived(historyIndex > 0);\n\tconst canRedo = $derived(historyIndex < permissionsHistory.length - 1);\n\n\t// Toggle permission\n\tfunction togglePermission(roleId: string, action: PermissionAction) {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\n\t\tif (role?.isAdmin) {\n\t\t\tshowToast('Cannot modify permissions for admin role', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!permissionsState[roleId]) {\n\t\t\tpermissionsState[roleId] = {} as Record<string, boolean>;\n\t\t}\n\n\t\tpermissionsState[roleId][action] = !permissionsState[roleId][action];\n\t\tsaveToHistory();\n\t\tupdateParent();\n\t}\n\n\t// Bulk actions\n\tfunction setAllPermissionsForRole(roleId: string, value: boolean) {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\n\t\tif (role?.isAdmin) {\n\t\t\tshowToast('Cannot modify permissions for admin role', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tpermissionsState[roleId] = Object.fromEntries(Object.values(PermissionAction).map((action) => [action, value]));\n\n\t\tsaveToHistory();\n\t\tupdateParent();\n\t\tshowToast(`All permissions ${value ? 'enabled' : 'disabled'} for ${role?.name}`, 'success');\n\t}\n\n\tfunction setPermissionForAllRoles(action: PermissionAction, value: boolean) {\n\t\troles.forEach((role) => {\n\t\t\tif (!role.isAdmin) {\n\t\t\t\tpermissionsState[role._id][action] = value;\n\t\t\t}\n\t\t});\n\n\t\tsaveToHistory();\n\t\tupdateParent();\n\t\tshowToast(`${action} ${value ? 'enabled' : 'disabled'} for all roles`, 'success');\n\t}\n\n\t// Apply preset\n\tfunction applyPreset(roleId: string, presetKey: string) {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\n\t\tif (role?.isAdmin) {\n\t\t\tshowToast('Cannot modify permissions for admin role', 'warning');\n\t\t\treturn;\n\t\t}\n\n\t\tconst preset = presets[presetKey as keyof typeof presets];\n\t\tif (preset) {\n\t\t\tpermissionsState[roleId] = { ...preset.permissions };\n\t\t\tsaveToHistory();\n\t\t\tupdateParent();\n\t\t\tshowToast(`Applied \"${preset.name}\" preset to ${role?.name}`, 'success');\n\t\t}\n\t}\n\n\t// Update parent\n\tfunction updateParent() {\n\t\tconst cleanedPermissions = Object.entries(permissionsState).reduce((acc, [roleId, perms]) => {\n\t\t\tconst hasRestrictions = Object.values(perms).some((value) => value === false);\n\t\t\tif (hasRestrictions) {\n\t\t\t\tacc[roleId] = perms;\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, {} as PermissionsMap);\n\n\t\tonUpdate(cleanedPermissions);\n\t}\n\n\t// Export permissions\n\tfunction exportPermissions() {\n\t\tconst data = JSON.stringify(permissionsState, null, 2);\n\t\tconst blob = new Blob([data], { type: 'application/json' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `permissions-${new Date().toISOString().split('T')[0]}.json`;\n\t\ta.click();\n\t\tURL.revokeObjectURL(url);\n\t\tshowToast('Permissions exported', 'success');\n\t}\n\n\t// Import permissions\n\tasync function importPermissions(event: Event) {\n\t\tconst input = event.target as HTMLInputElement;\n\t\tconst file = input.files?.[0];\n\n\t\tif (!file) return;\n\n\t\ttry {\n\t\t\tconst text = await file.text();\n\t\t\tconst imported = JSON.parse(text);\n\t\t\tpermissionsState = { ...permissionsState, ...imported };\n\t\t\tsaveToHistory();\n\t\t\tupdateParent();\n\t\t\tshowToast('Permissions imported successfully', 'success');\n\t\t} catch (err) {\n\t\t\tshowToast('Failed to import permissions', 'error');\n\t\t\terror = 'Invalid permissions file';\n\t\t}\n\t}\n\n\t// Filter roles\n\tconst filteredRoles = $derived(\n\t\troles.filter(\n\t\t\t(role) => role.name.toLowerCase().includes(searchQuery.toLowerCase()) || role.description?.toLowerCase().includes(searchQuery.toLowerCase())\n\t\t)\n\t);\n\n\t// Count enabled permissions per role\n\tfunction countEnabledPermissions(roleId: string): number {\n\t\treturn Object.values(permissionsState[roleId] || {}).filter(Boolean).length;\n\t}\n\n\tconst totalActions = $derived(Object.values(PermissionAction).length);\n\n\t// Lifecycle\n\tonMount(() => {\n\t\tconst mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n\t\tprefersReducedMotion = mediaQuery.matches;\n\n\t\tconst handleChange = (e: MediaQueryListEvent) => {\n\t\t\tprefersReducedMotion = e.matches;\n\t\t};\n\n\t\tmediaQuery.addEventListener('change', handleChange);\n\n\t\t// Initialize history\n\t\tsaveToHistory();\n\n\t\treturn () => mediaQuery.removeEventListener('change', handleChange);\n\t});\n</script>\n\n{#if error}\n\t<div\n\t\tclass=\"rounded-lg border-l-4 border-error-500 bg-error-50 p-4 text-error-700 dark:bg-error-900/20 dark:text-error-300\"\n\t\trole=\"alert\"\n\t\ttransition:fade={{ duration: prefersReducedMotion ? 0 : 200 }}\n\t>\n\t\t<div class=\"flex items-start gap-3\">\n\t\t\t<span class=\"text-2xl\" role=\"img\" aria-label=\"Error\">⚠️</span>\n\t\t\t<div class=\"flex-1\">\n\t\t\t\t<p class=\"font-semibold\">Error</p>\n\t\t\t\t<p class=\"mt-1 text-sm\">{error}</p>\n\t\t\t</div>\n\t\t\t<button onclick={() => (error = null)} class=\"preset-outlined-error-500 btn-sm\" aria-label=\"Dismiss error\"> Dismiss </button>\n\t\t</div>\n\t</div>\n{:else}\n\t<div class=\"flex flex-col gap-4\" role=\"region\" aria-label=\"Permission settings\">\n\t\t<!-- Toolbar -->\n\t\t<div class=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n\t\t\t<!-- Search -->\n\t\t\t<div class=\"flex-1\">\n\t\t\t\t<input bind:value={searchQuery} placeholder=\"Search roles...\" class=\"input w-full\" type=\"search\" aria-label=\"Search roles\" />\n\t\t\t</div>\n\n\t\t\t<!-- Actions -->\n\t\t\t<div class=\"flex flex-wrap gap-2\">\n\t\t\t\t<!-- Undo/Redo -->\n\t\t\t\t<button onclick={undo} disabled={!canUndo} class=\"preset-outlined-surface-500btn btn-sm\" title=\"Undo\" aria-label=\"Undo last change\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:undo\" width=\"18\"></iconify-icon>\n\t\t\t\t</button>\n\t\t\t\t<button onclick={redo} disabled={!canRedo} class=\"preset-outlined-surface-500btn btn-sm\" title=\"Redo\" aria-label=\"Redo last change\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:redo\" width=\"18\"></iconify-icon>\n\t\t\t\t</button>\n\n\t\t\t\t<!-- Bulk Actions Toggle -->\n\t\t\t\t<button onclick={() => (showBulkActions = !showBulkActions)} class=\"preset-outlined-primary-500 btn-sm\" aria-expanded={showBulkActions}>\n\t\t\t\t\t<iconify-icon icon=\"mdi:cog-box\" width=\"18\"></iconify-icon>\n\t\t\t\t\tBulk Actions\n\t\t\t\t</button>\n\n\t\t\t\t<!-- Export -->\n\t\t\t\t<button\n\t\t\t\t\tonclick={exportPermissions}\n\t\t\t\t\tclass=\"preset-outlined-primary-500 btn-sm\"\n\t\t\t\t\ttitle=\"Export permissions\"\n\t\t\t\t\taria-label=\"Export permissions as JSON\"\n\t\t\t\t>\n\t\t\t\t\t<iconify-icon icon=\"mdi:download\" width=\"18\"></iconify-icon>\n\t\t\t\t</button>\n\n\t\t\t\t<!-- Import -->\n\t\t\t\t<label class=\"preset-outlined-warning-500 btn-sm cursor-pointer\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:upload\" width=\"18\"></iconify-icon>\n\t\t\t\t\t<input type=\"file\" accept=\".json\" onchange={importPermissions} class=\"hidden\" aria-label=\"Import permissions from JSON\" />\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Bulk Actions Panel -->\n\t\t{#if showBulkActions}\n\t\t\t<div\n\t\t\t\tclass=\"rounded-lg border border-primary-200 bg-primary-50 p-4 dark:border-primary-800 dark:bg-primary-900/20\"\n\t\t\t\ttransition:slide={{ duration: prefersReducedMotion ? 0 : 200 }}\n\t\t\t>\n\t\t\t\t<h3 class=\"mb-3 text-sm font-semibold\">Bulk Actions</h3>\n\t\t\t\t<div class=\"flex flex-wrap gap-2\">\n\t\t\t\t\t{#each Object.values(PermissionAction) as action (action)}\n\t\t\t\t\t\t<div class=\"flex gap-1\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonclick={() => setPermissionForAllRoles(action, true)}\n\t\t\t\t\t\t\t\tclass=\"preset-filled-success-500 btn-sm\"\n\t\t\t\t\t\t\t\ttitle={`Enable ${action} for all roles`}\n\t\t\t\t\t\t\t\taria-label={`Enable ${action} for all roles`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<iconify-icon icon={actionIcons[action]} width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t✓\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonclick={() => setPermissionForAllRoles(action, false)}\n\t\t\t\t\t\t\t\tclass=\"preset-filled-error-500 btn-sm\"\n\t\t\t\t\t\t\t\ttitle={`Disable ${action} for all roles`}\n\t\t\t\t\t\t\t\taria-label={`Disable ${action} for all roles`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<iconify-icon icon={actionIcons[action]} width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t✗\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<!-- Permissions Table -->\n\t\t<div class=\"overflow-x-auto rounded-lg border border-surface-200 dark:text-surface-50\">\n\t\t\t<table class=\"table w-full\" role=\"grid\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th scope=\"col\" class=\"px-4 py-3 text-left\">\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\tRole\n\t\t\t\t\t\t\t\t<span class=\"text-xs font-normal opacity-70\">\n\t\t\t\t\t\t\t\t\t({filteredRoles.length})\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</th>\n\t\t\t\t\t\t{#each Object.values(PermissionAction) as action (action)}\n\t\t\t\t\t\t\t<th scope=\"col\" class=\"px-4 py-3 text-center\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-col items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<iconify-icon icon={actionIcons[action]} width=\"20\" aria-hidden=\"true\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t<span class=\"text-xs\">{action}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t<th scope=\"col\" class=\"px-4 py-3 text-center\"> Actions </th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t{#each filteredRoles as role (role._id)}\n\t\t\t\t\t\t<tr class=\"border-t border-surface-200 dark:text-surface-50\">\n\t\t\t\t\t\t\t<!-- Role Info -->\n\t\t\t\t\t\t\t<th scope=\"row\" class=\"px-4 py-3\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-col gap-1\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"font-semibold\">{role.name}</span>\n\t\t\t\t\t\t\t\t\t\t{#if role.isAdmin}\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge preset-filled-primary-500 text-xs\"> Admin </span>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{#if role.description}\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-xs text-surface-600 dark:text-surface-50\">\n\t\t\t\t\t\t\t\t\t\t\t{role.description}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<span class=\"text-xs font-medium text-primary-500\">\n\t\t\t\t\t\t\t\t\t\t{countEnabledPermissions(role._id)}/{totalActions} enabled\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</th>\n\n\t\t\t\t\t\t\t<!-- Permission Toggles -->\n\t\t\t\t\t\t\t{#each Object.values(PermissionAction) as action (action)}\n\t\t\t\t\t\t\t\t<td class=\"px-4 py-3 text-center\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={() => togglePermission(role._id, action)}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\taria-label={`${permissionsState[role._id]?.[action] ? 'Disable' : 'Enable'} ${action} for ${role.name}`}\n\t\t\t\t\t\t\t\t\t\tclass=\"btn-icon transition-all duration-200 {permissionsState[role._id]?.[action]\n\t\t\t\t\t\t\t\t\t\t\t? 'preset-filled-success-500 hover:scale-110'\n\t\t\t\t\t\t\t\t\t\t\t: 'preset-filled-error-500 opacity-50 hover:opacity-100 hover:scale-110'} {role.isAdmin ? 'cursor-not-allowed opacity-30' : ''}\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\t\ticon={permissionsState[role._id]?.[action] ? 'mdi:check' : 'mdi:check'}\n\t\t\t\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\t\t\t\tclass={permissionsState[role._id]?.[action] ? 'text-white' : 'text-white'}\n\t\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t\t<!-- Row Actions -->\n\t\t\t\t\t\t\t<td class=\"px-4 py-3 text-center\">\n\t\t\t\t\t\t\t\t<div class=\"flex justify-center gap-1\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={() => setAllPermissionsForRole(role._id, true)}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\tclass=\"preset-outlined-primary-500 btn-sm\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Enable all\"\n\t\t\t\t\t\t\t\t\t\taria-label={`Enable all permissions for ${role.name}`}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t✓ All\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonclick={() => setAllPermissionsForRole(role._id, false)}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\tclass=\"preset-outlined-error-500 btn-sm\"\n\t\t\t\t\t\t\t\t\t\ttitle=\"Disable all\"\n\t\t\t\t\t\t\t\t\t\taria-label={`Disable all permissions for ${role.name}`}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t✗ All\n\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t<!-- Preset Dropdown -->\n\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\tonchange={(e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst target = e.target as HTMLSelectElement;\n\t\t\t\t\t\t\t\t\t\t\tif (target.value) {\n\t\t\t\t\t\t\t\t\t\t\t\tapplyPreset(role._id, target.value);\n\t\t\t\t\t\t\t\t\t\t\t\ttarget.value = '';\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tdisabled={role.isAdmin}\n\t\t\t\t\t\t\t\t\t\tclass=\"input w-auto px-2 py-1 text-xs\"\n\t\t\t\t\t\t\t\t\t\taria-label={`Apply preset to ${role.name}`}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<option value=\"\">Preset...</option>\n\t\t\t\t\t\t\t\t\t\t{#each Object.entries(presets) as [key, preset] (key)}\n\t\t\t\t\t\t\t\t\t\t\t<option value={key}>{preset.name}</option>\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/each}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\n\t\t<!-- No Results -->\n\t\t{#if filteredRoles.length === 0}\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col items-center gap-3 rounded-lg bg-surface-50 py-12 text-center dark:bg-surface-800\"\n\t\t\t\ttransition:fade={{ duration: prefersReducedMotion ? 0 : 200 }}\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"mdi:magnify-close\" width=\"48\" class=\"text-surface-400\"></iconify-icon>\n\t\t\t\t<p class=\"text-surface-600 dark:text-surface-50\">\n\t\t\t\t\tNo roles match your search for \"<span class=\"font-medium\">{searchQuery}</span>\"\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n{/if}\n","/**\n * @file src/widgets/widgetFactory.ts\n * @description The definitive, type-safe Widget Factory for SveltyCMS.\n *\n * @features\n * - Generic-based for supreme type safety on widget-specific properties.\n * - Implements the \"Three Pillars\" architecture: Definition, Input, and Display.\n * - Integrates Valibot for declarative, type-safe data validation.\n * - Clean, modern, and free of legacy patterns.\n */\n\nimport type { BaseIssue, BaseSchema } from 'valibot';\nimport type { FieldInstance } from '@cms-types';\nimport type { WidgetDefinition, WidgetFactory } from '@widgets/types';\n\n// A base constraint for widget-specific properties.\ntype WidgetProps = Record<string, unknown>;\n\nexport type FieldConfig<TProps extends WidgetProps = WidgetProps> = {\n\twidget?: any;\n\tlabel?: string;\n\tdb_fieldName?: string;\n\tpermissions?: any;\n\t[key: string]: any;\n} & TProps;\n\n/**\n * The configuration for DEFINING a widget's blueprint.\n * It's generic over the widget's custom props (TProps).\n */\nexport interface WidgetConfig<TProps extends WidgetProps = WidgetProps> {\n\tName: string;\n\tIcon?: string;\n\tDescription?: string;\n\n\t/** Path to the interactive INPUT component used in the editor (e.g., Fields.svelte). */\n\tinputComponentPath?: string;\n\n\t/** Path to the lightweight DISPLAY component for lists (e.g., EntryList.svelte). */\n\tdisplayComponentPath?: string;\n\n\t/** Type-safe default values for the widget's custom properties. */\n\tdefaults?: Partial<TProps>;\n\n\t/**\n\t * Valibot validation schema for the widget's data.\n\t *  Accepts either a static schema object (Valibot BaseSchema) or a function that receives the FieldInstance and returns one.\n\t *  Kept as `unknown` to avoid over-constraining the factory; callers may provide properly-typed Valibot schemas.\n\t */\n\tvalidationSchema: unknown | ((field: FieldInstance) => unknown);\n\n\t// Optional advanced features\n\tGuiSchema?: Record<string, unknown>;\n\tGraphqlSchema?: (params: { field: unknown; label: string; collection: unknown; collectionNameMapping?: Map<string, string> }) => {\n\t\ttypeID: string | null;\n\t\tgraphql: string;\n\t\tresolver?: Record<string, unknown>;\n\t};\n\taggregations?: unknown;\n\n\t/** Optional function to return widget-specific translatable paths. */\n\tgetTranslatablePaths?: (basePath: string) => string[];\n}\n\n/**\n * Creates a new SveltyCMS widget factory.\n * @param config The static definition of the widget (its blueprint).\n * @returns A function that can be called to create type-safe field instances.\n */\nexport function createWidget<TProps extends WidgetProps = WidgetProps>(config: WidgetConfig<TProps>): WidgetFactory<TProps> {\n\t// 1. Create the immutable widget definition once.\n\t// This now includes all the \"Three Pillars\" information.\n\tconst widgetDefinition: WidgetDefinition = {\n\t\twidgetId: config.Name,\n\t\tName: config.Name,\n\t\tIcon: config.Icon,\n\t\tDescription: config.Description,\n\t\tinputComponentPath: config.inputComponentPath || '',\n\t\tdisplayComponentPath: config.displayComponentPath || '',\n\t\t// validationSchema may be a function or a static schema. Keep as-is so other systems can call it.\n\t\tvalidationSchema: config.validationSchema as unknown as BaseSchema<unknown, unknown, BaseIssue<unknown>>,\n\t\tdefaults: config.defaults,\n\t\tGuiFields: config.GuiSchema || ({} as Record<string, unknown>),\n\t\taggregations: config.aggregations as WidgetDefinition['aggregations'],\n\t\tgetTranslatablePaths: config.getTranslatablePaths\n\t\t// ... other definition properties like GraphqlSchema\n\t};\n\n\t// 2. Return the factory function that creates field instances.\n\tconst widgetFactoryFunction = (fieldConfig: FieldConfig<TProps>): FieldInstance => {\n\t\tconst fieldInstance: FieldInstance = {\n\t\t\twidget: widgetDefinition,\n\t\t\tlabel: fieldConfig.label, // Will be overridden by fieldConfig later if present\n\t\t\tdb_fieldName: '', // Will be set below\n\t\t\trequired: false, // Will be overridden by fieldConfig or config.defaults later\n\t\t\ttranslated: false, // Will be overridden by fieldConfig or config.defaults later\n\t\t\twidth: undefined, // Will be overridden by fieldConfig or config.defaults later\n\t\t\thelper: undefined, // Will be overridden by fieldConfig or config.defaults later\n\t\t\tpermissions: undefined // Will be overridden by fieldConfig or config.defaults later\n\t\t} as FieldInstance; // Cast to FieldInstance to allow adding custom properties\n\n\t\t// 1. Apply defaults from config.defaults (for custom properties)\n\t\tif (config.defaults) {\n\t\t\t// logger.debug(`[WidgetFactory] Applying defaults for ${config.Name}`, { defaults: config.defaults });\n\t\t\tfor (const key in config.defaults) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(config.defaults, key)) {\n\t\t\t\t\tconst value = (config.defaults as Record<string, unknown>)[key];\n\t\t\t\t\t(fieldInstance as Record<string, unknown>)[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 2. Apply fieldConfig properties, overriding defaults and initial standard values\n\t\tfor (const key in fieldConfig) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(fieldConfig, key)) {\n\t\t\t\tconst value = (fieldConfig as Record<string, unknown>)[key];\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t// Only apply if not undefined\n\t\t\t\t\t(fieldInstance as Record<string, unknown>)[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 3. Handle specific standard property defaults and generation after all merges\n\t\tfieldInstance.required = fieldInstance.required ?? false;\n\t\tfieldInstance.translated = fieldInstance.translated ?? false;\n\t\tif (!fieldInstance.db_fieldName && fieldInstance.label) {\n\t\t\tfieldInstance.db_fieldName = fieldInstance.label\n\t\t\t\t.toLowerCase()\n\t\t\t\t.replace(/\\s+/g, '_')\n\t\t\t\t.replace(/[^a-z0-9_]/g, '');\n\t\t} else if (!fieldInstance.db_fieldName) {\n\t\t\tfieldInstance.db_fieldName = 'unnamed_field';\n\t\t}\n\n\t\treturn fieldInstance;\n\t};\n\n\t// 3. Attach metadata to the factory for compatibility with existing system\n\twidgetFactoryFunction.Name = config.Name;\n\twidgetFactoryFunction.Icon = config.Icon;\n\twidgetFactoryFunction.Description = config.Description;\n\twidgetFactoryFunction.GuiSchema = config.GuiSchema;\n\twidgetFactoryFunction.GraphqlSchema = config.GraphqlSchema;\n\twidgetFactoryFunction.aggregations = config.aggregations as WidgetDefinition['aggregations'];\n\twidgetFactoryFunction.__inputComponentPath = config.inputComponentPath || '';\n\twidgetFactoryFunction.__displayComponentPath = config.displayComponentPath || '';\n\twidgetFactoryFunction.toString = () => '';\n\n\t// 4. Return the clean factory.\n\treturn widgetFactoryFunction as WidgetFactory<TProps>;\n}\n","/**\n * @file src/widgets/core/Checkbox/index.ts\n * @description Definition of the Checkbox widget\n *\n * Implements a robust date range widget using the Three Pillars Architecture.\n *\n * @features\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { boolean, type InferInput as ValibotInput } from 'valibot';\n\nimport type { CheckboxProps } from './types';\n\n// ParaglideJS\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the data this widget stores.\nconst CheckboxValidationSchema = boolean('Must be a boolean.');\n\n// Create the widget definition using the factory.\nconst CheckboxWidget = createWidget<CheckboxProps>({\n\tName: 'Checkbox',\n\tIcon: 'tabler:checkbox',\n\tDescription: m.widget_checkbox_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Checkbox/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Checkbox/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: CheckboxValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tcolor: 'primary',\n\t\tsize: 'md',\n\t\ttranslated: false // A simple boolean is typically not translated.\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false }\n\t},\n\n\t// Correct database aggregation logic for booleans.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [{ $match: { [field.db_fieldName]: filter === 'true' } }],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema should return a simple Boolean.\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Boolean', // Use primitive Boolean type\n\t\tgraphql: '' // No custom type definition needed for primitives\n\t})\n});\n\nexport default CheckboxWidget;\n\n// Export helper types for use in Svelte components.\nexport type FieldType = ReturnType<typeof CheckboxWidget>;\nexport type CheckboxWidgetData = ValibotInput<typeof CheckboxValidationSchema>;\n","/**\n * @file src/widgets/core/Date/index.ts\n * @description Date Widget Definition\n *\n * Implements date widget using the Three Pillars Architecture.\n * Stores dates in ISO 8601 UTC format for consistency across timezones while\n * providing localized display and native HTML date input experience.\n *\n * @features\n * - **ISO 8601 Storage**: All dates stored in standardized UTC format\n * - **Valibot Validation**: Type-safe validation with runtime checking\n * - **Three Pillars Architecture**: Separated Definition/Input/Display components\n * - **Timezone Consistency**: Handles user timezones transparently\n * - **Database Aggregation**: Advanced filtering and sorting for date ranges\n * - **Localized Display**: Automatic formatting based on user's browser locale\n * - **Native Date Picker**: Uses browser's built-in date input for optimal UX\n * - **Error Handling**: Deterministic IDs, proper error handling\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { isoDate, minLength, pipe, string, type InferInput as ValibotInput } from 'valibot';\n\nimport type { DateProps } from './types';\n\n// ParaglideJS\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the data this widget stores.\nconst DateValidationSchema = pipe(\n\tstring('A value is required.'), // This message shows if the value is not a string\n\tminLength(1, 'This date is required.'), // This message shows for empty strings\n\tisoDate('The date must be a valid ISO 8601 string.')\n);\n\n// Create the widget definition using the factory.\nconst DateWidget = createWidget<DateProps>({\n\tName: 'Date',\n\tIcon: 'mdi:calendar',\n\tDescription: m.widget_date_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Date/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Date/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: DateValidationSchema,\n\n\t// Set widget-specific defaults. A date is typically not translated.\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false },\n\t\tminDate: { widget: Input, required: false },\n\t\tmaxDate: { widget: Input, required: false },\n\t\tdisplayFormat: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\tplaceholder: 'medium (short, medium, long, full)'\n\t\t}\n\t},\n\n\t// Define correct database aggregation logic for dates.\n\taggregations: {\n\t\t/**\n\t\t * Filters entries based on a date or date range.\n\t\t * Expects filter string format: \"YYYY-MM-DD\" or \"YYYY-MM-DD_YYYY-MM-DD\"\n\t\t */\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => {\n\t\t\tconst fieldName = field.db_fieldName;\n\t\t\tconst [startDateStr, endDateStr] = filter.split('_');\n\n\t\t\tconst startDate = new Date(startDateStr);\n\t\t\tstartDate.setUTCHours(0, 0, 0, 0); // Start of the day\n\n\t\t\tif (isNaN(startDate.getTime())) return []; // Invalid date\n\n\t\t\t// Handle date range\n\t\t\tif (endDateStr) {\n\t\t\t\tconst endDate = new Date(endDateStr);\n\t\t\t\tendDate.setUTCHours(23, 59, 59, 999); // End of the day\n\t\t\t\tif (!isNaN(endDate.getTime())) {\n\t\t\t\t\treturn [{ $match: { [fieldName]: { $gte: startDate, $lte: endDate } } }];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Handle single day\n\t\t\tconst endOfDay = new Date(startDate);\n\t\t\tendOfDay.setUTCHours(23, 59, 59, 999);\n\t\t\treturn [{ $match: { [fieldName]: { $gte: startDate, $lte: endOfDay } } }];\n\t\t},\n\t\t// Sorts entries by the date field.\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for date\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // ISO 8601 date string\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default DateWidget;\n\n// Export helper types for use in Svelte components\nexport type FieldType = ReturnType<typeof DateWidget>;\nexport type DateWidgetData = ValibotInput<typeof DateValidationSchema>;\n","/**\n * @file src/widgets/core/Daterange/index.ts\n * @description DateRange Widget Definition.\n *\n * Implements a robust date range widget using the Three Pillars Architecture.\n * Stores a start and end date object in ISO 8601 UTC format.\n *\n * @features\n * - **Complex Object Storage**: Manages a `{ start, end }` data structure.\n * - **Advanced Validation**: Uses Valibot `refine` to ensure end date is after start date.\n * - **Timezone Consistency**: Stores all dates in UTC to prevent timezone bugs.\n * - **Database Aggregation**: Powerful filter to find entries where a date falls within the range.\n * - **Native Date Pickers**: Uses two native date inputs for a lightweight and accessible UX.\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { check, isoDate, minLength, object, pipe, string, type InferInput as ValibotInput } from 'valibot';\n\nimport type { DateRangeProps } from './types';\n\n//ParaglideJS\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the `{ start, end }` object.\nconst DateRangeValidationSchema = pipe(\n\tobject({\n\t\tstart: pipe(string(), minLength(1, 'Start date is required.'), isoDate()),\n\t\tend: pipe(string(), minLength(1, 'End date is required.'), isoDate())\n\t}),\n\tcheck((data) => new Date(data.start) <= new Date(data.end), 'End date must be on or after the start date.')\n);\n\n// Create the widget definition using the factory.\nconst DateRangeWidget = createWidget<DateRangeProps>({\n\tName: 'DateRange',\n\tIcon: 'mdi:calendar-range',\n\tDescription: m.widget_dateRange_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Daterange/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Daterange/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: DateRangeValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false }\n\t},\n\n\t// Define database aggregation logic for date ranges.\n\taggregations: {\n\t\t/**\n\t\t * Filters for entries where the provided date falls within the entry's date range.\n\t\t * Expects filter string format: \"YYYY-MM-DD\"\n\t\t */\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => {\n\t\t\tconst fieldName = field.db_fieldName;\n\t\t\tconst filterDate = new Date(filter);\n\t\t\tif (isNaN(filterDate.getTime())) return [];\n\n\t\t\t// Find documents where the filterDate is between the start and end fields.\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\t$match: {\n\t\t\t\t\t\t[`${fieldName}.start`]: { $lte: filterDate },\n\t\t\t\t\t\t[`${fieldName}.end`]: { $gte: filterDate }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t},\n\t\t// Sorting will be based on the start date of the range.\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[`${field.db_fieldName}.start`]: sortDirection\n\t\t})\n\t}\n});\n\nexport default DateRangeWidget;\n\n// Export helper types for use in Svelte components.\nexport type FieldType = ReturnType<typeof DateRangeWidget>;\nexport type DateRangeWidgetData = ValibotInput<typeof DateRangeValidationSchema>;\n","/**\n * @file src/widgets/core/Group/index.ts\n * @description Group Widget Definition.\n *\n * Implements a Group widget using the Three Pillars Architecture.\n * Groups multiple fields together for better organization and user experience.\n *\n * @features\n * - **Field Organization**: Groups related fields together visually\n * - **Collapsible Sections**: Optional collapsible functionality for better UX\n * - **Visual Variants**: Different styling options (default, card, bordered)\n * - **Accessibility**: Proper ARIA attributes and keyboard navigation\n * - **Responsive Design**: Adapts to different screen sizes\n * - **Nested Structure**: Can contain other widgets within the group\n */\n\n// Components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\nimport { object, type InferInput as ValibotInput } from 'valibot';\n\nimport type { GroupProps } from './types';\n\n// Define the validation schema for the group data.\n// Groups can contain any data structure, so we use a flexible object schema.\nconst GroupValidationSchema = object({});\n\n// Create the widget definition using the factory.\nconst GroupWidget = createWidget<GroupProps>({\n\tName: 'Group',\n\tIcon: 'mdi:folder-outline',\n\tDescription: 'Group related fields together',\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Group/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Group/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: GroupValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tcollapsible: false,\n\t\tcollapsed: false,\n\t\tvariant: 'default'\n\t},\n\n\t// Pass the GuiSchema directly into the widget's definition.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tgroupTitle: { widget: Input, required: false },\n\t\tcollapsible: { widget: Toggles, required: false },\n\t\tcollapsed: { widget: Toggles, required: false },\n\t\tvariant: { widget: Input, required: false },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false }\n\t},\n\n\t// Groups don't typically need database aggregations as they contain other widgets\n\taggregations: {}\n});\n\nexport default GroupWidget;\n\n// Export helper types for use in Svelte components.\nexport type FieldType = ReturnType<typeof GroupWidget>;\nexport type GroupWidgetData = ValibotInput<typeof GroupValidationSchema>;\n","/**\n * @file src/widgets/core/Input/index.ts\n * @description Input Widget Definition - Text Input\n *\n * Implements a professional text input widget using the Three Pillars Architecture.\n * This widget is specialized for text content and supports full translation capabilities.\n *\n * @features\n * - **Text-Only**: Focused implementation for text content (use specialized widgets for email/phone/number)\n * - **Dynamic Validation**: Schema is generated based on `required`, `minLength`, `maxLength`, etc.\n * - **Configurable GUI**: `GuiSchema` allows easy configuration in the Collection Builder.\n * - **Translatable**: Fully supports multilingual content entry by default.\n * - **Database Aggregation**: Supports case-insensitive text search and sorting.\n * - **Character Counting**: Visual feedback for length constraints\n * - **Prefix/Suffix Support**: Flexible UI composition\n */\n\n// Import components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport {\n\tmaxLength,\n\tminLength,\n\toptional,\n\tpipe,\n\tstring,\n\ttransform,\n\ttype BaseIssue,\n\ttype BaseSchema,\n\ttype InferInput as ValibotInput,\n\trecord\n} from 'valibot';\nimport type { InputProps } from './types';\n\n// ✅ SSOT: Validation Schema - Exported for use in Input.svelte\nexport const createValidationSchema = (field: ReturnType<typeof InputWidget>): BaseSchema<unknown, unknown, BaseIssue<unknown>> => {\n\t// Build a string schema with text-specific rules\n\tconst stringRules: Array<unknown> = [transform((s: string) => (typeof s === 'string' ? s.trim() : s))];\n\n\tif (field.required) stringRules.push(minLength(1, 'This field is required.'));\n\tif ((field as InputProps).minLength)\n\t\tstringRules.push(minLength((field as InputProps).minLength as number, `Must be at least ${(field as InputProps).minLength} characters.`));\n\tif ((field as InputProps).maxLength)\n\t\tstringRules.push(maxLength((field as InputProps).maxLength as number, `Must be no more than ${(field as InputProps).maxLength} characters.`));\n\n\t// Build the base string schema\n\tconst schema: BaseSchema<unknown, unknown, BaseIssue<unknown>> = pipe(string(), ...(stringRules as unknown as []));\n\n\t// Translated fields store an object with language keys -> validate as flexible object\n\tif (field.translated) {\n\t\treturn optional(record(string(), string()), {});\n\t}\n\n\t// If not required, allow optional empty value\n\treturn field.required ? schema : optional(schema, '');\n};\n\n// Create the widget definition using the factory.\nconst InputWidget = createWidget<InputProps>({\n\tName: 'Input',\n\tIcon: 'mdi:form-textbox',\n\tDescription: m.widget_text_description(),\n\tinputComponentPath: '/src/widgets/core/Input/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Input/Display.svelte',\n\n\tvalidationSchema: createValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: true\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ttranslated: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false },\n\t\tplaceholder: { widget: Input, required: false },\n\t\tminLength: { widget: Input, required: false },\n\t\tmaxLength: { widget: Input, required: false },\n\t\tprefix: { widget: Input, required: false },\n\t\tsuffix: { widget: Input, required: false },\n\t\tcount: { widget: Input, required: false }\n\t},\n\n\t// Aggregations for text search and sorting.\n\taggregations: {\n\t\tfilters: async ({ field, filter, contentLanguage }: { field: AggregationField; filter: string; contentLanguage: string }) => [\n\t\t\t{ $match: { [`${field.db_fieldName}.${contentLanguage}`]: { $regex: filter, $options: 'i' } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection, contentLanguage }: { field: AggregationField; sortDirection: number; contentLanguage: string }) => ({\n\t\t\t[`${field.db_fieldName}.${contentLanguage}`]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for text input\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Use primitive String type\n\t\tgraphql: '' // No custom type definition needed for primitives\n\t})\n});\n\nexport default InputWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof InputWidget>;\nexport type InputWidgetData = ValibotInput<ReturnType<typeof createValidationSchema>>;\n","/**\n * @file src/widgets/core/MediaUpload/index.ts\n * @description Media Widget Definition.\n *\n * Implements a powerful media selector using the Three Pillars Architecture.\n * Stores references (IDs) to media files, keeping content documents lightweight.\n *\n * @features\n * - **Relational Data**: Stores media IDs, not the full media objects.\n * - **Dynamic Validation**: Schema adapts to `multiupload` (single ID vs. array of IDs).\n * - **Modal-Based UX**: Designed to work with a separate media library modal.\n * - **Advanced Aggregation**: Performs a `$lookup` to filter/sort based on actual media metadata.\n */\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport Checkbox from '@widgets/core/Checkbox/index';\nimport Input from '@widgets/core/Input/index';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\nimport { array, minLength, optional, pipe, string, type BaseIssue, type BaseSchema, type InferInput as ValibotInput } from 'valibot';\nimport type { MediaProps } from './types';\n\n// ✅ SSOT: Validation Schema - Exported for use in Input.svelte\nexport const createValidationSchema = (field: ReturnType<typeof MediaWidget>): BaseSchema<unknown, unknown, BaseIssue<unknown>> => {\n\t// The base schema for a single media ID (must be a non-empty string).\n\tconst idSchema = pipe(string(), minLength(1, 'A media file is required.'));\n\n\t// If multiupload is enabled, the value should be an array of IDs.\n\tif (field.multiupload) {\n\t\tconst arraySchema = array(idSchema);\n\t\t// If the field is required, the array must not be empty.\n\t\treturn field.required ? pipe(arraySchema, minLength(1, 'At least one media file is required.')) : optional(arraySchema);\n\t}\n\n\t// Otherwise, the value is just a single ID string.\n\treturn field.required ? idSchema : optional(idSchema, '');\n};\n\n// Create the widget definition using the factory.\nconst MediaWidget = createWidget<MediaProps>({\n\tName: 'MediaUpload',\n\tIcon: 'mdi:image-multiple',\n\tDescription: m.widget_media_description(),\n\tinputComponentPath: '/src/widgets/core/MediaUpload/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/MediaUpload/Display.svelte',\n\tvalidationSchema: createValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tmultiupload: false,\n\t\tallowedTypes: []\n\t},\n\n\tGuiSchema: {\n\t\tmultiupload: { widget: Checkbox, label: 'Allow Multiple Files' },\n\t\twatermark: {\n\t\t\twidget: 'group',\n\t\t\tlabel: 'Watermark Options',\n\t\t\tfields: {\n\t\t\t\ttext: { widget: Input, label: 'Watermark Text' },\n\t\t\t\tposition: { widget: Input, label: 'Position (e.g., center, top-right)' },\n\t\t\t\topacity: { widget: Input, label: 'Opacity (0-1)' },\n\t\t\t\tscale: { widget: Input, label: 'Scale (e.g., 0.5 for 50%)' }\n\t\t\t}\n\t\t}\n\t},\n\n\t// Aggregation performs a lookup to search by the actual media file name.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t// Join with the 'media_files' collection.\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: 'media_files',\n\t\t\t\t\tlocalField: field.db_fieldName,\n\t\t\t\t\tforeignField: '_id',\n\t\t\t\t\tas: 'media_docs'\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Filter based on the name of the joined media files.\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\t'media_docs.name': { $regex: filter, $options: 'i' }\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t\t// Sorting would follow a similar `$lookup` pattern.\n\t}\n});\n\nexport default MediaWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof MediaWidget>;\nexport type MediaWidgetData = ValibotInput<ReturnType<typeof createValidationSchema>>;\n","/**\n * @file src/widgets/core/megamenu/index.ts\n * @description MegaMenu Widget Definition.\n *\n * A powerful builder widget for creating nested, hierarchical menu structures.\n * Features advanced drag-and-drop, modal editing, permissions, and comprehensive validation.\n *\n * @features\n * - **Recursive Validation**: Uses Valibot's `lazy` schema to validate a nested data structure.\n * - **Hierarchical Data**: Stores a tree of menu items with parent-child relationships.\n * - **Configurable Levels**: `fields` property allows defining different widgets for each menu depth.\n * - **Drag & Drop**: Visual reordering with advanced positioning logic.\n * - **Modal Editing**: Integrated modal system for item configuration.\n * - **Permissions**: Role-based access control for menu operations.\n * - **Aggregations**: Advanced filtering and sorting capabilities.\n * - **Clean Data Contract**: Stores a clean, predictable array of `MenuItem` objects.\n */\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { array, maxLength, object, pipe, string } from 'valibot';\nimport type { MegaMenuProps, MenuItem } from './types';\n\n// SECURITY: Define a base schema for a nested menu item's data with validation\nconst MenuItemSchema = object({\n\t_id: pipe(string(), maxLength(100)),\n\t_fields: object({}), // The fields inside validated separately\n\tchildren: array(object({})) // Nested children with same structure\n});\n\n// The top-level schema is an array of these menu items.\nconst MegaMenuValidationSchema = array(MenuItemSchema);\n\n// Create the widget definition using the factory.\nconst MegaMenuWidget = createWidget({\n\tName: 'MegaMenu',\n\tIcon: 'lucide:menu-square',\n\tDescription: m.widget_megaMenu_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/megamenu/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/megamenu/Display.svelte',\n\n\t// Assign the validation schema.\n\tvalidationSchema: MegaMenuValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tfields: [],\n\t\tmaxDepth: 5,\n\t\tenableDragDrop: true,\n\t\tenableExpandCollapse: true\n\t}\n});\n\n// Helper function for recursive operations\nexport const traverseMenuItems = (\n\titems: MenuItem[],\n\tcallback: (item: MenuItem, level: number, parent?: MenuItem) => void,\n\tlevel = 0,\n\tparent?: MenuItem\n): void => {\n\titems.forEach((item) => {\n\t\tcallback(item, level, parent);\n\t\tif (item.children && item.children.length > 0) {\n\t\t\ttraverseMenuItems(item.children, callback, level + 1, item);\n\t\t}\n\t});\n};\n\n// Helper function to find menu item by path\nexport const findMenuItemByPath = (items: MenuItem[], path: number[]): MenuItem | null => {\n\tlet currentItems = items;\n\tlet targetItem: MenuItem | null = null;\n\n\tfor (const index of path) {\n\t\tif (index >= 0 && index < currentItems.length) {\n\t\t\ttargetItem = currentItems[index];\n\t\t\tcurrentItems = targetItem.children;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\treturn targetItem;\n};\n\n// Helper function to validate menu structure\nexport const validateMenuStructure = (items: MenuItem[], config: MegaMenuProps): { valid: boolean; errors: string[] } => {\n\tconst errors: string[] = [];\n\tconst maxDepth = config.maxDepth || 5;\n\n\t// Check depth constraints\n\tconst checkDepth = (item: MenuItem, currentDepth = 0): void => {\n\t\tif (currentDepth > maxDepth) {\n\t\t\terrors.push(`Menu item \"${item._fields?.title || item._id}\" exceeds maximum depth of ${maxDepth}`);\n\t\t}\n\t\titem.children.forEach((child) => checkDepth(child, currentDepth + 1));\n\t};\n\n\t// Check other constraints\n\tconst checkConstraints = (item: MenuItem): void => {\n\t\tconst childrenCount = item.children.length;\n\t\tconst maxChildren = config.validationRules?.maxChildrenPerParent;\n\n\t\tif (maxChildren && childrenCount > maxChildren) {\n\t\t\terrors.push(`Menu item \"${item._fields?.title || item._id}\" has ${childrenCount} children, maximum allowed is ${maxChildren}`);\n\t\t}\n\n\t\titem.children.forEach(checkConstraints);\n\t};\n\n\titems.forEach((item) => {\n\t\tcheckDepth(item);\n\t\tcheckConstraints(item);\n\t});\n\n\treturn {\n\t\tvalid: errors.length === 0,\n\t\terrors\n\t};\n};\n\nexport default MegaMenuWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof MegaMenuWidget>;\n","/**\n * @file src/widgets/core/Radio/index.ts\n * @description Radio Widget Definition.\n *\n * Implements a radio button group for selecting a single option from a list.\n *\n * @features\n * - **Dynamic Options**: Configurable with a list of `label`/`value` pairs.\n * - **Strict Validation**: Valibot schema ensures the selected value is one of the allowed options.\n * - **Accessible**: The `Input.svelte` component uses `fieldset` and `legend` for accessibility.\n * - **Clean Data Storage**: Stores only the primitive value of the selected option.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { literal, optional, union, type InferInput as ValibotInput } from 'valibot';\nimport type { RadioProps, RadioOption } from './types';\n\n// The validation schema is a function that generates rules based on the configured options.\nconst validationSchema = (field: FieldInstance & RadioProps) => {\n\t// Extract the allowed values from the field's options array.\n\tconst allowedValues = (field.options as RadioOption[] | undefined)?.map((opt) => literal(opt.value)) || [];\n\n\t// Create a schema that only allows one of the specified literal values.\n\t// This provides powerful, automatic validation.\n\tconst schema = union([...allowedValues], 'Please select a valid option.');\n\n\t// If the field is not required, the value can be null or undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst RadioWidget = createWidget<RadioProps>({\n\tName: 'Radio',\n\tIcon: 'mdi:radiobox-marked',\n\tDescription: m.widget_radio_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/Radio/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Radio/Display.svelte',\n\n\t// Assign the dynamic validation schema.\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\toptions: [],\n\t\ttranslated: false, // A single selection is not typically translated.\n\t\tlegend: ''\n\t},\n\n\t// GuiSchema allows a simple text area for defining options in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tlegend: { widget: Input, required: false, helper: 'Legend text for the radio group' },\n\t\toptions: {\n\t\t\twidget: Input, // Using a simple textarea for JSON/JS array input\n\t\t\trequired: true,\n\t\t\thelper: \"Enter an array of objects, e.g., [{label: 'First', value: 1}, {label: 'Second', value: 2}]\"\n\t\t}\n\t},\n\n\t// GraphQL schema for radio\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Radio value as string\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default RadioWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RadioWidget>;\nexport type RadioWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","<!--\n@file src/components/system/builder/CollectionPicker.svelte\n@description Component for selecting a collection from available collections\n-->\n\n<script lang=\"ts\">\n\timport { collections } from '@shared/stores/collectionStore.svelte';\n\n\tinterface Props {\n\t\tvalue?: string;\n\t}\n\n\tlet { value = $bindable('') }: Props = $props();\n\n\timport type { Schema } from '@cms-types/content';\n\t// Get collection names\n\tconst collectionNames = $derived(Object.values((collections as any).all as Record<string, Schema>).map((c) => c.name));\n</script>\n\n<div class=\"m-1 flex max-w-full items-center justify-between gap-2\">\n\t<label for=\"collection-select\" class=\"w-32 flex-none\">Collection</label>\n\t<select id=\"collection-select\" class=\"input grow text-black dark:text-primary-500\" bind:value>\n\t\t<option value=\"\">Select a collection</option>\n\t\t{#each collectionNames as name}\n\t\t\t<option value={name}>{name}</option>\n\t\t{/each}\n\t</select>\n</div>\n","<!--\n@file src/components/system/builder/FieldPicker.svelte\n@description Component for selecting a field from the fields of a selected collection\n-->\n\n<script lang=\"ts\">\n\timport { collections } from '@shared/stores/collectionStore.svelte';\n\n\tinterface Props {\n\t\tvalue?: string;\n\t\tcollection?: string;\n\t}\n\n\tlet { value = $bindable(''), collection = '' }: Props = $props();\n\n\timport type { Schema } from '@cms-types/content';\n\t// Get fields for the selected collection\n\tconst selectedCollection = $derived(Object.values((collections as any).all as Record<string, Schema>).find((c) => c.name === collection));\n\tconst fieldNames = $derived(selectedCollection?.fields?.map((f: any) => f.db_fieldName).filter(Boolean) || []);\n</script>\n\n<div class=\"m-1 flex max-w-full items-center justify-between gap-2\">\n\t<label for=\"field-select\" class=\"w-32 flex-none\">Display Field</label>\n\t<select id=\"field-select\" class=\"input grow text-black dark:text-primary-500\" bind:value disabled={!collection}>\n\t\t<option value=\"\">Select a field</option>\n\t\t{#each fieldNames as name}\n\t\t\t<option value={name}>{name}</option>\n\t\t{/each}\n\t</select>\n</div>\n","/**\n * @file src/widgets/core/Relation/index.ts\n * @description Relation (One-to-One) Widget Definition.\n *\n * Implements a one-to-one relationship selector. Stores a single string ID\n * referencing an entry in another collection.\n *\n * @features\n * - **Relational Data**: Stores a single foreign key (ID).\n * - **Configurable GUI**: `GuiSchema` provides an intuitive UI for the collection builder.\n * - **Modal-Based UX**: Designed to work with a selection modal for a clean UX.\n * - **Advanced Aggregation**: Performs a `$lookup` to filter/sort by the related entry's data.\n */\n\n// Import components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport PermissionsSetting from '@cms/components/PermissionsSetting.svelte';\nimport CollectionPicker from '@cms/components/system/builder/CollectionPicker.svelte';\nimport FieldPicker from '@cms/components/system/builder/FieldPicker.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\n\n// Type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; collection: string; displayField: string; [key: string]: unknown };\n\nimport { minLength, optional, pipe, string, type InferInput as ValibotInput } from 'valibot';\nimport type { RelationProps } from './types';\n\n// The validation schema ensures the value is a string ID.\nconst validationSchema = (field: FieldInstance) => {\n\tconst idSchema = pipe(string(), minLength(1, 'An entry must be selected.'));\n\treturn field.required ? idSchema : optional(idSchema, '');\n};\n\n// Create the widget definition using the factory.\nconst RelationWidget = createWidget<RelationProps>({\n\tName: 'Relation',\n\tIcon: 'mdi:relation-one-to-one',\n\tDescription: m.widget_relation_description(),\n\tinputComponentPath: '/src/widgets/core/Relation/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/Relation/Display.svelte',\n\tvalidationSchema,\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\t// Standard fields\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ticon: { widget: IconifyPicker, required: false },\n\t\thelper: { widget: Input, required: false },\n\t\twidth: { widget: Input, required: false },\n\t\tpermissions: { widget: PermissionsSetting, required: false },\n\n\t\t// Widget-specific fields\n\t\tcollection: {\n\t\t\twidget: CollectionPicker, // A dropdown to select a collection\n\t\t\trequired: true\n\t\t},\n\t\tdisplayField: {\n\t\t\twidget: FieldPicker, // A dropdown to select a field from the chosen collection\n\t\t\trequired: true\n\t\t}\n\t},\n\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\t// Aggregation performs a lookup to search by the related entry's displayField.\n\t// SECURITY: Includes tenant isolation to prevent IDOR attacks\n\taggregations: {\n\t\tfilters: async ({ field, filter, tenantId }: { field: AggregationField; filter: string; tenantId?: string }) => [\n\t\t\t{ $lookup: { from: field.collection, localField: field.db_fieldName, foreignField: '_id', as: 'related_doc' } },\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\t...(tenantId ? { 'related_doc.tenantId': tenantId } : {}),\n\t\t\t\t\t[`related_doc.${field.displayField}`]: { $regex: filter, $options: 'i' }\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => {\n\t\t\t// SECURITY: Tenant-aware sorting\n\t\t\treturn {\n\t\t\t\t[`${field.db_fieldName}.${field.displayField}`]: sortDirection\n\t\t\t};\n\t\t}\n\t},\n\n\t// GraphQL schema for relation (returns ID of related document)\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Related document ID\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default RelationWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RelationWidget>;\nexport type RelationWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/core/RichText/index.ts\n * @description RichText Widget Definition.\n *\n * Implements a Tiptap-based rich text editor with a highly configurable toolbar\n * and a secure, clean data contract.\n *\n * @features\n * - **Configurable Toolbar**: The `toolbar` prop determines which editing features are available.\n * - **Advanced Validation**: Valibot schema validates the title and intelligently checks if content is empty.\n * - **Secure by Design**: Designed to work with a display component that sanitizes HTML.\n * - **Translatable**: Fully supports multilingual content by default.\n */\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { object, optional, pipe, string, custom, type InferInput } from 'valibot';\nimport type { RichTextProps } from './types';\n\n// Helper to strip HTML-like tags and angle brackets from a string.\n// This is intentionally aggressive and is only used for \"is empty\" checks,\n// not for producing HTML to render.\nconst stripHtmlTags = (html: string): string => {\n\tif (!html) return '';\n\n\tlet previous: string;\n\tlet current = html;\n\n\t// Repeatedly remove tags like <tag ...> until no more matches remain.\n\t// This avoids issues where a single multi-character replacement\n\t// can cause previously hidden patterns to reappear.\n\tdo {\n\t\tprevious = current;\n\t\tcurrent = current.replace(/<[^>]*>/g, '');\n\t} while (current !== previous);\n\n\t// Remove any remaining angle brackets to avoid partial tag fragments\n\t// such as \"<script\" surviving the stripping process.\n\tcurrent = current.replace(/[<>]/g, '');\n\n\treturn current;\n};\n\n// Helper to check if HTML content is effectively empty.\n// NOTE: Input.svelte already sanitizes with DOMPurify before storage,\n// so we don't need to remove scripts here (defense-in-depth handled upstream)\nconst isContentEmpty = (html: string) => {\n\tif (!html) return true;\n\n\t// Strip all HTML tags and angle brackets to check for actual text content.\n\tconst stripped = stripHtmlTags(html).trim();\n\n\treturn stripped.length === 0;\n};\n\n// The validation schema is a function to accommodate the `required` flag.\nconst validationSchema = (field: FieldInstance) => {\n\t// The base schema for the rich text data object.\n\tconst schema = object({\n\t\ttitle: optional(string()), // Title can be optional.\n\t\tcontent: string() // HTML content.\n\t});\n\n\t// If the field is required, validate that content is not empty\n\tif (field.required) {\n\t\treturn object({\n\t\t\ttitle: optional(string()),\n\t\t\tcontent: pipe(\n\t\t\t\tstring(),\n\t\t\t\tcustom((input) => !isContentEmpty(input as string), 'Content is required.')\n\t\t\t)\n\t\t});\n\t}\n\n\treturn optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst RichTextWidget = createWidget<RichTextProps>({\n\tName: 'RichText',\n\tIcon: 'mdi:format-pilcrow-arrow-right',\n\tDescription: m.widget_richText_description(),\n\n\t// Define paths to the dedicated Svelte components.\n\tinputComponentPath: '/src/widgets/core/RichText/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/core/RichText/Display.svelte',\n\n\t// Assign the validation schema function.\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\t// Provide a default full toolbar configuration.\n\t\ttoolbar: ['bold', 'italic', 'headings', 'lists', 'link', 'image', 'align', 'clear'],\n\t\ttranslated: true\n\t}\n});\n\nexport default RichTextWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RichTextWidget>;\nexport type RichTextWidgetData = InferInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Address/index.ts\n * @description Address Widget Definition.\n *\n * A comprehensive widget for capturing and displaying structured address data,\n * optionally integrated with an interactive map for geocoding.\n *\n * @features\n * - **Structured Data**: Stores a complete, well-defined address object.\n * - **Configurable GUI**: `GuiSchema` provides a UI for setting widget-specific props.\n * - **Geocoding Support**: Integrates with Mapbox for visual location picking.\n * - **Valibot Schema**: Ensures all parts of the address are correctly formatted.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport { createWidget } from '@widgets/widgetFactory';\nimport { object, string, number, minLength, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { AddressProps } from './types';\nimport * as m from '@shared/paraglide/messages';\n\n// Define the validation schema for the address data object.\nconst AddressValidationSchema = object({\n\tstreet: pipe(string(), minLength(1, 'Street is required.')),\n\thouseNumber: string(),\n\tpostalCode: pipe(string(), minLength(1, 'Postal code is required.')),\n\tcity: pipe(string(), minLength(1, 'City is required.')),\n\tcountry: pipe(string(), minLength(2, 'Country is required.')),\n\tlatitude: number(),\n\tlongitude: number()\n});\n\n// Create the widget definition using the factory.\nconst AddressWidget = createWidget<AddressProps>({\n\tName: 'Address',\n\tIcon: 'mdi:home-map-marker',\n\tDescription: m.widget_address_description(),\n\tinputComponentPath: '/src/widgets/custom/Address/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Address/Display.svelte',\n\tvalidationSchema: AddressValidationSchema,\n\n\t// Define the UI for configuring this widget's properties in the Collection Builder.\n\tGuiSchema: {\n\t\t// Standard fields\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\twidth: { widget: Input, required: false },\n\n\t\t// Widget-specific fields from AddressProps\n\t\tdefaultCountry: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\thelper: \"Default 2-letter country code (e.g., 'DE', 'US').\"\n\t\t},\n\t\tmapCenter: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\thelper: \"Default map center (e.g., '51.34,6.57').\"\n\t\t},\n\t\tzoom: { widget: Input, required: false, helper: 'Default map zoom level (e.g., 12).' },\n\t\thiddenFields: {\n\t\t\twidget: Input,\n\t\t\trequired: false,\n\t\t\thelper: \"Comma-separated list of fields to hide (e.g., 'latitude,longitude').\"\n\t\t}\n\t},\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tmapCenter: { lat: 51.34, lng: 6.57 },\n\t\tzoom: 12,\n\t\tdefaultCountry: 'DE',\n\t\thiddenFields: [],\n\t\ttranslated: false\n\t},\n\n\tgetTranslatablePaths: (basePath: string) => {\n\t\treturn [`${basePath}.street`, `${basePath}.postalCode`, `${basePath}.city`, `${basePath}.country`];\n\t}\n});\n\nexport default AddressWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof AddressWidget>;\nexport type AddressWidgetData = ValibotInput<typeof AddressValidationSchema>;\n","/**\n * @file src/widgets/custom/ColorPicker/index.ts\n * @description ColorPicker Widget Definition.\n *\n * Implements an intuitive color picker using the Three Pillars Architecture.\n * Stores a standard 6-digit hex color code as a string.\n *\n * @features\n * - **Simple Data Contract**: Stores a single, clean hex color string (e.g., '#FFFFFF').\n * - **Robust Validation**: Valibot schema ensures the value is a valid hex code.\n * - **Configurable GUI**: `GuiSchema` allows easy configuration in the Collection Builder.\n * - **Native Color Picker**: Uses the browser's native color input for a good UX.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { minLength, optional, pipe, regex, string, type InferInput as ValibotInput } from 'valibot';\nimport type { ColorPickerProps } from './types';\n\n// The validation schema is a function to accommodate the `required` flag.\nconst validationSchema = (field: FieldInstance) => {\n\t// Base schema validates the hex color format.\n\tconst hexSchema = pipe(string(), regex(/^#[0-9a-f]{6}$/i, 'Must be a valid 6-digit hex code (e.g., #FF5733).'));\n\n\t// If the field is required, ensure it's not an empty string before checking the format.\n\tif (field.required) {\n\t\treturn pipe(string(), minLength(1, 'A color is required.'), hexSchema);\n\t}\n\n\t// If not required, allow an empty string or a valid hex code.\n\treturn optional(hexSchema, '');\n};\n\n// Create the widget definition using the factory.\nconst ColorPickerWidget = createWidget<ColorPickerProps>({\n\tName: 'ColorPicker',\n\tIcon: 'ic:outline-colorize',\n\tDescription: m.widget_colorPicker_description(),\n\tinputComponentPath: '/src/widgets/custom/ColorPicker/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/ColorPicker/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults. A color is a universal value.\n\tdefaults: {\n\t\ttranslated: false\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\twidth: { widget: Input, required: false }\n\t}\n});\n\nexport default ColorPickerWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof ColorPickerWidget>;\nexport type ColorPickerWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Currency/index.ts\n * @description Currency Widget Definition.\n *\n * Implements a robust currency input widget that stores a precise number\n * while displaying and accepting localized, formatted currency strings.\n *\n * @features\n * - **Numeric Storage**: Stores currency as a `number` for accuracy.\n * - **Dynamic Validation**: Schema adapts to `required`, `minValue`, and `maxValue` settings.\n * - **Internationalization**: Uses `Intl.NumberFormat` for locale-aware formatting.\n * - **Configurable GUI**: `GuiSchema` allows easy setup in the Collection Builder.\n * - **Database Aggregation**: Supports numeric filtering (e.g., price > 100) and sorting.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { maxValue, minValue, number, optional, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { CurrencyProps } from './types';\n\n// Helper type for aggregation field\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// Build validation actions based on field config\n\tconst validationActions: Array<ReturnType<typeof minValue> | ReturnType<typeof maxValue>> = [];\n\n\tif (field.minValue !== undefined) {\n\t\tvalidationActions.push(minValue(field.minValue as number, `Value must be at least ${field.minValue}.`));\n\t}\n\tif (field.maxValue !== undefined) {\n\t\tvalidationActions.push(maxValue(field.maxValue as number, `Value must not exceed ${field.maxValue}.`));\n\t}\n\n\t// Create final schema with validations\n\tconst baseSchema = number('Value must be a number.');\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tconst schema = validationActions.length > 0 ? pipe(baseSchema, ...(validationActions as any)) : baseSchema;\n\n\t// If the field is not required, wrap the schema to allow it to be undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst CurrencyWidget = createWidget<CurrencyProps>({\n\tName: 'Currency',\n\tIcon: 'mdi:currency-usd',\n\tDescription: m.widget_currency_description(),\n\tinputComponentPath: '/src/widgets/custom/Currency/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Currency/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tcurrencyCode: 'EUR',\n\t\ttranslated: false // A monetary value is typically not translated.\n\t},\n\n\t// SECURITY: Validate ISO 4217 currency codes\n\t// validCurrencyCodes: ['USD', 'EUR', 'GBP', 'JPY', 'CNY', 'AUD', 'CAD', 'CHF', 'HKD', 'SGD', 'SEK', 'NOK', 'NZD', 'KRW', 'TRY', 'INR', 'BRL', 'ZAR'],\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tcurrencyCode: {\n\t\t\twidget: Input,\n\t\t\trequired: true,\n\t\t\thelper: 'ISO 4217 code (USD, EUR, GBP, etc.)',\n\t\t\tpattern: '^[A-Z]{3}$'\n\t\t},\n\t\tminValue: { widget: Input, required: false },\n\t\tmaxValue: { widget: Input, required: false },\n\t\tplaceholder: { widget: Input, required: false }\n\t},\n\n\t// Aggregations perform numeric comparisons.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t// Example: filter=\">100\" or filter=\"<50\" or filter=\"150\"\n\t\t\t// This requires a simple parser for the filter string.\n\t\t\t{ $match: { [field.db_fieldName]: { $eq: parseFloat(filter) } } } // Simplified for exact match\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for currency\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Float', // Use Float for currency values\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default CurrencyWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof CurrencyWidget>;\nexport type CurrencyWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Email/index.ts\n * @description Email Widget Definition.\n *\n * Implements a robust email input widget using the Three Pillars Architecture.\n *\n * @features\n * - **Email Validation**: Uses Valibot's `email()` validator for strong format checking.\n * - **Simple Data Contract**: Stores a single, clean email string.\n * - **Non-Translatable**: Correctly treats email addresses as universal, non-translatable data.\n * - **Configurable GUI**: `GuiSchema` allows for easy setup in the Collection Builder.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { custom, email, minLength, optional, pipe, string, type InferInput as ValibotInput } from 'valibot';\nimport type { EmailProps } from './types';\n\n// SECURITY: Common disposable email domains to block\nconst DISPOSABLE_DOMAINS = [\n\t'tempmail.com',\n\t'guerrillamail.com',\n\t'10minutemail.com',\n\t'mailinator.com',\n\t'throwaway.email',\n\t'yopmail.com',\n\t'temp-mail.org',\n\t'getnada.com'\n];\n\nconst blockDisposableEmail = custom((input: unknown) => {\n\tif (typeof input !== 'string') return false;\n\tconst domain = input.split('@')[1]?.toLowerCase();\n\treturn !DISPOSABLE_DOMAINS.includes(domain);\n}, 'Disposable email addresses are not allowed');\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// Start with a base string schema that requires a valid email format.\n\tconst baseSchema = pipe(string(), email('Please enter a valid email address.'), blockDisposableEmail as any);\n\n\t// If the field is required, also ensure it's not empty.\n\tconst schema = field.required\n\t\t? pipe(string(), minLength(1, 'This field is required.'), email('Please enter a valid email address.'), blockDisposableEmail as any)\n\t\t: baseSchema;\n\n\t// If not required, wrap the schema to allow it to be optional.\n\treturn field.required ? schema : optional(schema, '');\n};\n\n// Create the widget definition using the factory.\nconst EmailWidget = createWidget<EmailProps>({\n\tName: 'Email',\n\tIcon: 'ic:outline-email',\n\tDescription: m.widget_email_description(),\n\tinputComponentPath: '/src/widgets/custom/Email/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Email/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: false // An email address should not be translatable.\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tplaceholder: { widget: Input, required: false }\n\t},\n\n\t// GraphQL schema for email input\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // Use primitive String type\n\t\tgraphql: '' // No custom type definition needed for primitives\n\t})\n});\n\nexport default EmailWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof EmailWidget>;\nexport type EmailWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Number/index.ts\n * @description Number Widget Definition.\n *\n * Implements a robust number input widget that stores a precise number.\n *\n * @features\n * - **Numeric Storage**: Stores data as a `number` for accuracy and calculations.\n * - **Dynamic Validation**: Schema adapts to `required`, `min`, and `max` settings.\n * - **Native Number Input**: Uses `<input type=\"number\">` for optimal UX and accessibility.\n * - **Database Aggregation**: Supports numeric filtering (e.g., value > 100) and sorting.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { maxValue, minValue, number, optional, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { NumberProps } from './types';\n\n// Helper type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// Build validation actions based on field config\n\tconst validationActions: Array<ReturnType<typeof minValue> | ReturnType<typeof maxValue>> = [];\n\n\tif (field.min !== undefined) {\n\t\tvalidationActions.push(minValue(field.min as number, `Value must be at least ${field.min}.`));\n\t}\n\tif (field.max !== undefined) {\n\t\tvalidationActions.push(maxValue(field.max as number, `Value must not exceed ${field.max}.`));\n\t}\n\n\t// Create final schema with validations\n\tconst baseSchema = number('Value must be a number.');\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tconst schema = validationActions.length > 0 ? pipe(baseSchema, ...(validationActions as any)) : baseSchema;\n\n\t// If the field is not required, wrap the schema to allow it to be undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst NumberWidget = createWidget<NumberProps>({\n\tName: 'Number',\n\tIcon: 'mdi:numeric',\n\tDescription: m.widget_number_description(),\n\tinputComponentPath: '/src/widgets/custom/Number/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Number/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tstep: 1,\n\t\ttranslated: false // A number is a universal value.\n\t},\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tmin: { widget: Input, required: false, helper: 'Minimum allowed value.' },\n\t\tmax: { widget: Input, required: false, helper: 'Maximum allowed value.' },\n\t\tstep: { widget: Input, required: false, helper: 'Stepping interval.' },\n\t\tplaceholder: { widget: Input, required: false }\n\t},\n\n\t// Aggregations perform numeric comparisons.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t// Example: filter=\">100\" or filter=\"<50\" or filter=\"150\"\n\t\t\t{ $match: { [field.db_fieldName]: { $eq: parseFloat(filter) } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for number\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Float', // Use Float for numeric values\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default NumberWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof NumberWidget>;\nexport type NumberWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/phonenumber/index.ts\n * @description PhoneNumber Widget Definition.\n *\n * Implements a robust phone number input that stores a simple string.\n *\n * @features\n * - **Dynamic Validation**: Uses a custom `pattern` if provided, otherwise defaults to E.164 international format.\n * - **Semantic HTML**: The input component uses `<input type=\"tel\">` for accessibility.\n * - **Actionable Display**: The display component renders a clickable `tel:` link.\n * - **Configurable GUI**: `GuiSchema` allows for easy setup in the Collection Builder.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { minLength, optional, pipe, regex, string, type InferInput as ValibotInput } from 'valibot';\nimport type { PhoneNumberProps } from './types';\n\n// SECURITY: More robust phone validation\n// E.164 format: +[country code][subscriber number]\n// Country code: 1-3 digits, Subscriber: up to 15 total digits\nconst validationSchema = (field: FieldInstance) => {\n\t// Improved regex for E.164 international format\n\tconst defaultPattern = /^\\+[1-9]\\d{1,3}[\\d\\s-]{4,14}$/;\n\tconst validationMessage = 'Please enter a valid international phone number (e.g., +49 123 456789)';\n\n\t// Use the custom pattern from the field config, or fall back to the default.\n\tconst validationPattern = field.pattern ? new RegExp(field.pattern as string) : defaultPattern;\n\n\t// Start with a base string schema that includes the regex validation.\n\tconst baseSchema = pipe(string(), regex(validationPattern, validationMessage));\n\n\t// If the field is required, also ensure it's not empty.\n\tconst schema = field.required\n\t\t? pipe(string(), minLength(1, 'This field is required.'), regex(validationPattern, validationMessage) as any)\n\t\t: baseSchema;\n\n\t// If not required, wrap the schema to allow it to be optional.\n\treturn field.required ? schema : optional(schema, '');\n};\n\n// Create the widget definition using the factory.\nconst PhoneNumberWidget = createWidget<PhoneNumberProps>({\n\tName: 'PhoneNumber',\n\tIcon: 'ic:baseline-phone-in-talk',\n\tDescription: m.widget_phoneNumber_description(),\n\tinputComponentPath: '/src/widgets/custom/PhoneNumber/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/PhoneNumber/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\ttranslated: false // A phone number should not be translatable.\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tplaceholder: { widget: Input, required: false },\n\t\tpattern: { widget: Input, required: false, helper: 'Optional: Custom regex for validation.' }\n\t}\n});\n\nexport default PhoneNumberWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof PhoneNumberWidget>;\nexport type PhoneNumberWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/Rating/index.ts\n * @description Rating Widget Definition.\n *\n * Implements an interactive star rating widget.\n *\n * @features\n * - **Numeric Storage**: Stores the rating as a simple `number`.\n * - **Dynamic Validation**: Schema adapts to the `max` rating setting.\n * - **Configurable GUI**: `GuiSchema` allows for easy setup in the Collection Builder.\n * - **Database Aggregation**: Supports numeric filtering (e.g., rating >= 4) and sorting.\n */\n\n// Import components needed for the GuiSchema\nimport IconifyPicker from '@cms/components/IconifyPicker.svelte';\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport type { FieldInstance } from '@cms-types';\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { maxValue, minValue, number, optional, pipe, type InferInput as ValibotInput } from 'valibot';\nimport type { RatingProps } from './types';\n\n// Helper type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// The validation schema is a function to create rules based on the field config.\nconst validationSchema = (field: FieldInstance) => {\n\t// The maximum value is determined by the field's config, defaulting to 5.\n\tconst max = (field.max || 5) as number;\n\n\t// Start with a base number schema.\n\tconst schema = pipe(number('Rating must be a number.'), minValue(1, 'A rating is required.'), maxValue(max, `Rating cannot exceed ${max}.`));\n\n\t// If the field is not required, wrap the schema to allow it to be undefined.\n\treturn field.required ? schema : optional(schema);\n};\n\n// Create the widget definition using the factory.\nconst RatingWidget = createWidget<RatingProps>({\n\tName: 'Rating',\n\tIcon: 'material-symbols:star-outline',\n\tDescription: m.widget_rating_description(),\n\tinputComponentPath: '/src/widgets/custom/Rating/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Rating/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tmax: 5,\n\t\ticonFull: 'material-symbols:star',\n\t\ticonEmpty: 'material-symbols:star-outline',\n\t\ttranslated: false\n\t},\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tmax: { widget: Input, required: false, helper: 'Maximum number of stars.' },\n\t\ticonFull: { widget: IconifyPicker, required: false },\n\t\ticonEmpty: { widget: IconifyPicker, required: false }\n\t},\n\n\t// Aggregations perform numeric comparisons.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t{ $match: { [field.db_fieldName]: { $eq: parseInt(filter, 10) } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[field.db_fieldName]: sortDirection\n\t\t})\n\t},\n\n\t// GraphQL schema for rating\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'Int', // Use Int for rating values\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default RatingWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RatingWidget>;\nexport type RatingWidgetData = ValibotInput<ReturnType<typeof validationSchema>>;\n","/**\n * @file src/widgets/custom/RemoteVideo/index.ts\n * @description RemoteVideo Widget Definition.\n *\n * Implements a dynamic widget for embedding videos from various remote platforms\n * (YouTube, Vimeo, Twitch, TikTok). Stores rich video metadata and handles\n * server-side API fetching for security and performance.\n *\n * @features\n * - **Structured Metadata**: Stores a comprehensive `RemoteVideoData` object.\n * - **Dynamic Validation**: Ensures URL validity and platform compatibility.\n * - **Server-Side APIs**: Delegates metadata fetching to a server endpoint to protect API keys.\n * - **Configurable Platforms**: `allowedPlatforms` limits video sources.\n * - **GraphQL Schema**: Defines a structured GraphQL type for video data.\n */\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { custom, literal, minLength, number, object, optional, pipe, string, union, url, type InferInput as ValibotInput } from 'valibot';\n\n// Helper type for aggregation field parameter\ntype AggregationField = { db_fieldName: string; [key: string]: unknown };\n\n// SECURITY: Strict URL validation to prevent SSRF\nconst SAFE_VIDEO_URL_PATTERNS = [\n\t/^https?:\\/\\/(www\\.)?(youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([a-zA-Z0-9_-]{11})/,\n\t/^https?:\\/\\/(www\\.)?vimeo\\.com\\/\\d+$/,\n\t/^https?:\\/\\/(www\\.)?twitch\\.tv\\/videos\\/\\d+$/,\n\t/^https?:\\/\\/(www\\.)?tiktok\\.com\\/@[\\w.-]+\\/video\\/\\d+$/\n];\n\n// Define the validation schema for the RemoteVideoData object.\nconst RemoteVideoDataSchema = object({\n\tplatform: union([literal('youtube'), literal('vimeo'), literal('twitch'), literal('tiktok'), literal('other')]),\n\turl: pipe(\n\t\tstring(),\n\t\turl('Must be a valid video URL.'),\n\t\tcustom((input) => {\n\t\t\tconst str = input as string;\n\t\t\treturn SAFE_VIDEO_URL_PATTERNS.some((pattern) => pattern.test(str));\n\t\t}, 'URL must be from an allowed video platform (YouTube, Vimeo, Twitch, or TikTok)')\n\t),\n\tvideoId: pipe(string(), minLength(1, 'Video ID is required.')),\n\ttitle: pipe(string(), minLength(1, 'Video title is required.')),\n\tthumbnailUrl: pipe(string(), url('Must be a valid thumbnail URL.')),\n\tchannelTitle: optional(string()),\n\tduration: optional(string()),\n\twidth: optional(number()),\n\theight: optional(number()),\n\tpublishedAt: optional(string())\n});\n\n// The validation schema for the remote video data.\nconst validationSchema = RemoteVideoDataSchema;\n\n// Create the widget definition using the factory.\nconst RemoteVideoWidget = createWidget({\n\tName: 'RemoteVideo',\n\tIcon: 'mdi:video-vintage',\n\tDescription: m.widget_remoteVideo_description(),\n\tinputComponentPath: '/src/widgets/custom/RemoteVideo/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/RemoteVideo/Display.svelte',\n\tvalidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tplaceholder: 'Enter video URL (YouTube, Vimeo, Twitch, TikTok)',\n\t\tallowedPlatforms: ['youtube', 'vimeo', 'twitch', 'tiktok'],\n\t\ttranslated: false // Video metadata is not typically translated per-field.\n\t},\n\n\t// Define the UI for configuring this widget in the Collection Builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\tplaceholder: { widget: Input, required: false },\n\t\tallowedPlatforms: {\n\t\t\twidget: Input, // A multi-select component would be better here in a real CMS.\n\t\t\trequired: false,\n\t\t\thelper: \"Comma-separated platforms (e.g., 'youtube,vimeo').\"\n\t\t}\n\t},\n\n\t// Aggregations filter/sort by video title.\n\taggregations: {\n\t\tfilters: async ({ field, filter }: { field: AggregationField; filter: string }) => [\n\t\t\t{ $match: { [`${field.db_fieldName}.title`]: { $regex: filter, $options: 'i' } } }\n\t\t],\n\t\tsorts: async ({ field, sortDirection }: { field: AggregationField; sortDirection: number }) => ({\n\t\t\t[`${field.db_fieldName}.title`]: sortDirection\n\t\t})\n\t},\n\n\t// Define the GraphQL schema for the RemoteVideoData object.\n\tGraphqlSchema: ({ label }: { label: string }) => ({\n\t\ttypeID: label, // Using the label as the GraphQL type name.\n\t\tgraphql: `\n            type ${label} {\n                platform: String!\n                url: String!\n                videoId: String!\n                title: String!\n                thumbnailUrl: String!\n                channelTitle: String\n                duration: String\n                width: Int\n                height: Int\n                publishedAt: String\n            }\n        `\n\t})\n});\n\nexport default RemoteVideoWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof RemoteVideoWidget>;\nexport type RemoteVideoWidgetData = ValibotInput<typeof validationSchema>;\n","/**\n * @file src/widgets/custom/Seo/index.ts\n * @description SEO Widget Definition.\n *\n * An SEO analysis and optimization tool embedded as a widget.\n *\n * @features\n * - **Comprehensive Validation**: Valibot schema validates the entire SEO data object, including length checks.\n * - **Structured Data**: Stores a single, clean `SeoData` object.\n * - **Configurable Features**: The `features` prop allows tailoring the UI for different needs.\n * - **Translatable**: Fully supports multilingual SEO content.\n */\n\nimport * as m from '@shared/paraglide/messages';\nimport { createWidget } from '@widgets/widgetFactory';\nimport { custom, literal, maxLength, object, optional, pipe, regex, string, transform, union, url, type InferInput as ValibotInput } from 'valibot';\n\n// Import components needed for the GuiSchema\nimport Input from '@cms/components/system/inputs/Input.svelte';\nimport Toggles from '@cms/components/system/inputs/Toggles.svelte';\n\n// SECURITY: Escape HTML entities to prevent meta tag injection\nconst escapeHtml = (str: string): string => {\n\treturn str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#039;');\n};\n\n// Define a robust validation schema for the SeoData object.\nconst SeoValidationSchema = object({\n\ttitle: pipe(string(), maxLength(60, 'Title should be under 60 characters.'), transform(escapeHtml)),\n\tdescription: pipe(string(), maxLength(160, 'Description should be under 160 characters.'), transform(escapeHtml)),\n\tfocusKeyword: pipe(string(), transform(escapeHtml)),\n\t// Advanced\n\trobotsMeta: pipe(string(), transform(escapeHtml)),\n\tcanonicalUrl: optional(pipe(string(), url('Must be a valid URL.'), regex(/^https?:\\/\\//, 'Must use HTTP or HTTPS protocol'))),\n\t// Social\n\togTitle: optional(string()),\n\togDescription: optional(string()),\n\togImage: optional(string()), // ID of a media file\n\ttwitterCard: union([literal('summary'), literal('summary_large_image')]),\n\ttwitterTitle: optional(string()),\n\ttwitterDescription: optional(string()),\n\ttwitterImage: optional(string()), // ID of a media file\n\t// Schema - SECURITY: Validate JSON structure\n\tschemaMarkup: optional(\n\t\tpipe(\n\t\t\tstring(),\n\t\t\tcustom((input) => {\n\t\t\t\tif (!input) return true;\n\t\t\t\ttry {\n\t\t\t\t\tconst parsed = JSON.parse(input as string);\n\t\t\t\t\t// Must be an object, not a string or array at root level\n\t\t\t\t\treturn typeof parsed === 'object' && !Array.isArray(parsed);\n\t\t\t\t} catch {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}, 'Must be valid JSON object')\n\t\t)\n\t)\n});\n\n// Create the widget definition using the factory.\nconst SeoWidget = createWidget({\n\tName: 'SEO',\n\tIcon: 'tabler:seo',\n\tDescription: m.widget_seo_description(),\n\tinputComponentPath: '/src/widgets/custom/Seo/Input.svelte',\n\tdisplayComponentPath: '/src/widgets/custom/Seo/Display.svelte',\n\tvalidationSchema: SeoValidationSchema,\n\n\t// Set widget-specific defaults.\n\tdefaults: {\n\t\tfeatures: ['social', 'schema', 'advanced', 'ai'],\n\t\ttranslated: true\n\t},\n\n\t// Validation - defines which fields are translatable\n\tgetTranslatablePaths: (basePath: string) => {\n\t\t// Return only fields that contribute to the global translation status\n\t\t// Exclude technical fields like robotsMeta, canonicalUrl which have defaults\n\t\treturn [\n\t\t\t`${basePath}.title`,\n\t\t\t`${basePath}.description`,\n\t\t\t`${basePath}.focusKeyword`,\n\t\t\t`${basePath}.ogTitle`,\n\t\t\t`${basePath}.ogDescription`,\n\t\t\t`${basePath}.twitterTitle`,\n\t\t\t`${basePath}.twitterDescription`,\n\t\t\t`${basePath}.schemaMarkup`\n\t\t];\n\t},\n\n\t// GuiSchema allows configuration in the collection builder.\n\tGuiSchema: {\n\t\tlabel: { widget: Input, required: true },\n\t\tdb_fieldName: { widget: Input, required: false },\n\t\trequired: { widget: Toggles, required: false },\n\t\ttranslated: { widget: Toggles, required: false },\n\t\tfeatures: {\n\t\t\twidget: Input, // A multi-select component would be better here.\n\t\t\trequired: false,\n\t\t\thelper: 'Comma-separated features (social, schema, advanced, ai).'\n\t\t}\n\t},\n\n\t// GraphQL schema for SEO (complex object, would need custom type)\n\t// For now, return String to serialize as JSON\n\tGraphqlSchema: () => ({\n\t\ttypeID: 'String', // JSON string representation\n\t\tgraphql: '' // No custom type definition needed\n\t})\n});\n\nexport default SeoWidget;\n\n// Export helper types.\nexport type FieldType = ReturnType<typeof SeoWidget>;\nexport type SeoWidgetData = ValibotInput<typeof SeoValidationSchema>;\n","/**\n * @file src/widgets/scanner.ts\n * @description Centralized widget scanner using Vite's import.meta.glob.\n * Provides a single source of truth for widget discovery to avoid redundant scanning.\n */\n// Scan for core widgets\nexport const coreModules = import.meta.glob('./core/*/index.ts', {\n    eager: true\n});\n// Scan for custom widgets\nexport const customModules = import.meta.glob('./custom/*/index.ts', {\n    eager: true\n});\n// Combined modules for easier iteration\nexport const allWidgetModules = { ...coreModules, ...customModules };\n/**\n * Extracts widget name from file path\n * @param path - The file path (e.g., './core/input/index.ts')\n * @returns The widget name (e.g., 'input')\n */\nexport function getWidgetNameFromPath(path) {\n    const parts = path.split('/');\n    return parts.at(-2) || null;\n}\n","/**\n * @file src/stores/widgetStore.svelte.ts\n * @description Centralized widget state management using Svelte 5 runes.\n *\n * This store handles:\n * - Scanning and loading both core and custom widgets.\n * - Initializing widgets with tenant-specific and database-driven status.\n * - Providing a unified registry for widget functions.\n * - Tracking active widgets and their dependencies.\n */\n\nimport { logger } from '@shared/utils/logger';\nimport type { DatabaseAdapter } from '@shared/database/dbInterface';\nimport type { WidgetFactory, WidgetDefinition, FieldInstance } from '@cms-types';\nimport { coreModules, customModules } from '@widgets/scanner';\n\nexport type WidgetStatus = 'active' | 'inactive';\n\n/**\n * Registry for all available widget functions\n */\nexport type WidgetRegistry = Record<string, WidgetFactory | WidgetDefinition>;\n\nclass WidgetState {\n\twidgets = $state<Record<string, FieldInstance>>({});\n\twidgetFunctions = $state<WidgetRegistry>({});\n\tcoreWidgets = $state<string[]>([]);\n\tcustomWidgets = $state<string[]>([]);\n\tmarketplaceWidgets = $state<string[]>([]);\n\tactiveWidgets = $state<string[]>([]);\n\tdependencyMap = $state<Record<string, string[]>>({});\n\n\ttenantId = $state<string>('default');\n\tisLoaded = $state(false);\n\tloading = $state(false);\n\thealthStatus = $state<'healthy' | 'unhealthy' | 'initializing'>('initializing');\n\tlastHealthCheck = $state<number | undefined>(undefined);\n\n\tconstructor() {\n\t\t// Initialize empty state\n\t}\n\n\tasync initialize(tenantId = 'default', dbAdapter?: DatabaseAdapter | null) {\n\t\tif (this.loading) {\n\t\t\tlogger.debug('[WidgetStore] Initialization already in progress, skipping.');\n\t\t\treturn;\n\t\t}\n\t\tif (this.isLoaded && this.tenantId === tenantId && !dbAdapter) {\n\t\t\tlogger.debug('[WidgetStore] Widgets already loaded, skipping initialization.');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loading = true;\n\t\tthis.tenantId = tenantId;\n\t\tlogger.info(`[WidgetStore] Initializing for tenant: ${tenantId}`);\n\n\t\ttry {\n\t\t\t// 1. Load modules from scanner\n\t\t\tconst newWidgetFunctions: WidgetRegistry = {};\n\t\t\tconst newCoreWidgets: string[] = [];\n\t\t\tconst newCustomWidgets: string[] = [];\n\t\t\tconst newDependencyMap: Record<string, string[]> = {};\n\n\t\t\t// Process core widgets\n\t\t\tfor (const [path, module] of Object.entries(coreModules)) {\n\t\t\t\tconst name = path.split('/').at(-2);\n\t\t\t\tif (!name || typeof (module as any).default !== 'function') continue;\n\n\t\t\t\tconst fn = (module as any).default as WidgetFactory;\n\t\t\t\tconst widgetName = fn.Name || name;\n\t\t\t\tfn.Name = widgetName;\n\t\t\t\t(fn as any).__widgetType = 'core';\n\n\t\t\t\tnewWidgetFunctions[widgetName] = fn;\n\t\t\t\tnewCoreWidgets.push(widgetName);\n\n\t\t\t\tif ((fn as any).__dependencies && (fn as any).__dependencies.length > 0) {\n\t\t\t\t\tnewDependencyMap[widgetName] = (fn as any).__dependencies;\n\t\t\t\t}\n\n\t\t\t\tif (name && name !== widgetName) {\n\t\t\t\t\tnewWidgetFunctions[name] = fn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Process custom widgets\n\t\t\tfor (const [path, module] of Object.entries(customModules)) {\n\t\t\t\tconst name = path.split('/').at(-2);\n\t\t\t\tif (!name || typeof (module as any).default !== 'function') continue;\n\n\t\t\t\tconst fn = (module as any).default as WidgetFactory;\n\t\t\t\tconst widgetName = fn.Name || name;\n\t\t\t\tfn.Name = widgetName;\n\t\t\t\t(fn as any).__widgetType = 'custom';\n\n\t\t\t\tnewWidgetFunctions[widgetName] = fn;\n\t\t\t\tnewCustomWidgets.push(widgetName);\n\n\t\t\t\tif ((fn as any).__dependencies && (fn as any).__dependencies.length > 0) {\n\t\t\t\t\tnewDependencyMap[widgetName] = (fn as any).__dependencies;\n\t\t\t\t}\n\n\t\t\t\tif (name && name !== widgetName) {\n\t\t\t\t\tnewWidgetFunctions[name] = fn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.widgetFunctions = newWidgetFunctions;\n\t\t\tthis.coreWidgets = newCoreWidgets;\n\t\t\tthis.customWidgets = newCustomWidgets;\n\t\t\tthis.dependencyMap = newDependencyMap;\n\n\t\t\t// 2. Load active status from DB if available\n\t\t\tlet activeWidgetNames: string[] = [];\n\t\t\tif (dbAdapter) {\n\t\t\t\tconst activeRes = await dbAdapter.widgets.getActiveWidgets();\n\t\t\t\tif (activeRes.success) {\n\t\t\t\t\tactiveWidgetNames = (activeRes.data ?? []).map((w) => w.name);\n\t\t\t\t}\n\t\t\t} else if (typeof window !== 'undefined') {\n\t\t\t\t// Fallback to API if adapter not passed (client-side)\n\t\t\t\tconst res = await fetch(`/api/widgets/active${!this.isLoaded ? '?refresh=true' : ''}`, {\n\t\t\t\t\theaders: { 'X-Tenant-ID': tenantId }\n\t\t\t\t});\n\t\t\t\tif (res.ok) {\n\t\t\t\t\tconst data = await res.json();\n\t\t\t\t\tactiveWidgetNames = (data.widgets || []).map((w: any) => w.name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Normalize and merge core\n\t\t\tconst normalizedActive = activeWidgetNames\n\t\t\t\t.map((name) => {\n\t\t\t\t\tif (this.widgetFunctions[name]) return name;\n\t\t\t\t\tconst camelCase = name.charAt(0).toLowerCase() + name.slice(1);\n\t\t\t\t\tif (this.widgetFunctions[camelCase]) return camelCase;\n\t\t\t\t\tconst lowerCase = name.toLowerCase();\n\t\t\t\t\tif (this.widgetFunctions[lowerCase]) return lowerCase;\n\t\t\t\t\treturn name;\n\t\t\t\t})\n\t\t\t\t.filter((name) => this.widgetFunctions[name]);\n\n\t\t\tconst uniqueActive = [...new Set([...normalizedActive, ...newCoreWidgets])];\n\t\t\tthis.activeWidgets = uniqueActive;\n\n\t\t\t// Create instances\n\t\t\tconst newWidgets: Record<string, any> = {};\n\t\t\tfor (const [name, fn] of Object.entries(this.widgetFunctions)) {\n\t\t\t\tnewWidgets[name] = (fn as any)({} as any);\n\t\t\t}\n\t\t\tthis.widgets = newWidgets;\n\n\t\t\tthis.isLoaded = true;\n\t\t\tthis.loading = false;\n\t\t\tthis.healthStatus = 'healthy';\n\t\t\tthis.lastHealthCheck = Date.now();\n\n\t\t\tlogger.info(`[WidgetStore] Initialized: ${this.coreWidgets.length} core, ${this.customWidgets.length} custom widgets.`);\n\t\t} catch (e) {\n\t\t\tthis.loading = false;\n\t\t\tthis.healthStatus = 'unhealthy';\n\t\t\tlogger.error('[WidgetStore] Initialization failed:', e);\n\t\t}\n\t}\n\n\tasync updateStatus(name: string, status: WidgetStatus, tenantId?: string) {\n\t\tconst targetTenant = tenantId || this.tenantId;\n\t\tconst active = status === 'active';\n\n\t\tif (active && isWidgetCore(name)) return; // Core always active\n\n\t\tif (!active && !canDisableWidget(name)) {\n\t\t\tthrow new Error(`Cannot disable widget ${name}: other widgets depend on it`);\n\t\t}\n\n\t\tif (active) {\n\t\t\tconst deps = getWidgetDependencies(name);\n\t\t\tconst inactiveDeps = deps.filter((dep) => !isWidgetActive(dep));\n\t\t\tif (inactiveDeps.length > 0) {\n\t\t\t\tthrow new Error(`Cannot activate widget ${name}: missing dependencies: ${inactiveDeps.join(', ')}`);\n\t\t\t}\n\t\t}\n\n\t\t// Update DB\n\t\ttry {\n\t\t\tawait this.updateInDatabase(name, active, targetTenant);\n\n\t\t\t// Update state\n\t\t\tif (active) {\n\t\t\t\tif (!this.activeWidgets.includes(name)) {\n\t\t\t\t\tthis.activeWidgets.push(name);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.activeWidgets = this.activeWidgets.filter((w) => w !== name);\n\t\t\t}\n\n\t\t\tlogger.info(`[WidgetStore] Widget '${name}' status changed to '${status}'`);\n\t\t} catch (e) {\n\t\t\tlogger.error(`[WidgetStore] Failed to update status for ${name}:`, e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync updateConfig(name: string, config: Record<string, any>) {\n\t\tconst currentFn = this.widgetFunctions[name];\n\t\tif (!currentFn || typeof currentFn !== 'function') return;\n\n\t\tconst updatedFn = Object.assign((cfg: any) => currentFn({ ...config, ...cfg }), currentFn);\n\n\t\tthis.widgetFunctions[name] = updatedFn;\n\t\tthis.widgets[name] = updatedFn({} as any);\n\t}\n\n\tasync reload(tenantId?: string) {\n\t\tthis.isLoaded = false;\n\t\tawait this.initialize(tenantId || this.tenantId);\n\t}\n\n\tprivate async updateInDatabase(name: string, active: boolean, tenantId: string) {\n\t\tif (typeof window !== 'undefined') {\n\t\t\tconst res = await fetch('/api/widgets/status', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Tenant-ID': tenantId },\n\t\t\t\tbody: JSON.stringify({ widgetName: name, isActive: active })\n\t\t\t});\n\t\t\tif (!res.ok) throw new Error('Database sync failed');\n\t\t}\n\t}\n}\n\nexport const widgets = new WidgetState();\n\n// --- Helper Functions ---\n\nexport function getWidget(name: string) {\n\treturn widgets.widgets[name];\n}\n\nexport function getWidgetFunction(name: string) {\n\treturn widgets.widgetFunctions[name];\n}\n\nexport function isWidgetActive(name: string): boolean {\n\treturn widgets.activeWidgets.includes(name);\n}\n\nexport function isWidgetCore(name: string): boolean {\n\treturn widgets.coreWidgets.includes(name);\n}\n\nexport function isWidgetCustom(name: string): boolean {\n\treturn widgets.customWidgets.includes(name);\n}\n\nexport function isWidgetMarketplace(name: string): boolean {\n\treturn widgets.marketplaceWidgets.includes(name);\n}\n\nexport function getWidgetDependencies(name: string): string[] {\n\treturn widgets.dependencyMap[name] || [];\n}\n\nexport function canDisableWidget(name: string): boolean {\n\tif (isWidgetCore(name)) return false;\n\tconst dependents = Object.entries(widgets.dependencyMap)\n\t\t.filter(([, deps]) => deps.includes(name))\n\t\t.map(([n]) => n);\n\treturn !dependents.some(isWidgetActive);\n}\n\nexport function isWidgetAvailable(name: string): boolean {\n\treturn !!getWidgetFunction(name) && isWidgetActive(name);\n}\n\n// Compatibility export for theme branch components\nexport const widgetStoreActions = {\n\tupdateStatus: widgets.updateStatus.bind(widgets),\n\tupdateConfig: widgets.updateConfig.bind(widgets),\n\treload: widgets.reload.bind(widgets),\n\tinitializeWidgets: widgets.initialize.bind(widgets)\n};\n\n// Compatibility store for legacy components\nexport const widgetFunctions = {\n\tsubscribe(fn: (value: WidgetRegistry) => void) {\n\t\tfn(widgets.widgetFunctions);\n\t\treturn () => {}; // Non-reactive for now, sufficient for initial load or use $effect if needed\n\t}\n};\n\n// HMR\nif (import.meta.hot) {\n\timport.meta.hot.accept(() => {\n\t\twidgets.reload();\n\t});\n}\n"],"names":["permissions","$.prop","$$props","roles","onUpdate","error","$.state","searchQuery","showBulkActions","prefersReducedMotion","historyIndex","permissionsHistory","$.proxy","actionIcons","PermissionAction","presets","action","initializePermissions","currentPermissions","availableRoles","initialized","role","permissionsState","$.derived","saveToHistory","newHistory","$.get","$.set","undo","updateParent","redo","canUndo","canRedo","togglePermission","roleId","r","showToast","setAllPermissionsForRole","value","setPermissionForAllRoles","applyPreset","presetKey","preset","cleanedPermissions","acc","perms","exportPermissions","data","blob","url","a","importPermissions","event","file","text","imported","filteredRoles","countEnabledPermissions","totalActions","onMount","mediaQuery","handleChange","e","div","root_1","div_1","$.child","div_2","p","button","$.reset","$.transition","fade","$.append","$$anchor","div_3","root_2","div_4","div_5","input_1","div_6","button_1","iconify_icon","button_2","iconify_icon_1","button_3","iconify_icon_2","button_4","$.sibling","iconify_icon_3","label","iconify_icon_4","input_2","div_7","root_3","div_8","div_9","root_4","button_5","iconify_icon_5","button_6","iconify_icon_6","$.set_attribute","slide","$$render","consequent_1","div_10","node_1","table","thead","tr","th","div_11","span","th_1","root_5","div_12","iconify_icon_7","span_1","tbody","tr_1","root_6","th_2","div_13","div_14","span_2","span_3","root_7","consequent_2","span_4","root_8","$.template_effect","$.set_text","text_5","consequent_3","span_5","node_4","td","root_9","button_7","iconify_icon_8","$.set_class","$.clsx","td_1","node_5","div_15","button_8","button_9","select","target","option","key","$$item","$$array","option_1","root_10","text_7","text_4","div_16","root_11","iconify_icon_9","p_1","span_6","consequent_4","text_2","$$value","consequent","alternate","createWidget","config","widgetDefinition","widgetFactoryFunction","fieldConfig","fieldInstance","CheckboxValidationSchema","boolean","CheckboxWidget","m.widget_checkbox_description","Input","Toggles","IconifyPicker","PermissionsSetting","field","filter","sortDirection","DateValidationSchema","pipe","string","minLength","isoDate","DateWidget","m.widget_date_description","fieldName","startDateStr","endDateStr","startDate","endDate","endOfDay","DateRangeValidationSchema","object","check","DateRangeWidget","m.widget_dateRange_description","filterDate","GroupValidationSchema","GroupWidget","createValidationSchema","stringRules","transform","maxLength","schema","optional","record","InputWidget","m.widget_text_description","contentLanguage","idSchema","arraySchema","array","MediaWidget","m.widget_media_description","Checkbox","MenuItemSchema","MegaMenuValidationSchema","MegaMenuWidget","m.widget_megaMenu_description","traverseMenuItems","items","callback","level","parent","item","findMenuItemByPath","path","currentItems","targetItem","index","validateMenuStructure","errors","maxDepth","checkDepth","currentDepth","child","checkConstraints","childrenCount","maxChildren","validationSchema","allowedValues","opt","literal","union","RadioWidget","m.widget_radio_description","collectionNames","collections","c","root","$.each","node","name","collection","selectedCollection","fieldNames","f","RelationWidget","m.widget_relation_description","CollectionPicker","FieldPicker","tenantId","stripHtmlTags","html","previous","current","isContentEmpty","custom","input","RichTextWidget","m.widget_richText_description","AddressValidationSchema","number","AddressWidget","m.widget_address_description","basePath","hexSchema","regex","ColorPickerWidget","m.widget_colorPicker_description","validationActions","minValue","maxValue","baseSchema","CurrencyWidget","m.widget_currency_description","DISPOSABLE_DOMAINS","blockDisposableEmail","domain","email","EmailWidget","m.widget_email_description","NumberWidget","m.widget_number_description","defaultPattern","validationMessage","validationPattern","PhoneNumberWidget","m.widget_phoneNumber_description","max","RatingWidget","m.widget_rating_description","SAFE_VIDEO_URL_PATTERNS","RemoteVideoDataSchema","str","pattern","RemoteVideoWidget","m.widget_remoteVideo_description","escapeHtml","SeoValidationSchema","parsed","SeoWidget","m.widget_seo_description","coreModules","__vite_glob_0_0","__vite_glob_0_1","__vite_glob_0_2","__vite_glob_0_3","__vite_glob_0_4","__vite_glob_0_5","__vite_glob_0_6","__vite_glob_0_7","__vite_glob_0_8","__vite_glob_0_9","customModules","__vite_glob_1_0","__vite_glob_1_1","__vite_glob_1_2","__vite_glob_1_3","__vite_glob_1_4","__vite_glob_1_5","__vite_glob_1_6","__vite_glob_1_7","__vite_glob_1_8","WidgetState","#tenantId","#isLoaded","#loading","#healthStatus","#lastHealthCheck","dbAdapter","logger","newWidgetFunctions","newCoreWidgets","newCustomWidgets","newDependencyMap","module","fn","widgetName","activeWidgetNames","activeRes","w","res","normalizedActive","camelCase","lowerCase","uniqueActive","newWidgets","status","targetTenant","active","isWidgetCore","canDisableWidget","inactiveDeps","getWidgetDependencies","dep","isWidgetActive","currentFn","updatedFn","cfg","widgets","deps","n","widgetStoreActions","widgetFunctions"],"mappings":"ovJA6BA,gBAeSA,EAAWC,GAAAC,EAAA,cAAA,GAAA,KAAA,CAAA,EAAA,EAAOC,EAAKF,GAAAC,EAAA,QAAA,GAAA,IAAA,CAAA,CAAA,EAAOE,EAAQH,GAAAC,EAAA,WAAA,EAAA,IAAS,CAAC,CAAC,MAGrDG,EAAQC,EAAsB,IAAI,EAClCC,EAAcD,EAAO,EAAE,EACvBE,EAAkBF,EAAO,EAAK,EAC9BG,EAAuBH,EAAO,EAAK,EACnCI,EAAeJ,EAAM,EAAG,EACxBK,EAAqBL,EAAMM,GAAA,CAAA,CAAA,CAAA,QAGzBC,EAA6C,EACjDC,EAAiB,MAAM,EAAG,uBAC1BA,EAAiB,IAAI,EAAG,eACxBA,EAAiB,KAAK,EAAG,oBACzBA,EAAiB,MAAM,EAAG,kBAC1BA,EAAiB,MAAM,EAAG,iBAC1BA,EAAiB,MAAM,EAAG,gBAC1BA,EAAiB,MAAM,EAAG,eAC1BA,EAAiB,OAAO,EAAG,gBAC3BA,EAAiB,KAAK,EAAG,iBAIrBC,EAAO,CACZ,YAAW,CACV,KAAM,YACN,YAAa,wBACb,YAAW,CACV,KAAM,GACN,OAAQ,GACR,OAAQ,GACR,MAAO,GACP,OAAQ,GACR,OAAQ,GACR,OAAQ,GACR,QAAS,GACT,MAAO,KAGT,OAAM,CACL,KAAM,SACN,YAAa,8BACb,YAAW,CACV,KAAM,GACN,OAAQ,GACR,OAAQ,GACR,MAAO,GACP,OAAQ,GACR,MAAO,GACP,OAAQ,GACR,OAAQ,GACR,QAAS,KAGX,MAAK,CACJ,KAAM,gBACN,YAAa,4BACb,YAAa,OAAO,YAAY,OAAO,OAAOD,CAAgB,EAAE,IAAKE,GAAM,CAAMA,EAAQ,EAAI,CAAA,CAAA,IAKtF,SAAAC,EAAsBC,EAAoCC,EAAwC,CACpG,MAAAC,MAAmCF,CAAkB,EAE3D,OAAAC,EAAe,QAASE,GAAS,CAC3BD,EAAYC,EAAK,GAAG,IACxBD,EAAYC,EAAK,GAAG,EAAI,OAAO,YAAY,OAAO,OAAOP,CAAgB,EAAE,IAAKE,GAAM,CAAMA,EAAQ,EAAI,CAAA,CAAA,EAE1G,CAAC,EAEMI,CACR,CAGI,IAAAE,EAAgBC,GAAA,IAAYN,EAAsBjB,EAAW,EAAEG,EAAK,CAAA,CAAA,EAG/D,SAAAqB,GAAgB,OAClBC,EAAUC,EAAGf,CAAkB,EAAC,MAAM,EAACe,EAAEhB,CAAY,EAAG,CAAC,EAC/De,EAAW,KAAK,KAAK,MAAM,KAAK,UAASC,EAACJ,CAAgB,CAAA,CAAA,CAAA,EAC1DK,EAAAhB,EAAqBc,EAAU,EAAA,EAC/BE,EAAAjB,EAAee,EAAW,OAAS,CAAC,CACrC,CAGS,SAAAG,IAAO,GACXlB,CAAY,EAAG,OAClBA,EAAY,EAAA,IACZY,EAAmB,KAAK,MAAM,KAAK,UAASI,EAACf,CAAkB,EAAAe,EAAChB,CAAY,CAAA,CAAA,CAAA,CAAA,EAC5EmB,GAAY,EAEd,CAES,SAAAC,IAAO,CACXJ,EAAAhB,CAAY,IAAGC,CAAkB,EAAC,OAAS,OAC9CD,CAAY,IACZY,EAAmB,KAAK,MAAM,KAAK,UAASI,EAACf,CAAkB,EAAAe,EAAChB,CAAY,CAAA,CAAA,CAAA,CAAA,EAC5EmB,GAAY,EAEd,OAEME,GAAOR,GAAA,IAAAG,EAAYhB,CAAY,EAAG,CAAC,EACnCsB,YAAmBtB,CAAY,EAAAgB,EAAGf,CAAkB,EAAC,OAAS,CAAC,EAG5D,SAAAsB,GAAiBC,EAAgBlB,EAA0B,IACtDb,EAAK,EAAC,KAAMgC,GAAYA,EAAE,MAAQD,CAAM,GAE3C,QAAS,CAClBE,EAAU,2CAA4C,SAAS,QAEhE,GAEKd,CAAgB,EAACY,CAAM,IAC3BR,EAAAJ,CAAgB,EAACY,CAAM,EAAA,CAAA,KAGxBZ,CAAgB,EAACY,CAAM,EAAElB,CAAM,KAAKM,CAAgB,EAACY,CAAM,EAAElB,CAAM,EACnEQ,EAAa,EACbK,GAAY,CACb,CAGS,SAAAQ,GAAyBH,EAAgBI,EAAgB,OAC3DjB,EAAOlB,EAAK,EAAC,KAAMgC,GAAYA,EAAE,MAAQD,CAAM,KAEjDb,GAAM,QAAS,CAClBe,EAAU,2CAA4C,SAAS,QAEhE,CAEAV,EAAAJ,CAAgB,EAACY,CAAM,EAAI,OAAO,YAAY,OAAO,OAAOpB,CAAgB,EAAE,IAAKE,GAAM,CAAMA,EAAQsB,CAAK,CAAA,CAAA,EAE5Gd,EAAa,EACbK,GAAY,EACZO,EAAS,mBAAoBE,EAAQ,UAAY,UAAU,QAAQjB,GAAM,IAAI,GAAI,SAAS,CAC3F,CAES,SAAAkB,GAAyBvB,EAA0BsB,EAAgB,CAC3EnC,EAAK,EAAC,QAASkB,GAAS,CAClBA,EAAK,UACTK,EAAAJ,CAAgB,EAACD,EAAK,GAAG,EAAEL,CAAM,EAAIsB,EAEvC,CAAC,EAEDd,EAAa,EACbK,GAAY,EACZO,EAAS,GAAIpB,CAAM,IAAIsB,EAAQ,UAAY,UAAU,iBAAkB,SAAS,CACjF,CAGS,SAAAE,GAAYN,EAAgBO,EAAmB,OACjDpB,EAAOlB,EAAK,EAAC,KAAMgC,GAAYA,EAAE,MAAQD,CAAM,KAEjDb,GAAM,QAAS,CAClBe,EAAU,2CAA4C,SAAS,QAEhE,OAEMM,EAAS3B,EAAQ0B,CAAS,EAC5BC,IACHhB,EAAAJ,CAAgB,EAACY,CAAM,EAAA,CAAA,GAASQ,EAAO,WAAW,EAClDlB,EAAa,EACbK,GAAY,EACZO,EAAS,YAAaM,EAAO,IAAI,eAAerB,GAAM,IAAI,GAAI,SAAS,EAEzE,CAGS,SAAAQ,IAAe,CACjB,MAAAc,EAAqB,OAAO,QAAOjB,EAACJ,CAAgB,GAAE,OAAQ,CAAAsB,EAAG,CAAGV,EAAQW,CAAK,KAC9D,OAAO,OAAOA,CAAK,EAAE,KAAMP,IAAUA,KAAU,EAAK,IAE3EM,EAAIV,CAAM,EAAIW,GAERD,OAGRxC,EAAQ,EAACuC,CAAkB,CAC5B,CAGS,SAAAG,IAAoB,OACtBC,EAAO,KAAK,YAAUzB,CAAgB,EAAE,KAAM,CAAC,EAC/C0B,MAAW,KAAI,CAAED,CAAI,EAAA,CAAK,KAAM,mBAAkB,EAClDE,EAAM,IAAI,gBAAgBD,CAAI,EAC9BE,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOD,EACTC,EAAE,SAAQ,eAAA,IAAsB,KAAI,EAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,CAAA,QACjEA,EAAE,MAAK,EACP,IAAI,gBAAgBD,CAAG,EACvBb,EAAU,uBAAwB,SAAS,CAC5C,gBAGee,GAAkBC,EAAc,CAExC,MAAAC,EADQD,EAAM,OACD,QAAQ,CAAC,KAEvBC,EAED,GAAA,OACGC,EAAI,MAASD,EAAK,KAAI,EACtBE,EAAW,KAAK,MAAMD,CAAI,IAChChC,EAAgB,CAAA,GAAAI,EAAQJ,CAAgB,EAAA,GAAKiC,EAAQ,EACrD/B,EAAa,EACbK,GAAY,EACZO,EAAU,oCAAqC,SAAS,CACzD,MAAc,CACbA,EAAU,+BAAgC,OAAO,EACjDT,EAAAtB,EAAQ,0BAA0B,CACnC,CACD,CAGM,MAAAmD,GAAajC,GAAA,IAClBpB,EAAK,EAAC,OACJkB,GAASA,EAAK,KAAK,YAAW,EAAG,SAAQK,EAACnB,CAAW,EAAC,YAAW,CAAA,GAAOc,EAAK,aAAa,YAAW,EAAG,SAAQK,EAACnB,CAAW,EAAC,YAAW,CAAA,CAAA,CAAA,WAKlIkD,GAAwBvB,EAAwB,QACjD,OAAO,OAAMR,EAACJ,CAAgB,EAACY,CAAM,GAAA,EAAA,EAAS,OAAO,OAAO,EAAE,MACtE,CAEM,MAAAwB,UAAwB,OAAO,OAAO5C,CAAgB,EAAE,MAAM,EAGpE6C,GAAO,IAAO,CACP,MAAAC,EAAa,OAAO,WAAW,kCAAkC,IACvEnD,EAAuBmD,EAAW,QAAO,EAAA,QAEnCC,EAAgBC,GAA2B,GAChDrD,EAAuBqD,EAAE,QAAO,EAAA,CACjC,EAEA,OAAAF,EAAW,iBAAiB,SAAUC,CAAY,EAGlDrC,EAAa,EAEA,IAAAoC,EAAW,oBAAoB,SAAUC,CAAY,CACnE,CAAC,oCAIA,IAAAE,EAAAC,GAAA,EAKCC,EAAGC,EALJH,CAAA,EAOEI,MAFDF,CAAG,EAAA,CAAA,EAIDG,MAFDD,CAAG,EAAA,CAAA,OAEFC,EAAC,EAAA,IAADA,CAAC,IAFFD,CAAG,EAIH,IAAAE,KAJAF,EAAG,CAAA,EAIHE,GAAO,QAAO,IAAA1C,EAAStB,EAAQ,IAAI,IANpC4D,CAAG,EALJK,EAAAP,CAAA,eAS2B1D,CAAK,CAAA,CAAA,EAThCkE,GAAA,EAAAR,EAAA,IAAAS,GAAA,KAAA,CAGmB,SAAQ9C,EAAEjB,CAAoB,EAAG,EAAI,GAAG,EAAA,EAH3DgE,EAAAC,EAAAX,CAAA,cAeAY,EAAGC,GAAA,EAEFC,IAFDF,CAAG,EAIDG,IAFDD,CAAG,EAGDE,IADDD,CAAG,KACFC,CAAK,IADND,CAAG,EAKH,IAAAE,KALAF,EAAG,CAAA,EAOFG,KAFDD,EAAG,EAEFC,GAAO,QAASrD,GACf,IAAAsD,KADDD,EAAM,IACLC,GAAY,OAAA,UAAA,IAAZA,GAAY,QAAA,IAAA,IADbD,EAAM,EAGN,IAAAE,KAHAF,GAAM,CAAA,EAGNE,GAAO,QAASrD,GACf,IAAAsD,KADDD,EAAM,IACLC,GAAY,OAAA,UAAA,IAAZA,GAAY,QAAA,IAAA,IADbD,EAAM,EAKN,IAAAE,KALAF,GAAM,CAAA,EAKNE,GAAO,QAAO,IAAA1D,EAASnB,KAAmBA,CAAe,CAAA,EACxD,IAAA8E,KADDD,EAAM,IACLC,GAAY,OAAA,aAAA,IAAZA,GAAY,QAAA,IAAA,SADbD,EAAM,EAMN,IAAAE,GAAAC,EANAH,GAAM,CAAA,EAMNE,GACA,QAASzC,GAKR,IAAA2C,GAAYvB,EANbqB,EAAA,IAMCE,GAAY,OAAA,cAAA,IAAZA,GAAY,QAAA,IAAA,EANbnB,EAAAiB,EAAA,EAUA,IAAAG,GAAKF,EAVLD,GAAA,CAAA,EAWCI,KADDD,EAAK,IACJC,GAAY,OAAA,YAAA,IAAZA,GAAY,QAAA,IAAA,EACZ,IAAAC,KADAD,GAAY,CAAA,EACZC,GAAiC,SAAUzC,KAF5CuC,EAAK,IA1BNV,EAAG,IAPJH,CAAG,WAAHA,EAAG,CAAA,cA0CF,IAAAgB,EAAAC,GAAA,EAKCC,EAAGP,EAAAtB,EALJ2B,CAAA,EAAA,CAAA,KAKCE,EAAG,GAAA,IACI,OAAO,OAAOjF,CAAgB,EAAKE,GAAQA,EAAM,CAAA0D,EAAd1D,IAAM,KAC9CgF,EAAGC,GAAA,EACFC,EAAAhC,EADD8B,CAAG,EACFE,EACA,QAAO,IAAQ3D,GAAyBvB,EAAQ,EAAI,EAKnD,IAAAmF,GAAYjC,EANbgC,CAAA,UAMCC,GAAY,OAAOtF,EAAYG,CAAM,CAAA,CAAA,IAArCmF,GAAY,QAAA,IAAA,OANb7B,EAAA4B,CAAA,MASAE,GAAAZ,EATAU,EAAA,CAAA,EASAE,GACA,QAAO,IAAQ7D,GAAyBvB,EAAQ,EAAK,EAKpD,IAAAqF,GAAYnC,EANbkC,EAAA,UAMCC,GAAY,OAAOxF,EAAYG,CAAM,CAAA,CAAA,IAArCqF,GAAY,QAAA,IAAA,OANb/B,EAAA8B,EAAA,IAVDJ,CAAG,SACFM,EAAAJ,EAAA,QAAA,UAGiBlF,CAAM,gBAAA,EAHvBsF,EAAAJ,EAAA,aAAA,UAIsBlF,CAAM,gBAAA,EAK5BsF,EAAAF,GAAA,QAAA,WAGkBpF,CAAM,gBAAA,EAHxBsF,EAAAF,GAAA,aAAA,WAIuBpF,CAAM,gBAAA,QAd9BgF,CAAG,MAFLD,CAAG,EALJzB,EAAAuB,CAAA,EAAAtB,GAAA,EAAAsB,EAAA,IAAAU,GAAA,KAAA,CAEoB,SAAQ7E,EAAEjB,CAAoB,EAAG,EAAI,GAAG,EAAA,EAF5DgE,EAAAC,EAAAmB,CAAA,eADGrF,CAAe,GAAAgG,EAAAC,EAAA,QAkCnBC,GAAGlB,EAAAmB,GAAA,CAAA,EACFC,KADDF,EAAG,EAEDG,KADDD,EAAK,EAEHE,KADDD,EAAK,EAEHE,KADDD,EAAE,EAEAE,KADDD,EAAE,EAGAE,OAFDD,EAAG,CAAA,OAEFC,EAAI,IAAJA,EAAI,IAFLD,EAAG,IADJD,EAAE,WAAFA,EAAE,eAQI,OAAO,OAAOjG,CAAgB,EAAKE,GAAQA,EAAM,CAAA0D,EAAd1D,IAAM,KAC9CkG,EAAEC,GAAA,EACDC,IADDF,CAAE,EAEAG,IADDD,CAAG,UACFC,EAAY,OAAOxG,EAAYG,CAAM,CAAA,CAAA,IAArCqG,EAAY,QAAA,IAAA,IAAZA,EAAY,cAAA,MAAA,EACZ,IAAAC,IADAD,EAAY,CAAA,MACZC,EAAI,EAAA,IAAJA,CAAI,IAFLF,CAAG,IADJF,CAAE,YAGsBlG,CAAM,CAAA,MAH9BkG,CAAE,WAVJJ,EAAE,IADHD,EAAK,EAqBL,IAAAU,KArBAV,EAAK,KAqBLU,GAAK,GAAA,IAAA7F,EACE8B,EAAa,EAAInC,GAAMA,EAAK,IAAG,CAAAqD,EAAdrD,IAAI,KAC1BmG,EAAEC,GAAA,EAEDC,IAFDF,CAAE,EAGAG,IADDD,CAAE,EAEAE,IADDD,CAAG,EAEDE,IADDD,CAAG,OACFC,EAAI,EAAA,IAAJA,CAAI,WAAJA,EAAI,CAAA,kBAEHC,EAAIC,GAAA,MAAJD,CAAI,aADDpG,EAAAL,CAAI,EAAC,SAAOmF,EAAAwB,EAAA,MAFjBJ,CAAG,WAAHA,EAAG,CAAA,kBAOFK,EAAIC,GAAA,OAAJD,EAAI,EAAA,IAAJA,CAAI,EACHE,EAAA,IAAAC,EAAAC,GAAA3G,EAAAL,CAAI,EAAC,WAAW,CAAA,MADjB4G,CAAI,aADDvG,EAAAL,CAAI,EAAC,aAAWmF,EAAA8B,EAAA,QAKpBC,GAAI/C,EAAAgD,GAAA,CAAA,OAAJD,EAAI,IAAJA,EAAI,IAZLZ,CAAG,IADJD,CAAE,WAAFA,CAAE,eAoBI,OAAO,OAAO5G,CAAgB,EAAKE,GAAQA,EAAM,CAAA0D,EAAd1D,IAAM,KAC9CyH,GAAEC,GAAA,EACDC,EAAAzE,EADDuE,EAAE,EACDE,EACA,YAAe1G,GAAgBP,EAACL,CAAI,EAAC,IAAKL,CAAM,EAO/C,IAAA4H,GAAQ1E,EARTyE,CAAA,UAQCC,GAAQ,QAAAlH,EACFJ,CAAgB,EAAAI,EAACL,CAAI,EAAC,GAAG,IAAIL,CAAM,EAAI,YAAyB,CAAA,IADtE4H,GAAQ,QAAA,IAAA,EARTtE,EAAAqE,CAAA,IADDF,EAAE,SACDE,EAAA,SAAAjH,EAEUL,CAAI,EAAC,QAFfiF,EAAAqC,EAAA,aAAA,GAAAjH,EAGeJ,CAAgB,EAAAI,EAACL,CAAI,EAAC,GAAG,IAAIL,CAAM,EAAI,UAAY,QAAQ,IAAIA,CAAM,QAAAU,EAAQL,CAAI,EAAC,IAAI,EAAA,EAHrGwH,GAAAF,EAAA,EAAA,wCAAAjH,EAI6CJ,CAAgB,EAAAI,EAACL,CAAI,EAAC,GAAG,IAAIL,CAAM,EAC7E,4CACA,sEAAsE,MAAGK,CAAI,EAAC,QAAU,gCAAkC,EAAE,EAAA,KAE9HuH,GAAQ,EAAAE,IAAApH,EAGDJ,CAAgB,EAAAI,EAACL,CAAI,EAAC,GAAG,IAAIL,CAAM,EAAI,aAA2B,CAAA,QAZ3EyH,EAAE,QAmBHM,GAAEvD,EAAAwD,EAAA,EACDC,KADDF,EAAE,EAEAG,GAAAhF,EADD+E,EAAG,EACFC,GACA,YAAe7G,GAAwBX,EAACL,CAAI,EAAC,IAAK,EAAI,MAQtD8H,GAAA3D,EATA0D,GAAA,CAAA,EASAC,GACA,YAAe9G,GAAwBX,EAACL,CAAI,EAAC,IAAK,EAAK,MAUvD+H,GAAA5D,EAXA2D,GAAA,CAAA,EAWAC,GACA,SAAWtF,GAAM,OACVuF,EAASvF,EAAE,OACbuF,EAAO,QACV7G,KAAYnB,CAAI,EAAC,IAAKgI,EAAO,KAAK,EAClCA,EAAO,MAAQ,GAEjB,EAKC,IAAAC,GAAMpF,EAZPkF,EAAA,EAYCE,SAAAA,GAAM,QAAA,YAANA,EAAM,eACA,OAAO,QAAQvI,CAAO,IAAMwI,EAAK7G,CAAO,IAAE6G,EAAG,CAAA7E,EAAA8E,IAAA,+BAAjBD,EAAI,IAAA7H,EAAA+H,EAAA,EAAA,CAAA,EAAC/G,GAAO,IAAAhB,EAAA+H,EAAA,EAAA,CAAA,MAC7CC,GAAMC,GAAA,OAAND,GAAM,EAAA,IAANA,EAAM,mBAActB,EAAAwB,GAAAlH,GAAM,EAAC,IAAI,WAAjB6G,EAAG,KAAjBG,GAAM,OAANA,GAAM,QAAQH,EAAG,IAAA,UAAjBG,EAAM,IAdRpF,EAAA8E,EAAA,IArBDH,EAAG,IADJF,EAAE,IA1CHvB,CAAE,QAK8BY,EAAAyB,GAAAnI,EAAAL,CAAI,EAAC,IAAI,qBAWDqC,EAAY,GAAA,EAAA,UAAA,EA4BjDwF,GAAA,SAAAxH,EAEUL,CAAI,EAAC,UAFf6H,GAAA,aAAA,8BAAAxH,EAK0CL,CAAI,EAAC,IAAI,EAAA,EAInD8H,GAAA,SAAAzH,EAEUL,CAAI,EAAC,UAFf8H,GAAA,aAAA,+BAAAzH,EAK2CL,CAAI,EAAC,IAAI,EAAA,EAMpD+H,GAAA,SAAA1H,EAQUL,CAAI,EAAC,UARf+H,GAAA,aAAA,mBAAA1H,EAU+BL,CAAI,EAAC,IAAI,EAAA,QA1DvCoC,GAAuB/B,EAACL,CAAI,EAAC,GAAG,CAAA,OAhBpCmG,CAAE,MAFJD,EAAK,IAtBNX,EAAK,IADNF,EAAG,WAAHA,GAAG,CAAA,cAoHF,IAAAoD,EAAAC,GAAA,EAICC,EAAY9F,EAJb4F,CAAA,IAICE,EAAY,OAAA,mBAAA,IAAZA,EAAY,QAAA,IAAA,KAAZA,EAAY,EAAA,kBAAA,EACZ,IAAAC,IADAD,EAAY,CAAA,EAEqBE,MADjCD,CAAC,CAAA,MACgCC,EAAI,EAAA,IAAJA,CAAI,SADrCD,CAAC,EALF3F,EAAAwF,CAAA,cAM4DvJ,CAAW,CAAA,CAAA,EANvEgE,GAAA,EAAAuF,EAAA,IAAAtF,GAAA,KAAA,CAEmB,SAAQ9C,EAAEjB,CAAoB,EAAG,EAAI,GAAG,EAAA,EAF3DgE,EAAAC,EAAAoF,CAAA,eADGtG,EAAa,EAAC,SAAW,GAACgD,EAAA2D,EAAA,MAhM/BxF,CAAG,SAWAM,eAAiClD,EAAO,EAGxCoD,eAAiCnD,EAAO,EAKxCsE,EAAAjB,qBAAsH7E,CAAe,CAAA,EAkE/H4H,EAAAgC,GAAA,IAAA1I,EAAA8B,EAAa,EAAC,QAAM,EAAA,GAAA,OAhF1BuB,EAAK,IAAArD,EAAanB,CAAW,EAAA8J,GAAA1I,EAAXpB,EAAW8J,CAAA,CAAA,MALhC1F,CAAG,eAhBAtE,CAAK,EAAAmG,EAAA8D,EAAA,EAAA9D,EAAA+D,GAAA,EAAA,gBAFF,wBC7ND,SAASC,EAAuDC,EAAqD,CAG3H,MAAMC,EAAqC,CAC1C,SAAUD,EAAO,KACjB,KAAMA,EAAO,KACb,KAAMA,EAAO,KACb,YAAaA,EAAO,YACpB,mBAAoBA,EAAO,oBAAsB,GACjD,qBAAsBA,EAAO,sBAAwB,GAErD,iBAAkBA,EAAO,iBACzB,SAAUA,EAAO,SACjB,UAAWA,EAAO,WAAc,CAAA,EAChC,aAAcA,EAAO,aACrB,qBAAsBA,EAAO,oBAAA,EAKxBE,EAAyBC,GAAoD,CAClF,MAAMC,EAA+B,CACpC,OAAQH,EACR,MAAOE,EAAY,MACnB,aAAc,GACd,SAAU,GACV,WAAY,GACZ,MAAO,OACP,OAAQ,OACR,YAAa,MAAA,EAId,GAAIH,EAAO,UAEV,UAAWlB,KAAOkB,EAAO,SACxB,GAAI,OAAO,UAAU,eAAe,KAAKA,EAAO,SAAUlB,CAAG,EAAG,CAC/D,MAAMjH,EAASmI,EAAO,SAAqClB,CAAG,EAC7DsB,EAA0CtB,CAAG,EAAIjH,CACnD,EAKF,UAAWiH,KAAOqB,EACjB,GAAI,OAAO,UAAU,eAAe,KAAKA,EAAarB,CAAG,EAAG,CAC3D,MAAMjH,EAASsI,EAAwCrB,CAAG,EACtDjH,IAAU,SAEZuI,EAA0CtB,CAAG,EAAIjH,EAEpD,CAID,OAAAuI,EAAc,SAAWA,EAAc,UAAY,GACnDA,EAAc,WAAaA,EAAc,YAAc,GACnD,CAACA,EAAc,cAAgBA,EAAc,MAChDA,EAAc,aAAeA,EAAc,MACzC,YAAA,EACA,QAAQ,OAAQ,GAAG,EACnB,QAAQ,cAAe,EAAE,EAChBA,EAAc,eACzBA,EAAc,aAAe,iBAGvBA,CACR,EAGA,OAAAF,EAAsB,KAAOF,EAAO,KACpCE,EAAsB,KAAOF,EAAO,KACpCE,EAAsB,YAAcF,EAAO,YAC3CE,EAAsB,UAAYF,EAAO,UACzCE,EAAsB,cAAgBF,EAAO,cAC7CE,EAAsB,aAAeF,EAAO,aAC5CE,EAAsB,qBAAuBF,EAAO,oBAAsB,GAC1EE,EAAsB,uBAAyBF,EAAO,sBAAwB,GAC9EE,EAAsB,SAAW,IAAM,GAGhCA,CACR,CC3HA,MAAMG,GAA2BC,GAAQ,oBAAoB,EAGvDC,GAAiBR,EAA4B,CAClD,KAAM,WACN,KAAM,kBACN,YAAaS,GAAE,EAGf,mBAAoB,0CACpB,qBAAsB,4CAGtB,iBAAkBH,GAGlB,SAAU,CACT,MAAO,UACP,KAAM,KACN,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQI,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,KAAM,CAAE,OAAQC,GAAe,SAAU,EAAA,EACzC,OAAQ,CAAE,OAAQF,EAAO,SAAU,EAAA,EACnC,MAAO,CAAE,OAAQA,EAAO,SAAU,EAAA,EAClC,YAAa,CAAE,OAAQG,GAAoB,SAAU,EAAA,CAAM,EAI5D,aAAc,CACb,QAAS,MAAO,CAAE,MAAAC,EAAO,OAAAC,CAAA,IAA0D,CAAC,CAAE,OAAQ,CAAE,CAACD,EAAM,YAAY,EAAGC,IAAW,MAAA,EAAU,EAC3I,MAAO,MAAO,CAAE,MAAAD,EAAO,cAAAE,MAAyE,CAC/F,CAACF,EAAM,YAAY,EAAGE,CAAA,EACvB,EAID,cAAe,KAAO,CACrB,OAAQ,UACR,QAAS,EAAA,EAEX,CAAC,2GCpCKC,GAAuBC,EAC5BC,EAAO,sBAAsB,EAC7BC,EAAU,EAAG,wBAAwB,EACrCC,GAAQ,2CAA2C,CACpD,EAGMC,GAAatB,EAAwB,CAC1C,KAAM,OACN,KAAM,eACN,YAAauB,GAAE,EAGf,mBAAoB,sCACpB,qBAAsB,wCAGtB,iBAAkBN,GAGlB,SAAU,CACT,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQP,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,KAAM,CAAE,OAAQC,GAAe,SAAU,EAAA,EACzC,OAAQ,CAAE,OAAQF,EAAO,SAAU,EAAA,EACnC,MAAO,CAAE,OAAQA,EAAO,SAAU,EAAA,EAClC,YAAa,CAAE,OAAQG,GAAoB,SAAU,EAAA,EACrD,QAAS,CAAE,OAAQH,EAAO,SAAU,EAAA,EACpC,QAAS,CAAE,OAAQA,EAAO,SAAU,EAAA,EACpC,cAAe,CACd,OAAQA,EACR,SAAU,GACV,YAAa,oCAAA,CACd,EAID,aAAc,CAKb,QAAS,MAAO,CAAE,MAAAI,EAAO,OAAAC,KAA0D,CAClF,MAAMS,EAAYV,EAAM,aAClB,CAACW,EAAcC,CAAU,EAAIX,EAAO,MAAM,GAAG,EAE7CY,EAAY,IAAI,KAAKF,CAAY,EAGvC,GAFAE,EAAU,YAAY,EAAG,EAAG,EAAG,CAAC,EAE5B,MAAMA,EAAU,QAAA,CAAS,QAAU,CAAA,EAGvC,GAAID,EAAY,CACf,MAAME,EAAU,IAAI,KAAKF,CAAU,EAEnC,GADAE,EAAQ,YAAY,GAAI,GAAI,GAAI,GAAG,EAC/B,CAAC,MAAMA,EAAQ,QAAA,CAAS,EAC3B,MAAO,CAAC,CAAE,OAAQ,CAAE,CAACJ,CAAS,EAAG,CAAE,KAAMG,EAAW,KAAMC,CAAA,CAAQ,EAAK,CAEzE,CAGA,MAAMC,EAAW,IAAI,KAAKF,CAAS,EACnC,OAAAE,EAAS,YAAY,GAAI,GAAI,GAAI,GAAG,EAC7B,CAAC,CAAE,OAAQ,CAAE,CAACL,CAAS,EAAG,CAAE,KAAMG,EAAW,KAAME,CAAA,CAAS,EAAK,CACzE,EAEA,MAAO,MAAO,CAAE,MAAAf,EAAO,cAAAE,MAAyE,CAC/F,CAACF,EAAM,YAAY,EAAGE,CAAA,EACvB,EAID,cAAe,KAAO,CACrB,OAAQ,SACR,QAAS,EAAA,EAEX,CAAC,2GCtFKc,GAA4BZ,EACjCa,EAAO,CACN,MAAOb,EAAKC,IAAUC,EAAU,EAAG,yBAAyB,EAAGC,IAAS,EACxE,IAAKH,EAAKC,EAAA,EAAUC,EAAU,EAAG,uBAAuB,EAAGC,GAAA,CAAS,CAAA,CACpE,EACDW,GAAOzJ,GAAS,IAAI,KAAKA,EAAK,KAAK,GAAK,IAAI,KAAKA,EAAK,GAAG,EAAG,8CAA8C,CAC3G,EAGM0J,GAAkBjC,EAA6B,CACpD,KAAM,YACN,KAAM,qBACN,YAAakC,GAAE,EAGf,mBAAoB,2CACpB,qBAAsB,6CAGtB,iBAAkBJ,GAGlB,SAAU,CACT,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQpB,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,KAAM,CAAE,OAAQC,GAAe,SAAU,EAAA,EACzC,OAAQ,CAAE,OAAQF,EAAO,SAAU,EAAA,EACnC,MAAO,CAAE,OAAQA,EAAO,SAAU,EAAA,EAClC,YAAa,CAAE,OAAQG,GAAoB,SAAU,EAAA,CAAM,EAI5D,aAAc,CAKb,QAAS,MAAO,CAAE,MAAAC,EAAO,OAAAC,KAA0D,CAClF,MAAMS,EAAYV,EAAM,aAClBqB,EAAa,IAAI,KAAKpB,CAAM,EAClC,OAAI,MAAMoB,EAAW,QAAA,CAAS,EAAU,CAAA,EAGjC,CACN,CACC,OAAQ,CACP,CAAC,GAAGX,CAAS,QAAQ,EAAG,CAAE,KAAMW,CAAA,EAChC,CAAC,GAAGX,CAAS,MAAM,EAAG,CAAE,KAAMW,CAAA,CAAW,CAC1C,CACD,CAEF,EAEA,MAAO,MAAO,CAAE,MAAArB,EAAO,cAAAE,MAAyE,CAC/F,CAAC,GAAGF,EAAM,YAAY,QAAQ,EAAGE,CAAA,EAClC,CAEF,CAAC,2GCpEKoB,GAAwBL,EAAO,EAAE,EAGjCM,GAAcrC,EAAyB,CAC5C,KAAM,QACN,KAAM,qBACN,YAAa,gCAGb,mBAAoB,uCACpB,qBAAsB,yCAGtB,iBAAkBoC,GAGlB,SAAU,CACT,YAAa,GACb,UAAW,GACX,QAAS,SAAA,EAIV,UAAW,CACV,MAAO,CAAE,OAAQ1B,EAAO,SAAU,EAAA,EAClC,WAAY,CAAE,OAAQA,EAAO,SAAU,EAAA,EACvC,YAAa,CAAE,OAAQC,EAAS,SAAU,EAAA,EAC1C,UAAW,CAAE,OAAQA,EAAS,SAAU,EAAA,EACxC,QAAS,CAAE,OAAQD,EAAO,SAAU,EAAA,EACpC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,KAAM,CAAE,OAAQE,GAAe,SAAU,EAAA,EACzC,OAAQ,CAAE,OAAQF,EAAO,SAAU,EAAA,EACnC,MAAO,CAAE,OAAQA,EAAO,SAAU,EAAA,EAClC,YAAa,CAAE,OAAQG,GAAoB,SAAU,EAAA,CAAM,EAI5D,aAAc,CAAA,CACf,CAAC,2GCvBYyB,GAA0BxB,GAA4F,CAElI,MAAMyB,EAA8B,CAACC,GAAW,GAAe,OAAO,GAAM,SAAW,EAAE,KAAA,EAAS,CAAE,CAAC,EAEjG1B,EAAM,UAAUyB,EAAY,KAAKnB,EAAU,EAAG,yBAAyB,CAAC,EACvEN,EAAqB,WACzByB,EAAY,KAAKnB,EAAWN,EAAqB,UAAqB,oBAAqBA,EAAqB,SAAS,cAAc,CAAC,EACpIA,EAAqB,WACzByB,EAAY,KAAKE,GAAW3B,EAAqB,UAAqB,wBAAyBA,EAAqB,SAAS,cAAc,CAAC,EAG7I,MAAM4B,EAA2DxB,EAAKC,EAAA,EAAU,GAAIoB,CAA6B,EAGjH,OAAIzB,EAAM,WACF6B,EAASC,GAAOzB,EAAA,EAAUA,GAAQ,EAAG,EAAE,EAIxCL,EAAM,SAAW4B,EAASC,EAASD,EAAQ,EAAE,CACrD,EAGMG,GAAc7C,EAAyB,CAC5C,KAAM,QACN,KAAM,mBACN,YAAa8C,GAAE,EACf,mBAAoB,uCACpB,qBAAsB,yCAEtB,iBAAkBR,GAGlB,SAAU,CACT,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQ5B,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,WAAY,CAAE,OAAQA,EAAS,SAAU,EAAA,EACzC,KAAM,CAAE,OAAQC,GAAe,SAAU,EAAA,EACzC,OAAQ,CAAE,OAAQF,EAAO,SAAU,EAAA,EACnC,MAAO,CAAE,OAAQA,EAAO,SAAU,EAAA,EAClC,YAAa,CAAE,OAAQG,GAAoB,SAAU,EAAA,EACrD,YAAa,CAAE,OAAQH,EAAO,SAAU,EAAA,EACxC,UAAW,CAAE,OAAQA,EAAO,SAAU,EAAA,EACtC,UAAW,CAAE,OAAQA,EAAO,SAAU,EAAA,EACtC,OAAQ,CAAE,OAAQA,EAAO,SAAU,EAAA,EACnC,OAAQ,CAAE,OAAQA,EAAO,SAAU,EAAA,EACnC,MAAO,CAAE,OAAQA,EAAO,SAAU,EAAA,CAAM,EAIzC,aAAc,CACb,QAAS,MAAO,CAAE,MAAAI,EAAO,OAAAC,EAAQ,gBAAAgC,KAA4F,CAC5H,CAAE,OAAQ,CAAE,CAAC,GAAGjC,EAAM,YAAY,IAAIiC,CAAe,EAAE,EAAG,CAAE,OAAQhC,EAAQ,SAAU,GAAA,EAAM,CAAE,EAE/F,MAAO,MAAO,CAAE,MAAAD,EAAO,cAAAE,EAAe,gBAAA+B,MAAoG,CACzI,CAAC,GAAGjC,EAAM,YAAY,IAAIiC,CAAe,EAAE,EAAG/B,CAAA,EAC/C,EAID,cAAe,KAAO,CACrB,OAAQ,SACR,QAAS,EAAA,EAEX,CAAC,qICxFYsB,GAA0BxB,GAA4F,CAElI,MAAMkC,EAAW9B,EAAKC,EAAA,EAAUC,EAAU,EAAG,2BAA2B,CAAC,EAGzE,GAAIN,EAAM,YAAa,CACtB,MAAMmC,EAAcC,GAAMF,CAAQ,EAElC,OAAOlC,EAAM,SAAWI,EAAK+B,EAAa7B,EAAU,EAAG,sCAAsC,CAAC,EAAIuB,EAASM,CAAW,CACvH,CAGA,OAAOnC,EAAM,SAAWkC,EAAWL,EAASK,EAAU,EAAE,CACzD,EAGMG,GAAcnD,EAAyB,CAC5C,KAAM,cACN,KAAM,qBACN,YAAaoD,GAAE,EACf,mBAAoB,6CACpB,qBAAsB,+CACtB,iBAAkBd,GAGlB,SAAU,CACT,YAAa,GACb,aAAc,CAAA,CAAC,EAGhB,UAAW,CACV,YAAa,CAAE,OAAQe,GAAU,MAAO,sBAAA,EACxC,UAAW,CACV,OAAQ,QACR,MAAO,oBACP,OAAQ,CACP,KAAM,CAAE,OAAQ3C,GAAO,MAAO,gBAAA,EAC9B,SAAU,CAAE,OAAQA,GAAO,MAAO,oCAAA,EAClC,QAAS,CAAE,OAAQA,GAAO,MAAO,eAAA,EACjC,MAAO,CAAE,OAAQA,GAAO,MAAO,2BAAA,CAA4B,CAC5D,CACD,EAID,aAAc,CACb,QAAS,MAAO,CAAE,MAAAI,EAAO,OAAAC,KAA0D,CAElF,CACC,QAAS,CACR,KAAM,cACN,WAAYD,EAAM,aAClB,aAAc,MACd,GAAI,YAAA,CACL,EAGD,CACC,OAAQ,CACP,kBAAmB,CAAE,OAAQC,EAAQ,SAAU,GAAA,CAAI,CACpD,CACD,CACD,CAGF,CAAC,qICnEKuC,GAAiBvB,EAAO,CAC7B,IAAKb,EAAKC,EAAA,EAAUsB,GAAU,GAAG,CAAC,EAClC,QAASV,EAAO,EAAE,EAClB,SAAUmB,GAAMnB,EAAO,EAAE,CAAC,CAC3B,CAAC,EAGKwB,GAA2BL,GAAMI,EAAc,EAG/CE,GAAiBxD,EAAa,CACnC,KAAM,WACN,KAAM,qBACN,YAAayD,GAAE,EAGf,mBAAoB,0CACpB,qBAAsB,4CAGtB,iBAAkBF,GAGlB,SAAU,CACT,OAAQ,CAAA,EACR,SAAU,EACV,eAAgB,GAChB,qBAAsB,EAAA,CAExB,CAAC,EAGYG,GAAoB,CAChCC,EACAC,EACAC,EAAQ,EACRC,IACU,CACVH,EAAM,QAASI,GAAS,CACvBH,EAASG,EAAMF,EAAOC,CAAM,EACxBC,EAAK,UAAYA,EAAK,SAAS,OAAS,GAC3CL,GAAkBK,EAAK,SAAUH,EAAUC,EAAQ,EAAGE,CAAI,CAE5D,CAAC,CACF,EAGaC,GAAqB,CAACL,EAAmBM,IAAoC,CACzF,IAAIC,EAAeP,EACfQ,EAA8B,KAElC,UAAWC,KAASH,EACnB,GAAIG,GAAS,GAAKA,EAAQF,EAAa,OACtCC,EAAaD,EAAaE,CAAK,EAC/BF,EAAeC,EAAW,aAE1B,QAAO,KAIT,OAAOA,CACR,EAGaE,GAAwB,CAACV,EAAmB1D,IAAgE,CACxH,MAAMqE,EAAmB,CAAA,EACnBC,EAAWtE,EAAO,UAAY,EAG9BuE,EAAa,CAACT,EAAgBU,EAAe,IAAY,CAC1DA,EAAeF,GAClBD,EAAO,KAAK,cAAcP,EAAK,SAAS,OAASA,EAAK,GAAG,8BAA8BQ,CAAQ,EAAE,EAElGR,EAAK,SAAS,QAASW,GAAUF,EAAWE,EAAOD,EAAe,CAAC,CAAC,CACrE,EAGME,EAAoBZ,GAAyB,CAClD,MAAMa,EAAgBb,EAAK,SAAS,OAC9Bc,EAAc5E,EAAO,iBAAiB,qBAExC4E,GAAeD,EAAgBC,GAClCP,EAAO,KAAK,cAAcP,EAAK,SAAS,OAASA,EAAK,GAAG,SAASa,CAAa,iCAAiCC,CAAW,EAAE,EAG9Hd,EAAK,SAAS,QAAQY,CAAgB,CACvC,EAEA,OAAAhB,EAAM,QAASI,GAAS,CACvBS,EAAWT,CAAI,EACfY,EAAiBZ,CAAI,CACtB,CAAC,EAEM,CACN,MAAOO,EAAO,SAAW,EACzB,OAAAA,CAAA,CAEF,+KCjGMQ,GAAoBhE,GAAsC,CAE/D,MAAMiE,EAAiBjE,EAAM,SAAuC,IAAKkE,GAAQC,GAAQD,EAAI,KAAK,CAAC,GAAK,CAAA,EAIlGtC,EAASwC,GAAM,CAAC,GAAGH,CAAa,EAAG,+BAA+B,EAGxE,OAAOjE,EAAM,SAAW4B,EAASC,EAASD,CAAM,CACjD,EAGMyC,GAAcnF,EAAyB,CAC5C,KAAM,QACN,KAAM,sBACN,YAAaoF,GAAE,EAGf,mBAAoB,uCACpB,qBAAsB,yCAAA,iBAGtBN,GAGA,SAAU,CACT,QAAS,CAAA,EACT,WAAY,GACZ,OAAQ,EAAA,EAIT,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,OAAQ,CAAE,OAAQD,EAAO,SAAU,GAAO,OAAQ,iCAAA,EAClD,QAAS,CACR,OAAQA,EACR,SAAU,GACV,OAAQ,4FAAA,CACT,EAID,cAAe,KAAO,CACrB,OAAQ,SACR,QAAS,EAAA,EAEX,CAAC,ybCrED,UAOO,IAAA5I,kBAAkB,EAAE,EAIpB,MAAAuN,EAAetO,GAAA,IAAY,OAAO,OAAQuO,GAAoB,GAAG,EAA4B,IAAKC,GAAMA,EAAE,IAAI,CAAA,MAGpHhM,EAAGiM,GAAA,EAEF5G,MAFDrF,CAAG,EAAA,CAAA,EAGDuF,IADDF,CAAM,EACLE,QAAAA,EAAM,QAAA,WAANA,CAAM,EACA2G,GAAAC,EAAA,GAAA,IAAAxO,EAAAmO,CAAe,QAAIM,IAAI,KAC5BzG,EAAM1F,GAAA,MAAN0F,EAAM,EAAA,IAANA,CAAM,wBAAeyG,CAAI,CAAA,WAAXA,CAAI,KAAlBzG,EAAM,OAANA,EAAM,QAAAhI,EAAQyO,CAAI,IAAA,UAAlBzG,CAAM,MAHRN,CAAM,IAFPrF,CAAG,KAEFqF,EAAM9G,CAAA,MAFPyB,CAAG,MAFI,mUCZR,UAQO,IAAAzB,kBAAkB,EAAE,EAAG8N,sBAAa,EAAE,EAItC,MAAAC,SAA8B,OAAO,OAAQP,GAAoB,GAAG,EAA4B,KAAMC,GAAMA,EAAE,OAASK,EAAU,CAAA,CAAA,EACjIE,EAAU/O,GAAA,IAAAG,EAAY2O,CAAkB,GAAE,QAAQ,IAAKE,GAAWA,EAAE,YAAY,EAAE,OAAO,OAAO,GAAA,EAAA,MAGtGxM,EAAGiM,GAAA,EAEF5G,MAFDrF,CAAG,EAAA,CAAA,EAGDuF,IADDF,CAAM,EACLE,QAAAA,EAAM,QAAA,WAANA,CAAM,EACA2G,GAAAC,EAAA,GAAA,IAAAxO,EAAA4O,CAAU,QAAIH,IAAI,KACvBzG,EAAM1F,GAAA,MAAN0F,EAAM,EAAA,IAANA,CAAM,wBAAeyG,CAAI,CAAA,WAAXA,CAAI,KAAlBzG,EAAM,OAANA,EAAM,QAAAhI,EAAQyO,CAAI,IAAA,UAAlBzG,CAAM,MAHRN,CAAM,IAFPrF,CAAG,EAEFoE,EAAA,IAAAiB,YAAmGgH,EAAU,CAAA,KAA7GhH,EAAM9G,CAAA,MAFPyB,CAAG,MAFI,CCcR,MAAMuL,GAAoBhE,GAAyB,CAClD,MAAMkC,EAAW9B,EAAKC,EAAA,EAAUC,EAAU,EAAG,4BAA4B,CAAC,EAC1E,OAAON,EAAM,SAAWkC,EAAWL,EAASK,EAAU,EAAE,CACzD,EAGMgD,GAAiBhG,EAA4B,CAClD,KAAM,WACN,KAAM,0BACN,YAAaiG,GAAE,EACf,mBAAoB,0CACpB,qBAAsB,4CAAA,iBACtBnB,GAGA,UAAW,CAEV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,KAAM,CAAE,OAAQC,GAAe,SAAU,EAAA,EACzC,OAAQ,CAAE,OAAQF,EAAO,SAAU,EAAA,EACnC,MAAO,CAAE,OAAQA,EAAO,SAAU,EAAA,EAClC,YAAa,CAAE,OAAQG,GAAoB,SAAU,EAAA,EAGrD,WAAY,CACX,OAAQqF,GACR,SAAU,EAAA,EAEX,aAAc,CACb,OAAQC,GACR,SAAU,EAAA,CACX,EAGD,SAAU,CACT,WAAY,EAAA,EAIb,aAAc,CACb,QAAS,MAAO,CAAE,MAAArF,EAAO,OAAAC,EAAQ,SAAAqF,KAA+E,CAC/G,CAAE,QAAS,CAAE,KAAMtF,EAAM,WAAY,WAAYA,EAAM,aAAc,aAAc,MAAO,GAAI,cAAc,EAC5G,CACC,OAAQ,CACP,GAAIsF,EAAW,CAAE,uBAAwBA,CAAA,EAAa,CAAA,EACtD,CAAC,eAAetF,EAAM,YAAY,EAAE,EAAG,CAAE,OAAQC,EAAQ,SAAU,GAAA,CAAI,CACxE,CACD,EAED,MAAO,MAAO,CAAE,MAAAD,EAAO,cAAAE,MAEf,CACN,CAAC,GAAGF,EAAM,YAAY,IAAIA,EAAM,YAAY,EAAE,EAAGE,CAAA,EAEnD,EAID,cAAe,KAAO,CACrB,OAAQ,SACR,QAAS,EAAA,EAEX,CAAC,2GC1EKqF,GAAiBC,GAAyB,CAC/C,GAAI,CAACA,EAAM,MAAO,GAElB,IAAIC,EACAC,EAAUF,EAKd,GACCC,EAAWC,EACXA,EAAUA,EAAQ,QAAQ,WAAY,EAAE,QAChCA,IAAYD,GAIrB,OAAAC,EAAUA,EAAQ,QAAQ,QAAS,EAAE,EAE9BA,CACR,EAKMC,GAAkBH,GAClBA,EAGYD,GAAcC,CAAI,EAAE,KAAA,EAErB,SAAW,EALT,GASbxB,GAAoBhE,GAAyB,CAElD,MAAM4B,EAASX,EAAO,CACrB,MAAOY,EAASxB,GAAQ,EACxB,QAASA,EAAA,CAAO,CAChB,EAGD,OAAIL,EAAM,SACFiB,EAAO,CACb,MAAOY,EAASxB,GAAQ,EACxB,QAASD,EACRC,EAAA,EACAuF,GAAQC,GAAU,CAACF,GAAeE,CAAe,EAAG,sBAAsB,CAAA,CAC3E,CACA,EAGKhE,EAASD,CAAM,CACvB,EAGMkE,GAAiB5G,EAA4B,CAClD,KAAM,WACN,KAAM,iCACN,YAAa6G,GAAE,EAGf,mBAAoB,0CACpB,qBAAsB,4CAAA,iBAGtB/B,GAGA,SAAU,CAET,QAAS,CAAC,OAAQ,SAAU,WAAY,QAAS,OAAQ,QAAS,QAAS,OAAO,EAClF,WAAY,EAAA,CAEd,CAAC,2GCzEKgC,GAA0B/E,EAAO,CACtC,OAAQb,EAAKC,EAAA,EAAUC,EAAU,EAAG,qBAAqB,CAAC,EAC1D,YAAaD,EAAA,EACb,WAAYD,EAAKC,EAAA,EAAUC,EAAU,EAAG,0BAA0B,CAAC,EACnE,KAAMF,EAAKC,EAAA,EAAUC,EAAU,EAAG,mBAAmB,CAAC,EACtD,QAASF,EAAKC,EAAA,EAAUC,EAAU,EAAG,sBAAsB,CAAC,EAC5D,SAAU2F,GAAA,EACV,UAAWA,GAAA,CACZ,CAAC,EAGKC,GAAgBhH,EAA2B,CAChD,KAAM,UACN,KAAM,sBACN,YAAaiH,GAAE,EACf,mBAAoB,2CACpB,qBAAsB,6CACtB,iBAAkBH,GAGlB,UAAW,CAEV,MAAO,CAAE,OAAQpG,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,MAAO,CAAE,OAAQD,EAAO,SAAU,EAAA,EAGlC,eAAgB,CACf,OAAQA,EACR,SAAU,GACV,OAAQ,mDAAA,EAET,UAAW,CACV,OAAQA,EACR,SAAU,GACV,OAAQ,0CAAA,EAET,KAAM,CAAE,OAAQA,EAAO,SAAU,GAAO,OAAQ,oCAAA,EAChD,aAAc,CACb,OAAQA,EACR,SAAU,GACV,OAAQ,sEAAA,CACT,EAID,SAAU,CACT,UAAW,CAAE,IAAK,MAAO,IAAK,IAAA,EAC9B,KAAM,GACN,eAAgB,KAChB,aAAc,CAAA,EACd,WAAY,EAAA,EAGb,qBAAuBwG,GACf,CAAC,GAAGA,CAAQ,UAAW,GAAGA,CAAQ,cAAe,GAAGA,CAAQ,QAAS,GAAGA,CAAQ,UAAU,CAEnG,CAAC,2GCzDKpC,GAAoBhE,GAAyB,CAElD,MAAMqG,EAAYjG,EAAKC,EAAA,EAAUiG,GAAM,kBAAmB,mDAAmD,CAAC,EAG9G,OAAItG,EAAM,SACFI,EAAKC,IAAUC,EAAU,EAAG,sBAAsB,EAAG+F,CAAS,EAI/DxE,EAASwE,EAAW,EAAE,CAC9B,EAGME,GAAoBrH,EAA+B,CACxD,KAAM,cACN,KAAM,sBACN,YAAasH,GAAE,EACf,mBAAoB,+CACpB,qBAAsB,iDAAA,iBACtBxC,GAGA,SAAU,CACT,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,MAAO,CAAE,OAAQD,EAAO,SAAU,EAAA,CAAM,CAE1C,CAAC,2GC9BKoE,GAAoBhE,GAAyB,CAElD,MAAMyG,EAAsF,CAAA,EAExFzG,EAAM,WAAa,QACtByG,EAAkB,KAAKC,GAAS1G,EAAM,SAAoB,0BAA0BA,EAAM,QAAQ,GAAG,CAAC,EAEnGA,EAAM,WAAa,QACtByG,EAAkB,KAAKE,GAAS3G,EAAM,SAAoB,yBAAyBA,EAAM,QAAQ,GAAG,CAAC,EAItG,MAAM4G,EAAaX,GAAO,yBAAyB,EAE7CrE,EAAS6E,EAAkB,OAAS,EAAIrG,EAAKwG,EAAY,GAAIH,CAAyB,EAAIG,EAGhG,OAAO5G,EAAM,SAAW4B,EAASC,EAASD,CAAM,CACjD,EAGMiF,GAAiB3H,EAA4B,CAClD,KAAM,WACN,KAAM,mBACN,YAAa4H,GAAE,EACf,mBAAoB,4CACpB,qBAAsB,8CAAA,iBACtB9C,GAGA,SAAU,CACT,aAAc,MACd,WAAY,EAAA,EAOb,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,aAAc,CACb,OAAQD,EACR,SAAU,GACV,OAAQ,sCACR,QAAS,YAAA,EAEV,SAAU,CAAE,OAAQA,EAAO,SAAU,EAAA,EACrC,SAAU,CAAE,OAAQA,EAAO,SAAU,EAAA,EACrC,YAAa,CAAE,OAAQA,EAAO,SAAU,EAAA,CAAM,EAI/C,aAAc,CACb,QAAS,MAAO,CAAE,MAAAI,EAAO,OAAAC,KAA0D,CAGlF,CAAE,OAAQ,CAAE,CAACD,EAAM,YAAY,EAAG,CAAE,IAAK,WAAWC,CAAM,GAAI,CAAE,EAEjE,MAAO,MAAO,CAAE,MAAAD,EAAO,cAAAE,MAAyE,CAC/F,CAACF,EAAM,YAAY,EAAGE,CAAA,EACvB,EAID,cAAe,KAAO,CACrB,OAAQ,QACR,QAAS,EAAA,EAEX,CAAC,2GC5EK6G,GAAqB,CAC1B,eACA,oBACA,mBACA,iBACA,kBACA,cACA,gBACA,aACD,EAEMC,GAAuBpB,GAAQC,GAAmB,CACvD,GAAI,OAAOA,GAAU,SAAU,MAAO,GACtC,MAAMoB,EAASpB,EAAM,MAAM,GAAG,EAAE,CAAC,GAAG,YAAA,EACpC,MAAO,CAACkB,GAAmB,SAASE,CAAM,CAC3C,EAAG,4CAA4C,EAGzCjD,GAAoBhE,GAAyB,CAElD,MAAM4G,EAAaxG,EAAKC,EAAA,EAAU6G,GAAM,qCAAqC,EAAGF,EAA2B,EAGrGpF,EAAS5B,EAAM,SAClBI,EAAKC,IAAUC,EAAU,EAAG,yBAAyB,EAAG4G,GAAM,qCAAqC,EAAGF,EAA2B,EACjIJ,EAGH,OAAO5G,EAAM,SAAW4B,EAASC,EAASD,EAAQ,EAAE,CACrD,EAGMuF,GAAcjI,EAAyB,CAC5C,KAAM,QACN,KAAM,mBACN,YAAakI,GAAE,EACf,mBAAoB,yCACpB,qBAAsB,2CAAA,iBACtBpD,GAGA,SAAU,CACT,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,YAAa,CAAE,OAAQD,EAAO,SAAU,EAAA,CAAM,EAI/C,cAAe,KAAO,CACrB,OAAQ,SACR,QAAS,EAAA,EAEX,CAAC,2GCvDKoE,GAAoBhE,GAAyB,CAElD,MAAMyG,EAAsF,CAAA,EAExFzG,EAAM,MAAQ,QACjByG,EAAkB,KAAKC,GAAS1G,EAAM,IAAe,0BAA0BA,EAAM,GAAG,GAAG,CAAC,EAEzFA,EAAM,MAAQ,QACjByG,EAAkB,KAAKE,GAAS3G,EAAM,IAAe,yBAAyBA,EAAM,GAAG,GAAG,CAAC,EAI5F,MAAM4G,EAAaX,GAAO,yBAAyB,EAE7CrE,EAAS6E,EAAkB,OAAS,EAAIrG,EAAKwG,EAAY,GAAIH,CAAyB,EAAIG,EAGhG,OAAO5G,EAAM,SAAW4B,EAASC,EAASD,CAAM,CACjD,EAGMyF,GAAenI,EAA0B,CAC9C,KAAM,SACN,KAAM,cACN,YAAaoI,GAAE,EACf,mBAAoB,0CACpB,qBAAsB,4CAAA,iBACtBtD,GAGA,SAAU,CACT,KAAM,EACN,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,IAAK,CAAE,OAAQD,EAAO,SAAU,GAAO,OAAQ,wBAAA,EAC/C,IAAK,CAAE,OAAQA,EAAO,SAAU,GAAO,OAAQ,wBAAA,EAC/C,KAAM,CAAE,OAAQA,EAAO,SAAU,GAAO,OAAQ,oBAAA,EAChD,YAAa,CAAE,OAAQA,EAAO,SAAU,EAAA,CAAM,EAI/C,aAAc,CACb,QAAS,MAAO,CAAE,MAAAI,EAAO,OAAAC,KAA0D,CAElF,CAAE,OAAQ,CAAE,CAACD,EAAM,YAAY,EAAG,CAAE,IAAK,WAAWC,CAAM,GAAI,CAAE,EAEjE,MAAO,MAAO,CAAE,MAAAD,EAAO,cAAAE,MAAyE,CAC/F,CAACF,EAAM,YAAY,EAAGE,CAAA,EACvB,EAID,cAAe,KAAO,CACrB,OAAQ,QACR,QAAS,EAAA,EAEX,CAAC,2GC/DK8D,GAAoBhE,GAAyB,CAElD,MAAMuH,EAAiB,gCACjBC,EAAoB,yEAGpBC,EAAoBzH,EAAM,QAAU,IAAI,OAAOA,EAAM,OAAiB,EAAIuH,EAG1EX,EAAaxG,EAAKC,EAAA,EAAUiG,GAAMmB,EAAmBD,CAAiB,CAAC,EAGvE5F,EAAS5B,EAAM,SAClBI,EAAKC,IAAUC,EAAU,EAAG,yBAAyB,EAAGgG,GAAMmB,EAAmBD,CAAiB,CAAQ,EAC1GZ,EAGH,OAAO5G,EAAM,SAAW4B,EAASC,EAASD,EAAQ,EAAE,CACrD,EAGM8F,GAAoBxI,EAA+B,CACxD,KAAM,cACN,KAAM,4BACN,YAAayI,GAAE,EACf,mBAAoB,+CACpB,qBAAsB,iDAAA,iBACtB3D,GAGA,SAAU,CACT,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,YAAa,CAAE,OAAQD,EAAO,SAAU,EAAA,EACxC,QAAS,CAAE,OAAQA,EAAO,SAAU,GAAO,OAAQ,wCAAA,CAAyC,CAE9F,CAAC,2GCxCKoE,GAAoBhE,GAAyB,CAElD,MAAM4H,EAAO5H,EAAM,KAAO,EAGpB4B,EAASxB,EAAK6F,GAAO,0BAA0B,EAAGS,GAAS,EAAG,uBAAuB,EAAGC,GAASiB,EAAK,wBAAwBA,CAAG,GAAG,CAAC,EAG3I,OAAO5H,EAAM,SAAW4B,EAASC,EAASD,CAAM,CACjD,EAGMiG,GAAe3I,EAA0B,CAC9C,KAAM,SACN,KAAM,gCACN,YAAa4I,GAAE,EACf,mBAAoB,0CACpB,qBAAsB,4CAAA,iBACtB9D,GAGA,SAAU,CACT,IAAK,EACL,SAAU,wBACV,UAAW,gCACX,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,IAAK,CAAE,OAAQD,EAAO,SAAU,GAAO,OAAQ,0BAAA,EAC/C,SAAU,CAAE,OAAQE,GAAe,SAAU,EAAA,EAC7C,UAAW,CAAE,OAAQA,GAAe,SAAU,EAAA,CAAM,EAIrD,aAAc,CACb,QAAS,MAAO,CAAE,MAAAE,EAAO,OAAAC,KAA0D,CAClF,CAAE,OAAQ,CAAE,CAACD,EAAM,YAAY,EAAG,CAAE,IAAK,SAASC,EAAQ,EAAE,GAAI,CAAE,EAEnE,MAAO,MAAO,CAAE,MAAAD,EAAO,cAAAE,MAAyE,CAC/F,CAACF,EAAM,YAAY,EAAGE,CAAA,EACvB,EAID,cAAe,KAAO,CACrB,OAAQ,MACR,QAAS,EAAA,EAEX,CAAC,2GCrDK6H,GAA0B,CAC/B,+EACA,uCACA,+CACA,wDACD,EAGMC,GAAwB/G,EAAO,CACpC,SAAUmD,GAAM,CAACD,GAAQ,SAAS,EAAGA,GAAQ,OAAO,EAAGA,GAAQ,QAAQ,EAAGA,GAAQ,QAAQ,EAAGA,GAAQ,OAAO,CAAC,CAAC,EAC9G,IAAK/D,EACJC,EAAA,EACA1I,GAAI,4BAA4B,EAChCiO,GAAQC,GAAU,CACjB,MAAMoC,EAAMpC,EACZ,OAAOkC,GAAwB,KAAMG,GAAYA,EAAQ,KAAKD,CAAG,CAAC,CACnE,EAAG,gFAAgF,CAAA,EAEpF,QAAS7H,EAAKC,EAAA,EAAUC,EAAU,EAAG,uBAAuB,CAAC,EAC7D,MAAOF,EAAKC,EAAA,EAAUC,EAAU,EAAG,0BAA0B,CAAC,EAC9D,aAAcF,EAAKC,EAAA,EAAU1I,GAAI,gCAAgC,CAAC,EAClE,aAAckK,EAASxB,GAAQ,EAC/B,SAAUwB,EAASxB,GAAQ,EAC3B,MAAOwB,EAASoE,IAAQ,EACxB,OAAQpE,EAASoE,IAAQ,EACzB,YAAapE,EAASxB,EAAA,CAAQ,CAC/B,CAAC,EAGK2D,GAAmBgE,GAGnBG,GAAoBjJ,EAAa,CACtC,KAAM,cACN,KAAM,oBACN,YAAakJ,GAAE,EACf,mBAAoB,+CACpB,qBAAsB,iDACtB,iBAAApE,GAGA,SAAU,CACT,YAAa,mDACb,iBAAkB,CAAC,UAAW,QAAS,SAAU,QAAQ,EACzD,WAAY,EAAA,EAIb,UAAW,CACV,MAAO,CAAE,OAAQpE,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,YAAa,CAAE,OAAQD,EAAO,SAAU,EAAA,EACxC,iBAAkB,CACjB,OAAQA,EACR,SAAU,GACV,OAAQ,oDAAA,CACT,EAID,aAAc,CACb,QAAS,MAAO,CAAE,MAAAI,EAAO,OAAAC,KAA0D,CAClF,CAAE,OAAQ,CAAE,CAAC,GAAGD,EAAM,YAAY,QAAQ,EAAG,CAAE,OAAQC,EAAQ,SAAU,GAAA,EAAM,CAAE,EAElF,MAAO,MAAO,CAAE,MAAAD,EAAO,cAAAE,MAAyE,CAC/F,CAAC,GAAGF,EAAM,YAAY,QAAQ,EAAGE,CAAA,EAClC,EAID,cAAe,CAAC,CAAE,MAAA9F,MAAgC,CACjD,OAAQA,EACR,QAAS;AAAA,mBACQA,CAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAA,EAcxB,CAAC,2GC9FKiO,GAAcJ,GACZA,EAAI,QAAQ,KAAM,OAAO,EAAE,QAAQ,KAAM,MAAM,EAAE,QAAQ,KAAM,MAAM,EAAE,QAAQ,KAAM,QAAQ,EAAE,QAAQ,KAAM,QAAQ,EAIvHK,GAAsBrH,EAAO,CAClC,MAAOb,EAAKC,EAAA,EAAUsB,GAAU,GAAI,sCAAsC,EAAGD,GAAU2G,EAAU,CAAC,EAClG,YAAajI,EAAKC,EAAA,EAAUsB,GAAU,IAAK,6CAA6C,EAAGD,GAAU2G,EAAU,CAAC,EAChH,aAAcjI,EAAKC,EAAA,EAAUqB,GAAU2G,EAAU,CAAC,EAElD,WAAYjI,EAAKC,EAAA,EAAUqB,GAAU2G,EAAU,CAAC,EAChD,aAAcxG,EAASzB,EAAKC,IAAU1I,GAAI,sBAAsB,EAAG2O,GAAM,eAAgB,iCAAiC,CAAC,CAAC,EAE5H,QAASzE,EAASxB,GAAQ,EAC1B,cAAewB,EAASxB,GAAQ,EAChC,QAASwB,EAASxB,GAAQ,EAC1B,YAAa+D,GAAM,CAACD,GAAQ,SAAS,EAAGA,GAAQ,qBAAqB,CAAC,CAAC,EACvE,aAActC,EAASxB,GAAQ,EAC/B,mBAAoBwB,EAASxB,GAAQ,EACrC,aAAcwB,EAASxB,GAAQ,EAE/B,aAAcwB,EACbzB,EACCC,EAAA,EACAuF,GAAQC,GAAU,CACjB,GAAI,CAACA,EAAO,MAAO,GACnB,GAAI,CACH,MAAM0C,EAAS,KAAK,MAAM1C,CAAe,EAEzC,OAAO,OAAO0C,GAAW,UAAY,CAAC,MAAM,QAAQA,CAAM,CAC3D,MAAQ,CACP,MAAO,EACR,CACD,EAAG,2BAA2B,CAAA,CAC/B,CAEF,CAAC,EAGKC,GAAYtJ,EAAa,CAC9B,KAAM,MACN,KAAM,aACN,YAAauJ,GAAE,EACf,mBAAoB,uCACpB,qBAAsB,yCACtB,iBAAkBH,GAGlB,SAAU,CACT,SAAU,CAAC,SAAU,SAAU,WAAY,IAAI,EAC/C,WAAY,EAAA,EAIb,qBAAuBlC,GAGf,CACN,GAAGA,CAAQ,SACX,GAAGA,CAAQ,eACX,GAAGA,CAAQ,gBACX,GAAGA,CAAQ,WACX,GAAGA,CAAQ,iBACX,GAAGA,CAAQ,gBACX,GAAGA,CAAQ,sBACX,GAAGA,CAAQ,eAAA,EAKb,UAAW,CACV,MAAO,CAAE,OAAQxG,EAAO,SAAU,EAAA,EAClC,aAAc,CAAE,OAAQA,EAAO,SAAU,EAAA,EACzC,SAAU,CAAE,OAAQC,EAAS,SAAU,EAAA,EACvC,WAAY,CAAE,OAAQA,EAAS,SAAU,EAAA,EACzC,SAAU,CACT,OAAQD,EACR,SAAU,GACV,OAAQ,0DAAA,CACT,EAKD,cAAe,KAAO,CACrB,OAAQ,SACR,QAAS,EAAA,EAEX,CAAC,2GCxGY8I,GAAc,OAAA,OAAA,CAAA,2BAAAC,GAAA,uBAAAC,GAAA,4BAAAC,GAAA,wBAAAC,GAAA,wBAAAC,GAAA,8BAAAC,GAAA,2BAAAC,GAAA,wBAAAC,GAAA,2BAAAC,GAAA,2BAAAC,EAAA,CAAA,EAIdC,GAAgB,OAAA,OAAA,CAAA,4BAAAC,GAAA,gCAAAC,GAAA,6BAAAC,GAAA,0BAAAC,GAAA,2BAAAC,GAAA,gCAAAC,GAAA,2BAAAC,GAAA,gCAAAC,GAAA,wBAAAC,EAAA,CAAA,GAIG,CAAE,GAAGpB,GAAa,GAAGW,EAAa,GCS5D,MAAAU,EAAY,IACP/U,EAAAM,GAAA,CAAA,CAAA,CAAA,MAAV,SAAA,uBAAA,QAAA0B,EAAA,oBACkBhC,EAAAM,GAAA,CAAA,CAAA,CAAA,MAAlB,iBAAA,uBAAA,gBAAA0B,EAAA,oBACchC,EAAAM,GAAA,CAAA,CAAA,CAAA,MAAd,aAAA,uBAAA,YAAA0B,EAAA,oBACgBhC,EAAAM,GAAA,CAAA,CAAA,CAAA,MAAhB,eAAA,uBAAA,cAAA0B,EAAA,oBACqBhC,EAAAM,GAAA,CAAA,CAAA,CAAA,MAArB,oBAAA,uBAAA,mBAAA0B,EAAA,oBACgBhC,EAAAM,GAAA,CAAA,CAAA,CAAA,MAAhB,eAAA,uBAAA,cAAA0B,EAAA,oBACgBhC,EAAAM,GAAA,CAAA,CAAA,CAAA,MAAhB,eAAA,uBAAA,cAAA0B,EAAA,iBAEWgT,GAAAhV,EAAe,SAAS,MAAnC,UAAA,uBAAA,SAAAgC,EAAA,iBACWiT,GAAAjV,EAAO,EAAK,MAAvB,UAAA,uBAAA,SAAAgC,EAAA,iBACUkT,GAAAlV,EAAO,EAAK,MAAtB,SAAA,uBAAA,QAAAgC,EAAA,iBACemT,GAAAnV,EAAiD,cAAc,MAA9E,cAAA,uBAAA,aAAAgC,EAAA,iBACkBoT,GAAApV,QAAoC,MAAtD,iBAAA,uBAAA,gBAAAgC,EAAA,iBAEA,aAAc,CAEd,CAEM,MAAA,WAAWsO,EAAW,UAAW+E,EAAoC,IACtE,KAAK,QAAS,CACjBC,GAAO,MAAM,6DAA6D,QAE3E,IACI,KAAK,UAAY,KAAK,WAAahF,GAAA,CAAa+E,EAAW,CAC9DC,GAAO,MAAM,gEAAgE,QAE9E,CAEA,KAAK,QAAU,GACf,KAAK,SAAWhF,EAChBgF,GAAO,KAAA,0CAA+ChF,CAAQ,EAAA,KAE1D,OAEGiF,KACAC,KACAC,KACAC,eAGMvH,EAAMwH,CAAM,IAAK,OAAO,QAAQjC,EAAW,EAAG,OACnD7D,EAAO1B,EAAK,MAAM,GAAG,EAAE,KAAK,EAC7B,GAAA,CAAA0B,GAAA,OAAgB8F,EAAe,SAAY,WAAA,eAE1CC,EAAMD,EAAe,QACrBE,EAAaD,EAAG,MAAQ/F,EAC9B+F,EAAG,KAAOC,EACTD,EAAW,aAAe,OAE3BL,EAAmBM,CAAU,EAAID,EACjCJ,EAAe,KAAKK,CAAU,EAEzBD,EAAW,gBAAmBA,EAAW,eAAe,OAAS,IACrEF,EAAiBG,CAAU,EAAKD,EAAW,gBAGxC/F,GAAQA,IAASgG,IACpBN,EAAmB1F,CAAI,EAAI+F,EAE7B,WAGYzH,EAAMwH,CAAM,IAAK,OAAO,QAAQtB,EAAa,EAAG,OACrDxE,EAAO1B,EAAK,MAAM,GAAG,EAAE,KAAK,EAC7B,GAAA,CAAA0B,GAAA,OAAgB8F,EAAe,SAAY,WAAA,eAE1CC,EAAMD,EAAe,QACrBE,EAAaD,EAAG,MAAQ/F,EAC9B+F,EAAG,KAAOC,EACTD,EAAW,aAAe,SAE3BL,EAAmBM,CAAU,EAAID,EACjCH,EAAiB,KAAKI,CAAU,EAE3BD,EAAW,gBAAmBA,EAAW,eAAe,OAAS,IACrEF,EAAiBG,CAAU,EAAKD,EAAW,gBAGxC/F,GAAQA,IAASgG,IACpBN,EAAmB1F,CAAI,EAAI+F,EAE7B,CAEA,KAAK,gBAAkBL,EACvB,KAAK,YAAcC,EACnB,KAAK,cAAgBC,EACrB,KAAK,cAAgBC,MAGjBI,KACA,GAAAT,EAAW,CACR,MAAAU,EAAA,MAAkBV,EAAU,QAAQ,iBAAA,EACtCU,EAAU,UACbD,GAAqBC,EAAU,UAAY,IAAKC,GAAMA,EAAE,IAAI,EAE9D,SAAA,OAAkB,OAAW,IAAa,CAEnC,MAAAC,EAAA,MAAY,MAAA,sBAA6B,KAAK,SAA6B,GAAlB,eAAoB,GAAA,CAClF,QAAA,CAAW,cAAe3F,CAAA,EAAA,EAEvB2F,EAAI,KAEPH,IADM,MAAaG,EAAI,KAAA,GACG,aAAe,IAAKD,GAAWA,EAAE,IAAI,EAEjE,CAGM,MAAAE,EAAmBJ,EACvB,IAAKjG,GAAS,CACV,GAAA,KAAK,gBAAgBA,CAAI,SAAUA,EACjC,MAAAsG,EAAYtG,EAAK,OAAO,CAAC,EAAE,cAAgBA,EAAK,MAAM,CAAC,EACzD,GAAA,KAAK,gBAAgBsG,CAAS,SAAUA,QACtCC,EAAYvG,EAAK,YAAA,EACnB,OAAA,KAAK,gBAAgBuG,CAAS,EAAUA,EACrCvG,CACR,CAAC,EACA,OAAQA,GAAS,KAAK,gBAAgBA,CAAI,CAAA,EAEtCwG,EAAA,QAAuB,IAAA,CAAA,GAAQH,EAAA,GAAqBV,CAAc,CAAA,GACxE,KAAK,cAAgBa,QAGfC,eACMzG,EAAM+F,CAAE,IAAK,OAAO,QAAQ,KAAK,eAAe,EAC3DU,EAAWzG,CAAI,EAAK+F,EAAA,EAAA,EAErB,KAAK,QAAUU,EAEf,KAAK,SAAW,GAChB,KAAK,QAAU,GACf,KAAK,aAAe,UACpB,KAAK,gBAAkB,KAAK,IAAA,EAE5BhB,GAAO,KAAA,8BAAmC,KAAK,YAAY,MAAM,UAAU,KAAK,cAAc,MAAM,kBAAA,CACrG,OAAS9R,EAAG,CACX,KAAK,QAAU,GACf,KAAK,aAAe,YACpB8R,GAAO,MAAM,uCAAwC9R,CAAC,CACvD,CACD,CAEM,MAAA,aAAaqM,EAAc0G,EAAsBjG,EAAmB,CACnE,MAAAkG,EAAelG,GAAY,KAAK,SAChCmG,EAASF,IAAW,YAEtB,EAAAE,GAAUC,GAAa7G,CAAI,GAE1B,IAAA,CAAA4G,GAAA,CAAWE,GAAiB9G,CAAI,EAC1B,MAAA,IAAA,+BAA+BA,CAAI,8BAAA,EAG1C,GAAA4G,EAAQ,OAELG,EADOC,GAAsBhH,CAAI,EACb,OAAQiH,IAASC,GAAeD,CAAG,CAAA,EACzD,GAAAF,EAAa,OAAS,EACf,MAAA,IAAA,gCAAgC/G,CAAI,2BAA2B+G,EAAa,KAAK,IAAI,CAAA,EAAA,CAEjG,IAGI,CACG,MAAA,KAAK,iBAAiB/G,EAAM4G,EAAQD,CAAY,EAGlDC,EACE,KAAK,cAAc,SAAS5G,CAAI,GACpC,KAAK,cAAc,KAAKA,CAAI,EAG7B,KAAK,cAAgB,KAAK,cAAc,OAAQmG,GAAMA,IAAMnG,CAAI,EAGjEyF,GAAO,KAAA,yBAA8BzF,CAAI,wBAAwB0G,CAAM,GAAA,CACxE,OAAS/S,EAAG,CACX,MAAA8R,GAAO,MAAA,6CAAmDzF,CAAI,IAAKrM,CAAC,EAC9DA,CACP,EACD,CAEM,MAAA,aAAaqM,EAAc1F,EAA6B,CACvD,MAAA6M,EAAY,KAAK,gBAAgBnH,CAAI,MACtCmH,GAAA,OAAoBA,GAAc,WAAA,OAEjC,MAAAC,EAAY,OAAO,OAAQC,GAAaF,EAAA,CAAA,GAAe7M,EAAA,GAAW+M,CAAA,GAAQF,CAAS,EAEzF,KAAK,gBAAgBnH,CAAI,EAAIoH,EAC7B,KAAK,QAAQpH,CAAI,EAAIoH,EAAA,CAAA,CAAA,CACtB,OAEM,OAAO3G,EAAmB,CAC/B,KAAK,SAAW,GACV,MAAA,KAAK,WAAWA,GAAY,KAAK,QAAQ,CAChD,CAEc,MAAA,iBAAiBT,EAAc4G,EAAiBnG,EAAkB,WACpE,OAAW,KAMhB,EALC,MAAY,MAAM,sBAAA,CACvB,OAAQ,OACR,SAAW,eAAgB,mBAAoB,cAAeA,CAAA,EAC9D,KAAM,KAAK,UAAA,CAAY,WAAYT,EAAM,SAAU4G,OAE3C,GAAA,MAAA,IAAc,MAAM,sBAAsB,CAErD,CACD,CAEa,MAAAU,MAAcpC,YAYXgC,GAAelH,EAAuB,CAC9C,OAAAsH,EAAQ,cAAc,SAAStH,CAAI,CAC3C,UAEgB6G,GAAa7G,EAAuB,CAC5C,OAAAsH,EAAQ,YAAY,SAAStH,CAAI,CACzC,UAUgBgH,GAAsBhH,EAAwB,QACtDsH,EAAQ,cAActH,CAAI,GAAA,CAAA,CAClC,UAEgB8G,GAAiB9G,EAAuB,QACnD6G,GAAa7G,CAAI,EAAU,IACZ,OAAO,QAAQsH,EAAQ,aAAa,EACrD,OAAA,CAAA,CAAA,CAAWC,CAAI,IAAMA,EAAK,SAASvH,CAAI,GACvC,MAAMwH,CAAC,IAAMA,CAAC,EACG,KAAKN,EAAc,CACvC,OAOaO,GAAA,CACZ,aAAcH,EAAQ,aAAa,KAAKA,CAAO,EAC/C,aAAcA,EAAQ,aAAa,KAAKA,CAAO,EAC/C,OAAQA,EAAQ,OAAO,KAAKA,CAAO,EACnC,kBAAmBA,EAAQ,WAAW,KAAKA,CAAO,GAItCI,GAAA,CACZ,UAAU3B,EAAqC,CAC9C,OAAAA,EAAGuB,EAAQ,eAAe,EACb,IAAA,CAAA,CACd"}