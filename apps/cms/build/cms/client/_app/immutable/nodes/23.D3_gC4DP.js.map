{"version":3,"mappings":"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","names":["RootContext","createContext","props","$.rest_props","$$props","fileUpload","element","children","rest","attributes","mergeProps","$.snippet","node_1","$.get","button","root_2","$.attribute_effect","$.noop","$$render","consequent","alternate","$.derived","div","input","ItemContext","times","$$anchor","itemProps","$.fallback","root_3","ul","getItemEntry","item","isDirectoryEntry","entry","isFileEntry","addRelativePath","file","path","getFileEntries","items","traverseDirectories","getDirectoryFiles","resolve","b","reader","entryPromises","readDirectoryEntries","entries","entries2","promises","resolve2","isMIMEType","v","isExt","isValidMIME","getAcceptAttrString","accept","a","mimeType","ext","isFileEqual","file1","file2","isDefined","isValidFileSize","minSize","maxSize","mimeTypes","mimeTypesMap","mime","extensions","getFileMimeType","name","extension","isFileAccepted","types","fileName","baseMimeType","type","validType","isValidFileType","isAcceptable","i18nCache","Ins","formatterCache","locale","options","cacheKey","formatter","getNumberFormatter","formatNumber","bitPrefixes","bytePrefixes","formatBytes","bytes","unitSystem","precision","unit","unitDisplay","factor","prefix","isNegative","value","index","finalValue","anatomy","createAnatomy","parts","getRootId","ctx","getDropzoneId","getHiddenInputId","getTriggerId","getLabelId","getItemId","id","getItemNameId","getItemSizeTextId","getItemPreviewId","getItemDeleteTriggerId","getFileId","hash","getRootEl","getHiddenInputEl","getDropzoneEl","isEventWithFiles","event","target","getEventTarget","isFilesWithinRange","incomingCount","currentAcceptedFiles","prop","computed","getEventFiles","files","currentRejectedFiles","acceptedFiles","rejectedFiles","validateParams","accepted","acceptError","sizeMatch","sizeError","validateErrors","valid","errors","setInputFiles","inputEl","win","getWindow","dataTransfer","DEFAULT_ITEM_TYPE","INTERACTIVE_SELECTOR","isInteractiveTarget","container","interactive","contains","connect","service","normalize","state","send","scope","context","disabled","readOnly","required","allowDrop","translations","dragging","focused","maxFiles","cb","url","dt","acc","dataAttr","props2","count","flatArray","visuallyHiddenStyle","machine","createMachine","bindable","getContext","i","track","action","doc","onDragOver","onDrop","callAll","addDomEvent","raf","params","set","prev","transform","err","warn","createProps","splitProps","createSplitProps","splitItemProps","$$d","$$array","componentProps","li","label","node","useFileUpload","useMachine","normalizeProps","$.props_id","fileUploadProps","FileUpload","Root","RootProvider","Label","Dropzone","Trigger","ClearTrigger","HiddenInput","ItemGroup","Item","ItemName","ItemSizeText","ItemDeleteTrigger","span","root","$.set_class","m.boolean_yes","m.boolean_no","roles","$.prop","roleClasses","roleId","role","r","iconForRole","roleName","iconify_icon","$.first_child","fragment","$.template_effect","$.set_custom_element_data","span_1","$0","token","user_id","email","expires","user","page","convertLegacyFormat","tokenForm","Form","addUserTokenSchema","$.user_effect","onFormSubmit","isEditMode","endpoint","method","body","convertExpiresToHours","response","responseData","toaster","invalidateAll","message","deleteToken","data","m.modal_token_deleted_successfully","form","div_1","m.email","FloatingInput","$$value","div_2","root_1","$.set_text","text","div_3","div_4","div_5","div_6","$.each","node_4","root_4","node_5","$.child","root_5","consequent_1","$.sibling","$.reset","text_2","$.append","div_7","root_6","consequent_2","text_1","m.role","consequent_3","div_8","node_2","select","option","option_1","option_2","option_3","option_4","option_5","footer","button_1","root_7","iconify_icon_1","span_2","text_4","m.button_delete","consequent_4","button_2","node_6","modalState","button_3","m.modaltokenuser_tokenvalidity","m.button_cancel","m.button_save","$.event","isFirstUser","modaleEditFormConfig","deleteUserPermissionConfig","isGivenData","username","editForm","editUserSchema","showPassword","$.state","isOwnProfile","canChangePassword","hasDeletePermission","showDeleteButton","originalData","submitData","result","deleteUser","successMessage","header","article","m.username","$1","text_3","iconify_icon_2","iconify_icon_3","m.modaleditform_newpassword","div_9","iconify_icon_4","m.confirm_password","m.form_confirmpassword","node_8","div_10","text_5","consequent_5","PermissionGuard","node_10","div_11","root_8","div_12","div_13","div_14","node_13","root_10","node_14","root_11","iconify_icon_5","consequent_6","text_7","consequent_7","text_6","div_15","root_12","div_16","div_17","div_18","div_19","iconify_icon_6","div_20","consequent_8","root_14","iconify_icon_7","text_10","consequent_9","div_21","node_15","isUser","row","isToken","totalUsers","currentUser","onUpdate","listboxValue","isDropdownOpen","hoveredAction","dropdownRef","storeListboxValue","handleClickOutside","$.set","onMount","onDestroy","safeSelectedRows","isDisabled","isMultipleSelected","blockState","users","blockedCount","unblockedCount","tokens","availableActions","baseActions","currentBlockState","filteredActions","isDeleteDisabled","convertDateToExpiresFormat","expiresDate","now","diffMs","diffHours","diffDays","actionConfig","m.adminarea_title","m.multibuttontoken_modaltitle","m.multibuttontoken_modalbody","firstRow","executeBatchAction","config","res","errorMessage","toastMessage","ids","error","logger","handleAction","ModalEditForm","ModalEditToken","showConfirm","toggleDropdown","e","handleOptionClick","$.index","$.transition","scale","quintOut","$.set_attribute","isMultiTenant","waitFilter","debounce","flipDurationMs","tableData","$.proxy","totalItems","fetchData","globalLoadingStore","loadingOperations","showUserList","currentPage","rowsPerPage","sorting","globalSearchValue","errorData","handleBatchUpdate","updated","updatedData","shouldUpdate","selectedMap","selectAll","tableHeadersUser","m.adminarea_blocked","m.form_avatar","m.adminarea_user_id","m.adminarea_activesession","m.adminarea_lastaccess","m.adminarea_createat","m.adminarea_updatedat","tableHeaderToken","m.adminarea_token","m.adminarea_expiresin","showUsertoken","showExpiredTokens","searchShow","filterShow","columnShow","density","settings","selectAllColumns","filters","displayTableHeaders","baseHeaders","relevantHeaders","h","untrack","editToken","tokenId","tokenData","normalizeMediaUrl","clean","getRemainingTime","diffMinutes","remainingHours","remainingMinutes","formatDate","d","toggleUserBlocked","actionPastTense","actionColor","actionWord","modalTitle","modalBody","performBlockAction","toggleTokenBlocked","performTokenBlockAction","handleDndConsider","handleDndFinalize","modalTokenUser","toggleUserList","toggleUserToken","pagesCount","selectedRows","isSelected","handleCheckboxChange","allColumnsVisible","handleInputChange","headerKey","newFilters","p","PermissionAction","PermissionType","expiredTokens","m.adminarea_hideusertoken","m.adminarea_showtoken","span_3","fragment_2","h2","m.adminarea_userlist","m.adminarea_listtoken","TableFilter","Multibutton","node_7","root_9","section","button_4","span_4","span_5","text_9","flip","$.action","$$node","$$action_arg","dndzone","m.entrylist_dnd","m.entrylist_all","node_9","table","thead","node_11","tr","th","button_5","root_13","th_1","m.entrylist_filter","tr_1","TableIcons","checked","node_16","th_2","root_15","classes","tbody","expiresVal","isExpired","tr_2","root_16","node_17","node_18","td","root_17","button_6","root_19","node_21","Boolean","button_7","root_20","node_22","alternate_1","Avatar","avatarSrc","Avatar_Image","Avatar_Fallback","Role","root_28","span_6","button_8","val","root_30","span_7","button_9","iconify_icon_8","dateKey","dateValue","text_14","isTokenExpired","remainingTime","span_8","root_35","iconify_icon_9","root_36","consequent_15","$.clsx","consequent_16","alternate_2","displayValue","consequent_17","alternate_3","consequent_14","alternate_4","consequent_13","alternate_5","consequent_12","alternate_6","consequent_11","alternate_7","consequent_10","alternate_8","alternate_9","TablePagination","node_34","rows","root_39","text_17","m.adminarea_nouser","text_18","m.adminarea_notoken","consequent_20","consequent_19","alternate_10","consequent_18","alternate_11","consequent_21","$3","m.adminarea_adminarea","m.adminarea_emailtoken","m.adminarea_hideuserlist","m.adminarea_showuserlist","isUploading","uploadProgress","previewUrl","imageLoadError","displayAvatar","src","imageTypes","MAX_FILE_SIZE","COMPRESSION_THRESHOLD","acceptMime","blobSchema","instance","fileSchema","pipe","check","m.modaledit_avatarfilesize","avatarSchema","object","onFileChange","details","inputFiles","lastFile","createOptimizedPreview","canvas","img","ratio","fileReader","parse","uploadAvatar","valiError","compressFile","blob","compressedFile","processedFile","formData","axios","progressEvent","deleteAvatar","currentAvatar","msg","FileUpload_HiddenInput","FileUpload_Trigger","node_3","FileUpload_Dropzone","m.modaledit_avatarfilesallowed","small","node_12","title","description","code","isVerifying","useBackupCode","handleInput","submitCode","trimmedCode","m.twofa_error_empty_code","m.twofa_error_invalid_code","m.twofa_error_invalid_backup_code","cancelVerification","toggleCodeType","handleKeydown","h4","input_1","$.remove_input_defaults","p_1","m.twofa_verifying","fragment_1","m.twofa_verify_button","p_2","text_8","m.twofa_help_authenticator","p_3","m.twofa_help_backup","$2","$5","m.twofa_verify_title","m.twofa_backup_verify_description","m.twofa_verify_description","m.twofa_backup_code_placeholder","m.twofa_code_placeholder","m.twofa_use_authenticator","m.twofa_use_backup_code","isLoading","backupCodes","setupData","verificationCode","is2FAEnabled","loadSetupData","showSuccessToast","showErrorToast","otpauthUrl","qrCodeImageUrl","m.twofa_error_setup_failed","verify2FA","m.twofa_success_enabled","disable2FA","TwoFactorVerifyModal","m.twofa_disable_verify_title","m.twofa_disable_verify_description","m.twofa_success_disabled","generateBackupCodes","m.twofa_backup_codes_generated","cHeader","m.twofa_setting_up","h4_1","p_4","code_1","h4_2","p_5","h5","p_6","m.twofa_setup_scan_title","m.twofa_setup_step_1","m.twofa_show_secret","m.twofa_manual_entry_description","m.twofa_verify_setup_title","m.twofa_verify_setup_description","m.twofa_backup_codes_title","m.twofa_backup_codes_save_description","p_7","h5_1","p_8","p_9","m.twofa_backup_codes_description","m.twofa_backup_codes_warning","text_16","m.twofa_enabled_description","fragment_3","text_22","fragment_4","text_23","fragment_6","fragment_7","text_24","m.twofa_generating_codes","iconify_icon_10","fragment_8","text_25","m.twofa_generate_backup_codes","iconify_icon_11","fragment_9","text_26","m.twofa_disabling","iconify_icon_12","fragment_10","text_27","m.twofa_disable_button","m.twofa_title","m.twofa_description","m.twofa_status_enabled","m.twofa_status_disabled","triggerActionStore","writable","serverUser","is2FAEnabledGlobal","password","open2FAModal","ModalTwoFactorAuth","executeActions","actions","$triggerActionStore","setCollection","modalUserForm","m.usermodaluser_settingbody","modalEditAvatar","ModalEditAvatar","m.usermodaluser_settingtitle","modalConfirm","m.usermodalconfirmtitle","m.usermodalconfirmbody","normalizeAvatarUrl","m.userpage_title","PageTitle","permission","label_1","label_2","input_2","m.form_password","m.userpage_edit_usersetting","AdminArea","m.userpage_editavatar","m.userpage_user_id"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],"sources":["../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/modules/root-context.js","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/clear-trigger.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/dropzone.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/hidden-input.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/modules/item-context.js","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/item-delete-trigger.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/item-group.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/item-name.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/item-size-text.svelte","../../../../../../../../node_modules/@zag-js/file-utils/dist/index.mjs","../../../../../../../../node_modules/@zag-js/i18n-utils/dist/index.mjs","../../../../../../../../node_modules/@zag-js/file-upload/dist/index.mjs","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/item.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/label.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/root-context.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/root-provider.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/modules/provider.svelte.js","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/root.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/anatomy/trigger.svelte","../../../../../../../../node_modules/@skeletonlabs/skeleton-svelte/dist/components/file-upload/modules/anatomy.js","../../../../../../../../shared/components/src/system/table/Boolean.svelte","../../../../../../../../shared/components/src/system/table/Role.svelte","../../../../../../../../shared/features/src/user/components/ModalEditToken.svelte","../../../../../../../../shared/features/src/user/components/ModalEditForm.svelte","../../../../../../../../shared/features/src/user/components/Multibutton.svelte","../../../../../../../../shared/features/src/user/components/AdminArea.svelte","../../../../../../../../shared/features/src/user/components/ModalEditAvatar.svelte","../../../../../../../../shared/features/src/user/components/TwoFactorVerifyModal.svelte","../../../../../../../../shared/features/src/user/components/ModalTwoFactorAuth.svelte","../../../../../../../../shared/utils/src/globalSearchIndex.ts","../../../../../../src/routes/user/+page.svelte"],"sourcesContent":["import { createContext } from '../../../internal/create-context.js';\nexport const RootContext = createContext();\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadClearTriggerProps extends PropsWithElement<'button'>, HTMLAttributes<'button'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadClearTriggerProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getClearTriggerProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<button {...attributes}>\n\t\t{@render children?.()}\n\t</button>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport type { DropzoneProps } from '@zag-js/file-upload';\n\n\texport interface FileUploadDropzoneProps extends DropzoneProps, PropsWithElement<'div'>, HTMLAttributes<'div'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadDropzoneProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getDropzoneProps(props), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadHiddenInputProps extends PropsWithElement<'input'>, HTMLAttributes<'input', 'children'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadHiddenInputProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst { element, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getHiddenInputProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<input {...attributes} />\n{/if}\n","import { createContext } from '../../../internal/create-context.js';\nexport const ItemContext = createContext();\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadItemDeleteTriggerProps extends PropsWithElement<'button'>, HTMLAttributes<'button'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { ItemContext } from '../modules/item-context.js';\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadItemDeleteTriggerProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\tconst itemProps = ItemContext.consume();\n\n\tconst { element, children = times, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getItemDeleteTriggerProps(itemProps()), rest));\n</script>\n\n{#snippet times()}\n\t&times;\n{/snippet}\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<button {...attributes}>\n\t\t{@render children?.()}\n\t</button>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadItemGroupProps extends PropsWithElement<'ul'>, HTMLAttributes<'ul'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadItemGroupProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getItemGroupProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<ul {...attributes}>\n\t\t{@render children?.()}\n\t</ul>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadItemNameProps extends PropsWithElement<'div'>, HTMLAttributes<'div'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { ItemContext } from '../modules/item-context.js';\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadItemNameProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\tconst itemProps = ItemContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getItemNameProps(itemProps()), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadItemSizeTextProps extends PropsWithElement<'div'>, HTMLAttributes<'div'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { ItemContext } from '../modules/item-context.js';\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadItemSizeTextProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\tconst itemProps = ItemContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getItemSizeTextProps(itemProps()), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","// src/data-transfer.ts\nvar getItemEntry = (item) => typeof item.getAsEntry === \"function\" ? item.getAsEntry() : typeof item.webkitGetAsEntry === \"function\" ? item.webkitGetAsEntry() : null;\nvar isDirectoryEntry = (entry) => entry.isDirectory;\nvar isFileEntry = (entry) => entry.isFile;\nvar addRelativePath = (file, path) => {\n  Object.defineProperty(file, \"relativePath\", { value: path ? `${path}/${file.name}` : file.name });\n  return file;\n};\nvar getFileEntries = (items, traverseDirectories) => Promise.all(\n  Array.from(items).filter((item) => item.kind === \"file\").map((item) => {\n    const entry = getItemEntry(item);\n    if (!entry) return null;\n    if (isDirectoryEntry(entry) && traverseDirectories) {\n      return getDirectoryFiles(entry.createReader(), `${entry.name}`);\n    }\n    if (isFileEntry(entry) && typeof item.getAsFile === \"function\") {\n      const file = item.getAsFile();\n      return Promise.resolve(file ? addRelativePath(file, \"\") : null);\n    }\n    if (isFileEntry(entry)) {\n      return new Promise((resolve) => {\n        entry.file((file) => {\n          resolve(addRelativePath(file, \"\"));\n        });\n      });\n    }\n  }).filter((b) => b)\n);\nvar getDirectoryFiles = (reader, path = \"\") => new Promise((resolve) => {\n  const entryPromises = [];\n  const readDirectoryEntries = () => {\n    reader.readEntries((entries) => {\n      if (entries.length === 0) {\n        resolve(Promise.all(entryPromises).then((entries2) => entries2.flat()));\n        return;\n      }\n      const promises = entries.map((entry) => {\n        if (!entry) return null;\n        if (isDirectoryEntry(entry)) {\n          return getDirectoryFiles(entry.createReader(), `${path}${entry.name}`);\n        }\n        if (isFileEntry(entry)) {\n          return new Promise((resolve2) => {\n            entry.file((file) => {\n              resolve2(addRelativePath(file, path));\n            });\n          });\n        }\n      }).filter((b) => b);\n      entryPromises.push(Promise.all(promises));\n      readDirectoryEntries();\n    });\n  };\n  readDirectoryEntries();\n});\n\n// src/data-url-to-blob.ts\nfunction dataURItoBlob(uri) {\n  const binary = atob(uri.split(\",\")[1]);\n  const mimeString = uri.split(\",\")[0].split(\":\")[1].split(\";\")[0];\n  const buffer = new ArrayBuffer(binary.length);\n  const intArray = new Uint8Array(buffer);\n  for (let i = 0; i < binary.length; i++) {\n    intArray[i] = binary.charCodeAt(i);\n  }\n  return new Blob([buffer], { type: mimeString });\n}\n\n// src/download-file.ts\nvar BOM_REGEX = /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i;\nvar MAC_REGEX = /Macintosh/;\nvar APPLE_WEBKIT_REGEX = /AppleWebKit/;\nvar SAFARI_REGEX = /Safari/;\nfunction getBlob(blobOrString, type, appendBOM) {\n  let blob = typeof blobOrString === \"string\" ? new Blob([blobOrString], { type }) : blobOrString;\n  if (appendBOM && BOM_REGEX.test(blob.type)) {\n    return new Blob([String.fromCharCode(65279), blob], { type: blob.type });\n  }\n  return blob;\n}\nfunction isMSEdge(win) {\n  return Boolean(win.navigator && win.navigator.msSaveOrOpenBlob);\n}\nfunction isWebView(win) {\n  return win.navigator && MAC_REGEX.test(win.navigator.userAgent) && APPLE_WEBKIT_REGEX.test(win.navigator.userAgent) && !SAFARI_REGEX.test(win.navigator.userAgent);\n}\nfunction downloadFile(options) {\n  const { file, win = window, type, name, appendBOM, revokeTimeout = 0 } = options;\n  const doc = win.document;\n  const blob = getBlob(file, type, appendBOM);\n  const fileName = (file instanceof File ? name || file.name : name) || \"file-download\";\n  if (isMSEdge(win)) {\n    win.navigator.msSaveOrOpenBlob(blob, fileName);\n    return;\n  }\n  const isMacOSWebView = isWebView(win);\n  const anchor = doc.createElement(\"a\");\n  const canUseDownload = \"download\" in anchor && !isMacOSWebView;\n  if (canUseDownload) {\n    const url2 = win.URL.createObjectURL(blob);\n    anchor.href = url2;\n    anchor.rel = \"noopener\";\n    anchor.download = fileName;\n    anchor.style.display = \"none\";\n    doc.body.appendChild(anchor);\n    anchor.dispatchEvent(new win.MouseEvent(\"click\"));\n    setTimeout(() => {\n      win.URL.revokeObjectURL(url2);\n      anchor.remove();\n    }, revokeTimeout);\n    return;\n  }\n  const url = win.URL.createObjectURL(blob);\n  const popup = win.open(url, \"_blank\");\n  if (!popup) {\n    win.location.href = url;\n  }\n  setTimeout(() => {\n    win.URL.revokeObjectURL(url);\n  }, revokeTimeout);\n}\n\n// src/get-accept-attr.ts\nfunction isMIMEType(v) {\n  return v === \"audio/*\" || v === \"video/*\" || v === \"image/*\" || v === \"text/*\" || /\\w+\\/[-+.\\w]+/g.test(v);\n}\nfunction isExt(v) {\n  return /^.*\\.[\\w]+$/.test(v);\n}\nvar isValidMIME = (v) => isMIMEType(v) || isExt(v);\nfunction getAcceptAttrString(accept) {\n  if (accept == null) return;\n  if (typeof accept === \"string\") {\n    return accept;\n  }\n  if (Array.isArray(accept)) {\n    return accept.filter(isValidMIME).join(\",\");\n  }\n  return Object.entries(accept).reduce((a, [mimeType, ext]) => [...a, mimeType, ...ext], []).filter(isValidMIME).join(\",\");\n}\n\n// src/get-file-data-url.ts\nvar getFileDataUrl = async (file) => {\n  const reader = new FileReader();\n  return new Promise((resolve, reject) => {\n    reader.onerror = () => {\n      reader.abort();\n      reject(new Error(\"There was an error reading a file\"));\n    };\n    reader.onloadend = () => {\n      const { result } = reader;\n      if (result instanceof ArrayBuffer) {\n        reject(new Error(\"Expected DataURL as string from Blob/File, got ArrayBuffer\"));\n      } else {\n        resolve(result || void 0);\n      }\n    };\n    reader.readAsDataURL(file);\n  });\n};\n\n// src/get-total-file-size.ts\nvar getTotalFileSize = (files) => {\n  return files.reduce((acc, file) => acc + file.size, 0);\n};\n\n// src/is-file-equal.ts\nvar isFileEqual = (file1, file2) => {\n  return file1.name === file2.name && file1.size === file2.size && file1.type === file2.type;\n};\n\n// src/is-valid-file-size.ts\nvar isDefined = (v) => v !== void 0 && v !== null;\nfunction isValidFileSize(file, minSize, maxSize) {\n  if (isDefined(file.size)) {\n    if (isDefined(minSize) && isDefined(maxSize)) {\n      if (file.size > maxSize) return [false, \"FILE_TOO_LARGE\"];\n      if (file.size < minSize) return [false, \"FILE_TOO_SMALL\"];\n    } else if (isDefined(minSize) && file.size < minSize) {\n      return [false, \"FILE_TOO_SMALL\"];\n    } else if (isDefined(maxSize) && file.size > maxSize) {\n      return [false, \"FILE_TOO_LARGE\"];\n    }\n  }\n  return [true, null];\n}\n\n// src/mime-types.ts\nvar mimeTypes = \"3g2_video/3gpp2[3gp,3gpp_video/3gpp[3mf_model/3mf[7z_application/x-7z-compressed[aac_audio/aac[ac_application/pkix-attr-cert[adp_audio/adpcm[adts_audio/aac[ai_application/postscript[aml_application/automationml-aml+xml[amlx_application/automationml-amlx+zip[amr_audio/amr[apk_application/vnd.android.package-archive[apng_image/apng[appcache,manifest_text/cache-manifest[appinstaller_application/appinstaller[appx_application/appx[appxbundle_application/appxbundle[asc_application/pgp-keys[atom_application/atom+xml[atomcat_application/atomcat+xml[atomdeleted_application/atomdeleted+xml[atomsvc_application/atomsvc+xml[au,snd_audio/basic[avi_video/x-msvideo[avci_image/avci[avcs_image/avcs[avif_image/avif[aw_application/applixware[bdoc_application/bdoc[bin,bpk,buffer,deb,deploy,dist,distz,dll,dmg,dms,dump,elc,exe,img,iso,lrf,mar,msi,msm,msp,pkg,so_application/octet-stream[bmp,dib_image/bmp[btf,btif_image/prs.btif[bz2_application/x-bzip2[c_text/x-c[ccxml_application/ccxml+xml[cdfx_application/cdfx+xml[cdmia_application/cdmi-capability[cdmic_application/cdmi-container[cdmid_application/cdmi-domain[cdmio_application/cdmi-object[cdmiq_application/cdmi-queue[cer_application/pkix-cert[cgm_image/cgm[cjs_application/node[class_application/java-vm[coffee,litcoffee_text/coffeescript[conf,def,in,ini,list,log,text,txt_text/plain[cpp,cxx,cc_text/x-c++src[cpl_application/cpl+xml[cpt_application/mac-compactpro[crl_application/pkix-crl[css_text/css[csv_text/csv[cu_application/cu-seeme[cwl_application/cwl[cww_application/prs.cww[davmount_application/davmount+xml[dbk_application/docbook+xml[doc_application/msword[docx_application/vnd.openxmlformats-officedocument.wordprocessingml.document[dsc_text/prs.lines.tag[dssc_application/dssc+der[dtd_application/xml-dtd[dwd_application/atsc-dwd+xml[ear,jar,war_application/java-archive[ecma_application/ecmascript[emf_image/emf[eml,mime_message/rfc822[emma_application/emma+xml[emotionml_application/emotionml+xml[eot_application/vnd.ms-fontobject[eps,ps_application/postscript[epub_application/epub+zip[exi_application/exi[exp_application/express[exr_image/aces[ez_application/andrew-inset[fdf_application/fdf[fdt_application/fdt+xml[fits_image/fits[flac_audio/flac[flv_video/x-flv[g3_image/g3fax[geojson_application/geo+json[gif_image/gif[glb_model/gltf-binary[gltf_model/gltf+json[gml_application/gml+xml[go_text/x-go[gpx_application/gpx+xml[gz_application/gzip[h_text/x-h[h261_video/h261[h263_video/h263[h264_video/h264[heic_image/heic[heics_image/heic-sequence[heif_image/heif[heifs_image/heif-sequence[htm,html,shtml_text/html[ico_image/x-icon[icns_image/x-icns[ics,ifb_text/calendar[iges,igs_model/iges[ink,inkml_application/inkml+xml[ipa_application/octet-stream[java_text/x-java-source[jp2,jpg2_image/jp2[jpeg,jpe,jpg_image/jpeg[jpf,jpx_image/jpx[jpm,jpgm_image/jpm[jpgv_video/jpeg[jph_image/jph[js,mjs_text/javascript[json_application/json[json5_application/json5[jsonld_application/ld+json[jsx_text/jsx[jxl_image/jxl[jxr_image/jxr[ktx_image/ktx[ktx2_image/ktx2[less_text/less[m1v,m2v,mpe,mpeg,mpg_video/mpeg[m4a_audio/mp4[m4v_video/x-m4v[md,markdown_text/markdown[mid,midi,kar,rmi_audio/midi[mkv_video/x-matroska[mp2,mp2a,mp3,mpga,m3a,m2a_audio/mpeg[mp4,mp4v,mpg4_video/mp4[mp4a_audio/mp4[mp4s,m4p_application/mp4[odp_application/vnd.oasis.opendocument.presentation[oda_application/oda[ods_application/vnd.oasis.opendocument.spreadsheet[odt_application/vnd.oasis.opendocument.text[oga,ogg,opus,spx_audio/ogg[ogv_video/ogg[ogx_application/ogg[otf_font/otf[p12,pfx_application/x-pkcs12[pdf_application/pdf[pem_application/x-pem-file[php_text/x-php[png_image/png[ppt_application/vnd.ms-powerpoint[pptx_application/vnd.openxmlformats-officedocument.presentationml.presentation[pskcxml_application/pskc+xml[psd_image/vnd.adobe.photoshop[py_text/x-python[qt,mov_video/quicktime[rar_application/vnd.rar[rdf_application/rdf+xml[rtf_text/rtf[sass_text/x-sass[scss_text/x-scss[sgm,sgml_text/sgml[sh_application/x-sh[svg,svgz_image/svg+xml[swf_application/x-shockwave-flash[tar_application/x-tar[tif,tiff_image/tiff[toml_application/toml[ts_video/mp2t[tsx_text/tsx[tsv_text/tab-separated-values[ttc_font/collection[ttf_font/ttf[vtt_text/vtt[wasm_application/wasm[wav_audio/wav[weba_audio/webm[webm_video/webm[webmanifest_application/manifest+json[webp_image/webp[wma_audio/x-ms-wma[wmv_video/x-ms-wmv[woff_font/woff[woff2_font/woff2[xls_application/vnd.ms-excel[xlsx_application/vnd.openxmlformats-officedocument.spreadsheetml.sheet[xml_application/xml[xz_application/x-xz[yaml,yml_text/yaml[zip_application/zip\";\nvar mimeTypesMap = new Map(\n  mimeTypes.split(\"[\").flatMap((mime) => {\n    const [extensions, mimeType] = mime.split(\"_\");\n    return extensions.split(\",\").map((ext) => [ext, mimeType]);\n  })\n);\n\n// src/get-file-mime-type.ts\nfunction getFileMimeType(name) {\n  const extension = name.split(\".\").pop();\n  return extension ? mimeTypesMap.get(extension) || null : null;\n}\n\n// src/is-valid-file-type.ts\nfunction isFileAccepted(file, accept) {\n  if (file && accept) {\n    const types = Array.isArray(accept) ? accept : typeof accept === \"string\" ? accept.split(\",\") : [];\n    if (types.length === 0) return true;\n    const fileName = file.name || \"\";\n    const mimeType = (file.type || getFileMimeType(fileName) || \"\").toLowerCase();\n    const baseMimeType = mimeType.replace(/\\/.*$/, \"\");\n    return types.some((type) => {\n      const validType = type.trim().toLowerCase();\n      if (validType.charAt(0) === \".\") {\n        return fileName.toLowerCase().endsWith(validType);\n      }\n      if (validType.endsWith(\"/*\")) {\n        return baseMimeType === validType.replace(/\\/.*$/, \"\");\n      }\n      return mimeType === validType;\n    });\n  }\n  return true;\n}\nfunction isValidFileType(file, accept) {\n  const isAcceptable = file.type === \"application/x-moz-file\" || isFileAccepted(file, accept);\n  return [isAcceptable, isAcceptable ? null : \"FILE_INVALID_TYPE\"];\n}\n\nexport { dataURItoBlob, downloadFile, getAcceptAttrString, getFileDataUrl, getFileEntries, getFileMimeType, getTotalFileSize, isFileEqual, isValidFileSize, isValidFileType };\n","import { getWindow } from '@zag-js/dom-query';\n\n// src/cache.ts\nfunction i18nCache(Ins) {\n  const formatterCache = /* @__PURE__ */ new Map();\n  return function create(locale, options) {\n    const cacheKey = locale + (options ? Object.entries(options).sort((a, b) => a[0] < b[0] ? -1 : 1).join() : \"\");\n    if (formatterCache.has(cacheKey)) {\n      return formatterCache.get(cacheKey);\n    }\n    let formatter = new Ins(locale, options);\n    formatterCache.set(cacheKey, formatter);\n    return formatter;\n  };\n}\n\n// src/collator.ts\nvar getCollator = i18nCache(Intl.Collator);\nfunction createCollator(locale = \"en-US\", options = {}) {\n  return getCollator(locale, options);\n}\n\n// src/filter.ts\nvar collatorCache = i18nCache(Intl.Collator);\nfunction createFilter(options) {\n  const { locale, ...rest } = options || {};\n  const collator = collatorCache(locale || \"en-US\", { usage: \"search\", ...rest });\n  function normalize(string) {\n    string = string.normalize(\"NFC\");\n    if (collator.resolvedOptions().ignorePunctuation) {\n      string = string.replace(/\\p{P}/gu, \"\");\n    }\n    return string;\n  }\n  function startsWith(string, substring) {\n    if (substring.length === 0) return true;\n    string = normalize(string);\n    substring = normalize(substring);\n    return collator.compare(string.slice(0, substring.length), substring) === 0;\n  }\n  function endsWith(string, substring) {\n    if (substring.length === 0) return true;\n    string = normalize(string);\n    substring = normalize(substring);\n    return collator.compare(string.slice(-substring.length), substring) === 0;\n  }\n  function contains(string, substring) {\n    if (substring.length === 0) return true;\n    string = normalize(string);\n    substring = normalize(substring);\n    let scan = 0;\n    let sliceLen = substring.length;\n    for (; scan + sliceLen <= string.length; scan++) {\n      let slice = string.slice(scan, scan + sliceLen);\n      if (collator.compare(substring, slice) === 0) {\n        return true;\n      }\n    }\n    return false;\n  }\n  return {\n    startsWith,\n    endsWith,\n    contains\n  };\n}\n\n// src/format-number.ts\nvar getNumberFormatter = i18nCache(Intl.NumberFormat);\nfunction formatNumber(v, locale, options = {}) {\n  const formatter = getNumberFormatter(locale, options);\n  return formatter.format(v);\n}\n\n// src/format-bytes.ts\nvar bitPrefixes = [\"\", \"kilo\", \"mega\", \"giga\", \"tera\"];\nvar bytePrefixes = [\"\", \"kilo\", \"mega\", \"giga\", \"tera\", \"peta\"];\nvar formatBytes = (bytes, locale = \"en-US\", options = {}) => {\n  if (Number.isNaN(bytes)) return \"\";\n  if (bytes === 0) return \"0 B\";\n  const { unitSystem = \"decimal\", precision = 3, unit = \"byte\", unitDisplay = \"short\" } = options;\n  const factor = unitSystem === \"binary\" ? 1024 : 1e3;\n  const prefix = unit === \"bit\" ? bitPrefixes : bytePrefixes;\n  const isNegative = bytes < 0;\n  const absoluteBytes = Math.abs(bytes);\n  let value = absoluteBytes;\n  let index = 0;\n  while (value >= factor && index < prefix.length - 1) {\n    value /= factor;\n    index++;\n  }\n  const v = parseFloat(value.toPrecision(precision));\n  const finalValue = isNegative ? -v : v;\n  return formatNumber(finalValue, locale, {\n    style: \"unit\",\n    unit: prefix[index] + unit,\n    unitDisplay\n  });\n};\n\n// src/format-date.ts\nvar symbols = \"\\\\s|\\\\.|-|/|\\\\\\\\|,|\\\\$|\\\\!|\\\\?|:|;\";\nfunction createRegEx(sign) {\n  return new RegExp(\"(^|>|\" + symbols + \")(\" + sign + \")($|<|\" + symbols + \")\", \"g\");\n}\nvar FORMATS = [\n  \"G\",\n  \"GG\",\n  \"GGG\",\n  \"GGGG\",\n  \"GGGGG\",\n  \"y\",\n  \"yo\",\n  \"yy\",\n  \"yyy\",\n  \"yyyy\",\n  \"Y\",\n  \"Yo\",\n  \"YY\",\n  \"YYY\",\n  \"YYYY\",\n  \"Q\",\n  \"Qo\",\n  \"QQ\",\n  \"QQQ\",\n  \"QQQQ\",\n  \"QQQQQ\",\n  \"M\",\n  \"Mo\",\n  \"MM\",\n  \"MMM\",\n  \"MMMM\",\n  \"MMMMM\",\n  \"E\",\n  \"EE\",\n  \"EEE\",\n  \"EEEE\",\n  \"EEEEE\",\n  \"EEEEEE\",\n  \"a\",\n  \"aa\",\n  \"aaa\",\n  \"aaaa\",\n  \"aaaaa\",\n  \"d\",\n  \"do\",\n  \"dd\",\n  \"D\",\n  \"Do\",\n  \"DD\",\n  \"DDD\",\n  \"w\",\n  \"wo\",\n  \"ww\",\n  \"s\",\n  \"so\",\n  \"ss\",\n  \"m\",\n  \"mo\",\n  \"mm\",\n  \"h\",\n  \"ho\",\n  \"hh\",\n  \"H\",\n  \"Ho\",\n  \"HH\",\n  \"z\",\n  \"zz\",\n  \"zzz\",\n  \"zzzz\",\n  \"T\"\n];\nfunction ordinal(num) {\n  const n = typeof num === \"string\" ? parseFloat(num) : num;\n  let suffix = \"th\";\n  if (n % 10 === 1 && n % 100 !== 11) {\n    suffix = \"st\";\n  } else if (n % 10 === 2 && n % 100 !== 12) {\n    suffix = \"nd\";\n  } else if (n % 10 === 3 && n % 100 !== 13) {\n    suffix = \"rd\";\n  }\n  return `${n}${suffix}`;\n}\nfunction pad(num, length) {\n  return String(num).padStart(length, \"0\");\n}\nfunction zone(str) {\n  return str.split(/AM|PM/)[1].trim();\n}\nfunction getFormat(date, options) {\n  const { locale, format, timeZone } = options;\n  switch (format) {\n    // era\n    case \"G\":\n    case \"GG\":\n    case \"GGG\":\n      return date.toLocaleString(locale, { era: \"short\" });\n    case \"GGGG\":\n      return date.toLocaleString(locale, { era: \"long\" });\n    case \"GGGGG\":\n      return date.toLocaleString(locale, { era: \"narrow\" });\n    // year\n    case \"y\":\n    case \"Y\":\n      return date.getFullYear();\n    case \"yo\":\n    case \"Yo\":\n      return ordinal(date.toLocaleString(locale, { year: \"numeric\" }));\n    case \"yy\":\n    case \"YY\":\n      return date.toLocaleString(locale, { year: \"2-digit\" });\n    case \"yyy\":\n    case \"YYY\":\n      return date.toLocaleString(locale, { year: \"numeric\" }).padStart(3, \"0\");\n    case \"yyyy\":\n    case \"YYYY\":\n      return date.toLocaleString(locale, { year: \"numeric\" }).padStart(4, \"0\");\n    // quarter\n    case \"Q\":\n    case \"QQQQQ\":\n      return Math.ceil((date.getMonth() + 1) / 3);\n    case \"Qo\":\n      return ordinal(Math.ceil((date.getMonth() + 1) / 3));\n    case \"QQ\":\n      return pad(Math.ceil((date.getMonth() + 1) / 3), 2);\n    case \"QQQ\":\n      return `Q${Math.ceil((date.getMonth() + 1) / 3)}`;\n    case \"QQQQ\": {\n      const base = ordinal(String(Math.ceil((date.getMonth() + 1) / 3)));\n      return `${base} quarter`;\n    }\n    // month\n    case \"M\":\n      return date.getMonth() + 1;\n    case \"Mo\":\n      return ordinal(date.getMonth() + 1);\n    case \"MM\":\n      return date.toLocaleString(locale, { month: \"2-digit\" });\n    case \"MMM\":\n      return date.toLocaleString(locale, { month: \"short\" });\n    case \"MMMM\":\n      return date.toLocaleString(locale, { month: \"long\" });\n    case \"MMMMM\":\n      return date.toLocaleString(locale, { month: \"narrow\" });\n    // week\n    case \"w\":\n      return Math.ceil(date.getDate() / 7);\n    case \"wo\":\n      return ordinal(Math.ceil(date.getDate() / 7));\n    case \"ww\":\n      return pad(Math.ceil(date.getDate() / 7), 2);\n    // day\n    case \"d\":\n    case \"D\":\n      return date.getDate();\n    case \"do\":\n    case \"Do\":\n      return ordinal(date.getDate());\n    case \"dd\":\n    case \"DD\":\n      return date.toLocaleString(locale, { day: \"2-digit\" });\n    case \"DDD\":\n      return pad(date.getDate(), 3);\n    // weekday\n    case \"E\":\n    case \"EE\":\n    case \"EEE\":\n      return date.toLocaleString(locale, { weekday: \"short\" });\n    case \"EEEE\":\n      return date.toLocaleString(locale, { weekday: \"long\" });\n    case \"EEEEE\":\n      return date.toLocaleString(locale, { weekday: \"narrow\" });\n    case \"EEEEEE\":\n      return date.toLocaleString(locale, { weekday: \"short\" }).slice(0, 2);\n    // hour\n    case \"h\":\n      return date.toLocaleString(locale, { hour: \"numeric\", hour12: true });\n    case \"ho\":\n      return ordinal(date.toLocaleString(locale, { hour: \"2-digit\", hour12: true }));\n    case \"hh\":\n      return date.toLocaleString(locale, { hour: \"2-digit\", hour12: true });\n    case \"H\":\n      return date.toLocaleString(locale, { hour: \"numeric\", hour12: false });\n    case \"Ho\":\n      return ordinal(+date.toLocaleString(locale, { hour: \"numeric\", hour12: false }));\n    case \"HH\":\n      return date.toLocaleString(locale, { hour: \"2-digit\", hour12: false });\n    // minute\n    case \"m\":\n      return date.toLocaleString(locale, { minute: \"numeric\" });\n    case \"mo\":\n      return ordinal(date.toLocaleString(locale, { minute: \"numeric\" }));\n    case \"mm\":\n      return date.toLocaleString(locale, { minute: \"2-digit\" });\n    // second\n    case \"s\":\n      return date.toLocaleString(locale, { second: \"numeric\" });\n    case \"so\":\n      return ordinal(date.toLocaleString(locale, { second: \"numeric\" }));\n    case \"ss\":\n      return date.toLocaleString(locale, { second: \"2-digit\" });\n    // timestamp\n    case \"T\":\n      return date.getTime();\n    // day period\n    case \"a\":\n    case \"aa\":\n    case \"aaa\":\n      return date.toLocaleString(locale, { hour: \"numeric\", hour12: true }).toLocaleUpperCase();\n    case \"aaaa\":\n      return date.toLocaleString(locale, { hour: \"numeric\", hour12: true }).toLocaleLowerCase();\n    case \"aaaaa\":\n      return date.toLocaleString(locale, { hour: \"numeric\", hour12: true }).charAt(0);\n    // TODO:Revise this\n    case \"z\":\n    case \"zz\":\n    case \"zzz\": {\n      return zone(date.toLocaleString(locale, { timeZone, timeZoneName: \"shortOffset\" }));\n    }\n    case \"zzzz\":\n      return zone(date.toLocaleString(locale, { timeZone, timeZoneName: \"longOffset\" }));\n    default:\n      throw new Error(`Unknown format: ${format}`);\n  }\n}\nfunction formatDate(date, format, locale, timeZone) {\n  let result = format;\n  for (const key of FORMATS) {\n    const res = getFormat(date, { locale, format: key, timeZone });\n    result = result.replace(createRegEx(key), \"$1\" + res + \"$3\");\n  }\n  return result;\n}\n\n// src/format-list.ts\nvar getListFormatter = i18nCache(Intl.ListFormat);\nfunction formatList(list, locale, options = {}) {\n  const formatter = getListFormatter(locale, options);\n  return formatter.format(list);\n}\n\n// src/format-relative-time.ts\nvar getRelativeTimeFormatter = i18nCache(Intl.RelativeTimeFormat);\nfunction formatRelativeTime(value, locale, options = {}) {\n  const rtf = getRelativeTimeFormatter(locale, options);\n  const now = /* @__PURE__ */ new Date();\n  const diff = getDistance(now, value);\n  if (diff.years > 0) return rtf.format(diff.years * diff.sign, \"year\");\n  if (diff.months > 0) return rtf.format(diff.months * diff.sign, \"month\");\n  if (diff.weeks > 0) return rtf.format(diff.weeks * diff.sign, \"week\");\n  if (diff.days > 0) return rtf.format(diff.days * diff.sign, \"day\");\n  if (diff.hours > 0) return rtf.format(diff.hours * diff.sign, \"hour\");\n  if (diff.minutes > 0) return rtf.format(diff.minutes * diff.sign, \"minute\");\n  return rtf.format(diff.seconds * diff.sign, \"second\");\n}\nvar SECOND_TO_MS = 1e3;\nvar MINUTE_TO_MS = 1e3 * 60;\nvar HOUR_TO_MS = 1e3 * 60 * 60;\nvar DAY_TO_MS = 1e3 * 60 * 60 * 24;\nvar WEEK_TO_MS = 1e3 * 60 * 60 * 24 * 7;\nvar MONTH_TO_MS = 1e3 * 60 * 60 * 24 * 30;\nvar YEAR_TO_MS = 1e3 * 60 * 60 * 24 * 365;\nfunction getDistance(startDate, endDate) {\n  const endTime = endDate.getTime();\n  const startTime = startDate.getTime();\n  const distance = Math.abs(endTime - startTime);\n  return {\n    sign: Math.sign(endTime - startTime),\n    days: Math.floor(distance / DAY_TO_MS),\n    hours: Math.floor(distance % DAY_TO_MS / HOUR_TO_MS),\n    minutes: Math.floor(distance % HOUR_TO_MS / MINUTE_TO_MS),\n    seconds: Math.floor(distance % MINUTE_TO_MS / SECOND_TO_MS),\n    weeks: Math.floor(distance / WEEK_TO_MS),\n    months: Math.floor(distance / MONTH_TO_MS),\n    years: Math.floor(distance / YEAR_TO_MS)\n  };\n}\n\n// src/is-rtl.ts\nvar RTL_SCRIPTS = /* @__PURE__ */ new Set([\n  \"Avst\",\n  \"Arab\",\n  \"Armi\",\n  \"Syrc\",\n  \"Samr\",\n  \"Mand\",\n  \"Thaa\",\n  \"Mend\",\n  \"Nkoo\",\n  \"Adlm\",\n  \"Rohg\",\n  \"Hebr\"\n]);\nvar RTL_LANGS = /* @__PURE__ */ new Set([\n  \"ae\",\n  \"ar\",\n  \"arc\",\n  \"bcc\",\n  \"bqi\",\n  \"ckb\",\n  \"dv\",\n  \"fa\",\n  \"glk\",\n  \"he\",\n  \"ku\",\n  \"mzn\",\n  \"nqo\",\n  \"pnb\",\n  \"ps\",\n  \"sd\",\n  \"ug\",\n  \"ur\",\n  \"yi\"\n]);\nfunction isRTL(locale) {\n  if (Intl.Locale) {\n    const script = new Intl.Locale(locale).maximize().script ?? \"\";\n    return RTL_SCRIPTS.has(script);\n  }\n  const lang = locale.split(\"-\")[0];\n  return RTL_LANGS.has(lang);\n}\nfunction getLocaleDir(locale) {\n  return isRTL(locale) ? \"rtl\" : \"ltr\";\n}\n\n// src/locale.ts\nfunction getDefaultLocale() {\n  let locale = typeof navigator !== \"undefined\" && (navigator.language || navigator.userLanguage) || \"en-US\";\n  return {\n    locale,\n    dir: isRTL(locale) ? \"rtl\" : \"ltr\"\n  };\n}\nfunction trackLocale(options = {}) {\n  const { getRootNode, onLocaleChange } = options;\n  onLocaleChange?.(getDefaultLocale());\n  const handleLocaleChange = () => {\n    onLocaleChange?.(getDefaultLocale());\n  };\n  const win = getRootNode ? getWindow(getRootNode()) : window;\n  win.addEventListener(\"languagechange\", handleLocaleChange);\n  return () => {\n    win.removeEventListener(\"languagechange\", handleLocaleChange);\n  };\n}\n\nexport { createCollator, createFilter, formatBytes, formatDate, formatList, formatNumber, formatRelativeTime, getDefaultLocale, getLocaleDir, isRTL, trackLocale };\n","import { createAnatomy } from '@zag-js/anatomy';\nimport { raf, addDomEvent, getWindow, contains, getEventTarget, dataAttr, visuallyHiddenStyle } from '@zag-js/dom-query';\nimport { getAcceptAttrString, isFileEqual, isValidFileType, isValidFileSize, getFileEntries } from '@zag-js/file-utils';\nimport { formatBytes } from '@zag-js/i18n-utils';\nimport { createProps } from '@zag-js/types';\nimport { warn, callAll, createSplitProps, hash, flatArray } from '@zag-js/utils';\nimport { createMachine } from '@zag-js/core';\n\n// src/file-upload.anatomy.ts\nvar anatomy = createAnatomy(\"file-upload\").parts(\n  \"root\",\n  \"dropzone\",\n  \"item\",\n  \"itemDeleteTrigger\",\n  \"itemGroup\",\n  \"itemName\",\n  \"itemPreview\",\n  \"itemPreviewImage\",\n  \"itemSizeText\",\n  \"label\",\n  \"trigger\",\n  \"clearTrigger\"\n);\nvar parts = anatomy.build();\nvar getRootId = (ctx) => ctx.ids?.root ?? `file:${ctx.id}`;\nvar getDropzoneId = (ctx) => ctx.ids?.dropzone ?? `file:${ctx.id}:dropzone`;\nvar getHiddenInputId = (ctx) => ctx.ids?.hiddenInput ?? `file:${ctx.id}:input`;\nvar getTriggerId = (ctx) => ctx.ids?.trigger ?? `file:${ctx.id}:trigger`;\nvar getLabelId = (ctx) => ctx.ids?.label ?? `file:${ctx.id}:label`;\nvar getItemId = (ctx, id) => ctx.ids?.item?.(id) ?? `file:${ctx.id}:item:${id}`;\nvar getItemNameId = (ctx, id) => ctx.ids?.itemName?.(id) ?? `file:${ctx.id}:item-name:${id}`;\nvar getItemSizeTextId = (ctx, id) => ctx.ids?.itemSizeText?.(id) ?? `file:${ctx.id}:item-size:${id}`;\nvar getItemPreviewId = (ctx, id) => ctx.ids?.itemPreview?.(id) ?? `file:${ctx.id}:item-preview:${id}`;\nvar getItemDeleteTriggerId = (ctx, id) => ctx.ids?.itemDeleteTrigger?.(id) ?? `file:${ctx.id}:item-delete:${id}`;\nvar getFileId = (file) => hash(`${file.name}-${file.size}`);\nvar getRootEl = (ctx) => ctx.getById(getRootId(ctx));\nvar getHiddenInputEl = (ctx) => ctx.getById(getHiddenInputId(ctx));\nvar getDropzoneEl = (ctx) => ctx.getById(getDropzoneId(ctx));\nfunction isEventWithFiles(event) {\n  const target = getEventTarget(event);\n  if (!event.dataTransfer) return !!target && \"files\" in target;\n  return event.dataTransfer.types.some((type) => {\n    return type === \"Files\" || type === \"application/x-moz-file\";\n  });\n}\nfunction isFilesWithinRange(ctx, incomingCount, currentAcceptedFiles) {\n  const { prop, computed } = ctx;\n  if (!computed(\"multiple\") && incomingCount > 1) return false;\n  if (!computed(\"multiple\") && incomingCount + currentAcceptedFiles.length === 2) return true;\n  if (incomingCount + currentAcceptedFiles.length > prop(\"maxFiles\")) return false;\n  return true;\n}\nfunction getEventFiles(ctx, files, currentAcceptedFiles = [], currentRejectedFiles = []) {\n  const { prop, computed } = ctx;\n  const acceptedFiles = [];\n  const rejectedFiles = [];\n  const validateParams = {\n    acceptedFiles: currentAcceptedFiles,\n    rejectedFiles: currentRejectedFiles\n  };\n  files.forEach((file) => {\n    const [accepted, acceptError] = isValidFileType(file, computed(\"acceptAttr\"));\n    const [sizeMatch, sizeError] = isValidFileSize(file, prop(\"minFileSize\"), prop(\"maxFileSize\"));\n    const validateErrors = prop(\"validate\")?.(file, validateParams);\n    const valid = validateErrors ? validateErrors.length === 0 : true;\n    if (accepted && sizeMatch && valid) {\n      acceptedFiles.push(file);\n    } else {\n      const errors = [acceptError, sizeError];\n      if (!valid) errors.push(...validateErrors ?? []);\n      rejectedFiles.push({ file, errors: errors.filter(Boolean) });\n    }\n  });\n  if (!isFilesWithinRange(ctx, acceptedFiles.length, currentAcceptedFiles)) {\n    acceptedFiles.forEach((file) => {\n      rejectedFiles.push({ file, errors: [\"TOO_MANY_FILES\"] });\n    });\n    acceptedFiles.splice(0);\n  }\n  return {\n    acceptedFiles,\n    rejectedFiles\n  };\n}\nfunction setInputFiles(inputEl, files) {\n  const win = getWindow(inputEl);\n  try {\n    if (\"DataTransfer\" in win) {\n      const dataTransfer = new win.DataTransfer();\n      files.forEach((file) => {\n        dataTransfer.items.add(file);\n      });\n      inputEl.files = dataTransfer.files;\n    }\n  } catch {\n  }\n}\n\n// src/file-upload.connect.ts\nvar DEFAULT_ITEM_TYPE = \"accepted\";\nvar INTERACTIVE_SELECTOR = \"button, a[href], input:not([type='file']), select, textarea, [tabindex], [contenteditable]\";\nfunction isInteractiveTarget(element, container) {\n  if (!element || element.getAttribute(\"type\") === \"file\") return false;\n  const interactive = element.closest(INTERACTIVE_SELECTOR);\n  return interactive != container && contains(container, interactive);\n}\nfunction connect(service, normalize) {\n  const { state, send, prop, computed, scope, context } = service;\n  const disabled = !!prop(\"disabled\");\n  const readOnly = !!prop(\"readOnly\");\n  const required = !!prop(\"required\");\n  const allowDrop = prop(\"allowDrop\");\n  const translations = prop(\"translations\");\n  const dragging = state.matches(\"dragging\");\n  const focused = state.matches(\"focused\") && !disabled;\n  const acceptedFiles = context.get(\"acceptedFiles\");\n  const maxFiles = prop(\"maxFiles\");\n  return {\n    dragging,\n    focused,\n    disabled,\n    readOnly,\n    transforming: context.get(\"transforming\"),\n    maxFilesReached: acceptedFiles.length >= maxFiles,\n    remainingFiles: Math.max(0, maxFiles - acceptedFiles.length),\n    openFilePicker() {\n      if (disabled || readOnly) return;\n      send({ type: \"OPEN\" });\n    },\n    deleteFile(file, type = DEFAULT_ITEM_TYPE) {\n      if (disabled || readOnly) return;\n      send({ type: \"FILE.DELETE\", file, itemType: type });\n    },\n    acceptedFiles,\n    rejectedFiles: context.get(\"rejectedFiles\"),\n    setFiles(files) {\n      if (disabled || readOnly) return;\n      send({ type: \"FILES.SET\", files, count: files.length });\n    },\n    clearRejectedFiles() {\n      if (disabled || readOnly) return;\n      send({ type: \"REJECTED_FILES.CLEAR\" });\n    },\n    clearFiles() {\n      if (disabled || readOnly) return;\n      send({ type: \"FILES.CLEAR\" });\n    },\n    getFileSize(file) {\n      return formatBytes(file.size, prop(\"locale\"));\n    },\n    createFileUrl(file, cb) {\n      const win = scope.getWin();\n      const url = win.URL.createObjectURL(file);\n      cb(url);\n      return () => win.URL.revokeObjectURL(url);\n    },\n    setClipboardFiles(dt) {\n      if (disabled || readOnly) return false;\n      const items = Array.from(dt?.items ?? []);\n      const files = items.reduce((acc, item) => {\n        if (item.kind !== \"file\") return acc;\n        const file = item.getAsFile();\n        if (!file) return acc;\n        return [...acc, file];\n      }, []);\n      if (!files.length) return false;\n      send({ type: \"FILE.SELECT\", files });\n      return true;\n    },\n    getRootProps() {\n      return normalize.element({\n        ...parts.root.attrs,\n        dir: prop(\"dir\"),\n        id: getRootId(scope),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-dragging\": dataAttr(dragging)\n      });\n    },\n    getDropzoneProps(props2 = {}) {\n      return normalize.element({\n        ...parts.dropzone.attrs,\n        dir: prop(\"dir\"),\n        id: getDropzoneId(scope),\n        tabIndex: disabled || readOnly || props2.disableClick ? void 0 : 0,\n        role: props2.disableClick ? \"application\" : \"button\",\n        \"aria-label\": translations.dropzone,\n        \"aria-disabled\": disabled,\n        \"aria-readonly\": readOnly,\n        \"data-invalid\": dataAttr(prop(\"invalid\")),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-dragging\": dataAttr(dragging),\n        onKeyDown(event) {\n          if (disabled || readOnly) return;\n          if (event.defaultPrevented) return;\n          const target = getEventTarget(event);\n          if (!contains(event.currentTarget, target)) return;\n          if (isInteractiveTarget(target, event.currentTarget)) return;\n          if (props2.disableClick) return;\n          if (event.key !== \"Enter\" && event.key !== \" \") return;\n          send({ type: \"DROPZONE.CLICK\", src: \"keydown\" });\n        },\n        onClick(event) {\n          if (disabled || readOnly) return;\n          if (event.defaultPrevented) return;\n          if (props2.disableClick) return;\n          const target = getEventTarget(event);\n          if (!contains(event.currentTarget, target)) return;\n          if (isInteractiveTarget(target, event.currentTarget)) return;\n          if (event.currentTarget.localName === \"label\") {\n            event.preventDefault();\n          }\n          send({ type: \"DROPZONE.CLICK\" });\n        },\n        onDragOver(event) {\n          if (disabled || readOnly) return;\n          if (!allowDrop) return;\n          event.preventDefault();\n          event.stopPropagation();\n          try {\n            event.dataTransfer.dropEffect = \"copy\";\n          } catch {\n          }\n          const hasFiles = isEventWithFiles(event);\n          if (!hasFiles) return;\n          const count = event.dataTransfer.items.length;\n          send({ type: \"DROPZONE.DRAG_OVER\", count });\n        },\n        onDragLeave(event) {\n          if (disabled || readOnly) return;\n          if (!allowDrop) return;\n          if (contains(event.currentTarget, event.relatedTarget)) return;\n          send({ type: \"DROPZONE.DRAG_LEAVE\" });\n        },\n        onDrop(event) {\n          if (disabled || readOnly) return;\n          if (allowDrop) {\n            event.preventDefault();\n            event.stopPropagation();\n          }\n          const hasFiles = isEventWithFiles(event);\n          if (!hasFiles) return;\n          getFileEntries(event.dataTransfer.items, prop(\"directory\")).then((files) => {\n            send({ type: \"DROPZONE.DROP\", files: flatArray(files) });\n          });\n        },\n        onFocus() {\n          if (disabled || readOnly) return;\n          send({ type: \"DROPZONE.FOCUS\" });\n        },\n        onBlur() {\n          if (disabled || readOnly) return;\n          send({ type: \"DROPZONE.BLUR\" });\n        }\n      });\n    },\n    getTriggerProps() {\n      return normalize.button({\n        ...parts.trigger.attrs,\n        dir: prop(\"dir\"),\n        id: getTriggerId(scope),\n        disabled: disabled || readOnly,\n        \"data-disabled\": dataAttr(disabled),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-invalid\": dataAttr(prop(\"invalid\")),\n        type: \"button\",\n        onClick(event) {\n          if (disabled || readOnly) return;\n          if (contains(getDropzoneEl(scope), event.currentTarget)) {\n            event.stopPropagation();\n          }\n          send({ type: \"OPEN\" });\n        }\n      });\n    },\n    getHiddenInputProps() {\n      return normalize.input({\n        id: getHiddenInputId(scope),\n        tabIndex: -1,\n        disabled: disabled || readOnly,\n        type: \"file\",\n        required: prop(\"required\"),\n        capture: prop(\"capture\"),\n        name: prop(\"name\"),\n        accept: computed(\"acceptAttr\"),\n        webkitdirectory: prop(\"directory\") ? \"\" : void 0,\n        multiple: computed(\"multiple\") || prop(\"maxFiles\") > 1,\n        onClick(event) {\n          event.stopPropagation();\n          event.currentTarget.value = \"\";\n        },\n        onInput(event) {\n          if (disabled || readOnly) return;\n          const { files } = event.currentTarget;\n          send({ type: \"FILE.SELECT\", files: files ? Array.from(files) : [] });\n        },\n        style: visuallyHiddenStyle\n      });\n    },\n    getItemGroupProps(props2 = {}) {\n      const { type = DEFAULT_ITEM_TYPE } = props2;\n      return normalize.element({\n        ...parts.itemGroup.attrs,\n        dir: prop(\"dir\"),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-type\": type\n      });\n    },\n    getItemProps(props2) {\n      const { file, type = DEFAULT_ITEM_TYPE } = props2;\n      return normalize.element({\n        ...parts.item.attrs,\n        dir: prop(\"dir\"),\n        id: getItemId(scope, getFileId(file)),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-type\": type\n      });\n    },\n    getItemNameProps(props2) {\n      const { file, type = DEFAULT_ITEM_TYPE } = props2;\n      return normalize.element({\n        ...parts.itemName.attrs,\n        dir: prop(\"dir\"),\n        id: getItemNameId(scope, getFileId(file)),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-type\": type\n      });\n    },\n    getItemSizeTextProps(props2) {\n      const { file, type = DEFAULT_ITEM_TYPE } = props2;\n      return normalize.element({\n        ...parts.itemSizeText.attrs,\n        dir: prop(\"dir\"),\n        id: getItemSizeTextId(scope, getFileId(file)),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-type\": type\n      });\n    },\n    getItemPreviewProps(props2) {\n      const { file, type = DEFAULT_ITEM_TYPE } = props2;\n      return normalize.element({\n        ...parts.itemPreview.attrs,\n        dir: prop(\"dir\"),\n        id: getItemPreviewId(scope, getFileId(file)),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-type\": type\n      });\n    },\n    getItemPreviewImageProps(props2) {\n      const { file, url, type = DEFAULT_ITEM_TYPE } = props2;\n      const isImage = file.type.startsWith(\"image/\");\n      if (!isImage) {\n        throw new Error(\"Preview Image is only supported for image files\");\n      }\n      return normalize.img({\n        ...parts.itemPreviewImage.attrs,\n        alt: translations.itemPreview?.(file),\n        src: url,\n        \"data-disabled\": dataAttr(disabled),\n        \"data-type\": type\n      });\n    },\n    getItemDeleteTriggerProps(props2) {\n      const { file, type = DEFAULT_ITEM_TYPE } = props2;\n      return normalize.button({\n        ...parts.itemDeleteTrigger.attrs,\n        dir: prop(\"dir\"),\n        id: getItemDeleteTriggerId(scope, getFileId(file)),\n        type: \"button\",\n        disabled: disabled || readOnly,\n        \"data-disabled\": dataAttr(disabled),\n        \"data-readonly\": dataAttr(readOnly),\n        \"data-type\": type,\n        \"aria-label\": translations.deleteFile?.(file),\n        onClick() {\n          if (disabled || readOnly) return;\n          send({ type: \"FILE.DELETE\", file, itemType: type });\n        }\n      });\n    },\n    getLabelProps() {\n      return normalize.label({\n        ...parts.label.attrs,\n        dir: prop(\"dir\"),\n        id: getLabelId(scope),\n        htmlFor: getHiddenInputId(scope),\n        \"data-disabled\": dataAttr(disabled),\n        \"data-required\": dataAttr(required)\n      });\n    },\n    getClearTriggerProps() {\n      return normalize.button({\n        ...parts.clearTrigger.attrs,\n        dir: prop(\"dir\"),\n        type: \"button\",\n        disabled: disabled || readOnly,\n        hidden: acceptedFiles.length === 0,\n        \"data-disabled\": dataAttr(disabled),\n        \"data-readonly\": dataAttr(readOnly),\n        onClick(event) {\n          if (event.defaultPrevented) return;\n          if (disabled || readOnly) return;\n          send({ type: \"FILES.CLEAR\" });\n        }\n      });\n    }\n  };\n}\nvar machine = createMachine({\n  props({ props: props2 }) {\n    return {\n      minFileSize: 0,\n      maxFileSize: Number.POSITIVE_INFINITY,\n      maxFiles: 1,\n      allowDrop: true,\n      preventDocumentDrop: true,\n      defaultAcceptedFiles: [],\n      ...props2,\n      translations: {\n        dropzone: \"dropzone\",\n        itemPreview: (file) => `preview of ${file.name}`,\n        deleteFile: (file) => `delete file ${file.name}`,\n        ...props2.translations\n      }\n    };\n  },\n  initialState() {\n    return \"idle\";\n  },\n  context({ prop, bindable, getContext }) {\n    return {\n      acceptedFiles: bindable(() => ({\n        defaultValue: prop(\"defaultAcceptedFiles\"),\n        value: prop(\"acceptedFiles\"),\n        isEqual: (a, b) => a.length === b?.length && a.every((file, i) => isFileEqual(file, b[i])),\n        hash(value) {\n          return value.map((file) => `${file.name}-${file.size}`).join(\",\");\n        },\n        onChange(value) {\n          const ctx = getContext();\n          prop(\"onFileAccept\")?.({ files: value });\n          prop(\"onFileChange\")?.({ acceptedFiles: value, rejectedFiles: ctx.get(\"rejectedFiles\") });\n        }\n      })),\n      rejectedFiles: bindable(() => ({\n        defaultValue: [],\n        isEqual: (a, b) => a.length === b?.length && a.every((file, i) => isFileEqual(file.file, b[i].file)),\n        onChange(value) {\n          const ctx = getContext();\n          prop(\"onFileReject\")?.({ files: value });\n          prop(\"onFileChange\")?.({ acceptedFiles: ctx.get(\"acceptedFiles\"), rejectedFiles: value });\n        }\n      })),\n      transforming: bindable(() => ({\n        defaultValue: false\n      }))\n    };\n  },\n  computed: {\n    acceptAttr: ({ prop }) => getAcceptAttrString(prop(\"accept\")),\n    multiple: ({ prop }) => prop(\"maxFiles\") > 1\n  },\n  watch({ track, context, action }) {\n    track([() => context.hash(\"acceptedFiles\")], () => {\n      action([\"syncInputElement\"]);\n    });\n  },\n  on: {\n    \"FILES.SET\": {\n      actions: [\"setFiles\"]\n    },\n    \"FILE.SELECT\": {\n      actions: [\"setEventFiles\"]\n    },\n    \"FILE.DELETE\": {\n      actions: [\"removeFile\"]\n    },\n    \"FILES.CLEAR\": {\n      actions: [\"clearFiles\"]\n    },\n    \"REJECTED_FILES.CLEAR\": {\n      actions: [\"clearRejectedFiles\"]\n    }\n  },\n  effects: [\"preventDocumentDrop\"],\n  states: {\n    idle: {\n      on: {\n        OPEN: {\n          actions: [\"openFilePicker\"]\n        },\n        \"DROPZONE.CLICK\": {\n          actions: [\"openFilePicker\"]\n        },\n        \"DROPZONE.FOCUS\": {\n          target: \"focused\"\n        },\n        \"DROPZONE.DRAG_OVER\": {\n          target: \"dragging\"\n        }\n      }\n    },\n    focused: {\n      on: {\n        \"DROPZONE.BLUR\": {\n          target: \"idle\"\n        },\n        OPEN: {\n          actions: [\"openFilePicker\"]\n        },\n        \"DROPZONE.CLICK\": {\n          actions: [\"openFilePicker\"]\n        },\n        \"DROPZONE.DRAG_OVER\": {\n          target: \"dragging\"\n        }\n      }\n    },\n    dragging: {\n      on: {\n        \"DROPZONE.DROP\": {\n          target: \"idle\",\n          actions: [\"setEventFiles\"]\n        },\n        \"DROPZONE.DRAG_LEAVE\": {\n          target: \"idle\"\n        }\n      }\n    }\n  },\n  implementations: {\n    effects: {\n      preventDocumentDrop({ prop, scope }) {\n        if (!prop(\"preventDocumentDrop\")) return;\n        if (!prop(\"allowDrop\")) return;\n        if (prop(\"disabled\")) return;\n        const doc = scope.getDoc();\n        const onDragOver = (event) => {\n          event?.preventDefault();\n        };\n        const onDrop = (event) => {\n          if (contains(getRootEl(scope), getEventTarget(event))) return;\n          event.preventDefault();\n        };\n        return callAll(addDomEvent(doc, \"dragover\", onDragOver, false), addDomEvent(doc, \"drop\", onDrop, false));\n      }\n    },\n    actions: {\n      syncInputElement({ scope, context }) {\n        queueMicrotask(() => {\n          const inputEl = getHiddenInputEl(scope);\n          if (!inputEl) return;\n          setInputFiles(inputEl, context.get(\"acceptedFiles\"));\n          const win = scope.getWin();\n          inputEl.dispatchEvent(new win.Event(\"change\", { bubbles: true }));\n        });\n      },\n      openFilePicker({ scope }) {\n        raf(() => {\n          getHiddenInputEl(scope)?.click();\n        });\n      },\n      setFiles(params) {\n        const { computed, context, event } = params;\n        const { acceptedFiles, rejectedFiles } = getEventFiles(params, event.files);\n        context.set(\n          \"acceptedFiles\",\n          computed(\"multiple\") ? acceptedFiles : acceptedFiles.length > 0 ? [acceptedFiles[0]] : []\n        );\n        context.set(\"rejectedFiles\", rejectedFiles);\n      },\n      setEventFiles(params) {\n        const { computed, context, event, prop } = params;\n        const currentAcceptedFiles = context.get(\"acceptedFiles\");\n        const currentRejectedFiles = context.get(\"rejectedFiles\");\n        const { acceptedFiles, rejectedFiles } = getEventFiles(\n          params,\n          event.files,\n          currentAcceptedFiles,\n          currentRejectedFiles\n        );\n        const set = (files) => {\n          if (computed(\"multiple\")) {\n            context.set(\"acceptedFiles\", (prev) => [...prev, ...files]);\n            context.set(\"rejectedFiles\", rejectedFiles);\n            return;\n          }\n          if (files.length) {\n            context.set(\"acceptedFiles\", [files[0]]);\n            context.set(\"rejectedFiles\", rejectedFiles);\n            return;\n          }\n          if (rejectedFiles.length) {\n            context.set(\"acceptedFiles\", context.get(\"acceptedFiles\"));\n            context.set(\"rejectedFiles\", rejectedFiles);\n          }\n        };\n        const transform = prop(\"transformFiles\");\n        if (transform) {\n          context.set(\"transforming\", true);\n          transform(acceptedFiles).then(set).catch((err) => {\n            warn(`[zag-js/file-upload] error transforming files\n${err}`);\n          }).finally(() => {\n            context.set(\"transforming\", false);\n          });\n        } else {\n          set(acceptedFiles);\n        }\n      },\n      removeFile({ context, event }) {\n        if (event.itemType === \"rejected\") {\n          const rejectedFiles = context.get(\"rejectedFiles\").filter((item) => !isFileEqual(item.file, event.file));\n          context.set(\"rejectedFiles\", rejectedFiles);\n        } else {\n          const files = context.get(\"acceptedFiles\").filter((file) => !isFileEqual(file, event.file));\n          context.set(\"acceptedFiles\", files);\n        }\n      },\n      clearRejectedFiles({ context }) {\n        context.set(\"rejectedFiles\", []);\n      },\n      clearFiles({ context }) {\n        context.set(\"acceptedFiles\", []);\n        context.set(\"rejectedFiles\", []);\n      }\n    }\n  }\n});\nvar props = createProps()([\n  \"accept\",\n  \"acceptedFiles\",\n  \"allowDrop\",\n  \"capture\",\n  \"defaultAcceptedFiles\",\n  \"dir\",\n  \"directory\",\n  \"disabled\",\n  \"getRootNode\",\n  \"id\",\n  \"ids\",\n  \"invalid\",\n  \"locale\",\n  \"maxFiles\",\n  \"maxFileSize\",\n  \"minFileSize\",\n  \"name\",\n  \"onFileAccept\",\n  \"onFileChange\",\n  \"onFileReject\",\n  \"preventDocumentDrop\",\n  \"readOnly\",\n  \"required\",\n  \"transformFiles\",\n  \"translations\",\n  \"validate\"\n]);\nvar splitProps = createSplitProps(props);\nvar itemProps = createProps()([\"file\", \"type\"]);\nvar splitItemProps = createSplitProps(itemProps);\n\nexport { anatomy, connect, itemProps, machine, props, splitItemProps, splitProps };\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport { splitItemProps } from '@zag-js/file-upload';\n\timport type { ItemProps } from '@zag-js/file-upload';\n\n\texport interface FileUploadItemProps extends ItemProps, PropsWithElement<'li'>, HTMLAttributes<'li'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { ItemContext } from '../modules/item-context.js';\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadItemProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst [itemProps, componentProps] = $derived(splitItemProps(props));\n\tconst { element, children, ...rest } = $derived(componentProps);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getItemProps(itemProps), rest));\n\n\tItemContext.provide(() => itemProps);\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<li {...attributes}>\n\t\t{@render children?.()}\n\t</li>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadLabelProps extends PropsWithElement<'label'>, HTMLAttributes<'label'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadLabelProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getLabelProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<label {...attributes}>\n\t\t{@render children?.()}\n\t</label>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { Snippet } from 'svelte';\n\n\texport interface FileUploadRootContextProps {\n\t\tchildren: Snippet<[ReturnType<typeof useFileUpload>]>;\n\t}\n</script>\n\n<script lang=\"ts\">\n\timport type { useFileUpload } from '../modules/provider.svelte';\n\timport { RootContext } from '../modules/root-context.js';\n\n\tconst props: FileUploadRootContextProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst { children } = $derived(props);\n</script>\n\n{@render children(fileUpload)}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport type { useFileUpload } from '../modules/provider.svelte';\n\n\texport interface FileUploadRootProviderProps extends PropsWithElement<'div'>, Omit<HTMLAttributes<'div'>, 'id' | 'dir'> {\n\t\tvalue: ReturnType<typeof useFileUpload>;\n\t}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadRootProviderProps = $props();\n\n\tconst { element, children, value: fileUpload, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getRootProps(), rest));\n\n\tRootContext.provide(() => fileUpload());\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","import { connect, machine } from '@zag-js/file-upload';\nimport { normalizeProps, useMachine } from '@zag-js/svelte';\nexport function useFileUpload(props) {\n    const service = useMachine(machine, props);\n    const fileUpload = $derived(connect(service, normalizeProps));\n    return () => fileUpload;\n}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\timport type { Props } from '@zag-js/file-upload';\n\n\texport interface FileUploadRootProps extends Omit<Props, 'id'>, PropsWithElement<'div'>, HTMLAttributes<'div', 'id' | 'dir'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { useFileUpload } from '../modules/provider.svelte';\n\timport { RootContext } from '../modules/root-context.js';\n\timport { splitProps } from '@zag-js/file-upload';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadRootProps = $props();\n\n\tconst [fileUploadProps, componentProps] = $derived(splitProps(props));\n\tconst { element, children, ...rest } = $derived(componentProps);\n\n\tconst id = $props.id();\n\tconst fileUpload = useFileUpload(() => ({\n\t\t...fileUploadProps,\n\t\tid: id,\n\t}));\n\n\tconst attributes = $derived(mergeProps(fileUpload().getRootProps(), rest));\n\n\tRootContext.provide(() => fileUpload());\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<div {...attributes}>\n\t\t{@render children?.()}\n\t</div>\n{/if}\n","<script lang=\"ts\" module>\n\timport type { HTMLAttributes } from '../../../internal/html-attributes.js';\n\timport type { PropsWithElement } from '../../../internal/props-with-element.js';\n\n\texport interface FileUploadTriggerProps extends PropsWithElement<'button'>, HTMLAttributes<'button'> {}\n</script>\n\n<script lang=\"ts\">\n\timport { RootContext } from '../modules/root-context.js';\n\timport { mergeProps } from '@zag-js/svelte';\n\n\tconst props: FileUploadTriggerProps = $props();\n\n\tconst fileUpload = RootContext.consume();\n\n\tconst { element, children, ...rest } = $derived(props);\n\n\tconst attributes = $derived(mergeProps(fileUpload().getTriggerProps(), rest));\n</script>\n\n{#if element}\n\t{@render element(attributes)}\n{:else}\n\t<button {...attributes}>\n\t\t{@render children?.()}\n\t</button>\n{/if}\n","import ClearTrigger from '../anatomy/clear-trigger.svelte';\nimport Dropzone from '../anatomy/dropzone.svelte';\nimport HiddenInput from '../anatomy/hidden-input.svelte';\nimport ItemDeleteTrigger from '../anatomy/item-delete-trigger.svelte';\nimport ItemGroup from '../anatomy/item-group.svelte';\nimport ItemName from '../anatomy/item-name.svelte';\nimport ItemSizeText from '../anatomy/item-size-text.svelte';\nimport Item from '../anatomy/item.svelte';\nimport Label from '../anatomy/label.svelte';\nimport RootContext from '../anatomy/root-context.svelte';\nimport RootProvider from '../anatomy/root-provider.svelte';\nimport Root from '../anatomy/root.svelte';\nimport Trigger from '../anatomy/trigger.svelte';\nexport const FileUpload = Object.assign(Root, {\n    Provider: RootProvider,\n    Context: RootContext,\n    Label: Label,\n    Dropzone: Dropzone,\n    Trigger: Trigger,\n    ClearTrigger: ClearTrigger,\n    HiddenInput: HiddenInput,\n    ItemGroup: ItemGroup,\n    Item: Item,\n    ItemName: ItemName,\n    ItemSizeText: ItemSizeText,\n    ItemDeleteTrigger: ItemDeleteTrigger,\n});\n","<!-- \n@file src/components/system/table/Boolean.svelte\n@component \n**Boolean component for displaying 'Yes' or 'No' with badges in a table**\n\n@example\n<Boolean value={true} />\n\n### Props\n- `value` {boolean}: The boolean value to display\n\n### Features:\n- Displays 'Yes' for true and 'No' for false\n- Uses badges with different gradients for visual distinction\n-->\n\n<script lang=\"ts\">\n\t//ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Svelte 5 props\n\tinterface Props {\n\t\tvalue?: boolean;\n\t}\n\n\tconst { value = false }: Props = $props();\n</script>\n\n<!-- Display 'Yes' for true and 'No' for false with badges -->\n<span class={value ? 'gradient-error badge rounded' : 'gradient-primary badge rounded'}>\n\t{value ? m.boolean_yes() : m.boolean_no()}\n</span>\n","<!--\n@file src/components/system/table/Role.svelte\n@component\n**Role component for displaying different badges based on user roles.**\n\n@example\n<Role value={roles[0]?._id} />\n\n### Props\n- `value` {string}: The role ID to display\n- `roles` {Role[]}: Array of role objects to reference for display\n\n### Features\n- Dynamic role rendering based on user roles\n- Customizable role badges with icons and colors\n- Fallback to default role if role ID not found in roles array\n-->\n\n<script lang=\"ts\">\n\t// Auth\n\timport type { Role } from '@shared/database/auth/types';\n\n\t// Ensure roles is an array\n\tconst { value, roles = [] } = $props();\n\n\tconst roleClasses = (roleId: string) => {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\t\tif (!role) {\n\t\t\tconst defaultRole = roles.find((r: Role) => r._id === 'user');\n\t\t\treturn defaultRole?.color || 'text-white';\n\t\t}\n\t\treturn role.color || 'text-white';\n\t};\n\n\tconst iconForRole = (roleId: string) => {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\t\tif (!role) {\n\t\t\tconst defaultRole = roles.find((r: Role) => r._id === 'user');\n\t\t\treturn defaultRole?.icon || 'material-symbols:person';\n\t\t}\n\t\treturn role.icon || 'material-symbols:person';\n\t};\n\n\tconst roleName = (roleId: string) => {\n\t\tconst role = roles.find((r: Role) => r._id === roleId);\n\t\tif (!role) {\n\t\t\tconst defaultRole = roles.find((r: Role) => r._id === 'user');\n\t\t\treturn defaultRole?.name || 'User';\n\t\t}\n\t\treturn role.name || 'User';\n\t};\n</script>\n\n<span class=\"badge {roleClasses(value)}\">\n\t{#if iconForRole(value)}\n\t\t<iconify-icon icon={iconForRole(value)} width=\"20\"></iconify-icon> {roleName(value)}\n\t{:else}\n\t\t<span>{roleName(value)}</span>\n\t{/if}\n</span>\n","<!--\n@files src/routes/(app)/user/components/ModalEditToken.svelte\n@component\n**Modal for editing or creating user registration tokens**\n\nThis component provides a form to create new registration tokens or edit existing ones.\nIt handles token creation, updates, and deletion with proper validation and error handling.\n\n@props\n- `parent` {object} - Parent modal properties (regionFooter, onClose, buttonPositive)\n- `token` {string} - Existing token (default: '')\n- `user_id` {string} - User ID (default: '')\n- `email` {string} - Associated email (default: '')\n- `role` {string} - Token role (default: 'user')\n- `expires` {string} - Expiration date (default: '2 days')\n\n-->\n\n<script lang=\"ts\">\n\timport { invalidateAll } from '$app/navigation';\n\timport { page } from '$app/state';\n\n\t// Skeleton & Stores\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\n\t// Component\n\timport FloatingInput from '@cms/components/system/inputs/floatingInput.svelte';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\timport { Form } from '@shared/utils/Form.svelte';\n\timport { addUserTokenSchema } from '@shared/utils/formSchemas';\n\n\t// Props\n\tinterface Props {\n\t\ttoken?: string;\n\t\tuser_id?: string;\n\t\temail?: string;\n\t\trole?: string;\n\t\texpires?: string;\n\t\t// Allow passing user/roles as props for flexibility/testing\n\t\tuser?: any;\n\t\troles?: any[];\n\t\tclose?: (val?: any) => void;\n\t}\n\n\tlet { token = '', user_id = '', email = '', role = 'user', expires = '', user = page.data.user, roles = page.data.roles, close }: Props = $props();\n\n\t// Form Data with format conversion\n\tfunction convertLegacyFormat(expires: string): string {\n\t\t// Convert old format to new API format\n\t\tswitch (expires) {\n\t\t\tcase '1h':\n\t\t\t\treturn '2 hrs'; // Map 1h to closest option\n\t\t\tcase '2h':\n\t\t\t\treturn '2 hrs';\n\t\t\tcase '12h':\n\t\t\t\treturn '12 hrs';\n\t\t\tcase '1d':\n\t\t\t\treturn '2 days'; // Default\n\t\t\tcase '2d':\n\t\t\t\treturn '2 days';\n\t\t\tcase '7d':\n\t\t\t\treturn '1 week'; // 7 days = 1 week\n\t\t\tcase '30d':\n\t\t\t\treturn '1 month'; // 30 days  1 month\n\t\t\tcase '90d':\n\t\t\t\treturn '1 month'; // 90 days, use 1 month as closest\n\t\t\tdefault:\n\t\t\t\t// If it's already in new format, return as-is\n\t\t\t\tif (['2 hrs', '12 hrs', '2 days', '1 week', '2 weeks', '1 month'].includes(expires)) {\n\t\t\t\t\treturn expires;\n\t\t\t\t}\n\t\t\t\treturn '2 days'; // Default fallback\n\t\t}\n\t}\n\n\tconst tokenForm = new Form(\n\t\t{\n\t\t\tuser_id: '',\n\t\t\temail: '',\n\t\t\ttoken: '',\n\t\t\trole: 'user',\n\t\t\texpiresIn: '2 days'\n\t\t},\n\t\taddUserTokenSchema\n\t);\n\n\t$effect(() => {\n\t\ttokenForm.data.user_id = user_id;\n\t\ttokenForm.data.email = email;\n\t\ttokenForm.data.token = token;\n\t\ttokenForm.data.role = role || 'user';\n\t\ttokenForm.data.expiresIn = !expires || expires === '' ? '2 days' : convertLegacyFormat(expires);\n\t});\n\n\tasync function onFormSubmit(event: SubmitEvent): Promise<void> {\n\t\tevent.preventDefault();\n\n\t\tif (!tokenForm.validate()) {\n\t\t\treturn;\n\t\t}\n\n\t\ttokenForm.submitting = true;\n\n\t\ttry {\n\t\t\tconst isEditMode = !!tokenForm.data.token;\n\t\t\tconst endpoint = isEditMode ? `/api/token/${tokenForm.data.token}` : '/api/token/createToken';\n\t\t\tconst method = isEditMode ? 'PUT' : 'POST';\n\n\t\t\tconst body = isEditMode\n\t\t\t\t? {\n\t\t\t\t\t\tnewTokenData: {\n\t\t\t\t\t\t\temail: tokenForm.data.email,\n\t\t\t\t\t\t\trole: tokenForm.data.role,\n\t\t\t\t\t\t\texpiresInHours: convertExpiresToHours(tokenForm.data.expiresIn)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t: {\n\t\t\t\t\t\temail: tokenForm.data.email,\n\t\t\t\t\t\trole: tokenForm.data.role,\n\t\t\t\t\t\texpiresIn: tokenForm.data.expiresIn // Send the API format directly\n\t\t\t\t\t};\n\n\t\t\tconst response = await fetch(endpoint, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });\n\t\t\tconst responseData = await response.json();\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(responseData.message || 'Operation failed');\n\t\t\t}\n\n\t\t\t// Check if SMTP is not configured\n\t\t\tif (responseData.smtp_not_configured) {\n\t\t\t\ttoaster.create({\n\t\t\t\t\ttitle: 'Warning',\n\t\t\t\t\tdescription: `${isEditMode ? 'Token updated' : 'Token created'} - Email not sent: SMTP not configured. Token is listed in Admin Area.`,\n\t\t\t\t\ttype: 'warning'\n\t\t\t\t});\n\t\t\t} else if (responseData.dev_mode && !responseData.email_sent) {\n\t\t\t\t// Email was skipped due to dev mode or dummy config\n\t\t\t\ttoaster.create({\n\t\t\t\t\ttitle: 'Info',\n\t\t\t\t\tdescription: `${isEditMode ? 'Token updated' : 'Token created'} - Email sending skipped (dev mode)`,\n\t\t\t\t\ttype: 'info'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Success - email sent\n\t\t\t\t// TODO: Add 'user_token_created' to messages or find correct key\n\t\t\t\ttoaster.create({ title: 'Success', description: 'User token created', type: 'success' });\n\t\t\t}\n\n\t\t\t// Invalidate data first, then close modal\n\t\t\tawait invalidateAll();\n\n\t\t\t// Close modal and trigger response handler\n\t\t\tif (close) close({ success: true });\n\t\t} catch (err) {\n\t\t\tconst message = err instanceof Error ? err.message : 'An unknown error occurred';\n\t\t\ttoaster.create({ title: 'Error', description: message, type: 'error' });\n\t\t} finally {\n\t\t\ttokenForm.submitting = false;\n\t\t}\n\t}\n\n\tasync function deleteToken(): Promise<void> {\n\t\tif (!tokenForm.data.token) return;\n\t\ttry {\n\t\t\tconst response = await fetch(`/api/token/${tokenForm.data.token}`, {\n\t\t\t\tmethod: 'DELETE',\n\t\t\t\theaders: { 'Content-Type': 'application/json' }\n\t\t\t});\n\n\t\t\tconst data = await response.json();\n\t\t\tif (!response.ok) {\n\t\t\t\t// This will now correctly show the JSON error message from the API\n\t\t\t\tthrow new Error(data.message || 'Failed to delete token');\n\t\t\t}\n\n\t\t\ttoaster.create({\n\t\t\t\ttitle: 'Success',\n\t\t\t\tdescription: m.modal_token_deleted_successfully(),\n\t\t\t\ttype: 'success'\n\t\t\t});\n\t\t\t// Invalidate data first, then close modal\n\t\t\tawait invalidateAll();\n\n\t\t\t// Close modal and trigger response handler\n\t\t\tif (close) close({ success: true });\n\t\t} catch (err) {\n\t\t\tconst message = err instanceof Error ? err.message : 'Failed to delete token';\n\t\t\t// This catch block will now receive a proper error message if the API fails.\n\t\t\ttoaster.create({ title: 'Error', description: message, type: 'error' });\n\t\t}\n\t}\n\n\tfunction convertExpiresToHours(expires: string): number {\n\t\t// Convert API format back to hours for the edit endpoint\n\t\tswitch (expires) {\n\t\t\tcase '2 hrs':\n\t\t\t\treturn 2;\n\t\t\tcase '12 hrs':\n\t\t\t\treturn 12;\n\t\t\tcase '2 days':\n\t\t\t\treturn 48;\n\t\t\tcase '1 week':\n\t\t\t\treturn 168;\n\t\t\tcase '2 weeks':\n\t\t\t\treturn 336;\n\t\t\tcase '1 month':\n\t\t\t\treturn 720;\n\t\t\tdefault:\n\t\t\t\treturn 48; // Default 2 days\n\t\t}\n\t}\n</script>\n\n<div class=\"modal-example-form space-y-4 text-black dark:text-white\">\n\t<!-- Header title handled by DialogManager if passed as prop, but keeping internal header if needed for specific layout -->\n\n\t<form class=\"modal-form space-y-4\" onsubmit={onFormSubmit} id=\"token-form\">\n\t\t<!-- Email field -->\n\t\t<div class=\"group relative z-0 mb-6 w-full\">\n\t\t\t<FloatingInput\n\t\t\t\ttype=\"text\"\n\t\t\t\tname=\"email\"\n\t\t\t\tlabel={m.email()}\n\t\t\t\tbind:value={tokenForm.data.email}\n\t\t\t\tonkeydown={() => (tokenForm.errors.email = [])}\n\t\t\t\trequired\n\t\t\t\tautocomplete=\"email\"\n\t\t\t\ticon=\"mdi:email\"\n\t\t\t\ttextColor=\"text-tertiary-500 dark:text-white\"\n\t\t\t/>\n\t\t\t{#if tokenForm.errors.email}\n\t\t\t\t<div class=\"absolute left-0 top-11 text-xs text-error-500\">\n\t\t\t\t\t{tokenForm.errors.email[0]}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t\t<!-- Token field (hidden but still submitted with form) -->\n\t\t<input bind:value={tokenForm.data.token} type=\"hidden\" name=\"token\" />\n\n\t\t<!-- User Role -->\n\t\t{#if user.role === 'admin'}\n\t\t\t<div class=\"flex flex-col gap-2 sm:flex-row\">\n\t\t\t\t<div class=\"border-b text-center sm:w-1/4 sm:border-0 sm:text-left\">\n\t\t\t\t\t{m.role()}: <span class=\"text-error-500\">*</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex-auto\">\n\t\t\t\t\t<div class=\"flex flex-wrap justify-center gap-2 space-x-2 sm:justify-start\">\n\t\t\t\t\t\t{#if roles && roles.length > 0}\n\t\t\t\t\t\t\t{#each roles as r}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclass=\"chip {tokenForm.data.role === r._id\n\t\t\t\t\t\t\t\t\t\t? 'preset-filled-tertiary-500'\n\t\t\t\t\t\t\t\t\t\t: 'bg-surface-200 dark:bg-surface-700 text-black dark:text-white'}\"\n\t\t\t\t\t\t\t\t\tonclick={() => (tokenForm.data.role = r._id)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if tokenForm.data.role === r._id}\n\t\t\t\t\t\t\t\t\t\t<span><iconify-icon icon=\"fa:check\"></iconify-icon></span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<span class=\"capitalize\">{r.name}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500\">No roles available. Check console for debug info.</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<!-- Expires field -->\n\t\t<div class=\"group relative z-0 mb-6 w-full\">\n\t\t\t<label for=\"expires-select\" class=\"mb-2 block text-sm font-medium text-black dark:text-white\">{m.modaltokenuser_tokenvalidity()}</label>\n\t\t\t<select\n\t\t\t\tid=\"expires-select\"\n\t\t\t\tbind:value={tokenForm.data.expiresIn}\n\t\t\t\tclass=\"input bg-white text-black dark:bg-surface-700 dark:text-white\"\n\t\t\t\taria-label=\"Token Validity\"\n\t\t\t>\n\t\t\t\t<option value=\"2 hrs\">2 Hours</option>\n\t\t\t\t<option value=\"12 hrs\">12 Hours</option>\n\t\t\t\t<option value=\"2 days\">2 Days (default)</option>\n\t\t\t\t<option value=\"1 week\">1 Week</option>\n\t\t\t\t<option value=\"2 weeks\">2 Weeks</option>\n\t\t\t\t<option value=\"1 month\">1 Month</option>\n\t\t\t</select>\n\t\t</div>\n\n\t\t<footer class=\"modal-footer flex items-center justify-between pt-4 border-t border-surface-500/20\">\n\t\t\t<!-- Delete - Only show for existing tokens -->\n\t\t\t{#if tokenForm.data.token}\n\t\t\t\t<button type=\"button\" onclick={deleteToken} class=\"preset-filled-error-500 btn\">\n\t\t\t\t\t<iconify-icon icon=\"icomoon-free:bin\" width=\"24\"></iconify-icon><span class=\"hidden sm:block\">{m.button_delete()}</span>\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t\t<!-- Cancel -->\n\t\t\t<button type=\"button\" class=\"preset-outlined-secondary-500 btn\" onclick={() => modalState.close()}>{m.button_cancel()}</button>\n\t\t\t<!-- Save -->\n\t\t\t<button type=\"submit\" form=\"token-form\" class=\"preset-filled-tertiary-500 btn dark:preset-filled-primary-500\">\n\t\t\t\t{m.button_save()}\n\t\t\t</button>\n\t\t</footer>\n\t</form>\n</div>\n","<!-- \n@file src/routes/(app)/user/components/ModalEditForm.svelte\n@component\n**A modal for editing user data like username, email, password, and role**\n\nEfficiently manages user data updates with validation, role selection, and deletion. Optimized for performance and accessibility.\n\n@props\n- `parent` {object} - Parent modal properties (regionFooter, onClose, buttonPositive)\n- `isGivenData` {boolean} - Whether data is pre-provided (default: false)\n- `username` {string|null} - Pre-filled username (default: null)\n- `email` {string|null} - Pre-filled email (default: null)\n- `role` {string|null} - Pre-filled role (default: null)\n- `user_id` {string|null} - User ID to edit (default: null)\n-->\n\n<script lang=\"ts\">\n\timport { invalidateAll } from '$app/navigation';\n\timport { page } from '$app/state';\n\t// Skeleton & Stores\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { Form } from '@shared/utils/Form.svelte';\n\timport { editUserSchema } from '@shared/utils/formSchemas';\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Get data from page store\n\tconst { roles, user } = page.data;\n\tconst isFirstUser = page.data.isFirstUser;\n\n\t// Components\n\timport PermissionGuard from '@cms/components/PermissionGuard.svelte';\n\timport FloatingInput from '@cms/components/system/inputs/floatingInput.svelte';\n\n\t// Config for the general edit form permissions\n\tconst modaleEditFormConfig = {\n\t\tname: 'Admin User Edit Form',\n\t\tdescription: 'Allows admins to manage user accounts, including editing and assigning roles.',\n\t\tcontextId: 'user:manage',\n\t\taction: 'manage',\n\t\tcontextType: 'user'\n\t};\n\n\t// Config for delete permission guard\n\tconst deleteUserPermissionConfig = {\n\t\tname: 'Delete User',\n\t\tdescription: 'Allows deleting a user account.',\n\t\tcontextId: 'user:delete',\n\t\taction: 'delete',\n\t\tcontextType: 'user'\n\t};\n\n\t// Props\n\tinterface Props {\n\t\tparent?: any; // Was ModalComponent['props']\n\t\tisGivenData?: boolean;\n\t\tusername?: string | null;\n\t\temail?: string | null;\n\t\trole?: string | null;\n\t\tuser_id?: string | null;\n\t\ttitle?: string;\n\t\tbody?: string;\n\t}\n\tconst { isGivenData = false, username = null, email = null, role = null, user_id = null, title, body }: Props = $props();\n\n\t// Store initialization\n\n\t// Form Data Initialization\n\tconst editForm = new Form(\n\t\t{\n\t\t\tuser_id: '',\n\t\t\tusername: '',\n\t\t\temail: '',\n\t\t\tpassword: '',\n\t\t\tconfirmPassword: '',\n\t\t\trole: ''\n\t\t},\n\t\teditUserSchema\n\t);\n\n\t$effect(() => {\n\t\teditForm.data.user_id = isGivenData ? user_id : user?._id;\n\t\teditForm.data.username = isGivenData ? (username ?? '') : (user?.username ?? '');\n\t\teditForm.data.email = isGivenData ? (email ?? '') : (user?.email ?? '');\n\t\teditForm.data.role = isGivenData ? (role ?? '') : (user?.role ?? '');\n\t});\n\n\tlet showPassword = $state(false);\n\tconst isOwnProfile = $derived(editForm.data.user_id === user?._id || !isGivenData);\n\tconst canChangePassword = $derived(isOwnProfile || user?.isAdmin);\n\n\t// Check if user has delete permission for layout purposes\n\tconst hasDeletePermission = user?.isAdmin || user?.role === 'admin';\n\tconst showDeleteButton = $derived(hasDeletePermission && !isOwnProfile && !isFirstUser);\n\n\tasync function onFormSubmit(event: SubmitEvent): Promise<void> {\n\t\tevent.preventDefault();\n\n\t\tif (!editForm.validate()) {\n\t\t\treturn;\n\t\t}\n\n\t\teditForm.submitting = true;\n\n\t\t// Track what changed for smart toast messages\n\t\tconst changes: string[] = [];\n\t\tconst originalData = {\n\t\t\tusername: isGivenData ? username : user?.username,\n\t\t\temail: isGivenData ? email : user?.email,\n\t\t\trole: isGivenData ? role : user?.role\n\t\t};\n\n\t\t// Check what actually changed\n\t\tif (editForm.data.username !== originalData.username) {\n\t\t\tchanges.push('username');\n\t\t}\n\t\tif (!isOwnProfile && editForm.data.role !== originalData.role) {\n\t\t\tconst oldRole = roles?.find((r: any) => r._id === originalData.role)?.name || originalData.role;\n\t\t\tconst newRole = roles?.find((r: any) => r._id === editForm.data.role)?.name || editForm.data.role;\n\t\t\tchanges.push(`role (${oldRole}  ${newRole})`);\n\t\t}\n\t\tif (editForm.data.password && editForm.data.password.trim() !== '') {\n\t\t\tchanges.push('password');\n\t\t}\n\n\t\t// Create a clean data object for the API call (just the user fields)\n\t\tconst submitData: Record<string, any> = {\n\t\t\tusername: editForm.data.username,\n\t\t\temail: editForm.data.email\n\t\t};\n\n\t\t// Only include role if user is not editing their own profile\n\t\tif (!isOwnProfile) {\n\t\t\tsubmitData.role = editForm.data.role;\n\t\t}\n\n\t\t// Only include password fields if they're not empty\n\t\tif (editForm.data.password && editForm.data.password.trim() !== '') {\n\t\t\tsubmitData.password = editForm.data.password;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch('/api/user/updateUserAttributes', {\n\t\t\t\tmethod: 'PUT',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tuser_id: editForm.data.user_id,\n\t\t\t\t\tnewUserData: submitData\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(result.message || 'Failed to update user.');\n\t\t\t}\n\n\t\t\ttoaster.success({\n\t\t\t\tdescription: '<iconify-icon icon=\"mdi:check-outline\" color=\"white\" width=\"26\" class=\"mr-1\"></iconify-icon> User Data Updated'\n\t\t\t});\n\t\t\tawait invalidateAll();\n\t\t\t// modalStore.close();\n\t\t\tmodalState.close();\n\t\t} catch (err) {\n\t\t\tconst message = err instanceof Error ? err.message : 'An unknown error occurred.';\n\t\t\ttoaster.error({ description: `<iconify-icon icon=\"mdi:alert-circle\" width=\"24\"/> ${message}` });\n\t\t} finally {\n\t\t\teditForm.submitting = false;\n\t\t}\n\t}\n\n\tasync function deleteUser() {\n\t\tif (!editForm.data.user_id) return;\n\t\ttry {\n\t\t\tconst response = await fetch('/api/user/batch', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tuserIds: [editForm.data.user_id],\n\t\t\t\t\taction: 'delete'\n\t\t\t\t})\n\t\t\t});\n\t\t\tconst data = await response.json();\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(data.message || 'Failed to delete user.');\n\t\t\t}\n\n\t\t\t// Use the success message from the API response\n\t\t\tconst successMessage = data.message || 'User deleted successfully.';\n\t\t\ttoaster.success({ description: `<iconify-icon icon=\\\"mdi:check\\\" width=\\\"24\\\"/> ${successMessage}` });\n\n\t\t\tawait invalidateAll();\n\t\t\t// modalStore.close();\n\t\t\tmodalState.close();\n\t\t} catch (err) {\n\t\t\tconst message = err instanceof Error ? err.message : 'An unknown error occurred.';\n\t\t\ttoaster.error({ description: `<iconify-icon icon=\\\"mdi:alert-circle\\\" width=\\\"24\\\"/> ${message}` });\n\t\t}\n\t}\n\n\t// Base Classes\n\tconst cHeader = 'text-2xl font-bold';\n\tconst cForm = 'border border-surface-500 p-4 space-y-4 rounded-xl';\n</script>\n\n<div class=\"modal-example-form space-y-4\">\n\t<header class=\"text-center dark:text-primary-500 {cHeader}\">\n\t\t{title ?? '(title missing)'}\n\t</header>\n\t<article class=\"text-center text-sm\">\n\t\t{body ?? '(body missing)'}\n\t</article>\n\t<form class=\"modal-form {cForm}\" id=\"change_user_form\" onsubmit={onFormSubmit}>\n\t\t<!-- Username -->\n\t\t<div class=\"group relative z-0 mb-6 w-full\">\n\t\t\t<iconify-icon icon=\"mdi:user-circle\" width=\"18\" class=\"absolute left-0 top-3.5 text-gray-400\"></iconify-icon>\n\t\t\t<FloatingInput\n\t\t\t\ttype=\"text\"\n\t\t\t\tname=\"username\"\n\t\t\t\tlabel={m.username()}\n\t\t\t\tbind:value={editForm.data.username}\n\t\t\t\tonkeydown={() => (editForm.errors.username = [])}\n\t\t\t\trequired\n\t\t\t\tdisabled={isGivenData && user_id !== user?._id}\n\t\t\t\tautocomplete=\"username\"\n\t\t\t\ttextColor=\"text-tertiary-500 dark:text-white\"\n\t\t\t/>\n\t\t\t{#if editForm.errors.username}\n\t\t\t\t<div class=\"absolute left-0 top-11 text-xs text-error-500\">{editForm.errors.username[0]}</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<!-- Email -->\n\t\t<div class=\"group relative z-0 mb-6 w-full\">\n\t\t\t<iconify-icon icon=\"mdi:email\" width=\"18\" class=\"absolute left-0 top-3.5 text-gray-400\"></iconify-icon>\n\t\t\t<FloatingInput\n\t\t\t\ttype=\"email\"\n\t\t\t\tname=\"email\"\n\t\t\t\tlabel=\"Email\"\n\t\t\t\tbind:value={editForm.data.email}\n\t\t\t\tonkeydown={() => (editForm.errors.email = [])}\n\t\t\t\trequired\n\t\t\t\tdisabled\n\t\t\t\tautocomplete=\"email\"\n\t\t\t\ttextColor=\"text-tertiary-500 dark:text-white\"\n\t\t\t/>\n\t\t\t{#if editForm.errors.email}\n\t\t\t\t<div class=\"absolute left-0 top-11 text-xs text-error-500\">{editForm.errors.email[0]}</div>\n\t\t\t{/if}\n\t\t</div>\n\t\t<!-- Password Change Section -->\n\t\t{#if canChangePassword}\n\t\t\t{#if !isOwnProfile && user?.isAdmin}\n\t\t\t\t<div class=\"mb-4 rounded-md bg-warning-50 p-3 text-sm text-warning-800 dark:bg-warning-900/20 dark:text-warning-200\">\n\t\t\t\t\t<div class=\"flex\">\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:information\" width=\"16\" class=\"mr-2 mt-0.5 shrink-0\"></iconify-icon>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<strong>Admin Password Reset:</strong> You are setting a new password for this user. Leave empty to keep current password unchanged.\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<!-- Password field -->\n\t\t\t<div class=\"group relative z-0 mb-6 w-full\">\n\t\t\t\t<iconify-icon icon=\"mdi:password\" width=\"18\" class=\"absolute left-0 top-3.5 text-gray-400\"></iconify-icon>\n\t\t\t\t<FloatingInput\n\t\t\t\t\ttype=\"password\"\n\t\t\t\t\tname=\"password\"\n\t\t\t\t\tid=\"password\"\n\t\t\t\t\tlabel={isOwnProfile ? m.modaleditform_newpassword() : 'Set New Password'}\n\t\t\t\t\tbind:value={editForm.data.password}\n\t\t\t\t\tbind:showPassword\n\t\t\t\t\tonkeydown={() => (editForm.errors.password = [])}\n\t\t\t\t\tautocomplete=\"new-password\"\n\t\t\t\t\ttextColor=\"text-tertiary-500 dark:text-white\"\n\t\t\t\t\tpasswordIconColor=\"text-tertiary-500 dark:text-white\"\n\t\t\t\t/>\n\t\t\t\t{#if editForm.errors.password}\n\t\t\t\t\t<div class=\"absolute left-0 top-11 text-xs text-error-500\">{editForm.errors.password[0]}</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<!-- Password Confirm -->\n\t\t\t<div class=\"group relative z-0 mb-6 w-full\">\n\t\t\t\t<iconify-icon icon=\"mdi:password\" width=\"18\" class=\"absolute left-0 top-3.5 text-gray-400\"></iconify-icon>\n\t\t\t\t<FloatingInput\n\t\t\t\t\ttype=\"password\"\n\t\t\t\t\tname=\"confirm_password\"\n\t\t\t\t\tid=\"confirm_password\"\n\t\t\t\t\tlabel={m.confirm_password?.() || m.form_confirmpassword?.()}\n\t\t\t\t\tbind:value={editForm.data.confirmPassword}\n\t\t\t\t\tbind:showPassword\n\t\t\t\t\tonkeydown={() => (editForm.errors.confirmPassword = [])}\n\t\t\t\t\tautocomplete=\"new-password\"\n\t\t\t\t\ttextColor=\"text-tertiary-500 dark:text-white\"\n\t\t\t\t\tpasswordIconColor=\"text-tertiary-500 dark:text-white\"\n\t\t\t\t/>\n\t\t\t\t{#if editForm.errors.confirmPassword}\n\t\t\t\t\t<div class=\"absolute left-0 top-11 text-xs text-error-500\">{editForm.errors.confirmPassword[0]}</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t{/if}\n\t\t<!-- Role Select -->\n\t\t<PermissionGuard config={modaleEditFormConfig} silent={true}>\n\t\t\t{#if !isOwnProfile}\n\t\t\t\t<div class=\"flex flex-col gap-2 sm:flex-row\">\n\t\t\t\t\t<div class=\"border-b text-center sm:w-1/4 sm:border-0 sm:text-left\">{m.role()}</div>\n\t\t\t\t\t<div class=\"flex-auto\">\n\t\t\t\t\t\t<div class=\"flex flex-wrap justify-center gap-2 space-x-2 sm:justify-start\">\n\t\t\t\t\t\t\t{#if roles && roles.length > 0}\n\t\t\t\t\t\t\t\t{#each roles as r}\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tclass=\"chip {editForm.data.role === r._id ? 'preset-filled-tertiary-500' : 'preset-ghost-secondary-500'}\"\n\t\t\t\t\t\t\t\t\t\tonclick={() => (editForm.data.role = r._id)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{#if editForm.data.role === r._id}\n\t\t\t\t\t\t\t\t\t\t\t<span><iconify-icon icon=\"fa:check\"></iconify-icon></span>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t<span class=\"capitalize\">{r.name}</span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"flex flex-col gap-2 sm:flex-row\">\n\t\t\t\t\t<div class=\"border-b text-center sm:w-1/4 sm:border-0 sm:text-left\">{m.role()}</div>\n\t\t\t\t\t<div class=\"flex-auto\">\n\t\t\t\t\t\t<div class=\"rounded-md bg-gray-50 p-3 text-sm text-gray-600 dark:bg-gray-800 dark:text-gray-400\">\n\t\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:information\" width=\"16\" class=\"mr-2 shrink-0\"></iconify-icon>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<strong>Current Role:</strong>\n\t\t\t\t\t\t\t\t\t{roles?.find((r: any) => r._id === editForm.data.role)?.name || editForm.data.role}\n\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t<em>You cannot change your own role for security reasons.</em>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</PermissionGuard>\n\t</form>\n\t<footer class=\"modal-footer flex {showDeleteButton ? 'justify-between' : 'justify-end'} pt-4 border-t border-surface-500/20\">\n\t\t<!-- Delete User Button -->\n\t\t{#if showDeleteButton}\n\t\t\t<PermissionGuard config={deleteUserPermissionConfig} silent={true}>\n\t\t\t\t<button type=\"button\" onclick={deleteUser} class=\"preset-filled-error-500 btn\">\n\t\t\t\t\t<iconify-icon icon=\"icomoon-free:bin\" width=\"24\"></iconify-icon>\n\t\t\t\t\t<span class=\"hidden sm:block\">{m.button_delete()}</span>\n\t\t\t\t</button>\n\t\t\t</PermissionGuard>\n\t\t{/if}\n\n\t\t<div class=\"flex gap-4\">\n\t\t\t<!-- Cancel -->\n\t\t\t<button type=\"button\" class=\"preset-outlined-secondary-500 btn\" onclick={() => modalState.close()}>{m.button_cancel()}</button>\n\t\t\t<!-- Save -->\n\t\t\t<button type=\"submit\" form=\"change_user_form\" class=\"preset-filled-tertiary-500 btn dark:preset-filled-primary-500\">\n\t\t\t\t{m.button_save()}\n\t\t\t</button>\n\t\t</div>\n\t</footer>\n</div>\n","<!-- \n@files src/components/user/Multibutton.svelte\n@component\n**A unified multibutton component for managing users and tokens**\n\nManages actions (edit, delete, block, unblock) with debounced submissions.\n\n@Example\n<Multibutton bind:selectedRows={selectedRows} type=\"user\" />\n\n#### Props\n- `selectedRows` {array} - Array of selected rows (User | Token)\n- `type` {\"user\" | \"token\"} - Type of data to manage (default: 'user')\n-->\n\n<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { scale } from 'svelte/transition';\n\timport { quintOut } from 'svelte/easing';\n\timport { invalidateAll } from '$app/navigation';\n\timport { logger } from '@shared/utils/logger';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Stores\n\timport { storeListboxValue } from '@shared/stores/store.svelte';\n\n\t// Skeleton & Utils\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\n\timport ModalEditForm from './ModalEditForm.svelte';\n\timport ModalEditToken from './ModalEditToken.svelte';\n\timport type { User, Token } from '@shared/database/auth/types';\n\n\tconst isUser = (row: unknown): row is User => {\n\t\treturn !!row && typeof row === 'object' && '_id' in row;\n\t};\n\tconst isToken = (row: unknown): row is Token => {\n\t\treturn !!row && typeof row === 'object' && 'token' in row;\n\t};\n\n\ttype ActionType = 'edit' | 'delete' | 'block' | 'unblock';\n\n\t// Props\n\tlet { selectedRows, type = 'user', totalUsers = 0, currentUser = null, onUpdate = () => {} } = $props();\n\n\t// State\n\tlet listboxValue = $state<ActionType>('edit');\n\tlet isDropdownOpen = $state(false);\n\tlet hoveredAction = $state<ActionType | null>(null);\n\tlet dropdownRef = $state<HTMLElement | null>(null);\n\n\t// Sync local listboxValue with global store for TableIcons\n\t$effect(() => {\n\t\tstoreListboxValue.set(listboxValue);\n\t});\n\n\t// Handle click outside to close dropdown\n\tfunction handleClickOutside(event: MouseEvent) {\n\t\tif (isDropdownOpen && dropdownRef && !dropdownRef.contains(event.target as Node)) {\n\t\t\tisDropdownOpen = false;\n\t\t}\n\t}\n\n\tonMount(() => {\n\t\tdocument.addEventListener('click', handleClickOutside);\n\t});\n\n\tonDestroy(() => {\n\t\tdocument.removeEventListener('click', handleClickOutside);\n\t});\n\n\t// Normalize selection to a safe array\n\tconst safeSelectedRows = $derived(Array.isArray(selectedRows) ? (selectedRows.filter(Boolean) as Array<User | Token>) : []);\n\n\t// Derived values\n\tconst isDisabled = $derived(safeSelectedRows.length === 0);\n\tconst isMultipleSelected = $derived(safeSelectedRows.length > 1);\n\n\t// Smart state detection for block/unblock actions\n\tconst blockState = $derived(() => {\n\t\tif (safeSelectedRows.length === 0) return null;\n\n\t\tif (type === 'user') {\n\t\t\tconst users = safeSelectedRows.filter(isUser);\n\t\t\tif (users.length === 0) return null;\n\t\t\tconst blockedCount = users.filter((user: User) => user.blocked).length;\n\t\t\tconst unblockedCount = users.filter((user: User) => !user.blocked).length;\n\n\t\t\tif (blockedCount === users.length) return 'all-blocked';\n\t\t\tif (unblockedCount === users.length) return 'all-unblocked';\n\t\t\treturn 'mixed';\n\t\t} else {\n\t\t\tconst tokens = safeSelectedRows.filter(isToken);\n\t\t\tif (tokens.length === 0) return null;\n\t\t\tconst blockedCount = tokens.filter((token: Token) => token.blocked).length;\n\t\t\tconst unblockedCount = tokens.filter((token: Token) => !token.blocked).length;\n\n\t\t\tif (blockedCount === tokens.length) return 'all-blocked';\n\t\t\tif (unblockedCount === tokens.length) return 'all-unblocked';\n\t\t\treturn 'mixed';\n\t\t}\n\t});\n\n\t// Available actions based on current state\n\tconst availableActions = $derived.by<ActionType[]>(() => {\n\t\tconst baseActions: ActionType[] = ['edit', 'delete'];\n\t\tconst currentBlockState = blockState;\n\n\t\tif (currentBlockState() === 'all-blocked') {\n\t\t\treturn [...baseActions, 'unblock'];\n\t\t} else if (currentBlockState() === 'all-unblocked') {\n\t\t\treturn [...baseActions, 'block'];\n\t\t} else if (currentBlockState() === 'mixed') {\n\t\t\treturn [...baseActions, 'block', 'unblock'];\n\t\t}\n\n\t\treturn baseActions;\n\t});\n\n\t// Actions to show in dropdown\n\tconst filteredActions = $derived.by<ActionType[]>(() => {\n\t\tconst actions = Array.isArray(availableActions) ? availableActions : [];\n\t\treturn actions.filter((action) => action !== listboxValue);\n\t});\n\n\t// Auto-adjust listboxValue when selection changes\n\t$effect(() => {\n\t\tif (safeSelectedRows.length > 0 && !availableActions.includes(listboxValue)) {\n\t\t\tconst currentBlockState = blockState;\n\t\t\t// If current action is not available, switch to the most appropriate one\n\t\t\tif (currentBlockState() === 'all-blocked' && listboxValue === 'block') {\n\t\t\t\tlistboxValue = 'unblock';\n\t\t\t} else if (currentBlockState() === 'all-unblocked' && listboxValue === 'unblock') {\n\t\t\t\tlistboxValue = 'block';\n\t\t\t} else if (!availableActions.includes(listboxValue)) {\n\t\t\t\tlistboxValue = 'edit'; // Default fallback\n\t\t\t}\n\t\t}\n\t});\n\n\t// Check if delete should be disabled for users\n\tconst isDeleteDisabled = $derived(\n\t\ttype === 'user' &&\n\t\t\tlistboxValue === 'delete' &&\n\t\t\t(totalUsers <= 1 ||\n\t\t\t\t(currentUser &&\n\t\t\t\t\tsafeSelectedRows.length === 1 &&\n\t\t\t\t\tisUser(safeSelectedRows[0]) &&\n\t\t\t\t\t(safeSelectedRows[0] as User)._id === currentUser._id &&\n\t\t\t\t\ttotalUsers === 1) ||\n\t\t\t\tsafeSelectedRows.length >= totalUsers)\n\t);\n\n\t// Helper function to convert Date to expires format expected by ModalEditToken\n\tfunction convertDateToExpiresFormat(expiresDate: Date | string | null): string {\n\t\tif (!expiresDate) return '7d'; // Default\n\n\t\tconst now = new Date();\n\t\tconst expires = new Date(expiresDate);\n\t\tconst diffMs = expires.getTime() - now.getTime();\n\t\tconst diffHours = Math.ceil(diffMs / (1000 * 60 * 60));\n\t\tconst diffDays = Math.ceil(diffHours / 24);\n\n\t\t// Match the available options in ModalEditToken\n\t\tif (diffHours <= 1) return '1h';\n\t\tif (diffDays <= 1) return '1d';\n\t\tif (diffDays <= 7) return '7d';\n\t\tif (diffDays <= 30) return '30d';\n\t\tif (diffDays <= 90) return '90d';\n\n\t\treturn '90d'; // Max available option\n\t}\n\n\t// Unified batch endpoints for consistent API design\n\tinterface ActionConfigItem {\n\t\tbuttonClass: string;\n\t\thoverClass: string;\n\t\ticonValue: string;\n\t\tlabel: string;\n\t\tmodalTitle: () => any;\n\t\tmodalBody: () => any;\n\t\tendpoint: () => string;\n\t\tmethod: () => string;\n\t\ttoastMessage: () => string;\n\t\ttoastBackground: string;\n\t}\n\n\tconst actionConfig = $derived<Record<ActionType, ActionConfigItem>>({\n\t\tedit: {\n\t\t\tbuttonClass: 'gradient-primary',\n\t\t\thoverClass: 'gradient-primary-hover',\n\t\t\ticonValue: 'bi:pencil-fill',\n\t\t\tlabel: 'Edit',\n\t\t\tmodalTitle: () => (type === 'user' ? m.adminarea_title() : m.multibuttontoken_modaltitle()),\n\t\t\tmodalBody: () => (type === 'user' ? 'Modify your data and then press Save.' : m.multibuttontoken_modalbody()),\n\t\t\tendpoint: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn '/api/user/updateUserAttributes';\n\t\t\t\t} else {\n\t\t\t\t\tconst firstRow = safeSelectedRows[0];\n\t\t\t\t\tif (isToken(firstRow)) {\n\t\t\t\t\t\treturn `/api/token/${firstRow.token}`;\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error('No token selected for editing');\n\t\t\t\t}\n\t\t\t},\n\t\t\tmethod: () => 'PUT',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'User' : 'Token'} Updated`,\n\t\t\ttoastBackground: 'gradient-primary'\n\t\t},\n\t\tdelete: {\n\t\t\tbuttonClass: 'gradient-error',\n\t\t\thoverClass: 'gradient-error-hover',\n\t\t\ticonValue: 'bi:trash3-fill',\n\t\t\tlabel: 'Delete',\n\t\t\tmodalTitle: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn `Please Confirm User <span class=\"text-error-500 font-bold\">Deletion</span>`;\n\t\t\t\t}\n\t\t\t\treturn `Please Confirm Token <span class=\"text-error-500 font-bold\">Deletion</span>`;\n\t\t\t},\n\t\t\tmodalBody: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst user = safeSelectedRows[0];\n\t\t\t\t\t\tif (isUser(user)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This action cannot be undone and will permanently remove the user from the system.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} users</span>? This action cannot be undone and will permanently remove all selected users from the system.`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst token = safeSelectedRows[0];\n\t\t\t\t\t\tif (isToken(token)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This action cannot be undone and will permanently remove the token from the system.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">delete</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} tokens</span>? This action cannot be undone and will permanently remove all selected tokens from the system.`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tendpoint: () => (type === 'user' ? '/api/user/batch' : '/api/token/batch'),\n\t\t\tmethod: () => 'POST',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'Users' : 'Tokens'} Deleted`,\n\t\t\ttoastBackground: 'preset-filled-success-500'\n\t\t},\n\t\tblock: {\n\t\t\tbuttonClass: 'gradient-pink',\n\t\t\thoverClass: 'gradient-yellow-hover',\n\t\t\ticonValue: 'material-symbols:lock',\n\t\t\tlabel: 'Block',\n\t\t\tmodalTitle: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn `Please Confirm User <span class=\"text-error-500 font-bold\">Block</span>`;\n\t\t\t\t}\n\t\t\t\treturn `Please Confirm Token <span class=\"text-error-500 font-bold\">Block</span>`;\n\t\t\t},\n\t\t\tmodalBody: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst user = safeSelectedRows[0];\n\t\t\t\t\t\tif (isUser(user)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will prevent them from accessing the system.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} users</span>? This will prevent them from accessing the system.`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Token blocking with enhanced styling\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst token = safeSelectedRows[0];\n\t\t\t\t\t\tif (isToken(token)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will prevent the token from being used.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} tokens</span>? This will prevent them from being used.`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tendpoint: () => (type === 'user' ? '/api/user/batch' : '/api/token/batch'),\n\t\t\tmethod: () => 'POST',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'Users' : 'Tokens'} Blocked`,\n\t\t\ttoastBackground: 'preset-filled-success-500'\n\t\t},\n\t\tunblock: {\n\t\t\tbuttonClass: 'gradient-yellow',\n\t\t\thoverClass: 'gradient-primary-hover',\n\t\t\ticonValue: 'material-symbols:lock-open',\n\t\t\tlabel: 'Unblock',\n\t\t\tmodalTitle: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\treturn `Please Confirm User <span class=\"text-success-500 font-bold\">Unblock</span>`;\n\t\t\t\t}\n\t\t\t\treturn `Please Confirm Token <span class=\"text-success-500 font-bold\">Unblock</span>`;\n\t\t\t},\n\t\t\tmodalBody: () => {\n\t\t\t\tif (type === 'user') {\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst user = safeSelectedRows[0];\n\t\t\t\t\t\tif (isUser(user)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will allow them to access the system again.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} users</span>? This will allow them to access the system again.`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Token unblocking with enhanced styling\n\t\t\t\t\tif (safeSelectedRows.length === 1) {\n\t\t\t\t\t\tconst token = safeSelectedRows[0];\n\t\t\t\t\t\tif (isToken(token)) {\n\t\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will allow the token to be used again.`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> <span class=\"text-tertiary-500 font-medium\">${safeSelectedRows.length} tokens</span>? This will allow them to be used again.`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tendpoint: () => (type === 'user' ? '/api/user/batch' : '/api/token/batch'),\n\t\t\tmethod: () => 'POST',\n\t\t\ttoastMessage: () => `${type === 'user' ? 'Users' : 'Tokens'} Unblocked`,\n\t\t\ttoastBackground: 'preset-filled-success-500'\n\t\t}\n\t});\n\n\tasync function executeBatchAction(action: ActionType, config: any) {\n\t\ttry {\n\t\t\tlet body: string;\n\t\t\t// Handle batch operations (delete, block, unblock)\n\t\t\tif (type === 'user') {\n\t\t\t\tbody = JSON.stringify({\n\t\t\t\t\tuserIds: safeSelectedRows.filter(isUser).map((row: User) => row._id),\n\t\t\t\t\taction: action\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Token batch operations\n\t\t\t\tbody = JSON.stringify({\n\t\t\t\t\ttokenIds: safeSelectedRows.filter(isToken).map((row: Token) => row.token),\n\t\t\t\t\taction: action\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst endpoint = config.endpoint();\n\t\t\tconst res = await fetch(endpoint, {\n\t\t\t\tmethod: config.method(),\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\t// Try to parse error response\n\t\t\t\tlet errorMessage = `Failed to ${action} ${type}`;\n\t\t\t\ttry {\n\t\t\t\t\tconst errorData = await res.json();\n\t\t\t\t\terrorMessage = errorData.message || errorMessage;\n\t\t\t\t} catch {\n\t\t\t\t\t// If JSON parsing fails, use status text\n\t\t\t\t\terrorMessage = res.statusText || errorMessage;\n\t\t\t\t}\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\n\t\t\tconst data = await res.json();\n\n\t\t\t// Generate smart toast message based on what actually changed\n\t\t\tlet toastMessage = data.message || config.toastMessage();\n\n\t\t\ttoaster.success({ description: toastMessage });\n\n\t\t\t// Dispatch update event for parent component to handle local state updates\n\t\t\tif (action === 'block' || action === 'unblock' || action === 'delete') {\n\t\t\t\tconst ids =\n\t\t\t\t\ttype === 'user'\n\t\t\t\t\t\t? safeSelectedRows.filter(isUser).map((row: User) => row._id)\n\t\t\t\t\t\t: safeSelectedRows.filter(isToken).map((row: Token) => row.token);\n\n\t\t\t\tonUpdate({\n\t\t\t\t\tids,\n\t\t\t\t\taction: action,\n\t\t\t\t\ttype\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait invalidateAll();\n\t\t} catch (error) {\n\t\t\tlogger.error(`Error during action '${action}' for type '${type}':`, error);\n\t\t\tconst errorMessage = error instanceof Error ? error.message : `An unknown error occurred.`;\n\t\t\ttoaster.error({ description: errorMessage });\n\t\t}\n\t}\n\n\tasync function handleAction(action: ActionType) {\n\t\tif (isDisabled) {\n\t\t\ttoaster.error({ description: `Please select ${type}(s) to ${action}` });\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if delete is disabled for users\n\t\tif (action === 'delete' && isDeleteDisabled) {\n\t\t\ttoaster.error({ description: 'Cannot delete the last user in the system' });\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === 'edit' && isMultipleSelected) {\n\t\t\ttoaster.error({ description: `Please select only one ${type} to edit` });\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if action is available (shouldn't happen with smart UI, but good safeguard)\n\t\tif (!availableActions.includes(action)) {\n\t\t\tconst currentBlockState = blockState;\n\t\t\tif (currentBlockState() === 'all-blocked' && action === 'block') {\n\t\t\t\ttoaster.warning({ description: 'All selected items are already blocked' });\n\t\t\t\treturn;\n\t\t\t} else if (currentBlockState() === 'all-unblocked' && action === 'unblock') {\n\t\t\t\ttoaster.warning({ description: 'All selected items are already unblocked' });\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Additional validation for token editing\n\t\tif (action === 'edit' && type === 'token') {\n\t\t\tconst tokenData = isToken(safeSelectedRows[0]) ? safeSelectedRows[0] : undefined;\n\t\t\tif (!tokenData?.token) {\n\t\t\t\ttoaster.error({ description: 'Invalid token data selected' });\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst config = actionConfig[action];\n\t\tconst isEdit = action === 'edit';\n\n\t\tif (isEdit) {\n\t\t\t// Component Dialog\n\t\t\tif (type === 'user') {\n\t\t\t\tmodalState.trigger(ModalEditForm as any, {\n\t\t\t\t\tisGivenData: true,\n\t\t\t\t\tusername: isUser(safeSelectedRows[0]) ? ((safeSelectedRows[0] as User).username ?? null) : null,\n\t\t\t\t\temail: safeSelectedRows[0].email,\n\t\t\t\t\trole: safeSelectedRows[0].role,\n\t\t\t\t\tuser_id: (safeSelectedRows[0] as User)._id,\n\t\t\t\t\ttitle: config.modalTitle(),\n\t\t\t\t\tbody: config.modalBody() // Pass body if ModalEditForm supports it\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmodalState.trigger(\n\t\t\t\t\tModalEditToken as any,\n\t\t\t\t\t{\n\t\t\t\t\t\ttoken: (safeSelectedRows[0] as Token).token,\n\t\t\t\t\t\temail: safeSelectedRows[0].email,\n\t\t\t\t\t\trole: safeSelectedRows[0].role,\n\t\t\t\t\t\tuser_id: (safeSelectedRows[0] as Token).user_id,\n\t\t\t\t\t\texpires: convertDateToExpiresFormat((safeSelectedRows[0] as Token).expires),\n\t\t\t\t\t\ttitle: config.modalTitle(),\n\t\t\t\t\t\tbody: config.modalBody()\n\t\t\t\t\t},\n\t\t\t\t\t(res: any) => {\n\t\t\t\t\t\tif (res && res.success) {\n\t\t\t\t\t\t\tonUpdate({\n\t\t\t\t\t\t\t\taction: 'refresh',\n\t\t\t\t\t\t\t\ttype: 'token',\n\t\t\t\t\t\t\t\tids: []\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\t// Confirm Dialog\n\t\t\tshowConfirm({\n\t\t\t\ttitle: config.modalTitle(),\n\t\t\t\tbody: config.modalBody(),\n\t\t\t\tonConfirm: async () => {\n\t\t\t\t\tawait executeBatchAction(action, config);\n\t\t\t\t\tmodalState.close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction toggleDropdown(e: MouseEvent) {\n\t\te.stopPropagation();\n\t\tif (isDisabled) return;\n\t\tisDropdownOpen = !isDropdownOpen;\n\t}\n\n\tfunction handleOptionClick(event: Event, action: ActionType) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tlistboxValue = action;\n\t\tisDropdownOpen = false;\n\t\thandleAction(action);\n\t}\n</script>\n\n<!-- Multi-button group -->\n<div class=\"relative flex items-center\" bind:this={dropdownRef}>\n\t<div\n\t\tclass=\"group/main relative flex items-center shadow-xl overflow-visible transition-all duration-200 {!isDisabled\n\t\t\t? 'active:scale-95 cursor-pointer'\n\t\t\t: ''} rounded-l-full rounded-r-md border border-white/20 {isDropdownOpen ? 'ring-2 ring-primary-500/50' : ''}\"\n\t\trole=\"group\"\n\t>\n\t\t<!-- Main Action Button -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonclick={() => handleAction(listboxValue)}\n\t\t\tdisabled={isDisabled || (listboxValue === 'delete' && isDeleteDisabled)}\n\t\t\tclass=\"h-[40px] min-w-[120px] font-bold transition-all duration-200\n\t\t\t\t{!isDisabled ? 'active:scale-95' : 'pointer-events-none opacity-50 grayscale'} \n\t\t\t\t{actionConfig[listboxValue].buttonClass} text-white\n\t\t\t\trounded-l-full rounded-r-none px-6 flex items-center justify-center gap-2 border-r border-white/20\"\n\t\t\taria-label=\"{listboxValue} selected items\"\n\t\t>\n\t\t\t<iconify-icon icon={actionConfig[listboxValue].iconValue} width=\"20\"></iconify-icon>\n\t\t\t<span class=\"uppercase tracking-wider\">{listboxValue}</span>\n\t\t</button>\n\n\t\t<!-- Dropdown Toggle -->\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonclick={toggleDropdown}\n\t\t\tdisabled={isDisabled}\n\t\t\tclass=\"h-[40px] w-[40px] transition-all duration-200 text-white flex items-center justify-center shadow-inner rounded-r-md\n\t\t\t\t{!isDisabled ? 'bg-surface-800 hover:bg-surface-700 active:scale-95 cursor-pointer' : 'bg-surface-800 opacity-50 pointer-events-none'}\"\n\t\t\taria-haspopup=\"menu\"\n\t\t\taria-expanded={isDropdownOpen}\n\t\t\taria-label=\"Toggle actions menu\"\n\t\t>\n\t\t\t<iconify-icon icon=\"ic:round-keyboard-arrow-down\" width=\"24\" class=\"transition-transform duration-200 {isDropdownOpen ? 'rotate-180' : ''}\"\n\t\t\t></iconify-icon>\n\t\t</button>\n\n\t\t<!-- Dropdown Menu -->\n\t\t{#if isDropdownOpen}\n\t\t\t<div\n\t\t\t\tclass=\"absolute right-0 top-full z-50 mt-2 w-56 overflow-hidden rounded-xl bg-surface-800 shadow-2xl ring-1 ring-black/20 backdrop-blur-md origin-top-right\"\n\t\t\t\trole=\"menu\"\n\t\t\t\taria-label=\"Available actions\"\n\t\t\t\ttransition:scale={{ duration: 150, easing: quintOut, start: 0.95, opacity: 0 }}\n\t\t\t>\n\t\t\t\t<ul class=\"flex flex-col py-1\">\n\t\t\t\t\t{#each filteredActions as action}\n\t\t\t\t\t\t{@const config = actionConfig[action]}\n\t\t\t\t\t\t<li role=\"none\" onmouseenter={() => (hoveredAction = action)} onmouseleave={() => (hoveredAction = null)}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tonclick={(e) => handleOptionClick(e, action)}\n\t\t\t\t\t\t\t\trole=\"menuitem\"\n\t\t\t\t\t\t\t\tclass=\"group/item relative flex w-full items-center gap-3 px-4 py-3 text-left text-white transition-all duration-200 hover:bg-white/5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<!-- Hover Gradient Indicator - Full Background -->\n\t\t\t\t\t\t\t\t<div class=\"absolute inset-0 {config.buttonClass} opacity-0 transition-opacity duration-200 group-hover/item:opacity-100\"></div>\n\n\t\t\t\t\t\t\t\t<!-- Icon -->\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"relative z-10 flex h-8 w-8 items-center justify-center rounded-full bg-surface-700/50 transition-transform group-hover/item:scale-110\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<iconify-icon icon={config.iconValue} width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<!-- Label -->\n\t\t\t\t\t\t\t\t<div class=\"relative z-10 flex-1\">\n\t\t\t\t\t\t\t\t\t<div class=\"font-semibold capitalize\">{action}</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<!-- Check Indicator or Chevron -->\n\t\t\t\t\t\t\t\t{#if hoveredAction === action}\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:chevron-right\" width=\"18\" class=\"relative z-10 text-white\"></iconify-icon>\n\t\t\t\t\t\t\t\t{:else if listboxValue === action}\n\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:check\" width=\"18\" class=\"relative z-10 text-primary-500\"></iconify-icon>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t{/each}\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n","<!-- \n@file src/routes/(app)/user/components/AdminArea.svelte\n@component \n**Admin area for managing users and tokens with efficient filtering and pagination.**\n\n### Features\n- Efficient filtering and pagination\n- Sorting by any column\n- Bulk actions for tokens\n- Copy to clipboard\n- \n-->\n\n<script lang=\"ts\">\n\t// Type guards for template and logic\n\tfunction isToken(row: User | Token): row is Token {\n\t\treturn 'token' in row && typeof row.token === 'string';\n\t}\n\tfunction isUser(row: User | Token): row is User {\n\t\treturn '_id' in row && typeof row._id === 'string';\n\t}\n\timport { debounce } from '@shared/utils/utils';\n\timport { untrack } from 'svelte';\n\timport { logger } from '@shared/utils/logger';\n\t// Stores\n\timport { avatarSrc } from '@shared/stores/store.svelte';\n\timport { globalLoadingStore, loadingOperations } from '@shared/stores/loadingStore.svelte';\n\n\t// Components\n\timport PermissionGuard from '@cms/components/PermissionGuard.svelte';\n\timport FloatingInput from '@cms/components/system/inputs/floatingInput.svelte';\n\timport Boolean from '@cms/components/system/table/Boolean.svelte';\n\timport Role from '@cms/components/system/table/Role.svelte';\n\timport TableFilter from '@cms/components/system/table/TableFilter.svelte';\n\timport TableIcons from '@cms/components/system/table/TableIcons.svelte';\n\timport TablePagination from '@cms/components/system/table/TablePagination.svelte';\n\timport ModalEditToken from './ModalEditToken.svelte';\n\timport Multibutton from './Multibutton.svelte';\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\t// Skeleton\n\timport { Avatar } from '@skeletonlabs/skeleton-svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\timport { toaster } from '@shared/stores/store.svelte';\n\t// Svelte-dnd-action\n\timport { PermissionAction, PermissionType } from '@shared/database/auth/types';\n\timport { dndzone } from 'svelte-dnd-action';\n\timport { flip } from 'svelte/animate';\n\n\t// Types\n\timport type { User, Token } from '@shared/database/auth/types';\n\n\ttype TableDataType = User | Token;\n\n\tinterface TableHeader {\n\t\tlabel: string;\n\t\tkey: keyof User | keyof Token;\n\t\tvisible: boolean;\n\t\tid: string;\n\t}\n\n\t// Props - Using API for scalability\n\tconst { currentUser = null, isMultiTenant = false, roles = [] } = $props();\n\n\tconst waitFilter = debounce(300);\n\tconst flipDurationMs = 300;\n\n\t// State for API-fetched data (replaces adminData usage for scalability)\n\tlet tableData: TableDataType[] = $state([]);\n\tlet totalItems = $state(0);\n\n\tasync function fetchData() {\n\t\tawait globalLoadingStore.withLoading(\n\t\t\tloadingOperations.dataFetch,\n\t\t\tasync () => {\n\t\t\t\tconst endpoint = showUserList ? '/api/admin/users' : '/api/admin/tokens';\n\t\t\t\t// eslint-disable-next-line svelte/prefer-svelte-reactivity\n\t\t\t\tconst params = new URLSearchParams();\n\t\t\t\tparams.set('page', String(currentPage));\n\t\t\t\tparams.set('limit', String(rowsPerPage));\n\t\t\t\tparams.set('sort', sorting.sortedBy || 'createdAt');\n\t\t\t\tif (sorting.isSorted !== 0) {\n\t\t\t\t\tparams.set('order', sorting.isSorted === 1 ? 'asc' : 'desc');\n\t\t\t\t}\n\t\t\t\tif (globalSearchValue) {\n\t\t\t\t\tparams.set('search', globalSearchValue);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch(`${endpoint}?${params.toString()}`);\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tconst errorData = await response.json();\n\t\t\t\t\t\tthrow new Error(errorData.message || 'Failed to fetch data');\n\t\t\t\t\t}\n\t\t\t\t\tconst result = await response.json();\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\ttableData = result.data;\n\t\t\t\t\t\ttotalItems = result.pagination.totalItems;\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Unknown error';\n\t\t\t\t\tlogger.error('AdminArea fetch error:', errorMessage);\n\t\t\t\t\ttoaster.error({ description: `Error fetching data: ${errorMessage}` });\n\t\t\t\t\ttableData = [];\n\t\t\t\t\ttotalItems = 0;\n\t\t\t\t}\n\t\t\t},\n\t\t\t'Fetching admin data'\n\t\t);\n\t}\n\n\t// Custom event handler for updates from Multibutton\n\tfunction handleBatchUpdate(data: { ids: string[]; action: string; type: 'user' | 'token' }) {\n\t\tconst { ids, action, type } = data;\n\n\t\tif (action === 'refresh') {\n\t\t\tfetchData();\n\t\t\treturn;\n\t\t}\n\n\t\t// Update the tableData instead of adminData for scalability\n\t\tif (tableData) {\n\t\t\tlet updated = false;\n\n\t\t\tif (action === 'delete') {\n\t\t\t\t// Remove deleted items from the table\n\t\t\t\tconst updatedData = tableData.filter((item: User | Token) => {\n\t\t\t\t\tif (type === 'user' && isUser(item)) return !ids.includes(item._id);\n\t\t\t\t\tif (type === 'token' && isToken(item)) return !ids.includes(item.token);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\n\t\t\t\tif (updatedData.length !== tableData.length) {\n\t\t\t\t\ttableData = updatedData;\n\t\t\t\t\tupdated = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Handle block/unblock actions\n\t\t\t\tconst updatedData = tableData.map((item: User | Token) => {\n\t\t\t\t\tlet shouldUpdate = false;\n\t\t\t\t\tif (type === 'user' && isUser(item) && ids.includes(item._id)) shouldUpdate = true;\n\t\t\t\t\tif (type === 'token' && isToken(item) && ids.includes(item.token)) shouldUpdate = true;\n\n\t\t\t\t\tif (shouldUpdate) {\n\t\t\t\t\t\tupdated = true;\n\t\t\t\t\t\tif (action === 'block') {\n\t\t\t\t\t\t\treturn { ...item, blocked: true };\n\t\t\t\t\t\t} else if (action === 'unblock') {\n\t\t\t\t\t\t\treturn { ...item, blocked: false };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn item;\n\t\t\t\t});\n\n\t\t\t\tif (updated) {\n\t\t\t\t\ttableData = updatedData;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Clear selection after any action\n\t\t\tif (updated) {\n\t\t\t\tselectedMap = {};\n\t\t\t\tselectAll = false;\n\t\t\t}\n\t\t}\n\t} // Table header definitions\n\tconst tableHeadersUser = [\n\t\t{ label: m.adminarea_blocked(), key: 'blocked' },\n\t\t{ label: m.form_avatar(), key: 'avatar' },\n\t\t{ label: m.email(), key: 'email' },\n\t\t{ label: m.username(), key: 'username' },\n\t\t{ label: m.role(), key: 'role' },\n\t\t{ label: 'Tenant ID', key: 'tenantId' },\n\t\t{ label: m.adminarea_user_id(), key: '_id' },\n\t\t{ label: m.adminarea_activesession(), key: 'activeSessions' },\n\t\t{ label: m.adminarea_lastaccess(), key: 'lastAccess' },\n\t\t{ label: m.adminarea_createat(), key: 'createdAt' },\n\t\t{ label: m.adminarea_updatedat(), key: 'updatedAt' }\n\t] as const;\n\n\tconst tableHeaderToken = [\n\t\t{ label: m.adminarea_blocked(), key: 'blocked' },\n\t\t{ label: m.email(), key: 'email' },\n\t\t{ label: m.role(), key: 'role' },\n\t\t{ label: 'Tenant ID', key: 'tenantId' },\n\t\t{ label: m.adminarea_token(), key: 'token' },\n\t\t{ label: m.adminarea_expiresin(), key: 'expires' },\n\t\t{ label: m.adminarea_createat(), key: 'createdAt' },\n\t\t{ label: m.adminarea_updatedat(), key: 'updatedAt' }\n\t] as const;\n\n\t// Core state with proper initialization\n\tlet showUserList = $state(true);\n\tlet showUsertoken = $state(false);\n\tlet showExpiredTokens = $state(false);\n\tlet globalSearchValue = $state('');\n\tlet searchShow = $state(false);\n\tlet filterShow = $state(false);\n\tlet columnShow = $state(false);\n\tlet selectAll = $state(false);\n\tlet selectedMap: Record<number, boolean> = $state({});\n\n\t// Derived rows to display and selection will be defined below\n\tlet density = $state(\n\t\t(() => {\n\t\t\tconst settings = localStorage.getItem('userPaginationSettings');\n\t\t\treturn settings ? (JSON.parse(settings).density ?? 'normal') : 'normal';\n\t\t})()\n\t);\n\tlet selectAllColumns = $state(true);\n\t// pagesCount becomes derived below\n\tlet currentPage = $state(1);\n\tlet rowsPerPage = $state(10);\n\tlet filters = $state({});\n\tlet sorting = $state({ sortedBy: '', isSorted: 0 });\n\n\t// Initialize displayTableHeaders with a safe default\n\tlet displayTableHeaders: TableHeader[] = $state([]);\n\n\t$effect(() => {\n\t\t// Update displayTableHeaders when view changes\n\t\tconst baseHeaders = showUserList ? tableHeadersUser : tableHeaderToken;\n\t\tconst relevantHeaders = isMultiTenant ? baseHeaders : baseHeaders.filter((h) => h.key !== 'tenantId');\n\t\tdisplayTableHeaders = relevantHeaders.map((header) => ({\n\t\t\tlabel: header.label,\n\t\t\tkey: header.key,\n\t\t\tvisible: true,\n\t\t\tid: `header-${Math.random().toString(36).substring(2, 15)}-${Date.now().toString(36)}`\n\t\t}));\n\t});\n\n\t// Reactive effect to fetch data when dependencies change\n\t$effect(() => {\n\t\t// Rerun when any of these reactive variables change\n\t\tvoid showUserList;\n\t\tvoid showUsertoken;\n\t\tvoid currentPage;\n\t\tvoid rowsPerPage;\n\t\tvoid sorting;\n\t\tvoid globalSearchValue;\n\t\tvoid currentUser; // Watch for changes to current user (triggers refresh after user update)\n\n\t\tuntrack(() => {\n\t\t\tfetchData();\n\t\t});\n\t});\n\n\t// Function to edit a specific token\n\tfunction editToken(tokenId: Token) {\n\t\tconst tokenData = tokenId;\n\t\tif (!tokenData) return;\n\n\t\tmodalState.trigger(\n\t\t\tModalEditToken as any,\n\t\t\t{\n\t\t\t\ttoken: tokenData.token,\n\t\t\t\temail: tokenData.email,\n\t\t\t\trole: tokenData.role,\n\t\t\t\texpires: convertDateToExpiresFormat(tokenData.expires),\n\t\t\t\ttitle: m.multibuttontoken_modaltitle(),\n\t\t\t\tbody: m.multibuttontoken_modalbody(),\n\t\t\t\troles // Pass roles explicitly\n\t\t\t},\n\t\t\t(result: any) => {\n\t\t\t\tif (result && result.success) {\n\t\t\t\t\tfetchData();\n\t\t\t\t} else if (result?.success === false) {\n\t\t\t\t\ttoaster.error({ description: result.error || 'Failed to update token' });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t// Helper function to convert Date to expires format expected by ModalEditToken\n\tfunction convertDateToExpiresFormat(expiresDate: Date | string | null): string {\n\t\tif (!expiresDate) return '2 days'; // Default\n\n\t\tconst now = new Date();\n\t\tconst expires = new Date(expiresDate);\n\t\tconst diffMs = expires.getTime() - now.getTime();\n\t\tconst diffHours = Math.ceil(diffMs / (1000 * 60 * 60));\n\t\tconst diffDays = Math.ceil(diffHours / 24);\n\n\t\t// Match the available options in ModalEditToken\n\t\tif (diffHours <= 2) return '2 hrs';\n\t\tif (diffHours <= 12) return '12 hrs';\n\t\tif (diffDays <= 2) return '2 days';\n\t\tif (diffDays <= 7) return '1 week';\n\t\tif (diffDays <= 14) return '2 weeks';\n\t\tif (diffDays <= 30) return '1 month';\n\n\t\treturn '1 month'; // Max available option\n\t}\n\n\t// Normalize media URLs for table display to avoid requesting bare /files\n\tfunction normalizeMediaUrl(url: string | null | undefined): string {\n\t\tif (!url) return '/Default_User.svg';\n\t\ttry {\n\t\t\tif (url.startsWith('data:') || /^https?:\\/\\//i.test(url)) return url;\n\n\t\t\t// Allow direct svg in static\n\t\t\tif (/^\\/?[^\\s?]+\\.svg$/i.test(url)) return url.startsWith('/') ? url : `/${url}`;\n\n\t\t\t// Normalize path\n\t\t\t// 1. Remove leading slashes\n\t\t\tlet clean = url.replace(/^\\/+/, '');\n\t\t\t// 2. Remove prefixes\n\t\t\tclean = clean.replace(/^mediaFolder\\//, '').replace(/^files\\//, '');\n\t\t\t// 3. Remove leading slashes again just in case\n\t\t\tclean = clean.replace(/^\\/+/, '');\n\n\t\t\tif (clean === 'files' || clean === '') return '/Default_User.svg';\n\n\t\t\t// Add timestamp for cache busting\n\t\t\treturn `/files/${clean}?t=${Date.now()}`;\n\t\t} catch {\n\t\t\treturn '/Default_User.svg';\n\t\t}\n\t}\n\n\t// Helper function to calculate remaining time until expiration for display in table\n\tfunction getRemainingTime(expiresDate: Date | string | null): string {\n\t\tif (!expiresDate) return 'Never';\n\n\t\tconst now = new Date();\n\t\tconst expires = new Date(expiresDate);\n\t\tconst diffMs = expires.getTime() - now.getTime();\n\n\t\t// If expired, return 'Expired'\n\t\tif (diffMs <= 0) return 'Expired';\n\n\t\tconst diffMinutes = Math.floor(diffMs / (1000 * 60));\n\t\tconst diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n\t\tconst diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n\t\tif (diffDays > 0) {\n\t\t\tconst remainingHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n\t\t\treturn remainingHours > 0 ? `${diffDays}d ${remainingHours}h` : `${diffDays}d`;\n\t\t} else if (diffHours > 0) {\n\t\t\tconst remainingMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n\t\t\treturn remainingMinutes > 0 ? `${diffHours}h ${remainingMinutes}m` : `${diffHours}h`;\n\t\t} else {\n\t\t\treturn `${diffMinutes}m`;\n\t\t}\n\t}\n\n\t// Safe date formatter for unknown values coming from API\n\tfunction formatDate(value: unknown): string {\n\t\tif (value === null || value === undefined || value === '') return '-';\n\t\ttry {\n\t\t\tconst d = value instanceof Date ? value : new Date(String(value));\n\t\t\tif (isNaN(d.getTime())) return '-';\n\t\t\treturn d.toLocaleString();\n\t\t} catch {\n\t\t\treturn '-';\n\t\t}\n\t}\n\n\t// Toggle user blocked status - always show confirmation modal (like Multibutton)\n\tasync function toggleUserBlocked(user: User) {\n\t\tif (!user._id) return;\n\n\t\t// Prevent admins from blocking themselves\n\t\tif (currentUser && user._id === currentUser._id) {\n\t\t\ttoaster.warning({ description: 'You cannot block your own account' });\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = user.blocked ? 'unblock' : 'block';\n\t\tconst actionPastTense = user.blocked ? 'unblocked' : 'blocked';\n\n\t\t// Always show confirmation modal (same logic as Multibutton) with enhanced styling using theme colors\n\t\tconst actionColor = user.blocked ? 'text-success-500' : 'text-error-500';\n\t\tconst actionWord = user.blocked ? 'Unblock' : 'Block';\n\n\t\tconst modalTitle = `Please Confirm User <span class=\"${actionColor} font-bold\">${actionWord}</span>`;\n\t\tconst modalBody = user.blocked\n\t\t\t? `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will allow them to access the system again.`\n\t\t\t: `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> user <span class=\"text-tertiary-500 font-medium\">${user.email}</span>? This will prevent them from accessing the system.`;\n\n\t\tshowConfirm({\n\t\t\ttitle: modalTitle,\n\t\t\tbody: modalBody,\n\t\t\tonConfirm: async () => {\n\t\t\t\tawait performBlockAction(user, action, actionPastTense);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function performBlockAction(user: User, action: string, actionPastTense: string) {\n\t\ttry {\n\t\t\tconst response = await fetch('/api/user/batch', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tuserIds: [user._id],\n\t\t\t\t\taction: action\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (result.success) {\n\t\t\t\t// Update the user in tableData to reflect changes immediately\n\t\t\t\tconst updatedData = tableData.map((item: User | Token) =>\n\t\t\t\t\t'_id' in item && (item as User)._id === user._id ? { ...item, blocked: !item.blocked } : item\n\t\t\t\t);\n\t\t\t\ttableData = updatedData;\n\t\t\t\ttoaster.success({ description: `User ${actionPastTense} successfully` });\n\t\t\t} else {\n\t\t\t\tthrow new Error(result.message || `Failed to ${action} user`);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Unknown error';\n\t\t\ttoaster.error({ description: `Failed to ${action} user: ${errorMessage}` });\n\t\t}\n\t}\n\n\t// Toggle token blocked status - similar to user blocking\n\tasync function toggleTokenBlocked(token: Token) {\n\t\tif (!token.token) return;\n\n\t\tconst action = token.blocked ? 'unblock' : 'block';\n\t\tconst actionPastTense = token.blocked ? 'unblocked' : 'blocked';\n\n\t\t// Show confirmation modal with enhanced styling using theme colors\n\t\tconst actionColor = token.blocked ? 'text-success-500' : 'text-error-500';\n\t\tconst actionWord = token.blocked ? 'Unblock' : 'Block';\n\n\t\tconst modalTitle = `Please Confirm Token <span class=\"${actionColor} font-bold\">${actionWord}</span>`;\n\t\tconst modalBody = token.blocked\n\t\t\t? `Are you sure you want to <span class=\"text-success-500 font-semibold\">unblock</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will allow the token to be used again.`\n\t\t\t: `Are you sure you want to <span class=\"text-error-500 font-semibold\">block</span> token for <span class=\"text-tertiary-500 font-medium\">${token.email}</span>? This will prevent the token from being used.`;\n\n\t\tshowConfirm({\n\t\t\ttitle: modalTitle,\n\t\t\tbody: modalBody,\n\t\t\tonConfirm: async () => {\n\t\t\t\tawait performTokenBlockAction(token, action, actionPastTense);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function performTokenBlockAction(token: Token, action: string, actionPastTense: string) {\n\t\ttry {\n\t\t\tconst response = await fetch('/api/token/batch', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\ttokenIds: [token.token],\n\t\t\t\t\taction: action\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (result.success) {\n\t\t\t\t// Update the token in tableData to reflect changes immediately\n\t\t\t\tconst updatedData = tableData.map((item: User | Token) =>\n\t\t\t\t\t'token' in item && (item as Token).token === token.token ? { ...item, blocked: !item.blocked } : item\n\t\t\t\t);\n\t\t\t\ttableData = updatedData;\n\t\t\t\ttoaster.success({ description: `Token ${actionPastTense} successfully` });\n\t\t\t} else {\n\t\t\t\tthrow new Error(result.message || `Failed to ${action} token`);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Unknown error';\n\t\t\ttoaster.error({ description: `Failed to ${action} token: ${errorMessage}` });\n\t\t}\n\t}\n\n\tfunction handleDndConsider(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t}\n\n\tfunction handleDndFinalize(event: CustomEvent) {\n\t\tdisplayTableHeaders = event.detail.items;\n\t\tlocalStorage.setItem('userPaginationSettings', JSON.stringify({ density, displayTableHeaders }));\n\t}\n\n\tfunction modalTokenUser() {\n\t\tmodalState.trigger(\n\t\t\tModalEditToken as any,\n\t\t\t{\n\t\t\t\ttitle: m.multibuttontoken_modaltitle(),\n\t\t\t\tbody: m.multibuttontoken_modalbody(),\n\t\t\t\troles, // Pass available roles\n\t\t\t\tuser: currentUser // Pass current user context if needed\n\t\t\t},\n\t\t\t(result: any) => {\n\t\t\t\t// Refresh data if token was created\n\t\t\t\tif (result && result.success) {\n\t\t\t\t\tfetchData();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t// Toggle views\n\tfunction toggleUserList() {\n\t\tshowUserList = !showUserList;\n\t\tif (showUsertoken) showUsertoken = false;\n\t}\n\n\tfunction toggleUserToken() {\n\t\tshowUsertoken = !showUsertoken;\n\t\tshowUserList = false;\n\t}\n\n\t// --- SERVER-SIDE PAGINATION: API handles filtering, sorting, pagination ---\n\t// tableData is now the current page from API, not all data\n\t// totalItems is the total count from API\n\n\tconst pagesCount = $derived.by(() => Math.ceil(totalItems / rowsPerPage) || 1);\n\n\t// Derive selected rows from selectedMap; ensure type compatibility by mapping to UserData | TokenData\n\tlet selectedRows: TableDataType[] = $derived.by(() =>\n\t\tObject.entries(selectedMap)\n\t\t\t.filter(([, isSelected]) => isSelected)\n\t\t\t.map(([index]) => tableData[parseInt(index)])\n\t\t\t.filter((item): item is User | Token => item !== undefined && item !== null)\n\t);\n\n\t// Reset selection and page when the data source changes\n\t$effect(() => {\n\t\tvoid tableData; // track dependency\n\t\tuntrack(() => {\n\t\t\tselectedMap = {};\n\t\t\tselectAll = false;\n\t\t\tcurrentPage = 1;\n\t\t});\n\t});\n\n\t// Keep current page in bounds when page count shrinks\n\t$effect(() => {\n\t\tif (currentPage > pagesCount) {\n\t\t\tcurrentPage = pagesCount;\n\t\t}\n\t});\n\n\tfunction handleCheckboxChange() {\n\t\tconst allColumnsVisible = displayTableHeaders.every((header) => header.visible);\n\t\tdisplayTableHeaders = displayTableHeaders.map((header) => ({\n\t\t\t...header,\n\t\t\tvisible: !allColumnsVisible\n\t\t}));\n\t\tselectAllColumns = !allColumnsVisible;\n\t}\n\n\tfunction handleInputChange(value: string, headerKey: string) {\n\t\tif (value) {\n\t\t\tconst newFilters: Record<string, string | undefined> = { ...filters, [headerKey]: value };\n\t\t\twaitFilter(() => {\n\t\t\t\tfilters = newFilters;\n\t\t\t});\n\t\t} else {\n\t\t\tconst newFilters: Record<string, string | undefined> = { ...filters };\n\t\t\tdelete newFilters[headerKey];\n\t\t\tfilters = newFilters;\n\t\t}\n\t}\n</script>\n\n<div class=\"flex flex-col\">\n\t<p class=\"h2 mb-2 text-center text-3xl font-bold dark:text-white\">{m.adminarea_adminarea()}</p>\n\n\t<div class=\"flex flex-col flex-wrap items-center justify-evenly gap-2 sm:flex-row xl:justify-between\">\n\t\t<button onclick={modalTokenUser} aria-label={m.adminarea_emailtoken()} class=\"gradient-primary btn w-full text-white sm:max-w-xs\">\n\t\t\t<iconify-icon icon=\"material-symbols:mail\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t<span class=\"whitespace-normal wrap-break-word\">{m.adminarea_emailtoken()}</span>\n\t\t</button>\n\n\t\t<PermissionGuard\n\t\t\tconfig={{\n\t\t\t\tcontextId: 'user:manage',\n\t\t\t\tname: 'Manage User Tokens',\n\t\t\t\tdescription: 'Allows management of user tokens in the admin area.',\n\t\t\t\taction: PermissionAction.MANAGE,\n\t\t\t\tcontextType: PermissionType.USER\n\t\t\t}}\n\t\t>\n\t\t\t<button\n\t\t\t\tonclick={toggleUserToken}\n\t\t\t\taria-label={showUsertoken ? m.adminarea_hideusertoken() : m.adminarea_showtoken()}\n\t\t\t\tclass=\"gradient-secondary btn w-full text-white sm:max-w-xs\"\n\t\t\t>\n\t\t\t\t<iconify-icon icon=\"material-symbols:key-outline\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t<span>{showUsertoken ? m.adminarea_hideusertoken() : m.adminarea_showtoken()}</span>\n\t\t\t</button>\n\n\t\t\t{#if showUsertoken && !showUserList && tableData}\n\t\t\t\t{@const now = new Date()}\n\t\t\t\t{@const expiredTokens = tableData.filter(\n\t\t\t\t\t(item): item is Token => isToken(item) && item.expires != null && new Date(String(item.expires)) < now\n\t\t\t\t)}\n\t\t\t\t{#if expiredTokens.length > 0}\n\t\t\t\t\t<button\n\t\t\t\t\t\tonclick={() => (showExpiredTokens = !showExpiredTokens)}\n\t\t\t\t\t\taria-label={showExpiredTokens ? 'Hide Expired Tokens' : 'Show Expired Tokens'}\n\t\t\t\t\t\tclass=\"gradient-secondary btn w-full text-white sm:max-w-xs\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"material-symbols:schedule\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t\t\t<span>{showExpiredTokens ? 'Hide Expired' : 'Show Expired'}</span>\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</PermissionGuard>\n\n\t\t<button\n\t\t\tonclick={toggleUserList}\n\t\t\taria-label={showUserList ? m.adminarea_hideuserlist() : m.adminarea_showuserlist()}\n\t\t\tclass=\"gradient-tertiary btn w-full text-white sm:max-w-xs\"\n\t\t>\n\t\t\t<iconify-icon icon=\"mdi:account-circle\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t<span>{showUserList ? m.adminarea_hideuserlist() : m.adminarea_showuserlist()}</span>\n\t\t</button>\n\t</div>\n\n\t{#if showUserList || showUsertoken}\n\t\t<div class=\"my-4 flex flex-wrap items-center justify-between gap-1\">\n\t\t\t<h2 class=\"order-1 text-xl font-bold text-tertiary-500 dark:text-primary-500\">\n\t\t\t\t{#if showUserList}{m.adminarea_userlist()}{:else if showUsertoken}{m.adminarea_listtoken()}{/if}\n\t\t\t</h2>\n\n\t\t\t<div class=\"order-3 sm:order-2\">\n\t\t\t\t<TableFilter bind:globalSearchValue bind:searchShow bind:filterShow bind:columnShow bind:density />\n\t\t\t</div>\n\n\t\t\t<div class=\"order-2 flex items-center justify-center sm:order-3\">\n\t\t\t\t<Multibutton {selectedRows} type={showUserList ? 'user' : 'token'} totalUsers={totalItems} {currentUser} onUpdate={handleBatchUpdate} />\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if tableData && tableData.length > 0}\n\t\t\t{#if columnShow}\n\t\t\t\t<div class=\"rounded-b-0 flex flex-col justify-center rounded-t-md border-b bg-surface-300 text-center dark:bg-surface-700\">\n\t\t\t\t\t<div class=\"text-white dark:text-primary-500\">{m.entrylist_dnd()}</div>\n\t\t\t\t\t<div class=\"my-2 flex w-full items-center justify-center gap-1\">\n\t\t\t\t\t\t<label class=\"mr-2\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" bind:checked={selectAllColumns} onclick={handleCheckboxChange} />\n\t\t\t\t\t\t\t{m.entrylist_all()}\n\t\t\t\t\t\t</label>\n\n\t\t\t\t\t\t<section\n\t\t\t\t\t\t\tuse:dndzone={{ items: displayTableHeaders, flipDurationMs }}\n\t\t\t\t\t\t\tonconsider={handleDndConsider}\n\t\t\t\t\t\t\tonfinalize={handleDndFinalize}\n\t\t\t\t\t\t\tclass=\"flex flex-wrap justify-center gap-1 rounded-md p-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#each displayTableHeaders as header: TableHeader (header.id)}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"chip {header.visible\n\t\t\t\t\t\t\t\t\t\t? 'preset-filled-secondary-500'\n\t\t\t\t\t\t\t\t\t\t: 'preset-ghost-secondary-500'} w-100 mr-2 flex items-center justify-center\"\n\t\t\t\t\t\t\t\t\tanimate:flip={{ duration: flipDurationMs }}\n\t\t\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\t\t\tdisplayTableHeaders = displayTableHeaders.map((h) => (h.id === header.id ? { ...h, visible: !h.visible } : h));\n\t\t\t\t\t\t\t\t\t\tselectAllColumns = displayTableHeaders.every((h) => h.visible);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if header.visible}\n\t\t\t\t\t\t\t\t\t\t<span><iconify-icon icon=\"fa:check\"></iconify-icon></span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<span class=\"ml-2 capitalize\">{header.label}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"table-container max-h-[calc(100vh-120px)] overflow-auto\">\n\t\t\t\t<table class=\"table table-interactive {density === 'compact' ? 'table-compact' : density === 'normal' ? '' : 'table-comfortable'}\">\n\t\t\t\t\t<thead\n\t\t\t\t\t\tclass=\"divide-x divide-surface-200/50 dark:divide-surface-50 text-surface-500 dark:text-surface-300 bg-secondary-100 dark:bg-surface-800/50\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if filterShow}\n\t\t\t\t\t\t\t<tr class=\"divide-x divide-surface-200/50 dark:divide-surface-700/50\">\n\t\t\t\t\t\t\t\t<th>\n\t\t\t\t\t\t\t\t\t{#if Object.keys(filters).length > 0}\n\t\t\t\t\t\t\t\t\t\t<button onclick={() => (filters = {})} aria-label=\"Clear All Filters\" class=\"preset-outline btn-icon\">\n\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"material-symbols:close\" width=\"24\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</th>\n\n\t\t\t\t\t\t\t\t{#each displayTableHeaders.filter((header) => header.visible) as header (header.id)}\n\t\t\t\t\t\t\t\t\t<th>\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t<FloatingInput\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\t\ticon=\"material-symbols:search-rounded\"\n\t\t\t\t\t\t\t\t\t\t\t\tlabel={m.entrylist_filter()}\n\t\t\t\t\t\t\t\t\t\t\t\tname={header.key}\n\t\t\t\t\t\t\t\t\t\t\t\tonInput={(value) => handleInputChange(value, header.key)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\tclass=\"divide-x divide-surface-300 dark:divide-surface-50 border-b border-surface-300 dark:border-surface-50 font-semibold tracking-wide uppercase text-xs\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TableIcons\n\t\t\t\t\t\t\t\tcellClass=\"w-10 text-center\"\n\t\t\t\t\t\t\t\tchecked={selectAll}\n\t\t\t\t\t\t\t\tonCheck={(checked: boolean) => {\n\t\t\t\t\t\t\t\t\tselectAll = checked;\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < tableData.length; i++) {\n\t\t\t\t\t\t\t\t\t\tselectedMap[i] = checked;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t{#each displayTableHeaders.filter((header) => header.visible) as header (header.id)}\n\t\t\t\t\t\t\t\t<th\n\t\t\t\t\t\t\t\t\tclass=\"cursor-pointer text-tertiary-500 dark:text-primary-500 hover:bg-surface-100/50 dark:hover:bg-surface-800/50 transition-colors\"\n\t\t\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\t\t\tsorting = {\n\t\t\t\t\t\t\t\t\t\t\tsortedBy: header.key,\n\t\t\t\t\t\t\t\t\t\t\tisSorted: sorting.sortedBy === header.key ? (sorting.isSorted === 1 ? -1 : sorting.isSorted === -1 ? 0 : 1) : 1\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center gap-1\">\n\t\t\t\t\t\t\t\t\t\t{header.label}\n\t\t\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\t\t\ticon=\"material-symbols:arrow-upward-rounded\"\n\t\t\t\t\t\t\t\t\t\t\twidth=\"18\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"origin-center duration-300 ease-in-out\"\n\t\t\t\t\t\t\t\t\t\t\tclass:up={sorting.isSorted === 1 && sorting.sortedBy === header.key}\n\t\t\t\t\t\t\t\t\t\t\tclass:invisible={sorting.isSorted === 0 || sorting.sortedBy !== header.key}\n\t\t\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\n\t\t\t\t\t<tbody class=\"divide-y divide-surface-200/30 dark:divide-surface-700/30\">\n\t\t\t\t\t\t{#each tableData as row, index (isUser(row) ? row._id : isToken(row) ? row.token : index)}\n\t\t\t\t\t\t\t{@const expiresVal: string | Date | null = isToken(row) ? row.expires : null}\n\t\t\t\t\t\t\t{@const isExpired = showUsertoken && expiresVal && new Date(expiresVal) < new Date()}\n\t\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\t\tclass=\"divide-x divide-surface-200/50 dark:divide-surface-50 {isExpired\n\t\t\t\t\t\t\t\t\t? 'bg-error-50 opacity-60 dark:bg-error-900/20'\n\t\t\t\t\t\t\t\t\t: ''} {showUsertoken ? 'cursor-pointer hover:bg-surface-100 dark:hover:bg-surface-800' : ''}\"\n\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t// Only handle click if it's on a token row and not on the checkbox\n\t\t\t\t\t\t\t\t\tif (showUsertoken && !(event.target as HTMLElement)?.closest('td:first-child')) {\n\t\t\t\t\t\t\t\t\t\tif (isToken(row)) editToken(row);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TableIcons\n\t\t\t\t\t\t\t\t\tchecked={selectedMap[index] ?? false}\n\t\t\t\t\t\t\t\t\tonCheck={(checked: boolean) => {\n\t\t\t\t\t\t\t\t\t\tselectedMap[index] = checked;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{#each displayTableHeaders.filter((header) => header.visible) as header (header.id)}\n\t\t\t\t\t\t\t\t\t<td class=\"text-center\">\n\t\t\t\t\t\t\t\t\t\t{#if header.key === 'blocked'}\n\t\t\t\t\t\t\t\t\t\t\t{#if showUserList}\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={() => isUser(row) && toggleUserBlocked(row)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn-sm cursor-pointer rounded-md p-1 transition-all duration-200 hover:scale-105 hover:bg-surface-200 hover:shadow-md dark:hover:bg-surface-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={row.blocked ? 'Click to unblock user' : 'Click to block user'}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={row.blocked ? 'Click to unblock user' : 'Click to block user'}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Boolean value={!!row[header.key]} />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isToken(row)) toggleTokenBlocked(row);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn-sm cursor-pointer rounded-md p-1 transition-all duration-200 hover:scale-105 hover:bg-surface-200 hover:shadow-md dark:hover:bg-surface-600\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={row.blocked ? 'Click to unblock token' : 'Click to block token'}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={row.blocked ? 'Click to unblock token' : 'Click to block token'}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Boolean value={!!row[header.key]} />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{:else if showUserList && header.key === 'avatar'}\n\t\t\t\t\t\t\t\t\t\t\t<Avatar class=\"size-10 overflow-hidden rounded-full border border-surface-200/50 dark:text-surface-50/50\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Avatar.Image\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={currentUser && isUser(row) && row._id === currentUser._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? normalizeMediaUrl(avatarSrc.value)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: isUser(row) && header.key === 'avatar'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? normalizeMediaUrl(row.avatar)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: '/Default_User.svg'}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-full w-full object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t<Avatar.Fallback>User</Avatar.Fallback>\n\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'role'}\n\t\t\t\t\t\t\t\t\t\t\t<Role\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={isUser(row) && header.key === 'role' ? row.role : isToken(row) && header.key === 'role' ? (row.role ?? '') : ''}\n\t\t\t\t\t\t\t\t\t\t\t\t{roles}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === '_id'}\n\t\t\t\t\t\t\t\t\t\t\t<!-- User ID with clipboard functionality -->\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-mono text-sm\">{isUser(row) ? row._id : isToken(row) ? row._id : '-'}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"preset-ghost btn-icon btn-icon-sm hover:preset-filled-tertiary-500 hover:dark:preset-filled-primary-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Copy User ID\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Copy User ID to clipboard\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst val = String(isUser(row) ? row._id : isToken(row) ? row._id : '');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.clipboard\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.writeText(val)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.success({ description: 'User ID copied to clipboard' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.error({ description: 'Failed to copy' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"oui:copy-clipboard\" class=\"\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'token'}\n\t\t\t\t\t\t\t\t\t\t\t<!-- Token with clipboard functionality -->\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"max-w-[200px] truncate font-mono text-sm\">{isToken(row) && header.key === 'token' ? row.token : '-'}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"preset-ghost btn-icon btn-icon-sm hover:preset-filled-tertiary-500 hover:dark:preset-filled-primary-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Copy Token\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Copy Token to clipboard\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonclick={(event) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst val = isToken(row) && header.key === 'token' ? row.token : '';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.clipboard\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.writeText(val)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.success({ description: 'Token copied to clipboard' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoaster.error({ description: 'Failed to copy' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"oui:copy-clipboard\" class=\"\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if ['createdAt', 'updatedAt', 'lastAccess', 'expires'].includes(header.key)}\n\t\t\t\t\t\t\t\t\t\t\t{@const dateKey = header.key as 'createdAt' | 'updatedAt' | 'lastAccess' | 'expires'}\n\t\t\t\t\t\t\t\t\t\t\t{@const dateValue = isUser(row) ? row[dateKey as keyof User] : isToken(row) ? row[dateKey as keyof Token] : undefined}\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(dateValue)}\n\t\t\t\t\t\t\t\t\t\t{:else if header.key === 'expires'}\n\t\t\t\t\t\t\t\t\t\t\t{#if isToken(row) && header.key === 'expires' && row.expires}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const expiresVal = row.expires as string | Date | null}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const isTokenExpired =\n\t\t\t\t\t\t\t\t\t\t\t\t\texpiresVal !== null &&\n\t\t\t\t\t\t\t\t\t\t\t\t\texpiresVal !== undefined &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t(expiresVal instanceof Date ? expiresVal : new Date(String(expiresVal))) < new Date()}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const remainingTime = getRemainingTime(expiresVal)}\n\t\t\t\t\t\t\t\t\t\t\t\t<span class={isTokenExpired ? 'font-semibold text-error-500' : ''}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{remainingTime}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if isTokenExpired}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<iconify-icon icon=\"material-symbols:warning\" class=\"ml-1 text-error-500\" width=\"16\"></iconify-icon>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t-\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t{@const displayValue = isUser(row)\n\t\t\t\t\t\t\t\t\t\t\t\t? String(row[header.key as keyof User] ?? '-')\n\t\t\t\t\t\t\t\t\t\t\t\t: isToken(row)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? String(row[header.key as keyof Token] ?? '-')\n\t\t\t\t\t\t\t\t\t\t\t\t\t: '-'}\n\t\t\t\t\t\t\t\t\t\t\t<!-- eslint-disable-next-line svelte/no-at-html-tags -->\n\t\t\t\t\t\t\t\t\t\t\t{@html displayValue}\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\n\t\t\t<!-- Pagination  -->\n\t\t\t<div class=\"mt-2 flex flex-col items-center justify-center px-2 md:flex-row md:justify-between md:p-4\">\n\t\t\t\t<TablePagination\n\t\t\t\t\tbind:currentPage\n\t\t\t\t\tbind:rowsPerPage\n\t\t\t\t\t{pagesCount}\n\t\t\t\t\t{totalItems}\n\t\t\t\t\trowsPerPageOptions={[2, 10, 25, 50, 100, 500]}\n\t\t\t\t\tonUpdatePage={(page: number) => {\n\t\t\t\t\t\tcurrentPage = page;\n\t\t\t\t\t}}\n\t\t\t\t\tonUpdateRowsPerPage={(rows: number) => {\n\t\t\t\t\t\trowsPerPage = rows;\n\t\t\t\t\t\tcurrentPage = 1;\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"preset-ghost-error-500 btn text-center font-bold\">\n\t\t\t\t{#if showUserList}{m.adminarea_nouser()}{:else if showUsertoken}{m.adminarea_notoken()}{/if}\n\t\t\t</div>\n\t\t{/if}\n\t{/if}\n</div>\n","<!-- \n@file src/routes/(app)/user/components/ModalEditAvatar.svelte\n@component\n**Modal for editing user avatar thumbnail image**\n\nEfficiently handles avatar uploads with validation, deletion, and real-time preview. Optimized for performance and accessibility.\n\n@props\n- `parent` {ModalComponent['props']} - Parent modal properties including `regionFooter`, `onClose`, and `buttonPositive`\n- `avatarSrc` {string} - Current avatar source from store (default: '/Default_User.svg')\n-->\n\n<script lang=\"ts\">\n\timport { invalidateAll } from '$app/navigation';\n\timport { logger } from '@shared/utils/logger';\n\timport axios from 'axios';\n\n\t// Stores\n\timport { avatarSrc } from '@shared/stores/store.svelte';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Skeleton\n\timport { Avatar, FileUpload } from '@skeletonlabs/skeleton-svelte';\n\timport { toaster } from '@shared/stores/store.svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\n\tlet files = $state<File[]>([]);\n\tlet isUploading = $state(false);\n\tlet uploadProgress = $state(0);\n\tlet previewUrl = $state<string | null>(null); // Local preview URL, separate from global store\n\tlet imageLoadError = $state(false); // Track if current avatar failed to load\n\n\t// Valibot validation schema\n\timport { object, instance, check, pipe, parse, type InferInput, type ValiError } from 'valibot';\n\n\tinterface Props {\n\t\t// Props\n\t\tisGivenData?: boolean; // Unused but kept for interface compat\n\t\tparent?: any; // Loose type for now\n\t}\n\n\tconst {}: Props = $props();\n\n\t// ... (rest of code) ...\n\n\t// Computed value for avatar display with fallback\n\tconst displayAvatar = $derived.by(() => {\n\t\tif (previewUrl) return previewUrl;\n\t\tif (imageLoadError) return '/Default_User.svg';\n\t\tlet src = avatarSrc.value || '/Default_User.svg';\n\n\t\tif (src === '/Default_User.svg') return src;\n\t\tif (src.startsWith('data:')) return src;\n\n\t\t// Normalize path\n\t\tsrc = src.replace(/^\\/+/, '');\n\t\tsrc = src.replace(/^mediaFolder\\//, '').replace(/^files\\//, '');\n\t\tsrc = src.replace(/^\\/+/, '');\n\n\t\treturn `/files/${src}?t=${Date.now()}`;\n\t});\n\n\tconst imageTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/avif', 'image/svg+xml', 'image/gif'];\n\tconst MAX_FILE_SIZE = 5242880; // 5MB\n\tconst COMPRESSION_THRESHOLD = 1024 * 1024; // 1MB - compress files larger than this\n\n\t// Unified accept string for file inputs\n\tconst acceptMime = imageTypes.join(',');\n\n\tconst blobSchema = instance(Blob);\n\ttype BlobType = InferInput<typeof blobSchema>;\n\n\tconst fileSchema = pipe(\n\t\tblobSchema,\n\t\tcheck((input: BlobType) => {\n\t\t\tif (input.size > MAX_FILE_SIZE) {\n\t\t\t\tthrow new Error(m.modaledit_avatarfilesize());\n\t\t\t}\n\t\t\tif (!imageTypes.includes(input.type)) {\n\t\t\t\tthrow new Error('Invalid file type');\n\t\t\t}\n\t\t\treturn true;\n\t\t})\n\t);\n\n\tconst avatarSchema = object({\n\t\tfile: fileSchema\n\t});\n\n\t// Handle file input change\n\tfunction onFileChange(details: { acceptedFiles: File[] }) {\n\t\t// v4 FileUpload passes details with acceptedFiles array\n\t\tconst inputFiles = details.acceptedFiles;\n\t\tif (!inputFiles || inputFiles.length === 0) return;\n\n\t\tfiles = inputFiles;\n\t\tconst lastFile = files[files.length - 1];\n\n\t\t// Reset error state when new file is selected\n\t\timageLoadError = false;\n\n\t\t// Create optimized preview for large files\n\t\tcreateOptimizedPreview(lastFile);\n\t}\n\n\t// Create optimized preview to avoid blocking UI\n\tasync function createOptimizedPreview(file: File) {\n\t\ttry {\n\t\t\t// For very large files, create a smaller preview\n\t\t\tif (file.size > 1024 * 1024) {\n\t\t\t\t// 1MB\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\t\tconst img = new Image();\n\n\t\t\t\timg.onload = () => {\n\t\t\t\t\t// Scale down large images for preview\n\t\t\t\t\tconst maxSize = 200;\n\t\t\t\t\tconst ratio = Math.min(maxSize / img.width, maxSize / img.height);\n\t\t\t\t\tcanvas.width = img.width * ratio;\n\t\t\t\t\tcanvas.height = img.height * ratio;\n\n\t\t\t\t\tctx?.drawImage(img, 0, 0, canvas.width, canvas.height);\n\t\t\t\t\tpreviewUrl = canvas.toDataURL('image/jpeg', 0.8); // Update local preview only\n\t\t\t\t};\n\n\t\t\t\timg.src = URL.createObjectURL(file);\n\t\t\t} else {\n\t\t\t\t// For smaller files, use direct FileReader\n\t\t\t\tconst fileReader = new FileReader();\n\t\t\t\tfileReader.onload = (e) => {\n\t\t\t\t\tif (e.target instanceof FileReader) {\n\t\t\t\t\t\tpreviewUrl = e.target.result as string; // Update local preview only\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfileReader.readAsDataURL(file);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlogger.error('Error creating preview:', error);\n\t\t\t// Fallback to default avatar\n\t\t\tpreviewUrl = null;\n\t\t}\n\t}\n\n\t// Handle form submit\n\tasync function onFormSubmit(): Promise<void> {\n\t\tif (!files || files.length === 0) return;\n\t\tif (isUploading) return; // Prevent double submission\n\n\t\tconst file = files[0];\n\n\t\ttry {\n\t\t\tparse(avatarSchema, { file });\n\n\t\t\t// Show confirmation if replacing existing avatar\n\t\t\tif (avatarSrc.value && avatarSrc.value !== '/Default_User.svg') {\n\t\t\t\tshowConfirm({\n\t\t\t\t\ttitle: 'Replace Avatar',\n\t\t\t\t\tbody: 'Are you sure you want to replace your current avatar?',\n\t\t\t\t\tonConfirm: async () => {\n\t\t\t\t\t\tawait uploadAvatar(file);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// No existing avatar, upload directly\n\t\t\t\tawait uploadAvatar(file);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif ((error as ValiError<typeof avatarSchema>).issues) {\n\t\t\t\tconst valiError = error as ValiError<typeof avatarSchema>;\n\t\t\t\tlogger.error(valiError.issues[0]?.message);\n\t\t\t\ttoaster.error({ description: valiError.issues[0]?.message || 'Invalid file' });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlogger.error((error as Error).message);\n\t\t\ttoaster.error({ description: (error as Error).message || 'Upload failed' });\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// Compress large files before upload\n\tasync function compressFile(file: File): Promise<File> {\n\t\t// Don't compress SVGs or files already small enough\n\t\tif (file.type === 'image/svg+xml' || file.size < COMPRESSION_THRESHOLD) {\n\t\t\treturn file;\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\tconst img = new Image();\n\n\t\t\timg.onload = () => {\n\t\t\t\t// Calculate new dimensions (max 1024px)\n\t\t\t\tconst maxSize = 1024;\n\t\t\t\tconst ratio = Math.min(maxSize / img.width, maxSize / img.height);\n\t\t\t\tcanvas.width = img.width * ratio;\n\t\t\t\tcanvas.height = img.height * ratio;\n\n\t\t\t\t// Draw and compress\n\t\t\t\tctx?.drawImage(img, 0, 0, canvas.width, canvas.height);\n\t\t\t\tcanvas.toBlob(\n\t\t\t\t\t(blob) => {\n\t\t\t\t\t\tif (blob) {\n\t\t\t\t\t\t\tconst compressedFile = new File([blob], file.name, {\n\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\tlastModified: Date.now()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresolve(compressedFile);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(file); // Fallback to original\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'image/jpeg',\n\t\t\t\t\t0.85 // Quality\n\t\t\t\t);\n\t\t\t};\n\n\t\t\timg.onerror = () => resolve(file); // Fallback to original\n\t\t\timg.src = URL.createObjectURL(file);\n\t\t});\n\t}\n\n\t// Upload avatar\n\tasync function uploadAvatar(file: File): Promise<void> {\n\t\tisUploading = true;\n\t\tuploadProgress = 0;\n\n\t\ttry {\n\t\t\t// Compress large files first\n\t\t\tconst processedFile = await compressFile(file);\n\n\t\t\t// Create FormData\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append('avatar', processedFile);\n\n\t\t\t// Upload with axios for progress tracking\n\t\t\tconst response = await axios.post('/api/user/saveAvatar', formData, {\n\t\t\t\theaders: { 'Content-Type': 'multipart/form-data' },\n\t\t\t\tonUploadProgress: (progressEvent) => {\n\t\t\t\t\tif (progressEvent.total) {\n\t\t\t\t\t\tuploadProgress = Math.round((progressEvent.loaded * 100) / progressEvent.total);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst result = response.data;\n\n\t\t\t// Update the avatar store with the new URL from API\n\t\t\tif (result.avatarUrl) {\n\t\t\t\tavatarSrc.value = result.avatarUrl;\n\t\t\t\tlogger.info('Avatar store updated', { avatarUrl: result.avatarUrl });\n\t\t\t}\n\n\t\t\t// Invalidate all data to ensure consistency\n\t\t\tawait invalidateAll();\n\n\t\t\t// Show success toast\n\t\t\ttoaster.success({ description: 'Avatar updated successfully!' });\n\t\t\tmodalState.close();\n\t\t} catch (error) {\n\t\t\tconsole.error('Avatar upload failed:', error);\n\t\t\timageLoadError = true;\n\t\t\ttoaster.error({ description: 'Failed to update avatar' });\n\t\t\t// Revert preview on error\n\t\t\tpreviewUrl = null;\n\t\t} finally {\n\t\t\tisUploading = false;\n\t\t\t// Keep progress at 100 briefly so user sees it completed\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!isUploading) uploadProgress = 0;\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\t// Delete avatar with confirmation\n\tasync function deleteAvatar(): Promise<void> {\n\t\tlogger.info('deleteAvatar function called');\n\n\t\tshowConfirm({\n\t\t\ttitle: 'Delete Avatar',\n\t\t\tbody: 'Are you sure you want to delete your avatar? This action cannot be undone.',\n\t\t\tonConfirm: async () => {\n\t\t\t\t// User confirmed - proceed with deletion\n\t\t\t\ttry {\n\t\t\t\t\tconst currentAvatar = avatarSrc.value;\n\t\t\t\t\tlogger.info('Attempting to delete avatar:', currentAvatar);\n\n\t\t\t\t\tconst response = await fetch('/api/user/deleteAvatar', {\n\t\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\t\tbody: JSON.stringify({ avatarUrl: currentAvatar })\n\t\t\t\t\t});\n\n\t\t\t\t\tconst result = await response.json();\n\n\t\t\t\t\tlogger.info('Delete response:', result);\n\n\t\t\t\t\tif (response.ok && result.success) {\n\t\t\t\t\t\t// Update the avatar store\n\t\t\t\t\t\tavatarSrc.value = '/Default_User.svg';\n\t\t\t\t\t\tpreviewUrl = null;\n\n\t\t\t\t\t\t// Show success message\n\t\t\t\t\t\ttoaster.success({\n\t\t\t\t\t\t\tdescription: '<iconify-icon icon=\"radix-icons:avatar\" color=\"white\" width=\"24\" class=\"mr-1\"></iconify-icon> Avatar Deleted'\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Close dialog\n\t\t\t\t\t\tmodalState.close();\n\n\t\t\t\t\t\t// Reload page data\n\t\t\t\t\t\tawait invalidateAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(result.message || 'Delete failed');\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.error('Error deleting avatar:', error);\n\n\t\t\t\t\tconst msg = error instanceof Error ? error.message : 'Failed to delete avatar';\n\n\t\t\t\t\ttoaster.error({ description: `<iconify-icon icon=\"radix-icons:cross-2\" color=\"white\" width=\"24\" class=\"mr-1\"></iconify-icon> ${msg}` });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t// Base Classes\n\n\tconst cForm = 'border border-surface-500 p-4 space-y-4 rounded-xl';\n</script>\n\n<div class=\"modal-avatar space-y-4\">\n\t<form class=\"modal-form {cForm}\">\n\t\t<div class=\"grid grid-cols-1 grid-rows-{avatarSrc.value ? '1' : '2'} items-center justify-center\">\n\t\t\t<FileUpload acceptedFiles={files} accept={acceptMime} maxFiles={1} {onFileChange} class=\"w-full flex flex-col items-center gap-4\">\n\t\t\t\t<!-- Hidden Input -->\n\t\t\t\t<FileUpload.HiddenInput />\n\n\t\t\t\t<!-- Avatar Trigger (Clickable) -->\n\t\t\t\t<FileUpload.Trigger class=\"outline-none relative mx-auto mb-3 cursor-pointer rounded-full focus:ring-2 focus:ring-primary-500\">\n\t\t\t\t\t<Avatar\n\t\t\t\t\t\tclass=\"size-32 flex items-center justify-center rounded-full overflow-hidden border-4 border-surface-200 dark:border-surface-700 shadow-xl bg-surface-100 dark:bg-surface-800 aspect-square\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Avatar.Image src={displayAvatar} alt=\"User avatar\" class=\"size-full object-cover\" />\n\t\t\t\t\t\t<Avatar.Fallback class=\"flex size-full items-center justify-center bg-surface-500 text-3xl font-bold uppercase text-white\">\n\t\t\t\t\t\t\tAB\n\t\t\t\t\t\t</Avatar.Fallback>\n\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t<!-- Hover/Focus overlay cue when not uploading -->\n\t\t\t\t\t{#if !isUploading}\n\t\t\t\t\t\t<div class=\"absolute inset-0 hidden items-center justify-center rounded-full bg-black/30 text-white focus-within:flex hover:flex\">\n\t\t\t\t\t\t\t<span class=\"text-xs font-medium\">Click to upload</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t\t{#if isUploading}\n\t\t\t\t\t\t<div class=\"absolute inset-0 flex items-center justify-center rounded-full bg-black/60\">\n\t\t\t\t\t\t\t<div class=\"text-sm font-medium text-white\">...</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</FileUpload.Trigger>\n\n\t\t\t\t<!-- Dropzone Area -->\n\t\t\t\t<FileUpload.Dropzone class=\"w-full\">\n\t\t\t\t\t<div class=\"flex flex-col items-center justify-center p-4\">\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:cloud-upload\" width=\"48\" class=\"mb-2 text-primary-500\"></iconify-icon>\n\t\t\t\t\t\t<p class=\"text-sm\">{m.modaledit_avatarfilesallowed()}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</FileUpload.Dropzone>\n\t\t\t</FileUpload>\n\t\t</div>\n\t\t{#if !files.length && !isUploading}\n\t\t\t<small class=\"block text-center text-tertiary-500 opacity-75 dark:text-primary-500\">{m.modaledit_avatarfilesize()}</small>\n\t\t{/if}\n\t\t<!-- Progress Bar -->\n\t\t{#if isUploading}\n\t\t\t<div class=\"absolute inset-0 flex items-center justify-center bg-black/50 rounded-xl\">\n\t\t\t\t<div class=\"flex flex-col items-center gap-2\">\n\t\t\t\t\t<div class=\"h-16 w-16 animate-spin rounded-full border-4 border-primary-500 border-t-transparent\"></div>\n\t\t\t\t\t{#if uploadProgress > 0}\n\t\t\t\t\t\t<span class=\"text-sm font-bold text-white\">{uploadProgress}%</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</form>\n\n\t<footer class=\"modal-footer justify-between pt-4 border-t border-surface-500/20\">\n\t\t<!-- Delete Avatar -->\n\t\t{#if avatarSrc.value && avatarSrc.value !== '/Default_User.svg'}\n\t\t\t<button type=\"button\" onclick={deleteAvatar} class=\"preset-filled-error-500 btn\">\n\t\t\t\t<iconify-icon icon=\"icomoon-free:bin\" width=\"24\"></iconify-icon>\n\t\t\t\t<span class=\"hidden sm:block\">{m.button_delete()}</span>\n\t\t\t</button>\n\t\t{:else}\n\t\t\t<div></div>\n\t\t\t<!-- Empty div when using the default avatar -->\n\t\t{/if}\n\t\t<div class=\"flex justify-between gap-2\">\n\t\t\t<!-- Cancel -->\n\t\t\t<button class=\"preset-outlined-secondary-500 btn\" onclick={() => modalState.close()} disabled={isUploading}>\n\t\t\t\t{m.button_cancel()}\n\t\t\t</button>\n\t\t\t<!-- Save -->\n\t\t\t<button class=\"preset-filled-tertiary-500 btn dark:preset-filled-primary-500\" onclick={onFormSubmit} disabled={!files.length || isUploading}>\n\t\t\t\t{#if isUploading}\n\t\t\t\t\t<div class=\"mr-2 h-4 w-4 animate-spin rounded-full border-b-2 border-white\"></div>\n\t\t\t\t\tUploading...\n\t\t\t\t{:else}\n\t\t\t\t\t{m.button_save()}\n\t\t\t\t{/if}\n\t\t\t</button>\n\t\t</div>\n\t</footer>\n</div>\n","<!--\n@file src/routes/(app)/user/components/TwoFactorVerifyModal.svelte\n@component\n**Two-Factor Authentication Verification Modal**\n\nThis modal\t\t\tclass=\"input text-center font-mono tracking-wider\"\n\t\t\tclass:text-2xl={!useBackupCode}\n\t\t\tclass:text-lg={useBackupCode}\n\t\t\tmaxlength={useBackupCode ? 10 : 6}\n\t\t\tautocomplete=\"off\"les verification of 2FA codes for various operations like disabling 2FA.\n\n@example\n<TwoFactorVerifyModal title=\"Verify 2FA\" description=\"Enter your code...\" />\n\n### Props\n- `parent` {SvelteComponent} - Modal parent component\n- `title` {string} - Modal title override\n- `description` {string} - Description text\n\n### Features\n- Code input with validation\n- Support for backup codes\n- Toggle between authenticator and backup codes\n- Input sanitization and formatting\n-->\n\n<script lang=\"ts\">\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Props\n\tconst { parent, title = '', description = '' } = $props();\n\n\t// State\n\tlet code = $state('');\n\tlet isVerifying = $state(false);\n\tlet useBackupCode = $state(false);\n\tlet error = $state('');\n\n\t// Handle code input with validation\n\tfunction handleInput(event: Event) {\n\t\tconst input = event.target as HTMLInputElement;\n\t\tlet value = input.value;\n\n\t\tif (!useBackupCode) {\n\t\t\t// For TOTP codes, only allow 6 digits\n\t\t\tvalue = value.replace(/\\D/g, '').slice(0, 6);\n\t\t} else {\n\t\t\t// For backup codes, allow alphanumeric and remove spaces\n\t\t\tvalue = value\n\t\t\t\t.replace(/[^a-zA-Z0-9]/g, '')\n\t\t\t\t.toLowerCase()\n\t\t\t\t.slice(0, 10);\n\t\t}\n\n\t\tcode = value;\n\t\terror = '';\n\t}\n\n\t// Submit verification code\n\tasync function submitCode() {\n\t\tconst trimmedCode = code.trim();\n\n\t\tif (!trimmedCode) {\n\t\t\terror = m.twofa_error_empty_code();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!useBackupCode && trimmedCode.length !== 6) {\n\t\t\terror = m.twofa_error_invalid_code();\n\t\t\treturn;\n\t\t}\n\n\t\tif (useBackupCode && trimmedCode.length < 8) {\n\t\t\terror = m.twofa_error_invalid_backup_code();\n\t\t\treturn;\n\t\t}\n\n\t\tisVerifying = true;\n\t\terror = '';\n\n\t\ttry {\n\t\t\t// Return the code to the parent modal\n\t\t\tif (parent.onClose) parent.onClose(trimmedCode);\n\t\t\tmodalState.close();\n\t\t} catch (err) {\n\t\t\terror = err instanceof Error ? err.message : 'Verification failed';\n\t\t} finally {\n\t\t\tisVerifying = false;\n\t\t}\n\t}\n\n\t// Cancel verification\n\tfunction cancelVerification() {\n\t\tif (parent.onClose) parent.onClose(null);\n\t\tmodalState.close();\n\t}\n\n\t// Toggle between authenticator and backup code\n\tfunction toggleCodeType() {\n\t\tuseBackupCode = !useBackupCode;\n\t\tcode = '';\n\t\terror = '';\n\t}\n\n\t// Handle Enter key press\n\tfunction handleKeydown(event: KeyboardEvent) {\n\t\tif (event.key === 'Enter' && !isVerifying) {\n\t\t\tsubmitCode();\n\t\t}\n\t}\n</script>\n\n<div class=\"max-w-md p-6\">\n\t<div class=\"mb-6 text-center\">\n\t\t<div class=\"mb-4\">\n\t\t\t<iconify-icon icon=\"mdi:shield-key\" width=\"48\" class=\"mx-auto text-primary-500\"></iconify-icon>\n\t\t</div>\n\n\t\t<h4 class=\"h4 mb-2\">\n\t\t\t{title || m.twofa_verify_title()}\n\t\t</h4>\n\n\t\t<p class=\"text-surface-600 dark:text-surface-300\">\n\t\t\t{description || (useBackupCode ? m.twofa_backup_verify_description() : m.twofa_verify_description())}\n\t\t</p>\n\t</div>\n\n\t<!-- Code Input -->\n\t<div class=\"mb-6\">\n\t\t<div class=\"relative\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tbind:value={code}\n\t\t\t\toninput={handleInput}\n\t\t\t\tonkeydown={handleKeydown}\n\t\t\t\tplaceholder={useBackupCode ? m.twofa_backup_code_placeholder() : m.twofa_code_placeholder()}\n\t\t\t\tclass={'input text-center font-mono tracking-wider ' +\n\t\t\t\t\t(useBackupCode ? 'text-lg' : 'text-2xl') +\n\t\t\t\t\t(error ? ' border-error-500 focus:border-error-500' : '')}\n\t\t\t\tmaxlength={useBackupCode ? 10 : 6}\n\t\t\t\tautocomplete=\"off\"\n\t\t\t/>\n\n\t\t\t<!-- Character counter for backup codes -->\n\t\t\t{#if useBackupCode}\n\t\t\t\t<div class=\"mt-1 text-center text-xs text-surface-500\">\n\t\t\t\t\t{code.length}/10\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t{#if error}\n\t\t\t<p class=\"mt-2 text-center text-sm text-error-500\">{error}</p>\n\t\t{/if}\n\t</div>\n\n\t<!-- Toggle Code Type -->\n\t<div class=\"mb-6 text-center\">\n\t\t<button onclick={toggleCodeType} class=\"text-sm text-primary-500 underline hover:text-primary-600\">\n\t\t\t{useBackupCode ? m.twofa_use_authenticator() : m.twofa_use_backup_code()}\n\t\t</button>\n\t</div>\n\n\t<!-- Action Buttons -->\n\t<div class=\"flex gap-3\">\n\t\t<button onclick={cancelVerification} class=\"preset-tonal-surface btn flex-1\">\n\t\t\t{m.button_cancel()}\n\t\t</button>\n\n\t\t<button\n\t\t\tonclick={submitCode}\n\t\t\tdisabled={!code.trim() || isVerifying || (!useBackupCode && code.length !== 6) || (useBackupCode && code.length < 8)}\n\t\t\tclass=\"preset-filled-primary-500 btn flex-1\"\n\t\t>\n\t\t\t{#if isVerifying}\n\t\t\t\t<iconify-icon icon=\"svg-spinners:3-dots-fade\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t{m.twofa_verifying()}\n\t\t\t{:else}\n\t\t\t\t<iconify-icon icon=\"mdi:check\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t{m.twofa_verify_button()}\n\t\t\t{/if}\n\t\t</button>\n\t</div>\n\n\t<!-- Help Text -->\n\t<div class=\"mt-4 text-center\">\n\t\t<div class=\"space-y-1 text-xs text-surface-500\">\n\t\t\t{#if !useBackupCode}\n\t\t\t\t<p>{m.twofa_help_authenticator()}</p>\n\t\t\t{:else}\n\t\t\t\t<p>{m.twofa_help_backup()}</p>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n","<!--\n@file src/routes/(app)/user/components/ModalTwoFactorAuth.svelte\n@component\n**Two-Factor Authentication Management Modal**\n\nThis component provides a user interface for managing 2FA settings:\n- Enable/disable 2FA\n- Display setup QR code\n- Show backup codes\n- Verify setup\n\n@example\n<TwoFactorAuth {user} />\n\n### Props\n- `user` {User} - Current user object\n\n### Features\n- QR code generation for authenticator apps\n- Backup codes management\n- Enable/disable 2FA toggle\n- Setup verification workflow\n- Responsive design with proper accessibility\n-->\n\n<script lang=\"ts\">\n\timport { invalidateAll } from '$app/navigation';\n\timport type { User } from '@shared/database/auth/types';\n\t// Skeleton & Stores\n\t// getModalStore deprecated - use modalState from @shared/utils/modalState.svelte;\n\timport TwoFactorVerifyModal from './TwoFactorVerifyModal.svelte';\n\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\timport { logger } from '@shared/utils/logger';\n\timport { toaster } from '@shared/stores/store.svelte';\n\n\tinterface Props {\n\t\tparent?: {\n\t\t\tregionFooter?: string;\n\t\t\tonClose?: (event: MouseEvent) => void;\n\t\t\tbuttonPositive?: string;\n\t\t};\n\t\tuser?: User;\n\t\ttitle?: string;\n\t\tbody?: string;\n\t\tclose?: (result?: any) => void;\n\t}\n\n\tconst { user, title, body, close }: Props = $props();\n\n\t// State\n\tlet isLoading = $state(false);\n\tlet backupCodes = $state<string[]>([]);\n\tlet setupData = $state<{ qrCodeUrl: string; secret: string; backupCodes: string[] } | null>(null);\n\tlet verificationCode = $state('');\n\n\t// Check if 2FA is enabled\n\tconst is2FAEnabled = $derived(user?.is2FAEnabled || false);\n\n\t// Load setup data when modal opens if 2FA is not enabled\n\t$effect(() => {\n\t\tif (!is2FAEnabled && !setupData) {\n\t\t\tloadSetupData();\n\t\t}\n\t});\n\n\t// Show success toast\n\tfunction showSuccessToast(message: string) {\n\t\ttoaster.create({ title: 'Success', description: message, type: 'success' });\n\t}\n\tfunction showErrorToast(message: string) {\n\t\ttoaster.create({ title: 'Error', description: message, type: 'error' });\n\t}\n\n\t// Load setup data (QR code, secret, backup codes)\n\tasync function loadSetupData() {\n\t\tif (isLoading) return;\n\n\t\tisLoading = true;\n\n\t\ttry {\n\t\t\tconst response = await fetch('/api/auth/2fa/setup', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' }\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(result.message || 'Failed to setup 2FA');\n\t\t\t}\n\n\t\t\t// The data is nested inside result.data\n\t\t\tconst data = result.data || result;\n\n\t\t\t// Get the otpauth URL\n\t\t\tconst otpauthUrl = data.qrCodeURL || data.qrCodeUrl || data.qrCode || data.qr_code_url || '';\n\n\t\t\t// Generate QR code image URL using a QR code API\n\t\t\t// Using qrcode.show API (simple, no registration needed)\n\t\t\tconst qrCodeImageUrl = otpauthUrl ? `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(otpauthUrl)}` : '';\n\n\t\t\tsetupData = {\n\t\t\t\tqrCodeUrl: qrCodeImageUrl,\n\t\t\t\tsecret: data.secret || data.secretKey || data.secret_key || '',\n\t\t\t\tbackupCodes: data.backupCodes || data.backup_codes || []\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tlogger.error('2FA setup error:', error);\n\t\t\tshowErrorToast(error instanceof Error ? error.message : m.twofa_error_setup_failed());\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\t// Verify and enable 2FA\n\tasync function verify2FA() {\n\t\tif (isLoading || !verificationCode || verificationCode.length !== 6) return;\n\n\t\tisLoading = true;\n\n\t\ttry {\n\t\t\tconst response = await fetch('/api/auth/2fa/verify', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ code: verificationCode })\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(result.message || 'Failed to verify 2FA code');\n\t\t\t}\n\n\t\t\tshowSuccessToast(m.twofa_success_enabled());\n\t\t\tawait invalidateAll();\n\t\t\tclose?.({ success: true });\n\t\t} catch (error) {\n\t\t\tlogger.error('2FA verification error:', error);\n\t\t\tshowErrorToast(error instanceof Error ? error.message : m.twofa_error_invalid_code());\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\t// Disable 2FA\n\tasync function disable2FA() {\n\t\tif (isLoading) return;\n\n\t\t// Show verification modal first\n\t\tconst { modalState } = await import('@shared/utils/modalState.svelte');\n\n\t\tmodalState.trigger(\n\t\t\tTwoFactorVerifyModal as any,\n\t\t\t{\n\t\t\t\ttitle: m.twofa_disable_verify_title(),\n\t\t\t\tdescription: m.twofa_disable_verify_description()\n\t\t\t},\n\t\t\tasync (code: string | null) => {\n\t\t\t\tif (!code) return;\n\n\t\t\t\tisLoading = true;\n\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch('/api/auth/2fa/disable', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\t\tbody: JSON.stringify({ code })\n\t\t\t\t\t});\n\n\t\t\t\t\tconst result = await response.json();\n\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tthrow new Error(result.message || 'Failed to disable 2FA');\n\t\t\t\t\t}\n\n\t\t\t\t\tshowSuccessToast(m.twofa_success_disabled());\n\t\t\t\t\tawait invalidateAll();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.error('2FA disable error:', error);\n\t\t\t\t\tshowErrorToast(error instanceof Error ? error.message : 'Failed to disable 2FA');\n\t\t\t\t} finally {\n\t\t\t\t\tisLoading = false;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t// Generate new backup codes\n\tasync function generateBackupCodes() {\n\t\tif (isLoading) return;\n\n\t\tisLoading = true;\n\n\t\ttry {\n\t\t\tconst response = await fetch('/api/auth/2fa/backup-codes', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' }\n\t\t\t});\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(result.message || 'Failed to generate backup codes');\n\t\t\t}\n\n\t\t\tbackupCodes = result.backupCodes;\n\t\t\tshowSuccessToast(m.twofa_backup_codes_generated());\n\t\t} catch (error) {\n\t\t\tlogger.error('Backup codes error:', error);\n\t\t\tshowErrorToast(error instanceof Error ? error.message : 'Failed to generate backup codes');\n\t\t} finally {\n\t\t\tisLoading = false;\n\t\t}\n\t}\n\n\t// Base Classes for modal\n\tconst cHeader = 'text-2xl font-bold';\n\tconst cForm = 'border border-surface-500 p-3 space-y-3 rounded-xl overflow-y-auto flex-1';\n</script>\n\n<!-- Main Modal Component -->\n<div class=\"modal-2fa space-y-3\">\n\t<header class={`text-center text-primary-500 ${cHeader} shrink-0`}>\n\t\t{title ?? m.twofa_title()}\n\t</header>\n\n\t<article class=\"shrink-0 text-center text-sm\">\n\t\t{body ?? m.twofa_description()}\n\t</article>\n\n\t<form class=\"modal-form {cForm} max-h-[60vh]\">\n\t\t<!-- Status Section -->\n\t\t<div class=\"mb-4 flex items-center justify-between rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t<div class=\"flex items-center gap-3\">\n\t\t\t\t<div class=\"rounded-lg bg-primary-500/10 p-2 dark:bg-primary-500/20\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:shield-check\" width=\"24\" class=\"text-primary-500\"></iconify-icon>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<p class=\"text-sm font-semibold\">{m.twofa_title()}</p>\n\t\t\t\t\t<p class=\"text-xs text-surface-600 dark:text-surface-300\">{m.twofa_description()}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<!-- Status badge - aligned right -->\n\t\t\t<span class=\"badge {is2FAEnabled ? 'preset-filled-success-500' : 'preset-filled-surface-500'}\">\n\t\t\t\t<iconify-icon icon=\"mdi:{is2FAEnabled ? 'check-circle' : 'circle-outline'}\" width=\"14\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t{is2FAEnabled ? m.twofa_status_enabled() : m.twofa_status_disabled()}\n\t\t\t</span>\n\t\t</div>\n\n\t\t{#if !is2FAEnabled}\n\t\t\t{#if isLoading && !setupData}\n\t\t\t\t<!-- Loading state -->\n\t\t\t\t<div class=\"flex flex-col items-center justify-center gap-4 py-8\">\n\t\t\t\t\t<iconify-icon icon=\"svg-spinners:ring-resize\" width=\"48\" class=\"text-primary-500\"></iconify-icon>\n\t\t\t\t\t<p class=\"text-sm text-surface-600 dark:text-surface-300\">{m.twofa_setting_up()}</p>\n\t\t\t\t</div>\n\t\t\t{:else if setupData}\n\t\t\t\t<!-- QR Code Setup -->\n\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t<!-- Step 1: Scan QR Code -->\n\t\t\t\t\t<div class=\"space-y-3\">\n\t\t\t\t\t\t<h4 class=\"h4 flex items-center gap-2\">\n\t\t\t\t\t\t\t<span class=\"preset-tonal -primary-500 badge\">1</span>\n\t\t\t\t\t\t\t{m.twofa_setup_scan_title()}\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t<p class=\"text-sm text-surface-600 dark:text-surface-300\">{m.twofa_setup_step_1()}</p>\n\n\t\t\t\t\t\t<!-- QR Code -->\n\t\t\t\t\t\t<div class=\"flex justify-center rounded-lg bg-white p-2 dark:bg-white\">\n\t\t\t\t\t\t\t{#if setupData.qrCodeUrl}\n\t\t\t\t\t\t\t\t<img src={setupData.qrCodeUrl} alt=\"2FA QR Code\" class=\"h-32 w-32\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\"flex h-32 w-32 items-center justify-center bg-surface-200\">\n\t\t\t\t\t\t\t\t\t<p class=\"text-xs text-surface-600\">QR Code</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Step 2: Manual Entry (Optional) -->\n\t\t\t\t\t<div class=\"space-y-3\">\n\t\t\t\t\t\t<h4 class=\"h4 flex items-center gap-2\">\n\t\t\t\t\t\t\t<span class=\"preset-tonal -secondary-500 badge\">2</span>\n\t\t\t\t\t\t\t{m.twofa_show_secret()}\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t<p class=\"text-sm text-surface-600 dark:text-surface-300\">{m.twofa_manual_entry_description()}</p>\n\t\t\t\t\t\t<div class=\"rounded-lg bg-surface-100 p-3 dark:bg-surface-700\">\n\t\t\t\t\t\t\t<code class=\"break-all text-sm\">{setupData.secret}</code>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Step 3: Verify -->\n\t\t\t\t\t<div class=\"space-y-3\">\n\t\t\t\t\t\t<h4 class=\"h4 flex items-center gap-2\">\n\t\t\t\t\t\t\t<span class=\"preset-tonal -tertiary-500 badge\">3</span>\n\t\t\t\t\t\t\t{m.twofa_verify_setup_title()}\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t<p class=\"text-sm text-surface-600 dark:text-surface-300\">{m.twofa_verify_setup_description()}</p>\n\n\t\t\t\t\t\t<label class=\"label\">\n\t\t\t\t\t\t\t<span>{m.twofa_code_placeholder()}</span>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tclass=\"input\"\n\t\t\t\t\t\t\t\tplaceholder=\"000000\"\n\t\t\t\t\t\t\t\tmaxlength=\"6\"\n\t\t\t\t\t\t\t\tbind:value={verificationCode}\n\t\t\t\t\t\t\t\toninput={(e) => {\n\t\t\t\t\t\t\t\t\tconst target = e.target as HTMLInputElement;\n\t\t\t\t\t\t\t\t\ttarget.value = target.value.replace(/\\D/g, '');\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Backup Codes Warning -->\n\t\t\t\t\t<div class=\"alert preset-ghost-warning-500\">\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:information\" width=\"20\"></iconify-icon>\n\t\t\t\t\t\t<div class=\"alert-message\">\n\t\t\t\t\t\t\t<h5 class=\"h5 mb-1\">{m.twofa_backup_codes_title()}</h5>\n\t\t\t\t\t\t\t<p class=\"text-sm\">{m.twofa_backup_codes_save_description()}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{:else}\n\t\t\t<!-- 2FA Already Enabled - Management Options -->\n\t\t\t<div class=\"alert preset-ghost-success-500\">\n\t\t\t\t<iconify-icon icon=\"mdi:shield-check\" width=\"20\"></iconify-icon>\n\t\t\t\t<div class=\"alert-message\">\n\t\t\t\t\t<p class=\"text-sm\">{m.twofa_enabled_description()}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<!-- Show backup codes if generated -->\n\t\t\t{#if backupCodes.length > 0}\n\t\t\t\t<div class=\"alert preset-ghost-warning-500\">\n\t\t\t\t\t<iconify-icon icon=\"mdi:key-variant\" width=\"20\"></iconify-icon>\n\t\t\t\t\t<div class=\"alert-message\">\n\t\t\t\t\t\t<h5 class=\"h5 mb-2\">{m.twofa_backup_codes_title()}</h5>\n\t\t\t\t\t\t<p class=\"mb-3 text-sm\">{m.twofa_backup_codes_description()}</p>\n\t\t\t\t\t\t<div class=\"mb-3 grid grid-cols-2 gap-2 font-mono text-sm\">\n\t\t\t\t\t\t\t{#each backupCodes as code, index (index)}\n\t\t\t\t\t\t\t\t<div class=\"rounded bg-surface-200 p-2 text-center dark:bg-surface-700\">\n\t\t\t\t\t\t\t\t\t{code}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p class=\"text-sm text-warning-600 dark:text-warning-400\">\n\t\t\t\t\t\t\t<iconify-icon icon=\"mdi:alert\" width=\"16\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t\t\t\t{m.twofa_backup_codes_warning()}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t</form>\n\n\t<footer class=\"modal-footer mt-4 flex shrink-0 justify-end gap-2 pt-4 border-t border-surface-500/20\">\n\t\t<!-- Close button -->\n\t\t<button class=\"preset-outlined-secondary-500 btn\" onclick={() => close?.()} disabled={isLoading}>\n\t\t\t{m.button_cancel()}\n\t\t</button>\n\n\t\t<!-- Action buttons -->\n\t\t{#if !is2FAEnabled && setupData}\n\t\t\t<!-- Verify button when setting up -->\n\t\t\t<button onclick={verify2FA} disabled={isLoading || !verificationCode || verificationCode.length !== 6} class=\"preset-filled-primary-500 btn\">\n\t\t\t\t{#if isLoading}\n\t\t\t\t\t<iconify-icon icon=\"svg-spinners:3-dots-fade\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t{m.twofa_verifying()}\n\t\t\t\t{:else}\n\t\t\t\t\t<iconify-icon icon=\"mdi:check-circle\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t{m.twofa_verify_button()}\n\t\t\t\t{/if}\n\t\t\t</button>\n\t\t{:else if is2FAEnabled}\n\t\t\t<!-- Management buttons when 2FA is enabled -->\n\t\t\t<button onclick={generateBackupCodes} disabled={isLoading} class=\"preset-tonal -secondary-500 btn\">\n\t\t\t\t{#if isLoading}\n\t\t\t\t\t<iconify-icon icon=\"svg-spinners:3-dots-fade\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t{m.twofa_generating_codes()}\n\t\t\t\t{:else}\n\t\t\t\t\t<iconify-icon icon=\"mdi:key-variant\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t{m.twofa_generate_backup_codes()}\n\t\t\t\t{/if}\n\t\t\t</button>\n\n\t\t\t<button onclick={disable2FA} disabled={isLoading} class=\"preset-filled-error-500 btn\">\n\t\t\t\t{#if isLoading}\n\t\t\t\t\t<iconify-icon icon=\"svg-spinners:3-dots-fade\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t{m.twofa_disabling()}\n\t\t\t\t{:else}\n\t\t\t\t\t<iconify-icon icon=\"mdi:shield-remove\" width=\"20\" class=\"mr-2\"></iconify-icon>\n\t\t\t\t\t{m.twofa_disable_button()}\n\t\t\t\t{/if}\n\t\t\t</button>\n\t\t{/if}\n\t</footer>\n</div>\n","/**\n * @file src/utils/globalSearchIndex.ts\n * @description\n * This file implements a global search index functionality for a web application.\n * It provides a centralized search mechanism across various parts of the application.\n * Key features include:\n *\n * - Creation and management of a global search index using Svelte stores\n * - Predefined search data for common application areas (Home, Marketplace, User Profile, etc.)\n * - Support for search triggers with associated actions and paths\n * - Functions to add new items to the search index\n * - Search functionality to query the global index\n * - Integration with system logging for tracking search-related activities\n * - Initialization function for setting up the global search functionality\n *\n * The global search index is designed to improve navigation and discoverability\n * within the application, allowing users to quickly find and access different\n * features and content areas.\n *\n * @module GlobalSearchIndex\n */\n\nimport { writable } from 'svelte/store';\nimport { modalState } from '@shared/utils/modalState.svelte';\nimport { ModalEditAvatar, ModalEditForm } from '@cms/user';\n\n// System Logs\nimport { logger } from '@shared/utils/logger';\n\nexport const isSearchVisible = writable(false);\nexport const triggerActionStore = writable<(() => void | Promise<void>)[]>([]);\n\n// Create a writable store for the global search index\nexport interface SearchData {\n\ttitle: string;\n\tdescription: string;\n\tkeywords: string[];\n\ttriggers: {\n\t\t[title: string]: {\n\t\t\tpath: string;\n\t\t\taction?: (() => void | Promise<void>)[];\n\t\t};\n\t};\n}\n\n// Initialize the global search index with predefined data\nexport const globalSearchIndex = writable<SearchData[]>([\n\t{\n\t\ttitle: 'Home',\n\t\tdescription: 'The home page of the blog.',\n\t\tkeywords: ['home', 'dashboard'],\n\t\ttriggers: { 'Go to Home Page': { path: '/' } }\n\t},\n\t{\n\t\ttitle: 'Marketplace',\n\t\tdescription: 'SveltCMS Widget Marketplace.',\n\t\tkeywords: ['widget', 'marketplace', 'plugins', 'extensions'],\n\t\ttriggers: { 'Go to Marketplace': { path: 'https://www.sveltycms.com' } }\n\t},\n\t{\n\t\ttitle: 'GraphQL Yoga',\n\t\tdescription: 'GraphQL Explorer',\n\t\tkeywords: ['graphQL', 'Explorer', 'Yoga', 'API', 'query'],\n\t\ttriggers: { 'Go to GraphQL Explorer': { path: '/api/graphql' } }\n\t},\n\t{\n\t\ttitle: 'User Profile',\n\t\tdescription: 'View and edit your user profile.',\n\t\tkeywords: ['user', 'avatar', 'profile', 'settings', 'account', 'password', 'delete'],\n\t\ttriggers: {\n\t\t\t'Show User Profile': { path: '/user' },\n\t\t\t'Edit Avatar Image': {\n\t\t\t\tpath: '/user',\n\t\t\t\taction: [\n\t\t\t\t\t() => {\n\t\t\t\t\t\tmodalState.trigger(ModalEditAvatar, {\n\t\t\t\t\t\t\ttitle: 'Edit Avatar',\n\t\t\t\t\t\t\tbody: 'Upload or change your avatar image'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t'Edit User Profile': {\n\t\t\t\tpath: '/user',\n\t\t\t\taction: [\n\t\t\t\t\t() => {\n\t\t\t\t\t\tmodalState.trigger(ModalEditForm, {\n\t\t\t\t\t\t\ttitle: 'Edit Profile',\n\t\t\t\t\t\t\tbody: 'Modify your data and then press Save.'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\ttitle: 'User Admin Area',\n\t\tdescription: 'View and edit users in the user admin area.',\n\t\tkeywords: ['user', 'role', 'profile', 'settings', 'account', 'password', 'token', 'admin'],\n\t\ttriggers: {\n\t\t\t'Show User Admin': { path: '/user' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Media Gallery',\n\t\tdescription: 'View and edit your media gallery.',\n\t\tkeywords: ['media', 'gallery', 'images', 'videos', 'documents', 'files'],\n\t\ttriggers: {\n\t\t\t'Go to Media Gallery': { path: '/mediagallery' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Add Media',\n\t\tdescription: 'Add new media to gallery.',\n\t\tkeywords: ['add', 'media', 'gallery', 'images', 'videos', 'documents', 'upload'],\n\t\ttriggers: {\n\t\t\t'Go to Add Media': { path: '/mediagallery/uploadMedia' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Image Editor',\n\t\tdescription: 'Edit and manage images with the image editor.',\n\t\tkeywords: ['image', 'editor', 'edit', 'photos', 'media', 'crop', 'resize'],\n\t\ttriggers: {\n\t\t\t'Go to Image Editor': { path: '/imageEditor' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'System Dashboard',\n\t\tdescription: 'View and manage your dashboard.',\n\t\tkeywords: ['dashboard', 'profile', 'settings', 'load', 'system', 'overview'],\n\t\ttriggers: { 'Go to Dashboard': { path: '/dashboard' } }\n\t},\n\t{\n\t\ttitle: 'Configuration',\n\t\tdescription: 'Configure the system settings.',\n\t\tkeywords: ['configuration', 'settings', 'system', 'setup'],\n\t\ttriggers: { 'Go to Configuration': { path: '/config' } }\n\t},\n\t{\n\t\ttitle: 'System Builder',\n\t\tdescription: 'Build and customize your collections.',\n\t\tkeywords: ['builder', 'category', 'collection', 'configuration', 'settings', 'system', 'permissions'],\n\t\ttriggers: { 'Go to System Builder': { path: '/config/collectionbuilder' } }\n\t},\n\t{\n\t\ttitle: 'Access Management',\n\t\tdescription: 'Manage user access and permissions.',\n\t\tkeywords: ['access', 'management', 'permissions', 'roles', 'users', 'security'],\n\t\ttriggers: {\n\t\t\t'Go to Access Management': { path: '/config/accessManagement' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Roles',\n\t\tdescription: 'Manage user roles in the system.',\n\t\tkeywords: ['roles', 'user roles', 'permissions', 'access', 'security'],\n\t\ttriggers: {\n\t\t\t'Manage Roles': { path: '/config/accessManagement/roles' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Permissions',\n\t\tdescription: 'Configure and manage system permissions.',\n\t\tkeywords: ['permissions', 'access control', 'security', 'roles'],\n\t\ttriggers: {\n\t\t\t'Manage Permissions': { path: '/config/accessManagement/permissions' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Theme Management',\n\t\tdescription: 'Customize the look and feel of your site.',\n\t\tkeywords: ['theme', 'appearance', 'design', 'colors', 'layout', 'customize'],\n\t\ttriggers: {\n\t\t\t'Customize Theme': { path: '/config/themeManagement' }\n\t\t}\n\t},\n\t{\n\t\ttitle: 'Widget Management',\n\t\tdescription: 'Extend the functionality of your site.',\n\t\tkeywords: ['widget', 'extension', 'customization', 'plugins'],\n\t\ttriggers: {\n\t\t\t'Customize Widget': { path: '/config/widgetManagement' }\n\t\t}\n\t}\n]);\n\nlogger.info('Global search index initialized');\n\n// Function to add new items to the global search index\nexport function addToGlobalSearchIndex(newItem: SearchData) {\n\tglobalSearchIndex.update((currentIndex) => [...currentIndex, newItem]);\n\tlogger.info(`Added new item to global search index: ${newItem.title}`);\n}\n\n// Function to search the global index\nexport function searchGlobalIndex(query: string): SearchData[] {\n\tlet results: SearchData[] = [];\n\tglobalSearchIndex.subscribe((index) => {\n\t\tresults = index.filter(\n\t\t\t(item) =>\n\t\t\t\titem.title.toLowerCase().includes(query.toLowerCase()) ||\n\t\t\t\titem.description.toLowerCase().includes(query.toLowerCase()) ||\n\t\t\t\titem.keywords.some((keyword) => keyword.toLowerCase().includes(query.toLowerCase()))\n\t\t);\n\t})();\n\treturn results;\n}\n\n// Initialize the global search functionality\nexport function initializeGlobalSearch() {\n\t// This function can be called to set up any necessary event listeners or initial state\n\tlogger.info('Global search functionality initialized');\n}\n","<!-- \n@file src/routes/(app)/user/+page.svelte\n@component\n**This file sets up and displays the user page, providing a streamlined interface for managing user accounts and settings**\n\n@example\n<User />\n\n### Props\n- `users` {array} - Array of users\n\n### Features\n- Displays a list of users\n- Provides a user-friendly interface for managing user accounts and settings\n-->\n\n<script lang=\"ts\">\n\timport { invalidateAll } from '$app/navigation';\n\timport { onMount } from 'svelte';\n\t// Auth\n\t// Auth\n\timport { ModalTwoFactorAuth, AdminArea, ModalEditAvatar, ModalEditForm } from '@cms/user';\n\t// ParaglideJS\n\timport * as m from '@shared/paraglide/messages';\n\n\t// Stores\n\timport { avatarSrc } from '@shared/stores/store.svelte';\n\timport { triggerActionStore } from '@shared/utils/globalSearchIndex';\n\t// Components\n\timport PageTitle from '@cms/components/PageTitle.svelte';\n\timport PermissionGuard from '@cms/components/PermissionGuard.svelte';\n\t// Skeleton\n\timport { Avatar } from '@skeletonlabs/skeleton-svelte';\n\timport { setCollection } from '@shared/stores/collectionStore.svelte';\n\timport { modalState } from '@shared/utils/modalState.svelte';\n\timport { showConfirm } from '@shared/utils/modalUtils';\n\timport { toaster } from '@shared/stores/store.svelte';\n\n\t// Props\n\tconst { data } = $props();\n\tconst { user: serverUser, isFirstUser, isMultiTenant, is2FAEnabledGlobal } = $derived(data);\n\n\t// Make user data reactive\n\tconst user = $derived({\n\t\t_id: serverUser?._id ?? '',\n\t\temail: serverUser?.email ?? '',\n\t\tusername: serverUser?.username ?? '',\n\t\trole: serverUser?.role ?? '',\n\t\tavatar: serverUser?.avatar ?? '/Default_User.svg',\n\t\ttenantId: serverUser?.tenantId ?? '', // Add tenantId\n\t\tis2FAEnabled: serverUser?.is2FAEnabled ?? false,\n\t\tpermissions: []\n\t});\n\n\t// Define password as state\n\tlet password = $state('hash-password');\n\n\t// Function to open 2FA modal\n\tfunction open2FAModal(): void {\n\t\tmodalState.trigger(ModalTwoFactorAuth, { user }, async (r: any) => {\n\t\t\tif (r) {\n\t\t\t\t// Refresh user data after 2FA changes\n\t\t\t\tawait invalidateAll();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Function to execute actions\n\tfunction executeActions() {\n\t\tconst actions = $triggerActionStore;\n\t\tif (actions.length === 1) {\n\t\t\tactions[0]();\n\t\t} else {\n\t\t\tfor (const action of actions) {\n\t\t\t\taction();\n\t\t\t}\n\t\t}\n\t\ttriggerActionStore.set([]);\n\t}\n\n\t// Execute actions on mount if triggerActionStore has data\n\tonMount(() => {\n\t\tif ($triggerActionStore.length > 0) {\n\t\t\texecuteActions();\n\t\t}\n\t\tsetCollection(null);\n\n\t\t// Note: Avatar initialization is handled by the layout component\n\t\t// to ensure consistent avatar state across the application\n\t});\n\n\t// Modal Trigger - User Form\n\tfunction modalUserForm(): void {\n\t\tmodalState.trigger(ModalEditForm, {\n\t\t\ttitle: m.adminarea_title(),\n\t\t\tbody: m.usermodaluser_settingbody() || 'Update your user details below.'\n\t\t});\n\t}\n\n\t// Modal Trigger - Edit Avatar\n\tfunction modalEditAvatar(): void {\n\t\tmodalState.trigger(\n\t\t\tModalEditAvatar,\n\t\t\t{\n\t\t\t\ttitle: m.usermodaluser_settingtitle(),\n\t\t\t\tbody: m.usermodaluser_settingbody()\n\t\t\t},\n\t\t\tasync (r: any) => {\n\t\t\t\tif (r) {\n\t\t\t\t\ttoaster.success({\n\t\t\t\t\t\tdescription: '<iconify-icon icon=\"radix-icons:avatar\" color=\"white\" width=\"26\" class=\"mr-1\"></iconify-icon> Avatar Updated'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t// Modal Confirm\n\tfunction modalConfirm(): void {\n\t\tshowConfirm({\n\t\t\ttitle: m.usermodalconfirmtitle(),\n\t\t\tbody: m.usermodalconfirmbody(),\n\t\t\t// confirmText: m.usermodalconfirmdeleteuser(),\n\t\t\tonConfirm: async () => {\n\t\t\t\tconst res = await fetch(`/api/user/deleteUsers`, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\tbody: JSON.stringify([user])\n\t\t\t\t});\n\t\t\t\tif (res.status === 200) {\n\t\t\t\t\tawait invalidateAll();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t// Helper to normalize avatar URL\n\tfunction normalizeAvatarUrl(url: string | null | undefined): string {\n\t\tif (!url) return '/Default_User.svg';\n\t\tif (url.startsWith('data:')) return url;\n\n\t\t// 1. Remove leading slashes\n\t\tlet clean = url.replace(/^\\/+/, '');\n\t\t// 2. Remove prefixes\n\t\tclean = clean.replace(/^mediaFolder\\//, '').replace(/^files\\//, '');\n\t\t// 3. Remove leading slashes again just in case\n\t\tclean = clean.replace(/^\\/+/, '');\n\n\t\treturn `/files/${clean}?t=${Date.now()}`;\n\t}\n</script>\n\n<!-- Page Title with Back Button -->\n<PageTitle name={m.userpage_title()} icon=\"mdi:account-circle\" showBackButton={true} backUrl=\"/config\" />\n\n<div class=\"max-h-[calc(100vh-65px)] overflow-auto\">\n\t<div class=\"wrapper mb-2\">\n\t\t<div class=\"grid grid-cols-1 grid-rows-2 gap-1 overflow-hidden md:grid-cols-2 md:grid-rows-1\">\n\t\t\t<!-- Avatar with user info -->\n\t\t\t<div class=\"relative flex flex-col items-center justify-center gap-1\">\n\t\t\t\t<div class=\"relative group\">\n\t\t\t\t\t<Avatar class=\"w-32 h-32 rounded-full border border-white shadow-lg dark:border-surface-800\">\n\t\t\t\t\t\t<Avatar.Image src={normalizeAvatarUrl(avatarSrc.value)} class=\"object-cover\" />\n\t\t\t\t\t\t<Avatar.Fallback>AV</Avatar.Fallback>\n\t\t\t\t\t</Avatar>\n\n\t\t\t\t\t<!-- Edit button - icon overlay -->\n\t\t\t\t\t<button\n\t\t\t\t\t\tonclick={modalEditAvatar}\n\t\t\t\t\t\tclass=\"absolute bottom-0 right-0 p-2 rounded-full gradient-tertiary dark:gradient-primary btn-icon\"\n\t\t\t\t\t\ttitle={m.userpage_editavatar()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<iconify-icon icon=\"mdi:pencil\" width=\"18\"></iconify-icon>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<!-- User ID -->\n\t\t\t\t<div class=\"gradient-secondary badge mt-1 w-full max-w-xs text-white\">\n\t\t\t\t\t{m.userpage_user_id()}<span class=\"ml-2\">{user?._id || 'N/A'}</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- Role -->\n\t\t\t\t<div class=\"gradient-tertiary badge w-full max-w-xs text-white\">\n\t\t\t\t\t{m.role()}<span class=\"ml-2\">{user?.role || 'N/A'}</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- Two-Factor Authentication Status -->\n\t\t\t\t{#if is2FAEnabledGlobal}\n\t\t\t\t\t<button onclick={open2FAModal} class=\"btn preset-outlined btn-sm w-full max-w-xs\">\n\t\t\t\t\t\t<div class=\"flex w-full items-center justify-between\">\n\t\t\t\t\t\t\t<span>Two-Factor Auth</span>\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t<iconify-icon\n\t\t\t\t\t\t\t\t\ticon=\"mdi:{user?.is2FAEnabled ? 'shield-check' : 'shield-off'}\"\n\t\t\t\t\t\t\t\t\twidth=\"20\"\n\t\t\t\t\t\t\t\t\tclass={user?.is2FAEnabled ? 'text-primary-500' : 'text-error-500'}\n\t\t\t\t\t\t\t\t></iconify-icon>\n\t\t\t\t\t\t\t\t<span class=\"text-xs\">{user?.is2FAEnabled ? 'Enabled' : 'Disabled'}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t\t<!-- Tenant ID -->\n\t\t\t\t{#if isMultiTenant}\n\t\t\t\t\t<div class=\"gradient-primary badge w-full max-w-xs text-white\">\n\t\t\t\t\t\tTenant ID:<span class=\"ml-2\">{user?.tenantId || 'N/A'}</span>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t\t<!-- Permissions List -->\n\t\t\t\t{#each user.permissions as permission}\n\t\t\t\t\t<div class=\"gradient-primary badge mt-1 w-full max-w-xs text-white\">\n\t\t\t\t\t\t{permission}\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<!-- User fields -->\n\t\t\t{#if user}\n\t\t\t\t<form>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t{m.username()}:\n\t\t\t\t\t\t<input value={user.username} name=\"username\" type=\"text\" autocomplete=\"username\" disabled class=\"input\" />\n\t\t\t\t\t</label>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t{m.email()}:\n\t\t\t\t\t\t<input value={user.email} name=\"email\" type=\"email\" autocomplete=\"email\" disabled class=\"input\" />\n\t\t\t\t\t</label>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t{m.form_password()}:\n\t\t\t\t\t\t<input bind:value={password} name=\"password\" type=\"password\" autocomplete=\"current-password\" disabled class=\"input\" />\n\t\t\t\t\t</label>\n\n\t\t\t\t\t<div class=\"mt-4 flex flex-col justify-between gap-2 sm:flex-row sm:gap-1\">\n\t\t\t\t\t\t<!-- Edit Modal Button -->\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={modalUserForm}\n\t\t\t\t\t\t\taria-label={m.userpage_edit_usersetting()}\n\t\t\t\t\t\t\tclass=\"gradient-tertiary btn w-full max-w-sm text-white {isFirstUser ? '' : 'mx-auto md:mx-0'}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<iconify-icon icon=\"bi:pencil-fill\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>{m.userpage_edit_usersetting()}\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<!-- Delete Modal Button -->\n\t\t\t\t\t\t{#if isFirstUser}\n\t\t\t\t\t\t\t<button onclick={modalConfirm} aria-label={m.button_delete()} class=\"gradient-error btn w-full max-w-sm text-white\">\n\t\t\t\t\t\t\t\t<iconify-icon icon=\"bi:trash3-fill\" color=\"white\" width=\"18\" class=\"mr-1\"></iconify-icon>\n\t\t\t\t\t\t\t\t{m.button_delete()}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\n\t<!-- Admin area -->\n\t<PermissionGuard\n\t\tconfig={{\n\t\t\tname: 'Admin Area Access',\n\t\t\tcontextId: 'config/adminArea',\n\t\t\taction: 'manage',\n\t\t\tcontextType: 'system',\n\t\t\tdescription: 'Allows access to admin area for user management'\n\t\t}}\n\t\tsilent={true}\n\t>\n\t\t<div class=\"wrapper2\">\n\t\t\t<AdminArea currentUser={{ ...user }} {isMultiTenant} roles={data.roles} />\n\t\t</div>\n\t</PermissionGuard>\n</div>\n"],"file":"23.D3_gC4DP.js"}