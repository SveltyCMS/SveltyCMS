---
path: 'apps/docs/architecture/workspace-structure.mdx'
title: 'Workspace Structure'
description: 'Complete overview of the SveltyCMS NX monorepo workspace structure.'
order: 2
icon: 'mdi:file-tree'
author: 'admin'
created: '2025-10-21'
updated: '2025-10-21'
tags:
  - 'architecture'
  - 'workspace'
  - 'nx-monorepo'
  - 'file-structure'
---

# Workspace Structure

This document describes the NX monorepo workspace structure for SveltyCMS.

---

## Overview

The workspace uses **NX for task orchestration** and **Bun workspaces** for dependency management. The structure follows a monorepo pattern with all applications under `apps/`.

---

## Key Principles

1. **App isolation** - Each app manages its own config, logs, and resources
2. **Shared theme** - All apps use `apps/shared-theme/` for consistent UI
3. **No duplication** - Each file/folder exists in only one location
4. **Relative paths** - Apps use local paths (`./config`) not workspace root paths (`../../config`)
5. **Standalone setup** - Setup wizard is separate app, not embedded in CMS

---

## Directory Structure

```
SveltyCMS/                           # Workspace root
â”œâ”€â”€ apps/                            # All applications
â”‚   â”œâ”€â”€ cms/                         # Main CMS application
â”‚   â”‚   â”œâ”€â”€ config/                  # CMS-specific config
â”‚   â”‚   â”‚   â”œâ”€â”€ private.ts           # DB credentials (created by setup)
â”‚   â”‚   â”‚   â”œâ”€â”€ roles.ts             # User roles
â”‚   â”‚   â”‚   â””â”€â”€ collections/         # Collection schemas
â”‚   â”‚   â”œâ”€â”€ compiledCollections/     # Auto-generated from config
â”‚   â”‚   â”œâ”€â”€ logs/                    # CMS logs
â”‚   â”‚   â”œâ”€â”€ src/                     # CMS source code
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/              # SvelteKit routes (NO /setup route)
â”‚   â”‚   â”‚   â”œâ”€â”€ components/          # Svelte components
â”‚   â”‚   â”‚   â”œâ”€â”€ databases/           # Database adapters
â”‚   â”‚   â”‚   â”œâ”€â”€ stores/              # Svelte stores
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/               # Utility functions
â”‚   â”‚   â”‚   â””â”€â”€ widgets/             # Widget implementations
â”‚   â”‚   â”œâ”€â”€ static/                  # Static assets
â”‚   â”‚   â”œâ”€â”€ package.json             # CMS dependencies
â”‚   â”‚   â”œâ”€â”€ vite.config.ts           # Vite config (local paths)
â”‚   â”‚   â”œâ”€â”€ svelte.config.js         # SvelteKit config
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts       # Tailwind config
â”‚   â”‚   â”œâ”€â”€ project.json             # NX project config
â”‚   â”‚   â””â”€â”€ tsconfig.json            # TypeScript config
â”‚   â”‚
â”‚   â”œâ”€â”€ setup/                       # Setup wizard (standalone)
â”‚   â”‚   â”œâ”€â”€ logs/                    # Setup logs
â”‚   â”‚   â”œâ”€â”€ src/                     # Setup source
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/              # Setup wizard routes (to be moved from CMS)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ +page.svelte     # Main wizard UI
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ api/             # Setup API endpoints
â”‚   â”‚   â”‚   â””â”€â”€ lib/                 # Shared utilities
â”‚   â”‚   â”‚       â””â”€â”€ utils/
â”‚   â”‚   â”‚           â””â”€â”€ writeConfig.ts  # Write to ../cms/config/private.ts
â”‚   â”‚   â”œâ”€â”€ package.json             # Setup dependencies
â”‚   â”‚   â”œâ”€â”€ vite.config.ts           # Port 5173, @cms alias
â”‚   â”‚   â”œâ”€â”€ svelte.config.js         # SvelteKit + adapter-node
â”‚   â”‚   â”œâ”€â”€ project.json             # NX: setup-wizard
â”‚   â”‚   â””â”€â”€ tsconfig.json            # TypeScript config
â”‚   â”‚
â”‚   â”œâ”€â”€ shared-theme/                # Shared UI theme
â”‚   â”‚   â”œâ”€â”€ theme.ts                 # Theme configuration
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts       # Tailwind v4 config
â”‚   â”‚   â”œâ”€â”€ postcss.config.js        # PostCSS config
â”‚   â”‚   â”œâ”€â”€ index.js                 # Main export
â”‚   â”‚   â”œâ”€â”€ package.json             # Peer dependencies
â”‚   â”‚   â””â”€â”€ README.md                # Usage instructions
â”‚   â”‚
â”‚   â”œâ”€â”€ docs/                        # Documentation site
â”‚   â”‚   â”œâ”€â”€ architecture/            # Architecture docs
â”‚   â”‚   â”‚   â”œâ”€â”€ dual-branch-strategy.mdx
â”‚   â”‚   â”‚   â”œâ”€â”€ workspace-structure.mdx  # This file
â”‚   â”‚   â”‚   â”œâ”€â”€ setup-wizard-architecture.mdx
â”‚   â”‚   â”‚   â”œâ”€â”€ initialization-workflow.mdx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ api/                     # API reference
â”‚   â”‚   â”œâ”€â”€ contributing/            # Contributor guides
â”‚   â”‚   â”‚   â””â”€â”€ contributing-docs.mdx
â”‚   â”‚   â”œâ”€â”€ database/                # Database docs
â”‚   â”‚   â”œâ”€â”€ guides/                  # How-to guides
â”‚   â”‚   â”œâ”€â”€ testing/                 # Testing docs
â”‚   â”‚   â”œâ”€â”€ widgets/                 # Widget system docs
â”‚   â”‚   â”œâ”€â”€ src/                     # Docs site source
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/              # SvelteKit routes
â”‚   â”‚   â”‚   â””â”€â”€ lib/                 # Components
â”‚   â”‚   â”œâ”€â”€ static/docs/             # Static assets for docs
â”‚   â”‚   â”œâ”€â”€ package.json             # Docs dependencies
â”‚   â”‚   â”œâ”€â”€ vite.config.ts           # Port 5174
â”‚   â”‚   â”œâ”€â”€ svelte.config.js         # SvelteKit + MDsveX
â”‚   â”‚   â”œâ”€â”€ project.json             # NX: docs
â”‚   â”‚   â””â”€â”€ tsconfig.json            # TypeScript config
â”‚   â”‚
â”‚   â”œâ”€â”€ tests/                       # Test suites
â”‚   â”‚   â”œâ”€â”€ bun/                     # Bun unit tests
â”‚   â”‚   â”œâ”€â”€ playwright/              # E2E tests
â”‚   â”‚   â”œâ”€â”€ ci-config/               # CI configuration
â”‚   â”‚   â”œâ”€â”€ package.json             # Test dependencies
â”‚   â”‚   â””â”€â”€ project.json             # NX: tests
â”‚   â”‚
â”‚   â””â”€â”€ scripts/                     # Utility scripts
â”‚       â”œâ”€â”€ bundle-stats.js          # Analyze bundle size
â”‚       â”œâ”€â”€ check-mongodb.js         # Check MongoDB connection
â”‚       â”œâ”€â”€ package.json             # Script dependencies
â”‚       â””â”€â”€ project.json             # NX: scripts
â”‚
â”œâ”€â”€ .github/                         # GitHub Actions
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ auto-release.yaml        # Semantic release (both branches)
â”‚       â”œâ”€â”€ playwright.yml           # E2E tests (next branch)
â”‚       â””â”€â”€ docs-lint.yml            # Lint docs (next branch)
â”‚
â”œâ”€â”€ node_modules/                    # Root dependencies
â”œâ”€â”€ package.json                     # Root package.json (workspaces)
â”œâ”€â”€ bun.lock                         # Lockfile
â”œâ”€â”€ nx.json                          # NX configuration
â”œâ”€â”€ tsconfig.json                    # Root TypeScript config
â”œâ”€â”€ eslint.config.js                 # Root ESLint config
â”œâ”€â”€ .gitignore                       # Git ignore patterns
â”‚
â”œâ”€â”€ README.md                        # Project README
â”œâ”€â”€ CONTRIBUTING.md                  # Contribution guidelines
â”œâ”€â”€ CODE-OF-CONDUCT.md               # Code of conduct
â”œâ”€â”€ SECURITY.md                      # Security policy
â”œâ”€â”€ CHANGELOG.md                     # Change log
â””â”€â”€ LICENSE                          # MIT License
```

---

## App-Specific Resources

Each app manages its own resources:

### CMS (`apps/cms/`)

- **Config**: `./config/` - Database credentials, roles, collections
- **Compiled**: `./compiledCollections/` - Auto-generated from config
- **Logs**: `./logs/` - CMS-specific logs
- **Port**: 5173 (default)

### Setup (`apps/setup/`)

- **Logs**: `./logs/` - Setup wizard logs
- **Port**: 5173 (runs first, before CMS)
- **Cross-app write**: Writes to `../cms/config/private.ts`

### Docs (`apps/docs/`)

- **Documentation**: All MDX files in subdirectories
- **Assets**: `./static/docs/` - Images, diagrams
- **Port**: 5174
- **Logs**: `./logs/` - Docs site logs

### Shared Theme (`apps/shared-theme/`)

- **No runtime**: Library only, imported by other apps
- **Exports**: `theme.ts`, `tailwind.config.ts`, `postcss.config.js`

### Tests (`apps/tests/`)

- **Bun tests**: `./bun/`
- **Playwright tests**: `./playwright/`
- **CI configs**: `./ci-config/`

### Scripts (`apps/scripts/`)

- **Utility scripts**: Bundle analysis, MongoDB checks
- **Build tools**: Custom build scripts

---

## Workspace Root Files

### Configuration

| File               | Purpose                            |
| ------------------ | ---------------------------------- |
| `package.json`     | Root package with workspaces array |
| `nx.json`          | NX task orchestration config       |
| `tsconfig.json`    | Root TypeScript configuration      |
| `eslint.config.js` | Root ESLint rules                  |
| `.gitignore`       | Git ignore patterns                |
| `bun.lock`         | Dependency lockfile                |

### Documentation (Root Level)

| File                 | Purpose                       |
| -------------------- | ----------------------------- |
| `README.md`          | Project overview, quick start |
| `CONTRIBUTING.md`    | How to contribute             |
| `CODE-OF-CONDUCT.md` | Community guidelines          |
| `SECURITY.md`        | Security policy               |
| `CHANGELOG.md`       | Version history               |
| `LICENSE`            | MIT License                   |

**Note**: Architecture docs moved to `apps/docs/architecture/`

---

## Path Resolution Strategy

### âŒ Old (Root-Based)

```typescript
// apps/cms/vite.config.ts
const paths = {
	config: path.resolve(CWD, '../../config'), // BAD
	compiledCollections: path.resolve(CWD, '../../compiledCollections') // BAD
};
```

### âœ… New (App-Local)

```typescript
// apps/cms/vite.config.ts
const paths = {
	config: path.resolve(CWD, './config'), // GOOD
	compiledCollections: path.resolve(CWD, './compiledCollections') // GOOD
};
```

### Cross-App References (Setup â†’ CMS)

```typescript
// apps/setup/src/lib/utils/writeConfig.ts
const cmsConfigPath = path.resolve(
	process.cwd(), // apps/setup
	'../cms/config/private.ts' // â†’ apps/cms/config/private.ts
);
```

---

## NX Project Graph

```mermaid
graph TB
    CMS[cms]
    SETUP[setup]
    THEME[shared-theme]
    DOCS[docs]
    TESTS[tests]
    SCRIPTS[scripts]

    CMS -.->|imports| THEME
    SETUP -.->|imports| THEME
    SETUP -.->|writes to| CMS
    DOCS -.->|imports| THEME
    TESTS -.->|tests| CMS
    TESTS -.->|tests| SETUP
    SCRIPTS -.->|analyzes| CMS

    style CMS fill:#e0f0e0
    style SETUP fill:#f0e0e0
    style THEME fill:#e0e0f0
    style DOCS fill:#f0f0e0
```

---

## Workspace Commands

### Development

```bash
# Individual apps
nx dev cms              # CMS on port 5173
nx dev setup            # Setup on port 5173
nx dev docs             # Docs on port 5174

# Multiple apps
nx run-many --target=dev --projects=cms,docs
```

### Building

```bash
# Individual apps
nx build cms
nx build setup
nx build docs

# All apps
nx run-many --target=build --all
```

### Testing

```bash
# All tests
nx test tests

# Specific test suites
nx run tests:test:bun
nx run tests:test:playwright
```

### Utilities

```bash
# Bundle analysis
nx run scripts:bundle-stats

# MongoDB check
nx run scripts:check-mongodb
```

---

## Package.json Workspaces

### Main Branch

```json
{
	"workspaces": ["apps/cms", "apps/setup", "apps/shared-theme"]
}
```

### Next Branch (Development)

```json
{
	"workspaces": ["apps/cms", "apps/setup", "apps/shared-theme", "apps/docs", "apps/tests", "apps/scripts"]
}
```

---

## Migration Notes

### From Old Structure

**What changed:**

- `config/` â†’ `apps/cms/config/`
- `compiledCollections/` â†’ `apps/cms/compiledCollections/`
- `logs/` â†’ Per-app logs folders
- `tests/` â†’ `apps/tests/`
- `scripts/` â†’ `apps/scripts/`
- `docs/` â†’ `apps/docs/`
- Setup routes â†’ Moving to `apps/setup/` (in progress)

**What stayed:**

- Root configuration files (package.json, nx.json, etc.)
- Community files (README.md, CONTRIBUTING.md, etc.)

---

## Related Documentation

- [Dual-Branch Strategy](./dual-branch-strategy.mdx)
- [NX Migration Complete](./nx-migration-complete.mdx)
- [Standalone Setup Migration](./standalone-setup-migration.mdx)
- [Contributing Documentation](../contributing/contributing-docs.mdx)

---

## Summary

The SveltyCMS workspace is organized as an **NX monorepo** with:

- âœ… **App isolation** - Each app manages its own resources
- âœ… **Shared theme** - Consistent UI across all apps
- âœ… **Standalone setup** - Reduced CMS bundle size (~500KB)
- âœ… **Dual-branch strategy** - Simple for users, powerful for developers
- âœ… **Clear separation** - No mixed concerns between apps
- âœ… **NX orchestration** - Efficient task running and caching

This structure scales well while maintaining simplicity for end users! ðŸš€
