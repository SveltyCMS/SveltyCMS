---
path: 'apps/docs/architecture/dual-branch-strategy.mdx'
title: 'Dual-Branch Strategy'
description: 'Understanding the main vs next branch strategy for SveltyCMS development and deployment.'
order: 1
icon: 'mdi:source-branch'
author: 'admin'
created: '2025-10-21'
updated: '2025-10-21'
tags:
  - 'architecture'
  - 'git'
  - 'workflow'
  - 'nx-monorepo'
  - 'deployment'
---

# SveltyCMS Dual-Branch Strategy

This document explains the dual-branch strategy for SveltyCMS, which separates end-user simplicity from developer power.

---

## Branch Structure

### `main` Branch - End Users (Production)

**Target**: CMS users who want a simple, ready-to-use CMS

**Contains**:

- âœ… `apps/cms/` - Main CMS application
- âœ… `apps/setup/` - Setup wizard
- âœ… `apps/shared-theme/` - Shared UI theme
- âœ… Root configuration files

**Excluded from main**:

- âŒ `apps/docs/` - Documentation site
- âŒ `apps/tests/` - Test suites
- âŒ `apps/scripts/` - Development scripts
- âŒ NX monorepo tooling
- âŒ Development workflows

**User Experience**:

```bash
git clone https://github.com/SveltyCMS/SveltyCMS.git
cd SveltyCMS
bun install
bun run dev
```

### `next` Branch - Developers (Full Monorepo)

**Target**: Open source contributors and advanced developers

**Contains**:

- âœ… `apps/cms/` - CMS application
- âœ… `apps/setup/` - Setup wizard (standalone)
- âœ… `apps/shared-theme/` - Shared theme
- âœ… `apps/docs/` - Documentation site (SvelteKit + MDX)
- âœ… `apps/tests/` - Test suites (Bun, Playwright)
- âœ… `apps/scripts/` - Utility scripts
- âœ… Full NX monorepo setup
- âœ… All development workflows
- âœ… CI/CD configurations

**Developer Experience**:

```bash
git clone -b next https://github.com/SveltyCMS/SveltyCMS.git
cd SveltyCMS
bun install

# Use NX for all operations
nx dev cms
nx dev docs
nx test tests
nx run scripts:bundle-stats
```

---

## Workspace Structure

```
SveltyCMS/                           # Workspace root
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ cms/                         # Main CMS (both branches)
â”‚   â”œâ”€â”€ setup/                       # Setup wizard (both branches)
â”‚   â”œâ”€â”€ shared-theme/                # Shared UI theme (both branches)
â”‚   â”œâ”€â”€ docs/                        # Documentation (next only)
â”‚   â”œâ”€â”€ tests/                       # Test suites (next only)
â”‚   â””â”€â”€ scripts/                     # Utility scripts (next only)
â”œâ”€â”€ .github/                         # CI/CD workflows
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ auto-release.yaml        # Runs on both branches
â”‚       â”œâ”€â”€ playwright.yml           # next only
â”‚       â””â”€â”€ docs-lint.yml            # next only
â”œâ”€â”€ nx.json                          # NX config (next only)
â”œâ”€â”€ package.json                     # Workspaces configured per branch
â””â”€â”€ README.md                        # Branch-specific instructions
```

---

## Package.json Workspaces

### Main Branch

```json
{
	"workspaces": ["apps/cms", "apps/setup", "apps/shared-theme"]
}
```

### Next Branch

```json
{
	"workspaces": ["apps/cms", "apps/setup", "apps/shared-theme", "apps/docs", "apps/tests", "apps/scripts"]
}
```

---

## NX Projects (next branch only)

All apps are NX projects with proper `project.json`:

| Project          | Description                                   | Port |
| ---------------- | --------------------------------------------- | ---- |
| **cms**          | Main CMS application                          | 5173 |
| **setup**        | Standalone setup wizard                       | 5173 |
| **shared-theme** | Shared Tailwind v4 + Skeleton v4 theme        | N/A  |
| **docs**         | SvelteKit documentation with MDX              | 5174 |
| **tests**        | Bun and Playwright tests                      | N/A  |
| **scripts**      | Utility scripts (bundle-stats, check-mongodb) | N/A  |

---

## Shared Theme Strategy

All apps use the same theme from `apps/shared-theme/`:

**Shared Dependencies** (in shared-theme):

- Tailwind CSS v4
- Skeleton Labs v4
- ParaglideJS (i18n)
- Shared color palette
- Typography settings
- Component presets

**Apps Import Theme**:

```typescript
// In apps/cms/tailwind.config.ts
import sharedConfig from '../shared-theme/tailwind.config';

export default {
	...sharedConfig,
	content: ['./src/**/*.{html,js,svelte,ts}', '../shared-theme/**/*.{html,js,svelte,ts}']
};
```

---

## Release Strategy

### Main Branch Releases

- **Semantic versioning** based on commits
- **Auto-release** via GitHub Actions
- **Clean structure** - Only production code
- **Simple updates**: Users just `git pull`

### Next Branch Development

- **All features** developed here first
- **Full testing** with NX
- **Documentation** updates
- **Merge to main** when stable

---

## Migration Path

### From main to next (for developers)

```bash
# Switch to development branch
git fetch origin
git checkout next
bun install

# Run multiple apps
nx run-many --target=dev --projects=cms,docs
```

### From next to main (for releases)

```bash
# Merge tested changes to production
git checkout main
git merge next --no-ff

# GitHub Actions auto-releases
# Semantic versioning based on commit messages
```

---

## File Organization Rules

### Must be in Both Branches

- `apps/cms/` - Core CMS
- `apps/setup/` - Setup wizard
- `apps/shared-theme/` - UI theme
- `package.json` - Dependencies
- `.github/workflows/auto-release.yaml` - Release automation

### Next Branch Only

- `apps/docs/` - Documentation
- `apps/tests/` - Tests
- `apps/scripts/` - Dev scripts
- `nx.json` - NX configuration
- `.github/workflows/playwright.yml`
- `.github/workflows/docs-lint.yml`

---

## Benefits

### For End Users (main)

- âœ… Simple structure
- âœ… Fast clone/install
- âœ… No dev tooling overhead
- âœ… Clear documentation
- âœ… Easy updates
- âœ… ~500KB smaller (no setup embedded in CMS)

### For Developers (next)

- âœ… Full NX monorepo benefits
- âœ… Comprehensive testing
- âœ… Documentation site
- âœ… Utility scripts
- âœ… Advanced workflows
- âœ… Better DX (Developer Experience)

---

## Commands Summary

### Main Branch (Users)

```bash
# Start CMS
bun run dev

# Build for production
bun run build

# Preview production build
bun run preview
```

### Next Branch (Developers)

#### CMS Development

```bash
nx dev cms              # Start CMS dev server
nx build cms            # Build CMS for production
nx preview cms          # Preview CMS build
```

#### Setup Wizard (Standalone)

```bash
nx dev setup            # Start setup wizard (port 5173)
nx build setup          # Build setup wizard
```

#### Documentation

```bash
nx dev docs             # Start docs site (port 5174)
nx build docs           # Build docs site
```

#### Testing

```bash
nx test tests           # Run all tests
nx run tests:test:bun   # Run Bun tests only
nx run tests:test:playwright  # Run Playwright tests only
```

#### Utilities

```bash
nx run scripts:bundle-stats      # Analyze bundle size
nx run scripts:check-mongodb     # Check MongoDB connection
```

#### Multiple Projects

```bash
# Build all projects
nx run-many --target=build --all

# Dev mode for CMS + docs
nx run-many --target=dev --projects=cms,docs

# Test all projects
nx run-many --target=test --all
```

---

## Architecture Diagrams

### Main Branch (Simple)

```mermaid
graph TB
    A[User clones main] --> B[bun install]
    B --> C{What to do?}
    C -->|First time| D[bun run setup]
    C -->|Normal use| E[bun run dev]
    D --> F[CMS Ready]
    E --> F

    style A fill:#e0f0e0
    style F fill:#e0e0f0
```

### Next Branch (Full Monorepo)

```mermaid
graph TB
    A[Developer clones next] --> B[bun install]
    B --> C{Choose Task}
    C -->|CMS Dev| D[nx dev cms]
    C -->|Docs| E[nx dev docs]
    C -->|Tests| F[nx test tests]
    C -->|Build All| G[nx run-many --target=build --all]

    D --> H[Development Environment]
    E --> H
    F --> H
    G --> I[Production Builds]

    style A fill:#f0e0e0
    style H fill:#e0f0e0
    style I fill:#e0e0f0
```

---

## Contributing Workflow

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant Next as next branch
    participant CI as GitHub Actions
    participant Main as main branch
    participant NPM as npm registry

    Dev->>Next: 1. Create feature branch
    Dev->>Next: 2. Make changes
    Dev->>Next: 3. Run nx test
    Dev->>Next: 4. Submit PR
    CI->>Next: 5. Run tests
    CI->>Next: 6. Lint docs
    Next->>Main: 7. Merge when stable
    CI->>Main: 8. Auto-release
    CI->>NPM: 9. Publish package
```

---

## Contributing

1. **Fork** the repository
2. **Checkout** the `next` branch
3. **Create** a feature branch from `next`
4. **Make** changes
5. **Test** with NX commands
6. **Update** documentation if needed
7. **Submit** PR to `next` branch

Changes are merged to `main` during releases.

---

## Branch Protection Rules

### Main Branch

- âœ… Requires PR reviews
- âœ… Requires status checks
- âœ… Auto-release on merge
- âœ… Protected from force push

### Next Branch

- âœ… Requires PR reviews
- âœ… Requires tests to pass
- âœ… Allows force push (for maintainers)
- âœ… Continuous integration

---

## Questions?

- **Main branch issues**: Use for CMS bugs and user-facing features
- **Next branch issues**: Use for dev tooling, docs, tests, monorepo structure
- **Discussions**: For questions, ideas, and feature requests
- **Documentation**: Check `apps/docs/` in next branch

---

## Related Documentation

- [NX Migration Complete](./nx-migration-complete.mdx)
- [Standalone Setup Migration](./standalone-setup-migration.mdx)
- [Contributing Documentation](../contributing/contributing-docs.mdx)
- [Initialization Workflow](./initialization-workflow.mdx)

---

## Summary

**Main**: Simple CMS for users  
**Next**: Full monorepo for developers  
**Result**: Best of both worlds! ðŸš€

This dual-branch strategy allows SveltyCMS to:

- Remain accessible to end users who want simplicity
- Provide powerful development tools for contributors
- Keep bundle sizes optimized (standalone setup wizard)
- Maintain comprehensive testing and documentation
- Scale development without complicating deployment
