---
path: 'docs/architecture/system-settings-architecture.mdx'
title: 'SveltyCMS: System Settings Architecture'
description: 'An overview of how dynamic settings are managed, cached, and synchronized.'
order: 2
icon: 'mdi:tune'
author: 'admin'
created: '2025-10-09'
updated: '2025-10-09'
tags:
  - 'architecture'
  - 'settings'
  - 'system'
  - 'cache'
---

import { Callout } from 'nextra/components';

# System Settings Architecture

This document details the architecture of the SveltyCMS System Settings. The system is designed to be dynamic, performant, and secure, allowing administrators to manage the application's runtime behavior without requiring code deployments.

## Core Principles

1.  **Database as Active Source of Truth:** All active, environment-specific settings (like site names or secret API keys) are stored in the database.
2.  **Filesystem for Defaults:** A `config/seeds.ts` file defines the initial, default values for all system settings, providing a predictable fallback and initial setup state.
3.  **Performant In-Memory Cache:** The `globalSettings.ts` store acts as a high-speed, server-side cache to minimize database queries on every user request.

## The Data Flow

The flow of settings data is unidirectional and designed for optimal performance and consistency.

1.  **Server Startup:** The application calls `loadAndCacheSettings()`, which reads defaults from `seeds.ts`, queries the database for overrides, and loads the final merged settings into the `globalSettings.ts` cache.
2.  **User Request:** A hook or API endpoint needs a setting and reads it directly from the fast, in-memory `globalSettings` cache. No database query is needed.
3.  **Admin Update:** An admin uses the UI to change a setting. The UI sends a `PUT` request to the `/api/settings/[group]` endpoint. The API updates the database and then calls `invalidateSettingsCache()`. The cache is automatically repopulated from the updated database on the next request.

<Callout type="info">
	The `globalSettings.ts` store is a **server-side read cache**. The admin UI **writes directly** to the database via the API and then invalidates
	this cache.
</Callout>

## Interaction with Configuration Management

System Settings are a key part of the overall configuration landscape.

### Exporting (`config:export`)

When a full configuration export is run, the `ConfigExporter` service queries the `system_settings` table and saves all non-secret settings to a file like `/config/sync/system/system.settings.json`.

<Callout type="warning">
	**Security:** The export process must be configured to **exclude** secrets like `SMTP_PASSWORD`. The `_requiredSettings` property on config entities
	helps identify which settings are environment-specific secrets and should not be exported.
</Callout>

### Importing (`config:import`)

When importing configuration to a new environment:

1.  The `ConfigImporter` reads `system.settings.json` and populates the `system_settings` table with the baseline configuration.
2.  As a final step, the `ConfigImporter` calls `invalidateSettingsCache()`. This forces the application to reload its cache with the newly imported settings, bringing the entire system into a fully consistent state.
