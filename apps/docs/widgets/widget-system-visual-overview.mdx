---
path: 'docs/widgets/widget-system-visual-overview.mdx'
title: 'Widget System Visual Overview'
description: 'Complete visual guide to the SveltyCMS widget system with Mermaid diagrams'
order: 0
icon: 'mdi:chart-tree'
author: 'admin'
created: '2025-10-17'
updated: '2025-10-17'
tags:
  - 'widgets'
  - 'visual'
  - 'diagrams'
  - 'overview'
  - 'architecture'
---

# Widget System Visual Overview

This page provides comprehensive visual diagrams explaining how the SveltyCMS widget system functions, from high-level concepts to detailed implementation.

## 🎯 Complete Widget System Flow

```mermaid
graph TB
    subgraph "Development Phase"
        DEV[👨‍💻 Developer Creates Widget]
        FOLDER[📁 Widget Folder Structure]
        PILLARS[🏗️ 3-Pillar Implementation]
        TYPES[📝 TypeScript Definitions]
    end

    subgraph "Discovery & Registration"
        SCAN[🔍 Filesystem Scanner]
        COMPARE[⚖️ Compare with Database]
        REGISTER[📝 Auto-Register New Widgets]
        STORE[🏪 Update Widget Store]
    end

    subgraph "Runtime System"
        COLLECTION[📋 Collection Definition]
        BUILDER[🛠️ Collection Builder UI]
        FORM[📝 Content Form]
        DISPLAY[👁️ Content Display]
    end

    subgraph "Admin Management"
        ADMIN[👑 Admin Interface]
        TOGGLE[🔄 Enable/Disable Widgets]
        TENANT[🏢 Multi-Tenant Config]
        DEPS[🔗 Dependency Management]
    end

    DEV --> FOLDER
    FOLDER --> PILLARS
    PILLARS --> TYPES

    TYPES --> SCAN
    SCAN --> COMPARE
    COMPARE --> REGISTER
    REGISTER --> STORE

    STORE --> COLLECTION
    STORE --> BUILDER
    STORE --> ADMIN

    COLLECTION --> FORM
    FORM --> DISPLAY

    ADMIN --> TOGGLE
    TOGGLE --> TENANT
    TENANT --> DEPS
    DEPS --> STORE

    BUILDER --> COLLECTION

    style DEV fill:#e8f5e8
    style STORE fill:#f3e5f5
    style ADMIN fill:#fff8e1
    style DISPLAY fill:#e1f5fe
```

## 🏗️ 3-Pillar Architecture Deep Dive

```mermaid
graph TD
    subgraph "Widget Definition (Pillar 1)"
        IDX[index.ts<br/>📋 Widget Blueprint]
        CONFIG[createWidget() Configuration]
        VALID[🛡️ Validation Schema]
        GUI[🎨 GuiSchema]
        DEFAULTS[⚙️ Default Values]
        META[📊 Metadata]
    end

    subgraph "Input Component (Pillar 2)"
        INPUT[Input.svelte<br/>✏️ Interactive Editor]
        BIND[🔗 Two-way Binding]
        EVENTS[📡 Event Handling]
        VALIDATE[✅ Live Validation]
        TRANSLATE[🌍 Translation Support]
        UI[🎨 User Interface]
    end

    subgraph "Display Component (Pillar 3)"
        DISPLAY[Display.svelte<br/>👁️ Read-only Viewer]
        RENDER[🖼️ Value Rendering]
        FORMAT[📐 Format Output]
        COMPACT[📦 Compact Mode]
        PERF[⚡ Performance Optimized]
        STYLE[🎨 Styling]
    end

    IDX --> CONFIG
    CONFIG --> VALID
    CONFIG --> GUI
    CONFIG --> DEFAULTS
    CONFIG --> META

    CONFIG --> INPUT
    CONFIG --> DISPLAY

    INPUT --> BIND
    INPUT --> EVENTS
    INPUT --> VALIDATE
    INPUT --> TRANSLATE
    INPUT --> UI

    DISPLAY --> RENDER
    DISPLAY --> FORMAT
    DISPLAY --> COMPACT
    DISPLAY --> PERF
    DISPLAY --> STYLE

    VALID --> VALIDATE
    GUI --> UI
    DEFAULTS --> INPUT
    META --> DISPLAY

    style IDX fill:#e1f5fe
    style INPUT fill:#f3e5f5
    style DISPLAY fill:#e8f5e8
```

## 🔄 Widget Lifecycle & Data Flow

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant FS as Filesystem
    participant Discovery as Widget Discovery
    participant DB as Database
    participant Store as Widget Store
    participant CB as Collection Builder
    participant Form as Content Form
    participant User as End User

    Dev->>FS: Create widget files
    Note over FS: /src/widgets/custom/myWidget/

    FS->>Discovery: App startup triggers scan
    Discovery->>DB: Compare filesystem vs database
    Discovery->>DB: Register new widgets
    Discovery->>Store: Load active widgets

    CB->>Store: Request available widgets
    Store-->>CB: Return widget list
    CB->>User: Show widget options
    User->>CB: Select & configure widget
    CB->>DB: Save collection schema

    Form->>Store: Load widget for field
    Store-->>Form: Return widget function
    Form->>Form: Create field instance
    Form->>User: Render input component

    User->>Form: Enter data
    Form->>Form: Validate input
    Form->>DB: Save content

    User->>Form: View content
    Form->>Form: Render display component
    Form-->>User: Show formatted data
```

## 🏪 Widget Store State Management

```mermaid
stateDiagram-v2
    [*] --> Uninitialized

    Uninitialized --> Initializing: App Startup
    Initializing --> Scanning: Start Discovery
    Scanning --> Syncing: Found Widgets
    Syncing --> Loading: Database Updated
    Loading --> Ready: Store Populated

    Ready --> Activating: Admin Enables Widget
    Activating --> Validating: Check Dependencies
    Validating --> Updating: Dependencies OK
    Updating --> Ready: Store Updated

    Validating --> Failed: Dependencies Missing
    Failed --> Ready: Show Error

    Ready --> Deactivating: Admin Disables Widget
    Deactivating --> Checking: Check Usage
    Checking --> Updating: Safe to Disable
    Checking --> Blocked: Widget in Use
    Blocked --> Ready: Show Warning

    Ready --> Requesting: Collection Needs Widget
    Requesting --> Serving: Widget Available
    Serving --> Ready: Widget Returned

    Requesting --> Missing: Widget Not Found
    Missing --> Fallback: Show MissingWidget
    Fallback --> Ready: Fallback Rendered
```

## 🗄️ Database Schema & Relationships

```mermaid
erDiagram
    WIDGETS {
        int id PK
        string name UK "Widget folder name"
        string display_name "Human readable name"
        text description
        string icon
        enum widget_type "core|custom"
        boolean is_active
        json dependencies "Required widgets"
        json configuration "Widget settings"
        string tenant_id FK
        timestamp created_at
        timestamp updated_at
    }

    COLLECTIONS {
        int id PK
        string name UK
        string slug
        json fields "Widget field definitions"
        string tenant_id FK
        boolean is_active
        timestamp created_at
    }

    CONTENT {
        int id PK
        int collection_id FK
        json data "Widget field values"
        string status
        timestamp created_at
        timestamp updated_at
    }

    TENANTS {
        string id PK
        string name
        json settings
        boolean is_active
    }

    WIDGETS ||--|| TENANTS : "belongs to"
    COLLECTIONS ||--|| TENANTS : "belongs to"
    CONTENT ||--|| COLLECTIONS : "instance of"
    WIDGETS ||--o{ COLLECTIONS : "used in fields"
```

## 🔧 Widget Factory Pattern

```mermaid
flowchart LR
    subgraph "Input"
        CONFIG[Widget Configuration]
        PROPS[Widget Properties]
        SCHEMA[Validation Schema]
        GUI[GUI Schema]
    end

    subgraph "Factory Process"
        FACTORY[createWidget Function]
        VALIDATE[Validate Config]
        CREATE[Create Definition]
        ATTACH[Attach Metadata]
    end

    subgraph "Output"
        FUNCTION[Widget Function]
        DEFINITION[Widget Definition]
        INSTANCE[Field Instances]
    end

    CONFIG --> FACTORY
    PROPS --> FACTORY
    SCHEMA --> FACTORY
    GUI --> FACTORY

    FACTORY --> VALIDATE
    VALIDATE --> CREATE
    CREATE --> ATTACH

    ATTACH --> FUNCTION
    FUNCTION --> DEFINITION
    FUNCTION --> INSTANCE

    style FACTORY fill:#e1f5fe
    style FUNCTION fill:#f3e5f5
```

## 🌐 Multi-Tenant Widget Configuration

```mermaid
graph TD
    subgraph "Global Widget Pool"
        CORE[Core Widgets<br/>input, richText, date]
        CUSTOM[Custom Widgets<br/>seo, address, currency]
    end

    subgraph "Tenant A - E-commerce"
        A_CORE[✅ All Core Widgets]
        A_SEO[✅ SEO Widget]
        A_CURR[✅ Currency Widget]
        A_ADDR[❌ Address Widget]
    end

    subgraph "Tenant B - Blog"
        B_CORE[✅ All Core Widgets]
        B_SEO[✅ SEO Widget]
        B_CURR[❌ Currency Widget]
        B_ADDR[❌ Address Widget]
    end

    subgraph "Tenant C - Corporate"
        C_CORE[✅ All Core Widgets]
        C_SEO[❌ SEO Widget]
        C_CURR[❌ Currency Widget]
        C_ADDR[✅ Address Widget]
    end

    CORE --> A_CORE
    CORE --> B_CORE
    CORE --> C_CORE

    CUSTOM --> A_SEO
    CUSTOM --> A_CURR
    CUSTOM --> B_SEO
    CUSTOM --> C_ADDR

    style CORE fill:#c8e6c9
    style A_CORE fill:#c8e6c9
    style B_CORE fill:#c8e6c9
    style C_CORE fill:#c8e6c9
    style A_SEO fill:#e3f2fd
    style B_SEO fill:#e3f2fd
    style C_ADDR fill:#e3f2fd
```

## 📊 Performance & Loading Strategy

```mermaid
graph TB
    subgraph "Bundle Optimization"
        ENTRY[App Entry Point]
        CORE_BUNDLE[Core Widgets Bundle<br/>Always Loaded]
        CUSTOM_CHUNKS[Custom Widget Chunks<br/>Lazy Loaded]
    end

    subgraph "Runtime Loading"
        REQUEST[Widget Request]
        CACHE_CHECK{In Cache?}
        LOAD[Dynamic Import]
        CACHE_STORE[Store in Cache]
        RETURN[Return Widget]
    end

    subgraph "Memory Management"
        LRU[LRU Cache]
        CLEANUP[Cleanup Unused]
        GC[Garbage Collection]
    end

    ENTRY --> CORE_BUNDLE
    ENTRY --> CUSTOM_CHUNKS

    REQUEST --> CACHE_CHECK
    CACHE_CHECK -->|Yes| RETURN
    CACHE_CHECK -->|No| LOAD
    LOAD --> CACHE_STORE
    CACHE_STORE --> RETURN

    CACHE_STORE --> LRU
    LRU --> CLEANUP
    CLEANUP --> GC

    style CORE_BUNDLE fill:#c8e6c9
    style CUSTOM_CHUNKS fill:#fff3e0
    style CACHE_CHECK fill:#e1f5fe
```

## 🧪 Testing Strategy Overview

```mermaid
graph LR
    subgraph "Unit Tests"
        FACTORY[Factory Function Tests]
        VALIDATION[Validation Schema Tests]
        UTILS[Utility Function Tests]
    end

    subgraph "Component Tests"
        INPUT_TEST[Input Component Tests]
        DISPLAY_TEST[Display Component Tests]
        INTEGRATION[Component Integration]
    end

    subgraph "System Tests"
        STORE_TEST[Widget Store Tests]
        API_TEST[API Endpoint Tests]
        E2E[End-to-End Tests]
    end

    subgraph "Performance Tests"
        LOAD_TEST[Loading Performance]
        MEMORY_TEST[Memory Usage]
        BUNDLE_TEST[Bundle Size Analysis]
    end

    FACTORY --> INPUT_TEST
    VALIDATION --> INPUT_TEST
    UTILS --> DISPLAY_TEST

    INPUT_TEST --> STORE_TEST
    DISPLAY_TEST --> STORE_TEST
    INTEGRATION --> API_TEST

    STORE_TEST --> E2E
    API_TEST --> E2E

    E2E --> LOAD_TEST
    LOAD_TEST --> MEMORY_TEST
    MEMORY_TEST --> BUNDLE_TEST

    style FACTORY fill:#e8f5e8
    style INPUT_TEST fill:#f3e5f5
    style STORE_TEST fill:#fff8e1
    style E2E fill:#e1f5fe
```

## 🚀 Deployment & Distribution

```mermaid
flowchart TD
    subgraph "Development"
        CODE[Widget Development]
        TEST[Local Testing]
        DOC[Documentation]
    end

    subgraph "Build Process"
        SCAN[Widget Discovery]
        BUNDLE[Bundle Optimization]
        TYPES[Type Generation]
        VALIDATE[Validation]
    end

    subgraph "Deployment"
        STAGING[Staging Environment]
        PROD[Production Deploy]
        MONITOR[Monitoring]
    end

    subgraph "Distribution"
        NPM[NPM Package]
        MARKETPLACE[Widget Marketplace]
        DOCS[Documentation Site]
    end

    CODE --> TEST
    TEST --> DOC
    DOC --> SCAN

    SCAN --> BUNDLE
    BUNDLE --> TYPES
    TYPES --> VALIDATE

    VALIDATE --> STAGING
    STAGING --> PROD
    PROD --> MONITOR

    VALIDATE --> NPM
    NPM --> MARKETPLACE
    MARKETPLACE --> DOCS

    style CODE fill:#e8f5e8
    style VALIDATE fill:#f3e5f5
    style PROD fill:#c8e6c9
    style MARKETPLACE fill:#fff8e1
```

---

## 📚 Documentation Navigation

Use these visual guides alongside the main documentation:

- **[Widget System Overview](/docs/widgets/widget-system-overview.mdx)** - High-level concepts
- **[Widget Architecture](/docs/widgets/widget-architecture.mdx)** - Technical implementation
- **[Development Guide](/docs/widgets/widget-development-guide.mdx)** - Creating widgets
- **[Widget System Index](/docs/widgets/index.mdx)** - Complete documentation hub
