---
path: 'docs/api/Widget_API.mdx'
title: 'Widget Management API'
description: 'Complete API reference for managing widgets in SveltyCMS including installation, activation, and dependency management.'
order: 6
icon: 'mdi:puzzle'
author: 'admin'
created: '2025-10-05'
updated: '2025-10-05'
tags:
  - 'api'
  - 'widgets'
  - 'plugins'
  - 'extensions'
---

# Widget Management API

## Overview

The Widget API provides comprehensive endpoints for managing widgets (plugins/extensions) in SveltyCMS. Widgets extend functionality and can be core (built-in) or custom (user-installed).

**Base Path:** `/api/widgets`

## Authentication

All widget endpoints require authentication:

```http
Cookie: session=your-session-id
```

**Permissions Required:** `api:widgets` for all endpoints

## Widget Architecture

SveltyCMS uses a 3-pillar widget architecture:

1. **Core Widgets** - Built-in, essential functionality
2. **Active Widgets** - Currently enabled/active widgets
3. **Widget Functions** - Registry of all widget capabilities

---

## Endpoints

### 1. List Widgets

Retrieves comprehensive information about all available widgets.

#### Request

```http
GET /api/widgets/list
```

**Query Parameters:**

- `tenantId` (string, optional) - Filter by tenant (multi-tenant mode)
- `category` (string, optional) - Filter by widget category
- `status` (string, optional) - Filter by status (`active`, `inactive`, `core`)

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"widgets": {
		"widgetFunction": {
			"name": "widgetFunction",
			"version": "1.0.0",
			"description": "Core widget function component",
			"category": "core",
			"status": "active",
			"isCore": true,
			"dependencies": [],
			"metadata": {
				"author": "SveltyCMS",
				"license": "MIT",
				"icon": "mdi:puzzle"
			}
		},
		"mediaUpload": {
			"name": "mediaUpload",
			"version": "1.2.0",
			"description": "Media file upload widget",
			"category": "media",
			"status": "active",
			"isCore": true,
			"dependencies": ["widgetFunction"],
			"metadata": {
				"author": "SveltyCMS",
				"license": "MIT",
				"icon": "mdi:upload"
			}
		}
	},
	"summary": {
		"total": 25,
		"active": 18,
		"inactive": 5,
		"core": 15,
		"custom": 10
	},
	"tenantId": "default-tenant",
	"processingTime": "45ms"
}
```

**Error Responses:**

```json
// 401 Unauthorized
{
  "success": false,
  "message": "Unauthorized"
}

// 403 Forbidden
{
  "success": false,
  "message": "Insufficient permissions"
}
```

---

### 2. Install Widget

Installs a widget from the marketplace.

#### Request

```http
POST /api/widgets/install
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"widgetId": "custom-widget-123",
	"tenantId": "tenant-xyz",
	"version": "1.0.0",
	"config": {
		"option1": "value1"
	}
}
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"widgetId": "custom-widget-123",
	"tenantId": "tenant-xyz",
	"installedAt": "2025-10-05T14:30:00Z",
	"message": "Widget installed successfully"
}
```

**Error Responses:**

```json
// 400 Bad Request - Missing widget ID
{
  "success": false,
  "message": "Widget ID is required"
}

// 409 Conflict - Already installed
{
  "success": false,
  "message": "Widget already installed"
}

// 500 Internal Server Error
{
  "success": false,
  "message": "Failed to install widget: Installation error"
}
```

---

### 3. Uninstall Widget

Uninstalls a previously installed widget.

#### Request

```http
POST /api/widgets/uninstall
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"widgetName": "custom-widget",
	"tenantId": "tenant-xyz",
	"force": false
}
```

**Parameters:**

- `widgetName` (string, required) - Name of widget to uninstall
- `tenantId` (string, optional) - Tenant ID (defaults to user's tenant)
- `force` (boolean, optional) - Force uninstall even with dependencies

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"widgetName": "custom-widget",
	"tenantId": "tenant-xyz",
	"uninstalledAt": "2025-10-05T14:30:00Z",
	"message": "Widget uninstalled successfully"
}
```

**Error Responses:**

```json
// 400 Bad Request - Missing widget name
{
  "success": false,
  "message": "Widget name is required"
}

// 400 Bad Request - Has dependencies
{
  "success": false,
  "message": "Cannot uninstall: Other widgets depend on this widget",
  "dependents": ["widget1", "widget2"]
}

// 409 Conflict - Core widget
{
  "success": false,
  "message": "Cannot uninstall core widget"
}
```

---

### 4. Activate Widget

Activates an installed but inactive widget.

#### Request

```http
POST /api/widgets/activate
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"widgetName": "custom-widget",
	"tenantId": "tenant-xyz"
}
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"widgetName": "custom-widget",
	"status": "active",
	"message": "Widget activated successfully"
}
```

---

### 5. Deactivate Widget

Deactivates an active widget without uninstalling it.

#### Request

```http
POST /api/widgets/deactivate
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"widgetName": "custom-widget",
	"tenantId": "tenant-xyz"
}
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"widgetName": "custom-widget",
	"status": "inactive",
	"message": "Widget deactivated successfully"
}
```

---

### 6. Get Widget Status

Retrieves the current status of a specific widget.

#### Request

```http
GET /api/widgets/status/[widgetName]
```

**Path Parameters:**

- `widgetName` (string) - The widget name

**Query Parameters:**

- `tenantId` (string, optional) - Tenant ID

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"widget": {
		"name": "mediaUpload",
		"version": "1.2.0",
		"status": "active",
		"isCore": true,
		"dependencies": ["widgetFunction"],
		"dependents": ["imageGallery", "fileManager"],
		"installedAt": "2025-01-01T00:00:00Z",
		"activatedAt": "2025-01-01T00:00:00Z",
		"lastUpdated": "2025-10-05T14:30:00Z"
	}
}
```

---

### 7. Validate Widget

Validates a widget's integrity and compatibility.

#### Request

```http
POST /api/widgets/validate
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"widgetName": "custom-widget",
	"tenantId": "tenant-xyz"
}
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"valid": true,
	"checks": {
		"fileIntegrity": "passed",
		"dependencies": "passed",
		"compatibility": "passed",
		"permissions": "passed"
	},
	"message": "Widget validation successful"
}
```

**Validation Failure (200 with warnings):**

```json
{
	"success": true,
	"valid": false,
	"checks": {
		"fileIntegrity": "passed",
		"dependencies": "failed",
		"compatibility": "warning",
		"permissions": "passed"
	},
	"errors": ["Missing dependency: widgetFunction v2.0.0"],
	"warnings": ["Newer version available: 1.3.0"]
}
```

---

### 8. Sync Widgets

Synchronizes widget registry with filesystem.

#### Request

```http
POST /api/widgets/sync
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"tenantId": "tenant-xyz",
	"force": false
}
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"syncedAt": "2025-10-05T14:30:00Z",
	"changes": {
		"added": 2,
		"removed": 1,
		"updated": 3
	},
	"message": "Widget registry synchronized"
}
```

---

### 9. Get Required Widgets

Retrieves a list of required (core) widgets that cannot be disabled.

#### Request

```http
GET /api/widgets/required
```

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"required": ["widgetFunction", "authentication", "userManagement", "systemSettings"],
	"count": 4
}
```

---

### 10. Get Active Widgets

Retrieves only currently active widgets.

#### Request

```http
GET /api/widgets/active
```

**Query Parameters:**

- `tenantId` (string, optional) - Filter by tenant

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** `api:widgets`

#### Response

**Success (200):**

```json
{
	"success": true,
	"activeWidgets": ["widgetFunction", "mediaUpload", "userManagement", "collectionBuilder"],
	"count": 4,
	"tenantId": "default-tenant"
}
```

---

## Widget Lifecycle

1. **Installation** - Download and install widget files
2. **Validation** - Check integrity, dependencies, compatibility
3. **Registration** - Add to widget registry
4. **Activation** - Enable widget functionality
5. **Usage** - Widget is active and functional
6. **Deactivation** - Disable without removing
7. **Uninstallation** - Remove widget completely

---

## Widget Dependencies

Widgets can depend on other widgets:

```json
{
	"name": "imageGallery",
	"dependencies": ["widgetFunction", "mediaUpload"],
	"dependents": ["portfolioWidget"]
}
```

**Dependency Rules:**

- Cannot uninstall widget if others depend on it
- Dependencies must be installed before dependent
- Circular dependencies are not allowed

---

## Database-Agnostic Implementation

The Widget API uses permission-based authorization (no direct DB queries):

```typescript
// Permission check only - no database operations
const hasPermission = hasPermissionWithRoles(user, 'api:widgets', roles);
```

Widget data is stored in:

- **File System** - Widget code and assets
- **Widget Store** - Runtime registry (Svelte store)
- **Configuration** - Settings and metadata

---

## Multi-Tenancy Support

When multi-tenant mode is enabled:

- Each tenant has isolated widget installations
- Core widgets are shared across tenants
- Custom widgets are tenant-specific
- Widget settings are tenant-scoped

**Tenant-Scoped Installation:**

```http
POST /api/widgets/install
Content-Type: application/json

{
  "widgetId": "custom-widget",
  "tenantId": "tenant-abc"
}
```

---

## Widget Categories

Widgets are organized by category:

- **Core** - Essential system widgets
- **Media** - Media management widgets
- **Content** - Content creation/editing widgets
- **User** - User management widgets
- **Analytics** - Analytics and reporting widgets
- **Integration** - Third-party integrations
- **Custom** - User-created widgets

---

## Security Considerations

### Access Control

- Only users with `api:widgets` permission can manage widgets
- Widget installation requires admin rights
- Tenant isolation in multi-tenant mode

### Widget Validation

- Code signing verification
- Dependency validation
- Permission declaration
- Sandbox execution (planned)

### Widget Sources

- Official marketplace (verified)
- Third-party marketplace (community)
- Local installation (custom)

---

## Widget Development

### Widget Structure

```
my-widget/
├── index.ts          # Main entry point
├── widget.json       # Metadata and configuration
├── Component.svelte  # UI component
├── api/              # API endpoints
└── assets/           # Static assets
```

### Widget Metadata (widget.json)

```json
{
	"name": "myWidget",
	"version": "1.0.0",
	"description": "My custom widget",
	"author": "Developer Name",
	"license": "MIT",
	"category": "custom",
	"dependencies": ["widgetFunction"],
	"permissions": ["media:write", "content:read"],
	"icon": "mdi:puzzle",
	"homepage": "https://example.com"
}
```

---

## Testing

### JavaScript Example

```javascript
// List all widgets
const response = await fetch('/api/widgets/list', {
	credentials: 'include'
});
const { widgets, summary } = await response.json();

// Install widget
const installResponse = await fetch('/api/widgets/install', {
	method: 'POST',
	credentials: 'include',
	headers: { 'Content-Type': 'application/json' },
	body: JSON.stringify({
		widgetId: 'custom-widget-123',
		tenantId: 'my-tenant'
	})
});

// Activate widget
await fetch('/api/widgets/activate', {
	method: 'POST',
	credentials: 'include',
	headers: { 'Content-Type': 'application/json' },
	body: JSON.stringify({
		widgetName: 'custom-widget'
	})
});
```

---

## Related Documentation

- [Widget Architecture](/docs/dev-guide/widget-system-architecture)
- [Widget Development Guide](/docs/widgets/development)
- [Core Widgets Reference](/docs/widgets/core/)
- [Custom Widget Examples](/docs/widgets/examples)

---

## Implementation Details

For implementation details, see:

- `src/routes/api/widgets/list/+server.ts` - List widgets
- `src/routes/api/widgets/install/+server.ts` - Install endpoint
- `src/routes/api/widgets/uninstall/+server.ts` - Uninstall endpoint
- `src/stores/widgetStore.svelte.ts` - Widget registry store
- `src/databases/auth/permissions.ts` - Permission checking
