---
path: 'docs/api/Miscellaneous_API.mdx'
title: 'Miscellaneous API Endpoints'
description: 'Documentation for additional API endpoints including permissions, email, folders, and utilities.'
order: 12
icon: 'mdi:dots-horizontal'
author: 'admin'
created: '2025-10-05'
updated: '2025-10-05'
tags:
  - 'api'
  - 'utilities'
  - 'permissions'
  - 'email'
  - 'folders'
---

# Miscellaneous API Endpoints

## Overview

This document covers additional API endpoints that don't fit into major categories but provide important functionality for permissions, email, virtual folders, content structure, and system utilities.

---

## Permission Management

### Update Permissions & Roles

Updates system roles and permissions configuration.

#### Request

```http
POST /api/permission/update
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"roles": [
		{
			"_id": "editor",
			"name": "Editor",
			"isAdmin": false,
			"permissions": ["content:read", "content:write", "media:read", "media:write"]
		},
		{
			"_id": "contributor",
			"name": "Contributor",
			"isAdmin": false,
			"permissions": ["content:read", "content:create", "media:read"]
		}
	]
}
```

**Permissions Required:** `admin` only

#### Response

**Success (200):**

```json
{
	"success": true,
	"message": "Permissions updated successfully",
	"rolesUpdated": 2,
	"file": "config/roles.ts"
}
```

**Error Responses:**

```json
// 501 Not Implemented - Multi-tenant mode
{
  "success": false,
  "error": "This feature is not available in multi-tenant mode."
}

// 403 Forbidden - Not admin
{
  "success": false,
  "error": "Unauthorized"
}

// 400 Bad Request - Invalid role data
{
  "success": false,
  "error": "Invalid role configuration",
  "details": ["Role name cannot be empty"]
}
```

**Important Notes:**

- **NOT compatible with multi-tenant mode** (disabled for security)
- Modifies global `config/roles.ts` file
- Requires server restart to take effect
- Creates backup before modification

---

## Email API

### Send Email

Sends templated emails using Svelte components.

#### Request

```http
POST /api/sendMail
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"recipientEmail": "user@example.com",
	"subject": "Welcome to SveltyCMS",
	"templateName": "welcomeUser",
	"props": {
		"username": "john_doe",
		"activationLink": "https://cms.example.com/activate/token123"
	}
}
```

**Available Templates:**

- `welcomeUser` - Welcome email for new users
- `passwordReset` - Password reset email
- `invitation` - User invitation email
- `notification` - General notification email

**Permissions Required:** `admin` or `email:send`

#### Response

**Success (200):**

```json
{
	"success": true,
	"message": "Email sent successfully",
	"messageId": "<abc123@smtp.example.com>",
	"recipient": "user@example.com"
}
```

**Error Responses:**

```json
// 400 Bad Request - Missing parameters
{
  "success": false,
  "error": "Missing required parameters: recipientEmail, subject, templateName"
}

// 400 Bad Request - Invalid template
{
  "success": false,
  "error": "Template 'invalidTemplate' not found"
}

// 500 Internal Server Error - SMTP failure
{
  "success": false,
  "error": "Failed to send email: SMTP connection failed"
}
```

**SMTP Configuration:**
Requires environment variables:

- `SMTP_HOST` - SMTP server hostname
- `SMTP_PORT` - SMTP port (25, 465, 587)
- `SMTP_USER` - SMTP username
- `SMTP_PASS` - SMTP password
- `SMTP_FROM` - From email address

---

## Virtual Folders

### List Virtual Folders

Retrieves all virtual folders for organizing media.

#### Request

```http
GET /api/virtualFolder
```

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** Authenticated user

#### Response

**Success (200):**

```json
{
	"success": true,
	"data": [
		{
			"_id": "folder123",
			"name": "Product Images",
			"path": "/media/products",
			"parent": null,
			"tenantId": "tenant-abc",
			"createdAt": "2025-10-01T10:00:00Z"
		},
		{
			"_id": "folder124",
			"name": "Blog Images",
			"path": "/media/blog",
			"parent": null,
			"tenantId": "tenant-abc",
			"createdAt": "2025-10-02T12:00:00Z"
		}
	],
	"message": "Found 2 virtual folders."
}
```

---

### Create Virtual Folder

Creates a new virtual folder.

#### Request

```http
POST /api/virtualFolder
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"name": "Marketing Assets",
	"path": "/media/marketing",
	"parent": null
}
```

**Permissions Required:** `media:write` or `admin`

#### Response

**Success (201):**

```json
{
	"success": true,
	"data": {
		"_id": "folder125",
		"name": "Marketing Assets",
		"path": "/media/marketing",
		"parent": null,
		"tenantId": "tenant-abc",
		"createdAt": "2025-10-05T14:30:00Z"
	},
	"message": "Virtual folder created successfully."
}
```

---

### Get Folder Details

Retrieves details of a specific virtual folder.

#### Request

```http
GET /api/virtualFolder/[folderId]
```

**Path Parameters:**

- `folderId` (string) - The folder ID

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** Authenticated user

#### Response

**Success (200):**

```json
{
	"success": true,
	"data": {
		"_id": "folder123",
		"name": "Product Images",
		"path": "/media/products",
		"parent": null,
		"children": ["folder126", "folder127"],
		"fileCount": 42,
		"tenantId": "tenant-abc"
	}
}
```

---

### Update Virtual Folder

Updates an existing virtual folder.

#### Request

```http
PATCH /api/virtualFolder/[folderId]
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"name": "Updated Folder Name",
	"parent": "folder123"
}
```

**Permissions Required:** `media:write` or `admin`

#### Response

**Success (200):**

```json
{
	"success": true,
	"data": {
		"_id": "folder125",
		"name": "Updated Folder Name",
		"parent": "folder123",
		"updatedAt": "2025-10-05T14:35:00Z"
	},
	"message": "Virtual folder updated successfully."
}
```

---

### Delete Virtual Folder

Deletes a virtual folder.

#### Request

```http
DELETE /api/virtualFolder/[folderId]
```

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** `media:delete` or `admin`

#### Response

**Success (200):**

```json
{
	"success": true,
	"message": "Virtual folder deleted successfully."
}
```

---

## System Virtual Folders

System virtual folders follow similar endpoints but are under `/api/systemVirtualFolder/*` and require admin permissions.

---

## Content Structure

### Get Content Structure

Retrieves the complete content structure including collections and their schemas.

#### Request

```http
GET /api/content-structure
```

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** Authenticated user

#### Response

**Success (200):**

```json
{
  "success": true,
  "structure": {
    "collections": {
      "posts": {
        "name": "posts",
        "displayName": "Posts",
        "fields": [
          {
            "name": "title",
            "type": "text",
            "required": true
          },
          {
            "name": "content",
            "type": "richtext",
            "required": false
          },
          {
            "name": "author",
            "type": "relation",
            "collection": "users"
          }
        ]
      },
      "pages": {
        "name": "pages",
        "displayName": "Pages",
        "fields": [ ... ]
      }
    },
    "tenantId": "tenant-abc"
  }
}
```

---

## System Preferences

### Get System Preferences

Retrieves system-wide preferences.

#### Request

```http
GET /api/systemPreferences
```

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** Authenticated user

#### Response

**Success (200):**

```json
{
	"success": true,
	"preferences": {
		"siteName": "My CMS",
		"siteUrl": "https://cms.example.com",
		"defaultLanguage": "en",
		"timezone": "UTC",
		"dateFormat": "YYYY-MM-DD",
		"timeFormat": "HH:mm:ss"
	}
}
```

---

### Update System Preferences

Updates system preferences.

#### Request

```http
POST /api/systemPreferences
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"preferences": {
		"siteName": "Updated CMS Name",
		"defaultLanguage": "de"
	}
}
```

**Permissions Required:** `admin`

#### Response

**Success (200):**

```json
{
	"success": true,
	"message": "System preferences updated successfully"
}
```

---

## Marketplace

### List Marketplace Widgets

Retrieves available widgets from marketplace.

#### Request

```http
GET /api/marketplace/widgets
```

**Query Parameters:**

- `category` (string, optional) - Filter by category
- `search` (string, optional) - Search query

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** Authenticated user

#### Response

**Success (200):**

```json
{
	"success": true,
	"widgets": [
		{
			"id": "widget-gallery-pro",
			"name": "Gallery Pro",
			"description": "Advanced image gallery widget",
			"version": "2.1.0",
			"author": "SveltyCMS Team",
			"category": "media",
			"price": "free",
			"downloads": 1523,
			"rating": 4.8
		}
	],
	"total": 1
}
```

---

## Debug Endpoints

### Basic Debug Info

Returns basic system debug information.

#### Request

```http
GET /api/debug/basic
```

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** `admin`

#### Response

**Success (200):**

```json
{
	"success": true,
	"debug": {
		"environment": "production",
		"nodeVersion": "v20.10.0",
		"platform": "linux",
		"uptime": 86400,
		"database": "mongodb",
		"cacheEnabled": true
	}
}
```

---

### Debug Settings

Returns detailed settings debug information.

#### Request

```http
GET /api/debug/settings
```

**Headers:**

```http
Cookie: session=your-session-id
```

**Permissions Required:** `admin`

#### Response

**Success (200):**

```json
{
	"success": true,
	"settings": {
		"loaded": true,
		"source": "database",
		"groups": ["system", "theme", "security"],
		"totalSettings": 45,
		"cached": true
	}
}
```

---

## Remote Video

### Get Remote Video Info

Retrieves information about remote video URLs (YouTube, Vimeo, etc.).

#### Request

```http
POST /api/remoteVideo
```

**Headers:**

```http
Cookie: session=your-session-id
Content-Type: application/json
```

**Body:**

```json
{
	"url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
}
```

**Permissions Required:** Authenticated user

#### Response

**Success (200):**

```json
{
	"success": true,
	"video": {
		"platform": "youtube",
		"videoId": "dQw4w9WgXcQ",
		"title": "Video Title",
		"thumbnail": "https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
		"duration": 213,
		"embedUrl": "https://www.youtube.com/embed/dQw4w9WgXcQ"
	}
}
```

---

## Database-Agnostic Implementation

All miscellaneous endpoints use database adapters:

```typescript
// Virtual folders
await dbAdapter.findMany('system_virtual_folders', filter);
await dbAdapter.create('system_virtual_folders', folderData);

// Permissions (file-based in single-tenant, DB in multi-tenant)
// Uses abstraction layers

// Email (no database operations)
// Uses Nodemailer with SMTP

// Content structure
// Retrieved from ContentManager (file + DB)
```

---

## Multi-Tenancy Support

Most endpoints support multi-tenancy:

- Virtual folders scoped per tenant
- Permissions updated globally (single-tenant only)
- Email sent with tenant context
- Content structure filtered by tenant

---

## Testing

### JavaScript Examples

```javascript
// Send email
await fetch('/api/sendMail', {
	method: 'POST',
	credentials: 'include',
	headers: { 'Content-Type': 'application/json' },
	body: JSON.stringify({
		recipientEmail: 'user@example.com',
		subject: 'Test Email',
		templateName: 'welcomeUser',
		props: { username: 'john' }
	})
});

// Create virtual folder
await fetch('/api/virtualFolder', {
	method: 'POST',
	credentials: 'include',
	headers: { 'Content-Type': 'application/json' },
	body: JSON.stringify({
		name: 'New Folder',
		path: '/media/new'
	})
});

// Get content structure
const response = await fetch('/api/content-structure', {
	credentials: 'include'
});
const { structure } = await response.json();
```

---

## Related Documentation

- [User Management API](/docs/api/User_Management_API.mdx)
- [Media API](/docs/api/Media_API.mdx)
- [Configuration API](/docs/api/Configuration_API.mdx)
- [Email Templates](/docs/dev-guide/email-templates)

---

## Implementation Details

For implementation details, see:

- `src/routes/api/permission/update/+server.ts` - Permission updates
- `src/routes/api/sendMail/+server.ts` - Email sending
- `src/routes/api/virtualFolder/+server.ts` - Virtual folders
- `src/routes/api/content-structure/+server.ts` - Content structure
- `src/routes/api/marketplace/widgets/+server.ts` - Marketplace
