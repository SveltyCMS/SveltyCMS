# NX2 Monorepo Structure Analysis

**Date:** November 7, 2025

## Current Structure

```
SveltyCMS/ (nx2 branch)
├── apps/
│   ├── cms/              # Main CMS (port 5173)
│   ├── setup-wizard/     # Setup app (port 5178)
│   ├── docs/             # Documentation (port 5174)
│   ├── shared-utils/     # Shared utilities
│   ├── shared-theme/     # Shared theme
│   ├── scripts/          # Build scripts
│   └── tests/            # Test suites
├── config/               # Shared configuration
├── compiledCollections/  # Generated collections
├── mediaFolder/          # Media storage
└── [root files]
```

## Projects

### 1. cms (Main Application)

**Location:** `apps/cms/`  
**Status:** Working

Structure:

```
apps/cms/
├── src/
│   ├── components/
│   ├── content/
│   ├── databases/
│   ├── hooks/
│   ├── routes/
│   ├── services/
│   ├── stores/
│   ├── themes/
│   ├── utils/
│   └── widgets/
├── static/
├── svelte.config.js
├── vite.config.ts
└── tailwind.config.ts
```

NX Targets: `dev`, `build`, `preview`, `check`, `lint`, `format`, `paraglide`, `translate`

### 2. setup-wizard

**Location:** `apps/setup-wizard/`  
**Status:** Working

Creates `config/private.ts`, seeds database, configures global settings, sets up admin user.

### 3. docs

**Location:** `apps/docs/`  
**Status:** Working

Documentation site with MDX support. Categories: API, Architecture, Guides, Widgets.

### 4. shared-utils

**Location:** `apps/shared-utils/`  
**Status:** Working

Exports: `compile.ts`, `configCheck.ts`, `formSchemas.ts`, `languageUtils.ts`, `logger.svelte.ts`, `setupValidationSchemas.ts`, `toast.ts`

Used by: cms, setup-wizard

### 5. shared-theme

**Location:** `apps/shared-theme/`  
**Status:** Partial

Contains: `app.css`, `sveltycms.css`, `postcss.config.js`

Note: Theme sharing needs improvement

### 6. scripts

**Location:** `apps/scripts/`  
**Status:** Working

Scripts: `bundle-stats.js`, `test-setup-flow.ts`

### 7. tests

**Location:** `apps/tests/`  
**Status:** Working

Structure: `bun/`, `playwright/`, `ci-config/`

## Dependency Graph

```
cms
├── depends on: shared-utils
├── depends on: shared-theme (partial)
└── uses: config/ (shared)

setup-wizard
├── depends on: shared-utils
├── imports from: cms (some components) ⚠️
└── creates: config/private.ts

docs
└── standalone

shared-utils
└── standalone

shared-theme
└── standalone
```

**Issue:** Setup-wizard imports from CMS (circular dependency)

## Shared Resources

### Configuration (`config/`)

```
config/
├── collections/
├── backup/
├── private.ts    # ⚠️ Created by setup-wizard, used by cms
├── public.ts
└── roles.ts
```

### Compiled Collections

```
compiledCollections/
├── Collections/
└── Menu/
```

Generated by CMS compilation process.

## NX Configuration

**Root `nx.json`:**

- NX Cloud integration
- Build caching enabled
- Dependency management
- Task orchestration

**Root `package.json`:**

- Package manager: Bun
- Node version: >=20.0.0
- Workspaces: `apps/*`

## What's Working

- Clean monorepo structure
- Proper app separation
- NX task orchestration
- Independent development
- Shared utilities
- Documentation site
- Build system with caching

## Issues

### 1. Setup-Wizard ↔ CMS Coupling

Setup-wizard creates `config/private.ts` that CMS needs.

**Solution:** Shared config library

### 2. Incomplete Theme Sharing

`shared-theme` not fully utilized.

**Solution:** Proper theme library implementation

### 3. Missing Next Features

Many improvements from next branch not in nx2.

**Solution:** Migrate improvements (current task)

### 4. Documentation Gaps

Some documentation outdated or missing.

**Solution:** Update and migrate docs

### 5. Database Driver Bundling

All database drivers bundled (not pluggable).

**Solution:** Implement pluggable drivers (issue #283)

## Strengths

- Modularity - Clean separation
- Scalability - Easy to add apps/libraries
- Maintainability - Clear boundaries
- Performance - NX caching
- Developer Experience - Independent development
- Testing - Centralized infrastructure

## Comparison with Issue #283

| Requirement          | Current             | Status |
| -------------------- | ------------------- | ------ |
| Flat structure       | Uses `apps/`        | Good   |
| Separate builds      | Working             | Good   |
| Pluggable DB drivers | Not implemented     | TODO   |
| Lean bundle          | All drivers bundled | TODO   |
| Thin wrapper hooks   | Partial             | TODO   |
| Shared Tailwind      | Partial             | TODO   |

## Next Steps

1. Analysis complete - understand structure
2. Ready for migration - can start copying improvements
3. Architecture fixes - plan for resolving issues
4. Documentation - ready to migrate and update
